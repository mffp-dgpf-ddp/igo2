!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ol/source/OSM"),require("ol/source/XYZ"),require("ol/format/filter"),require("ol/format/WFS"),require("ol/source/ImageWMS"),require("ol/source/WMTS"),require("ol/tilegrid/WMTS"),require("ol/extent.js"),require("ol/source/CartoDB"),require("ol/loadingstrategy"),require("ol/source/TileArcGISRest"),require("ts-md5"),require("ol/source/VectorTile"),require("ol/format/MVT"),require("ol/source/Cluster"),require("ngx-cacheable"),require("ol/source/WMTS.js"),require("ol/Map"),require("ol/View"),require("ol/Geolocation"),require("ol/control/Attribution"),require("ol/control/ScaleLine"),require("ol/geom/Circle"),require("ol/layer/Image"),require("ol/layer/Tile"),require("ol/color"),require("ol/layer/VectorTile"),require("ol/easing"),require("ol/has"),require("proj4"),require("ol/proj/proj4"),require("@angular/animations"),require("ol/format/GML2"),require("ol/format/GML3"),require("ol/format/EsriJSON"),require("ol/proj/Projection"),require("@angular/platform-browser"),require("moment"),require("ol/format/WKT"),require("ol/geom/Point"),require("ol/Overlay"),require("ol/sphere"),require("ol/style/Style"),require("ol/geom/LineString"),require("@turf/line-intersect"),require("@turf/helpers"),require("ol/interaction/Modify"),require("ol/interaction/Translate"),require("ol/interaction/Draw"),require("ol/geom/Polygon"),require("ol/geom/LinearRing"),require("ol/interaction/DragBox"),require("ol/source/Vector"),require("ol/layer/Vector"),require("file-saver"),require("jspdf"),require("html2canvas"),require("jszip"),require("ol/Feature"),require("ol/geom"),require("ol/proj"),require("ol/style"),require("ol/events/condition"),require("ol/interaction"),require("ol/extent"),require("ol/Observable"),require("ol/format"),require("@angular/forms"),require("rxjs"),require("ol/format/GeoJSON"),require("@angular/material"),require("@angular/common"),require("@igo2/common"),require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("@igo2/utils"),require("@igo2/core")):"function"==typeof define&&define.amd?define("@igo2/geo",["exports","ol/source/OSM","ol/source/XYZ","ol/format/filter","ol/format/WFS","ol/source/ImageWMS","ol/source/WMTS","ol/tilegrid/WMTS","ol/extent.js","ol/source/CartoDB","ol/loadingstrategy","ol/source/TileArcGISRest","ts-md5","ol/source/VectorTile","ol/format/MVT","ol/source/Cluster","ngx-cacheable","ol/source/WMTS.js","ol/Map","ol/View","ol/Geolocation","ol/control/Attribution","ol/control/ScaleLine","ol/geom/Circle","ol/layer/Image","ol/layer/Tile","ol/color","ol/layer/VectorTile","ol/easing","ol/has","proj4","ol/proj/proj4","@angular/animations","ol/format/GML2","ol/format/GML3","ol/format/EsriJSON","ol/proj/Projection","@angular/platform-browser","moment","ol/format/WKT","ol/geom/Point","ol/Overlay","ol/sphere","ol/style/Style","ol/geom/LineString","@turf/line-intersect","@turf/helpers","ol/interaction/Modify","ol/interaction/Translate","ol/interaction/Draw","ol/geom/Polygon","ol/geom/LinearRing","ol/interaction/DragBox","ol/source/Vector","ol/layer/Vector","file-saver","jspdf","html2canvas","jszip","ol/Feature","ol/geom","ol/proj","ol/style","ol/events/condition","ol/interaction","ol/extent","ol/Observable","ol/format","@angular/forms","rxjs","ol/format/GeoJSON","@angular/material","@angular/common","@igo2/common","@angular/core","@angular/common/http","rxjs/operators","@igo2/utils","@igo2/core"],t):t((e.igo2=e.igo2||{},e.igo2.geo={}),e.olSourceOSM,e.olSourceXYZ,e.olfilter,e.olFormatWFS,e.olSourceImageWMS,e.olSourceWMTS,e.olTileGridWMTS,e.extent_js,e.olSourceCarto,e.OlLoadingStrategy,e.olSourceTileArcGISRest,e.tsMd5,e.olSourceVectorTile,e.olFormatMVT,e.olSourceCluster,e.ngxCacheable,e.WMTS_js,e.olMap,e.olView,e.olGeolocation,e.olAttribution,e.olControlScaleLine,e.olCircle,e.olLayerImage,e.olLayerTile,e.color,e.olLayerVectorTile,e.oleasing,e.has,e.proj4,e.olproj4,e.ng.animations,e.olFormatGML2,e.olFormatGML3,e.olFormatEsriJSON,e.olProjection,e.ng.platformBrowser,e.moment,e.olWKT,e.OlPoint,e.OlOverlay,e.sphere,e.OlStyle,e.OlLineString,e.lineIntersect,e.helpers,e.OlModify,e.OlTranslate,e.OlDraw,e.OlPolygon,e.OlLinearRing,e.OlDragBoxInteraction,e.OlVectorSource,e.OlVectorLayer,e.fileSaver,e.jsPDF,e._html2canvas,e.JSZip,e.olFeature,e.olgeom,e.olproj,e.olstyle,e.olcondition,e.olinteraction,e.olextent,e.olobservable,e.olformat,e.ng.forms,e.rxjs,e.OlGeoJSON,e.ng.material,e.ng.common,e.common$1,e.ng.core,e.ng.common.http,e.rxjs.operators,e.utils,e.i1$1)}(this,function(e,t,r,b,l,o,n,a,s,i,u,c,p,d,g,h,f,y,m,v,S,w,O,F,I,x,M,T,C,L,ee,P,D,j,k,R,E,$,A,_,G,q,B,N,V,U,W,z,K,H,Q,Y,Z,J,X,te,re,oe,ne,ie,ae,se,le,ue,ce,pe,de,ge,he,fe,ye,me,ve,be,Se,we,Oe,Fe,Ie){"use strict";t=t&&t.hasOwnProperty("default")?t["default"]:t,r=r&&r.hasOwnProperty("default")?r["default"]:r,l=l&&l.hasOwnProperty("default")?l["default"]:l,o=o&&o.hasOwnProperty("default")?o["default"]:o,n=n&&n.hasOwnProperty("default")?n["default"]:n,a=a&&a.hasOwnProperty("default")?a["default"]:a,i=i&&i.hasOwnProperty("default")?i["default"]:i,c=c&&c.hasOwnProperty("default")?c["default"]:c,d=d&&d.hasOwnProperty("default")?d["default"]:d,g=g&&g.hasOwnProperty("default")?g["default"]:g,h=h&&h.hasOwnProperty("default")?h["default"]:h,m=m&&m.hasOwnProperty("default")?m["default"]:m,v=v&&v.hasOwnProperty("default")?v["default"]:v,S=S&&S.hasOwnProperty("default")?S["default"]:S,w=w&&w.hasOwnProperty("default")?w["default"]:w,O=O&&O.hasOwnProperty("default")?O["default"]:O,F=F&&F.hasOwnProperty("default")?F["default"]:F,I=I&&I.hasOwnProperty("default")?I["default"]:I,x=x&&x.hasOwnProperty("default")?x["default"]:x,T=T&&T.hasOwnProperty("default")?T["default"]:T,ee=ee&&ee.hasOwnProperty("default")?ee["default"]:ee,j=j&&j.hasOwnProperty("default")?j["default"]:j,k=k&&k.hasOwnProperty("default")?k["default"]:k,R=R&&R.hasOwnProperty("default")?R["default"]:R,E=E&&E.hasOwnProperty("default")?E["default"]:E,_=_&&_.hasOwnProperty("default")?_["default"]:_,G=G&&G.hasOwnProperty("default")?G["default"]:G,q=q&&q.hasOwnProperty("default")?q["default"]:q,N=N&&N.hasOwnProperty("default")?N["default"]:N,V=V&&V.hasOwnProperty("default")?V["default"]:V,U=U&&U.hasOwnProperty("default")?U["default"]:U,z=z&&z.hasOwnProperty("default")?z["default"]:z,K=K&&K.hasOwnProperty("default")?K["default"]:K,H=H&&H.hasOwnProperty("default")?H["default"]:H,Q=Q&&Q.hasOwnProperty("default")?Q["default"]:Q,Y=Y&&Y.hasOwnProperty("default")?Y["default"]:Y,Z=Z&&Z.hasOwnProperty("default")?Z["default"]:Z,J=J&&J.hasOwnProperty("default")?J["default"]:J,X=X&&X.hasOwnProperty("default")?X["default"]:X,ie=ie&&ie.hasOwnProperty("default")?ie["default"]:ie,ye=ye&&ye.hasOwnProperty("default")?ye["default"]:ye;var xe=(Me.prototype.open=function(e){e.extern&&window.open(e.url,"_blank")},Me.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Me.ctorParameters=function(){return[]},Me.ngInjectableDef=Se.defineInjectable({factory:function(){return new Me},token:Me,providedIn:"root"}),Me);function Me(){}var Te=(Object.defineProperty(Ce.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ce.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Ce.prototype.openMetadata=function(e){this.metadataService.open(e)},Object.defineProperty(Ce.prototype,"options",{get:function(){if(this.layer)return this.layer.options},enumerable:!0,configurable:!0}),Ce.decorators=[{type:Se.Component,args:[{selector:"igo-metadata-button",template:'<button\r\n  *ngIf="options && options.metadata && options.metadata.url"\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.metadata.show\' | translate"\r\n  [color]="color"\r\n  (click)="openMetadata(options.metadata)">\r\n  <mat-icon svgIcon="information-outline"></mat-icon>\r\n</button>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Ce.ctorParameters=function(){return[{type:xe}]},Ce.propDecorators={layer:[{type:Se.Input}],color:[{type:Se.Input}]},Ce);function Ce(e){this.metadataService=e,this._color="primary"}var Le=(Pe.forRoot=function(){return{ngModule:Pe,providers:[]}},Pe.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatIconModule,me.MatButtonModule,me.MatTooltipModule,Ie.IgoLanguageModule],exports:[Te],declarations:[Te]}]}],Pe);function Pe(){}var De=function(e,t){return(De=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function je(e,t){function r(){this.constructor=e}De(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var ke=function(){return(ke=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function Re(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(i<3?n(a):3<i?n(t,r,a):n(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a}function Ee(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function $e(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function Ae(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)a.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return a}function _e(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ae(arguments[t]));return e}function Ge(){}function qe(e){return({wms:Be,wmts:Ne,xyz:Ve,feature:Ue,osm:function(e){return"OSM"}}[e.type]||We)(e)}function Be(e){var t=e.params.layers,r="wms"+e.url+t;return p.Md5.hashStr(r)}function Ne(e){var t=e.layer,r="wmts"+e.url+t;return p.Md5.hashStr(r)}function Ve(e){var t="xyz"+e.url;return p.Md5.hashStr(t)}function Ue(e){if(!e.url)return We(e);var t="feature"+e.url;return p.Md5.hashStr(t)}function We(e){return Fe.uuid()}var ze=(Ke.prototype.generateId=function(){return qe(this.options)},Ke.prototype.getLegend=function(e){return this.options.legend?[this.options.legend]:[]},Ke);function Ke(e,t){void 0===e&&(e={}),this.options=e,this.dataService=t,this.options=e,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}var He,Qe=(je(Ye,He=ze),Ye.prototype.createOlSource=function(){var e={format:this.getSourceFormatFromOptions(this.options)};return new J(Object.assign(e,this.options))},Ye.prototype.getSourceFormatFromOptions=function(e){if(e.format)return e.format;var t,r=e.formatType;if(r){if((t=ge[r])===undefined)throw new Error("Invalid vector source format ${formatType}.")}else t=ge.GeoJSON;var o=e.formatOptions;return o?new t(o):new t},Ye.prototype.onUnwatch=function(){},Ye);function Ye(){return null!==He&&He.apply(this,arguments)||this}var Ze,Je=(je(Xe,Ze=ze),Xe.prototype.createOlSource=function(){return this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png",new t(this.options)},Xe.prototype.onUnwatch=function(){},Xe);function Xe(){return null!==Ze&&Ze.apply(this,arguments)||this}var et,tt=(je(rt,et=ze),rt.prototype.createOlSource=function(){return new r(this.options)},rt.prototype.onUnwatch=function(){},rt);function rt(){return null!==et&&et.apply(this,arguments)||this}var ot=(nt.prototype.defineOgcFiltersDefaultOptions=function(e,t,r){var o=!0;return r&&"wms"===r&&(o=!1),(e=e||{}).enabled=e.enabled===undefined?o:e.enabled,e.editable=e.editable===undefined?o:e.editable,e.geometryName=t,e.advancedOgcFilters=!0,e.enabled&&e.pushButtons&&(e.advancedOgcFilters=!1),e},nt.prototype.buildFilter=function(e,t,r,o){var n,i;if(i=!/intersects|contains|within/gi.test(JSON.stringify(e)),e&&(o=e.geometryName!==undefined?e.geometryName:o),t&&e&&(n=b.bbox(o,t,r.getCode())),!e)return"bbox="+t.join(",")+","+r.getCode();e=this.checkIgoFiltersProperties(e,o);var a={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:t&&i?b.and(n,this.bundleFilter(e)):this.bundleFilter(e),outputFormat:"",geometryName:o},s=(new l).writeGetFeature(a);return"filter="+(new XMLSerializer).serializeToString(s).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]},nt.prototype.bundleFilter=function(e){var t=this;if(e instanceof Array){var r=[];return e.forEach(function(e){r.push(t.bundleFilter(e))}),r}return e.hasOwnProperty("logical")?this.createFilter({operator:e.logical,logicalArray:this.bundleFilter(e.filters)}):e.hasOwnProperty("operator")?this.createFilter(e):void 0},nt.prototype.createFilter=function(e){var t,r=e.operator,o=e.logicalArray,n=e.propertyName,i=e.pattern,a=!e.matchCase||e.matchCase,s=e.wildCard?e.wildCard:"*",l=e.singleChar?e.singleChar:".",u=e.escapeChar?e.escapeChar:"!",c=e.lowerBoundary,p=e.upperBoundary,d=e.geometryName,g=e.extent,h=e.wkt_geometry,f=e.srsName?e.srsName:"EPSG:3857",y=e.begin,m=e.end,v=e.expression;switch(h&&(t=(new _).readGeometry(h,{dataProjection:f,featureProjection:"EPSG:3857"})),r){case"BBOX":return b.bbox(d,g,f);case"PropertyIsBetween":return b.between(n,c,p);case"Contains":return b.contains(d,t,f);case"During":return b.during(n,y,m);case"PropertyIsEqualTo":return b.equalTo(n,v,a);case"PropertyIsGreaterThan":return b.greaterThan(n,v);case"PropertyIsGreaterThanOrEqualTo":return b.greaterThanOrEqualTo(n,v);case"Intersects":return b.intersects(d,t,f);case"PropertyIsNull":return b.isNull(n);case"PropertyIsLessThan":return b.lessThan(n,v);case"PropertyIsLessThanOrEqualTo":return b.lessThanOrEqualTo(n,v);case"PropertyIsLike":return b.like(n,i.replace(/[()_]/gi,l),s,l,u,a);case"PropertyIsNotEqualTo":return b.notEqualTo(n,v,a);case"Within":return b.within(d,t,f);case"And":return b.and.apply(null,o);case"Or":return b.or.apply(null,o);case"Not":return b.not.apply(null,o);default:return undefined}},nt.prototype.defineInterfaceFilterSequence=function(e,t,r,o){var n=this;return void 0===r&&(r=""),void 0===o&&(o=-1),e instanceof Array?e.forEach(function(e){n.filterSequence.concat(n.defineInterfaceFilterSequence(e,t,r,o))}):e.hasOwnProperty("logical")?(o+=1,this.filterSequence.concat(this.defineInterfaceFilterSequence(e.filters,t,e.logical,o))):e.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(e,t,o,r)),this.filterSequence},nt.prototype.addInterfaceFilter=function(e,t,r,o){void 0===r&&(r=0),void 0===o&&(o="Or"),e=e||{operator:"PropertyIsEqualTo"};var n={propertyName:"",operator:"",active:"",filterid:Fe.uuid(),begin:"",end:"",lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(n,{parentLogical:o,level:r,geometryName:t},e)},nt.prototype.checkIgoFiltersProperties=function(e,t,r){var o=this;void 0===r&&(r=!1);var n=[];return e instanceof Array?(e.forEach(function(e){n.push(o.checkIgoFiltersProperties(e,t,r))}),n):e.hasOwnProperty("logical")?Object.assign({},{logical:e.logical,filters:this.checkIgoFiltersProperties(e.filters,t,r)}):e.hasOwnProperty("operator")?this.addFilterProperties(e,t,r):void 0},nt.prototype.addFilterProperties=function(e,t,r){void 0===r&&(r=!1);var o=e.hasOwnProperty("filterid")?e.filterid:Fe.uuid(),n=e.hasOwnProperty("active")?e.active:r;return Object.assign({},{filterid:o,active:n,igoSpatialSelector:"fixedExtent"},e,{geometryName:t})},nt.prototype.rebuiltIgoOgcFilterObjectFromSequence=function(o){if(o instanceof Array){if(1<=o.length){var n,i,a=o[0].parentLogical,s=[];return o.forEach(function(e){var t=Object.assign({},e),r=o.indexOf(e);n=0<=r&&r<o.length-1?o[r+1]:t,delete t.active,delete t.filterid,delete t.parentLogical,s.push(t),1===o.length?i=t:a!==n.parentLogical&&(1===s.length?console.log("You must set at least two operator in a logical ("+a+")"):(i=Object.assign({},{logical:a,filters:s}),s=[i],a=n.parentLogical))}),i}return undefined}return undefined},nt.prototype.handleOgcFiltersAppliedValue=function(e,t){var r=e.ogcFilters;if(r){var o="",n="";if(r.enabled&&r.pushButtons){var i=r.pushButtons,a=[];i.map(function(e){var t=[];e.ogcPushButtons.filter(function(e){return!0===e.enabled}).forEach(function(e){return t.push(e.filters)}),1===t.length?a.push(t[0]):1<t.length&&a.push({logical:e.logical,filters:t})}),1<=a.length&&(o=this.buildFilter(1===a.length?a[0]:{logical:"And",filters:a}))}if(r.enabled&&r.filters){r.geometryName=r.geometryName||t;var s=r.filters;n=this.buildFilter(s)}var l=r.advancedOgcFilters?n:o;return"wms"===e.type&&(l=this.formatProcessedOgcFilter(l,e.params.layers)),"wfs"===e.type&&(l=this.formatProcessedOgcFilter(l,e.params.featureTypes)),l}},nt.prototype.formatProcessedOgcFilter=function(t,e){var r="";return 0===t.length&&-1===e.indexOf(",")?r=t:e.split(",").forEach(function(e){r=r+"("+t.replace("filter=","")+")"}),0<r.length?r.replace("filter=",""):undefined},nt);function nt(){this.filterSequence=[],this.operators={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsLike:{spatial:!1,fieldRestrict:["string"]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsBetween:{spatial:!1,fieldRestrict:["number"]},During:{spatial:!1,fieldRestrict:[]},PropertyIsNull:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]},Contains:{spatial:!0,fieldRestrict:[]}}}var it="EPSG:3857",at=5e3,st="2.0.0",lt="geometry",ut=new RegExp(/.*?gml.*?/gi),ct=new RegExp(/.*?json.*?/gi);function pt(e,t,r,o){var n="2.0.0",i=e.urlWfs,a=e.paramsWFS,s=t||at,l=r||it,u=a.outputFormat?"outputFormat="+a.outputFormat:"",c=a.version?"version="+a.version:"version="+st,p=(a.version===n?"typenames":"typename")+"="+a.featureTypes,d=a.version===n?"count":"maxFeatures",g=t?d+"="+s:a.maxFeatures?d+"="+a.maxFeatures:d+"="+s,h=r?"srsname="+l:a.srsName?"srsname="+a.srsName:"srsname="+l,f="",y="";o&&(f="propertyName="+o,y="valueReference="+o);var m=e.sourceFields;if(!f&&m&&0<m.length){var v=[];e.sourceFields.forEach(function(e){v.push(e.name)}),f="propertyName="+v.join(",")+","+a.fieldNameGeometry}var b=i+"?service=wfs&request=GetFeature&"+c+"&"+p+"&";b+=u+"&"+h+"&"+g+"&"+f;var S=i+"?service=wfs&request=GetPropertyValue&version="+n+"&"+p+"&";return S+="&"+g+"&"+y,[{name:"outputformat",value:u},{name:"version",value:c},{name:"typename",value:p},{name:"count",value:g},{name:"srsname",value:h},{name:"propertyname",value:f},{name:"valuereference",value:y},{name:"getcapabilities",value:(i+"?service=wfs&request=GetCapabilities&"+c).replace(/&&/g,"&")},{name:"getfeature",value:b.replace(/&&/g,"&")},{name:"getpropertyvalue",value:S.replace(/&&/g,"&")}]}function dt(e,t){t&&"wfs"===t&&(e.paramsWFS=e.params);var r,o=e.paramsWFS;return e.urlWfs=e.urlWfs||e.url,o.version=o.version||st,o.fieldNameGeometry=o.fieldNameGeometry||lt,o.maxFeatures=o.maxFeatures||at,o.outputFormat&&(r=o.outputFormat),!ut.test(r)&&r||(o.version="1.1.0"),Object.assign({},e)}var gt,ht=(je(ft,gt=ze),ft.prototype.createOlSource=function(){var o=this;return new J({format:this.getFormatFromOptions(),overlaps:!1,url:function(e,t,r){return o.buildUrl(e,r,o.options.ogcFilters)},strategy:u.bbox})},ft.prototype.buildUrl=function(e,t,r){var o,n=this.options.paramsWFS,i=pt(this.options,undefined,t.getCode());r&&r.enabled&&(o=r.filters);var a=new ot,s=a.buildFilter(o,e,t,r.geometryName),l=a.handleOgcFiltersAppliedValue(this.options,r.geometryName),u="filter";l||(u="bbox",l=e.join(",")+","+t.getCode()),n.xmlFilter=r.advancedOgcFilters?s:u+"="+l;var c=i.find(function(e){return"getfeature"===e.name}).value;return c=/(filter|bbox)=.*/gi.test(n.xmlFilter)?c+"&"+n.xmlFilter:c,this.options.download=Object.assign({},this.options.download,{dynamicUrl:c}),c.replace(/&&/g,"&")},ft.prototype.getFormatFromOptions=function(){var e,t;return this.options.paramsWFS.outputFormat&&(t=this.options.paramsWFS.outputFormat.toLowerCase()),ct.test(t)&&(e=ge.GeoJSON),!ut.test(t)&&t||(e=ge.WFS),new e},ft.prototype.onUnwatch=function(){},ft);function ft(e,t){var r=gt.call(this,dt(e,"wfs"))||this;r.options=e,r.wfsService=t;var o=r.options.ogcFilters,n=r.options.paramsWFS.fieldNameGeometry||lt,i=new ot;return r.options.ogcFilters=i.defineOgcFiltersDefaultOptions(o,n),r.options.ogcFilters.enabled&&r.wfsService.getSourceFieldsFromWFS(r.options),r}var yt,mt=(je(vt,yt=Ge),vt.prototype.getData=function(){return console.log("This is defining a data service."),"This is defining a data service."},vt.prototype.getSourceFieldsFromWFS=function(t){t.sourceFields&&0!==t.sourceFields.length?this.defineFieldAndValuefromWFS(t).subscribe(function(e){t.sourceFields.forEach(function(t){t.alias===undefined&&(t.alias=t.name),t.values!==undefined&&0!==t.values.length||(t.values=e.find(function(e){return e.name===t.name}).values)})}):(t.sourceFields=[],this.defineFieldAndValuefromWFS(t).subscribe(function(e){t.sourceFields=e}))},vt.prototype.wfsGetFeature=function(e,t,r,o){void 0===t&&(t=at),void 0===r&&(r=it);var n=pt(e,t,r,o).find(function(e){return"getfeature"===e.name}).value,i=e.paramsWFS.outputFormat;return ut.test(i)||!i?this.http.get(n,{responseType:"text"}):this.http.get(n)},vt.prototype.defineFieldAndValuefromWFS=function(l){var u=this;return new fe.Observable(function(r){var o,n,i,a,s=[],e=l.paramsWFS.outputFormat;a=ut.test(e)||!e?ge.WFS:ge.GeoJSON,u.wfsGetFeature(l,1).subscribe(function(e){var t=(new a).readFeatures(e);o=t[0].getKeys(),n=o.filter(function(e){return e!==t[0].getGeometryName()&&!e.match(/boundedby/gi)}),i=n.join(","),u.wfsGetFeature(l,l.paramsWFS.maxFeatures||at,undefined,i).subscribe(function(e){var t=(new a).readFeatures(e);u.built_properties_value(t).forEach(function(e){s.push(e)}),r.next(s),r.complete()})})})},vt.prototype.built_properties_value=function(e){var n=Object.assign({},e[0].getProperties());delete n[e[0].getGeometryName()],delete n.boundedBy;var i=[];for(var t in n)if(n.hasOwnProperty(t)){var r="object"==typeof e[0].get(t)?undefined:typeof e[0].get(t);i.push({name:t,alias:t,type:r,values:[n[t]]})}return e.every(function(e){function t(t){r.hasOwnProperty(t)&&t in n&&i.filter(function(e){return e.name===t}).forEach(function(e){-1===e.values.indexOf(r[t])&&e.values.push(r[t])})}var r=e.getProperties();for(var o in r)t(o);return!0}),i},vt.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],vt.ctorParameters=function(){return[{type:we.HttpClient}]},vt.ngInjectableDef=Se.defineInjectable({factory:function(){return new vt(Se.inject(we.HttpClient))},token:vt,providedIn:"root"}),vt);function vt(e){var t=yt.call(this)||this;return t.http=e,t}var bt,St={GML2:"gml2",GML3:"gml3",JSON:"json",GEOJSON:"geojson",ESRIJSON:"esrijson",TEXT:"text",HTML:"html",HTMLGML2:"htmlgml2"},wt={IFRAME:"iframe",BLANK:"_blank"},Ot=(je(Ft,bt=ze),Object.defineProperty(Ft.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(Ft.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(Ft.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:wt.BLANK},enumerable:!0,configurable:!0}),Ft.prototype.refresh=function(){this.ol.updateParams({igoRefresh:Math.random()})},Ft.prototype.buildDynamicDownloadUrlFromParamsWFS=function(e){return pt(e).find(function(e){return"getfeature"===e.name}).value},Ft.prototype.createOlSource=function(){return new o(this.options)},Ft.prototype.getLegend=function(e){var t=bt.prototype.getLegend.call(this);if(0<t.length)return t;var r=this.params,o=[];r.layers!==undefined&&(o=r.layers.split(","));var n=this.options.url.replace(/\?$/,""),i=["REQUEST=GetLegendGraphic","SERVICE=wms","FORMAT=image/png","SLD_VERSION=1.1.0","VERSION="+(r.version||"1.3.0")];return e!==undefined&&i.push("SCALE="+e),t=o.map(function(e){return{url:n+"?"+i.join("&")+"&LAYER="+e,title:1<o.length?e:undefined}})},Ft.prototype.onUnwatch=function(){},Ft);function Ft(e,t){var r=bt.call(this,e)||this;r.options=e,r.wfsService=t;var o=e.params;if(o&&o.version&&(o.VERSION=o.version),o&&o.VERSION&&"1.3.0"!==o.version&&!o.SRS&&!o.srs)throw new Error("You must set a SRS (or srs) param for your WMS\n           (layer =  "+o.layers+') because your want to use a WMS version under 1.3.0\n        Ex: "srs": "EPSG:3857" ');o&&o.INFO_FORMAT&&(o.info_format=o.INFO_FORMAT),e.refreshIntervalSec&&0<e.refreshIntervalSec&&setInterval(function(){r.refresh()},1e3*e.refreshIntervalSec);var n=lt;if(e.paramsWFS){var i=dt(e,"wms");Fe.ObjectUtils.mergeDeep(e.paramsWFS,i.paramsWFS),n=e.paramsWFS.fieldNameGeometry||n,e.download=Object.assign({},e.download,{dynamicUrl:r.buildDynamicDownloadUrlFromParamsWFS(e)})}e.sourceFields&&0!==e.sourceFields.length?e.sourceFields.forEach(function(e){e.alias=e.alias?e.alias:e.name}):e.sourceFields=[];var a=e.ogcFilters,s=new ot;a?a.advancedOgcFilters=!a.pushButtons:e.ogcFilters=s.defineOgcFiltersDefaultOptions(a,n,"wms"),1<o.layers.split(",").length&&e&&a.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+o.layers+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),e.paramsWFS&&a.enabled&&r.wfsService.getSourceFieldsFromWFS(e);var l=s.handleOgcFiltersAppliedValue(e,n);return r.ol.updateParams({filter:l}),r}function It(e){for(var t=(e?se.get(e):se.get("EPSG:3857")).getExtent(),r=s.getWidth(t)/256,o=new Array(20),n=new Array(20),i=0;i<20;++i)o[i]=r/Math.pow(2,i),n[i]=i;return new a({origin:s.getTopLeft(t),resolutions:o,matrixIds:n})}var xt,Mt=(je(Tt,xt=ze),Tt.prototype.createOlSource=function(){var e=Object.assign({tileGrid:It(this.options.projection)},this.options);return new n(e)},Tt.prototype.onUnwatch=function(){},Tt);function Tt(e){return xt.call(this,e)||this}var Ct,Lt=(je(Pt,Ct=ze),Object.defineProperty(Pt.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:wt.BLANK},enumerable:!0,configurable:!0}),Pt.prototype.createOlSource=function(){var e=this.options.crossOrigin?this.options.crossOrigin:"anonymous",t=Object.assign({crossOrigin:e},this.options);return new i(t)},Pt.prototype.getLegend=function(){var e,t,r=Ct.prototype.getLegend.call(this);if(0<r.length)return r;var o="<table>";if(null!=this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(function(e){!0===e.visible&&(o+='<tr><td><p><font size="5" color="'+e.value+'"> &#9679</font></p></td><td>'+e.name+"</td></tr>")}),[{html:o+="</table>"}];var n=this.options.config.layers[0].options;try{for(var i=$e(["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"]),a=i.next();!a.done;a=i.next()){var s=a.value;if(n.cartocss.includes(s)){var l=n.cartocss.split(s).pop(),u=l.substr(0,l.indexOf(";"));if(u.includes("ramp")){for(var c=u.split(", (")[1].split(","),p=u.split(", (")[2].split(","),d=0;d<c.length;d++)c[d]=c[d].replace(/("|\))/g,""),p[d]=p[d].replace(/("|\))/g,""),"="===p[d].replace(/\s+/g,"")&&(p[d]="Autres"),o+='<tr><td><p><font size="5" color="'+c[d]+'"> &#9679</font></p></td><td>'+p[d]+"</td></tr>";break}var g=n.layer_name?n.layer_name:"";o+='<tr><td><p><font size="5" color="'+u+'"> &#9679</font></p></td><td>'+g+"</td></tr>";break}}}catch(h){e={error:h}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}return[{html:o+="</table>"}]},Pt.prototype.onUnwatch=function(){},Pt);function Pt(){return null!==Ct&&Ct.apply(this,arguments)||this}var Dt,jt=(je(kt,Dt=ze),kt.prototype.createOlSource=function(){var e=new R;return new J({attributions:this.options.params.attributions,overlaps:!1,format:e,url:function(e,t,r){var o=this.options.url+"/"+this.options.layer+"/query/",n=["f=json","geometry="+encodeURIComponent('{"xmin":'+e[0]+',"ymin":'+e[1]+',"xmax":'+e[2]+',"ymax":'+e[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];if(this.options.params.timeFilter){var i="time="+this.options.params.timeExtent;n.push(i)}return this.options.params.customParams&&this.options.params.customParams.forEach(function(e){n.push(e)}),o+"?"+n.join("&")}.bind(this),strategy:u.bbox})},kt.prototype.getLegend=function(){var e,t,r=this.options.params.legendInfo,o=Dt.prototype.getLegend.call(this);if(r===undefined||0<o.length)return o;var n=parseInt(this.options.layer,10),i=r.layers[n],a="<table><tr><td>"+i.layerName+"</td></tr>";try{for(var s=$e(i.legend),l=s.next();!l.done;l=s.next()){var u=l.value;a+="<tr><td align='left'><img src=\""+this.options.url.replace("FeatureServer","MapServer")+"/"+i.layerId+"/images/"+u.url+"\" alt ='' /></td><td>"+u.label.replace("<Null>","Null")+"</td></tr>"}}catch(c){e={error:c}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}return[{html:a+="</table>"}]},kt.prototype.onUnwatch=function(){},kt);function kt(){return null!==Dt&&Dt.apply(this,arguments)||this}var Rt,Et=(je($t,Rt=ze),Object.defineProperty($t.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty($t.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty($t.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:wt.BLANK},enumerable:!0,configurable:!0}),$t.prototype.createOlSource=function(){return new c(this.options)},$t.prototype.getLegend=function(){var e,t,r=Rt.prototype.getLegend.call(this);if(this.options.legendInfo===undefined||0<r.length)return r;var o=parseInt(this.options.layer,10),n=this.options.legendInfo.layers[o],i="<table><tr><td>"+n.layerName+"</td></tr>";try{for(var a=$e(n.legend),s=a.next();!s.done;s=a.next()){var l=s.value;i+="<tr><td align='left'><img src=\""+this.options.url+"/"+n.layerId+"/images/"+l.url+"\" alt ='' /></td><td>"+l.label.replace("<Null>","Null")+"</td></tr>"}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}return[{html:i+="</table>"}]},$t.prototype.onUnwatch=function(){},$t);function $t(){return null!==Rt&&Rt.apply(this,arguments)||this}var At,_t=(je(Gt,At=Qe),Gt.prototype.createOlSource=function(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),At.prototype.createOlSource.call(this)},Gt.prototype.createWebSocket=function(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))},Gt.prototype.onMessage=function(e){var t=this.options.format.readFeature(e.data);switch(this.options.onmessage){case"update":var r=this.ol.getFeatureById(t.getId());r&&this.ol.removeFeature(r),this.ol.addFeature(t);break;case"delete":this.ol.clear(!0),this.ol.addFeature(t);break;case"add":default:this.ol.addFeature(t)}},Gt.prototype.onClose=function(e){},Gt.prototype.onError=function(e){},Gt.prototype.onOpen=function(e){},Gt.prototype.onUnwatch=function(){this.ws.close()},Gt);function Gt(){return null!==At&&At.apply(this,arguments)||this}var qt,Bt=(je(Nt,qt=ze),Nt.prototype.createOlSource=function(){var e=new g({featureClass:ie});return this.options.format=e,new d(this.options)},Nt.prototype.generateId=function(){if(!this.options.url)return Fe.uuid();var e="mvt"+this.options.url;return p.Md5.hashStr(e)},Nt.prototype.onUnwatch=function(){},Nt);function Nt(){return null!==qt&&qt.apply(this,arguments)||this}var Vt,Ut=(je(Wt,Vt=Qe),Wt.prototype.createOlSource=function(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=Vt.prototype.createOlSource.call(this),new h(this.options)},Wt.prototype.generateId=function(){return Fe.uuid()},Wt.prototype.onUnwatch=function(){},Wt);function Wt(){return null!==Vt&&Vt.apply(this,arguments)||this}var zt="Feature",Kt={None:0,Move:1,Zoom:2,Default:3};Kt[Kt.None]="None",Kt[Kt.Move]="Move",Kt[Kt.Zoom]="Zoom",Kt[Kt.Default]="Default";var Ht="Layer",Qt=(Object.defineProperty(Yt.prototype,"id",{get:function(){return this.options.id||this.dataSource.id},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"alias",{get:function(){return this.options.alias},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"title",{get:function(){return this.options.title},set:function(e){this.options.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"zIndex",{get:function(){return this.ol.getZIndex()},set:function(e){this.ol.setZIndex(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"baseLayer",{get:function(){return this.options.baseLayer},set:function(e){this.options.baseLayer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"visible",{get:function(){return this.ol.get("visible")},set:function(e){this.ol.setVisible(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"opacity",{get:function(){return this.ol.get("opacity")},set:function(e){this.ol.setOpacity(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"isInResolutionsRange",{get:function(){if(!this.map)return!1;var e=this.map.viewController.getResolution(),t=this.ol.getMinResolution(),r=this.ol.getMaxResolution();return t<=e&&e<=r},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"showInLayerList",{get:function(){return!1!==this.options.showInLayerList},enumerable:!0,configurable:!0}),Yt.prototype.setMap=function(e){this.map=e},Yt);function Yt(e){this.options=e,this.dataSource=this.options.source,this.ol=this.createOlLayer(),this.options.zIndex!==undefined&&(this.zIndex=this.options.zIndex),this.options.baseLayer&&this.options.visible===undefined&&(this.options.visible=!1),this.visible=this.options.visible===undefined||this.options.visible,this.opacity=this.options.opacity===undefined?1:this.options.opacity,this.ol.set("_layer",this,!0)}var Zt,Jt={TITLE:"title",ABSTRACT:"abstract",CUSTOM:"custom"},Xt=(je(er,Zt=Fe.Watcher),er.prototype.watch=function(){var t=this;this.source.on("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("imageloaderror",function(e){return t.handleLoadEnd(e)})},er.prototype.unwatch=function(){var t=this;this.source.un("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("imageloaderror",function(e){return t.handleLoadEnd(e)})},er.prototype.handleLoadStart=function(e){e.image.__watchers__||(e.image.__watchers__=[]),e.image.__watchers__.push(this.id),this.loading+=1,this.status=Fe.SubjectStatus.Working},er.prototype.handleLoadEnd=function(e){if(e.image.__watchers__){var t=e.image.__watchers__.indexOf(this.id);if(!(t<0)){e.image.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=Fe.SubjectStatus.Done,this.loaded=this.loading=0)}}},er);function er(e){var t=Zt.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=Fe.uuid(),t}var tr,rr=(je(or,tr=Fe.Watcher),or.prototype.watch=function(){var t=this;this.source.on("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("tileloaderror",function(e){return t.handleLoadEnd(e)})},or.prototype.unwatch=function(){var t=this;this.source.un("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("tileloaderror",function(e){return t.handleLoadEnd(e)})},or.prototype.handleLoadStart=function(e){e.tile.__watchers__||(e.tile.__watchers__=[]),e.tile.__watchers__.push(this.id),this.loading+=1,this.status=Fe.SubjectStatus.Working},or.prototype.handleLoadEnd=function(e){if(e.tile.__watchers__){var t=e.tile.__watchers__.indexOf(this.id);if(!(t<0)){e.tile.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=Fe.SubjectStatus.Done,this.loaded=this.loading=0)}}},or);function or(e){var t=tr.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=Fe.uuid(),t}var nr,ir=(je(ar,nr=Fe.Watcher),ar.prototype.watch=function(){},ar.prototype.unwatch=function(){this.layer.onUnwatch()},ar);function ar(e){var t=nr.call(this)||this;return t.loaded=0,t.loading=0,t.layer=e,t.id=Fe.uuid(),t}function sr(e,t){var r,o,n,i,a=[],s=document.createElement("canvas").getContext("2d");s.font="20px Calibri";var l=0;try{for(var u=$e(e),c=u.next();!c.done;c=u.next()){var p=c.value;if(!1!==p.visible){var d=p.dataSource.getLegend(t)||[],g=function(e){if(e.url===undefined)return"continue";var t=p.title,r=new Image;r.crossOrigin="anonymous",r.src=e.url,r.onload=function(){s.fillText(t,0,l),s.drawImage(r,0,l+20),l+=r.height+5},a.push({title:t,url:e.url,image:r})};try{for(var h=$e(d),f=h.next();!f.done;f=h.next()){g(f.value)}}catch(y){n={error:y}}finally{try{f&&!f.done&&(i=h["return"])&&i.call(h)}finally{if(n)throw n.error}}}}}catch(m){r={error:m}}finally{try{c&&!c.done&&(o=u["return"])&&o.call(u)}finally{if(r)throw r.error}}return a}var lr,ur=(je(cr,lr=Qt),cr.prototype.createOlLayer=function(){var r=this,e=Object.assign({},this.options,{source:this.options.source.ol}),t=new I(e),o=this.options.token;return o&&t.getSource().setImageLoadFunction(function(e,t){r.customLoader(e,t,o)}),t},cr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),lr.prototype.setMap.call(this,e)},cr.prototype.customLoader=function(o,e,t){var r=new XMLHttpRequest;r.open("GET",e),r.setRequestHeader("Authorization","Bearer "+t),r.responseType="arraybuffer",r.onload=function(){var e=new Uint8Array(this.response),t=new Blob([e],{type:"image/png"}),r=window.URL.createObjectURL(t);o.getImage().src=r},r.send()},cr);function cr(e){var t=lr.call(this,e)||this;return t.watcher=new Xt(t),t.status$=t.watcher.status$,t}var pr,dr=(je(gr,pr=Qt),gr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new x(e)},gr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),pr.prototype.setMap.call(this,e)},gr);function gr(e){var t=pr.call(this,e)||this;return t.watcher=new rr(t),t.status$=t.watcher.status$,t}var hr,fr=(je(yr,hr=Qt),Object.defineProperty(yr.prototype,"browsable",{get:function(){return!1!==this.options.browsable},enumerable:!0,configurable:!0}),Object.defineProperty(yr.prototype,"exportable",{get:function(){return!1!==this.options.exportable},enumerable:!0,configurable:!0}),yr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return this.options.animation&&this.dataSource.ol.on("addfeature",function(e){this.flash(e.feature)}.bind(this)),new X(e)},yr.prototype.flash=function(c){var p=(new Date).getTime(),d=this.map.ol.on("postcompose",function g(e){var t=e.vectorContext,r=e.frameState,o=c.getGeometry().clone(),n=r.time-p,i=n/this.options.animation.duration,a=C.easeOut(1-i),s=M.asArray(this.options.animation.color||"red");s[3]=a;var l=this.ol.getStyleFunction().call(this,c)[0].clone();switch(c.getGeometry().getType()){case"Point":var u=C.easeOut(i)*(3*l.getImage().getRadius());l.getImage().setRadius(u),l.getImage().setOpacity(a);break;case"LineString":l.getImage().getStroke()&&(l.getImage().getStroke().setColor(s),l.getImage().getStroke().setWidth(C.easeOut(i)*(3*l.getImage().getStroke().getWidth()))),l.getStroke()&&(l.getStroke().setColor(s),l.getStroke().setWidth(C.easeOut(i)*(3*l.getStroke().getWidth())));break;case"Polygon":l.getImage().getFill()&&l.getImage().getFill().setColor(s),l.getFill()&&l.getFill().setColor(s)}if(t.setStyle(l),t.drawGeometry(o),n>this.options.animation.duration)return de.unByKey(d),void this.map.ol.render();this.map.ol.render()}.bind(this))},yr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),hr.prototype.setMap.call(this,e)},yr.prototype.onUnwatch=function(){this.dataSource.onUnwatch(),this.stopAnimation()},yr.prototype.stopAnimation=function(){this.dataSource.ol.un("addfeature",function(e){this.flash(e.feature)}.bind(this))},yr);function yr(e){var t=hr.call(this,e)||this;return t.watcher=new ir(t),t.status$=t.watcher.status$,t}var mr,vr=(je(br,mr=Qt),br.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new T(e)},br);function br(e){return mr.call(this,e)||this}var Sr=(wr.prototype.createStyle=function(e){return this.parseStyle("style",e)},wr.prototype.parseStyle=function(e,r){var o=this,n={},t=this.getOlCls(e);return t&&r instanceof Object?(Object.keys(r).forEach(function(e){var t=o.getOlKey(e);n[t]=o.parseStyle(e,r[e])}),new t(n)):r},wr.prototype.getOlKey=function(e){var t=e.toLowerCase();switch(t){case"circle":case"regularshape":case"icon":t="image"}return t},wr.prototype.getOlCls=function(e){var t=le[e.charAt(0).toUpperCase()+e.slice(1)];return"regularshape"===e&&(t=le.RegularShape),t},wr.prototype.createStyleByAttribute=function(e,t){var r=t.type,o=t.attribute,n=t.data,i=t.stroke,a=t.width,s=t.fill,l=t.radius,u=t.icon,c=t.scale,p=n.length,d=t.label,g=t.baseStyle;if("circle"===r){for(var h=0;h<p;h++)if(e.get(o)===n[h])return u?[new le.Style({image:new le.Icon({src:u[h],scale:c?c[h]:1})})]:[new le.Style({image:new le.Circle({radius:l?l[h]:4,stroke:new le.Stroke({color:i?i[h]:"black"}),fill:new le.Fill({color:s?s[h]:"black"})})})];if(!e.getStyle())return[new le.Style({image:new le.Circle({radius:4,stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:"#bbbbf2"})})})]}else if("regular"===r){for(h=0;h<p;h++)if(e.get(o)===n[h])return[new le.Style({stroke:new le.Stroke({color:i?i[h]:"black",width:a?a[h]:1}),fill:new le.Fill({color:s?s[h]:"rgba(255,255,255,0.4)"}),text:new le.Text({text:e.get(d),stroke:new le.Stroke({color:"black"})})})];if(!e.getStyle())return g?this.createStyle(g):[new le.Style({stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:"#bbbbf2"})})]}},wr.prototype.createClusterStyle=function(e,t){var r,o=t.clusterRange,n=t.clusterIcon,i=t.clusterScale,a=e.get("features").length;return 1!==a?(o&&(a>=o[1]?r="red":a<o[1]&&a>=o[0]?r="orange":a<o[0]&&(r="green")),[new le.Style({image:new le.Circle({radius:2*a+3.4,stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:o?r:"blue"})}),text:new le.Text({text:a.toString(),fill:new le.Fill({color:"#fff"})})})]):n?[new le.Style({image:new le.Icon({src:n,scale:i})})]:[new le.Style({image:new le.Circle({radius:2*a+3.4,stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:"blue"})})})]},wr.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],wr.ctorParameters=function(){return[]},wr.ngInjectableDef=Se.defineInjectable({factory:function(){return new wr},token:wr,providedIn:"root"}),wr);function wr(){}function Or(e){return!0===e.dataSource.options.queryable}function Fr(e){var t=e.get("_layer");return t!==undefined&&Or(t)}var Ir=(Object.defineProperty(xr.prototype,"removable",{get:function(){return!1!==this.layer.options.removable},enumerable:!0,configurable:!0}),Object.defineProperty(xr.prototype,"opacity",{get:function(){return 100*this.layer.opacity},set:function(e){this.layer.opacity=e/100},enumerable:!0,configurable:!0}),xr.prototype.ngOnInit=function(){var e=this,t=!1!==(this.layer.dataSource.options.legend||{}).collapsed;this.layer.visible&&this.expandLegendIfVisible&&(t=!1),this.toggleLegend(t),this.updateQueryBadge();var r=this.layer.map.viewController.resolution$;this.resolution$$=r.subscribe(function(){e.onResolutionChange()}),this.tooltipText=this.computeTooltip()},xr.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},xr.prototype.toggleLegend=function(e){this.showLegend$.next(!e)},xr.prototype.toggleVisibility=function(){this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()},xr.prototype.computeTooltip=function(){var e=this.layer.options;if(!e.tooltip)return this.layer.title;var t=e.tooltip,r=e.metadata;switch(e.tooltip.type){case Jt.TITLE:return this.layer.title;case Jt.ABSTRACT:return r&&r["abstract"]?r["abstract"]:this.layer.title;case Jt.CUSTOM:return t&&t.text?t.text:this.layer.title;default:return this.layer.title}},xr.prototype.onResolutionChange=function(){var e=this.layer.isInResolutionsRange;!1===e&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(e)},xr.prototype.updateQueryBadge=function(){var e=!1===this.queryBadge||!1===this.layer.visible||!Or(this.layer);this.queryBadgeHidden$.next(e)},xr.decorators=[{type:Se.Component,args:[{selector:"igo-layer-item",template:'<mat-list-item>\r\n  <mat-icon\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]="legend"\r\n    [collapsed]="!(showLegend$ | async)"\r\n    (toggle)="toggleLegend($event)"\r\n    svgIcon="chevron-up" >\r\n  </mat-icon>\r\n  <h4 matLine [matTooltip]="tooltipText" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [color]="layer.visible ? \'primary\' : \'default\'"\r\n    collapsibleButton\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="layer.visible ?\r\n                  (\'igo.geo.layer.hideLayer\' | translate) :\r\n                  (\'igo.geo.layer.showLayer\' | translate)"\r\n    (click)="toggleVisibility()">\r\n    <mat-icon\r\n      matBadge="?"\r\n      matBadgeColor="accent"\r\n      matBadgeSize="small"\r\n      matBadgePosition="after"\r\n      [matBadgeHidden]="queryBadgeHidden$ | async"\r\n      [ngClass]="{disabled: !(inResolutionRange$ | async)}"\r\n      [svgIcon]="layer.visible ? \'eye\' : \'eye-off\'">\r\n    </mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    color="primary"\r\n    igoCollapse\r\n    [target]="actions"\r\n    [collapsed]="true">\r\n    <mat-icon svgIcon="dots-horizontal"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #actions class="igo-layer-actions-container">\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <mat-slider\r\n      id="opacity-slider"\r\n      thumbLabel\r\n      tickInterval="5"\r\n      step="5"\r\n      [min]="0"\r\n      [max]="100"\r\n      [(ngModel)]="opacity"\r\n      [matTooltip]="\'igo.geo.layer.opacity\' | translate"\r\n      matTooltipShowDelay="500"\r\n      tooltip-position="below">\r\n    </mat-slider>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <div class="igo-layer-button-group">\r\n      <button\r\n        color="primary"\r\n        mat-icon-button\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.raiseLayer\' | translate"\r\n        [disabled]="!orderable || raiseDisabled"\r\n        (click)="layer.map.raiseLayer(layer)">\r\n        <mat-icon svgIcon="arrow-up"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        mat-icon-button\r\n        color="primary"\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.lowerLayer\' | translate"\r\n        [disabled]="!orderable || lowerDisabled"\r\n        (click)="layer.map.lowerLayer(layer)">\r\n        <mat-icon svgIcon="arrow-down"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        *ngIf="removable === true"\r\n        mat-icon-button\r\n        color="warn"\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.removeLayer\' | translate"\r\n        (click)="layer.map.removeLayer(layer)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n      <ng-content select="[igoLayerItemToolbar]"></ng-content>\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div #legend class="igo-layer-legend-container">\r\n  <igo-layer-legend\r\n    *ngIf="showLegend$ | async"\r\n    [layer]="layer"\r\n    [updateLegendOnResolutionChange]="updateLegendOnResolutionChange">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{overflow:hidden}.igo-layer-actions-container{width:100%;display:inline-block}.igo-layer-actions-container>div{text-align:center}.igo-layer-legend-container{padding-left:18px;width:calc(100% - 18px);display:inline-block}#opacity-slider{width:100%}.igo-layer-button-group{float:right;padding:0 3px}@media only screen and (max-width:450px),only screen and (max-height:450px){#opacity-slider{width:70%}.igo-layer-button-group{float:none}}mat-icon.disabled{color:rgba(0,0,0,.38)}.mat-badge-small .mat-badge-content{font-size:12px}"]}]}],xr.ctorParameters=function(){return[]},xr.propDecorators={layer:[{type:Se.Input}],toggleLegendOnVisibilityChange:[{type:Se.Input}],expandLegendIfVisible:[{type:Se.Input}],updateLegendOnResolutionChange:[{type:Se.Input}],orderable:[{type:Se.Input}],lowerDisabled:[{type:Se.Input}],raiseDisabled:[{type:Se.Input}],queryBadge:[{type:Se.Input}]},xr);function xr(){this.showLegend$=new fe.BehaviorSubject(!1),this.inResolutionRange$=new fe.BehaviorSubject(!0),this.queryBadgeHidden$=new fe.BehaviorSubject(!0),this.toggleLegendOnVisibilityChange=!1,this.expandLegendIfVisible=!1,this.updateLegendOnResolutionChange=!1,this.orderable=!0,this.lowerDisabled=!1,this.raiseDisabled=!1,this.queryBadge=!1}var Mr=(Tr.prototype.ngOnInit=function(){var t=this;if(!0===this.updateLegendOnResolutionChange){var e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(function(e){return t.onResolutionChange(e)})}else this.updateLegend(undefined)},Tr.prototype.ngOnDestroy=function(){this.resolution$$!==undefined&&this.resolution$$.unsubscribe()},Tr.prototype.computeItemTitle=function(t){var e=this.layer.dataSource.options;if("wms"!==e.type)return fe.of(t.title);var r=e.params.layers.split(","),o=JSON.parse(JSON.stringify(e));return o.params.layers=r.find(function(e){return e===t.title}),this.capabilitiesService.getWMSOptions(o).pipe(Oe.map(function(e){return e._layerOptionsFromCapabilities.title}))},Tr.prototype.onResolutionChange=function(e){var t=this.layer.map.viewController.getScale();this.updateLegend(t)},Tr.prototype.updateLegend=function(e){var t=this.layer.dataSource.getLegend(e);0===t.length&&0===this.legendItems$.value.length||this.legendItems$.next(t)},Tr.decorators=[{type:Se.Component,args:[{selector:"igo-layer-legend",template:'<ng-container *ngIf="legendItems$ | async as items">\r\n  <ng-container *ngIf="items.length; else noItems">\r\n    <ng-container *ngFor="let item of items">\r\n      <mat-list-item *ngIf="item.title">\r\n        <mat-icon\r\n          id="legend-toggle"\r\n          class="igo-chevron"\r\n          mat-list-avatar\r\n          igoCollapse\r\n          [target]="legend"\r\n          [collapsed]="false"\r\n          svgIcon="chevron-up">\r\n        </mat-icon>\r\n        <h4 matLine>{{computeItemTitle(item) | async}}</h4>\r\n      </mat-list-item>\r\n    \r\n      <div #legend class="igo-layer-legend" [ngClass]="{\'with-title\': item.title}">\r\n        <img\r\n          *ngIf="item.url"\r\n          src="{{(item.url | secureImage) | async}}"\r\n          alt="{{\'igo.geo.layer.loadingLegendText\' | translate}}">\r\n        <div\r\n          [ngStyle]="item.style"\r\n          [innerHTML]="item.html"\r\n          *ngIf="item.html">\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </ng-container>\r\n\r\n  <ng-template #noItems>\r\n    <small>\r\n      {{\'igo.geo.layer.noLegendText\' | translate}}\r\n    </small>\r\n  </ng-template>\r\n\r\n</ng-container>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".igo-layer-legend.with-title{padding-left:18px}"]}]}],Tr.ctorParameters=function(){return[{type:Xo}]},Tr.propDecorators={updateLegendOnResolutionChange:[{type:Se.Input}],layer:[{type:Se.Input}]},Tr);function Tr(e){this.capabilitiesService=e,this.updateLegendOnResolutionChange=!1,this.legendItems$=new fe.BehaviorSubject([])}var Cr={always:"always",never:"never","default":"default"},Lr=(Pr.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Pr.ctorParameters=function(){return[]},Pr.ngInjectableDef=Se.defineInjectable({factory:function(){return new Pr},token:Pr,providedIn:"root"}),Pr);function Pr(){this.sortedAlpha=!1,this.onlyVisible=!1,this.onlyInRange=!1,this.keywordInitialized=!1,this.sortedAlphaInitialized=!1,this.onlyVisibleInitialized=!1,this.onlyInRangeInitialized=!1}var Dr=(Object.defineProperty(jr.prototype,"layers",{get:function(){return this._layers},set:function(e){this.setLayers(e),this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"keyword",{get:function(){return this.layerListService.keyword},set:function(e){this.layerListService.keyword=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"keywordInitialized",{get:function(){return this.layerListService.keywordInitialized},set:function(e){this.layerListService.keywordInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"onlyVisible",{get:function(){return this.layerListService.onlyVisible},set:function(e){this.layerListService.onlyVisible=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"onlyVisibleInitialized",{get:function(){return this.layerListService.onlyVisibleInitialized},set:function(e){this.layerListService.onlyVisibleInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"onlyInRange",{get:function(){return this.layerListService.onlyInRange},set:function(e){this.layerListService.onlyInRange=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"onlyInRangeInitialized",{get:function(){return this.layerListService.onlyInRangeInitialized},set:function(e){this.layerListService.onlyInRangeInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"sortedAlpha",{get:function(){return this.layerListService.sortedAlpha},set:function(e){this.layerListService.sortedAlpha=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(jr.prototype,"sortedAlphaInitialized",{get:function(){return this.layerListService.sortedAlphaInitialized},set:function(e){this.layerListService.sortedAlphaInitialized=e},enumerable:!0,configurable:!0}),jr.prototype.ngOnInit=function(){var e=this;this.change$$=this.change$.pipe(Oe.debounce(function(){return 0===e.layers.length?fe.EMPTY:fe.timer(50)})).subscribe(function(){e.showToolbar$.next(e.computeShowToolbar()),e.layers$.next(e.computeLayers(e.layers.slice(0)))}),this.initLayerFilterAndSortOptions()},jr.prototype.ngOnDestroy=function(){this.change$$.unsubscribe()},jr.prototype.toggleOnlyVisible=function(){this.onlyVisible=!this.onlyVisible},jr.prototype.toggleOnlyInRange=function(){this.onlyInRange=!this.onlyInRange},jr.prototype.toggleSort=function(e){this.sortedAlpha=e},jr.prototype.clearKeyword=function(){this.keyword=undefined},jr.prototype.getLowerLayer=function(){return this.layers.filter(function(e){return!e.baseLayer}).reduce(function(e,t){return e.zIndex<t.zIndex?e:t})},jr.prototype.getUpperLayer=function(){return this.layers.filter(function(e){return!e.baseLayer}).reduce(function(e,t){return e.zIndex>t.zIndex?e:t})},jr.prototype.next=function(){this.change$.next()},jr.prototype.computeLayers=function(e){var t=this.filterLayers(e);return t=this.sortedAlpha?this.sortLayersByTitle(t):this.sortLayersByZindex(t)},jr.prototype.filterLayers=function(e){var c=this,p=this.keyword;if(this.layerFilterAndSortOptions.showToolbar===Cr.never)return e;if(!p&&!this.onlyInRange&&!this.onlyVisible)return e;var d=e.map(function(e){return e.id});return e.forEach(function(e){var t=e.options||{},r=e.dataSource.options||{},o=((t.metadata||{}).keywordList||[]).map(function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")});if(p){var n,i=p.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=r.type||"",l=new RegExp(i,"gi"),u=o.find(function(e){return l.test(e)})!==undefined;l.test(a)||p.toLowerCase()===s.toLowerCase()||u||-1<(n=d.indexOf(e.id))&&d.splice(n,1)}c.onlyVisible&&!1===e.visible&&-1<(n=d.indexOf(e.id))&&d.splice(n,1),c.onlyInRange&&!1===e.isInResolutionsRange&&-1<(n=d.indexOf(e.id))&&d.splice(n,1)}),e.filter(function(e){return-1!==d.indexOf(e.id)})},jr.prototype.sortLayersByZindex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},jr.prototype.sortLayersByTitle=function(e){return e.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0})},jr.prototype.computeShowToolbar=function(){switch(this.layerFilterAndSortOptions.showToolbar){case Cr.always:return!0;case Cr.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyInRange||this.onlyVisible)}},jr.prototype.initLayerFilterAndSortOptions=function(){this.layerFilterAndSortOptions.toolbarThreshold&&(this.thresholdToFilterAndSort=this.layerFilterAndSortOptions.toolbarThreshold),this.layerFilterAndSortOptions.keyword&&!this.keywordInitialized&&(this.keyword=this.layerFilterAndSortOptions.keyword,this.keywordInitialized=!0),this.layerFilterAndSortOptions.sortedAlpha&&!this.sortedAlphaInitialized&&(this.sortedAlpha=this.layerFilterAndSortOptions.sortedAlpha,this.sortedAlphaInitialized=!0),this.layerFilterAndSortOptions.onlyVisible&&!this.onlyVisibleInitialized&&this.hasLayerNotVisible&&(this.onlyVisible=this.layerFilterAndSortOptions.onlyVisible,this.onlyVisibleInitialized=!0),this.layerFilterAndSortOptions.onlyInRange&&!this.onlyInRangeInitialized&&this.hasLayerOutOfRange&&(this.onlyInRange=this.layerFilterAndSortOptions.onlyInRange,this.onlyInRangeInitialized=!0)},jr.prototype.setLayers=function(e){this._layers=e,this.excludeBaseLayers?(this.hasLayerNotVisible=e.find(function(e){return!1===e.visible&&!e.baseLayer})!==undefined,this.hasLayerOutOfRange=e.find(function(e){return!1===e.isInResolutionsRange&&!e.baseLayer})!==undefined):(this.hasLayerNotVisible=e.find(function(e){return!1===e.visible})!==undefined,this.hasLayerOutOfRange=e.find(function(e){return!1===e.isInResolutionsRange})!==undefined)},jr.decorators=[{type:Se.Component,args:[{selector:"igo-layer-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <mat-list-item *ngIf="showToolbar$ | async">\r\n    <ng-container>\r\n      <mat-form-field class="inputFilter" [floatLabel]="floatLabel">\r\n        <input\r\n          matInput\r\n          [placeholder]="placeholder"\r\n          [matTooltip]="\'igo.geo.layer.subsetLayersListKeyword\' | translate"\r\n          matTooltipShowDelay="500"\r\n          type="text" [(ngModel)]="keyword">\r\n        <button\r\n          mat-button\r\n          *ngIf="keyword"\r\n          matSuffix\r\n          mat-icon-button\r\n          aria-label="Clear"\r\n          color="warn"\r\n          (click)="clearKeyword()">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <button\r\n        *ngIf="!sortedAlpha"\r\n        mat-icon-button\r\n        [matTooltip]="\'igo.geo.layer.sortAlphabetically\' | translate"\r\n        matTooltipShowDelay="500"\r\n        (click)="toggleSort(true)">\r\n        <mat-icon color="primary" svgIcon="sort-alphabetical"></mat-icon>\r\n      </button>\r\n      <button\r\n        *ngIf="sortedAlpha"\r\n        mat-icon-button\r\n        [matTooltip]="\'igo.geo.layer.sortMapOrder\' | translate"\r\n        matTooltipShowDelay="500"\r\n        (click)="toggleSort(false)">\r\n        <mat-icon color="warn" svgIcon="alert"></mat-icon>\r\n      </button>\r\n      <button\r\n        mat-icon-button\r\n        [disabled]="!hasLayerNotVisible"\r\n        [matTooltip]="onlyVisible ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyVisible\' | translate)"\r\n        matTooltipShowDelay="500"\r\n        [color]="onlyVisible ? \'warn\' : \'primary\'"\r\n        (click)="toggleOnlyVisible()">\r\n        <mat-icon [svgIcon]="!onlyVisible ? \'eye\' : \'alert\'"></mat-icon>\r\n      </button>\r\n      <button\r\n        mat-icon-button\r\n        [disabled]="!hasLayerOutOfRange"\r\n        [matTooltip]="onlyInRange ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyInRange\' | translate)"\r\n        matTooltipShowDelay="500"\r\n        [color]="onlyInRange ? \'warn\' : \'primary\'"\r\n        (click)="toggleOnlyInRange()">\r\n        <mat-icon [svgIcon]="!onlyInRange ? \'playlist-check\' : \'alert\'"></mat-icon>\r\n      </button>\r\n    </ng-container>\r\n  </mat-list-item>\r\n\r\n  <ng-template ngFor let-layer let-i="index" [ngForOf]="layers$ | async">\r\n    <igo-layer-item *ngIf="!(excludeBaseLayers && layer.baseLayer)"\r\n        igoListItem\r\n        [layer]="layer"\r\n        [orderable]="orderable && !layer.baseLayer"\r\n        [lowerDisabled]="getLowerLayer().id === layer.id"\r\n        [raiseDisabled]="getUpperLayer().id === layer.id"\r\n        [queryBadge]="queryBadge"\r\n        [expandLegendIfVisible]="expandLegendOfVisibleLayers"\r\n        [updateLegendOnResolutionChange]="updateLegendOnResolutionChange"\r\n        [toggleLegendOnVisibilityChange]="toggleLegendOnVisibilityChange">\r\n\r\n        <ng-container igoLayerItemToolbar\r\n          [ngTemplateOutlet]="templateLayerToolbar"\r\n          [ngTemplateOutletContext]="{layer: layer}">\r\n        </ng-container>\r\n\r\n    </igo-layer-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:["mat-form-field.inputFilter{width:calc(100% - 100px);max-width:200px}"]}]}],jr.ctorParameters=function(){return[{type:Lr}]},jr.propDecorators={templateLayerToolbar:[{type:Se.ContentChild,args:["igoLayerItemToolbar"]}],layers:[{type:Se.Input}],placeholder:[{type:Se.Input}],floatLabel:[{type:Se.Input}],layerFilterAndSortOptions:[{type:Se.Input}],excludeBaseLayers:[{type:Se.Input}],toggleLegendOnVisibilityChange:[{type:Se.Input}],expandLegendOfVisibleLayers:[{type:Se.Input}],updateLegendOnResolutionChange:[{type:Se.Input}],queryBadge:[{type:Se.Input}]},jr);function jr(e){this.layerListService=e,this.hasLayerNotVisible=!1,this.hasLayerOutOfRange=!1,this.orderable=!0,this.thresholdToFilterAndSort=5,this.layers$=new fe.BehaviorSubject([]),this.change$=new fe.ReplaySubject(1),this.showToolbar$=new fe.BehaviorSubject(!1),this.placeholder="",this.floatLabel="auto",this.layerFilterAndSortOptions={},this.excludeBaseLayers=!1,this.toggleLegendOnVisibilityChange=!1,this.expandLegendOfVisibleLayers=!1,this.updateLegendOnResolutionChange=!1,this.queryBadge=!1}var kr=(Rr.prototype.getMap=function(){return this.map},Rr.prototype.setMap=function(e){this.map=e},Rr.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Rr.ctorParameters=function(){return[]},Rr.ngInjectableDef=Se.defineInjectable({factory:function(){return new Rr},token:Rr,providedIn:"root"}),Rr);function Rr(){}var Er=($r.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e.filter(function(e){return!0===e.showInLayerList})})},$r.prototype.ngAfterViewInit=function(){this.initRoutes()},$r.prototype.initRoutes=function(){var i=this;this.route&&(this.route.options.llcKKey||this.route.options.llcAKey||this.route.options.llcVKey||this.route.options.llcVKey)&&this.route.queryParams.subscribe(function(e){var t=e[i.route.options.llcKKey],r=e[i.route.options.llcAKey],o=e[i.route.options.llcVKey],n=e[i.route.options.llcRKey];t&&!i.layerListService.keywordInitialized&&(i.layerListService.keyword=t,i.layerListService.keywordInitialized=!0),r&&!i.layerListService.sortedAlphaInitialized&&(i.layerListService.sortedAlpha="1"===r,i.layerListService.sortedAlphaInitialized=!0),o&&!i.layerListService.onlyVisibleInitialized&&i.component.hasLayerNotVisible&&(i.layerListService.onlyVisible="1"===o,i.layerListService.onlyVisibleInitialized=!0),n&&!i.layerListService.onlyInRangeInitialized&&i.component.hasLayerOutOfRange&&(i.layerListService.onlyInRange="1"===n,i.layerListService.onlyInRangeInitialized=!0)})},$r.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},$r.decorators=[{type:Se.Directive,args:[{selector:"[igoLayerListBinding]"}]}],$r.ctorParameters=function(){return[{type:Dr,decorators:[{type:Se.Self}]},{type:kr},{type:Lr},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},$r);function $r(e,t,r,o){this.mapService=t,this.layerListService=r,this.route=o,this.component=e}var Ar=(_r.prototype.isActive=function(){return this.active},_r.prototype.activate=function(){!0===this.active&&this.doDeactivate(),this.active=!0,this.doActivate()},_r.prototype.deactivate=function(){this.active=!1,this.doDeactivate()},_r.prototype.bindStore=function(e){this.stores.indexOf(e)<0&&this.stores.push(e)},_r.prototype.unbindStore=function(e){var t=this.stores.indexOf(e);0<=t&&this.stores.splice(t,1)},_r.prototype.doActivate=function(){},_r.prototype.doDeactivate=function(){},_r);function _r(e){void 0===e&&(e={}),this.options=e,this.stores=[],this.active=!1,this.options=e}var Gr,qr=(je(Br,Gr=Ar),Br.prototype.bindStore=function(e){Gr.prototype.bindStore.call(this,e),!0===this.isActive()&&this.watchStore(e)},Br.prototype.unbindStore=function(e){Gr.prototype.unbindStore.call(this,e),!0===this.isActive()&&this.unwatchStore(e)},Br.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},Br.prototype.doDeactivate=function(){this.unwatchAll()},Br.prototype.watchStore=function(t){var r=this;if(!this.stores$$.has(t)){var e=t.view.all$().subscribe(function(e){return r.onFeaturesChange(e,t)});this.stores$$.set(t,e)}},Br.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(t.unsubscribe(),this.stores$$["delete"](e))},Br.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){e[1].unsubscribe()}),this.stores$$.clear()},Br.prototype.onFeaturesChange=function(e,t){0===e.length?t.clearLayer():t.setLayerFeatures(e,this.selectMotion(t),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},Br.prototype.selectMotion=function(e){return this.options.motion!==undefined?this.options.motion:!0===e.pristine?Kt.Default:e.count>e.view.count?Kt.Default:Kt.None},Br);function Br(e){var t=Gr.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}var Nr,Vr=(je(Ur,Nr=Ar),Ur.prototype.bindStore=function(e){Nr.prototype.bindStore.call(this,e),!0===this.isActive()&&this.watchStore(e)},Ur.prototype.unbindStore=function(e){Nr.prototype.unbindStore.call(this,e),!0===this.isActive()&&this.unwatchStore(e)},Ur.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},Ur.prototype.doDeactivate=function(){this.unwatchAll()},Ur.prototype.watchStore=function(t){var r=this;this.stores$$.has(t)||(this.onSourceChanges(t),t.layer.ol.getSource().on("change",function(e){r.onSourceChanges(t)}))},Ur.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(de.unByKey(t),this.stores$$["delete"](e))},Ur.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){de.unByKey(e[1])}),this.stores$$.clear()},Ur.prototype.onSourceChanges=function(e){var t=e.layer.ol.getSource().getFeatures();0===t.length?e.clear():e.setStoreOlFeatures(t)},Ur);function Ur(e){var t=Nr.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}var Wr,zr=(je(Kr,Wr=be.EntityStore),Object.defineProperty(Kr.prototype,"source",{get:function(){return this.layer?this.layer.dataSource:undefined},enumerable:!0,configurable:!0}),Kr.prototype.bindLayer=function(e){return this.layer=e,this},Kr.prototype.addStrategy=function(t,e){if(void 0===e&&(e=!1),this.strategies.find(function(e){return t.constructor===e.constructor})!==undefined)throw new Error("A strategy of this type already exists on that FeatureStore.");return this.strategies.push(t),t.bindStore(this),!0===e&&t.activate(),this},Kr.prototype.removeStrategy=function(e){var t=this.strategies.indexOf(e);return 0<=t&&(this.strategies.splice(t,1),e.unbindStore(this)),this},Kr.prototype.getStrategyOfType=function(t){return this.strategies.find(function(e){return e instanceof t})},Kr.prototype.activateStrategyOfType=function(e){var t=this.getStrategyOfType(e);t!==undefined&&t.activate()},Kr.prototype.deactivateStrategyOfType=function(e){var t=this.getStrategyOfType(e);t!==undefined&&t.deactivate()},Kr.prototype.setLayerFeatures=function(e,t,r,o,n){var i=this;void 0===t&&(t=Kt.Default),n=n||be.getEntityId,this.checkLayer();var a=e.map(function(e){return eo(e,i.map.projection,n)});this.setLayerOlFeatures(a,t,r,o)},Kr.prototype.setStoreOlFeatures=function(e){var t=this;this.checkLayer();var r=e.map(function(e){return e.set("_featureStore",t,!0),to(e,t.layer.map.projection)});this.load(r)},Kr.prototype.clearLayer=function(){this.checkLayer(),this.source.ol.clear()},Kr.prototype.checkLayer=function(){if(this.layer===undefined)throw new Error("This FeatureStore is not bound to a layer.")},Kr.prototype.setLayerOlFeatures=function(e,t,r,o){void 0===t&&(t=Kt.Default);var n=new Map;e.forEach(function(e){n.set(e.getId(),e)});var i=[];this.source.ol.forEachFeature(function(e){var t=n.get(e.getId());t===undefined?i.push(e):t.get("_entityRevision")!==e.get("_entityRevision")?i.push(e):n["delete"](t.getId())});var a=Array.from(n.keys()),s=e.filter(function(e){return 0<=a.indexOf(e.getId())});0<i.length&&this.removeOlFeaturesFromLayer(i),0<s.length&&this.addOlFeaturesToLayer(s),0<s.length?so(this.map,s,t,r,o):0<e.length&&so(this.map,e,t,r,o)},Kr.prototype.addOlFeaturesToLayer=function(e){var t=this;e.forEach(function(e){e.set("_featureStore",t,!0)}),this.source.ol.addFeatures(e)},Kr.prototype.removeOlFeaturesFromLayer=function(e){var t=this;e.forEach(function(e){t.source.ol.removeFeature(e)})},Kr);function Kr(e,t){var r=Wr.call(this,e,t)||this;return r.strategies=[],r.map=t.map,r}var Hr,Qr=(je(Yr,Hr=Z),Yr);function Yr(e){return Hr.call(this,e)||this}var Zr,Jr=(je(Xr,Zr=Ar),Object.defineProperty(Xr.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),Xr.prototype.bindStore=function(e){Zr.prototype.bindStore.call(this,e),!0===this.isActive()&&this.activate()},Xr.prototype.unbindStore=function(e){Zr.prototype.unbindStore.call(this,e),!0===this.isActive()&&this.activate()},Xr.prototype.unselectAll=function(){this.stores.forEach(function(e){e.state.updateAll({selected:!1})})},Xr.prototype.clear=function(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()},Xr.prototype.doActivate=function(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()},Xr.prototype.doDeactivate=function(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll(),this.removeOverlayLayer()},Xr.prototype.watchAll=function(){var t=this;this.unwatchAll();var e=this.stores.map(function(e){return e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(Oe.map(function(e){return e.map(function(e){return e.entity})}))});this.stores$$=fe.combineLatest.apply(void 0,_e(e)).pipe(Oe.debounceTime(25),Oe.skip(1),Oe.map(function(e){return e.reduce(function(e,t){return e.concat(t)})})).subscribe(function(e){return t.onSelectFromStore(e)})},Xr.prototype.unwatchAll=function(){this.stores$$!==undefined&&this.stores$$.unsubscribe()},Xr.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){t.onMapClick(e)})},Xr.prototype.unlistenToMapClick=function(){this.mapClickListener!==undefined&&this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener)},Xr.prototype.onMapClick=function(e){var r=this,t=!Mo(e),o=!t,n=e.map.getFeaturesAtPixel(e.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:function(t){return r.stores.find(function(e){return e.layer.ol===t})!==undefined}});this.onSelectFromMap(n,t,o)},Xr.prototype.addDragBoxInteraction=function(){var e,t,r,o=this,n=this.map.ol.getInteractions().getArray();try{for(var i=$e(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(s instanceof Qr){r=s;break}}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}r===undefined&&(r=new Qr({condition:Mo}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",function(e){return o.onDragBoxEnd(e)})},Xr.prototype.removeDragBoxInteraction=function(){this.olDragSelectInteractionEndKey!==undefined&&de.unByKey(this.olDragSelectInteractionEndKey),this.olDragSelectInteraction!==undefined&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=undefined},Xr.prototype.onDragBoxEnd=function(e){var t=!Mo(e.mapBrowserEvent),o=e.target.getGeometry().getExtent(),r=this.stores.reduce(function(e,t){var r=t.layer.ol.getSource();return e.push.apply(e,_e(r.getFeaturesInExtent(o))),e},[]);this.onSelectFromMap(r,t,!1)},Xr.prototype.onSelectFromStore=function(e){var t=this.options?this.options.motion:undefined,r=this.overlayStore.layer.ol.getSource().getFeatures().map(function(e){return e.getId()}),o=e.map(this.overlayStore.getKey),n=r.length!==o.length||!r.every(function(e){return 0<=o.indexOf(e)});this.overlayStore.setLayerFeatures(e,n?t:Kt.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},Xr.prototype.onSelectFromMap=function(e,r,o){var n=this,i=this.groupFeaturesByStore(e);this.stores.forEach(function(e){var t=i.get(e);t===undefined&&!0===r?n.unselectAllFeaturesFromStore(e):t===undefined&&!1===r||n.selectFeaturesFromStore(e,t,r,o)})},Xr.prototype.selectFeaturesFromStore=function(e,t,r,o){!0===o?e.state.reverseMany(t,["selected"]):e.state.updateMany(t,{selected:!0},r)},Xr.prototype.unselectAllFeaturesFromStore=function(e){e.state.updateAll({selected:!1})},Xr.prototype.groupFeaturesByStore=function(e){var n=new Map;return null===e||e===undefined||e.forEach(function(e){var t=e.get("_featureStore");if(t!==undefined){var r=n.get(t);r===undefined&&(r=[],n.set(t,r));var o=t.get(e.getId());o!==undefined&&r.push(o)}}),n},Xr.prototype.createOverlayStore=function(){var e=this.options.layer?this.options.layer:this.createOverlayLayer();return new zr([],{map:this.map}).bindLayer(e)},Xr.prototype.createOverlayLayer=function(){return new fr({zIndex:300,source:new Qe,style:undefined,showInLayerList:!1,exportable:!1,browsable:!1})},Xr.prototype.addOverlayLayer=function(){this.overlayStore.layer.map===undefined&&this.map.addLayer(this.overlayStore.layer)},Xr.prototype.removeOverlayLayer=function(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)},Xr);function Xr(e){var t=Zr.call(this,e)||this;return t.options=e,t.overlayStore=t.createOverlayStore(),t}function eo(e,t,r){r=r||be.getEntityId;var o=(new ye).readFeature(e,{dataProjection:e.projection,featureProjection:t});o.setId(r(e));var n=be.getEntityTitle(e);n!==undefined&&o.set("_title",n,!0),e.extent!==undefined&&o.set("_extent",e.extent,!0),e.projection!==undefined&&o.set("_projection",e.projection,!0),e.extent!==undefined&&o.set("_extent",e.extent,!0);var i=be.getEntityProperty(e,"meta.mapTitle");return i!==undefined&&o.set("_mapTitle",i,!0),o.set("_entityRevision",be.getEntityRevision(e),!0),o}function to(r,e,t,o){var n;void 0===o&&(o="EPSG:4326");var i=new ye,a=r.getKeys().filter(function(e){return!e.startsWith("_")&&"geometry"!==e}).reduce(function(e,t){return e[t]=r.get(t),e},{}),s=i.writeGeometryObject(r.getGeometry(),{dataProjection:o,featureProjection:e});n=t?t.get("title"):r.get("_title");var l=r.get("_mapTitle"),u=r.getId();return{type:zt,projection:o,extent:r.get("_extent"),meta:{id:u,title:n||(l||u),mapTitle:l,revision:r.getRevision()},properties:a,geometry:s}}function ro(e,t){var r=pe.createEmpty(),o=t.get("_extent"),n=t.get("_projection");if(o!==undefined&&n!==undefined)r=se.transformExtent(o,n,e.projection);else{var i=t.getGeometry();null!==i&&(r=i.getExtent())}return r}function oo(r,e){var o=pe.createEmpty();return e.forEach(function(e){var t=ro(r,e);pe.extend(o,t)}),o}function no(e,t){var r=Ae(pe.getSize(e),2),o=r[0],n=r[1];return[t[3]?e[0]-o*t[3]:e[0],t[2]?e[1]-n*t[2]:e[1],t[1]?e[2]+o*t[1]:e[2],t[0]?e[3]+n*t[0]:e[3]]}function io(e,t){var r=e.getExtent(),o=no(r,[-1,-1,-1,-1].map(function(e){return.05*e}));return!pe.containsExtent(o,t)}function ao(e,t,r){r=r||.004;var o=e.getExtent(),n=pe.getArea(o);return pe.getArea(t)/n<r}function so(e,t,r,o,n){void 0===r&&(r=Kt.Default);var i=oo(e,t),a=i;o!==undefined&&(a=no(a,o)),r===Kt.Zoom?e.viewController.zoomToExtent(a):r===Kt.Move?e.viewController.moveToExtent(a):r===Kt.Default&&(io(e,i)||ao(e,i,n))&&e.viewController.zoomToExtent(a)}function lo(e,t){e.layer===undefined&&(t=t||new fr({source:new Qe}),e.bindLayer(t)),e.layer.map===undefined&&e.map.addLayer(e.layer)}function uo(e,t){e.getStrategyOfType(qr)===undefined?(t=t||new qr({}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(qr)}function co(e,t){e.getStrategyOfType(Jr)===undefined?(t=t||new Jr({map:e.map}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(Jr)}function po(){var e=new Qe;return new fr({title:"Overlay",zIndex:300,source:e,style:function t(){var r,o=function i(){var e=new le.Stroke({width:2,color:[0,161,222,1]}),t=new le.Stroke({color:[0,161,222,.15]});return new le.Style({stroke:e,fill:t,image:new le.Circle({radius:5,stroke:e,fill:t}),text:new le.Text({font:"12px Calibri,sans-serif",fill:new le.Fill({color:"#000"}),stroke:new le.Stroke({color:"#fff",width:3}),overflow:!0})})}(),n=go();return function(e){if("bufferFeature"===e.getId())return r=function a(e,t,r,o){void 0===e&&(e=[0,161,222,1]);void 0===t&&(t=2);void 0===r&&(r=[0,161,222,.15]);var n=new le.Stroke({width:t,color:e}),i=new le.Stroke({color:r});return new le.Style({stroke:n,fill:i,image:new le.Circle({radius:5,stroke:n,fill:i}),text:new le.Text({font:"12px Calibri,sans-serif",text:o,fill:new le.Fill({color:"#000"}),stroke:new le.Stroke({color:"#fff",width:3}),overflow:!0})})}(e.get("bufferStroke"),2,e.get("bufferFill"),e.get("bufferText"));var t=e.getGeometry().getType();return(r="Point"===t?n:o).getText().setText(e.get("_mapTitle")),r}}()})}function go(e){var t;switch(void 0===e&&(e="blue"),e){case"blue":case"red":case"yellow":case"green":t=e;break;default:t="blue"}return new le.Style({image:new le.Icon({src:"./assets/igo2/geo/icons/place_"+t+"_36px.svg",imgSize:[36,36],anchor:[.5,1]}),text:new le.Text({font:"12px Calibri,sans-serif",fill:new le.Fill({color:"#000"}),stroke:new le.Stroke({color:"#fff",width:3}),overflow:!0})})}var ho=(Object.defineProperty(fo.prototype,"dataSource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),fo.prototype.setMap=function(e){e===undefined?this.map!==undefined&&this.map.ol.removeLayer(this.layer.ol):e.ol.addLayer(this.layer.ol),this.map=e},fo.prototype.setFeatures=function(e,t){void 0===t&&(t=Kt.Default),this.clear(),this.addFeatures(e,t)},fo.prototype.addFeature=function(e,t){void 0===t&&(t=Kt.Default),this.addFeatures([e],t)},fo.prototype.addFeatures=function(e,t){var r=this;void 0===t&&(t=Kt.Default);var o=[];e.forEach(function(e){var t=eo(e,r.map.projection);null!==t.getGeometry()&&o.push(t)}),this.addOlFeatures(o,t)},fo.prototype.addOlFeature=function(e,t){void 0===t&&(t=Kt.Default),this.addOlFeatures([e],t)},fo.prototype.addOlFeatures=function(e,t){void 0===t&&(t=Kt.Default),this.dataSource.ol.addFeatures(e),so(this.map,e,t)},fo.prototype.clear=function(){this.dataSource.ol.clear()},fo);function fo(e){this.layer=po(),this.setMap(e)}var yo,mo=(je(vo,yo=Fe.Watcher),vo.prototype.watch=function(){},vo.prototype.unwatch=function(){var t=this;this.layers.forEach(function(e){return t.unwatchLayer(e)},this)},vo.prototype.watchLayer=function(e){var t=this;if(e.status$!==undefined){this.layers.push(e);var r=e.status$.pipe(Oe.distinctUntilChanged()).subscribe(function(e){e===Fe.SubjectStatus.Working?t.loading+=1:e===Fe.SubjectStatus.Done&&(t.loaded+=1),t.loaded>=t.loading?(t.loading=t.loaded=0,t.status=Fe.SubjectStatus.Done):0<t.loading&&(t.status=Fe.SubjectStatus.Working)});this.subscriptions.push(r)}},vo.prototype.unwatchLayer=function(e){var t=this.layers.indexOf(e);if(0<=t){var r=e.watcher.status;-1!==[Fe.SubjectStatus.Working,Fe.SubjectStatus.Waiting].indexOf(r)&&(this.loaded+=1),this.subscriptions[t].unsubscribe(),this.subscriptions.splice(t,1),this.layers.splice(t,1),e.watcher.unwatch()}},vo);function vo(){var e=yo.call(this)||this;return e.loaded=0,e.loading=0,e.layers=[],e.subscriptions=[],e}var bo={Move:0,Zoom:1};function So(e,t){var r,o,n,i,a,s,l,u,c,p,d,g,h,f,y,m,v,b,S,w,O,F,I,x,M,T,C,L,P,D,j=new RegExp("(;[\\d]{4,6})","g"),k="([-+])?([\\d]{1,3})([,.](\\d+))?",R=k+"[\\s,.]\\s*"+k,E=new RegExp("^"+R+"$","g"),$="([0-9]{1,2})[:|°]?\\s*([0-9]{1,2})?[:|'|′|’]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|″|”]?\\s*",A=$+"([N|S]),?\\s*"+$+"([E|W])",_=new RegExp("^"+A,"gi"),G="(UTM|MTM)-?(\\d{1,2})[\\s,.]*(\\d+[\\s.,]?\\d+)[\\s,.]+(\\d+[\\s.,]?\\d+)",q=new RegExp("^"+G,"gi"),B="([-+])?(\\d{1,3})[,.](\\d+)",N=B+"[,.]?\\s*"+B,V=new RegExp("^"+N,"g"),U="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",W=U+"[,.]?\\s*"+U,z=new RegExp("^"+W,"g"),K="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",H=new RegExp("^"+K+"?","gi"),Q="([-+]?\\d+)[,.]?(\\d+)?",Y=Q+"[\\s,.]\\s*"+Q,Z=new RegExp("^"+Y+"$","g");if(e=e.toLocaleUpperCase(),j.test(e)?(d=(r=Ae(e.split(";"),2))[0],D=r[1]):d=e,E.test(d))g=(o=Ae(d.match(R),9))[1],L=o[2],v=o[4],b=o[5],P=o[6],I=o[8],L=parseFloat((g||"")+L+"."+v),P=parseFloat((b||"")+P+"."+I);else if(_.test(d))h=(n=Ae(d.match(A),9))[1],f=n[2],y=n[3],m=n[4],S=n[5],w=n[6],O=n[7],F=n[8],L=wo(parseFloat(h),parseFloat(f),parseFloat(y),m),P=wo(parseFloat(S),parseFloat(w),parseFloat(O),F);else if(q.test(d)){x=(i=Ae(d.match(G),5))[1],M=i[2],L=i[3],P=i[4];L=(a=Ae(ee(("+proj="+x+" +zone="+M).toLocaleLowerCase(),"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs",[parseFloat(L),parseFloat(P)]),2))[0],P=a[1]}else if(z.test(d))g=(s=Ae(d.match(W),11))[1],h=s[2],f=s[3],y=s[4],v=s[5],b=s[6],S=s[7],w=s[8],O=s[9],I=s[10],L=wo(parseFloat((g||"")+h),parseFloat(f),parseFloat(y),m),P=wo(parseFloat((b||"")+S),parseFloat(w),parseFloat(O),F);else if(V.test(d))g=(l=Ae(d.match(N),7))[1],h=l[2],v=l[3],b=l[4],S=l[5],I=l[6],L=wo(parseFloat((g||"")+h),parseFloat(f),parseFloat(y),m),P=wo(parseFloat((b||"")+S),parseFloat(w),parseFloat(O),F);else if(H.test(d))b=(u=Ae(d.match(K),15))[1],S=u[2],w=u[3],O=u[4],F=u[6],g=u[7],h=u[8],f=u[9],y=u[10],m=u[12],T=u[13],C=u[14],m=m||"W",L=f&&2<f.length?parseFloat((g||"")+h+"."+f):wo(parseFloat(h),parseFloat(f),parseFloat(y),m),P=w&&2<w.length?parseFloat((b||"")+S+"."+w):wo(parseFloat(S),parseFloat(w),parseFloat(O),F);else{if(!Z.test(d))return{lonLat:undefined,message:"",radius:undefined,conf:undefined};L=(c=Ae(d.match(Y),5))[1],v=c[2],P=c[3],I=c[4],v&&(L=parseFloat(L+"."+v)),I&&(P=parseFloat(P+"."+I))}if(0<L&&0<P&&(P<L?L=-L:P=-P),p=L<P?[L,P]:[P,L],D!==undefined&&"4326"!==D||180<p[0]||p[0]<-180){var J=D?"EPSG:"+D:t;try{p=se.transform(p,J,"EPSG:4326")}catch(X){return{lonLat:undefined,message:"Projection "+J+" not supported",radius:undefined,conf:undefined}}}return{lonLat:p,message:"",radius:T?parseInt(T,10):undefined,conf:C?parseInt(C,10):undefined}}function wo(e,t,r,o){var n=e+(t=t||0)/60+(r=r||0)/3600;return"S"!==o&&"W"!==o||(n=-n),n}function Oo(e,t){if(e===undefined||t===undefined)return!1;return e.zoom===t.zoom&&Math.trunc(e.center[0]/1e-4)===Math.trunc(t.center[0]/1e-4)&&Math.trunc(e.center[1]/1e-4)===Math.trunc(t.center[1]/1e-4)}function Fo(e){return(e=Math.round(e))<1e4?e+"":(e=Math.round(e/1e3))<1e3?e+"K":(e=Math.round(e/1e3))+"M"}function Io(e,t){return void 0===t&&(t=72),e/(39.37*t)}function xo(e,t,r){return void 0===t&&(t="m"),void 0===r&&(r=72),e*se.METERS_PER_UNIT[t]*39.37*r}function Mo(e){var t=e.originalEvent;return!t.altKey&&(L.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey}bo[bo.Move]="Move",bo[bo.Zoom]="Zoom";var To=(Co.prototype.getOlMap=function(){return this.olMap},Co.prototype.setOlMap=function(e){if(e!==undefined&&this.getOlMap()!==undefined)throw new Error("This controller is already bound to a map.");if(e===undefined)return this.teardownObservers(),void(this.olMap=e);this.olMap=e},Co.prototype.teardownObservers=function(){this.observerKeys.forEach(function(e){return de.unByKey(e)}),this.observerKeys=[]},Co);function Co(){this.observerKeys=[]}var Lo,Po=(je(Do,Lo=To),Object.defineProperty(Do.prototype,"stateHistory",{get:function(){return!!this.options&&!0===this.options.stateHistory},enumerable:!0,configurable:!0}),Object.defineProperty(Do.prototype,"olView",{get:function(){return this.olMap.getView()},enumerable:!0,configurable:!0}),Do.prototype.setOlMap=function(e){Lo.prototype.setOlMap.call(this,e),this.setupObservers()},Do.prototype.setupObservers=function(){var t=this;!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",function(e){return t.onMoveEnd(e)})),this.extent$$=this.extent$.pipe(Oe.debounceTime(25)).subscribe(function(e){t.setExtent(e.extent,e.action)})},Do.prototype.teardownObservers=function(){Lo.prototype.teardownObservers.call(this),this.extent$$!==undefined&&(this.extent$$.unsubscribe(),this.extent$$=undefined)},Do.prototype.getOlProjection=function(){return this.olView.getProjection()},Do.prototype.getCenter=function(e){var t=this.olView.getCenter();return e&&t&&(t=se.transform(t,this.getOlProjection(),e)),t},Do.prototype.getExtent=function(e){var t=this.olView.calculateExtent(this.olMap.getSize());return e&&t&&(t=se.transformExtent(t,this.getOlProjection(),e)),t},Do.prototype.getScale=function(e){return void 0===e&&(e=72),xo(this.getResolution(),this.getOlProjection().getUnits(),e)},Do.prototype.getResolution=function(){return this.olView.getResolution()},Do.prototype.getZoom=function(){return Math.round(this.olView.getZoom())},Do.prototype.zoomIn=function(){this.zoomTo(this.olView.getZoom()+1)},Do.prototype.zoomOut=function(){this.zoomTo(this.olView.getZoom()-1)},Do.prototype.zoomTo=function(e){this.olView.animate({zoom:e,duration:250,easing:C.easeOut})},Do.prototype.moveToExtent=function(e){this.extent$.next({extent:e,action:bo.Move})},Do.prototype.zoomToExtent=function(e){this.extent$.next({extent:e,action:bo.Zoom})},Do.prototype.getRotation=function(){return this.olView.getRotation()},Do.prototype.resetRotation=function(){this.olView.animate({rotation:0})},Do.prototype.hasPreviousState=function(){return 1<this.states.length&&0<this.stateIndex},Do.prototype.hasNextState=function(){return 1<this.states.length&&this.stateIndex<this.states.length-1},Do.prototype.previousState=function(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)},Do.prototype.nextState=function(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)},Do.prototype.clearStateHistory=function(){this.states=[],this.stateIndex=0},Do.prototype.setInitialState=function(){0<this.states.length&&this.setStateIndex(0)},Do.prototype.setExtent=function(e,t){var r=this.olView;t===bo.Zoom?r.fit(e,{maxZoom:17}):t===bo.Move&&r.fit(e,{maxZoom:r.getZoom()})},Do.prototype.setStateIndex=function(e){this.stateIndex=e,this.setState(this.states[e])},Do.prototype.setState=function(e){this.olView.animate({resolution:e.resolution,center:e.center,duration:0})},Do.prototype.onMoveEnd=function(e){var t=this.getResolution();this.resolution$.value!==t&&this.resolution$.next(t);var r={resolution:t,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){var o=this.stateIndex;Oo(r,0===this.states.length?undefined:this.states[o])||(this.states=this.states.slice(0,o+1).concat([r]),this.stateIndex=this.states.length-1)}this.state$.next(r)},Do);function Do(e){var t=Lo.call(this)||this;return t.options=e,t.resolution$=new fe.BehaviorSubject(undefined),t.state$=new fe.BehaviorSubject(undefined),t.extent$=new fe.Subject,t.states=[],t.stateIndex=0,t}var jo=(Object.defineProperty(ko.prototype,"layers",{get:function(){return this.layers$.value},enumerable:!0,configurable:!0}),Object.defineProperty(ko.prototype,"projection",{get:function(){return this.viewController.getOlProjection().getCode()},enumerable:!0,configurable:!0}),ko.prototype.init=function(){var e=[];if(this.options.controls){if(this.options.controls.attribution){var t=!0===this.options.controls.attribution?{}:this.options.controls.attribution;e.push(new w(t))}if(this.options.controls.scaleLine){var r=!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine;e.push(new O(r))}}var o={};!1===this.options.interactions&&(o={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new m({interactions:ce.defaults(o),controls:e}),this.setView(this.options.view||{}),this.viewController=new Po({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new ho(this),this.buffer=new ho(this)},ko.prototype.setTarget=function(e){this.ol.setTarget(e),e!==undefined?this.layerWatcher.subscribe(function(){},null):this.layerWatcher.unsubscribe()},ko.prototype.updateView=function(e){var t=this.ol.getView(),r=Object.assign({zoom:t.getZoom()},t.getProperties());this.setView(Object.assign(r,e))},ko.prototype.setView=function(e){this.viewController!==undefined&&this.viewController.clearStateHistory();var t=new v(e);if(this.ol.setView(t),this.unsubscribeGeolocate(),e){if(e.center){var r=t.getProjection().getCode(),o=se.fromLonLat(e.center,r);t.setCenter(o)}e.geolocate&&this.geolocate(!0)}},ko.prototype.getCenter=function(e){return this.viewController.getCenter()},ko.prototype.getExtent=function(e){return this.viewController.getExtent()},ko.prototype.getZoom=function(){return this.viewController.getZoom()},ko.prototype.changeBaseLayer=function(e){var t,r;if(e){try{for(var o=$e(this.getBaseLayers()),n=o.next();!n.done;n=o.next())n.value.visible=!1}catch(i){t={error:i}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}e.visible=!0}},ko.prototype.getBaseLayers=function(){return this.layers.filter(function(e){return!0===e.baseLayer})},ko.prototype.getLayerById=function(t){return this.layers.find(function(e){return e.id&&e.id===t})},ko.prototype.getLayerByAlias=function(t){return this.layers.find(function(e){return e.alias&&e.alias===t})},ko.prototype.addLayer=function(e,t){void 0===t&&(t=!0),this.addLayers([e])},ko.prototype.addLayers=function(e,t){var r=this;void 0===t&&(t=!0);var o=e.map(function(e){return r.doAddLayer(e)}).filter(function(e){return e!==undefined});this.setLayers([].concat(this.layers,o))},ko.prototype.removeLayer=function(e){this.removeLayers([e])},ko.prototype.removeLayers=function(e){var r=this,o=this.layers$.value.slice(0),n=[];e.forEach(function(e){var t=r.getLayerIndex(e);0<=t&&(n.push(e),o.splice(t,1))}),n.forEach(function(e){return r.doRemoveLayer(e)}),this.setLayers(o)},ko.prototype.removeAllLayers=function(){var t=this;this.layers.forEach(function(e){return t.doRemoveLayer(e)}),this.layers$.next([])},ko.prototype.raiseLayer=function(e){var t=this.getLayerIndex(e);0<t&&this.moveLayer(e,t,t-1)},ko.prototype.lowerLayer=function(e){var t=this.getLayerIndex(e);t<this.layers.length-1&&this.moveLayer(e,t,t+1)},ko.prototype.moveLayer=function(e,t,r){var o=this.layers[r],n=o.zIndex,i=e.zIndex;n<10||(e.zIndex=n,o.zIndex=i,this.layers[r]=e,this.layers[t]=o,this.layers$.next(this.layers.slice(0)))},ko.prototype.doAddLayer=function(e){e.baseLayer&&e.visible&&this.changeBaseLayer(e);var t=this.getLayerById(e.id);if(t===undefined){if(e.zIndex===undefined||0===e.zIndex){var r=e.baseLayer?1:10;e.zIndex=this.layers.length+r}return e.setMap(this),this.layerWatcher.watchLayer(e),this.ol.addLayer(e.ol),e}t.visible=!0},ko.prototype.doRemoveLayer=function(e){this.layerWatcher.unwatchLayer(e),this.ol.removeLayer(e.ol),e.setMap(undefined)},ko.prototype.setLayers=function(e){this.layers$.next(this.sortLayersByZIndex(e).slice(0))},ko.prototype.sortLayersByZIndex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},ko.prototype.getLayerIndex=function(t){return this.layers.findIndex(function(e){return e===t})},ko.prototype.geolocate=function(u){var c=this;void 0===u&&(u=!1);var p=!0;this.geolocation$$&&(u=this.geolocation.getTracking(),this.unsubscribeGeolocate()),this.startGeolocation(),this.geolocation$$=this.geolocation$.subscribe(function(e){if(e){if(e.getAccuracy()<414e4){var t=e.getAccuracyGeometry(),r=t.getExtent();if(c.geolocationFeature&&c.overlay.dataSource.ol.getFeatureById(c.geolocationFeature.getId())&&c.overlay.dataSource.ol.removeFeature(c.geolocationFeature),c.geolocationFeature=new ie({geometry:t}),c.geolocationFeature.setId("geolocationFeature"),c.overlay.addOlFeature(c.geolocationFeature),c.ol.getView().options_.buffer){var o=c.ol.getView().options_.buffer.bufferRadius,n=e.getPosition();c.bufferGeom=new F(n,o);var i=c.ol.getView().options_.buffer.bufferStroke,a=c.ol.getView().options_.buffer.bufferFill,s=void 0;s=c.ol.getView().options_.buffer.showBufferRadius?o.toString()+"m":"",c.bufferFeature=new ie(c.bufferGeom),c.bufferFeature.setId("bufferFeature"),c.bufferFeature.set("bufferStroke",i),c.bufferFeature.set("bufferFill",a),c.bufferFeature.set("bufferText",s),c.buffer.addOlFeature(c.bufferFeature)}p&&c.viewController.zoomToExtent(r)}else if(p){var l=c.ol.getView();n=e.getPosition(),l.setCenter(n),l.setZoom(14)}u&&c.unsubscribeGeolocate(),p=!1}})},ko.prototype.unsubscribeGeolocate=function(){this.stopGeolocation(),this.geolocation$$&&(this.geolocation$$.unsubscribe(),this.geolocation$$=undefined)},ko.prototype.startGeolocation=function(){var t=this;this.geolocation?this.geolocation.setTracking(!0):(this.geolocation=new S({projection:this.projection,tracking:!0}),this.geolocation.on("change",function(e){t.geolocation$.next(t.geolocation)}))},ko.prototype.stopGeolocation=function(){this.geolocation&&this.geolocation.setTracking(!1)},ko);function ko(e){this.layers$=new fe.BehaviorSubject([]),this.geolocation$=new fe.BehaviorSubject(undefined),this.defaultOptions={controls:{attribution:!1}},this.options=Object.assign({},this.defaultOptions,e),this.layerWatcher=new mo,this.status$=this.layerWatcher.status$,P.register(ee),this.init()}var Ro=(Object.defineProperty(Eo.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e,this.map!==undefined&&this.map.updateView(e)},enumerable:!0,configurable:!0}),Eo.prototype.ngOnInit=function(){var t=this;this.status$$=this.map.status$.subscribe(function(e){return t.handleStatusChange(e)})},Eo.prototype.ngAfterViewInit=function(){this.map.setTarget(this.id)},Eo.prototype.ngOnDestroy=function(){this.map.setTarget(undefined),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()},Eo.prototype.handleStatusChange=function(e){e===Fe.SubjectStatus.Working&&this.activityId===undefined?this.activityId=this.activityService.register():e===Fe.SubjectStatus.Done&&this.activityId!==undefined&&(this.activityService.unregister(this.activityId),this.activityId=undefined)},Eo.decorators=[{type:Se.Component,args:[{selector:"igo-map-browser",template:'<div [id]="id" class="igo-map-browser-target"></div>\r\n<ng-content></ng-content>\r\n',styles:[":host{position:relative;display:block}.igo-map-browser-target,:host{width:100%;height:100%}:host>>>igo-zoom-button{position:absolute;bottom:5px;right:5px}:host>>>igo-geolocate-button{position:absolute;bottom:95px;right:5px}:host>>>igo-rotation-button{position:absolute;top:calc(40px + 5px + 5px);right:5px}:host>>>igo-user-button{position:absolute;bottom:5px;right:calc(5px + 50px)}:host>>>igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}:host.igo-attribution-offset>>>.ol-attribution{left:90px;width:calc(100% - 200px)}@media only screen and (max-width:450px),only screen and (max-height:450px){:host>>>igo-zoom-button{display:none}:host>>>igo-geolocate-button{bottom:5px}:host>>>igo-rotation-button{top:calc(40px + 5px + 5px)}:host>>>igo-user-button{right:calc(5px + 90px)}:host.igo-attribution-offset>>>.ol-attribution{left:50px}}:host>>>.ol-attribution{left:5px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:rgba(255,255,255,0);width:calc(100% - 100px)}:host>>>.ol-attribution.ol-logo-only{height:inherit}:host>>>.ol-attribution.ol-collapsed{background:0 0}:host>>>.ol-attribution.ol-collapsed button{transform:none}:host>>>.ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer}:host>>>.ol-scale-line-inner{color:#000;border-color:#000}:host>>>.ol-scale-line{background-color:rgba(255,255,255,0);bottom:4px;transform:translate(-50%);left:50%}:host>>>canvas{display:block}"]}]}],Eo.ctorParameters=function(){return[{type:Ie.ActivityService}]},Eo.propDecorators={map:[{type:Se.Input}],view:[{type:Se.Input}]},Eo);function Eo(e){this.activityService=e,this.id="igo-map-target-"+(new Date).getTime()}var $o=(Object.defineProperty(Ao.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Ao.prototype.ngAfterViewInit=function(){var t=this;this.networkService.currentState().subscribe(function(e){t.state=e,t.changeLayer()}),this.map.layers$.subscribe(function(e){t.changeLayer()})},Ao.prototype.changeLayer=function(){var t,r=this;this.map.layers$.value.forEach(function(e){if("mvt"===e.options.sourceOptions.type)t=e.options.sourceOptions,e.ol.getSource().clear();else if("xyz"===e.options.sourceOptions.type)t=e.options.sourceOptions;else if("vector"===e.options.sourceOptions.type)t=e.options.sourceOptions;else if("cluster"===e.options.sourceOptions.type)t=e.options.sourceOptions;else{if(!1===r.state.connection)return void e.ol.setMaxResolution(0);if(!0===r.state.connection)return void e.ol.setMaxResolution(Infinity)}if(t.pathOffline&&!1===r.state.connection){if("vector"===t.type)return;if("cluster"===t.type)return;e.ol.getSource().setUrl(t.pathOffline)}else if(t.pathOffline&&!0===r.state.connection){if("vector"===t.type)return;if("cluster"===t.type)return;e.ol.getSource().setUrl(t.url)}else!1===r.state.connection?e.ol.setMaxResolution(0):!0===r.state.connection&&e.ol.setMaxResolution(Infinity)})},Ao.decorators=[{type:Se.Directive,args:[{selector:"[igoMapOffline]"}]}],Ao.ctorParameters=function(){return[{type:Ro},{type:Ie.NetworkService}]},Ao);function Ao(e,t){this.networkService=t,this.component=e}var _o=(Go.prototype.registerProjection=function(e){ee.defs(e.code,e.def),P.register(ee),se.get(e.code).setExtent(e.extent)},Go.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Go.ctorParameters=function(){return[{type:Ie.ConfigService}]},Go.ngInjectableDef=Se.defineInjectable({factory:function(){return new Go(Se.inject(Ie.ConfigService))},token:Go,providedIn:"root"}),Go);function Go(e){var t=this;this.config=e,(this.config.getConfig("projections")||[]).forEach(function(e){t.registerProjection(e)})}var qo=(Object.defineProperty(Bo.prototype,"zoom",{get:function(){return this.map.viewController.getZoom()},enumerable:!0,configurable:!0}),Bo.decorators=[{type:Se.Component,args:[{selector:"igo-zoom-button",template:'<div class="igo-zoom-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomIn\' | translate: {zoom: zoom + 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.viewController.zoomIn()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomOut\' | translate: {zoom: zoom - 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.viewController.zoomOut()">\r\n    <mat-icon svgIcon="minus"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-zoom-button-container{width:40px}.igo-zoom-button-container button{background-color:#fff}.igo-zoom-button-container button:hover{background-color:#efefef}.igo-zoom-button-container button:first-child{margin-bottom:2px}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],Bo.ctorParameters=function(){return[]},Bo.propDecorators={map:[{type:Se.Input}],color:[{type:Se.Input}]},Bo);function Bo(){}var No=(Object.defineProperty(Vo.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Vo.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Vo.decorators=[{type:Se.Component,args:[{selector:"igo-geolocate-button",template:'<div class="igo-geolocate-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.geolocate\' | translate"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.geolocate()">\r\n    <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-geolocate-button-container{width:40px;background-color:#fff}.igo-geolocate-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],Vo.ctorParameters=function(){return[]},Vo.propDecorators={map:[{type:Se.Input}],color:[{type:Se.Input}]},Vo);function Vo(){}function Uo(){return D.trigger("baseLayerSwitcherState",[D.state("collapseIcon",D.style({height:"40px",width:"40px",overflow:"hidden"})),D.state("collapseMap",D.style({height:"85px",overflow:"hidden"})),D.state("expand",D.style({overflow:"hidden"})),D.transition("collapse => expand",D.animate("200ms")),D.transition("expand => collapse",D.animate("200ms"))])}var Wo=(Object.defineProperty(zo.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(zo.prototype,"useStaticIcon",{get:function(){return this._useStaticIcon},set:function(e){this._useStaticIcon=e},enumerable:!0,configurable:!0}),zo.prototype.ngAfterViewInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t._baseLayers=e.filter(function(e){return e.baseLayer})})},zo.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},zo.prototype.collapseOrExpand=function(){1<this.baseLayers.length||this.useStaticIcon?this.expand=!this.expand:this.expand=!1},Object.defineProperty(zo.prototype,"baseLayers",{get:function(){var t=this.map.viewController.getResolution(),e=this._baseLayers.filter(function(e){return(!e.options.maxResolution||t<=e.options.maxResolution)&&(!e.options.minResolution||t>=e.options.minResolution)}),r=e.filter(function(e){return!e.visible});return r.length+1===e.length?r:e},enumerable:!0,configurable:!0}),zo.decorators=[{type:Se.Component,args:[{selector:"igo-baselayers-switcher",template:'<div *ngIf="baseLayers.length > 0"\r\n     class="igo-baselayers-switcher-container"\r\n     [ngClass]="{\'container-expand\': expand}"\r\n     [@baseLayerSwitcherState]="expand ? \'expand\' : useStaticIcon ? \'collapseIcon\' : \'collapseMap\'"\r\n     (@baseLayerSwitcherState.start)="showButton=false"\r\n     (@baseLayerSwitcherState.done)="showButton=true"\r\n     (click)="collapseOrExpand()">\r\n\r\n     <div *ngIf="useStaticIcon && !expand && showButton" class="igo-baselayers-switcher-button-container">\r\n       <button\r\n         mat-icon-button\r\n         [matTooltip]="\'igo.geo.mapButtons.baselayerSwitcher\' | translate"\r\n         matTooltipPosition="right"\r\n         color="primary">\r\n         <mat-icon svgIcon="photo-library"></mat-icon>\r\n       </button>\r\n     </div>\r\n\r\n     <igo-mini-basemap *ngFor="let baseLayer of baseLayers; let i = index"\r\n       [map]="map"\r\n       [baseLayer]="baseLayer"\r\n       [display]="expand || (i === 0 && !useStaticIcon)"\r\n       [disabled]="!expand && baseLayers.length > 1">\r\n     </igo-mini-basemap>\r\n\r\n    <div class="more-baselayers">\r\n      <mat-icon class="material-icons mat-icon mat-list-avatar" color="primary" svgIcon="menu-down"></mat-icon>\r\n    </div>\r\n\r\n</div>\r\n',animations:[Uo()],styles:[".igo-baselayers-switcher-container{height:auto;position:relative}.container-expand{overflow:hidden;border-width:0}.more-baselayers{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers:hover{background-color:#efefef}.igo-baselayers-switcher-button-container{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],zo.ctorParameters=function(){return[{type:Ie.MediaService}]},zo.propDecorators={map:[{type:Se.Input}],useStaticIcon:[{type:Se.Input}]},zo);function zo(e){this.mediaService=e,this._baseLayers=[],this.expand=!1,this.showButton=!0,this.mediaService.media$.value===Ie.Media.Mobile&&this.useStaticIcon===undefined&&(this.useStaticIcon=!0)}var Ko=(Object.defineProperty(Ho.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e,this.handleMoveEnd()},enumerable:!0,configurable:!0}),Object.defineProperty(Ho.prototype,"baseLayer",{get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this.handleBaseLayerChanged(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ho.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ho.prototype,"display",{get:function(){return this._display},set:function(e){this._display=e},enumerable:!0,configurable:!0}),Ho.prototype.ngAfterViewInit=function(){var e=this;this.map.ol.on("moveend",function(){return e.handleMoveEnd()}),this.handleMoveEnd()},Ho.prototype.ngOnDestroy=function(){var e=this;this.map.ol.un("moveend",function(){return e.handleMoveEnd()})},Ho.prototype.changeBaseLayer=function(e){this.disabled||(this.map.changeBaseLayer(e),this.appRef.tick())},Ho.prototype.handleMoveEnd=function(){this.basemap.ol.setView(this.map.ol.getView())},Ho.prototype.handleBaseLayerChanged=function(e){this.basemap.removeAllLayers();var t=Object.assign(Object.create(e.options),e.options);t.visible=!0;var r=this.layerService.createLayer(t);this.basemap.addLayer(r)},Ho.decorators=[{type:Se.Component,args:[{selector:"igo-mini-basemap",template:'<div class="igo-mini-basemap-container">\r\n\r\n  <div *ngIf="display" (click)="changeBaseLayer(baseLayer)">\r\n    <igo-map-browser [map]="basemap"></igo-map-browser>\r\n    <div class=\'igo-mini-basemap-title\'>{{baseLayer.title}}</div>\r\n  </div>\r\n\r\n</div>\r\n',styles:[".igo-mini-basemap-container{width:calc(40px * 2);height:calc(40px * 2);background-color:rgba(255,255,255,.01);border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.3);cursor:pointer;margin-top:5px}.igo-mini-basemap-container:hover .igo-mini-basemap-title{color:#000;text-shadow:0 0 5px #fff}.igo-mini-basemap-container>div{width:100%;height:100%}.igo-mini-basemap-title{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px #000;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"]}]}],Ho.ctorParameters=function(){return[{type:on},{type:Se.ApplicationRef}]},Ho.propDecorators={map:[{type:Se.Input}],baseLayer:[{type:Se.Input}],disabled:[{type:Se.Input}],display:[{type:Se.Input}]},Ho);function Ho(e,t){this.layerService=e,this.appRef=t,this.basemap=new jo({controls:{},interactions:!1})}var Qo=(Object.defineProperty(Yo.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yo.prototype,"showIfNoRotation",{get:function(){return this._showIfNoRotation},set:function(e){this._showIfNoRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yo.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yo.prototype,"rotated",{get:function(){return 0!==this.map.viewController.getRotation()},enumerable:!0,configurable:!0}),Yo.prototype.rotationStyle=function(e){return{transform:"rotate("+e+"rad)"}},Yo.decorators=[{type:Se.Component,args:[{selector:"igo-rotation-button",template:'<div *ngIf="rotated && !showIfNoRotation" class="igo-rotation-button-container"\r\n  [matTooltip]="rotated ? (\'igo.geo.mapButtons.resetRotation\' | translate): (\'igo.geo.mapButtons.tipRotation\' | translate)"\r\n  matTooltipPosition="left">\r\n  <button mat-icon-button matTooltipPosition="left" [color]="color" [disabled]="!rotated"\r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>\r\n\r\n<div *ngIf="showIfNoRotation" class="igo-rotation-button-container"\r\n  [matTooltip]="rotated ? (\'igo.geo.mapButtons.resetRotation\' | translate): (\'igo.geo.mapButtons.tipRotation\' | translate)"\r\n  matTooltipPosition="left">\r\n  <button mat-icon-button matTooltipPosition="left" [color]="color" [disabled]="!rotated"\r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>',styles:[".igo-rotation-button-container{width:40px;background-color:#fff}.igo-rotation-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}@media only screen and (max-width:450px),only screen and (max-height:450px){:host>>>button .mat-button-ripple-round:disabled,button:disabled{display:none}}"]}]}],Yo.ctorParameters=function(){return[]},Yo.propDecorators={map:[{type:Se.Input}],showIfNoRotation:[{type:Se.Input}],color:[{type:Se.Input}]},Yo);function Yo(){}var Zo=(Jo._convertPointToPixel=function(e){return e/.75},Jo._transformColor=function(e){return[e[0],e[1],e[2],e[3]/255]},Jo._getResolutionForScale=function(e,t){var r=se.METERS_PER_UNIT[t];return parseFloat(e)/(39.37*r*(25.4/.28))},Jo._convertEsriTS=function(e){var t=Jo._transformAngle(e.angle),r=e.text!==undefined?e.text:undefined;return new le.Style({text:new le.Text({fill:new le.Fill({color:Jo._transformColor(e.color)}),font:e.font.style+" "+e.font.weight+" "+e.font.size+" px "+e.font.family,textBaseline:e.verticalAlignment,textAlign:e.horizontalAlignment,offsetX:Jo._convertPointToPixel(e.xoffset),offsetY:Jo._convertPointToPixel(e.yoffset),rotation:t,text:r})})},Jo._convertEsriPMS=function(e){var t="data:"+e.contentType+";base64, "+e.imageData,r=Jo._transformAngle(e.angle);return new le.Style({image:new le.Icon({src:t,rotation:r})})},Jo._convertEsriSFS=function(e){var t=new le.Fill({color:Jo._transformColor(e.color)}),r=e.outline?Jo._convertOutline(e.outline):undefined;return new le.Style({fill:t,stroke:r})},Jo._convertOutline=function(e){var t,r=Jo._transformColor(e.color);return"esriSLSDash"===e.style?t=[5]:"esriSLSDashDot"===e.style?t=[5,5,1,2]:"esriSLSDashDotDot"===e.style?t=[5,5,1,2,1,2]:"esriSLSDot"===e.style?t=[1,2]:"esriSLSNull"===e.style&&(r[3]=0),new le.Stroke({color:r,lineDash:t,width:Jo._convertPointToPixel(e.width)})},Jo._convertEsriSLS=function(e){return new le.Style({stroke:Jo._convertOutline(e)})},Jo._transformAngle=function(e){if(0===e||e===undefined)return undefined;var t=-e*Math.PI/180+Math.PI/2;return t<0?2*Math.PI+t:t},Jo._convertEsriSMS=function(e){var t=new le.Fill({color:Jo._transformColor(e.color)}),r=e.outline?Jo._convertOutline(e.outline):undefined,o=Jo._convertPointToPixel(e.size)/2,n=Jo._transformAngle(e.angle);return"esriSMSCircle"===e.style?new le.Style({image:new le.Circle({radius:o,fill:t,stroke:r})}):"esriSMSCross"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:0,rotation:n})}):"esriSMSDiamond"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,rotation:n})}):"esriSMSSquare"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,angle:Math.PI/4,rotation:n})}):"esriSMSX"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:Math.PI/4,rotation:n})}):"esriSMSTriangle"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:3,radius:o,angle:0,rotation:n})}):void 0},Jo.prototype._convertLabelingInfo=function(e,t){for(var r=[],o=0,n=e.length;o<n;++o){var i=e[o].labelExpression,a=i.substr(i.indexOf("[")+1,i.indexOf("]")-1),s=e[o].symbol,l=e[o].maxScale,u=e[o].minScale,c=null;0!==l&&(c=Jo._getResolutionForScale(l,t));var p=null;0!==u&&(p=Jo._getResolutionForScale(u,t));var d=this._converters[s.type].call(this,s);r.push(function(e,t){var r=!0;if(null!==this.minResolution&&null!==this.maxResolution?r=t<this.maxResolution&&t>=this.minResolution:null!==this.minResolution?r=t>=this.minResolution:null!==this.maxResolution&&(r=t<this.maxResolution),r){var o=e.get(this.field);return this.style.getText().setText(o),[this.style]}}.bind({minResolution:c,maxResolution:p,field:a,style:d}))}return r},Jo.prototype._renderSimple=function(e){var t=this._converters[e.symbol.type].call(this,e.symbol);return function(){return[t]}},Jo.prototype._renderClassBreaks=function(e){for(var t=e.defaultSymbol,n=this._converters[t.type].call(this,t),i=e.field,a=[],r=0,o=e.classBreakInfos.length;r<o;++r){var s=e.classBreakInfos[r],l=void 0;l=null===s.classMinValue||s.classMinValue===undefined?0===r?e.minValue:e.classBreakInfos[r-1].classMaxValue:s.classMinValue;var u=s.classMaxValue,c=s.symbol,p=this._converters[c.type].call(this,c);a.push({min:l,max:u,style:p})}return function(e){for(var t=e.get(i),r=0,o=a.length;r<o;++r)if(0===r?t>=a[r].min&&t<=a[r].max:t>a[r].min&&t<=a[r].max)return[a[r].style];return[n]}},Jo.prototype._renderUniqueValue=function(e){var t=e.defaultSymbol,i=[];t&&(i=[this._converters[t.type].call(this,t)]);var a=e.field1,s=e.uniqueValueInfos,l=this;return function(){for(var r={},e=0,t=s.length;e<t;++e){var o=s[e],n=o.symbol;r[o.value]=[l._converters[n.type].call(l,n)]}return function(e){var t=r[e.get(a)];return t||i}}()},Jo.prototype.generateStyle=function(e,t){var r=e.drawingInfo,a=[],o=this._renderers[r.renderer.type].call(this,r.renderer);if(o!==undefined&&a.push(o),e.labelingInfo){var n=this._convertLabelingInfo(e.labelingInfo,t);a=a.concat(n)}return 1===a.length?a[0]:function(e,t){for(var r=[],o=0,n=a.length;o<n;++o){var i=a[o].call(null,e,t);i&&(r=r.concat(i))}return r}},Jo);function Jo(){this._converters={},this._converters.esriPMS=Jo._convertEsriPMS,this._converters.esriSFS=Jo._convertEsriSFS,this._converters.esriSLS=Jo._convertEsriSLS,this._converters.esriSMS=Jo._convertEsriSMS,this._converters.esriTS=Jo._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}var Xo=(en.prototype.getWMSOptions=function(t){var r=this,e=t.url,o=t.params.version;return this.getCapabilities("wms",e,o).pipe(Oe.map(function(e){return r.parseWMSOptions(t,e)}))},en.prototype.getWMTSOptions=function(t){var r=this,e=t.url,o=t.version;return this.getCapabilities("wmts",e,o).pipe(Oe.map(function(e){return r.parseWMTSOptions(t,e)}))},en.prototype.getCartoOptions=function(t){var r=this,e="https://"+t.account+".carto.com/api/v2/viz/"+t.mapId+"/viz.json";return this.http.jsonp(e,"callback").pipe(Oe.map(function(e){return r.parseCartoOptions(t,e)}))},en.prototype.getArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url.replace("FeatureServer","MapServer")+"/legend?f=json",n=this.http.get(e),i=this.http.get(o).pipe(Oe.map(function(e){return e}),Oe.catchError(function(e){return console.log("No legend associated with this Feature Service"),fe.of(e)}));return fe.forkJoin([n,i]).pipe(Oe.map(function(e){return r.parseArcgisOptions(t,e[0],e[1])}))},en.prototype.getTileArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url+"/legend?f=json",n=this.http.get(e),i=this.http.get(o);return fe.forkJoin([n,i]).pipe(Oe.map(function(e){return r.parseTileArcgisOptions(t,e[0],e[1])}))},en.prototype.getCapabilities=function(t,e,r){var o=this,n=new we.HttpParams({fromObject:{request:"GetCapabilities",service:t,version:r||"1.3.0"}});return this.http.get(e,{params:n,responseType:"text"}).pipe(Oe.map(function(e){return o.parsers[t].read(e)}))},en.prototype.parseWMSOptions=function(e,t){var r=e.params.layers,o=this.findDataSourceInCapabilities(t.Capability.Layer,r);if(!o)return e;var n=o.DataURL?o.DataURL[0]:undefined,i=o.Abstract?o.Abstract:undefined,a=o.KeywordList?o.KeywordList:undefined,s=o.queryable,l=this.getTimeFilter(o),u=l&&0<Object.keys(l).length,c=Fe.ObjectUtils.removeUndefined({_layerOptionsFromCapabilities:{title:o.Title,maxResolution:Io(o.MaxScaleDenominator)||Infinity,minResolution:Io(o.MinScaleDenominator)||0,metadata:{url:n?n.OnlineResource:undefined,extern:!!n||undefined,"abstract":i,keywordList:a}},queryable:s,timeFilter:u?l:undefined,timeFilterable:!!u||undefined});return Fe.ObjectUtils.mergeDeep(c,e)},en.prototype.parseWMTSOptions=function(e,t){var r=y.optionsFromCapabilities(t,e);return Object.assign(r,e)},en.prototype.parseCartoOptions=function(e,t){var r=[],o=t.layers[1].options.layer_definition;o.layers.forEach(function(e){r.push({type:e.type.toLowerCase(),options:e.options,legend:e.legend})});var n=Fe.ObjectUtils.removeUndefined({config:{version:o.version,layers:r}});return Fe.ObjectUtils.mergeDeep(n,e)},en.prototype.parseArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new Zo,s="esriMeters"===t.units?"m":"degrees",l=a.generateStyle(t,s),u=new w({html:t.copyrightText});if(t.timeInfo){var c=t.timeInfo.timeExtent;o=c[0]+","+c[1];var p=new Date;p.setTime(c[0]);var d=new Date;d.setTime(c[1]),n={min:p.toUTCString(),max:d.toUTCString(),range:!0,type:"datetime",style:"calendar"}}var g=Object.assign({},{legendInfo:i,style:l,timeFilter:n,timeExtent:o,attributions:u}),h=Fe.ObjectUtils.removeUndefined({params:g});return Fe.ObjectUtils.mergeDeep(h,e)},en.prototype.parseTileArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new w({html:t.copyrightText});if(t.timeInfo){var s=t.timeInfo.timeExtent;o=s[0]+","+s[1];var l=new Date;l.setTime(s[0]);var u=new Date;u.setTime(s[1]),n={min:l.toUTCString(),max:u.toUTCString(),range:!0,type:"datetime",style:"calendar"}}var c=Object.assign({},{layers:"show:"+e.layer,time:o}),p=Fe.ObjectUtils.removeUndefined({params:c,legendInfo:i,timeFilter:n,attributions:a});return Fe.ObjectUtils.mergeDeep(p,e)},en.prototype.findDataSourceInCapabilities=function(e,t){var r,o=this;return Array.isArray(e)?(e.find(function(e){return(r=o.findDataSourceInCapabilities(e,t))!==undefined},this),r):e.Layer?this.findDataSourceInCapabilities(e.Layer,t):e.Name&&e.Name===t?e:undefined},en.prototype.getTimeFilter=function(e){var t;if(e.Dimension){var r={};if((t=e.Dimension[0]).values){var o=t.values.split("/");r.min=o[0]!==undefined?o[0]:undefined,r.max=o[1]!==undefined?o[1]:undefined,r.step=o[2]!==undefined?o[2]:undefined}return t["default"]&&(r.value=t["default"]),r}},en.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],en.ctorParameters=function(){return[{type:we.HttpClient}]},en.ngInjectableDef=Se.defineInjectable({factory:function(){return new en(Se.inject(we.HttpClient))},token:en,providedIn:"root"}),Re([f.Cacheable(),Ee("design:type",Function),Ee("design:paramtypes",[String,String,String]),Ee("design:returntype",fe.Observable)],en.prototype,"getCapabilities",null),en);function en(e){this.http=e,this.capabilitiesStore=[],this.parsers={wms:new ge.WMSCapabilities,wmts:new ge.WMTSCapabilities}}var tn=(rn.prototype.createAsyncDataSource=function(e){if(!e.type)throw console.error(e),new Error("Datasource needs a type");var t;switch(e.type.toLowerCase()){case"osm":t=this.createOSMDataSource(e);break;case"vector":t=this.createFeatureDataSource(e);break;case"wfs":t=this.createWFSDataSource(e);break;case"wms":t=this.createWMSDataSource(e);break;case"wmts":t=this.createWMTSDataSource(e);break;case"xyz":t=this.createXYZDataSource(e);break;case"carto":t=this.createCartoDataSource(e);break;case"arcgisrest":t=this.createArcGISRestDataSource(e);break;case"websocket":t=this.createWebSocketDataSource(e);break;case"mvt":t=this.createMVTDataSource(e);break;case"tilearcgisrest":t=this.createTileArcGISRestDataSource(e);break;case"cluster":t=this.createClusterDataSource(e);break;default:throw console.error(e),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([t])),t},rn.prototype.createOSMDataSource=function(t){return new fe.Observable(function(e){return e.next(new Je(t))})},rn.prototype.createFeatureDataSource=function(t){return new fe.Observable(function(e){return e.next(new Qe(t))})},rn.prototype.createWebSocketDataSource=function(t){return new fe.Observable(function(e){return e.next(new _t(t))})},rn.prototype.createWFSDataSource=function(t){var r=this;return new fe.Observable(function(e){return e.next(new ht(t,r.wfsDataSourceService))})},rn.prototype.createWMSDataSource=function(t){var r=this;return t.optionsFromCapabilities?this.capabilitiesService.getWMSOptions(t).pipe(Oe.map(function(e){return new Ot(e,r.wfsDataSourceService)})):new fe.Observable(function(e){return e.next(new Ot(t,r.wfsDataSourceService))})},rn.prototype.createWMTSDataSource=function(t){return t.optionsFromCapabilities?this.capabilitiesService.getWMTSOptions(t).pipe(Oe.map(function(e){return new Mt(e)})):new fe.Observable(function(e){return e.next(new Mt(t))})},rn.prototype.createXYZDataSource=function(t){return new fe.Observable(function(e){return e.next(new tt(t))})},rn.prototype.createCartoDataSource=function(t){return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe(Oe.map(function(e){return new Lt(e)})):new fe.Observable(function(e){return e.next(new Lt(t))})},rn.prototype.createArcGISRestDataSource=function(e){return this.capabilitiesService.getArcgisOptions(e).pipe(Oe.map(function(e){return new jt(e)}))},rn.prototype.createTileArcGISRestDataSource=function(e){return this.capabilitiesService.getTileArcgisOptions(e).pipe(Oe.map(function(e){return new Et(e)}))},rn.prototype.createMVTDataSource=function(t){return new fe.Observable(function(e){return e.next(new Bt(t))})},rn.prototype.createClusterDataSource=function(t){return new fe.Observable(function(e){return e.next(new Ut(t))})},rn.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],rn.ctorParameters=function(){return[{type:Xo},{type:mt}]},rn.ngInjectableDef=Se.defineInjectable({factory:function(){return new rn(Se.inject(Xo),Se.inject(mt))},token:rn,providedIn:"root"}),rn);function rn(e,t){this.capabilitiesService=e,this.wfsDataSourceService=t,this.datasources$=new fe.BehaviorSubject([])}var on=(nn.prototype.createLayer=function(e){if(e.source){var t;switch(e.source.options&&e.source.options.optionsFromCapabilities&&(e=Fe.ObjectUtils.mergeDeep(e.source.options._layerOptionsFromCapabilities||{},e||{})),e.source.constructor){case Je:case Mt:case tt:case Lt:case Et:t=this.createTileLayer(e);break;case Qe:case ht:case jt:case _t:case Ut:t=this.createVectorLayer(e);break;case Ot:t=this.createImageLayer(e);break;case Bt:t=this.createVectorTileLayer(e)}return t}},nn.prototype.createAsyncLayer=function(t){var r=this;return t.source?new fe.Observable(function(e){return e.next(r.createLayer(t))}):this.dataSourceService.createAsyncDataSource(t.sourceOptions).pipe(Oe.map(function(e){return t.source=e,r.createLayer(t)}))},nn.prototype.createImageLayer=function(e){return this.tokenKey&&(e.token=localStorage.getItem(this.tokenKey)),new ur(e)},nn.prototype.createTileLayer=function(e){return new dr(e)},nn.prototype.createVectorLayer=function(t){var e;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.source instanceof jt)e=t.source.options.params.style;else if(t.styleByAttribute){var r=this.styleService;return t.style=function(e){return r.createStyleByAttribute(e,t.styleByAttribute)},new fr(t)}if(t.source instanceof Ut){var o=this.styleService;return t.style=function(e){return o.createClusterStyle(e,t.clusterParam)},new fr(t)}var n=Object.assign({},t,{style:e});return new fr(n)},nn.prototype.createVectorTileLayer=function(t){var e;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.styleByAttribute){var r=this.styleService;return t.style=function(e){return r.createStyleByAttribute(e,t.styleByAttribute)},new vr(t)}var o=Object.assign({},t,{style:e});return new vr(o)},nn.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],nn.ctorParameters=function(){return[{type:Sr},{type:tn},{type:Ie.ConfigService,decorators:[{type:Se.Optional}]}]},nn.ngInjectableDef=Se.defineInjectable({factory:function(){return new nn(Se.inject(Sr),Se.inject(tn),Se.inject(Ie.ConfigService,8))},token:nn,providedIn:"root"}),nn);function nn(e,t,r){this.styleService=e,this.dataSourceService=t,this.config=r,this.config&&(this.tokenKey=this.config.getConfig("auth.tokenKey"))}var an={Layer:"layer",Group:"group"},sn=(ln.prototype.query=function(e,t){var r=this;return e.filter(function(e){return e.visible&&e.isInResolutionsRange}).map(function(e){return r.queryLayer(e,t)})},ln.prototype.queryLayer=function(r,o){var n=this,i=this.getQueryUrl(r.dataSource,o);if(!i)return fe.of([]);if(r.dataSource.options.queryFormat!==St.HTMLGML2)return this.http.get(i,{responseType:"text"}).pipe(Oe.map(function(e){return n.extractData(e,r,o,i)}));var e=this.getQueryUrl(r.dataSource,o,!0);return this.http.get(e,{responseType:"text"}).pipe(Oe.mergeMap(function(e){var t=n.mergeGML(e,i);return n.http.get(i,{responseType:"text"}).pipe(Oe.map(function(e){return n.extractData(e,r,o,i,t)}))}))},ln.prototype.mergeGML=function(e,t){var r=new j,o=r.readFeatures(e);0===o.length&&(o=(r=new ge.WMSGetFeatureInfo).readFeatures(e));var n,i,a,s=new ae.MultiLineString([]),l=[],u=new ae.MultiPolygon([]),c=o.length,p=this.getQueryParams(t.toLowerCase()).bbox.split(","),d=pe.createEmpty();switch(pe.extend(d,p),o.map(function(e){var t=e.getGeometry().getCoordinates(),r=e.getGeometry().getType();switch(i=i||r,r){case"Point":1===c?n=new ae.Point(t,"XY"):l.push(t);break;case"LineString":s.appendLineString(new ae.LineString(t,"XY"));break;case"Polygon":u.appendPolygon(new ae.Polygon(t,"XY"));break;case"MultiPolygon":u=new ae.MultiPolygon(t,"XY");break;default:return}}),a=0===l.length&&n?{type:n.getType(),coordinates:n.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(l)]},i){case"LineString":return{type:s.getType(),coordinates:s.getCoordinates()};case"Point":return a;case"Polygon":case"MultiPolygon":return{type:u.getType(),coordinates:u.getCoordinates()};default:return}},ln.prototype.cross=function(e,t,r){return(e[0]-r[0])*(t[1]-r[1])-(e[1]-r[1])*(t[0]-r[0])},ln.prototype.convexHull=function(e){var t,r;e.sort(function(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]});var o=[];try{for(var n=$e(e),i=n.next();!i.done;i=n.next()){for(var a=i.value;2<=o.length&&this.cross(o[o.length-2],o[o.length-1],a)<=0;)o.pop();o.push(a)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}for(var s=[],l=e.length-1;0<=l;l--){for(;2<=s.length&&this.cross(s[s.length-2],s[s.length-1],e[l])<=0;)s.pop();s.push(e[l])}return s.pop(),o.pop(),o.concat(s)},ln.prototype.extractData=function(e,n,i,t,r){var o,a=n.dataSource;n.options&&n.options.sourceOptions&&n.options.sourceOptions.sourceFields&&1<=n.options.sourceOptions.sourceFields.length&&(o={},n.options.sourceOptions.sourceFields.forEach(function(e){var t=e.alias?e.alias:e.name;o[e.name]=t}));var s=[];switch(a.options.queryFormat){case St.GML3:s=this.extractGML3Data(e,n.zIndex,o);break;case St.JSON:case St.GEOJSON:s=this.extractGeoJSONData(e);break;case St.ESRIJSON:s=this.extractEsriJSONData(e,n.zIndex);break;case St.TEXT:s=this.extractTextData(e);break;case St.HTML:s=this.extractHtmlData(e,a.queryHtmlTarget,t);break;case St.HTMLGML2:s=this.extractHtmlData(e,a.queryHtmlTarget,t,r);break;case St.GML2:default:s=this.extractGML2Data(e,n,o)}return s.map(function(e,t){var r=e.properties[a.queryTitle];r=!r&&1<s.length?n.title+" ("+(t+1)+")":r||n.title;var o=Object.assign({},e.meta||{},{id:Fe.uuid(),title:r,mapTitle:r,sourceTitle:n.title,order:1e3-n.zIndex});return Object.assign(e,{meta:o,projection:"carto"===a.options.type?"EPSG:4326":i.projection})})},ln.prototype.extractGML2Data=function(e,t,r){var o=this,n=new j,i=n.readFeatures(e);return 0===i.length&&(i=(n=new ge.WMSGetFeatureInfo).readFeatures(e)),i.map(function(e){return o.featureToResult(e,t,r)})},ln.prototype.extractGML3Data=function(e,t,r){var o=this;return(new k).readFeatures(e).map(function(e){return o.featureToResult(e,t,r)})},ln.prototype.extractGeoJSONData=function(e){var t=[];try{t=JSON.parse(e).features}catch(r){console.warn("query.service: Unable to parse geojson","\n",e)}return t},ln.prototype.extractEsriJSONData=function(e,t){var r=this;return(new R).readFeatures(e).map(function(e){return r.featureToResult(e,t)})},ln.prototype.extractTextData=function(e){return[]},ln.prototype.extractHtmlData=function(e,t,r,o){var n=this.getQueryParams(r.toLowerCase()),i=n.bbox,a=parseInt(n.width,10),s=parseInt(n.height,10),l=parseInt(n.i||n.x,10),u=parseInt(n.j||n.y,10),c=n.crs||n.srs||"EPSG:3857",p=i.split(","),d=.05*(Math.abs(parseFloat(p[0]))-Math.abs(parseFloat(p[2])));Math.abs(parseFloat(p[0]))<180&&(d=.045);var g=parseFloat(p[0])+Math.abs(parseFloat(p[0])-parseFloat(p[2]))*l/a-d,h=parseFloat(p[1])+Math.abs(parseFloat(p[1])-parseFloat(p[3]))*u/s-d,f=g+2*d,y=h+2*d,m="POLYGON(("+g+" "+h+", "+g+" "+y+", "+f+" "+y+", "+f+" "+h+", "+g+" "+h+"))",v=(new ge.WKT).readFeature(m).getGeometry();t!==wt.BLANK&&t!==wt.IFRAME&&(t=wt.IFRAME);var b=e.toLowerCase().indexOf("<body>"),S=e.toLowerCase().lastIndexOf("</body>")+7;return"<body></body>"===e.slice(b,S).replace(/(\r|\n|\s)/g,"")||""===e?[]:[{type:zt,projection:c,properties:{target:t,body:e,url:r},geometry:o||{type:v.getType(),coordinates:v.getCoordinates()}}]},ln.prototype.getQueryParams=function(e){var t=e.split("?");if(t[1]){var r=t[1].split("&"),o={};return r.forEach(function(e){e=e.split("="),o[e[0]]=decodeURIComponent(e[1]||"")}),o}},ln.prototype.featureToResult=function(e,t,r){var o,n=e.getGeometry(),i=Object.assign({},e.getProperties());return delete i.geometry,delete i.boundedBy,delete i.shape,delete i.SHAPE,delete i.the_geom,n!==undefined&&(o={type:n.getType(),coordinates:n.getCoordinates()}),{type:zt,projection:undefined,properties:i,geometry:o,meta:{id:Fe.uuid(),order:1e3-t,alias:r}}},ln.prototype.getQueryUrl=function(e,t,r){var o;switch(void 0===r&&(r=!1),e.constructor){case Ot:var n=e,i={INFO_FORMAT:n.params.info_format||this.getMimeInfoFormat(e.options.queryFormat),QUERY_LAYERS:n.params.layers,FEATURE_COUNT:n.params.feature_count||"5"};r&&(i.INFO_FORMAT=this.getMimeInfoFormat(St.GML2)),o=n.ol.getGetFeatureInfoUrl(t.coordinates,t.resolution,t.projection,i),"1.3.0"!==n.params.version&&(o=(o=o.replace("&I=","&X=")).replace("&J=","&Y="));break;case Lt:var a=e,s="https://"+a.options.account+".carto.com/api/v2/sql?",l="&q="+a.options.config.layers[0].options.sql,u=a.options.queryPrecision?a.options.queryPrecision:"1000";o=s+"format=GeoJSON"+l+" WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT("+t.coordinates[0]+","+t.coordinates[1]+"),3857),"+u+"))";break;case Et:var c=e,p=pe.boundingExtent([t.coordinates]);c.options.queryPrecision&&(p=pe.buffer(p,c.options.queryPrecision)),o=c.options.url+"/"+c.options.layer+"/query/?"+["f=json","geometry="+encodeURIComponent('{"xmin":'+p[0]+',"ymin":'+p[1]+',"xmax":'+p[2]+',"ymax":'+p[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}return o},ln.prototype.getMimeInfoFormat=function(e){var t;switch(e){case St.GML2:t="application/vnd.ogc.gml";break;case St.GML3:t="application/vnd.ogc.gml/3.1.1";break;case St.JSON:t="application/json";break;case St.GEOJSON:t="application/geojson";break;case St.TEXT:t="text/plain";break;case St.HTML:case St.HTMLGML2:t="text/html";break;default:t="application/vnd.ogc.gml"}return t},ln.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],ln.ctorParameters=function(){return[{type:we.HttpClient}]},ln.ngInjectableDef=Se.defineInjectable({factory:function(){return new ln(Se.inject(we.HttpClient))},token:ln,providedIn:"root"}),ln);function ln(e){this.http=e,this.queryEnabled=!0}var un=(Object.defineProperty(cn.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),cn.prototype.ngAfterViewInit=function(){this.listenToMapClick()},cn.prototype.ngOnDestroy=function(){this.cancelOngoingQueries(),this.unlistenToMapClick()},cn.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onMapEvent(e)})},cn.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},cn.prototype.onMapEvent=function(r){var o=this;if(this.cancelOngoingQueries(),this.queryService.queryEnabled){var e=[];this.queryFeatures&&e.push(this.doQueryFeatures(r));var t=this.map.ol.getView().getResolution(),n=this.map.layers.filter(Or);e.push.apply(e,_e(this.queryService.query(n,{coordinates:r.coordinate,projection:this.map.projection,resolution:t}))),0!==e.length&&(this.waitForAllQueries?this.queries$$.push(fe.zip.apply(void 0,_e(e)).subscribe(function(e){var t=[].concat.apply([],_e(e));o.query.emit({features:t,event:r})})):this.queries$$=e.map(function(e){return e.subscribe(function(e){o.query.emit({features:e,event:r})})}))}},cn.prototype.doQueryFeatures=function(e){var r,o=this,n=[];return this.map.ol.forEachFeatureAtPixel(e.pixel,function(e,t){e&&e.get("features")&&(e=e.get("features")[0]),r=to(e,o.map.projection,t),n.push(r)},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:Fr}),fe.of(n)},cn.prototype.cancelOngoingQueries=function(){this.queries$$.forEach(function(e){return e.unsubscribe()}),this.queries$$=[]},cn.decorators=[{type:Se.Directive,args:[{selector:"[igoQuery]"}]}],cn.ctorParameters=function(){return[{type:Ro,decorators:[{type:Se.Self}]},{type:sn}]},cn.propDecorators={queryFeatures:[{type:Se.Input}],queryFeaturesHitTolerance:[{type:Se.Input}],queryFeaturesCondition:[{type:Se.Input}],waitForAllQueries:[{type:Se.Input}],query:[{type:Se.Output}]},cn);function cn(e,t){this.component=e,this.queryService=t,this.queries$$=[],this.queryFeatures=!1,this.queryFeaturesHitTolerance=0,this.waitForAllQueries=!0,this.query=new Se.EventEmitter}var pn=(dn.prototype.getId=function(){throw new Error('You have to implement the method "getId".')},dn.prototype.getDefaultOptions=function(){throw new Error('You have to implement the method "getDefaultOptions".')},Object.defineProperty(dn.prototype,"title",{get:function(){return this.options.title},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"available",{get:function(){return!1!==this.options.available},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"enabled",{get:function(){return this.available&&!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"searchUrl",{get:function(){return this.options.searchUrl},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"params",{get:function(){return this.options.params===undefined?{}:this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"settings",{get:function(){return this.options.settings===undefined?[]:this.options.settings},enumerable:!0,configurable:!0}),dn.prototype.setParamFromSetting=function(r){var e,o=this;switch(r.type){case"radiobutton":r.values.forEach(function(e){var t;e.enabled&&(o.options.params=Object.assign(o.options.params||{},((t={})[r.name]=e.value,t)))});break;case"checkbox":var t="";r.values.forEach(function(e){e.enabled&&(t+=e.value+",")}),t=t.slice(0,-1),this.options.params=Object.assign(this.options.params||{},((e={})[r.name]=t,e))}},Object.defineProperty(dn.prototype,"displayOrder",{get:function(){return this.options.order===undefined?99:this.options.order},enumerable:!0,configurable:!0}),dn.prototype.hashtagValid=function(e,r,o){void 0===o&&(o=!1);var n=!1;return e.values.forEach(function(e){var t=new RegExp(""+r.substring(1),"g");"string"==typeof e.value&&(o&&e.value===r.substring(1)||!o&&e.value.match(t))&&(n=!0)}),n},dn.prototype.getSettingsValues=function(t){return this.getDefaultOptions().settings.find(function(e){return e.name===t})},dn.id="",dn.type="",dn);function dn(e){var t=this;this.options=Object.assign({},this.getDefaultOptions(),e),this.settings.forEach(function(e){t.setParamFromSetting(e)})}var gn,hn=(je(fn,gn=pn),fn.prototype.getId=function(){return fn.id},fn.prototype.getDefaultOptions=function(){return{title:"Carte"}},fn.id="map",fn.type=zt,fn.decorators=[{type:Se.Injectable}],fn.ctorParameters=function(){return[{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},fn);function fn(e){return gn.call(this,e)||this}var yn=(mn.prototype.loadCatalogs=function(){var e=this.config.getConfig("context")||{},t=this.config.getConfig("catalog")||{},r=t.url||e.url,o=t.sources||[];if(r===undefined)return fe.of(o);var n=[];if(t.baseLayers){var i={id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:r+"/baselayers",type:"baselayers"};n.push(fe.of(i))}var a=this.http.get(r+"/catalogs").pipe(Oe.catchError(function(e){return fe.EMPTY}));return n.push(a),0<o.length&&n.push(fe.of(o)),fe.concat.apply(void 0,_e(n))},mn.prototype.loadCatalogItems=function(e){return"baselayers"===e.type?this.loadCatalogBaseLayerItems(e):"wmts"===e.type?this.loadCatalogWMTSLayerItems(e):this.loadCatalogWMSLayerItems(e)},mn.prototype.loadCatalogBaseLayerItems=function(r){return this.getCatalogBaseLayersOptions(r).pipe(Oe.map(function(e){var t=e.map(function(e){return{id:qe(e.sourceOptions),title:e.title,type:an.Layer,options:e}});return[{id:"catalog.group.baselayers",type:an.Group,title:r.title,items:t}]}))},mn.prototype.getCatalogBaseLayersOptions=function(e){return this.http.get(e.url)},mn.prototype.loadCatalogWMSLayerItems=function(r){var o=this;return this.getCatalogWMSCapabilities(r).pipe(Oe.map(function(e){var t=[];return o.includeRecursiveItems(r,e.Capability.Layer,t),t}))},mn.prototype.loadCatalogWMTSLayerItems=function(t){var r=this;return this.getCatalogWMTSCapabilities(t).pipe(Oe.map(function(e){return r.getWMTSItems(t,e)}))},mn.prototype.getCatalogWMSCapabilities=function(e){return this.capabilitiesService.getCapabilities("wms",e.url,e.version)},mn.prototype.getCatalogWMTSCapabilities=function(e){return this.capabilitiesService.getCapabilities("wmts",e.url,e.version)},mn.prototype.includeRecursiveItems=function(g,r,o){function e(e){if(e.Layer!==undefined)return i.includeRecursiveItems(g,e,o),"continue";var p=i.retrieveTooltipType(g),d=i.findCatalogInfoFormat(g),t={id:"catalog.group."+r.Name,type:an.Group,title:r.Title,items:r.Layer.reduce(function(e,t){var r=h.retriveLayerInfoFormat(t.Name,d);if(!1===h.testLayerRegexes(t.Name,f))return e;var o=t.DataURL?t.DataURL[0]:undefined,n=t.Abstract?t.Abstract:undefined,i=t.KeywordList?t.KeywordList:undefined,a=h.capabilitiesService.getTimeFilter(t),s=!!(a&&0<Object.keys(a).length),l=Object.assign({},y,{layers:t.Name,feature_count:g.count}),u={type:"wms",url:g.url,crossOrigin:g.setCrossOriginAnonymous?"anonymous":undefined,timeFilter:ke({},a,g.timeFilter),timeFilterable:s,queryable:t.queryable,queryFormat:r,queryHtmlTarget:g.queryHtmlTarget||wt.IFRAME},c=Object.assign({},u,m,{params:l});return e.push({id:qe(c),type:an.Layer,title:t.Title,options:{title:t.Title,maxResolution:Io(t.MaxScaleDenominator)||Infinity,minResolution:Io(t.MinScaleDenominator)||0,metadata:{url:o?o.OnlineResource:undefined,extern:!!o||undefined,"abstract":n,keywordList:i},tooltip:{type:p},sourceOptions:c}}),e},[])};return 0!==t.items.length&&o.push(t),"break"}var t,n,h=this,f=(g.regFilters||[]).map(function(e){return new RegExp(e)}),y=g.queryParams||{},m=g.sourceOptions||{},i=this;try{for(var a=$e(r.Layer),s=a.next();!s.done&&"break"!==e(s.value);s=a.next());}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=a["return"])&&n.call(a)}finally{if(t)throw t.error}}},mn.prototype.getWMTSItems=function(n,e){var i=this,t=e.Contents.Layer,a=(n.regFilters||[]).map(function(e){return new RegExp(e)}),s=n.queryParams||{},l=n.sourceOptions||{};return t.map(function(e){if(!1===i.testLayerRegexes(e.Identifier,a))return undefined;var t=Object.assign({},s,{version:"1.0.0"}),r={type:"wmts",url:n.url,crossOrigin:n.setCrossOriginAnonymous?"anonymous":undefined,layer:e.Identifier,matrixSet:n.matrixSet,optionsFromCapabilities:!0,requestEncoding:n.requestEncoding||"KVP",style:"default"},o=Object.assign({},r,l,{params:t});return{id:qe(o),type:an.Layer,title:e.Title,options:{title:e.Title,sourceOptions:o}}}).filter(function(e){return e!==undefined})},mn.prototype.testLayerRegexes=function(t,e){return 0===e.length||e.find(function(e){return e.test(t)})!==undefined},mn.prototype.retriveLayerInfoFormat=function(t,e){var r,o=e.find(function(e){return e.layer===t}),n=e.find(function(e){return"*"===e.layer});return o?r=o.queryFormat:n&&(r=n.queryFormat),r},mn.prototype.retrieveTooltipType=function(e){return e.tooltipType?e.tooltipType:Jt.TITLE},mn.prototype.findCatalogInfoFormat=function(t){var e=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(function(r){t.queryFormat[r]instanceof Array?t.queryFormat[r].forEach(function(t){e.find(function(e){return e.layer===t})||e.push({layer:t,queryFormat:r})}):e.find(function(e){return e.layer===t.queryFormat[r]})||e.push({layer:t.queryFormat[r],queryFormat:r})}),e},mn.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],mn.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.ConfigService},{type:Ie.LanguageService},{type:Xo}]},mn.ngInjectableDef=Se.defineInjectable({factory:function(){return new mn(Se.inject(we.HttpClient),Se.inject(Ie.ConfigService),Se.inject(Ie.LanguageService),Se.inject(Xo))},token:mn,providedIn:"root"}),mn);function mn(e,t,r,o){this.http=e,this.config=t,this.languageService=r,this.capabilitiesService=o}var vn=(bn.prototype.ngOnInit=function(){var e=this.map.layers.map(function(e){return{id:e.id,title:e.title,type:an.Layer}});this.store.state.updateMany(e,{added:!0},!0),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}}),this.watcher=new be.EntityStoreWatcher(this.store,this.cdRef)},bn.prototype.ngOnDestroy=function(){this.watcher.destroy()},bn.prototype.isGroup=function(e){return e.type===an.Group},bn.prototype.isLayer=function(e){return e.type===an.Layer},bn.prototype.onLayerAddedChange=function(e){var t=e.layer;this.store.state.update(t,{added:e.added},!1),e.added?this.addLayerToMap(t):this.removeLayerFromMap(t)},bn.prototype.onGroupAddedChange=function(e){var t=e.group;this.store.state.update(t,{added:e.added},!1),e.added?this.addGroupToMap(t):this.removeGroupFromMap(t)},bn.prototype.addLayerToMap=function(e){this.addLayersToMap([e])},bn.prototype.removeLayerFromMap=function(e){this.removeLayersFromMap([e])},bn.prototype.addLayersToMap=function(t){var r=this,e=t.map(function(e){return r.layerService.createAsyncLayer(e.options)});fe.zip.apply(void 0,_e(e)).subscribe(function(e){r.store.state.updateMany(t,{added:!0}),r.map.addLayers(e)})},bn.prototype.removeLayersFromMap=function(e){var r=this;e.forEach(function(e){r.store.state.update(e,{added:!1});var t=r.map.getLayerById(e.id);t!==undefined&&r.map.removeLayer(t)})},bn.prototype.addGroupToMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!1===t});this.addLayersToMap(t)},bn.prototype.removeGroupFromMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!0===t});this.removeLayersFromMap(t)},bn.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-browser",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)">\r\n      <igo-catalog-browser-group\r\n        [catalog]="catalog"\r\n        [group]="item"\r\n        [state]="store.state"\r\n        [toggleCollapsed]="toggleCollapsedGroup"\r\n        (addedChange)="onGroupAddedChange($event)"\r\n        (layerAddedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-group>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [added]="store.state.get(item).added"\r\n        [disabled]="store.state.get(item).added"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],bn.ctorParameters=function(){return[{type:on},{type:Se.ChangeDetectorRef}]},bn.propDecorators={catalog:[{type:Se.Input}],store:[{type:Se.Input}],map:[{type:Se.Input}],toggleCollapsedGroup:[{type:Se.Input}]},bn);function bn(e,t){this.layerService=e,this.cdRef=t,this.toggleCollapsedGroup=!0}var Sn=(Object.defineProperty(wn.prototype,"title",{get:function(){return be.getEntityTitle(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(wn.prototype,"icon",{get:function(){return be.getEntityIcon(this.layer)||"layers"},enumerable:!0,configurable:!0}),wn.prototype.onToggleClick=function(){this.added?this.remove():this.add()},wn.prototype.add=function(){this.added=!0,this.addedChange.emit({added:!0,layer:this.layer})},wn.prototype.remove=function(){this.added=!1,this.addedChange.emit({added:!1,layer:this.layer})},wn.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-browser-layer",template:'<mat-list-item>\r\n  <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n  <h4 mat-line>{{title}}</h4>\r\n\r\n  <igo-metadata-button [layer]="layer"></igo-metadata-button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="(added ? \'igo.geo.catalog.layer.removeFromMap\' : \'igo.geo.catalog.layer.addToMap\') | translate"\r\n    [color]="added ? \'warn\' : \'\'"\r\n    (click)="onToggleClick()">\r\n    <mat-icon [svgIcon]="added ? \'delete\' : \'plus\'"></mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],wn.ctorParameters=function(){return[]},wn.propDecorators={layer:[{type:Se.Input}],added:[{type:Se.Input}],addedChange:[{type:Se.Output}]},wn);function wn(){this.addedChange=new Se.EventEmitter}var On=(Object.defineProperty(Fn.prototype,"title",{get:function(){return this.group.title},enumerable:!0,configurable:!0}),Fn.prototype.ngOnInit=function(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}})},Fn.prototype.ngOnDestroy=function(){this.store.destroy()},Fn.prototype.isGroup=function(e){return e.type===an.Group},Fn.prototype.isLayer=function(e){return e.type===an.Layer},Fn.prototype.onToggleClick=function(){this.added$.value?this.remove():this.add()},Fn.prototype.onToggleCollapsed=function(e){this.evaluateDisabled(e)},Fn.prototype.onLayerAddedChange=function(e){this.layerAddedChange.emit(e),this.tryToggleGroup(e)},Fn.prototype.add=function(){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group})},Fn.prototype.remove=function(){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group})},Fn.prototype.tryToggleGroup=function(e){var t=this,r=e.added,o=e.layer;this.store.view.all().filter(function(e){return e.id!==o.id}).map(function(e){return t.state.get(e).added||!1}).every(function(e){return e===r})?r?this.add():this.remove():!0===this.added$.value&&this.added$.next(!1)},Fn.prototype.evaluateAdded=function(){var t=this,e=this.store.all().every(function(e){return!0===(t.state.get(e).added||!1)});this.added$.next(e)},Fn.prototype.evaluateDisabled=function(e){var t=!1;!1===this.toggleCollapsed&&(t=e),this.disabled$.next(t)},Fn.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-browser-group",template:'<mat-list-item>\r\n  <mat-icon\r\n    mat-list-avatar\r\n    svgIcon="chevron-up"\r\n    igoCollapse\r\n    class="igo-chevron"\r\n    [target]="items"\r\n    [collapsed]="collapsed"\r\n    (toggle)="onToggleCollapsed($event)">\r\n  </mat-icon>\r\n\r\n  <h4 matLine>{{title}}</h4>\r\n\r\n  <ng-container *ngIf="added$ | async; else notadded">\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.removeFromMap\' | translate"\r\n      color="warn"\r\n      [disabled]="disabled$ | async"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n  </ng-container>\r\n\r\n  <ng-template #notadded>\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.addToMap\' | translate"\r\n      [disabled]="disabled$ | async"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="plus"></mat-icon>\r\n    </button>\r\n  </ng-template>\r\n</mat-list-item>\r\n\r\n<div #items>\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)"></ng-container>\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [added]="state.get(item).added"\r\n        [disabled]="state.get(item).added"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Fn.propDecorators={catalog:[{type:Se.Input}],group:[{type:Se.Input}],collapsed:[{type:Se.Input}],toggleCollapsed:[{type:Se.Input}],state:[{type:Se.Input}],addedChange:[{type:Se.Output}],layerAddedChange:[{type:Se.Output}]},Fn);function Fn(){this.store=new be.EntityStore([]),this.added$=new fe.BehaviorSubject(!1),this.disabled$=new fe.BehaviorSubject(!1),this.collapsed=!0,this.toggleCollapsed=!0,this.addedChange=new Se.EventEmitter,this.layerAddedChange=new Se.EventEmitter}var In=(xn.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatButtonModule,me.MatIconModule,me.MatListModule,me.MatTooltipModule,Ie.IgoLanguageModule,be.IgoListModule,be.IgoCollapsibleModule,Le],exports:[vn],declarations:[vn,On,Sn]}]}],xn);function xn(){}var Mn=(Tn.prototype.ngOnInit=function(){this.store.state.clear()},Tn.prototype.onCatalogSelect=function(e){this.store.state.update(e,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:e})},Tn.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-library",template:'<igo-list [navigation]="false">\r\n  <ng-template ngFor let-catalog [ngForOf]="store.view.all$() | async">\r\n    <igo-catalog-library-item\r\n      igoListItem\r\n      color="accent"\r\n      [map]="map"\r\n      [catalog]="catalog"\r\n      (select)="onCatalogSelect(catalog)">\r\n    </igo-catalog-library-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Tn.propDecorators={store:[{type:Se.Input}],map:[{type:Se.Input}],catalogSelectChange:[{type:Se.Output}]},Tn);function Tn(){this.catalogSelectChange=new Se.EventEmitter}var Cn=(Object.defineProperty(Ln.prototype,"title",{get:function(){return be.getEntityTitle(this.catalog)},enumerable:!0,configurable:!0}),Object.defineProperty(Ln.prototype,"icon",{get:function(){return be.getEntityIcon(this.catalog)||"image-multiple"},enumerable:!0,configurable:!0}),Ln.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-library-item",template:'<mat-list-item>\r\n  <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n  <h4 mat-line>{{title}}</h4>\r\n</mat-list-item>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Ln.propDecorators={catalog:[{type:Se.Input}],map:[{type:Se.Input}]},Ln);function Ln(){}var Pn=(Dn.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatIconModule,me.MatListModule,me.MatTooltipModule,be.IgoListModule],exports:[Mn],declarations:[Mn,Cn]}]}],Dn);function Dn(){}var jn=(kn.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatIconModule,me.MatListModule,me.MatTooltipModule,be.IgoListModule,be.IgoCollapsibleModule],exports:[In,Pn],declarations:[]}]}],kn);function kn(){}var Rn=(En.forRoot=function(){return{ngModule:En,providers:[]}},En.decorators=[{type:Se.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],En);function En(){}var $n=(An.prototype.transform=function(e,t){var r,o=this;return"time"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isTimeFilterable(t)&&t.options.timeFilter!==undefined&&Object.keys(t.options.timeFilter).length})),"ogc"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isOgcFilterable(t)})),r},An.prototype.isTimeFilterable=function(e){return"wms"===e.options.type&&e.options.timeFilterable},An.prototype.isOgcFilterable=function(e){return!(!e.options.ogcFilters||!e.options.ogcFilters.enabled)},An.decorators=[{type:Se.Pipe,args:[{name:"filterableDataSource"}]}],An);function An(){}var _n=(Gn.prototype.filterByDate=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=this.reformatDateTime(t[0]),i.push(t[0])),t[1]&&(n=this.reformatDateTime(t[1]),i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof Et?o+","+n:o+"/"+n),o===n&&(r=o)}else t&&(r=this.reformatDateTime(t));var a={time:r};e.ol.updateParams(a)},Gn.prototype.filterByYear=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=t[0],i.push(t[0])),t[1]&&(n=t[1],i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof Et?o+","+n:o+"/"+n),o===n&&(r=o)}else t&&(r=t);var a={time:r};e.ol.updateParams(a)},Gn.prototype.reformatDateTime=function(e){var t=e.getFullYear(),r=e.getMonth()+1,o=e.getUTCDate(),n=e.getUTCHours(),i=e.getUTCMinutes();return Number(r)<10&&(r="0"+r),Number(o)<10&&(o="0"+o),Number(n)<10&&(n="0"+n),Number(i)<10&&(i="0"+i),t+"-"+r+"-"+o+"T"+n+":"+i+":00Z"},Gn.decorators=[{type:Se.Injectable}],Gn.ctorParameters=function(){return[]},Gn);function Gn(){}var qn={BasicNumericOperator:"BasicNumericOperator",Basic:"Basic",BasicAndSpatial:"BasicAndSpatial",Spatial:"Spatial",All:"All"},Bn=(Nn.prototype.filterByOgc=function(e,t){var r=(new ot).formatProcessedOgcFilter(t,e.options.params.layers);e.ol.updateParams({filter:r})},Nn.prototype.setOgcWFSFiltersOptions=function(e){var t=e.options,r=new ot;t.ogcFilters.enabled&&t.ogcFilters.filters&&(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry,!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry)))},Nn.prototype.setOgcWMSFiltersOptions=function(e){var t=e.options,r=new ot;t.ogcFilters.enabled&&t.ogcFilters.filters?(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.fieldNameGeometry,!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.fieldNameGeometry)),this.filterByOgc(e,r.buildFilter(t.ogcFilters.filters)),t.filtered=!0):(t.ogcFilters.filters=undefined,t.ogcFilters.interfaceOgcFilters=[],t.filtered=!1)},Nn.decorators=[{type:Se.Injectable}],Nn.ctorParameters=function(){return[]},Nn);function Nn(){}var Vn=(Un.prototype.open=function(e){var t=this.languageService.translate,r=t.instant("igo.geo.download.title");this.messageService.success(t.instant("igo.geo.download.start"),r);var o=e.dataSource.options;if(0<Object.keys(o.download).length)if(o.download.dynamicUrl&&o.download.url===undefined){var n=void 0,i=(n=e.dataSource.options.paramsWFS&&0<Object.keys(e.dataSource.options.paramsWFS).length?e.dataSource.options.paramsWFS:e.dataSource.options.params).outputFormatDownload===undefined?"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,a=o.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),s=e.dataSource.options.ogcFilters,l=void 0;l=(l=(new ot).handleOgcFiltersAppliedValue(e.dataSource.options,s.geometryName))?"filter="+l:(new ot).buildFilter(undefined,e.map.getExtent(),new E({code:e.map.projection}),s.geometryName),window.open(a+"&"+l+"&"+i,"_blank")}else o.download&&window.open(o.download.url,"_blank")},Un.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Un.ctorParameters=function(){return[{type:Ie.MessageService},{type:Ie.LanguageService}]},Un.ngInjectableDef=Se.defineInjectable({factory:function(){return new Un(Se.inject(Ie.MessageService),Se.inject(Ie.LanguageService))},token:Un,providedIn:"root"}),Un);function Un(e,t){this.messageService=e,this.languageService=t}var Wn=(Object.defineProperty(zn.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(zn.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),zn.prototype.openDownload=function(e){this.downloadService.open(e)},Object.defineProperty(zn.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),zn.decorators=[{type:Se.Component,args:[{selector:"igo-download-button",template:'<button\r\n  *ngIf="options && options.download && (options.download[\'dynamicUrl\'] || options.download[\'url\']) "\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.download.action\' | translate"\r\n  [color]="color"\r\n  (click)="openDownload(layer)">\r\n  <mat-icon svgIcon="download"></mat-icon>\r\n</button>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],zn.ctorParameters=function(){return[{type:Vn}]},zn.propDecorators={layer:[{type:Se.Input}],color:[{type:Se.Input}]},zn);function zn(e){this.downloadService=e,this._color="primary"}var Kn=(Hn.forRoot=function(){return{ngModule:Hn}},Hn.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatIconModule,me.MatButtonModule,me.MatTooltipModule,Ie.IgoLanguageModule],exports:[Wn],declarations:[Wn]}]}],Hn);function Hn(){}var Qn=(Object.defineProperty(Yn.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(Yn.prototype,"title",{get:function(){return be.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),Object.defineProperty(Yn.prototype,"icon",{get:function(){return be.getEntityIcon(this.feature)||"link"},enumerable:!0,configurable:!0}),Yn.prototype.htmlSanitizer=function(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)},Yn.prototype.isObject=function(e){return"object"==typeof e},Yn.prototype.isUrl=function(e){return"string"==typeof e&&("https://"===e.slice(0,8)||"http://"===e.slice(0,7))},Yn.prototype.filterFeatureProperties=function(r){var e,o=this,t=r.meta?r.meta.alias:undefined,n=Object.assign({},r.properties),i=r.meta.title,a=this.mapService.getMap().layers$.value;return t?(Object.keys(n).forEach(function(e){-1===Object.keys(t).indexOf(e)?delete n[e]:(n[t[e]]=n[e],t[e]!==e&&delete n[e])}),n):(a.forEach(function(t){if("mvt"===t.dataSource.options.type)e=t.dataSource.options;else if("xyz"===t.dataSource.options.type)e=t.dataSource.options;else{if("vector"!==t.dataSource.options.type)return;e=t.dataSource.options}o.state.connection&&e.excludeAttribute?e.excludeAttribute.forEach(function(e){i===t.title&&delete r.properties[e]}):!o.state.connection&&e.excludeAttributeOffline&&e.excludeAttributeOffline.forEach(function(e){i===t.title&&delete r.properties[e]})}),r.properties)},Yn.decorators=[{type:Se.Component,args:[{selector:"igo-feature-details",template:'<table class="igo-striped" *ngIf="feature && isObject(feature.properties) && feature.properties.target !== \'iframe\'">\r\n  <tbody>\r\n    <tr *ngFor="let property of filterFeatureProperties(feature) | keyvalue">\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <a href="{{property.value}}" target=\'_blank\'> {{ \'igo.geo.targetHtmlUrl\' | translate }} {{title}}</a>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined">\r\n        {{property.key }}\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)" [innerHTML]=property.value>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)">\r\n        <a href="{{property.value}}" target=\'_blank\'>{{ \'igo.geo.targetHtmlUrl\' | translate }} </a>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && isObject(property.value)" [innerHTML]="property.value | json">\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<iframe *ngIf="feature && isObject(feature.properties) && feature.properties.target === \'iframe\'" [src]=\'htmlSanitizer(feature.properties.url)\'></iframe>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:["table{width:100%;white-space:nowrap}table td{padding:5px}iframe{height:calc(100% - 4px);width:100%;border:0}"]}]}],Yn.ctorParameters=function(){return[{type:Se.ChangeDetectorRef},{type:$.DomSanitizer},{type:Ie.NetworkService},{type:kr}]},Yn.propDecorators={feature:[{type:Se.Input}]},Yn);function Yn(e,t,r,o){var n=this;this.cdRef=e,this.sanitizer=t,this.networkService=r,this.mapService=o,this.networkService.currentState().subscribe(function(e){n.state=e})}var Zn=(Jn.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatIconModule,Ie.IgoLanguageModule,be.IgoKeyValueModule],exports:[Qn],declarations:[Qn]}]}],Jn);function Jn(){}var Xn=(ei.prototype.ngOnChanges=function(e){var t=e.store;t&&t.currentValue!==t.previousValue&&this.setStore(t.currentValue);var r=e.feature;r&&r.currentValue!==r.previousValue&&this.feature$.next(r.currentValue)},ei.prototype.ngOnDestroy=function(){this.setStore(undefined)},ei.prototype.onSubmit=function(e){var t=this.formDataToFeature(e);this.submitForm.emit(t)},ei.prototype.formDataToFeature=function(e){var i={},t={};this.feature===undefined?t.id=Fe.uuid():(Object.assign(i,this.feature.properties),Object.assign(t,this.feature.meta,{revision:be.getEntityRevision(this.feature)+1}));var a="properties.";Object.entries(e).forEach(function(e){var t=Ae(e,2),r=t[0],o=t[1];if(r.startsWith(a)){var n=r.substr(a.length);i[n]=o}});var r=e.geometry;return r===undefined&&this.feature!==undefined&&(r=this.feature.geometry),{meta:t,type:zt,geometry:r,projection:"EPSG:4326",properties:i}},ei.prototype.setStore=function(e){this.store!==undefined&&this.activateStoreSelection(this.store),e!==undefined&&this.deactivateStoreSelection(e),this.store=e},ei.prototype.deactivateStoreSelection=function(e){var t=e.getStrategyOfType(Jr);t!==undefined&&(t.deactivate(),t.unselectAll())},ei.prototype.activateStoreSelection=function(e){e.activateStrategyOfType(Jr)},ei.decorators=[{type:Se.Component,args:[{selector:"igo-feature-form",template:'\r\n<igo-form\r\n  [form]="form"\r\n  [formData]="feature$ | async"\r\n  (submitForm)="onSubmit($event)">\r\n\r\n  <ng-content></ng-content>\r\n  \r\n  <ng-content select="[formButtons]" formButtons></ng-content>\r\n  \r\n</igo-form>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}igo-form{height:100%}"]}]}],ei.ctorParameters=function(){return[]},ei.propDecorators={form:[{type:Se.Input}],feature:[{type:Se.Input}],store:[{type:Se.Input}],submitForm:[{type:Se.Output}]},ei);function ei(){this.feature$=new fe.BehaviorSubject(undefined),this.submitForm=new Se.EventEmitter}var ti=(ri.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,be.IgoFormModule],exports:[be.IgoFormModule,Xn],declarations:[Xn]}]}],ri);function ri(){}var oi=(ni.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule],exports:[Zn,ti],declarations:[],providers:[]}]}],ni);function ni(){}var ii=(Object.defineProperty(ai.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"currentValue",{set:function(e){if(e&&"year"!==this.type){var t=e.split("/");if(0<t.length){var r=new Date(t[0]),o=new Date(t[1]);isNaN(r.valueOf())||(this.startDate=r),isNaN(o.valueOf())||(this.endDate=o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"type",{get:function(){return this.options.type===undefined?"date":this.options.type},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"isRange",{get:function(){return this.options.range!==undefined&&"slider"!==this.options.style&&this.options.range},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"style",{get:function(){return this.options.style===undefined?"slider":this.options.style},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"step",{get:function(){var e=108e5;if(this.options.step===undefined)switch(this.type){case"date":case"datetime":e=108e5;break;case"time":e=36e5;break;case"year":e=31536e6;break;default:e=108e5}else e=this.getStepDefinition(this.options.step);return e},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"timeInterval",{get:function(){return this.options.timeInterval===undefined?2e3:this.options.timeInterval},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"min",{get:function(){return this.options.min===undefined?undefined:new Date(this.options.min)},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"max",{get:function(){return this.options.max===undefined?undefined:new Date(this.options.max)},enumerable:!0,configurable:!0}),Object.defineProperty(ai.prototype,"is",{get:function(){return this.options.range!==undefined&&this.options.range},enumerable:!0,configurable:!0}),ai.prototype.ngOnInit=function(){if(this.startDate===undefined){var e=new Date(this.min);this.startDate=new Date(e.getTime()+6e4*e.getTimezoneOffset())}if(this.endDate===undefined){var t=new Date(this.max);this.endDate=new Date(t.getTime()+6e4*t.getTimezoneOffset())}if(this.startYear===undefined&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),this.endYear===undefined&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(r=this.startYear;r<this.endYear;r++)this.startListYears.push(r);for(r=this.startYear+1;r<=this.endYear;r++)this.endListYears.push(r)}else for(var r=this.startYear;r<=this.endYear+1;r++)this.listYears.push(r)},ai.prototype.handleDateChange=function(e){this.setupDateOutput(),this.applyTypeChange(),this.isRange?this.change.emit([this.startDate,this.endDate]):this.change.emit(this.startDate)},ai.prototype.handleYearChange=function(e){if(this.isRange){this.endListYears=[];for(var t=this.startYear+1;t<=this.initEndYear;t++)this.endListYears.push(t);for(this.startListYears=[],t=this.initStartYear+1;t<this.endYear;t++)this.startListYears.push(t);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)},ai.prototype.handleListYearChange=function(e){this.handleYearChange([this.startYear,this.endYear])},ai.prototype.handleListYearStartChange=function(e){this.change.emit([this.startDate,this.endDate])},ai.prototype.dateToNumber=function(e){return(e?new Date(e):new Date(this.min)).getTime()},ai.prototype.setSliderThumbLabel=function(e){var t=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);t&&(t.textContent=e)},ai.prototype.findThumbLabel=function(e){var t,r=this;return e.forEach(function(e){"mat-slider-thumb-label-text"===e.className&&(t=e),0<e.children.length&&!t&&(t=r.findThumbLabel(e.childNodes))},this),t},ai.prototype.playFilter=function(e){this.interval?this.stopFilter():(this.playIcon="pause_circle_filled",this.interval=setInterval(function(e){var t,r=new Date(e.max);t=e.date===undefined?e.min.getTime():e.date.getTime(),t+=e.mySlider.step,e.date=new Date(t),t>r.getTime()&&e.stopFilter(),e.handleDateChange({value:e.date,date:e.date})},this.timeInterval,this))},ai.prototype.stopFilter=function(){this.interval&&clearInterval(this.interval),this.interval=undefined,this.playIcon="play_circle_filled"},ai.prototype.handleSliderDateChange=function(e){this.date=new Date(e.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(e)},ai.prototype.handleSliderValue=function(){if(!0===this.options.current||!this.min){var e=new Date;this.date=this.getRoundedDate(e)}return this.date===undefined?this.min.getTime():this.date.getTime()},ai.prototype.handleSliderTooltip=function(){var e;switch(this.type){case"date":e=this.date===undefined?this.min.toDateString():this.date.toDateString();break;case"time":e=this.date===undefined?this.min.toTimeString():this.date.toTimeString();break;default:e=this.date===undefined?this.min.toUTCString():this.date.toUTCString()}return e},ai.prototype.setupDateOutput=function(){"slider"===this.style?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=this.startDate===undefined?new Date(this.min):this.startDate,this.endDate=this.endDate===undefined?new Date(this.max):this.endDate)},ai.prototype.applyTypeChange=function(){switch(this.type){case"date":this.startDate===undefined&&this.endDate===undefined||(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case"time":if("calendar"===this.style){if(this.startDate.getDay()!==this.min.getDay()){var e=this.startDate.getHours(),t=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(e),this.startDate.setMinutes(t)}this.endDate.getDay()!==this.min.getDay()&&(e=this.endDate.getHours(),t=this.endDate.getMinutes(),this.endDate=this.min,this.endDate.setHours(e),this.endDate.setMinutes(t))}!this.isRange&&36e5<this.step&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}},ai.prototype.getRangeMinDate=function(){return this.startDate===undefined?this.min:this.startDate},ai.prototype.getRangeMaxDate=function(){return this.endDate===undefined?this.max:this.endDate},ai.prototype.getRoundedDate=function(e,t){void 0===t&&(t=10);var r=6e4*t;return new Date(Math.round(e.getTime()/r)*r)},ai.prototype.getStepDefinition=function(e){return A.duration(e).asMilliseconds()},ai.decorators=[{type:Se.Component,args:[{selector:"igo-time-filter-form",template:'\x3c!-- <div *ngIf="style === \'calendar\' && type !==\'year\'">\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n    <mat-form-field>\r\n      <mat-datetimepicker-toggle [for]="datetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n      <mat-datetimepicker #datetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n      <input matInput autocomplete="false"\r\n        placeholder="{{\'igo.geo.timeFilter.date\' | translate}}"\r\n        [matDatetimepicker]="datetimePicker"\r\n        [(ngModel)]="date"\r\n        [min]="min"\r\n        [max]="max"\r\n        readonly="readonly"\r\n        (dateChange)="handleDateChange($event)">\r\n    </mat-form-field>\r\n\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="minDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #minDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}"\r\n          [matDatetimepicker]="minDatetimePicker"\r\n          [(ngModel)]="startDate"\r\n          [min]="min"\r\n          [max]="getRangeMaxDate()"\r\n          readonly="readonly"\r\n          (input)="startDate"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="maxDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #maxDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}"\r\n          [matDatetimepicker]="maxDatetimePicker"\r\n          [(ngModel)]="endDate"\r\n          [min]="getRangeMinDate()"\r\n          [max]="max"\r\n          readonly="readonly"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div *ngIf="style === \'calendar\' && type ===\'year\'">\r\n\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.date\' | translate}}" [(ngModel)]="year" (selectionChange)="handleYearChange($event)">\r\n                  <mat-option [value]="year" *ngFor="let year of listYears">{{year}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}" [(ngModel)]="startYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="startYear" *ngFor="let startYear of startListYears">{{startYear}}</mat-option>\r\n            </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n    <mat-form-field>\r\n        <mat-select placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}" [(ngModel)]="endYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="endYear" *ngFor="let endYear of endListYears">{{endYear}}</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n  <br>\r\n\r\n\r\n<div *ngIf="style === \'slider\'" class="igo-col igo-col-100 igo-col-100-m">\r\n  <mat-slider\r\n      id="time-slider"\r\n      tickInterval="auto"\r\n      step="{{step}}"\r\n      [min]="dateToNumber(min)"\r\n      [max]="dateToNumber(max)"\r\n      [value]="handleSliderValue()"\r\n      thumbLabel\r\n      (input)="handleSliderDateChange($event)"\r\n      (selectionChange)="handleSliderDateChange($event)">\r\n  </mat-slider>\r\n  <p class="date-below">{{handleSliderTooltip()}}</p>\r\n  <button mat-icon-button color="primary" (click)="playFilter($event)">\r\n   <mat-icon svgIcon="{{playIcon}}"></mat-icon>\r\n  </button>\r\n</div> --\x3e\r\n',styles:[".igo-layer-filters-container{padding-left:5px}mat-slider>>>div.mat-slider-thumb-label{width:32px;height:32px;margin:0 auto}mat-slider>>>span.mat-slider-thumb-label-text{font-size:8px}#time-slider{width:70%;margin:0 auto}@media only screen and (max-width:450px),only screen and (max-height:450px){#time-slider{width:60%;margin:0 auto}}#playFilterIcon{font-size:32px;cursor:pointer}.date-below{margin:0}mat-form-field{text-align:center}"]}]}],ai.ctorParameters=function(){return[]},ai.propDecorators={options:[{type:Se.Input}],currentValue:[{type:Se.Input}],change:[{type:Se.Output}],yearChange:[{type:Se.Output}],mySlider:[{type:Se.ViewChild,args:[me.MatSlider]}]},ai);function ai(){this.listYears=[],this.startListYears=[],this.endListYears=[],this.playIcon="play_circle_filled",this.change=new Se.EventEmitter,this.yearChange=new Se.EventEmitter}var si=(Object.defineProperty(li.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(li.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),li.prototype.handleYearChange=function(e){this.timeFilterService.filterByYear(this.datasource,e)},li.prototype.handleDateChange=function(e){this.timeFilterService.filterByDate(this.datasource,e)},li.decorators=[{type:Se.Component,args:[{selector:"igo-time-filter-item",template:'<mat-list-item>\r\n  <mat-icon\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]="filters"\r\n    [collapsed]="false"\r\n    svgIcon="chevron-up" >\r\n  </mat-icon>\r\n  <h4 matLine>{{layer.title}}</h4>\r\n</mat-list-item>\r\n\r\n<div #filters class="igo-datasource-filters-container">\r\n  <igo-time-filter-form\r\n    [options]="datasource.options.timeFilter"\r\n    [currentValue]="datasource.options.params.time"\r\n    (change)="handleDateChange($event)"\r\n    (yearChange)="handleYearChange($event)">\r\n  </igo-time-filter-form>\r\n</div>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}"]}]}],li.ctorParameters=function(){return[{type:_n}]},li.propDecorators={layer:[{type:Se.Input}]},li);function li(e){this.timeFilterService=e}var ui=(Object.defineProperty(ci.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),ci.decorators=[{type:Se.Component,args:[{selector:"igo-time-filter-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'time\'">\r\n    <igo-time-filter-item igoListItem [layer]="layer"></igo-time-filter-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],ci.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},ci.propDecorators={layers:[{type:Se.Input}]},ci);function ci(e){this.cdRef=e,this._layers=[]}var pi=(di.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},di.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},di.decorators=[{type:Se.Directive,args:[{selector:"[igoTimeFilterListBinding]"}]}],di.ctorParameters=function(){return[{type:ui,decorators:[{type:Se.Self}]},{type:kr}]},di);function di(e,t){this.mapService=t,this.component=e}var gi=(hi.prototype.wktToFeature=function(e,t,r){return void 0===r&&(r="EPSG:3857"),(new _).readFeature(e,{dataProjection:t,featureProjection:r})},hi.prototype.extentToWkt=function(e,t,r){var o=se.transformExtent(t,r,e);return o=this.roundCoordinateArray(o,e,0),{wktPoly:"POLYGON((\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+"))",wktLine:"LINESTRING(\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+")",wktMultiPoints:"MULTIPOINT(\n        "+t[0]+" "+t[1]+",\n        "+t[0]+" "+t[3]+",\n        "+t[2]+" "+t[3]+",\n        "+t[2]+" "+t[1]+")"}},hi.prototype.roundCoordinateArray=function(e,t,r){void 0===r&&(r=0);var o=se.get(t).getUnits();return-1!==["ft","m","us-ft"].indexOf(o)&&(e=this.roundArray(e,r)),e},hi.prototype.roundArray=function(e,t){void 0===t&&(t=0);for(var r=0;r<e.length;)e[r]=e[r].toFixed(t),r++;return e},hi.prototype.snrcToWkt=function(e,t){void 0===t&&(t="EPSG:3857"),e=e.toLowerCase();var r=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],o=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]],n=!1,i=!1,a=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(e)?a=!0:/\d{2,3}[a-p]/gi.test(e)?i=!0:/\d{2,3}/gi.test(e)&&(n=!0),n?e+="a01":i&&(e+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(e)){var s=e.split(/(?=[a-p])/gi),l=s[0],u=s[1][0],c=s[1].split(u)[1],p=1;3===l.length&&(p=2);var d=l.substring(0,p),g=l.substring(p),h=0,f=0,y=0,m=0;r.forEach(function(e){-1!==e.indexOf(u)&&(f=r.indexOf(e),h=e.indexOf(u))}),o.forEach(function(e){-1!==e.indexOf(c)&&(m=o.indexOf(e),y=e.indexOf(c))});var v=0,b=0,S=0,w=0,O=8,F=4;i?(v=2*h,b=1*f,w=S=0,O=2,F=1):a&&(v=2*h,b=1*f,S=.5*y,w=.25*m,O=.5,F=.25);var I={ul:[{1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}}[d].to+v+S,{1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}}[g].to-b-w]};return I.lr=[I.ul[0]+O,I.ul[1]-F],I.ur=[I.ul[0],I.ul[1]-F],I.ll=[I.ul[0]+O,I.ul[1]],I.ul=se.transform([I.ul[0],I.ul[1]],"EPSG:4326",t),I.lr=se.transform([I.lr[0],I.lr[1]],"EPSG:4326",t),I.ur=se.transform([I.ur[0],I.ur[1]],"EPSG:4326",t),I.ll=se.transform([I.ll[0],I.ll[1]],"EPSG:4326",t),I.ul=this.roundCoordinateArray(I.ul,t,0),I.lr=this.roundCoordinateArray(I.lr,t,0),I.ur=this.roundCoordinateArray(I.ur,t,0),I.ll=this.roundCoordinateArray(I.ll,t,0),{wktPoly:"POLYGON(("+[I.ul.join(" "),I.ur.join(" "),I.lr.join(" "),I.ll.join(" "),I.ul.join(" ")].join(",")+"))",wktLine:"LINESTRING("+[I.ul.join(" "),I.ur.join(" "),I.lr.join(" "),I.ll.join(" "),I.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[I.ul.join(" "),I.ur.join(" "),I.lr.join(" "),I.ll.join(" ")].join(",")+")"}}},hi.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],hi.ctorParameters=function(){return[]},hi.ngInjectableDef=Se.defineInjectable({factory:function(){return new hi},token:hi,providedIn:"root"}),hi);function hi(){}var fi=(Object.defineProperty(yi.prototype,"activeFilters",{get:function(){return this.updateField(),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return!0===e.active})},enumerable:!0,configurable:!0}),yi.prototype.ngOnInit=function(){this.computeAllowedOperators()},yi.prototype.computeAllowedOperators=function(){var e=this.datasource.options.ogcFilters.allowedOperatorsType,t={};switch((e=e||qn.BasicAndSpatial).toLowerCase()){case"all":t=this.ogcFilterOperators;break;case"spatial":t={Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}};break;case"basicandspatial":t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}};break;case"basic":t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]}};break;case"basicnumeric":t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]}};break;default:t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}}}this.ogcFilterOperators=t},yi.prototype.updateField=function(){var t=this;this.datasource.options.sourceFields&&(this.fields=this.datasource.options.sourceFields.filter(function(e){return e.excludeFromOgcFilters===undefined||!e.excludeFromOgcFilters}),this.fields.filter(function(e){return e.name===t.currentFilter.propertyName}).forEach(function(e){t.values=e.values!==undefined?e.values.sort():[]}))},yi.prototype.toggleFilterState=function(e,t,r){this.updateField(),e.checked?this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!0}):(this.removeOverlayByID(t.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!1})),this.refreshFilters()},yi.prototype.deleteFilter=function(t){var e=this.datasource.options.ogcFilters;e.interfaceOgcFilters=e.interfaceOgcFilters.filter(function(e){return e.filterid!==t.filterid}),this.removeOverlayByID(t.filterid),this.refreshFilters()},yi.prototype.changeNumericProperty=function(e,t,r){this.changeProperty(e,t,parseFloat(r)),this.refreshFilters()},yi.prototype.removeOverlayByID=function(e){var t=this.baseOverlayName+e;this.map.overlay.dataSource.ol.getFeatureById(t)&&this.map.overlay.dataSource.ol.removeFeature(this.map.overlay.dataSource.ol.getFeatureById(t))},yi.prototype.changeOperator=function(e){!1===this.ogcFilterOperators[e.operator].spatial&&this.removeOverlayByID(e.filterid),this.refreshFilters()},yi.prototype.changeProperty=function(t,r,o){this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=o}),this.refreshFilters()},yi.prototype.changeGeometry=function(r,o){var n=this,i=/\d{2,3}[a-l][0,1][0-9]/gi,a=/\d{2,3}[a-p]/gi,s=/\d{2,3}/gi,l=this.map.projection;this.removeOverlayByID(r.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===r.filterid}).forEach(function(e){var t;"snrc"===r.igoSpatialSelector?""===o&&""!==n.snrc?(t=n.wktService.snrcToWkt(n.snrc).wktPoly,e.wkt_geometry=t):""!==o&&(s.test(o)||a.test(o)||i.test(o))&&(t=n.wktService.snrcToWkt(o).wktPoly,e.wkt_geometry=t):"fixedExtent"===r.igoSpatialSelector&&(t=n.wktService.extentToWkt(l,n.map.getExtent(),l).wktPoly,e.wkt_geometry=t)}),this.refreshFilters()},yi.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter-form",template:'<mat-list-item>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m">\r\n    <mat-select class="logical" [disabled]="!currentFilter.active" (selectionChange)="refreshFilters()" [(ngModel)]="currentFilter.parentLogical"\r\n      *ngIf="activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true">\r\n      <mat-option value="And">{{\'igo.geo.operators.And\' | translate}}</mat-option>\r\n      <mat-option value="Or">{{\'igo.geo.operators.Or\' | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <span *ngIf="fields && fields.length > 0 && fields[0].name !== \'\'">\r\n      <mat-select [disabled]="!currentFilter.active" *ngIf="[\'Contains\',\'Intersects\',\'Within\'].indexOf(currentFilter.operator) === -1"\r\n        [(ngModel)]="currentFilter.propertyName" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.sourceFields.selectField\' | translate"\r\n        (selectionChange)="updateField()">\r\n        <mat-option *ngFor="let field of fields" [value]="field.name">{{field.alias}}</mat-option>\r\n      </mat-select>\r\n    </span>\r\n    <span *ngIf="fields && fields.length === 1 && fields[0].name === \'\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput #fieldPerUser (keyup)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)"\r\n          (blur)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)" [(ngModel)]="currentFilter.propertyName">\r\n\r\n        <button mat-button *ngIf="currentFilter.propertyName" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.propertyName=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of ogcFilterOperators | keyvalue" [value]="operator.key">{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n\r\n    \x3c!-- PropertyIsEqualTo --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsEqualTo\' || currentFilter.operator === \'PropertyIsNotEqualTo\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionequalto (keyup)="changeProperty(currentFilter,\'expression\',expressionequalto.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'expression\',expressionequalto.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsEqualTo  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsLike\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #pattern (keyup)="changeProperty(currentFilter,\'pattern\',pattern.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'pattern\',pattern.value)" [ngModel]="currentFilter.pattern">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.pattern" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.pattern=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsNull\'"></span>\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsGreaterThan\' || currentFilter.operator === \'PropertyIsGreaterThanOrEqualTo\' || currentFilter.operator === \'PropertyIsLessThan\' || currentFilter.operator === \'PropertyIsLessThanOrEqualTo\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionthan type="number" (keyup)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n    </span>\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsBetween --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsBetween\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #lowerBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)" [ngModel]="currentFilter.lowerBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.lowerBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.lowerBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #upperBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)" [ngModel]="currentFilter.upperBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.upperBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.upperBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsBetween  --\x3e\r\n\r\n\r\n    \x3c!-- During --\x3e\r\n    <span *ngIf="currentFilter.operator === \'During\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #begin (keyup)="changeProperty(currentFilter,\'begin\',begin.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'begin\',begin.value)" [ngModel]="currentFilter.begin">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values " [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.begin" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.begin=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #end (keyup)="changeProperty(currentFilter,\'end\',end.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'end\',end.value)" [ngModel]="currentFilter.end">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.end" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.end=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n\r\n    </span>\r\n    \x3c!-- During  --\x3e\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n\r\n\r\n  \x3c!-- PropertySpatial  --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of ogcFilterOperators | keyvalue" [value]="operator.key">{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.igoSpatialSelector" (selectionChange)="changeGeometry(currentFilter,value)">\r\n      <mat-option *ngFor="let igoSpatialSelector of igoSpatialSelectors" [value]="igoSpatialSelector.type">{{(\'igo.geo.spatialSelector.\'+ igoSpatialSelector.type) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <button mat-button [disabled]="!currentFilter.active" *ngIf="currentFilter.igoSpatialSelector === \'fixedExtent\'"\r\n      matSuffix mat-icon-button aria-label="Clear" (click)="changeGeometry(currentFilter,value)" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.spatialSelector.btnSetExtent\' | translate">\r\n      <mat-icon svgIcon="arrow-expand-all"></mat-icon>\r\n    </button>\r\n\r\n\r\n    <mat-form-field *ngIf="currentFilter.igoSpatialSelector === \'snrc\'">\r\n      <input matInput #htmlSnrc (keyup)="changeGeometry(currentFilter,htmlSnrc.value)" (blur)="changeGeometry(currentFilter,htmlSnrc.value)"\r\n        [(ngModel)]="snrc">\r\n      <button mat-button *ngIf="snrc" matSuffix mat-icon-button aria-label="Clear" (click)="snrc=\'\'">\r\n        <mat-icon svgIcon="close"></mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n  </div>\r\n  \x3c!-- PropertySpatial  --\x3e\r\n\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <div class="igo-layer-button-group">\r\n      <mat-slide-toggle class="example-margin" (change)="toggleFilterState($event,currentFilter,\'active\')" tooltip-position="below"\r\n        matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.toggleFilterState\' | translate" [color]="color" [checked]="currentFilter.active"\r\n        [disabled]="disabled">\r\n      </mat-slide-toggle>\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.removeFilter\' | translate"\r\n        color="warn" (click)="deleteFilter(currentFilter)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <mat-divider></mat-divider>\r\n</mat-list-item>\r\n',styles:[":host{overflow:hidden}.mat-list-item{height:auto}.mat-list-item>>>div.mat-list-item-content{display:inline-table}.logical{font-weight:700}input,mat-select{margin-top:10px;text-align:center}.igo-layer-actions-container{width:100%;display:inline-block}.igo-layer-actions-container>div{text-align:center}.igo-layer-button-group{float:center;padding:0 3px}@media only screen and (max-width:450px),only screen and (max-height:450px){.igo-layer-button-group{float:none}}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],yi.ctorParameters=function(){return[{type:gi}]},yi.propDecorators={refreshFilters:[{type:Se.Input}],datasource:[{type:Se.Input}],map:[{type:Se.Input}],currentFilter:[{type:Se.Input}]},yi);function yi(e){this.wktService=e,this.value="",this.color="primary",this.snrc="",this.baseOverlayName="ogcFilterOverlay_",this.ogcFilterOperators=(new ot).operators,this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}var mi=(Object.defineProperty(vi.prototype,"refreshFunc",{get:function(){return this.refreshFilters},enumerable:!0,configurable:!0}),Object.defineProperty(vi.prototype,"advancedOgcFilters",{get:function(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters},enumerable:!0,configurable:!0}),vi.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filterable-form",template:'<igo-list *ngIf="!advancedOgcFilters" [navigation]="false" [selection]="true">\r\n  <igo-ogc-filter-toggle-button igoListItem [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc">\r\n  </igo-ogc-filter-toggle-button>\r\n</igo-list>\r\n\r\n<igo-list *ngIf="advancedOgcFilters" [navigation]="false" [selection]="true">\r\n  <ng-template ngFor let-currentFilter [ngForOf]="this.datasource.options.ogcFilters.interfaceOgcFilters">\r\n    <igo-ogc-filter-form igoListItem [color]="color" [currentFilter]="currentFilter" [datasource]="datasource"\r\n      [map]="map" [refreshFilters]="refreshFunc">\r\n    </igo-ogc-filter-form>\r\n  </ng-template>\r\n</igo-list>\r\n'}]}],vi.ctorParameters=function(){return[]},vi.propDecorators={datasource:[{type:Se.Input}],map:[{type:Se.Input}],refreshFilters:[{type:Se.Input}]},vi);function vi(){this.color="primary"}var bi=(Object.defineProperty(Si.prototype,"refreshFunc",{get:function(){return this.refreshFilters.bind(this)},enumerable:!0,configurable:!0}),Object.defineProperty(Si.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(Si.prototype,"downloadable",{get:function(){return this.datasource.options.download},enumerable:!0,configurable:!0}),Si.prototype.ngOnInit=function(){var e=this.datasource.options.ogcFilters;switch(e.pushButtons&&0<e.pushButtons.length&&(e.advancedOgcFilters===undefined&&(e.advancedOgcFilters=!1),this.hasPushButton=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}e&&(e.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(e.interfaceOgcFilters)),1<=e.interfaceOgcFilters.filter(function(e){return e.wkt_geometry}).length&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!e.editable&&e.editable)},Si.prototype.addFilterToSequence=function(){this.filtersCollapsed=!1;var e,t=this.datasource.options.ogcFilters.interfaceOgcFilters||[],r=0===t.length?0:t[t.length-1].level,o="";0<this.datasource.options.sourceFields.length&&(o=this.datasource.options.sourceFields[0].name===undefined?"":this.datasource.options.sourceFields[0].name);var n=this.datasource.options;n.fieldNameGeometry?e=n.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(e=this.datasource.options.paramsWFS.fieldNameGeometry);var i=0===t.length;t.push((new ot).addInterfaceFilter({propertyName:o,operator:"PropertyIsEqualTo",active:i,igoSpatialSelector:"fixedExtent"},e,r,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=t},Si.prototype.openDownload=function(){this.downloadService.open(this.layer)},Si.prototype.refreshFilters=function(e){!0===e&&(this.lastRunOgcFilter=undefined);var t=this.datasource.options.ogcFilters,r=new ot,o=t.interfaceOgcFilters.filter(function(e){return!0===e.active});if(0===o.length&&(t.filters=undefined,t.filtered=!1),1<o.length&&(o[0].parentLogical=o[1].parentLogical),0===o.filter(function(e){return-1!==["Contains","Intersects","Within"].indexOf(e.operator)}).length?this.hasActiveSpatialFilter=!1:this.hasActiveSpatialFilter=!0,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(o)){if("wfs"===this.layer.dataSource.options.type)(n=this.layer.dataSource.options.ogcFilters).filters=r.rebuiltIgoOgcFilterObjectFromSequence(o),this.layer.dataSource.ol.clear();else if("wms"===this.layer.dataSource.options.type&&t.enabled){var n,i="";1<=o.length&&((n=this.layer.dataSource.options.ogcFilters).filters=r.rebuiltIgoOgcFilterObjectFromSequence(o),i=r.buildFilter(n.filters,undefined,undefined,this.layer.dataSource.options.fieldNameGeometry)),this.ogcFilterService.filterByOgc(this.datasource,i),this.datasource.options.ogcFilters.filtered=0!==o.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(o))}},Si.prototype.setVisible=function(){this.layer.visible=!0},Si.prototype.isAdvancedOgcFilters=function(){return this.datasource.options.ogcFilters.advancedOgcFilters},Si.prototype.addFilterDisabled=function(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length},Si.prototype.changeOgcFiltersAdvancedOgcFilters=function(e){this.datasource.options.ogcFilters.advancedOgcFilters=e},Si.prototype.changeOgcFilterType=function(e){this.changeOgcFiltersAdvancedOgcFilters(e.checked),e.checked&&this.refreshFilters(!0)},Si.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filterable-item",template:'<span *ngIf="filtersAreEditable">\r\n<mat-list-item>\r\n\r\n  <mat-icon *ngIf="ogcFiltersHeaderShown" class="igo-chevron" mat-list-avatar igoCollapse [target]="ogcFilters" [collapsed]="filtersCollapsed" svgIcon="chevron-up">\r\n  </mat-icon>\r\n  <h4 *ngIf="ogcFiltersHeaderShown" matLine [matTooltip]="layer.title" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n  <h4 *ngIf="!ogcFiltersHeaderShown" matLine></h4>\r\n\r\n  <span *ngIf="downloadable && ogcFiltersHeaderShown">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.download.action\' | translate"\r\n      [color]="color" (click)="openDownload()">\r\n      <mat-icon svgIcon="download"></mat-icon>\r\n    </button>\r\n  </span>\r\n  <button *ngIf="isAdvancedOgcFilters()" [disabled]="addFilterDisabled()" mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.filter.addFilter\' | translate" [color]="color" (click)="addFilterToSequence()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<button *ngIf="!layer.visible && ogcFiltersHeaderShown" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.layer.showLayer\' | translate"\r\ncolor="warn" (click)="setVisible()">\r\n<mat-icon svgIcon="error-outline"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilters class="igo-datasource-filters-container">\r\n  <igo-ogc-filterable-form [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc">\r\n  </igo-ogc-filterable-form>\r\n\r\n  <mat-checkbox labelPosition=\'before\' *ngIf="hasPushButton" (change)="changeOgcFilterType($event)"\r\n    [(ngModel)]="datasource.options.ogcFilters.advancedOgcFilters">\r\n    {{\'igo.geo.filter.advancedOgcFilters\' | translate}}\r\n  </mat-checkbox>\r\n</div>\r\n</span>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],Si.ctorParameters=function(){return[{type:Bn},{type:Vn}]},Si.propDecorators={layer:[{type:Se.Input}],map:[{type:Se.Input}],ogcFiltersHeaderShown:[{type:Se.Input}]},Si);function Si(e,t){this.ogcFilterService=e,this.downloadService=t,this.color="primary",this.defaultLogicalParent="And",this.hasActiveSpatialFilter=!1,this.filtersAreEditable=!0,this.filtersCollapsed=!0,this.hasPushButton=!1}var wi=(Oi.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filterable-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'ogc\'">\r\n    <igo-ogc-filterable-item igoListItem [ogcFiltersHeaderShown]="true" [layer]="layer" \r\n    [map]="layer.map" ></igo-ogc-filterable-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Oi.ctorParameters=function(){return[]},Oi.propDecorators={layers:[{type:Se.Input}],map:[{type:Se.Input}]},Oi);function Oi(){}var Fi=(Ii.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},Ii.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Ii.decorators=[{type:Se.Directive,args:[{selector:"[igoOgcFilterableListBinding]"}]}],Ii.ctorParameters=function(){return[{type:wi,decorators:[{type:Se.Self}]},{type:kr}]},Ii);function Ii(e,t){this.mapService=t,this.component=e}var xi=(Object.defineProperty(Mi.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),Mi.prototype.toggleOgcFilter=function(){this.layer.isInResolutionsRange&&(this.ogcFilterCollapse=!this.ogcFilterCollapse)},Mi.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter-button",template:'<button *ngIf="ogcFiltersInLayers && options.ogcFilters && (options.ogcFilters.enabled\r\n&& options.ogcFilters.editable)"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.filterBy\' | translate"\r\n  [color]="color"\r\n  (click)="toggleOgcFilter()">\r\n  <mat-icon\r\n    [ngClass]=\'{disabled: !layer.isInResolutionsRange}\'svgIcon="filter"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class="igo-layer-actions-container"\r\n*ngIf="options.ogcFilters && (options.ogcFilters.enabled\r\n&& options.ogcFilters.editable)">\r\n  <igo-ogc-filterable-item\r\n    *ngIf="ogcFilterCollapse && options.ogcFilters.enabled"\r\n    igoListItem\r\n    [ogcFiltersHeaderShown]="false"\r\n    [map]="layer.map"\r\n    [layer]="layer">\r\n  </igo-ogc-filterable-item>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Mi.ctorParameters=function(){return[]},Mi.propDecorators={layer:[{type:Se.Input}],map:[{type:Se.Input}],color:[{type:Se.Input}],ogcFiltersInLayers:[{type:Se.Input}]},Mi);function Mi(){this.color="primary",this.ogcFilterCollapse=!1}var Ti=(Ci.prototype.ngOnInit=function(){this.datasource.options.ogcFilters&&this.datasource.options.ogcFilters.pushButtons&&(this.pushButtonBundle=this.datasource.options.ogcFilters.pushButtons),this.applyFilters()},Ci.prototype.getToolTip=function(e){var t;return e.tooltip&&(t=e.tooltip),t||""},Ci.prototype.getButtonColor=function(e){var t;return e.color&&(t={"background-color":e.enabled?"rgba("+e.color+")":"rgba(255,255,255,0)"}),t},Ci.prototype.bundleIsVertical=function(e){return!!e.vertical&&e.vertical},Ci.prototype.applyFilters=function(e){e&&(e.enabled=!e.enabled);var t="",r=[];this.pushButtonBundle.map(function(e){var t=[];e.ogcPushButtons.filter(function(e){return!0===e.enabled}).forEach(function(e){return t.push(e.filters)}),1<=t.length&&(1===t.length?r.push(t[0]):r.push({logical:e.logical,filters:t}))}),1<=r.length&&(t=this.ogcFilterWriter.buildFilter(1===r.length?r[0]:{logical:"And",filters:r})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.clear()},Ci.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter-toggle-button",template:'<ng-container *ngFor="let bundle of pushButtonBundle">\r\n        <mat-button-toggle-group appearance="legacy" vertical={{bundleIsVertical(bundle)}} multiple="true">\r\n            <mat-button-toggle [ngStyle]="getButtonColor(ogcPushButton)" [checked]="ogcPushButton.enabled"\r\n                (change)="applyFilters(ogcPushButton)" tooltip-position="below" matTooltipShowDelay="500"\r\n                [matTooltip]="getToolTip(ogcPushButton)" *ngFor="let ogcPushButton of bundle.ogcPushButtons"\r\n                [value]="ogcPushButton">{{ogcPushButton.title}}\r\n            </mat-button-toggle>\r\n        </mat-button-toggle-group>\r\n</ng-container>\r\n',styles:[".mat-button-toggle-checked{font-weight:700}.mat-button-toggle-group{margin:5px;flex-wrap:wrap}"]}]}],Ci.ctorParameters=function(){return[{type:Bn}]},Ci.propDecorators={refreshFilters:[{type:Se.Input}],datasource:[{type:Se.Input}],map:[{type:Se.Input}]},Ci);function Ci(e){this.ogcFilterService=e,this.color="primary",this.pushButtonBundle=[],this.ogcFilterWriter=new ot}var Li=(Pi.forRoot=function(){return{ngModule:Pi,providers:[{provide:me.MAT_DATE_LOCALE,useValue:"fr"}]}},Pi.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,he.FormsModule,he.ReactiveFormsModule,me.MatAutocompleteModule,me.MatIconModule,me.MatButtonModule,me.MatButtonToggleModule,me.MatCheckboxModule,me.MatSliderModule,me.MatSlideToggleModule,me.MatFormFieldModule,me.MatInputModule,me.MatOptionModule,me.MatSelectModule,me.MatListModule,me.MatTooltipModule,me.MatDatepickerModule,me.MatNativeDateModule,Ie.IgoLanguageModule,be.IgoCollapsibleModule,be.IgoListModule,be.IgoKeyValueModule],exports:[$n,ii,si,ui,pi,fi,xi,Ti,mi,bi,wi,Fi],declarations:[$n,ii,si,ui,pi,fi,xi,Ti,mi,bi,wi,Fi],providers:[_n,Bn]}]}],Pi);function Pi(){}var Di,ji,ki=(Object.defineProperty(Ri.prototype,"geometryTypeModel",{get:function(){return this.geometryType$.value},set:function(e){this.geometryType$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ri.prototype,"drawGuideModel",{get:function(){return this.drawGuide$.value},set:function(e){this.drawGuide$.next(e)},enumerable:!0,configurable:!0}),Ri.prototype.ngOnInit=function(){var t=this;this.geometryType$.next(this.geometryType),this.drawGuide$.next(this.drawGuide),this.value$.next(this.formControl.value?this.formControl.value:undefined),this.value$$=this.formControl.valueChanges.subscribe(function(e){t.value$.next(e||undefined)})},Ri.prototype.ngOnDestroy=function(){this.value$$.unsubscribe()},Ri.prototype.onGeometryTypeChange=function(e){this.value$.value===undefined&&this.geometryType$.next(e)},Ri.prototype.onDrawGuideChange=function(e){this.drawGuide$.next(e)},Ri.decorators=[{type:Se.Component,args:[{selector:"igo-geometry-form-field",template:'<igo-geometry-form-field-input\r\n  [formControl]="formControl"\r\n  [map]="map"\r\n  [geometryType]="geometryType$ | async"\r\n  [drawGuide]="drawGuide$ | async"\r\n  [measure]="measure"\r\n  [drawStyle]="drawStyle"\r\n  [overlayStyle]="overlayStyle">\r\n</igo-geometry-form-field-input>\r\n\r\n<div *ngIf="geometryTypeField" class="geometry-type-toggle">\r\n  <mat-button-toggle-group\r\n    [disabled]="(value$ | async) !== undefined"\r\n    [ngModel]="geometryTypeModel"\r\n    (ngModelChange)="onGeometryTypeChange($event)">\r\n    <mat-button-toggle\r\n      value="Point"\r\n      [disabled]="geometryTypes.indexOf(\'Point\') < 0">\r\n      {{\'igo.geo.geometry.point\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="LineString"\r\n      [disabled]="geometryTypes.indexOf(\'LineString\') < 0">\r\n      {{\'igo.geo.geometry.line\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="Polygon"\r\n      [disabled]="geometryTypes.indexOf(\'Polygon\') < 0">\r\n      {{\'igo.geo.geometry.polygon\' | translate}}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<mat-form-field *ngIf="drawGuideField" class="draw-guide-field">\r\n  <input\r\n    matInput\r\n    type="number"\r\n    [placeholder]="drawGuidePlaceholder"\r\n    [ngModel]="drawGuideModel"\r\n    (ngModelChange)="onDrawGuideChange($event)">\r\n  <mat-icon\r\n    matPrefix\r\n    [color]="\'primary\'"\r\n    svgIcon="adjust">    \r\n  </mat-icon>\r\n  <span matSuffix class="draw-guide-units">{{\'igo.geo.measure.meters\' | translate}}</span>\r\n</mat-form-field>',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;width:100%}.draw-guide-field,.geometry-type-toggle{width:100%}.geometry-type-toggle{padding:10px;text-align:center}.draw-guide-field mat-icon{margin:0 10px}.draw-guide-units{padding:10px}"]}]}],Ri.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},Ri.propDecorators={formControl:[{type:Se.Input}],map:[{type:Se.Input}],geometryType:[{type:Se.Input}],geometryTypeField:[{type:Se.Input}],geometryTypes:[{type:Se.Input}],drawGuideField:[{type:Se.Input}],drawGuide:[{type:Se.Input}],drawGuidePlaceholder:[{type:Se.Input}],measure:[{type:Se.Input}],drawStyle:[{type:Se.Input}],overlayStyle:[{type:Se.Input}]},Ri=Re([be.FormFieldComponent("geometry"),Ee("design:paramtypes",[Se.ChangeDetectorRef])],Ri));function Ri(e){this.cdRef=e,this.geometryType$=new fe.BehaviorSubject(undefined),this.drawGuide$=new fe.BehaviorSubject(0),this.value$=new fe.BehaviorSubject(undefined),this.geometryTypeField=!1,this.geometryTypes=["Point","LineString","Polygon"],this.drawGuideField=!1,this.drawGuide=null,this.drawGuidePlaceholder="",this.measure=!1}var Ei={Length:"length",Area:"area"},$i={Meters:"meters",Kilometers:"kilometers",Miles:"miles",Feet:"feet"},Ai=((Di={})[$i.Meters]="m",Di[$i.Kilometers]="km",Di[$i.Miles]="mi",Di[$i.Feet]="ft",Di),_i={SquareMeters:"squareMeters",SquareKilometers:"squareKilometers",SquareMiles:"squareMiles",SquareFeet:"squareFeet",Hectares:"hectares",Acres:"acres"},Gi=((ji={})[_i.SquareMeters]="m²",ji[_i.SquareKilometers]="km²",ji[_i.SquareMiles]="mi²",ji[_i.SquareFeet]="ft²",ji[_i.Hectares]="ha",ji[_i.Acres]="ac",ji);function qi(e){return.001*e}function Bi(e){return 3.2808*e}function Ni(e){return 621e-6*e}function Vi(e){return 1e-6*e}function Ui(e){return 3.861e-7*e}function Wi(e){return 10.764*e}function zi(e){return 1e-4*e}function Ki(e){return 24711e-8*e}function Hi(e,t){var r=new Map([[$i.Meters,function(e){return e}],[$i.Kilometers,qi],[$i.Miles,Ni],[$i.Feet,Bi]]).get(t);return r?r(e):undefined}function Qi(e,t){var r=new Map([[_i.SquareMeters,function(e){return e}],[_i.SquareKilometers,Vi],[_i.SquareMiles,Ui],[_i.SquareFeet,Wi],[_i.Hectares,zi],[_i.Acres,Ki]]).get(t);return r?r(e):undefined}function Yi(e,t){var r=t.decimal;(r===undefined||r<0)&&(r=1);var o=[];return t.locale!==undefined?o.push(e.toLocaleString(t.locale,{minimumFractionDigits:r,maximumFractionDigits:r})):o.push(e.toFixed(r).toString()),t.unit!==undefined&&!0===t.unitAbbr&&o.push(Ai[t.unit]||Gi[t.unit]),o.filter(function(e){return e!==undefined}).join(" ")}function Zi(e){for(var t=$i.Meters,r=e,o=[$i.Kilometers];1e3<r&&0<o.length;)r=Hi(e,t=o.pop());return t}function Ji(e){for(var t=_i.SquareMeters,r=e,o=[_i.SquareKilometers];1e6<r&&0<o.length;)r=Qi(e,t=o.pop());return t}function Xi(){return new le.Style({stroke:new le.Stroke({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new le.Fill({color:"rgba(255, 255, 255, 0.2)"}),image:new le.Circle({radius:5,stroke:new le.Stroke({color:"#ffcc33"}),fill:new le.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}function ea(){return new le.Style({stroke:new le.Stroke({color:"#ffcc33",width:2}),fill:new le.Fill({color:"rgba(255, 255, 255, 0.2)"})})}function ta(e,t){return e instanceof G?undefined:0===e.getFlatCoordinates().length?undefined:B.getLength(e,{projection:t})}function ra(e,t){return e instanceof G||e instanceof V?undefined:0===e.getFlatCoordinates().length?undefined:B.getArea(e,{projection:t})}function oa(e,t){for(var r=ta(e,t),o=ra(e,t),n=[],i=e.flatCoordinates,a=i.length,s=0;s<=a-4;s+=2){var l=new V([[i[s],i[s+1]],[i[s+2],i[s+3]]]);n.push(ta(l,t))}return{area:o,length:r,lengths:n}}function na(e){for(var t=ia(e),r=e.flatCoordinates,o=t.length,n=0;n<o;n++){var i=2*n,a=new V([[r[i],r[1+i]],[r[2+i],r[3+i]]]).getCoordinateAt(.5),s=t[n];s!==undefined?s.setCoordinates(a):t[n]=new G(a)}return t}function ia(e){var t=Math.max(e.flatCoordinates.length/2-1,0),r=e.get("_midpoints");if(r===undefined)return r=new Array(t),e.set("_midpoints",r,!0),r;if(t===r.length)return r;if(t>r.length)return r.push.apply(r,_e(new Array(t-r.length))),r;for(var o=t;o<r.length;o++){var n=r[t];n!==undefined&&aa(n)}return r.splice(t),r}function aa(e){var t=e.get("_tooltip");if(t!==undefined){var r=t.getMap();r!==undefined&&r.removeOverlay(t)}}function sa(e){return na(e).map(function(e){var t=e.get("_tooltip");return t===undefined?t=ga(e):t.setPosition(e.flatCoordinates),t})}function la(e){return ia(e).map(function(e){return e?e.get("_tooltip"):undefined})}function ua(e){var t=e.get("_center"),r=pe.getCenter(e.getExtent());return t!==undefined?t.setCoordinates(r):(t=new G(r),e.set("_center",t)),t}function ca(e){var t=ua(e),r=t.get("_tooltip");return r===undefined?r=ga(t):r.setPosition(t.flatCoordinates),r}function pa(e){var t=e.get("_center");return t?t.get("_tooltip"):undefined}function da(e){var t=[].concat(la(e)||[]),r=pa(e);return r!==undefined&&t.push(r),t}function ga(e){var t=new q({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1});return t.setPosition(e.flatCoordinates),e.set("_tooltip",t),t}var ha,fa=(je(ya,ha=Error),ya);function ya(){return null!==ha&&ha.apply(this,arguments)||this}var ma,va=(je(ba,ma=fa),ba);function ba(){var e=ma.call(this,"Can't slice a MultiPolygon.")||this;return Object.setPrototypeOf(e,ba.prototype),e}var Sa,wa=(je(Oa,Sa=fa),Oa);function Oa(){var e=Sa.call(this,"Can't slice with a line that has more than 2 points.")||this;return Object.setPrototypeOf(e,Oa.prototype),e}var Fa,Ia=(je(xa,Fa=fa),xa);function xa(){var e=Fa.call(this,"More than 2 intersections found between the target polygon and the slicing line.")||this;return Object.setPrototypeOf(e,xa.prototype),e}function Ma(e){return e=e||[0,153,255],new le.Style({stroke:new le.Stroke({color:e.concat([1]),width:2}),fill:new le.Fill({color:e.concat([.2])}),image:new le.Circle({radius:8,stroke:new le.Stroke({color:e.concat([1])}),fill:new le.Fill({color:e.concat([.2])})})})}function Ta(){return new le.Style({stroke:new le.Stroke({color:[0,153,255,1],width:2})})}function Ca(e,t){return e instanceof Q?Pa(e,t):[]}function La(e,t){return[]}function Pa(e,t){if(1<e.getLinearRingCount())throw new va;if(2<t.getCoordinates().length)throw new wa;for(var r=(new ye).writeGeometryObject(t),o=e.getLinearRing(0).getCoordinates(),n=[[],[]],i=0,a=0,s=o.length-1;a<s;a++){var l=[o[a],o[a+1]],u=W.lineString(l),c=U(u,r).features,p=c.length;if(i+=p,1<p||2<i)throw new Ia;if(n[0].push(l[0]),1===p){var d=c[0].geometry.coordinates;n[0].push(d),n[1].push(d),n.reverse()}}return i<=1?[]:(n[0].push(n[0][0]),n[1].push(n[1][0]),[new Q([n[0]]),new Q([n[1]])])}function Da(e,t){e.appendLinearRing(t)}var ja=(Object.defineProperty(ka.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(ka.prototype,"geometryType",{get:function(){return this.options.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(ka.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),ka.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction()},ka.prototype.getSource=function(){return this.olOverlaySource},ka.prototype.createOlInnerOverlayLayer=function(){return new X({source:this.options.source?this.options.source:new J,style:this.options.layerStyle,zIndex:500})},ka.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},ka.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},ka.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},ka.prototype.addOlDrawInteraction=function(){var t=this,e=new H({type:this.geometryType,source:this.getSource(),stopClick:!0,style:this.options.drawStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:function(){return!1}});this.onDrawStartKey=e.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=e.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(e),this.olDrawInteraction=e},ka.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),de.unByKey(this.onDrawStartKey),de.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction),this.olDrawInteraction=undefined)},ka.prototype.onDrawStart=function(e){var t=this,r=e.feature.getGeometry();this.start$.next(r),this.clearOlInnerOverlaySource(),this.onChangesKey=r.on("change",function(e){t.changes$.next(e.target)}),this.subscribeToKeyDown()},ka.prototype.onDrawEnd=function(e){this.unsubscribeToKeyDown(),this.onChangesKey!==undefined&&de.unByKey(this.onChangesKey),this.end$.next(e.feature.getGeometry())},ka.prototype.subscribeToKeyDown=function(){var t=this;this.unsubscribeToKeyDown(),this.keyDown$$=fe.fromEvent(document,"keydown").subscribe(function(e){27===e.keyCode&&t.olDrawInteraction.removeLastPoint()})},ka.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&(this.keyDown$$.unsubscribe(),this.keyDown$$=undefined)},ka);function ka(e){this.options=e,this.start$=new fe.Subject,this.end$=new fe.Subject,this.changes$=new fe.Subject,e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}var Ra=(Object.defineProperty(Ea.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Ea.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Object.defineProperty(Ea.prototype,"olLinearRingsSource",{get:function(){return this.olLinearRingsLayer.getSource()},enumerable:!0,configurable:!0}),Ea.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction(),this.addOlTranslateInteraction(),this.activateTranslateInteraction(),this.addOlModifyInteraction(),this.activateModifyInteraction()},Ea.prototype.getSource=function(){return this.olOverlaySource},Ea.prototype.setOlGeometry=function(e){var t=new ie({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},Ea.prototype.createOlInnerOverlayLayer=function(){return new X({source:this.options.source?this.options.source:new J,style:this.options.layerStyle,zIndex:500})},Ea.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},Ea.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},Ea.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},Ea.prototype.createOlLinearRingsLayer=function(){return new X({source:new J,style:Ta(),zIndex:500})},Ea.prototype.addOlLinearRingsLayer=function(){this.olMap.addLayer(this.olLinearRingsLayer)},Ea.prototype.removeOlLinearRingsLayer=function(){this.olMap.removeLayer(this.olLinearRingsLayer)},Ea.prototype.clearOlLinearRingsSource=function(){this.olLinearRingsSource.clear(!0)},Ea.prototype.addOlModifyInteraction=function(){var e=new z({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=e},Ea.prototype.removeOlModifyInteraction=function(){this.olModifyInteraction!==undefined&&(this.deactivateModifyInteraction(),this.olModifyInteraction=undefined)},Ea.prototype.activateModifyInteraction=function(){var t=this;!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",function(e){return t.onModifyStart(e)}),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",function(e){return t.onModifyEnd(e)}),this.olMap.addInteraction(this.olModifyInteraction))},Ea.prototype.deactivateModifyInteraction=function(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,de.unByKey(this.onModifyStartKey),de.unByKey(this.onModifyEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olModifyInteraction))},Ea.prototype.onModifyStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onModifyKey=r.on("change",function(e){t.changes$.next(e.target)})},Ea.prototype.onModifyEnd=function(e){this.onModifyKey!==undefined&&de.unByKey(this.onModifyKey),this.end$.next(e.features.item(0).getGeometry())},Ea.prototype.subscribeToKeyDown=function(){var t=this;this.keyDown$$=fe.fromEvent(document,"keydown").subscribe(function(e){27===e.keyCode&&!0===t.olDrawInteractionIsActive&&t.olDrawInteraction.removeLastPoint()})},Ea.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&this.keyDown$$.unsubscribe()},Ea.prototype.addOlTranslateInteraction=function(){var e=new K({layers:[this.olOverlayLayer]});this.olTranslateInteraction=e},Ea.prototype.removeOlTranslateInteraction=function(){this.olTranslateInteraction!==undefined&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=undefined)},Ea.prototype.activateTranslateInteraction=function(){var t=this;!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",function(e){return t.onTranslateStart(e)}),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",function(e){return t.onTranslateEnd(e)}),this.olMap.addInteraction(this.olTranslateInteraction))},Ea.prototype.deactivateTranslateInteraction=function(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,de.unByKey(this.onTranslateStartKey),de.unByKey(this.onTranslateEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olTranslateInteraction))},Ea.prototype.onTranslateStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onTranslateKey=r.on("change",function(e){t.changes$.next(e.target)})},Ea.prototype.onTranslateEnd=function(e){this.onTranslateKey!==undefined&&de.unByKey(this.onTranslateKey),this.end$.next(e.features.item(0).getGeometry())},Ea.prototype.addOlDrawInteraction=function(){var t=this,e=new H({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:Ta(),condition:function(e){return t.getOlGeometry().intersectsCoordinate(e.coordinate)}});this.olDrawInteraction=e,this.subscribeToDrawKeyDown()},Ea.prototype.subscribeToDrawKeyDown=function(){var r=this;this.drawKeyDown$$=fe.fromEvent(document,"keydown").subscribe(function(e){if(17===e.keyCode){r.unsubscribeToDrawKeyDown();var t=r.getOlGeometry();t&&t instanceof Q&&(r.subscribeToDrawKeyUp(),r.deactivateModifyInteraction(),r.deactivateTranslateInteraction(),r.activateDrawInteraction())}})},Ea.prototype.subscribeToDrawKeyUp=function(){var t=this;this.drawKeyUp$$=fe.fromEvent(document,"keyup").subscribe(function(e){17===e.keyCode&&(t.unsubscribeToDrawKeyUp(),t.subscribeToDrawKeyDown(),t.deactivateDrawInteraction(),t.activateModifyInteraction(),t.activateTranslateInteraction())})},Ea.prototype.unsubscribeToDrawKeyDown=function(){this.drawKeyDown$$!==undefined&&this.drawKeyDown$$.unsubscribe()},Ea.prototype.unsubscribeToDrawKeyUp=function(){this.drawKeyUp$$!==undefined&&this.drawKeyUp$$.unsubscribe()},Ea.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.olDrawInteraction=undefined)},Ea.prototype.activateDrawInteraction=function(){var t=this;!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(function(e){e instanceof Z&&(t.olMap.removeInteraction(e),t.removedOlInteractions.push(e))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=this.olDrawInteraction.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(this.olDrawInteraction))},Ea.prototype.deactivateDrawInteraction=function(){var t=this;!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(function(e){t.olMap.addInteraction(e)}),this.olDrawInteractionIsActive=!1,de.unByKey(this.onDrawStartKey),de.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction))},Ea.prototype.onDrawStart=function(e){var r=this,t=e.feature.getGeometry(),o=t.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(o),this.start$.next(this.getOlGeometry()),this.onDrawKey=t.on("change",function(e){var t=e.target.getLinearRing().getCoordinates();r.updateLinearRingOfOlGeometry(t),r.changes$.next(r.getOlGeometry())}),this.subscribeToKeyDown()},Ea.prototype.onDrawEnd=function(e){this.onDrawKey!==undefined&&de.unByKey(this.onDrawKey);var t=e.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()},Ea.prototype.addLinearRingToOlGeometry=function(e){Da(this.getOlGeometry(),new Y(e))},Ea.prototype.updateLinearRingOfOlGeometry=function(e){var t=this.getOlGeometry(),r=t.getLinearRings().slice(0,-1).map(function(e){return e.getCoordinates()});r.push(e),t.setCoordinates(r)},Ea.prototype.getOlGeometry=function(){var e=this.olOverlaySource.getFeatures();return 0<e.length?e[0].getGeometry():undefined},Ea);function Ea(e){this.options=e,this.start$=new fe.Subject,this.end$=new fe.Subject,this.changes$=new fe.Subject,this.olModifyInteractionIsActive=!1,this.olTranslateInteractionIsActive=!1,this.olDrawInteractionIsActive=!1,this.removedOlInteractions=[],e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}var $a=(Object.defineProperty(Aa.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Aa.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Aa.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeDrawLineControl(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addDrawLineControl()},Aa.prototype.getSource=function(){return this.olOverlaySource},Aa.prototype.setOlGeometry=function(e){var t=new ie({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},Aa.prototype.createOlInnerOverlayLayer=function(){return new X({source:this.options.source?this.options.source:new J,style:this.options.layerStyle,zIndex:500})},Aa.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},Aa.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},Aa.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},Aa.prototype.addDrawLineControl=function(){var t=this;this.drawLineControl=new ja({geometryType:"LineString",drawStyle:this.options.drawStyle,maxPoints:2}),this.drawLineStart$$=this.drawLineControl.start$.subscribe(function(e){return t.onDrawLineStart(e)}),this.drawLineEnd$$=this.drawLineControl.end$.subscribe(function(e){return t.onDrawLineEnd(e)}),this.drawLineControl.setOlMap(this.olMap)},Aa.prototype.removeDrawLineControl=function(){this.drawLineControl!==undefined&&(this.drawLineStart$$.unsubscribe(),this.drawLineEnd$$.unsubscribe(),this.drawLineControl.getSource().clear(),this.drawLineControl.setOlMap(undefined))},Aa.prototype.onDrawLineStart=function(e){this.drawLineControl.getSource().clear()},Aa.prototype.onDrawLineEnd=function(r){var t=this,o=[],e=r.getExtent(),n=[];try{this.olOverlaySource.forEachFeatureInExtent(e,function(e){var t=Ca(e.getGeometry(),r);0<t.length&&(o.push.apply(o,_e(t)),n.push(e))})}catch(i){if(i instanceof fa)return void this.error$.next(i);throw i}this.drawLineControl.getSource().clear(),this.olOverlaySource.addFeatures(o.map(function(e){return new ie(e)})),n.forEach(function(e){t.olOverlaySource.removeFeature(e)}),this.error$.next(undefined),this.end$.next(o)},Aa);function Aa(e){this.options=e,this.end$=new fe.Subject,this.error$=new fe.Subject,e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}var _a=(Ga.prototype.onNoClick=function(){this.dialogRef.close()},Ga.decorators=[{type:Se.Component,args:[{selector:"igo-measurer-dialog",template:"<div mat-dialog-content>\r\n  <h3>{{'igo.geo.measure.dialog.title' | translate}}</h3>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\r\n        <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\r\n        <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n",styles:["h3{text-align:center;margin:0}table{width:100%;padding:10px}table tbody tr td:last-child{padding-left:10px}"]}]}],Ga.ctorParameters=function(){return[{type:me.MatDialogRef},{type:undefined,decorators:[{type:Se.Inject,args:[me.MAT_DIALOG_DATA]}]}]},Ga);function Ga(e,t){this.dialogRef=e,this.data=t,this.measureAreaUnit=_i,this.measureLengthUnit=$i}var qa=(Object.defineProperty(Ba.prototype,"activeMeasureType",{get:function(){return this._activeMeasureType},set:function(e){this.setActiveMeasureType(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ba.prototype,"drawControlIsActive",{get:function(){return this.activeDrawControl!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Ba.prototype,"projection",{get:function(){return this.map.ol.getView().getProjection()},enumerable:!0,configurable:!0}),Ba.prototype.ngOnInit=function(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.onToggleTooltips(this.showTooltips),this.updateTooltipsOfOlSource(this.store.source.ol)},Ba.prototype.ngOnDestroy=function(){this.setActiveMeasureType(undefined),this.deactivateModifyControl(),this.freezeStore()},Ba.prototype.onMeasureTypeChange=function(e){this.activeMeasureType=e},Ba.prototype.onToggleDrawControl=function(e){!0===e?this.toggleDrawControl():this.deactivateDrawControl()},Ba.prototype.onToggleTooltips=function(e){!0===(this.showTooltips=e)?this.showTooltipsOfOlSource(this.store.source.ol):this.clearTooltipsOfOlSource(this.store.source.ol)},Ba.prototype.onToggleMeasureUnitsAuto=function(e){this.measureUnitsAuto=e},Ba.prototype.onLengthUnitChange=function(e){this.activeLengthUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},Ba.prototype.onAreaUnitChange=function(e){this.activeAreaUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},Ba.prototype.onCalculateClick=function(){var e=this.selectedFeatures$.value,t=e.reduce(function(e,t){return e+t.properties.measure.area||0},0),r=e.reduce(function(e,t){return"Polygon"===t.geometry.type?e:e+t.properties.measure.length||0},0),o=e.reduce(function(e,t){return"LineString"===t.geometry.type?e:e+t.properties.measure.length||0},0);this.openDialog({area:t,length:r,perimeter:o})},Ba.prototype.onDeleteClick=function(){this.store.deleteMany(this.selectedFeatures$.value)},Ba.prototype.onModifyClick=function(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{var t=this.selectedFeatures$.value[0],e=this.store.layer.ol.getSource().getFeatures().find(function(e){return e.get("id")===t.properties.id});if(e!==undefined){this.deactivateDrawControl(),this.activateModifyControl();var r=e.getGeometry();this.clearTooltipsOfOlGeometry(r),this.modifyControl.setOlGeometry(r)}}},Ba.prototype.openDialog=function(e){this.dialog.open(_a,{data:e})},Ba.prototype.initStore=function(){var o=this,e=this.store;lo(e,new fr({title:"Measures",zIndex:200,source:new Qe,style:ea(),showInLayerList:!1,exportable:!1,browsable:!1})),uo(e),co(e,new Jr({map:this.map,many:!0})),this.onFeatureAddedKey=e.source.ol.on("addfeature",function(e){var t=e.feature,r=t.getGeometry();o.updateMeasureOfOlGeometry(r,t.get("measure"))}),this.onFeatureRemovedKey=e.source.ol.on("removefeature",function(e){var t=e.feature.getGeometry();o.clearTooltipsOfOlGeometry(t)}),this.selectedFeatures$$=e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(Oe.skip(1)).subscribe(function(e){!0===o.modifyControl.active&&o.deactivateModifyControl(),o.selectedFeatures$.next(e.map(function(e){return e.entity}))})},Ba.prototype.freezeStore=function(){var e=this.store;this.selectedFeatures$$.unsubscribe(),de.unByKey(this.onFeatureAddedKey),de.unByKey(this.onFeatureRemovedKey),this.clearTooltipsOfOlSource(e.source.ol),this.map.removeLayer(e.layer),e.deactivateStrategyOfType(qr),e.deactivateStrategyOfType(Jr)},Ba.prototype.createDrawLineControl=function(){this.drawLineControl=new ja({geometryType:"LineString",source:this.olDrawSource,drawStyle:Xi(),layerStyle:new N({})})},Ba.prototype.createDrawPolygonControl=function(){this.drawPolygonControl=new ja({geometryType:"Polygon",source:this.olDrawSource,drawStyle:Xi(),layerStyle:new N({})})},Ba.prototype.createModifyControl=function(){this.modifyControl=new Ra({source:this.olDrawSource,drawStyle:Xi(),layerStyle:new N({})})},Ba.prototype.toggleDrawControl=function(){this.deactivateDrawControl(),this.activeMeasureType===Ei.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===Ei.Area&&this.activateDrawControl(this.drawPolygonControl)},Ba.prototype.activateDrawControl=function(e){var t=this;this.activeDrawControl=e,this.drawStart$$=e.start$.subscribe(function(e){return t.onDrawStart(e)}),this.drawEnd$$=e.end$.subscribe(function(e){return t.onDrawEnd(e)}),this.drawChanges$$=e.changes$.subscribe(function(e){return t.onDrawChanges(e)}),e.setOlMap(this.map.ol)},Ba.prototype.deactivateDrawControl=function(){this.activeDrawControl!==undefined&&(this.olDrawSource.clear(),this.drawStart$$!==undefined&&this.drawStart$$.unsubscribe(),this.drawEnd$$!==undefined&&this.drawEnd$$.unsubscribe(),this.drawChanges$$!==undefined&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),this.activeOlGeometry!==undefined&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(undefined),this.activeDrawControl=undefined,this.activeOlGeometry=undefined)},Ba.prototype.setActiveMeasureType=function(e){this._activeMeasureType=e,this.clearMeasures(),this.toggleDrawControl()},Ba.prototype.onDrawStart=function(e){this.activeOlGeometry=e},Ba.prototype.onDrawEnd=function(e){this.activeOlGeometry=undefined,this.finalizeMeasureOfOlGeometry(e),this.addFeatureToStore(e),this.clearTooltipsOfOlGeometry(e),this.olDrawSource.clear(!0)},Ba.prototype.onDrawChanges=function(e){var t=oa(e,this.projection);this.updateMeasureOfOlGeometry(e,Object.assign({},t,{area:undefined})),this.measure$.next(t)},Ba.prototype.activateModifyControl=function(){var t=this,e=this.store.getStrategyOfType(Jr);e.deactivate(),e.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(function(e){return t.onModifyStart(e)}),this.modifyEnd$$=this.modifyControl.end$.subscribe(function(e){return t.onModifyEnd(e)}),this.modifyChanges$$=this.modifyControl.changes$.subscribe(function(e){return t.onModifyChanges(e)}),this.modifyControl.setOlMap(this.map.ol)},Ba.prototype.deactivateModifyControl=function(){if(this.modifyStart$$!==undefined&&this.modifyStart$$.unsubscribe(),this.modifyEnd$$!==undefined&&this.modifyEnd$$.unsubscribe(),this.modifyChanges$$!==undefined&&this.modifyChanges$$.unsubscribe(),this.activeOlGeometry!==undefined){if(1===this.selectedFeatures$.value.length){var e=this.selectedFeatures$.value[0];this.addFeatureToStore(this.activeOlGeometry,e)}this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)}this.olDrawSource.clear(),this.store.activateStrategyOfType(Jr),this.activeOlGeometry=undefined,this.modifyControl.setOlMap(undefined)},Ba.prototype.onModifyStart=function(e){this.onDrawStart(e)},Ba.prototype.onModifyChanges=function(e){this.onDrawChanges(e)},Ba.prototype.onModifyEnd=function(e){this.finalizeMeasureOfOlGeometry(e)},Ba.prototype.finalizeMeasureOfOlGeometry=function(e){var t=oa(e,this.projection);e instanceof Q&&(t=Object.assign({},t,{lengths:[]})),this.updateMeasureOfOlGeometry(e,t)},Ba.prototype.updateMeasureOfOlGeometry=function(e,t){e.setProperties({_measure:t},!0),this.updateTooltipsOfOlGeometry(e)},Ba.prototype.clearMeasures=function(){this.measure$.next({})},Ba.prototype.addFeatureToStore=function(e,t){var r=t?t.properties.id:Fe.uuid(),o=this.map.ol.getView().getProjection(),n=(new ye).writeGeometryObject(e,{featureProjection:o,dataProjection:o});this.store.update({type:zt,geometry:n,projection:o.getCode(),properties:{id:r,measure:e.get("_measure")},meta:{id:r}})},Ba.prototype.updateTooltipsOfOlGeometry=function(e){var t=e.get("_measure"),r=t.lengths,o=t.area,n=sa(e);if(r.length===n.length)for(var i=0;i<n.length;i++){var a=r[i];a!==undefined&&this.updateOlTooltip(n[i],Hi(a,this.activeLengthUnit),this.activeLengthUnit,Ei.Length)}o!==undefined&&this.updateOlTooltip(ca(e),Qi(o,this.activeAreaUnit),this.activeAreaUnit,Ei.Area)},Ba.prototype.showTooltipsOfOlGeometry=function(e){var t=this;da(e).forEach(function(e){t.shouldShowTooltip(e)&&t.map.ol.addOverlay(e)})},Ba.prototype.clearTooltipsOfOlGeometry=function(e){var t=this;da(e).forEach(function(e){e!==undefined&&e.getMap()!==undefined&&t.map.ol.removeOverlay(e)})},Ba.prototype.updateTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.updateTooltipsOfOlGeometry(e.getGeometry())})},Ba.prototype.showTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.showTooltipsOfOlGeometry(e.getGeometry())})},Ba.prototype.clearTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){e.getGeometry()!==undefined&&t.clearTooltipsOfOlGeometry(e.getGeometry())})},Ba.prototype.updateOlTooltip=function(e,t,r,o){e.setProperties({_measure:t,_unit:r,_type:o},!0),e.getElement().innerHTML=this.computeTooltipInnerHTML(e),this.shouldShowTooltip(e)&&this.map.ol.addOverlay(e)},Ba.prototype.computeTooltipInnerHTML=function(e){var t=e.getProperties();return Yi(t._measure,{decimal:1,unit:t._unit,unitAbbr:!0,locale:"fr"})},Ba.prototype.shouldShowTooltip=function(e){if(!1===this.showTooltips)return!1;var t=e.getProperties(),r=t._measure;if(r===undefined)return!1;if(t._unit!==Ei.Length)return!0;var o=Hi(this.minSegmentLength,t._unit)||0;return r>Math.max(o,0)},Ba.decorators=[{type:Se.Component,args:[{selector:"igo-measurer",template:'<div>\r\n  <div class="measure-type-toggle">\r\n    <mat-button-toggle-group\r\n      [value]="activeMeasureType"\r\n      (change)="onMeasureTypeChange($event.value)">\r\n      <mat-button-toggle [value]="measureType.Length">\r\n        {{(\'igo.geo.measure.\' + measureType.Length) | translate}}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]="measureType.Area">\r\n        {{(\'igo.geo.measure.\' + measureType.Area) | translate}}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class="measure-options">\r\n    <mat-slide-toggle\r\n      [checked]="drawControlIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleDrawControl($event.checked)">\r\n      {{\'igo.geo.measure.toggleMeasure\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="showTooltips"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleTooltips($event.checked)">\r\n      {{\'igo.geo.measure.toggleMapTooltips\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="measureUnitsAuto"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleMeasureUnitsAuto($event.checked)">\r\n      {{\'igo.geo.measure.toggleAutoUnits\' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf="measure$ | async as measure">\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Length"\r\n      [measureUnit]="measureLengthUnit.Meters"\r\n      [measure]="measure.length"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="(activeMeasureType === measureType.Area ? \'igo.geo.measure.perimeter\' : \'igo.geo.measure.length\') | translate"\r\n      (measureUnitChange)="onLengthUnitChange($event)">\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Area"\r\n      [measureUnit]="measureAreaUnit.SquareMeters"\r\n      [measure]="measure.area"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="\'igo.geo.measure.area\' | translate"\r\n      (measureUnitChange)="onAreaUnitChange($event)">\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <div class="measure-store-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.calculate.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onCalculateClick()">\r\n      <mat-icon svgIcon="calculator"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.delete.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onDeleteClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n\r\n    \x3c!--button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.modify.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length !== 1"\r\n      (click)="onModifyClick()">\r\n      <mat-icon svgIcon="edit"></mat-icon>\r\n    </button--\x3e\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class="table-compact"\r\n    [store]="store"\r\n    [template]="tableTemplate">\r\n  </igo-entity-table>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".measure-type-toggle{padding:10px;text-align:center}.measure-type-toggle mat-button-toggle-group{width:100%}.measure-type-toggle mat-button-toggle-group mat-button-toggle{width:50%}.measure-options{overflow-x:hidden}.measure-options mat-slide-toggle{width:100%;margin:10px}.measure-options mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px);font-size:16px}.measure-store-buttons{width:100%;border-top:1px solid #ddd;border-bottom:1px solid #ddd}.measure-store-buttons button:first-of-type{margin-left:14px}"]}]}],Ba.ctorParameters=function(){return[{type:Ie.LanguageService},{type:me.MatDialog}]},Ba.propDecorators={map:[{type:Se.Input}],store:[{type:Se.Input}],activeMeasureType:[{type:Se.Input}],minSegmentLength:[{type:Se.Input}],table:[{type:Se.ViewChild,args:["table"]}]},Ba);function Ba(e,t){var o=this;this.languageService=e,this.dialog=t,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:function(e){var t=o.activeLengthUnit;return Yi(Hi(e.properties.measure.length,t),{decimal:1,unit:t,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:function(e){var t=o.activeAreaUnit,r=Qi(e.properties.measure.area,t);return r?Yi(r,{decimal:1,unit:t,unitAbbr:!1,locale:"fr"}):""}}]},this.measureType=Ei,this.measureAreaUnit=_i,this.measureLengthUnit=$i,this.measureUnitsAuto=!1,this.measure$=new fe.BehaviorSubject({}),this.selectedFeatures$=new fe.BehaviorSubject([]),this.showTooltips=!0,this.activeLengthUnit=$i.Meters,this.activeAreaUnit=_i.SquareMeters,this.olDrawSource=new J,this._activeMeasureType=Ei.Length,this.minSegmentLength=10}var Na=(Va.prototype.transform=function(e,t,r,o){var n;return void 0===r&&(r=!1),void 0===o&&(o=1),0<=Object.values(_i).indexOf(t)?n=Qi(e,t):0<=Object.values($i).indexOf(t)&&(n=Hi(e,t)),n?Yi(n,{decimal:1,unit:t,unitAbbr:r,locale:"fr"}):n},Va.decorators=[{type:Se.Pipe,args:[{name:"measureFormat"}]}],Va);function Va(){}var Ua=(Object.defineProperty(Wa.prototype,"geometryType",{get:function(){return this._geometryType},set:function(e){this._geometryType=e,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.toggleControl())},enumerable:!0,configurable:!0}),Object.defineProperty(Wa.prototype,"drawStyle",{get:function(){return this._drawStyle},set:function(e){this._drawStyle=e||Ma(),this.isStyleWithRadius(this.drawStyle)?this.defaultDrawStyleRadius=this.drawStyle.getImage().getRadius():this.defaultDrawStyleRadius=null},enumerable:!0,configurable:!0}),Object.defineProperty(Wa.prototype,"overlayStyle",{get:function(){return this._overlayStyle||this.drawStyle},set:function(e){this._overlayStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(Wa.prototype,"value",{get:function(){return this._value},set:function(e){!1!==this.ready?(e?this.addGeoJSONToOverlay(e):this.olOverlaySource.clear(),this._value=e,this.onChange(e),this.toggleControl(),this.cdRef.detectChanges()):this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(Wa.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Wa.prototype.ngOnInit=function(){this.addOlOverlayLayer(),this.createMeasureTooltip(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0},Wa.prototype.ngOnDestroy=function(){this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)},Wa.prototype.registerOnChange=function(e){this.onChange=e},Wa.prototype.registerOnTouched=function(e){this.onTouched=e},Wa.prototype.writeValue=function(e){this.value=e},Wa.prototype.addOlOverlayLayer=function(){this.olOverlayLayer=new X({source:new J,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)},Wa.prototype.createDrawControl=function(){var o=this;this.drawControl=new ja({geometryType:this.geometryType||"Point",layer:this.olOverlayLayer,drawStyle:function(e,t){var r=o.drawStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},Wa.prototype.createModifyControl=function(){var o=this;this.modifyControl=new Ra({layer:this.olOverlayLayer,drawStyle:function(e,t){var r=o.drawStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},Wa.prototype.toggleControl=function(){this.deactivateControl(),!this.value&&this.geometryType?this.activateControl(this.drawControl):this.activateControl(this.modifyControl)},Wa.prototype.activateControl=function(e){var t=this;this.activeControl=e,this.olGeometryEnds$$=e.end$.subscribe(function(e){return t.onOlGeometryEnds(e)}),!0===this.measure&&e===this.drawControl&&(this.olGeometryChanges$$=e.changes$.subscribe(function(e){return t.onOlGeometryChanges(e)})),e.setOlMap(this.map.ol)},Wa.prototype.deactivateControl=function(){this.removeMeasureTooltip(),this.activeControl!==undefined&&this.activeControl.setOlMap(undefined),this.olGeometryEnds$$!==undefined&&this.olGeometryEnds$$.unsubscribe(),this.olGeometryChanges$$!==undefined&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=undefined},Wa.prototype.onOlGeometryEnds=function(e){this.removeMeasureTooltip(),this.setOlGeometry(e)},Wa.prototype.onOlGeometryChanges=function(e){"Point"!==e.getType()&&this.updateMeasureTooltip(e)},Wa.prototype.setOlGeometry=function(e){if(e!==undefined){var t=this.olGeoJSON.writeGeometryObject(e,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"});this.writeValue(t)}},Wa.prototype.addGeoJSONToOverlay=function(e){var t=this.olGeoJSON.readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),r=new ie({geometry:t});r.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(r)},Wa.prototype.createMeasureTooltip=function(){this.olTooltip=new q({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})},Wa.prototype.updateMeasureTooltip=function(e){var t=oa(e,this.map.projection).lengths,r="Polygon"===e.getType()?t.length-2:t.length-1,o=t[r],n=na(e),i=n[r];if(0!==n.length&&i!==undefined){this.olTooltip.setPosition(i.flatCoordinates);var a=Yi(o,{decimal:1,unit:$i.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=a,this.olTooltip.getMap()===undefined&&this.map.ol.addOverlay(this.olTooltip)}else this.removeMeasureTooltip()},Wa.prototype.removeMeasureTooltip=function(){this.olTooltip.getMap&&this.olTooltip.getMap()!==undefined&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(undefined))},Wa.prototype.updateDrawStyleWithDrawGuide=function(e,t){if(this.isStyleWithRadius(e)){var r=this.drawGuide,o=void 0;o=null===r||r<0?this.defaultDrawStyleRadius:0<r?r/t:r,e.getImage().setRadius(o)}},Wa.prototype.isStyleWithRadius=function(e){return e.getImage&&e.getImage().setRadius},Wa.decorators=[{type:Se.Component,args:[{selector:"igo-geometry-form-field-input",template:"<ng-template></ng-template>",changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Wa.ctorParameters=function(){return[{type:Se.ChangeDetectorRef},{type:he.NgControl,decorators:[{type:Se.Optional},{type:Se.Self}]}]},Wa.propDecorators={map:[{type:Se.Input}],geometryType:[{type:Se.Input}],drawGuide:[{type:Se.Input}],measure:[{type:Se.Input}],drawStyle:[{type:Se.Input}],overlayStyle:[{type:Se.Input}],value:[{type:Se.Input}]},Wa);function Wa(e,t){this.cdRef=e,this.ngControl=t,this.olGeoJSON=new ye,this.ready=!1,this.olTooltip=q,this.drawGuide=null,this.measure=!1,this.onChange=function(){},this.onTouched=function(){},this.ngControl!==undefined&&(this.ngControl.valueAccessor=this)}var za=(Ka.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,he.FormsModule,he.ReactiveFormsModule,me.MatIconModule,me.MatFormFieldModule,me.MatInputModule,me.MatButtonModule,me.MatButtonToggleModule,Ie.IgoLanguageModule],exports:[ki,Ua],declarations:[ki,Ua]}]}],Ka);function Ka(){}var Ha=(Qa.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,za],exports:[za],declarations:[],providers:[],entryComponents:[ki]}]}],Qa);function Qa(){}var Ya,Za=(je(Ja,Ya=Error),Ja);function Ja(){return null!==Ya&&Ya.apply(this,arguments)||this}var Xa,es=(je(ts,Xa=Za),ts);function ts(){var e=Xa.call(this,"Invalid file.")||this;return Object.setPrototypeOf(e,ts.prototype),e}var rs,os=(je(ns,rs=Za),ns);function ns(){var e=rs.call(this,"Nothing to export.")||this;return Object.setPrototypeOf(e,ns.prototype),e}function is(e,t,r){var o=document.createElement("a");o.setAttribute("href","data:"+t+","+encodeURIComponent(e)),o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}function as(e,t,r){if(e instanceof os)ss(t,r);else{var o=r.translate,n=o.instant("igo.geo.export.failed.title"),i=o.instant("igo.geo.export.failed.text");t.error(i,n)}}function ss(e,t){var r=t.translate,o=r.instant("igo.geo.export.nothing.title"),n=r.instant("igo.geo.export.nothing.text");e.error(n,o)}var ls=Fe.strEnum(["GeoJSON","GML","GPX","KML","Shapefile"]),us=(cs.prototype["export"]=function(e,t,r,o,n){void 0===o&&(o="EPSG:4326"),void 0===n&&(n="EPSG:4326");var i=e.map(function(r){var e=r.getKeys().filter(function(e){return!e.startsWith("_")}).reduce(function(e,t){return e[t]=r.get(t),e},{geometry:r.getGeometry()});return new ie(e)});return this.exportAsync(i,t,r,o,n)},cs.prototype.exportAsync=function(t,r,o,n,i){var a=this;return new fe.Observable(function(e){if(!0!==a.nothingToExport(t,r))if(0<=Object.keys(cs.ogreFormats).indexOf(r)){if(a.ogreUrl===undefined)return void(0<=cs.noOgreFallbacks.indexOf(r)?a.exportToFile(t,e,r,o,n,i):e.error(new es));a.exportWithOgre(t,e,r,o,n,i)}else a.exportToFile(t,e,r,o,n,i);else e.error(new os)})},cs.prototype.exportToFile=function(e,t,r,o,n,i){is((new ge[r]).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),"text/plain;charset=utf-8",o+"."+r.toLowerCase()),t.complete()},cs.prototype.exportWithOgre=function(e,t,r,o,n,i){var a=(new ge.GeoJSON).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),s=this.ogreUrl+"/convert",l=document.createElement("form");l.setAttribute("method","post"),l.setAttribute("action",s);var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","json"),u.setAttribute("value",a),l.appendChild(u);var c=document.createElement("input"),p="Shapefile"===r?o+".zip":o;c.setAttribute("type","hidden"),c.setAttribute("name","outputName"),c.setAttribute("value",p),l.appendChild(c);var d=cs.ogreFormats[r],g=document.createElement("input");g.setAttribute("type","hidden"),g.setAttribute("name","formatOutput"),g.setAttribute("value",d),l.appendChild(g),document.body.appendChild(l),l.submit(),document.body.removeChild(l),t.complete()},cs.prototype.nothingToExport=function(e,t){return 0===e.length||"GPX"===t&&e.find(function(e){return 0<=["Point","LineString"].indexOf(e.getGeometry().getType())})===undefined},cs.ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile"},cs.noOgreFallbacks=["GML","GPX","KML"],cs.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],cs.ctorParameters=function(){return[{type:Ie.ConfigService}]},cs.ngInjectableDef=Se.defineInjectable({factory:function(){return new cs(Se.inject(Ie.ConfigService))},token:cs,providedIn:"root"}),cs);function cs(e){this.config=e,this.ogreUrl=this.config.getConfig("importExport.url")}var ps,ds=(je(gs,ps=Error),gs);function gs(){return null!==ps&&ps.apply(this,arguments)||this}var hs,fs=(je(ys,hs=ds),ys);function ys(){var e=hs.call(this,"Invalid file.")||this;return Object.setPrototypeOf(e,ys.prototype),e}var ms,vs=(je(bs,ms=ds),bs);function bs(){var e=ms.call(this,"Failed to read file.")||this;return Object.setPrototypeOf(e,bs.prototype),e}var Ss,ws=(je(Os,Ss=ds),Os);function Os(){var e=Ss.call(this,"Nothing to import.")||this;return Object.setPrototypeOf(e,Os.prototype),e}function Fs(e,t,r){var o=e.map(function(e){return eo(e,t.projection)}),n=Math.floor(255*Math.random()),i=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),s=new le.Stroke({color:[n,i,a,1],width:2}),l=new le.Fill({color:[n,i,a,.4]}),u=new Qe({queryable:!0});u.ol.addFeatures(o);var c=new fr({title:r,source:u,style:new le.Style({stroke:s,fill:l,image:new le.Circle({radius:5,stroke:s,fill:l})})});return t.addLayer(c),so(t,o),c}function Is(e,t,r,o,n){if(0!==t.length){var i=Ts(e);Fs(t,r,i);var a=n.translate,s=a.instant("igo.geo.dropGeoFile.success.title"),l=a.instant("igo.geo.dropGeoFile.success.text",{value:i});o.success(l,s)}else this.handleNothingToImportError(e,o,n)}function xs(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.invalid.title"),a=n.instant("igo.geo.dropGeoFile.invalid.text",{value:e.name,mimeType:e.type});r.error(a,i)}function Ms(e){return e.name.split(".").pop().toLowerCase()}function Ts(e){return e.name.substr(0,e.name.lastIndexOf("."))}var Cs=(Ls.prototype["import"]=function(e,t,r){return void 0===t&&(t="EPSG:4326"),void 0===r&&(r="EPSG:4326"),this.importAsync(e,t,r)},Ls.prototype.getFileImporter=function(e){var t=Ms(e),r=e.type,o=_e(Ls.allowedMimeTypes,Ls.allowedZipMimeTypes),n=Ls.allowedExtensions;return o.indexOf(r)<0&&n.indexOf(t)<0?undefined:"application/json"===r||0<=["json","geojson","kml"].indexOf(t)?this.importFile:this.ogreUrl!==undefined?this.importFileWithOgre:undefined},Ls.prototype.importAsync=function(r,o,n){var i=this;return new fe.Observable(function(e){var t=i.getFileImporter(r);t!==undefined?t.call(i,r,e,o,n):e.error(new fs)})},Ls.prototype.importFile=function(o,n,i,a){var s=this,e=new FileReader;e.onload=function(e){try{var t=s.parseFeaturesFromFile(o,e.target.result,i,a);n.next(t)}catch(r){n.error(new vs)}n.complete()},e.onerror=function(e){n.error(new vs)},e.readAsText(o,"UTF-8")},Ls.prototype.importFileWithOgre=function(r,o,e,n){var i=this,t=this.ogreUrl+"/convert",a=new FormData;a.append("upload",r),a.append("sourceSrs",e),a.append("targetSrs",n),a.append("formatOutput","GEOJSON"),a.append("skipFailures",""),this.http.post(t,a,{headers:new we.HttpHeaders}).subscribe(function(e){if(null!==e)if(0<(e.errors||[]).length)o.error(new vs);else{var t=i.parseFeaturesFromGeoJSON(r,e,n);o.next(t),o.complete()}else o.error(new vs)},function(e){o.error(new vs)})},Ls.prototype.parseFeaturesFromFile=function(t,e,r,o){var n,i=Ms(t),a=t.type,s=new ge.GeoJSON;if("application/vnd.google-earth.kml+xml"===a)n=new ge.KML;else if("application/gml+xml"===a)n=new ge.GML;else if("application/gpx+xml"===a)n=new ge.GPX;else switch(i){case"kml":n=new ge.KML;break;case"gpx":n=new ge.GPX;break;case"gml":n=new ge.GML;break;default:n=s}return n.readFeatures(e,{dataProjection:r,featureProjection:o}).map(function(e){return Object.assign(s.writeFeatureObject(e),{projection:o,meta:{id:Fe.uuid(),title:Ts(t)}})})},Ls.prototype.parseFeaturesFromGeoJSON=function(t,e,r){var o=new ge.GeoJSON;return o.readFeatures(e).map(function(e){return Object.assign(o.writeFeatureObject(e),{projection:r,meta:{id:Fe.uuid(),title:Ts(t)}})})},Ls.allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"],Ls.allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"],Ls.allowedExtensions=["geojson","kml","gpx","json","gml"],Ls.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Ls.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.ConfigService}]},Ls.ngInjectableDef=Se.defineInjectable({factory:function(){return new Ls(Se.inject(we.HttpClient),Se.inject(Ie.ConfigService))},token:Ls,providedIn:"root"}),Ls);function Ls(e,t){this.http=e,this.config=t,this.ogreUrl=this.config.getConfig("importExport.url")}var Ps=(Ds.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t.layers=e.filter(function(e){return e instanceof fr&&!0===e.exportable})})},Ds.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Ds.prototype.importFiles=function(e){function t(t){i.importService["import"](t,i.inputProj).subscribe(function(e){return n.onFileImportSuccess(t,e)},function(e){return n.onFileImportError(t,e)})}var r,o,n=this,i=this;try{for(var a=$e(e),s=a.next();!s.done;s=a.next())t(s.value)}catch(l){r={error:l}}finally{try{s&&!s.done&&(o=a["return"])&&o.call(a)}finally{if(r)throw r.error}}},Ds.prototype.handleExportFormSubmit=function(e){var t=this,r=this.map.getLayerById(e.layer),o=r.dataSource.ol.getFeatures();this.exportService["export"](o,e.format,r.title,this.map.projection).subscribe(function(){},function(e){return t.onFileExportError(e)})},Ds.prototype.buildForm=function(){this.form=this.formBuilder.group({format:["",[he.Validators.required]],layer:["",[he.Validators.required]]})},Ds.prototype.onFileImportSuccess=function(e,t){Is(e,t,this.map,this.messageService,this.languageService)},Ds.prototype.onFileImportError=function(e,t){xs(e,0,this.messageService,this.languageService)},Ds.prototype.onFileExportError=function(e){as(e,this.messageService,this.languageService)},Ds.decorators=[{type:Se.Component,args:[{selector:"igo-import-export",template:'<mat-tab-group>\r\n\r\n  <mat-tab [label]="\'igo.geo.importExportForm.importTabTitle\' | translate">\r\n    <form class="igo-form">\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <input\r\n            matInput\r\n            placeholder="{{\'igo.geo.importExportForm.importProjPlaceholder\' | translate}}"\r\n            name="inputProj"\r\n            [(ngModel)]="inputProj">\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-form-button-group">\r\n        <button mat-raised-button type="button" (click)="fileInput.click()">\r\n          {{\'igo.geo.importExportForm.importButton\' | translate}}\r\n        </button>\r\n        <input\r\n          #fileInput\r\n          type="file"\r\n          [style.display]="\'none\'"\r\n          (click)="fileInput.value = null"\r\n          (change)="importFiles($event.target.files)">\r\n      </div>\r\n    </form>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]="\'igo.geo.importExportForm.exportTabTitle\' | translate">\r\n    <form class="igo-form" [formGroup]="form">\r\n\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName="layer"\r\n            placeholder="{{\'igo.geo.importExportForm.exportLayerPlaceholder\' | translate}}">\r\n            <mat-option *ngFor="let layer of layers" [value]="layer.id">\r\n              {{layer.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName="format"\r\n            placeholder="{{\'igo.geo.importExportForm.exportFormatPlaceholder\' | translate}}">\r\n            <mat-option *ngFor="let format of formats | keyvalue " [value]="format.key">\r\n              {{format.value}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-form-button-group">\r\n        <button\r\n          mat-raised-button\r\n          type="button"\r\n          [disabled]="!form.valid"\r\n          (click)="handleExportFormSubmit(form.value)">\r\n          {{\'igo.geo.importExportForm.exportButton\' | translate}}\r\n        </button>\r\n      </div>\r\n\r\n    </form>\r\n  </mat-tab>\r\n\r\n</mat-tab-group>\r\n',styles:["mat-form-field{width:100%}.igo-form{padding:5px}.igo-form-button-group{text-align:center;padding-top:10px}"]}]}],Ds.ctorParameters=function(){return[{type:Cs},{type:us},{type:Ie.LanguageService},{type:Ie.MessageService},{type:he.FormBuilder}]},Ds.propDecorators={map:[{type:Se.Input}]},Ds);function Ds(e,t,r,o,n){this.importService=e,this.exportService=t,this.languageService=r,this.messageService=o,this.formBuilder=n,this.formats=ls,this.inputProj="EPSG:4326",this.buildForm()}var js,ks=(je(Rs,js=be.DragAndDropDirective),Object.defineProperty(Rs.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Rs.prototype.ngOnInit=function(){var t=this;this.filesDropped$$=this.filesDropped.subscribe(function(e){t.onFilesDropped(e)})},Rs.prototype.ngOnDestroy=function(){this.filesDropped$$.unsubscribe()},Rs.prototype.onDragOver=function(e){js.prototype.onDragOver.call(this,e)},Rs.prototype.onDragLeave=function(e){js.prototype.onDragLeave.call(this,e)},Rs.prototype.onDrop=function(e){js.prototype.onDrop.call(this,e)},Rs.prototype.onFilesDropped=function(e){function t(t){i.importService["import"](t).subscribe(function(e){return n.onFileImportSuccess(t,e)},function(e){return n.onFileImportError(t,e)})}var r,o,n=this,i=this;try{for(var a=$e(e),s=a.next();!s.done;s=a.next())t(s.value)}catch(l){r={error:l}}finally{try{s&&!s.done&&(o=a["return"])&&o.call(a)}finally{if(r)throw r.error}}},Rs.prototype.onFileImportSuccess=function(e,t){Is(e,t,this.map,this.messageService,this.languageService)},Rs.prototype.onFileImportError=function(e,t){xs(e,0,this.messageService,this.languageService)},Rs.decorators=[{type:Se.Directive,args:[{selector:"[igoDropGeoFile]"}]}],Rs.ctorParameters=function(){return[{type:Ro},{type:Cs},{type:Ie.LanguageService},{type:Ie.MessageService}]},Rs.propDecorators={onDragOver:[{type:Se.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:Se.HostListener,args:["dragleave",["$event"]]}],onDrop:[{type:Se.HostListener,args:["drop",["$event"]]}]},Rs);function Rs(e,t,r,o){var n=js.call(this)||this;return n.component=e,n.importService=t,n.languageService=r,n.messageService=o,n.filesDropped=new Se.EventEmitter,n.filesInvalid=new Se.EventEmitter,n}var Es=($s.forRoot=function(){return{ngModule:$s}},$s.decorators=[{type:Se.NgModule,args:[{imports:[he.FormsModule,he.ReactiveFormsModule,ve.CommonModule,me.MatButtonModule,me.MatTabsModule,me.MatSelectModule,me.MatOptionModule,me.MatFormFieldModule,me.MatInputModule,Ie.IgoLanguageModule,be.IgoKeyValueModule,be.IgoDrapDropModule],exports:[Ps,ks],declarations:[Ps,ks]}]}],$s);function $s(){}var As=(_s.forRoot=function(){return{ngModule:_s,providers:[on,Sr,Lr]}},_s.decorators=[{type:Se.NgModule,args:[{imports:[me.MatInputModule,me.MatFormFieldModule,ve.CommonModule,he.FormsModule,me.MatIconModule,me.MatButtonModule,me.MatTooltipModule,me.MatListModule,me.MatSliderModule,me.MatBadgeModule,Ie.IgoLanguageModule,be.IgoListModule,be.IgoCollapsibleModule,be.IgoImageModule],exports:[Ir,Mr,Dr,Er],declarations:[Ir,Mr,Dr,Er]}]}],_s);function _s(){}var Gs=(qs.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,Ie.IgoLanguageModule,be.IgoConfirmDialogModule,me.MatIconModule,me.MatButtonModule,me.MatTooltipModule],exports:[Ro,qo,No,Qo,Wo,Ko,$o],declarations:[Ro,qo,No,Qo,Wo,Ko,$o]}]}],qs);function qs(){}var Bs=(Object.defineProperty(Ns.prototype,"measure",{get:function(){return this.measure$.value},set:function(e){this.measure$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ns.prototype,"auto",{get:function(){return this._auto},set:function(e){this.toggleAutoUnit(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ns.prototype,"measureUnits",{get:function(){return this.measureType===Ei.Area?Object.values(_i):Object.values($i)},enumerable:!0,configurable:!0}),Ns.prototype.ngOnDestroy=function(){this.toggleAutoUnit(!1)},Ns.prototype.onMeasureUnitChange=function(e){this.measureUnit=e,this.measureUnitChange.emit(e)},Ns.prototype.toggleAutoUnit=function(e){var t=this;this.measure$$!==undefined&&this.measure$$.unsubscribe(),!0===e&&(this.measure$$=this.measure$.subscribe(function(e){t.computeBestMeasureUnit(e)})),this._auto=e},Ns.prototype.computeBestMeasureUnit=function(e){var t=this.measureUnit;this.measureType===Ei.Area?t=Ji(e):this.measureType===Ei.Length&&(t=Zi(e)),t!==this.measureUnit&&this.onMeasureUnitChange(t)},Ns.decorators=[{type:Se.Component,args:[{selector:"igo-measurer-item",template:'<mat-form-field class="measure-field">\r\n  <input\r\n    matInput\r\n    [readonly]="true"\r\n    [placeholder]="placeholder"\r\n    [value]="((measure$ | async) || 0) | measureFormat: measureUnit">\r\n</mat-form-field>\r\n<mat-form-field class="unit-field">\r\n  <mat-select\r\n    [value]="measureUnit"\r\n    [disabled]="auto"\r\n    (selectionChange)="onMeasureUnitChange($event.value)">\r\n    <mat-option *ngFor="let measureUnit of measureUnits" [value]="measureUnit">\r\n      {{(\'igo.geo.measure.\' + measureUnit) | translate}}\r\n    </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{display:flex;width:100%;padding:5px 10px}.measure-field{display:flex;flex-flow:column nowrap;width:100%}.unit-field{width:110px;margin-left:10px}"]}]}],Ns.ctorParameters=function(){return[]},Ns.propDecorators={measureType:[{type:Se.Input}],measureUnit:[{type:Se.Input}],measure:[{type:Se.Input}],auto:[{type:Se.Input}],placeholder:[{type:Se.Input}],measureUnitChange:[{type:Se.Output}]},Ns);function Ns(){this.measure$=new fe.BehaviorSubject(undefined),this._auto=!1,this.measureUnitChange=new Se.EventEmitter}var Vs=(Us.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatButtonModule,me.MatButtonToggleModule,me.MatIconModule,me.MatTooltipModule,me.MatFormFieldModule,me.MatInputModule,me.MatSelectModule,me.MatSlideToggleModule,Ie.IgoLanguageModule,be.IgoEntityTableModule],declarations:[Na,Bs,qa,_a],exports:[Na,qa],entryComponents:[_a]}]}],Us);function Us(){}var Ws=(zs.decorators=[{type:Se.NgModule,args:[{imports:[],declarations:[],exports:[Vs]}]}],zs);function zs(){}var Ks={None:0,Move:1,Zoom:2,ZoomIfOutMapExtent:3};Ks[Ks.None]="None",Ks[Ks.Move]="Move",Ks[Ks.Zoom]="Zoom",Ks[Ks.ZoomIfOutMapExtent]="ZoomIfOutMapExtent";var Hs=(Qs.prototype.setFeatures=function(e,t){void 0===t&&(t=Ks.None),this.features$.next([e,t])},Qs.prototype.clear=function(){this.features$.next([[],Ks.None])},Qs.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Qs.ctorParameters=function(){return[]},Qs.ngInjectableDef=Se.defineInjectable({factory:function(){return new Qs},token:Qs,providedIn:"root"}),Qs);function Qs(){this.features$=new fe.BehaviorSubject([[],undefined])}var Ys=(Object.defineProperty(Zs.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Zs.prototype.ngOnInit=function(){var t=this;this.features$$=this.overlayService.features$.subscribe(function(e){return t.handleFeatures(e[0],e[1])})},Zs.prototype.ngOnDestroy=function(){this.features$$.unsubscribe()},Zs.prototype.handleFeatures=function(e,t){},Zs.decorators=[{type:Se.Directive,args:[{selector:"[igoOverlay]"}]}],Zs.ctorParameters=function(){return[{type:Ro,decorators:[{type:Se.Self}]},{type:Hs}]},Zs);function Zs(e,t){this.component=e,this.overlayService=t,this.format=new ye}var Js=(Xs.forRoot=function(){return{ngModule:Xs}},Xs.decorators=[{type:Se.NgModule,args:[{imports:[],exports:[Ys],declarations:[Ys]}]}],Xs);function Xs(){}var el=oe,tl=(rl.prototype.print=function(t,r){var o=this,n=new fe.Subject,e=r.paperFormat,i=+r.resolution,a=r.orientation;this.activityId=this.activityService.register();var s=new re({orientation:a,format:e.toLowerCase()}),l=[s.internal.pageSize.width,s.internal.pageSize.height],u=[20,10,20,10],c=[l[0]-u[3]-u[1],l[1]-u[0]-u[2]];return r.title!==undefined&&this.addTitle(s,r.title,l[0]),!0!==r.showProjection&&!0!==r.showScale||this.addProjScale(s,t,i,r.showProjection,r.showScale),""!==r.comment&&this.addComment(s,r.comment),this.addMap(s,t,i,c,u).subscribe(function(e){e===Fe.SubjectStatus.Done&&(!0===r.showLegend?o.addLegend(s,t,u,i):o.saveDoc(s)),e!==Fe.SubjectStatus.Done&&e!==Fe.SubjectStatus.Error||(o.activityService.unregister(o.activityId),n.next(Fe.SubjectStatus.Done))}),n},rl.prototype.getLayersLegendHtml=function(e,t,r){var o="",n=sr(e.layers,e.viewController.getScale(r));return 0===n.length?o:(o+='<style media="screen" type="text/css">',o+=".html2canvas-container { width: "+t,o+="mm !important; height: 2000px !important; }",o+="</style>",o+='<font size="2" face="Courier New" >',o+='<div style="display:inline-block;max-width:'+t+'mm">',n.forEach(function(e){o+='<table border=1 style="display:inline-block;vertical-align:top">',o+='<tr><th width="170px">'+e.title+"</th>",o+='<td><img class="printImageLegend" src="'+e.url+'">',o+="</td></tr></table>"}),o+="</div>")},rl.prototype.getLayersLegendImage=function(e,o,n,t){void 0===o&&(o="png");var i=new fe.Subject,r=this.getLayersLegendHtml(e,200,t),a=this;o=o.toLowerCase(),0===r.length&&(r='<font size="12" face="Courier New" >',r+='<div align="center"><b>NO LEGEND</b></div>');var s=window.document.createElement("div");window.document.body.appendChild(s),s.innerHTML=r,setTimeout(function(){el(s,{useCORS:!0}).then(function(e){var t=Fe.SubjectStatus.Done;try{n?a.generateCanvaFileToZip(e,"legendImage."+o):a.saveCanvasImageAsFile(e,"legendImage",o),s.parentNode.removeChild(s)}catch(r){t=Fe.SubjectStatus.Error}i.next(t)})},500)},rl.prototype.addTitle=function(e,t,r){var o,n=812.8/96*t.length;o=r<n?0:(r-n)/2,e.setFont("courier"),e.setFontSize(32),e.text(t,o,15)},rl.prototype.addComment=function(e,t){var r=e.internal.pageSize.height-5;e.setFont("courier"),e.setFontSize(16),e.text(t,20,r)},rl.prototype.addProjScale=function(e,t,r,o,n){var i=this.languageService.translate,a=e.internal.pageSize.height-15,s="";!0===o&&(s+=i.instant("igo.geo.printForm.projection")+": "+t.projection),!0===n&&(!0===o&&(s+="   "),s+=i.instant("igo.geo.printForm.scale")+" ~ 1 "+Fo(t.viewController.getScale(r))),e.setFont("courier"),e.setFontSize(16),e.text(s,20,a)},rl.prototype.addLegend=function(o,e,n,t){var i=this,a=this,r=o.internal.pageSize.width,s=this.getLayersLegendHtml(e,r,t);if(""===s)return this.saveDoc(o),!0;var l=window.document.createElement("div");el(l,{useCORS:!0}).then(function(e){var t;t=e.toDataURL("image/png"),o.addPage();var r=i.getImageSizeToFitPdf(o,e,n);o.addImage(t,"PNG",10,10,r[0],r[1]),a.saveDoc(o),l.parentNode.removeChild(l)}),window.document.body.appendChild(l),l.innerHTML=s},rl.prototype.addCanvas=function(e,t,r){var o;if((o=t.toDataURL("image/jpeg"))!==undefined){var n=this.getImageSizeToFitPdf(e,t,r);e.addImage(o,"JPEG",r[3],r[0],n[0],n[1]),e.rect(r[3],r[0],n[0],n[1])}},rl.prototype.addMap=function(i,a,e,t,s){var l,u=this,c=new fe.Subject,p=a.ol.getSize(),d=a.ol.getView().calculateExtent(p),r=Math.round(t[0]*e/25.4),o=Math.round(t[1]*e/25.4);return a.ol.once("postcompose",function(e){var o=e.context.canvas,n=a.status$.subscribe(function(e){if(clearTimeout(l),e===Fe.SubjectStatus.Done){n.unsubscribe();var t=Fe.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(r){t=Fe.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(t)}});l=window.setTimeout(function(){n.unsubscribe();var e=Fe.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(t){e=Fe.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(e)},200)}),this.renderMap(a,[r,o],d),c},rl.prototype.defineNbFileToProcess=function(e){this.nbFileToProcess=e},rl.prototype.downloadMapImage=function(x,M,T,C,L,e,P,D,j){var k=this;void 0===T&&(T="png"),void 0===C&&(C=!1),void 0===L&&(L=!1),void 0===e&&(e=!1),void 0===P&&(P=""),void 0===D&&(D=""),void 0===j&&(j=!0);var R=new fe.Subject;this.activityId=this.activityService.register();var E=this.languageService.translate;x.ol.once("postcompose",function(e){T=T.toLowerCase();var t=e.context,r=document.createElement("canvas"),o=r.getContext("2d"),n=0,i=10,a=t.canvas.width,s=t.canvas.height;o.font="20px Calibri";var l=o.measureText(D).width;s=""!==P?s+30:s;var u=(s=!1!==C||!1!==L?s+30:s)-10,c=Math.ceil(l/a),p=(s=""!==D?s+30*c:s)-20*c+5;if(r.width=a,r.height=s,"jpeg"===T&&(o.fillStyle="#ffffff",o.fillRect(0,0,a,s),o.fillStyle="#000000"),""!==P&&(o.font="26px Calibri",n=30,o.textAlign="center",o.fillText(P,a/2,20)),!(o.font="20px Calibri")!==C){var d=E.instant("igo.geo.printForm.projection");o.textAlign="start",o.fillText(d+": "+x.projection,i,u),i+=200}if(!1!==L){var g=E.instant("igo.geo.printForm.scale"),h=x.viewController.getScale(M);o.textAlign="start",o.fillText(g+" ~ 1 : "+Fo(h),i,u)}if(""!==D)if(o.textAlign="center",1===c)o.fillText(D,a/2,p);else for(var f=D.length,y=Math.floor(f/c),m="",v=0,b=void 0,S=0;S<c;S++)S<c-1?(b=(m=D.substr(v,y)).lastIndexOf(" "),o.fillText(m.substr(0,b),a/2,p),v+=b,p+=20):o.fillText(D.substr(v),a/2,p);o.drawImage(t.canvas,0,n);var w=Fe.SubjectStatus.Done;try{j?"tiff"===T.toLowerCase()?k.generateCanvaFileToZip(r,"map"+x.projection.replace(":","_")+"."+T):k.generateCanvaFileToZip(r,"map."+T):k.saveCanvasImageAsFile(r,"map",T)}catch(I){w=Fe.SubjectStatus.Error}if(R.next(w),"tiff"===T.toLowerCase()){var O=k.getWorldFileInformation(x),F=new Blob([O],{type:"text/plain;charset=utf-8"});j?k.addFileToZip("map"+x.projection.replace(":","_")+".tfw",F):(te.saveAs(F,"map"+x.projection+".tfw"),k.saveFileProcessing())}}),x.ol.renderSync()},rl.prototype.renderMap=function(e,t,r){e.ol.renderSync()},rl.prototype.saveDoc=function(e){e.save("map.pdf")},rl.prototype.getImageSizeToFitPdf=function(e,t,r){var o=e.internal.pageSize.getHeight()-(r[0]+r[2]),n=e.internal.pageSize.getWidth()-(r[1]+r[3]),i=t.height,a=t.width,s=i/o,l=a/n,u=l<s?s:l;return[1<u?a/u:a,1<u?i/u:i]},rl.prototype.getWorldFileInformation=function(e){var t=e.viewController.getResolution(),r=e.getExtent();return[t,0,0,-t,r[0]+t/.5,r[3]-t/.5].join("\n")},rl.prototype.saveCanvasImageAsFile=function(e,t,r){var o="image/"+r,n=this;try{e.toDataURL(),navigator.msSaveBlob?(navigator.msSaveBlob(e.msToBlob(),t+"."+r),this.saveFileProcessing()):e.toBlob(function(e){te.saveAs(e,t+"."+r),n.saveFileProcessing()},o)}catch(i){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},rl.prototype.generateCanvaFileToZip=function(e,t){var r=this;this.hasOwnProperty("zipFile")&&"undefined"!=typeof this.zipFile||(this.zipFile=new ne);try{e.toDataURL(),navigator.msSaveBlob?this.addFileToZip(t,e.msToBlob()):e.toBlob(function(e){r.addFileToZip(t,e)},"image/jpeg")}catch(o){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},rl.prototype.addFileToZip=function(e,t){this.zipFile.file(e,t),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))},rl.prototype.saveFileProcessing=function(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)},rl.prototype.getZipFile=function(){var t=this;this.zipFile.generateAsync({type:"blob"}).then(function(e){te.saveAs(e,"map.zip"),delete t.zipFile})},rl.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],rl.ctorParameters=function(){return[{type:Ie.MessageService},{type:Ie.ActivityService},{type:Ie.LanguageService}]},rl.ngInjectableDef=Se.defineInjectable({factory:function(){return new rl(Se.inject(Ie.MessageService),Se.inject(Ie.ActivityService),Se.inject(Ie.LanguageService))},token:rl,providedIn:"root"}),rl);function rl(e,t,r){this.messageService=e,this.activityService=t,this.languageService=r}var ol=(Object.defineProperty(nl.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(nl.prototype,"outputFormat",{get:function(){return this._outputFormat},set:function(e){this._outputFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(nl.prototype,"paperFormat",{get:function(){return this._paperFormat},set:function(e){this._paperFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(nl.prototype,"orientation",{get:function(){return this._orientation},set:function(e){this._orientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(nl.prototype,"imageFormat",{get:function(){return this._imageFormat},set:function(e){this._imageFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(nl.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!0,configurable:!0}),nl.prototype.handleFormSubmit=function(e){if((this.disabled=!0)===e.isPrintService)this.printService.print(this.map,e).subscribe();else{var t=1;e.showLegend&&t++,"tiff"===e.imageFormat.toLowerCase()&&t++,this.printService.defineNbFileToProcess(t);var r=+e.resolution;this.printService.downloadMapImage(this.map,r,e.imageFormat,e.showProjection,e.showScale,e.showLegend,e.title,e.comment,e.doZipFile),e.showLegend&&this.printService.getLayersLegendImage(this.map,e.imageFormat,e.doZipFile,+r)}this.disabled=!1},nl.decorators=[{type:Se.Component,args:[{selector:"igo-print",template:'<igo-print-form\r\n  [outputFormat]="outputFormat"\r\n  [paperFormat]="paperFormat"\r\n  [orientation]="orientation"\r\n  [imageFormat]="imageFormat"\r\n  [resolution]="resolution"\r\n  [disabled]="disabled"\r\n  (submit)="handleFormSubmit($event)">\r\n</igo-print-form>\r\n'}]}],nl.ctorParameters=function(){return[{type:tl}]},nl.propDecorators={map:[{type:Se.Input}],outputFormat:[{type:Se.Input}],paperFormat:[{type:Se.Input}],orientation:[{type:Se.Input}],imageFormat:[{type:Se.Input}],resolution:[{type:Se.Input}]},nl);function nl(e){this.printService=e,this.disabled=!1}var il=Fe.strEnum(["Pdf","Image"]),al=Fe.strEnum(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),sl=Fe.strEnum(["landscape","portrait"]),ll=Fe.strEnum(["72","96","150","300"]),ul=Fe.strEnum(["Bmp","Gif","Jpeg","Png","Tiff"]),cl=(Object.defineProperty(pl.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"imageFormat",{get:function(){return this.imageFormatField.value},set:function(e){this.imageFormatField.setValue(e||ul.Jpeg,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"outputFormat",{get:function(){return this.outputFormatField.value},set:function(e){this.outputFormatField.setValue(e||il.Pdf,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"paperFormat",{get:function(){return this.paperFormatField.value},set:function(e){this.paperFormatField.setValue(e||al.Letter,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"orientation",{get:function(){return this.orientationField.value},set:function(e){this.orientationField.setValue(e||sl.landscape,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"resolution",{get:function(){return this.resolutionField.value},set:function(e){this.resolutionField.setValue(e||ll[96],{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"title",{get:function(){return this.titleField.value},set:function(e){this.titleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"comment",{get:function(){return this.commentField.value},set:function(e){this.commentField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"showProjection",{get:function(){return this.showProjectionField.value},set:function(e){this.showProjectionField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"showScale",{get:function(){return this.showScaleField.value},set:function(e){this.showScaleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"showLegend",{get:function(){return this.showLegendField.value},set:function(e){this.showLegendField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"doZipFile",{get:function(){return this.doZipFileField.value},set:function(e){this.doZipFileField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"outputFormatField",{get:function(){return this.form.controls.outputFormat},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"paperFormatField",{get:function(){return this.form.controls.paperFormat},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"imageFormatField",{get:function(){return this.form.controls.imageFormat},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"orientationField",{get:function(){return this.form.controls.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"resolutionField",{get:function(){return this.form.controls.resolution},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"commentField",{get:function(){return this.form.controls.comment},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"showProjectionField",{get:function(){return this.form.controls.showProjection},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"showScaleField",{get:function(){return this.form.controls.showScale},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"showLegendField",{get:function(){return this.form.controls.showLegend},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"doZipFileField",{get:function(){return this.form.controls.doZipFile},enumerable:!0,configurable:!0}),Object.defineProperty(pl.prototype,"titleField",{get:function(){return this.form.controls.title},enumerable:!0,configurable:!0}),pl.prototype.ngOnInit=function(){this.doZipFileField.setValue(!1)},pl.prototype.handleFormSubmit=function(e,t){this.submitted=!0,e.isPrintService=this.isPrintService,t&&this.submit.emit(e)},pl.prototype.toggleImageSaveProp=function(){"Image"===this.outputFormatField.value?this.isPrintService=!1:this.isPrintService=!0},pl.decorators=[{type:Se.Component,args:[{selector:"igo-print-form",template:'<form class="igo-form" [formGroup]="form">\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="title"\r\n        placeholder="{{\'igo.geo.printForm.title\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="comment"\r\n        placeholder="{{\'igo.geo.printForm.comment\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <div class="print-slide-toggle-container">\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showProjection"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showProjection\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showScale"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showScale\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showLegend"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showLegend\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="doZipFile"\r\n        [labelPosition]="\'before\'"\r\n        [style.display]="isPrintService ? \'none\' : \'\'">\r\n        {{\'igo.geo.printForm.doZipFile\' | translate}}\r\n      </mat-slide-toggle>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <mat-select (selectionChange)="toggleImageSaveProp()"\r\n        formControlName="outputFormat"\r\n        placeholder="{{\'igo.geo.printForm.outputFormat\' | translate}}">\r\n        <mat-option *ngFor="let outputFormat of outputFormats | keyvalue " [value]="outputFormat.key">\r\n            {{outputFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="paperFormat"\r\n        placeholder="{{\'igo.geo.printForm.paperFormat\' | translate}}">\r\n        <mat-option *ngFor="let paperFormat of paperFormats | keyvalue " [value]="paperFormat.key">\r\n          {{(\'igo.geo.printForm.paperFormats.\' + paperFormat.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'none\' : \'block\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="imageFormat"\r\n        placeholder="{{\'igo.geo.printForm.imageFormat\' | translate}}">\r\n        <mat-option *ngFor="let imageFormat of imageFormats | keyvalue " [value]="imageFormat.key">\r\n          {{imageFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" style="display: none;">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="resolution"\r\n        placeholder="{{\'igo.geo.printForm.resolution\' | translate}}">\r\n        <mat-option *ngFor="let resolution of resolutions | keyvalue " [value]="resolution.key">\r\n          {{resolution.value + \' PPI\'}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="orientation"\r\n        placeholder="{{\'igo.geo.printForm.orientation\' | translate}}">\r\n        <mat-option *ngFor="let orientation of orientations | keyvalue " [value]="orientation.key">\r\n          {{(\'igo.geo.printForm.\' + orientation.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-form-button-group print-button-top-padding">\r\n    <button\r\n      mat-raised-button\r\n      type="button"\r\n      [disabled]="!form.valid || disabled"\r\n      (click)="handleFormSubmit(form.value, form.valid)">\r\n      {{\'igo.geo.printForm.saveBtn\' | translate}}\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n',styles:["mat-form-field{width:100%}.print-slide-toggle-container{overflow-x:hidden}.print-slide-toggle-container mat-slide-toggle{width:100%;margin:10px}.print-slide-toggle-container mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px);font-size:16px}.print-option{display:block;margin-right:10px;margin-bottom:15px}.print-button-top-padding{padding-top:25px}.igo-form{padding:10px 5px 5px}.igo-form-button-group{text-align:center}"]}]}],pl.ctorParameters=function(){return[{type:he.FormBuilder}]},pl.propDecorators={disabled:[{type:Se.Input}],imageFormat:[{type:Se.Input}],outputFormat:[{type:Se.Input}],paperFormat:[{type:Se.Input}],orientation:[{type:Se.Input}],resolution:[{type:Se.Input}],title:[{type:Se.Input}],comment:[{type:Se.Input}],showProjection:[{type:Se.Input}],showScale:[{type:Se.Input}],showLegend:[{type:Se.Input}],doZipFile:[{type:Se.Input}],submit:[{type:Se.Output}]},pl);function pl(e){this.formBuilder=e,this.outputFormats=il,this.paperFormats=al,this.orientations=sl,this.resolutions=ll,this.imageFormats=ul,this.isPrintService=!0,this._disabled=!1,this.submit=new Se.EventEmitter,this.form=this.formBuilder.group({title:["",[]],comment:["",[]],outputFormat:["",[he.Validators.required]],paperFormat:["",[he.Validators.required]],imageFormat:["",[he.Validators.required]],resolution:["",[he.Validators.required]],orientation:["",[he.Validators.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}var dl=(gl.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,he.FormsModule,he.ReactiveFormsModule,me.MatIconModule,me.MatButtonModule,me.MatSelectModule,me.MatOptionModule,me.MatInputModule,me.MatFormFieldModule,me.MatSlideToggleModule,Ie.IgoLanguageModule,be.IgoKeyValueModule],exports:[ol,cl],declarations:[ol,cl]}]}],gl);function gl(){}function hl(e){return new hn(e.getConfig("searchSources."+hn.id)||{})}function fl(){return{provide:pn,useFactory:hl,multi:!0,deps:[Ie.ConfigService]}}var yl=(ml.forRoot=function(){return{ngModule:ml,providers:[fl()]}},ml.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule],exports:[un],declarations:[un],providers:[sn]}]}],ml);function ml(){}var vl=(bl.prototype.getSources=function(){return this.sources},bl.prototype.getEnabledSources=function(){return this.getSources().filter(function(e){return!0===e.enabled})},bl.prototype.enableSourcesByType=function(t){this.getSources().forEach(function(e){e.constructor.type===t?e.enabled=!0:e.enabled=!1})},bl.prototype.setParamFromSetting=function(e,t){e.setParamFromSetting(t)},bl);function bl(e){this.sources=e}function Sl(e){return e.search!==undefined}function wl(e){return e.reverseSearch!==undefined}var Ol=(Fl.prototype.search=function(e,t){if(!this.termIsValid(e))return[];var r=So(e,this.mapService.getMap().projection);if(r.lonLat)return this.reverseSearch(r.lonLat);r.message&&console.log(r.message);var o=this.searchSourceService.getEnabledSources().filter(Sl);return this.searchSources(o,e,t||{})},Fl.prototype.reverseSearch=function(e,t){var r=this.searchSourceService.getEnabledSources().filter(wl);return this.reverseSearchSources(r,e,t||{})},Fl.prototype.searchSources=function(e,t,r){return e.map(function(e){return{request:e.search(t,r),reverse:!1,source:e}})},Fl.prototype.reverseSearchSources=function(e,t,r){return e.map(function(e){return{request:e.reverseSearch(t,r),reverse:!0,source:e}})},Fl.prototype.termIsValid=function(e){return"string"==typeof e&&""!==e},Fl.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Fl.ctorParameters=function(){return[{type:vl},{type:kr}]},Fl.ngInjectableDef=Se.defineInjectable({factory:function(){return new Fl(Se.inject(vl),Se.inject(kr))},token:Fl,providedIn:"root"}),Fl);function Fl(e,t){this.searchSourceService=e,this.mapService=t}function Il(){}var xl=function Ac(e){this.sources=e};function Ml(e){return new xl(e)}function Tl(){return{provide:xl,useFactory:Ml,deps:[Il]}}var Cl=(Ll.prototype.route=function(t){var r=this;if(0!==t.length)return this.routingSourceService.sources.filter(function(e){return e.enabled}).map(function(e){return r.routeSource(e,t)})},Ll.prototype.routeSource=function(e,t){return e.route(t)},Ll.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Ll.ctorParameters=function(){return[{type:xl}]},Ll.ngInjectableDef=Se.defineInjectable({factory:function(){return new Ll(Se.inject(xl))},token:Ll,providedIn:"root"}),Ll);function Ll(e){this.routingSourceService=e}var Pl=(Dl.prototype.getStopsCoordinates=function(){return this.stopsCoordinates},Dl.prototype.setStopsCoordinates=function(e){this.stopsCoordinates=e},Dl.prototype.isMapWaitingForRoutingClick=function(){return this.mapWaitingForRoutingClick},Dl.prototype.setMapWaitingForRoutingClick=function(){this.mapWaitingForRoutingClick=!0},Dl.prototype.unsetMapWaitingForRoutingClick=function(){this.mapWaitingForRoutingClick=!1},Dl.decorators=[{type:Se.Injectable}],Dl.ctorParameters=function(){return[]},Dl);function Dl(){this.mapWaitingForRoutingClick=!1}var jl=(Object.defineProperty(kl.prototype,"term",{get:function(){return this._term},set:function(e){this._term=e},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"debounce",{get:function(){return this._debounce},set:function(e){this._debounce=e},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"length",{get:function(){return this._length},set:function(e){this._length=e},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),kl.prototype.changeRoute=function(e){this.showRouteGeometry()},kl.prototype.ngOnDestroy=function(){this.unsubscribeRoutesQueries(),this.unlistenSingleClick(),this.queryService.queryEnabled=!0;var t=[];this.stops.value.forEach(function(e){t.push(e.stopCoordinates)}),this.routingRoutesOverlayDataSource.ol.clear(),this.routingStopsOverlayDataSource.ol.clear(),this.routingFormService.setStopsCoordinates(t)},kl.prototype.ngOnInit=function(){this.browserLanguage=this.languageService.getLanguage(),this.stopsForm=this.formBuilder.group({routingType:"car",routingMode:"driving",stopOrderPriority:!0,routingFixedStartEnd:!1,stops:this.formBuilder.array([this.createStop("start"),this.createStop("end")])}),this.routingStopsOverlayDataSource=new Qe({}),this.routingRoutesOverlayDataSource=new Qe({})},kl.prototype.ngAfterViewInit=function(){var n=this;this.queryService.queryEnabled=!1,this.focusOnStop=!1;var t,e=new fr({title:"routingStopOverlay",zIndex:999,id:"routingStops",source:this.routingStopsOverlayDataSource,showInLayerList:!1}),r=new fr({title:"routingRoutesOverlay",zIndex:999,id:"routingRoutes",opacity:.75,source:this.routingRoutesOverlayDataSource,showInLayerList:!1});this.map.addLayer(r),this.map.addLayer(e);var o=new ce.Select({layers:[e.ol],condition:ue.pointerMove,hitTolerance:7}),i=new ce.Translate({layers:[e.ol],features:t}),a=new ce.Select({layers:[r.ol],condition:ue.pointerMove,hitTolerance:7});this.selectRoute=new ce.Select({layers:[r.ol],hitTolerance:7}),this.map.ol.on("pointermove",function(e){0===a.getFeatures().getLength()?n.routingFormService.unsetMapWaitingForRoutingClick():n.routingFormService.setMapWaitingForRoutingClick()}),o.on("select",function(e){t=e.target.getFeatures()[0]}),this.selectRoute.on("select",function(e){if(!1===n.focusOnStop){var t=se.transform(e.mapBrowserEvent.coordinate,n.map.projection,n.projection);n.addStop();var r=n.stops.length-2;n.stops.at(r).patchValue({stopCoordinates:t}),n.handleLocationProposals(t,r),n.addStopOverlay(t,r),n.selectRoute.getFeatures().clear()}n.selectRoute.getFeatures().clear()}),this.routesQueries$$.push(this.stopsForm.statusChanges.pipe(Oe.debounceTime(this._debounce)).subscribe(function(e){return n.onFormChange()})),i.on("translateend",function(e){var t,r=e.features.getArray()[0].getId().split("_");switch(r[1]){case"start":t=0;break;case"end":t=n.stops.length-1;break;default:t=Number(r[1])}var o=se.transform(e.features.getArray()[0].getGeometry().getCoordinates(),n.map.projection,n.projection);n.stops.at(t).patchValue({stopCoordinates:o}),n.stops.at(t).patchValue({stopProposals:[]}),n.handleLocationProposals(o,t)}),this.map.ol.addInteraction(o),this.map.ol.addInteraction(a),this.map.ol.addInteraction(this.selectRoute),this.map.ol.addInteraction(i),this.routesQueries$$.push(this.stream$.pipe(Oe.debounceTime(this._debounce),Oe.distinctUntilChanged()).subscribe(function(e){return n.handleTermChanged(e)}))},kl.prototype.handleLocationProposals=function(o,n){var i=this,a=[];this.searchService.reverseSearch(o,{zoom:this.map.getZoom()}).map(function(e){return i.routesQueries$$.push(e.request.pipe(Oe.map(function(e){return e})).subscribe(function(e){if(e.forEach(function(t){0===a.filter(function(e){return e.source===t.source}).length&&a.push({source:t.source,results:e.map(function(e){return e.data})})}),i.stops.at(n).patchValue({stopProposals:a}),e[0]){if("icherchereverse"===e[0].source.getId()){for(var t=0,r=0;r<e.length;r++)if("adresse"===e[r].data.properties.type){t=r;break}i.stops.at(n).patchValue({stopPoint:be.getEntityTitle(e[t])}),"Point"===e[t].data.geometry.type&&i.stops.at(n).patchValue({stopCoordinates:e[t].data.geometry.coordinates})}}else i.stops.at(n).patchValue({stopPoint:o}),i.stops.at(n).patchValue({stopProposals:[]})}))})},kl.prototype.routingText=function(e){return 0===e?"start":e===this.stops.length-1||1===this.stops.length?"end":"intermediate"},kl.prototype.raiseStop=function(e){0<e&&this.moveStop(e,-1)},kl.prototype.lowerStop=function(e){e<this.stops.length-1&&this.moveStop(e,1)},kl.prototype.moveStop=function(e,t){var r=this.stops.at(e);this.removeStop(e),this.stops.insert(e+t,r),this.stops.at(e).patchValue({routingText:this.routingText(e)}),this.stops.at(e+t).patchValue({routingText:this.routingText(e+t)}),this.stops.at(e).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e).value.stopCoordinates,e),this.stops.at(e+t).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e+t).value.stopCoordinates,e+t)},Object.defineProperty(kl.prototype,"stops",{get:function(){return this.stopsForm.get("stops")},enumerable:!0,configurable:!0}),kl.prototype.getStopsCoordinates=function(){var t=[];return this.stops.value.forEach(function(e){e.stopCoordinates instanceof Array&&t.push(e.stopCoordinates)}),this.routingFormService.setStopsCoordinates(t),t},kl.prototype.addStop=function(){var e=this.stops.length-1;this.stops.insert(e,this.createStop())},kl.prototype.createStop=function(e){return void 0===e&&(e="intermediate"),this.formBuilder.group({stopPoint:[""],stopProposals:[[]],routingText:e,stopCoordinates:["",[he.Validators.required]]})},kl.prototype.removeStop=function(e){var t=this;this.routingStopsOverlayDataSource.ol.clear(),this.stops.removeAt(e);var r=0;this.stops.value.forEach(function(e){t.stops.at(r).patchValue({routingText:t.routingText(r)}),t.addStopOverlay(t.stops.at(r).value.stopCoordinates,r),r++})},kl.prototype.resetForm=function(){var t=this;this.routesResults=undefined;for(var e=this.stops.length,r=0;r<e;r++)this.stops.removeAt(0);this.stops.insert(0,this.createStop("start")),this.stops.insert(1,this.createStop("end")),this.routingStopsOverlayDataSource.ol.getFeatures().forEach(function(e){t.deleteRoutingOverlaybyID(e.getId())}),this.routingRoutesOverlayDataSource.ol.clear(),this.routingStopsOverlayDataSource.ol.clear(),this.selectRoute.getFeatures().clear()},kl.prototype.onFormChange=function(){if(this.stopsForm.valid){this.routingRoutesOverlayDataSource.ol.clear();var e=this.getStopsCoordinates();2<=e.length?this.getRoutes(e):this.routingRoutesOverlayDataSource.ol.clear()}},kl.prototype.formatStep=function(e,t){return this.formatInstruction(e.maneuver.type,e.maneuver.modifier,e.name,e.maneuver.bearing_after,t,e.maneuver.exit,t===this.activeRoute.steps.length-1)},kl.prototype.formatInstruction=function(e,t,r,o,n,i,a){var s,l;void 0===a&&(a=!1);var u,c="arrow_forward",p="rotate-270",d=this.translateBearing(o),g=this.translateModifier(t),h=("straight"===t?"":"à ")+g,f=("straight"===t?"":"on the ")+g;if(t&&0<=t.search("slight")&&(f=g),"uturn"===t?(c="fast_forward",p="rotate-90"):"sharp right"===t?(c="subdirectory_arrow_right",p="icon-flipped"):"right"===t?(c="subdirectory_arrow_right",p="icon-flipped"):"slight right"===t?(c="arrow_forward",p="rotate-290"):"straight"===t?c="arrow_forward":"slight left"===t?(c="arrow_forward",p="rotate-250"):"left"===t?(c="subdirectory_arrow_left",p="icon-flipped"):"sharp left"===t&&(c="subdirectory_arrow_left",p="icon-flipped"),"turn"===e)l="straight"===t?(s="Continuer sur "+r,"Continue on "+r):"uturn"===t?(s="Faire demi-tour sur "+r,"Make u-turn on "+r):(s="Tourner "+h+" sur "+r,"Turn "+g+" onto "+r);else if("new name"===e)s="Continuer en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="explore",p="";else if("depart"===e)s="Aller en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="explore",p="";else if("arrive"===e)if(a){var y=", ";g||(y=f=h=""),s="Vous êtes arrivé"+y+h,l="You have reached your destination"+y+f}else s="Vous atteignez le point intermédiare sur "+r,l="You have reached the intermediate stop onto "+r,c="location_on",p="";else"merge"===e?(s="Continuer sur "+r,l="Continue on "+r,c="arrow_forward",p="rotate-270"):"on ramp"===e?(s="Prendre l'entrée d'autoroute "+h,l="Take the ramp "+f):"off ramp"===e?(s="Prendre la sortie d'autoroute "+h,l="Take exit "+f):"fork"===e?l=0<=t.search("left")?(s="Garder la gauche sur "+r,"Merge left onto "+r):0<=t.search("right")?(s="Garder la droite sur "+r,"Merge right onto "+r):(s="Continuer sur "+r,"Continue on "+r):"end of road"===e?(s="À la fin de la route, tourner "+g+" sur "+r,l="At the end of the road, turn "+g+" onto "+r):"use lane"===e?(s="Prendre la voie de ... ",l="Take the lane ..."):"continue"===e&&"uturn"!==t?(s="Continuer sur "+r,l="Continue on "+r,c="arrow_forward",p="rotate-270"):"roundabout"===e?(s="Au rond-point, prendre la "+i,s+=1===i?"re":"e",s+=" sortie vers "+r,l="At the roundabout, take the "+i,l+=1===i?"st":"rd",l+=" exit towards "+r,c="donut_large",p=""):"rotary"===e?(s="Rond-point rotary....",l="Roundabout rotary....",c="donut_large",p=""):"roundabout turn"===e?(s="Rond-point, prendre la ...",l="Roundabout, take the ...",c="donut_large",p=""):"exit roundabout"===e?(s="Poursuivre vers "+r,l="Continue to "+r,c="arrow_forward",p="rotate-270"):l="notification"===e?s="notification ....":"uturn"===t?(s="Faire demi-tour et continuer en direction "+d+" sur "+r,"Make u-turn and head "+d+" on "+r):s="???";return a&&(c="flag",p=""),0===n&&(c="explore",p=""),"fr"===this.browserLanguage?u=s:"en"===this.browserLanguage&&(u=l),{instruction:u,image:c,cssClass:p}},kl.prototype.translateModifier=function(e){return"uturn"===e?this.languageService.translate.instant("igo.geo.routing.uturn"):"sharp right"===e?this.languageService.translate.instant("igo.geo.routing.sharp right"):"right"===e?this.languageService.translate.instant("igo.geo.routing.right"):"slight right"===e?this.languageService.translate.instant("igo.geo.routing.slight right"):"sharp left"===e?this.languageService.translate.instant("igo.geo.routing.sharp left"):"left"===e?this.languageService.translate.instant("igo.geo.routing.left"):"slight left"===e?this.languageService.translate.instant("igo.geo.routing.slight left"):"straight"===e?this.languageService.translate.instant("igo.geo.routing.straight"):e},kl.prototype.translateBearing=function(e){return 337<=e||e<23?this.languageService.translate.instant("igo.geo.cardinalPoints.n"):e<67?this.languageService.translate.instant("igo.geo.cardinalPoints.ne"):e<113?this.languageService.translate.instant("igo.geo.cardinalPoints.e"):e<157?this.languageService.translate.instant("igo.geo.cardinalPoints.se"):e<203?this.languageService.translate.instant("igo.geo.cardinalPoints.s"):e<247?this.languageService.translate.instant("igo.geo.cardinalPoints.sw"):e<293?this.languageService.translate.instant("igo.geo.cardinalPoints.w"):e<337?this.languageService.translate.instant("igo.geo.cardinalPoints.nw"):void 0},kl.prototype.formatDistance=function(e){if(0!==e)return 1e5<=e?Math.round(e/1e3)+" km":1e4<=e?Math.round(e/100)/10+" km":100<=e?Math.round(e/100)/10+" km":e+" m"},kl.prototype.formatDuration=function(e,t){if(void 0===t&&(t=!1),3600<=e){var r=Math.floor(e/3600),o=Math.round(60*(e/3600-r));return 60===o?r+1+" h":r+" h "+o+" min"}return 60<=e?Math.round(e/60)+" min":e+" s"},kl.prototype.showSegment=function(e,t){void 0===t&&(t=!1),this.showRouteSegmentGeometry(e.geometry.coordinates,t)},kl.prototype.showRouteSegmentGeometry=function(e,t){void 0===t&&(t=!1),this.deleteRoutingOverlaybyID("endSegment");var r=new ae.LineString(e).transform("EPSG:4326","EPSG:3857").getCoordinates()[0],o=new ae.Point(r),n=new ie({geometry:o});n.setId("endSegment"),null!==o&&("Point"===o.getType()&&n.setStyle([new le.Style({geometry:o,image:new le.Circle({radius:7,stroke:new le.Stroke({color:"#FF0000",width:3})})})]),t&&this.map.viewController.zoomToExtent(n.getGeometry().getExtent()),this.routingRoutesOverlayDataSource.ol.addFeature(n))},kl.prototype.zoomRoute=function(){this.map.viewController.zoomToExtent(this.routingRoutesOverlayDataSource.ol.getExtent())},kl.prototype.showRouteGeometry=function(e){void 0===e&&(e=!1);var t=this.activeRoute.geometry.coordinates,r=new ae.LineString(t).transform("EPSG:4326","EPSG:3857");this.routingRoutesOverlayDataSource.ol.clear();var o=new ie({geometry:r});o.setStyle([new le.Style({stroke:new le.Stroke({color:"#6a7982",width:10})}),new le.Style({stroke:new le.Stroke({color:"#4fa9dd",width:6})})]),this.routingRoutesOverlayDataSource.ol.addFeature(o),e&&this.map.viewController.zoomToExtent(this.routingRoutesOverlayDataSource.ol.getExtent())},kl.prototype.getRoutes=function(e,t){var r=this;void 0===t&&(t=!1);var o=this.routingService.route(e);o&&o.map(function(e){return r.routesQueries$$.push(e.subscribe(function(e){r.routesResults=e,r.activeRoute=r.routesResults[0],r.showRouteGeometry(t)}))})},kl.prototype.unlistenSingleClick=function(){0!==this.focusKey.length&&this.focusKey.forEach(function(e){de.unByKey(e)})},kl.prototype.unsubscribeRoutesQueries=function(){this.routesQueries$$.forEach(function(e){return e.unsubscribe()}),this.routesQueries$$=[]},kl.prototype.copyLinkToClipboard=function(){if(Fe.Clipboard.copy(this.getUrl())){var e=this.languageService.translate,t=e.instant("igo.geo.routingForm.dialog.copyTitle"),r=e.instant("igo.geo.routingForm.dialog.copyMsgLink");this.messageService.success(r,t)}},kl.prototype.copyDirectionsToClipboard=function(){var o=this,n=this.languageService.translate.instant("igo.geo.routingForm.instructions")+":\n",i="",e=this.languageService.translate.instant("igo.geo.routingForm.summary")+": \n\t"+this.activeRoute.title+"\n\t"+this.formatDistance(this.activeRoute.distance)+"\n\t"+this.formatDuration(this.activeRoute.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.routingForm.stopsList")+":\n",t=this.languageService.translate.instant("igo.geo.routingForm.link")+":\n\t"+this.getUrl(),a=1;this.stops.value.forEach(function(e){var t="",r="";e.stopPoint!==e.stopCoordinates?(r=e.stopPoint,t=" ("+[e.stopCoordinates[1],e.stopCoordinates[0]].join(",")+")"):r=[e.stopCoordinates[1],e.stopCoordinates[0]].join(","),i=i+"\t"+a.toLocaleString()+". "+r+t+"\n",a++});var s=0;this.activeRoute.steps.forEach(function(e){var t=o.formatStep(e,s).instruction,r=o.formatDistance(e.distance)===undefined?"":" ("+o.formatDistance(e.distance)+")";n=n+"\t"+(s+1).toLocaleString()+". "+t+r+"\n",s++});var r=e+i+"\n"+t+"\n\n"+n;if(Fe.Clipboard.copy(r)){var l=this.languageService.translate,u=l.instant("igo.geo.routingForm.dialog.copyTitle"),c=l.instant("igo.geo.routingForm.dialog.copyMsg");this.messageService.success(c,u)}},kl.prototype.handleTermChanged=function(e){var t=this;if(e!==undefined||0!==e.length){var r=[];this.searchService.search(e).map(function(e){return t.routesQueries$$.push(e.request.subscribe(function(e){e.filter(function(e){return e.data.geometry}).forEach(function(t){0===r.filter(function(e){return e.source===t.source}).length&&r.push({source:t.source,results:e.map(function(e){return e.data})})}),t.stops.at(t.currentStopIndex).patchValue({stopProposals:r})}))})}},kl.prototype.setTerm=function(e){this.term=e,this.keyIsValid(e)&&(e.length>=this.length||0===e.length)&&this.stream$.next(e)},kl.prototype.keyIsValid=function(t){return this.invalidKeys.find(function(e){return e===t})===undefined},kl.prototype.keyup=function(t,e){var r=this,o=e.target.value;this.setTerm(o),this.map.ol.un("singleclick",function(e){r.handleMapClick(e,t)})},kl.prototype.clearStop=function(e){this.deleteRoutingOverlaybyID(this.getStopOverlayID(e)),this.stops.removeAt(e),this.stops.insert(e,this.createStop(this.routingText(e))),this.routingRoutesOverlayDataSource.ol.clear()},kl.prototype.chooseProposal=function(e,t){if(e!==undefined){var r=void 0,o=e.geometry;if("Point"===o.type)r=o.coordinates;else if(0<=o.type.search("Line")){var n=[];r=(n=o.coordinates instanceof Array?o.coordinates[Math.floor(o.coordinates.length/2)]:o.coordinates)[Math.floor(n.length/2)]}else if(0<=o.type.search("Polygon")){var i=e.extent;r=[i[0]+(i[2]-i[0])/2,i[1]+(i[3]-i[1])/2]}if(r!==undefined){this.stops.at(t).patchValue({stopCoordinates:r}),this.addStopOverlay(r,t);var a=this.routingStopsOverlayDataSource.ol.getFeatureById(this.getStopOverlayID(t)).getGeometry().getExtent();pe.intersects(a,this.map.getExtent())||this.map.viewController.moveToExtent(a)}}},kl.prototype.focus=function(t){var r=this;this.unlistenSingleClick(),this.currentStopIndex=t,this.focusOnStop=!0,this.routingFormService.setMapWaitingForRoutingClick(),this.focusKey.push(this.map.ol.once("singleclick",function(e){r.handleMapClick(e,t)}))},kl.prototype.handleMapClick=function(e,t){var r=this;this.stops.at(t).patchValue({stopProposals:[]}),this.currentStopIndex===undefined?(this.addStop(),t=this.stops.length-2,this.stops.at(t).value.stopProposals=[]):t=this.currentStopIndex;var o=se.transform(e.coordinate,this.map.projection,this.projection);this.stops.at(t).patchValue({stopCoordinates:o}),this.handleLocationProposals(o,t),this.addStopOverlay(o,t),setTimeout(function(){r.focusOnStop=!1},500),this.routingFormService.unsetMapWaitingForRoutingClick()},kl.prototype.geolocateStop=function(e){so(this.map,[this.map.geolocationFeature],Kt.Move);var t=this.map.getCenter(this.projection);this.stops.at(e).patchValue({stopCoordinates:t}),this.addStopOverlay(t,e),this.handleLocationProposals(t,e)},kl.prototype.addStopOverlay=function(e,t){var r,o=this.routingText(t);"start"===o?(r="green",this.languageService.translate.instant("igo.geo.routingForm.start")):"end"===o?(r="red",this.languageService.translate.instant("igo.geo.routingForm.end")):(r="yellow",this.languageService.translate.instant("igo.geo.routingForm.intermediate"));var n=new ae.Point(se.transform(e,this.projection,this.map.projection)),i=new ie({geometry:n}),a=this.getStopOverlayID(t);if(this.deleteRoutingOverlaybyID(a),i.setId(a),null!==n){if("Point"===n.getType()){var s=go(r);i.setStyle(s)}this.routingStopsOverlayDataSource.ol.addFeature(i)}},kl.prototype.getStopOverlayID=function(e){return"routingStop_"+(0===e?"start":e===this.stops.length-1?"end":e)},kl.prototype.deleteRoutingOverlaybyID=function(e){this.routingStopsOverlayDataSource.ol.getFeatureById(e)&&this.routingStopsOverlayDataSource.ol.removeFeature(this.routingStopsOverlayDataSource.ol.getFeatureById(e)),this.routingRoutesOverlayDataSource.ol.getFeatureById(e)&&this.routingRoutesOverlayDataSource.ol.removeFeature(this.routingRoutesOverlayDataSource.ol.getFeatureById(e))},kl.prototype.getUrl=function(){if(this.route){var e=this.route.options.routingCoordKey,t=[];this.routingFormService&&this.routingFormService.getStopsCoordinates()&&0!==this.routingFormService.getStopsCoordinates().length&&this.routingFormService.getStopsCoordinates().forEach(function(e){t.push(e)});var r="";return 2<=t.length&&(r=e+"="+t.join(";")),""+location.origin+location.pathname+"?tool=directions&"+r}},kl.decorators=[{type:Se.Component,args:[{selector:"igo-routing-form",template:'<form class="igo-form" [formGroup]="stopsForm">\r\n  \x3c!-- <div class="igo-form-button-group">\r\n\r\n  </div> --\x3e\r\n  <div #inputs formArrayName="stops" *ngFor="let stop of stops.controls; let i = index;">\r\n    <mat-list-item [formGroupName]="i">\r\n\r\n      <div class="igo-input-container">\r\n        <button *ngIf="map.geolocationFeature" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.geolocate\' | translate" (click)="geolocateStop(i)">\r\n          <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n        </button>\r\n        <mat-form-field>\r\n          <input matInput formControlName="stopPoint" [matAutocomplete]="auto" placeholder="{{\'igo.geo.routingForm.\'+stop.value.routingText | translate}}"\r\n            (focus)="focus(i)" (keyup)="keyup(i,$event)">\r\n\r\n          <mat-autocomplete #auto="matAutocomplete">\r\n            <mat-optgroup *ngFor="let source of stop.value.stopProposals" [label]="source.source" [disabled]="source.disabled">\r\n              <mat-option *ngFor="let result of source.results" [value]="result.title" (onSelectionChange)="chooseProposal(result,i)">\r\n                {{ result.title }}\r\n              </mat-option>\r\n            </mat-optgroup>\r\n          </mat-autocomplete>\r\n        </mat-form-field>\r\n        <button mat-button *ngIf="stop.value && (stop.value.stopPoint.length>0 || stop.value.stopProposals.length>0)" matSuffix mat-icon-button\r\n          aria-label="Clear" (click)="clearStop(i)">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n        \x3c!-- <div class="igo-form-button-group"> --\x3e\r\n\r\n\r\n          \x3c!-- <button *ngIf="i !== 0" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.raiseStop\' | translate"\r\n            [color]="color" (click)="raiseStop(i)">\r\n            <mat-icon svgIcon="arrow-upward"></mat-icon>\r\n          </button>\r\n          <button *ngIf="i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.lowerStop\' | translate"\r\n            [color]="color" (click)="lowerStop(i)">\r\n            <mat-icon svgIcon="arrow-downward"></mat-icon>\r\n          </button> --\x3e\r\n\r\n          <button *ngIf="i !== 0 && i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.removeStop\' | translate"\r\n            color="warn" (click)="removeStop(i)">\r\n            <mat-icon svgIcon="delete"></mat-icon>\r\n          </button>\r\n        \x3c!-- </div> --\x3e\r\n      </div>\r\n\r\n    </mat-list-item>\r\n  </div>\r\n  <div class="igo-form-button-group">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.routingForm.zoomRoute\' | translate"\r\n      *ngIf="routesResults" color="primary" (click)="zoomRoute()">\r\n      <mat-icon svgIcon="zoom-in"></mat-icon>\r\n    </button>\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.addStop\' | translate"\r\n      color="primary" (click)="addStop()">\r\n      <mat-icon svgIcon="map-marker-plus"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.resetRoutingBtn\' | translate"\r\n      *ngIf="routesResults" color="warn" (click)="resetForm()">\r\n      <mat-icon svgIcon="restore-page"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.copy\' | translate"\r\n      color="primary" (click)="copyDirectionsToClipboard()">\r\n      <mat-icon svgIcon="content-copy"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.link\' | translate"\r\n    color="primary" (click)="copyLinkToClipboard()">\r\n    <mat-icon svgIcon="link"></mat-icon>\r\n  </button>\r\n  </div>\r\n\r\n</form>\r\n\r\n<div class="igo-input-container" *ngIf="routesResults">\r\n  <mat-form-field *ngIf="routesResults && routesResults.length > 1">\r\n    <mat-select placeholder="{{\'igo.geo.routingForm.drivingOptions\' | translate}}" (selectionChange)="changeRoute($event)" [(ngModel)]="activeRoute">\r\n      <mat-option *ngFor="let pathRouting of routesResults; let cnt = index;" [value]="pathRouting">\r\n        Option {{cnt + 1}} : {{this.formatDistance(pathRouting.distance)}} ({{this.formatDuration(pathRouting.duration)}})\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf="routesResults && routesResults.length === 0"></mat-divider>\r\n\r\n  <mat-list>\r\n    <h3 mat-header>{{activeRoute.title}}</h3>\r\n    <h3 mat-subheader>{{this.formatDistance(activeRoute.distance)}}, {{this.formatDuration(activeRoute.duration)}}</h3>\r\n\r\n    <mat-list-item (mouseenter)="showSegment(step)" (click)="showSegment(step,true)" *ngFor="let step of activeRoute.steps; let cnt = index;"\r\n      igoListItem>\r\n      <mat-icon [ngClass]="this.formatStep(step,cnt).cssClass" mat-list-icon svgIcon="{{this.formatStep(step,cnt).image}}"></mat-icon>\r\n\r\n      <h4 mat-line (click)="showSegment(step,true)">{{cnt +1}}. {{this.formatStep(step,cnt).instruction}}</h4>\r\n      <h4 mat-line class="right">{{this.formatDistance(step.distance)}}</h4>\r\n    </mat-list-item>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n  </mat-list>\r\n\r\n</div>\r\n',styles:["mat-form-field{width:70%}.mat-list-item{height:auto}.mat-line{word-wrap:break-word!important;white-space:pre-wrap!important}.mat-line.right{text-align:right}.rotate-90{transform:rotate(90deg)}.rotate-45{transform:rotate(45deg)}.rotate-270{transform:rotate(270deg)}.rotate-250{transform:rotate(250deg)}.rotate-290{transform:rotate(290deg)}.icon-flipped{transform:scaleY(-1)}"]}]}],kl.ctorParameters=function(){return[{type:he.FormBuilder},{type:Cl},{type:Ie.LanguageService},{type:Ie.MessageService},{type:Ol},{type:sn},{type:Pl},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},kl.propDecorators={term:[{type:Se.Input}],length:[{type:Se.Input}],map:[{type:Se.Input}],submit:[{type:Se.Output}]},kl);function kl(e,t,r,o,n,i,a,s){this.formBuilder=e,this.routingService=t,this.languageService=r,this.messageService=o,this.searchService=n,this.queryService=i,this.routingFormService=a,this.route=s,this.invalidKeys=["Control","Shift","Alt"],this.projection="EPSG:4326",this.routesQueries$$=[],this.stream$=new fe.Subject,this.focusOnStop=!1,this.focusKey=[],this._term="",this._debounce=300,this._length=3,this.submit=new Se.EventEmitter}var Rl=(El.prototype.ngAfterViewInit=function(){var i=this,e=this.routingFormService.getStopsCoordinates();if(!e&&this.route&&this.route.options.routingCoordKey)this.route.queryParams.subscribe(function(e){var t=e[i.route.options.routingCoordKey],r=[];if(t){var o=t.split(";");if(2<=o.length){var n=0;o.forEach(function(e){0!==n&&n!==o.length-1&&i.component.stops.insert(n,i.component.createStop());var t=JSON.parse("["+e+"]");i.component.stops.at(n).patchValue({stopCoordinates:t}),i.component.stops.at(n).patchValue({stopPoint:t}),i.component.handleLocationProposals(t,n),r.push(t),i.component.addStopOverlay(t,n),n++}),i.component.getRoutes(r,!0)}}});else if(e)for(var t=0;t<e.length;t++)0!==t&&t!==e.length-1&&this.component.stops.insert(t,this.component.createStop()),e[t]instanceof Array&&(this.component.addStopOverlay(e[t],t),this.component.stops.at(t).patchValue({stopCoordinates:e[t]}),this.component.stops.at(t).patchValue({stopPoint:e[t]}),this.component.handleLocationProposals(e[t],t))},El.decorators=[{type:Se.Directive,args:[{selector:"[igoRoutingFormBinding]"}]}],El.ctorParameters=function(){return[{type:jl,decorators:[{type:Se.Self}]},{type:Pl},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},El);function El(e,t,r){this.component=e,this.routingFormService=t,this.route=r}var $l=(Al.forRoot=function(){return{ngModule:Al}},Al.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,he.FormsModule,he.ReactiveFormsModule,me.MatIconModule,me.MatButtonModule,me.MatListModule,me.MatDividerModule,me.MatFormFieldModule,me.MatInputModule,me.MatOptionModule,me.MatSelectModule,me.MatTooltipModule,me.MatAutocompleteModule,Ie.IgoLanguageModule],exports:[jl,Rl],declarations:[jl,Rl],providers:[Pl,Tl()]}]}],Al);function Al(){}function _l(e){return new vl(e)}function Gl(){return{provide:vl,useFactory:_l,deps:[pn]}}var ql=(Bl.getGoogleMapsLink=function(e,t){return"https://www.google.com/maps?q="+t+","+e},Bl.getGoogleStreetViewLink=function(e,t){return"https://www.google.com/maps?q=&layer=c&cbll="+t+","+e},Bl);function Bl(){}var Nl=(Vl.prototype.formatResult=function(e){return e},Vl.decorators=[{type:Se.Injectable}],Vl.ctorParameters=function(){return[{type:Ie.LanguageService}]},Vl);function Vl(e){this.languageService=e}var Ul,Wl=(je(zl,Ul=pn),zl.prototype.getId=function(){return zl.id},zl.prototype.getDefaultOptions=function(){return{title:"ICherche Québec",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche/geocode",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"Adresse",value:"adresses",enabled:!0},{title:"Code Postal",value:"codes-postaux",enabled:!0},{title:"Route",value:"routes",enabled:!1},{title:"Municipalité",value:"municipalites",enabled:!0},{title:"mrc",value:"mrc",enabled:!0},{title:"Région administrative",value:"regadmin",enabled:!0},{title:"Lieu",value:"lieux",enabled:!0},{title:"Borne",value:"bornes",enabled:!1},{title:"Entreprise",value:"entreprises",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"trust level",name:"ecmax",values:[{title:"10",value:10,enabled:!1},{title:"30",value:30,enabled:!0},{title:"50",value:50,enabled:!1},{title:"75",value:75,enabled:!1},{title:"100",value:100,enabled:!1}]}]}},zl.prototype.search=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Oe.map(function(e){return r.extractResults(e)}))},zl.prototype.computeRequestParams=function(e,t){return new we.HttpParams({fromObject:Object.assign({q:this.computeTerm(e),geometry:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes"},this.params,this.computeOptionsParam(e,t||{}).params)})},zl.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.formatter.formatResult(t.dataToResult(e))})},zl.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,t.code].join("."),o=e.highlight.title2?" <small> "+e.highlight.title2+"</small>":"";return{source:this,data:{type:zt,projection:"EPSG:4326",geometry:e.geometry,extent:e.bbox,properties:t,meta:{id:r,title:e.properties.nom}},meta:{dataType:zt,id:r,title:e.properties.nom,titleHtml:e.highlight.title+o,icon:"map-marker"}}},zl.prototype.computeProperties=function(e){var t=Fe.ObjectUtils.removeKeys(e.properties,zl.propertiesBlacklist),r={GoogleMaps:ql.getGoogleMapsLink(e.geometry.coordinates[0],e.geometry.coordinates[1])};return"Point"===e.geometry.type&&(r.GoogleStreetView=ql.getGoogleStreetViewLink(e.geometry.coordinates[0],e.geometry.coordinates[1])),Object.assign(t,{type:e.index},r)},zl.prototype.computeTerm=function(e){return e.replace(/(#[^\s]*)/g,"")},zl.prototype.computeOptionsParam=function(e,t){var r=this,o=e.match(/(#[^\s]+)/g);if(o){var n="",i=!1;o.forEach(function(e){Ul.prototype.hashtagValid.call(r,Ul.prototype.getSettingsValues.call(r,"type"),e,!0)&&(n+=e.substring(1)+",",i=!0)}),i&&(t.params=Object.assign(t.params||{},{type:n.slice(0,-1)}))}return t},zl.id="icherche",zl.type=zt,zl.propertiesBlacklist=[],zl.decorators=[{type:Se.Injectable}],zl.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]},{type:Nl,decorators:[{type:Se.Inject,args:[Nl]}]}]},zl);function zl(e,t,r){var o=Ul.call(this,t)||this;return o.http=e,o.formatter=r,o}var Kl,Hl=(je(Ql,Kl=pn),Ql.prototype.getId=function(){return Ql.id},Ql.prototype.getDefaultOptions=function(){return{title:"Territoire (Géocodage inversé)",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/territoires/locate",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"Adresse",value:"adresses",enabled:!0},{title:"Route",value:"routes",enabled:!1},{title:"Arrondissement",value:"arrondissements",enabled:!1},{title:"Municipalité",value:"municipalites",enabled:!0},{title:"mrc",value:"mrc",enabled:!0},{title:"Région administrative",value:"regadmin",enabled:!0}]}]}},Ql.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Oe.map(function(e){return r.extractResults(e)}))},Ql.prototype.computeRequestParams=function(e,t){var r=t.distance;return new we.HttpParams({fromObject:Object.assign({loc:e.join(","),buffer:r?String(r):"100",geometry:!0},this.params,t.params||{})})},Ql.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},Ql.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeExtent(e),o=[this.getId(),t.type,t.code].join(".");return{source:this,data:{type:zt,projection:"EPSG:4326",geometry:e.geometry,extent:r,properties:t,meta:{id:o,title:e.properties.nom}},meta:{dataType:zt,id:o,title:e.properties.nom,icon:"map-marker"}}},Ql.prototype.computeProperties=function(e){return Fe.ObjectUtils.removeKeys(e.properties,Ql.propertiesBlacklist)},Ql.prototype.computeExtent=function(e){return e.bbox?[e.bbox[0],e.bbox[2],e.bbox[1],e.bbox[3]]:undefined},Ql.id="icherchereverse",Ql.type=zt,Ql.propertiesBlacklist=["doc_type"],Ql.decorators=[{type:Se.Injectable}],Ql.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},Ql);function Ql(e,t){var r=Kl.call(this,t)||this;return r.http=e,r}function Yl(e){return new Nl(e)}function Zl(){return{provide:Nl,useFactory:Yl,deps:[Ie.LanguageService]}}function Jl(e,t,r){return new Wl(e,t.getConfig("searchSources."+Wl.id),r)}function Xl(e,t){return new Hl(e,t.getConfig("searchSources."+Hl.id))}var eu=(tu.prototype.formatResult=function(e){return e},tu.decorators=[{type:Se.Injectable}],tu.ctorParameters=function(){return[{type:Ie.LanguageService}]},tu);function tu(e){this.languageService=e}var ru,ou=(je(nu,ru=pn),nu.prototype.getId=function(){return nu.id},nu.prototype.getDefaultOptions=function(){return{title:"Coordinates"}},nu.prototype.reverseSearch=function(e,t){return fe.of([this.dataToResult(e)])},nu.prototype.dataToResult=function(e){return{source:this,data:{type:zt,projection:"EPSG:4326",geometry:{type:"Point",coordinates:[e[0],e[1]]},extent:undefined,properties:{type:"point",coordonnees:String(e[0])+", "+String(e[1]),format:"degrés decimaux",systemeCoordonnees:"WGS84",GoogleMaps:ql.getGoogleMapsLink(e[0],e[1]),GoogleStreetView:ql.getGoogleStreetViewLink(e[0],e[1])}},meta:{dataType:zt,id:"1",title:String(e[0])+", "+String(e[1]),icon:"map-marker"}}},nu.id="coordinatesreverse",nu.type=zt,nu.decorators=[{type:Se.Injectable}],nu.ctorParameters=function(){return[{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},nu);function nu(e){return ru.call(this,e)||this}function iu(e){return new eu(e)}function au(){return{provide:eu,useFactory:iu,deps:[Ie.LanguageService]}}function su(e){return new ou(e.getConfig("searchSources."+ou.id))}var lu=[zt,Ht],uu=(cu.prototype.formatResult=function(e){var s=this,r=["title","abstract","groupTitle","metadataUrl"],t=Object.entries(e.properties).filter(function(e){var t=Ae(e,1)[0];return-1!==r.indexOf(t)}).reduce(function(e,t){var r,o=Ae(t,2),n=o[0],i=o[1];try{r=s.languageService.translate.instant("igo.geo.search.ilayer.properties."+n)}catch(a){r=n}return e[r]=i||"",e},{}),o=Object.assign({},e);return o.properties=t,o},cu.decorators=[{type:Se.Injectable}],cu.ctorParameters=function(){return[{type:Ie.LanguageService}]},cu);function cu(e){this.languageService=e}var pu,du=(je(gu,pu=pn),Object.defineProperty(gu.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),gu.prototype.getId=function(){return gu.id},gu.prototype.getDefaultOptions=function(){return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search"}},gu.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Oe.map(function(e){return r.extractResults(e)}))},gu.prototype.computeSearchRequestParams=function(e,t){return new we.HttpParams({fromObject:Object.assign({q:e},this.params,t.params||{})})},gu.prototype.extractResults=function(e){var t=this;return e.items.map(function(e){return t.dataToResult(e)})},gu.prototype.dataToResult=function(e){var t=this.computeLayerOptions(e);return{source:this,meta:{dataType:Ht,id:[this.getId(),e.properties.id].join("."),title:e.properties.title,titleHtml:e.highlight.title,icon:"Layer"===e.properties.type?"layers":"map"},data:t}},gu.prototype.computeLayerOptions=function(e){var t=e.properties.url,r=this.extractQueryParamsFromSourceUrl(t);return{sourceOptions:{id:e.properties.id,crossOrigin:"anonymous",type:e.properties.format,url:t,queryFormat:r.queryFormat,queryHtmlTarget:r.queryHtmlTarget,queryable:e.properties.queryable,params:{layers:e.properties.name}},title:e.properties.title,properties:this.formatter.formatResult(e).properties}},gu.prototype.extractQueryParamsFromSourceUrl=function(o){var e,t,r,n=St.GML2,i=this.options.queryFormat;if(i){var a=function(t){var e=i[t];if("*"===e)return n=St[t.toUpperCase()],"break";var r=e.urls;return Array.isArray(r)?(r.forEach(function(e){-1!==o.indexOf(e)&&(n=St[t.toUpperCase()])}),"break"):void 0};try{for(var s=$e(Object.keys(i)),l=s.next();!l.done&&"break"!==a(l.value);l=s.next());}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}}return n===St.HTML&&(r="iframe"),{queryFormat:n,queryHtmlTarget:r}},gu.id="ilayer",gu.type=Ht,gu.decorators=[{type:Se.Injectable}],gu.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.LanguageService},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]},{type:uu,decorators:[{type:Se.Inject,args:[uu]}]}]},gu);function gu(e,t,r,o){var n=pu.call(this,r)||this;return n.http=e,n.languageService=t,n.formatter=o,n.title$=new fe.BehaviorSubject(""),n.languageService.translate.get(n.options.title).subscribe(function(e){return n.title$.next(e)}),n}function hu(e){return new uu(e)}function fu(){return{provide:uu,useFactory:hu,deps:[Ie.LanguageService]}}function yu(e,t,r,o){return new du(e,t,r.getConfig("searchSources."+du.id),o)}var mu,vu=(je(bu,mu=pn),bu.prototype.getId=function(){return bu.id},bu.prototype.getDefaultOptions=function(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"Restauration",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"Santé",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"Divertissement",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"Finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"country limitation",name:"countrycodes",values:[{title:"Canada",value:"CA",enabled:!0},{title:"Le monde",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"Oui",value:0,enabled:!1},{title:"Non",value:1,enabled:!0}]}]}},bu.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Oe.map(function(e){return r.extractResults(e)}))},bu.prototype.computeSearchRequestParams=function(e,t){return new we.HttpParams({fromObject:Object.assign({q:this.computeTerm(e),format:"json"},this.params,t.params||{})})},bu.prototype.extractResults=function(e){var t=this;return e.map(function(e){return t.dataToResult(e)})},bu.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeGeometry(e),o=this.computeExtent(e),n=[this.getId(),"place",e.place_id].join(".");return{source:this,meta:{dataType:zt,id:n,title:e.display_name,icon:"map-marker"},data:{type:zt,projection:"EPSG:4326",geometry:r,extent:o,properties:t,meta:{id:n,title:e.display_name}}}},bu.prototype.computeProperties=function(e){return{display_name:e.display_name,place_id:e.place_id,osm_type:e.osm_type,"class":e["class"],type:e.type}},bu.prototype.computeGeometry=function(e){return{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}},bu.prototype.computeExtent=function(e){return[parseFloat(e.boundingbox[2]),parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[3]),parseFloat(e.boundingbox[1])]},bu.prototype.computeTerm=function(e){return e=this.computeTermTags(e)},bu.prototype.computeTermTags=function(t){var r=this,e=t.match(/(#[^\s]+)/g),o=!0;return e&&(e.forEach(function(e){t=t.replace(e,""),mu.prototype.hashtagValid.call(r,mu.prototype.getSettingsValues.call(r,"amenity"),e)&&(t+="+["+e.substring(1)+"]",o=!1)}),o=!1),o&&(t=this.computeTermSettings(t)),t},bu.prototype.computeTermSettings=function(t){return this.options.settings.forEach(function(e){"amenity"===e.name&&e.values.forEach(function(e){e.enabled&&"string"==typeof e.value&&e.value.split(",").forEach(function(e){t+="+["+e+"]"})})}),t},bu.id="nominatim",bu.type=zt,bu.decorators=[{type:Se.Injectable}],bu.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},bu);function bu(e,t){var r=mu.call(this,t)||this;return r.http=e,r}function Su(e,t){return new vu(e,t.getConfig("searchSources."+vu.id))}var wu,Ou=(je(Fu,wu=pn),Fu.prototype.getId=function(){return Fu.id},Fu.prototype.getDefaultOptions=function(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}},Fu.prototype.search=function(e,t){var r=this,o=this.termSplitter(e,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},o);return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:n,responseType:"text"}).pipe(Oe.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:n}).pipe(Oe.map(function(e){return r.extractResults(r.extractWFSData(e))}))},Fu.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=ge.GeoJSON),r.test(t)&&(e=ge.WFS),new e},Fu.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=ge.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},Fu.prototype.termSplitter=function(e,t){var o={},n=e,r=0;return t.forEach(function(e){o[e.name]=e.defaultValue;var t=new RegExp(e.splitPrefix+"(.+)","i");t.test(n)&&(r=e.splitPrefix?r+=1:r,n=n.split(t)[1])}),0===r?o[t[0].name]=e:(n=e,_e(t).reverse().forEach(function(e){var t=new RegExp(e.splitPrefix||"(.+)","i");if(n||""!==n){var r=n.split(t);n=r[0],r[1]&&(o[e.name]=r[1].trim())}})),o},Fu.prototype.computeRequestParams=function(e,t){var r=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new we.HttpParams({fromObject:Object.assign({service:"wfs",version:r,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,e.params||{})})},Fu.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},Fu.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:zt,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:zt,id:r,title:e.properties.title,titleHtml:e.properties[o],icon:"map-marker"}}},Fu.prototype.computeProperties=function(e){return Fe.ObjectUtils.removeKeys(e.properties,Fu.propertiesBlacklist)},Fu.id="storedqueries",Fu.type=zt,Fu.propertiesBlacklist=[],Fu.decorators=[{type:Se.Injectable}],Fu.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},Fu);function Fu(e,t){var r=wu.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,!r.storedQueriesOptions.storedquery_id){var o='Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"';throw new Error(o)}if(!r.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&r.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){o="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw o+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(o)}if(!r.storedQueriesOptions.fields)throw new Error("Stored Queries :You must set a fields definition for your stored query");return r.storedQueriesOptions.fields instanceof Array||(r.storedQueriesOptions.fields=[r.storedQueriesOptions.fields]),r.multipleFieldsQuery=1<r.storedQueriesOptions.fields.length,r.storedQueriesOptions.fields.forEach(function(e,t){if(r.multipleFieldsQuery&&!e.splitPrefix&&0!==t)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!e.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}var Iu,xu=(je(Mu,Iu=pn),Mu.prototype.getId=function(){return Mu.id},Mu.prototype.getDefaultOptions=function(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}},Mu.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:o,responseType:"text"}).pipe(Oe.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:o}).pipe(Oe.map(function(e){return r.extractResults(r.extractWFSData(e))}))},Mu.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=ge.GeoJSON),r.test(t)&&(e=ge.WFS),new e},Mu.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=ge.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},Mu.prototype.computeRequestParams=function(e,t){var r={};return r[this.storedQueriesOptions.longField]=e[0],r[this.storedQueriesOptions.latField]=e[1],new we.HttpParams({fromObject:Object.assign({service:"wfs",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},r,this.params,t.params||{})})},Mu.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},Mu.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:zt,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:zt,id:r,title:e.properties[o],icon:"map-marker"}}},Mu.prototype.computeProperties=function(e){var t=Fe.ObjectUtils.removeKeys(e.properties,Mu.propertiesBlacklist);return Object.assign(t,{type:e.properties.doc_type})},Mu.id="storedqueriesreverse",Mu.type=zt,Mu.propertiesBlacklist=[],Mu.decorators=[{type:Se.Injectable}],Mu.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},Mu);function Mu(e,t){var r=Iu.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,!r.storedQueriesOptions.storedquery_id){throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"')}if(!r.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!r.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');return r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}function Tu(e,t){return new Ou(e,t.getConfig("searchSources."+Ou.id))}function Cu(e,t){return new xu(e,t.getConfig("searchSources."+xu.id))}var Lu=(Pu.prototype.ngOnInit=function(){var e=this.enabled||this.searchTypes[0];this.enableSearchType(e)},Pu.prototype.onSearchTypeChange=function(e){this.enableSearchType(e)},Pu.prototype.getSearchTypeTitle=function(e){return"search."+e.toLowerCase()+".title"},Pu.prototype.enableSearchType=function(e){this.enabled=e,this.searchSourceService.enableSourcesByType(e),this.change.emit(e)},Pu.decorators=[{type:Se.Component,args:[{selector:"igo-search-selector",template:'<div class="igo-search-selector">\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-selector-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSelectorMenu">\r\n    <mat-icon svgIcon="menu-down"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #searchSelectorMenu="matMenu"\r\n    class="no-border-radius"\r\n    xPosition="before"\r\n    yPosition="above">\r\n    <mat-radio-group\r\n      class="igo-search-selector-radio-group"\r\n      [value]="enabled"\r\n      (change)="onSearchTypeChange($event.value)">\r\n      <mat-radio-button *ngFor="let searchType of searchTypes" [value]="searchType">\r\n        {{getSearchTypeTitle(searchType) | translate}}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </mat-menu>\r\n\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".igo-search-selector-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-selector-radio-group{display:inline-flex;flex-direction:column}.igo-search-selector-radio-group mat-radio-button{margin:5px}"]}]}],Pu.ctorParameters=function(){return[{type:vl}]},Pu.propDecorators={searchTypes:[{type:Se.Input}],enabled:[{type:Se.Input}],change:[{type:Se.Output}]},Pu);function Pu(e){this.searchSourceService=e,this.searchTypes=lu,this.change=new Se.EventEmitter}var Du=(ju.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatTooltipModule,me.MatIconModule,me.MatButtonModule,me.MatMenuModule,me.MatRadioModule,me.MatTabsModule,me.MatCheckboxModule,Ie.IgoLanguageModule],exports:[Lu],declarations:[Lu]}]}],ju);function ju(){}var ku=(Ru.prototype.getSearchSources=function(){return this.searchSourceService.getSources()},Ru.prototype.settingsValueCheckedCheckbox=function(e,t,r,o){o.enabled=e.checked,t.setParamFromSetting(r)},Ru.prototype.settingsValueCheckedRadioButton=function(t,e,r,o){r.values.forEach(function(e){e.value!==o.value?e.enabled=!t.source.checked:e.enabled=t.source.checked}),e.setParamFromSetting(r)},Ru.prototype.onCheckSearchSource=function(e,t){t.enabled=e.checked},Ru.decorators=[{type:Se.Component,args:[{selector:"igo-search-settings",template:'<div class="igo-search-settings">\r\n\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-settings-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSettingsMenu">\r\n    <mat-icon svgIcon="settings"></mat-icon>\r\n  </button>\r\n  <mat-menu\r\n    #searchSettingsMenu="matMenu"\r\n    class="no-border-radius">\r\n      <ng-container *ngFor="let source of getSearchSources()">\r\n        <span class="igo-search-settings-search-source">\r\n          <mat-checkbox\r\n            class="igo-search-settings-checkbox"\r\n            [checked]="source.enabled"\r\n            [value]="source"\r\n            (click)="$event.stopPropagation()"\r\n            (change)="onCheckSearchSource($event, source)">\r\n          </mat-checkbox>\r\n          <button *ngIf="source.settings.length > 0"\r\n            [matMenuTriggerFor]="sub_menu"\r\n            mat-menu-item>{{source.title}}\r\n          </button>\r\n          <button\r\n            mat-menu-item\r\n            *ngIf="source.settings.length === 0">\r\n            {{source.title}}\r\n          </button>\r\n        </span>\r\n          <mat-menu #sub_menu="matMenu">\r\n            <ng-container *ngFor="let setting of source.settings">\r\n              <button\r\n                  mat-menu-item\r\n                  [matMenuTriggerFor]="test_sub_menu">\r\n                {{\'igo.geo.search.searchSources.settings.\'+ setting.title | translate}}\r\n              </button>\r\n              <mat-menu #test_sub_menu="matMenu"\r\n                [ngSwitch]="setting.type"\r\n                yPosition="above">\r\n                <span *ngSwitchCase="\'radiobutton\'">\r\n                  <mat-radio-group\r\n                    class="igo-search-settings-radio-group"\r\n                    [value]="setting">\r\n                    <mat-radio-button *ngFor="let settingValue of setting.values"\r\n                      [value]="settingValue"\r\n                      [checked]="settingValue.enabled"\r\n                      (click)="$event.stopPropagation()"\r\n                      (change)="settingsValueCheckedRadioButton($event, source, setting, settingValue)">\r\n                      {{settingValue.title}}\r\n                    </mat-radio-button>\r\n                  </mat-radio-group>\r\n                </span>\r\n                <span *ngSwitchCase="\'checkbox\'">\r\n                  <mat-checkbox class="igo-search-settings-radio-group"\r\n                    class="mat-menu-item"\r\n                    [checked]="settingValue.enabled"\r\n                    [value]="setting"\r\n                    (click)="$event.stopPropagation()"\r\n                    (change)="settingsValueCheckedCheckbox($event, source, setting, settingValue)"\r\n                    *ngFor="let settingValue of setting.values">{{settingValue.title}}\r\n                  </mat-checkbox>\r\n                </span>\r\n              </mat-menu>\r\n            </ng-container>\r\n          </mat-menu>\r\n      </ng-container>\r\n  </mat-menu>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".igo-search-settings-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-settings-radio-group{display:inline-flex;flex-direction:column}.igo-search-settings-radio-group mat-radio-button{margin:5px}.igo-search-settings-checkbox mat-radio-button{display:inline-flex}.igo-search-settings-search-source{display:inline-flex;width:100%}.igo-search-settings-search-source mat-checkbox{display:inline-flex;margin-left:5px;margin-right:5px}"]}]}],Ru.ctorParameters=function(){return[{type:vl}]},Ru.propDecorators={change:[{type:Se.Output}]},Ru);function Ru(e){this.searchSourceService=e,this.change=new Se.EventEmitter}var Eu=($u.decorators=[{type:Se.NgModule,args:[{declarations:[ku],imports:[ve.CommonModule,me.MatTooltipModule,me.MatIconModule,me.MatButtonModule,me.MatMenuModule,me.MatRadioModule,me.MatCheckboxModule,Ie.IgoLanguageModule],exports:[ku]}]}],$u);function $u(){}var Au=(Object.defineProperty(_u.prototype,"emptyClass",{get:function(){return this.empty},enumerable:!0,configurable:!0}),Object.defineProperty(_u.prototype,"empty",{get:function(){return 0===this.term.length},enumerable:!0,configurable:!0}),Object.defineProperty(_u.prototype,"placeholder",{get:function(){return this.empty?this._placeholder:""},set:function(e){this._placeholder=e},enumerable:!0,configurable:!0}),_u.prototype.ngOnInit=function(){var t=this;this.stream$$=this.stream$.pipe(Oe.debounce(function(e){return""===e?fe.EMPTY:fe.timer(300)}),Oe.distinctUntilChanged()).subscribe(function(e){return t.onTermChange(e)})},_u.prototype.ngOnDestroy=function(){this.stream$$.unsubscribe()},_u.prototype.onKeyup=function(e){var t=e.target.value;this.keyIsValid(t)&&this.setTerm(t)},_u.prototype.onClearButtonClick=function(){this.clear(),this.clearFeature.emit()},_u.prototype.onSearchTypeChange=function(e){this.searchTypeChange.emit(e),this.placeholder="search."+e.toLowerCase()+".placeholder",this.doSearch(this.term)},_u.prototype.setTerm=function(e){this.disabled||((this.term=e).replace(/(#[^\s]*)/g,"").trim().length>=this.minLength||0===e.replace(/(#[^\s]*)/g,"").trim().length)&&this.stream$.next(e)},_u.prototype.clear=function(){this.term="",this.stream$.next(this.term),this.input.nativeElement.focus()},_u.prototype.keyIsValid=function(e){return-1===this.invalidKeys.indexOf(e)},_u.prototype.onTermChange=function(e){this.change.emit(e),this.doSearch(e)},_u.prototype.doSearch=function(e){var r=this;e!==undefined&&""!==e.replace(/(#[^\s]*)/g,"").trim()?(this.store!==undefined&&this.store.softClear(),this.searchService.search(e).map(function(t){t.request.subscribe(function(e){r.onResearchCompleted(t,e)})})):this.store!==undefined&&this.store.clear()},_u.prototype.onResearchCompleted=function(t,e){if(this.search.emit({research:t,results:e}),this.store!==undefined){var r=this.store.entities$.value.filter(function(e){return e.source!==t.source}).concat(e);this.store.load(r)}},_u.decorators=[{type:Se.Component,args:[{selector:"igo-search-bar",template:'<div class="igo-search-bar-container">\r\n  <mat-form-field [floatLabel]="floatLabel">\r\n    <input\r\n      #input\r\n      matInput\r\n      autocomplete="off"\r\n      [ngClass]="{\'hasSearchIcon\': searchIcon}"\r\n      [disabled]="disabled"\r\n      [placeholder]="placeholder | translate"\r\n      [ngModel]="term"\r\n      (keyup)="onKeyup($event)"\r\n      (touchend)="onKeyup($event)">\r\n  </mat-form-field>\r\n\r\n  <div class="search-bar-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [color]="color"\r\n      *ngIf="searchIcon !== undefined">\r\n      <mat-icon svgIcon="{{searchIcon}}"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [color]="color"\r\n      (click)="onClearButtonClick()"\r\n      *ngIf="!empty">\r\n      <mat-icon svgIcon="close"></mat-icon>\r\n    </button>\r\n\r\n    <igo-search-selector\r\n      [searchTypes]="searchTypes"\r\n      (change)="onSearchTypeChange($event)">\r\n    </igo-search-selector>\r\n\r\n    <igo-search-settings></igo-search-settings>\r\n  </div>\r\n\r\n\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep .mat-form-field{padding:0 5px}:host ::ng-deep .mat-form-field-wrapper{margin-bottom:-1.5em}:host ::ng-deep span.mat-form-field-label-wrapper{top:-20px}:host ::ng-deep div.mat-form-field-infix{left:5px;right:5px;padding:0 0 12px!important}:host ::ng-deep div.mat-form-field-underline{display:none}.igo-search-bar-container{position:relative;width:100%;display:inline-flex;overflow:hidden}.igo-search-bar-container>mat-form-field{width:calc(100% - (2 * 40px))}:host.empty .igo-search-bar-container>mat-form-field{width:calc(100% - 40px)}.search-bar-buttons{position:relative;right:0;display:inline-flex;top:0}.search-bar-buttons>button:nth-child(2)::before{content:'';left:0;top:5px;border-right:1px solid #ddd;height:28px}igo-search-selector,igo-search-settings{background-color:#fff;top:0;border-radius:0}"]}]}],_u.ctorParameters=function(){return[{type:Ol}]},_u.propDecorators={term:[{type:Se.Input}],floatLabel:[{type:Se.Input}],disabled:[{type:Se.Input}],color:[{type:Se.Input}],debounce:[{type:Se.Input}],minLength:[{type:Se.Input}],searchIcon:[{type:Se.Input}],store:[{type:Se.Input}],searchTypes:[{type:Se.Input}],change:[{type:Se.Output}],search:[{type:Se.Output}],searchTypeChange:[{type:Se.Output}],clearFeature:[{type:Se.Output}],input:[{type:Se.ViewChild,args:["input"]}],emptyClass:[{type:Se.HostBinding,args:["class.empty"]}]},_u);function _u(e){this.searchService=e,this.invalidKeys=["Control","Shift","Alt"],this.stream$=new fe.Subject,this.term="",this.floatLabel="never",this.disabled=!1,this.color="primary",this.debounce=300,this.minLength=2,this.searchTypes=lu,this.change=new Se.EventEmitter,this.search=new Se.EventEmitter,this.searchTypeChange=new Se.EventEmitter,this.clearFeature=new Se.EventEmitter,this._placeholder=""}var Gu=(qu.prototype.ngOnInit=function(){var r=this;this.route&&this.route.options.searchKey&&this.route.queryParams.subscribe(function(e){var t=e[r.route.options.searchKey];t&&(r.component.setTerm(t),r.ref.detectChanges())})},qu.decorators=[{type:Se.Directive,args:[{selector:"[igoSearchUrlParam]"}]}],qu.ctorParameters=function(){return[{type:Au,decorators:[{type:Se.Self}]},{type:Se.ChangeDetectorRef},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},qu);function qu(e,t,r){this.component=e,this.ref=t,this.route=r}var Bu=(Nu.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,he.FormsModule,me.MatTooltipModule,me.MatIconModule,me.MatButtonModule,me.MatMenuModule,me.MatRadioModule,me.MatFormFieldModule,me.MatInputModule,Ie.IgoLanguageModule,Du,Eu],exports:[Au],declarations:[Au,Gu]}]}],Nu);function Nu(){}var Vu={Grouped:"grouped",Flat:"flat"},Uu=(Object.defineProperty(Wu.prototype,"results$",{get:function(){return this._results$===undefined&&(this._results$=this.liftResults()),this._results$},enumerable:!0,configurable:!0}),Wu.prototype.ngOnInit=function(){this.watcher=new be.EntityStoreWatcher(this.store,this.cdRef)},Wu.prototype.ngOnDestroy=function(){this.watcher.destroy()},Wu.prototype.onResultFocus=function(e){this.store.state.update(e,{focused:!0},!0),this.resultFocus.emit(e)},Wu.prototype.computeGroupTitle=function(e){var t=[e.source.title],r=e.results.length;return 1<r&&t.push("("+r+")"),t.join(" ")},Wu.prototype.onResultSelect=function(e){this.store.state.update(e,{focused:!0,selected:!0},!0),this.resultSelect.emit(e)},Wu.prototype.liftResults=function(){var t=this;return this.store.view.all$().pipe(Oe.debounce(function(e){return 0===e.length?fe.EMPTY:fe.timer(200)}),Oe.map(function(e){return t.groupResults(e.sort(t.sortByOrder))}))},Wu.prototype.sortByOrder=function(e,t){return e.source.displayOrder-t.source.displayOrder},Wu.prototype.groupResults=function(e){var o=new Map;return e.forEach(function(e){var t=e.source,r=o.get(t);r===undefined&&(r=[],o.set(t,r)),r.push(e)}),Array.from(o.keys()).map(function(e){return{source:e,results:o.get(e)}})},Wu.decorators=[{type:Se.Component,args:[{selector:"igo-search-results",template:'<igo-list [navigation]="true">\r\n  <ng-template\r\n    #groupTemplate\r\n    ngFor let-group\r\n    [ngForOf]="results$ | async">\r\n\r\n    <igo-collapsible\r\n      *ngIf="mode === searchResultMode.Grouped; else flatTemplate"\r\n      [title]="computeGroupTitle(group)">\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </igo-collapsible>\r\n\r\n    <ng-template #flatTemplate>\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </ng-template>\r\n\r\n    <ng-template #storeItemTemplate let-results="results">\r\n      <ng-template ngFor let-result [ngForOf]="results">\r\n        <igo-search-results-item\r\n          igoListItem\r\n          color="accent"\r\n          [result]="result"\r\n          [focused]="store.state.get(result).focused"\r\n          [selected]="store.state.get(result).selected"\r\n          (focus)="onResultFocus(result)"\r\n          (select)="onResultSelect(result)">\r\n\r\n          <ng-container igoSearchItemToolbar\r\n            [ngTemplateOutlet]="templateSearchToolbar"\r\n            [ngTemplateOutletContext]="{result: result}">\r\n          </ng-container>\r\n\r\n        </igo-search-results-item>\r\n      </ng-template>\r\n    </ng-template>\r\n\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Wu.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},Wu.propDecorators={store:[{type:Se.Input}],mode:[{type:Se.Input}],resultFocus:[{type:Se.Output}],resultSelect:[{type:Se.Output}],templateSearchToolbar:[{type:Se.ContentChild,args:["igoSearchItemToolbar"]}]},Wu);function Wu(e){this.cdRef=e,this.searchResultMode=Vu,this.mode=Vu.Grouped,this.resultFocus=new Se.EventEmitter,this.resultSelect=new Se.EventEmitter}var zu=(Object.defineProperty(Ku.prototype,"title",{get:function(){return be.getEntityTitle(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(Ku.prototype,"titleHtml",{get:function(){return be.getEntityTitleHtml(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(Ku.prototype,"icon",{get:function(){return be.getEntityIcon(this.result)},enumerable:!0,configurable:!0}),Ku.decorators=[{type:Se.Component,args:[{selector:"igo-search-results-item",template:'<mat-list-item>\r\n  <mat-icon *ngIf="icon" mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n  <h4 matLine *ngIf="titleHtml" [innerHtml]="titleHtml"></h4>\r\n  <h4 matLine *ngIf="!titleHtml">{{title}}</h4>\r\n\r\n  <ng-content\r\n    select=[igoSearchItemToolbar]>\r\n  </ng-content>\r\n\r\n</mat-list-item>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:['h4 :ng-deep small{color:"#8C8C8C"}']}]}],Ku.ctorParameters=function(){return[]},Ku.propDecorators={result:[{type:Se.Input}]},Ku);function Ku(){}var Hu=(Object.defineProperty(Qu.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Qu.prototype.ngOnInit=function(){var t=this;"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(function(e){return e.id===t.layer.data.sourceOptions.id}))},Qu.prototype.onToggleClick=function(){this.added?this.remove():this.add()},Qu.prototype.add=function(){this.added=!0,this.addLayerToMap()},Qu.prototype.remove=function(){this.added=!1,this.removeLayerFromMap()},Qu.prototype.addLayerToMap=function(){var t=this;if(this.map!==undefined){if(this.layer.meta.dataType!==Ht)return undefined;var e=this.layer.data;this.layerService.createAsyncLayer(e).subscribe(function(e){return t.map.addLayer(e)})}},Qu.prototype.removeLayerFromMap=function(){if(this.map!==undefined){if(this.layer.meta.dataType!==Ht)return undefined;var e=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(e)}},Qu.decorators=[{type:Se.Component,args:[{selector:"igo-search-add-button",template:"<button\r\n*ngIf=\"layer.meta.dataType === 'Layer'\"\r\nmat-icon-button\r\ntooltip-position=\"below\"\r\nmatTooltipShowDelay=\"500\"\r\n[matTooltip]=\"(added ? 'igo.geo.catalog.layer.removeFromMap' : 'igo.geo.catalog.layer.addToMap') | translate\"\r\n[color]=\"added ? 'warn' : ''\"\r\n(click)=\"onToggleClick()\">\r\n<mat-icon [svgIcon]=\"added ? 'delete' : 'plus'\"></mat-icon>\r\n</button>",changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],Qu.ctorParameters=function(){return[{type:on}]},Qu.propDecorators={layer:[{type:Se.Input}],added:[{type:Se.Input}],map:[{type:Se.Input}],color:[{type:Se.Input}]},Qu);function Qu(e){this.layerService=e,this._color="primary"}var Yu=(Zu.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatTooltipModule,me.MatIconModule,me.MatListModule,me.MatButtonModule,be.IgoCollapsibleModule,be.IgoListModule,Ie.IgoLanguageModule,Le],exports:[Uu,Hu],declarations:[Uu,zu,Hu]}]}],Zu);function Zu(){}var Ju=(Xu.forRoot=function(){return{ngModule:Xu,providers:[Gl(),Zl(),au(),fu()]}},Xu.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,Bu,Du,Yu,Eu],exports:[Bu,Du,Yu,Eu],declarations:[]}]}],Xu);function Xu(){}var ec=(Object.defineProperty(tc.prototype,"expanded",{get:function(){return this._expanded},set:function(e){this.state=e?"expanded":"collapsed",this._expanded=e},enumerable:!0,configurable:!0}),Object.defineProperty(tc.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(tc.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e},enumerable:!0,configurable:!0}),Object.defineProperty(tc.prototype,"title",{get:function(){return be.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),tc.prototype.toggle=function(){this.expanded=!this.expanded,this.opened.emit(this.expanded)},tc.prototype.zoomToFeatureExtent=function(){if(this.feature.geometry){var e=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projection});so(this.map,[e],Kt.Zoom)}},tc.prototype.swipe=function(e){e===tc.SWIPE_ACTION.UP?this.expanded||this.toggle():e===tc.SWIPE_ACTION.DOWN&&this.expanded&&this.toggle()},tc.SWIPE_ACTION={UP:"swipeup",DOWN:"swipedown"},tc.decorators=[{type:Se.Component,args:[{selector:"igo-toast",template:'<igo-flexible #flex\r\n  collapsedMobile="51px"\r\n  expandedMobile="300px"\r\n  [state]="state"\r\n  (swipeup)="swipe($event.type)"\r\n  (swipedown)="swipe($event.type)">\r\n\r\n  <igo-panel [title]="title">\r\n    <button\r\n      mat-icon-button\r\n      panelLeftButton\r\n      (click)="toggle()">\r\n      <mat-icon [svgIcon]="[\'collapsed\', \'initial\'].indexOf(flex.state) >= 0 ? \'arrow_upward\' : \'arrow_downward\'"></mat-icon>\r\n    </button>\r\n\r\n    <button mat-icon-button panelRightButton class="igo-icon-button" (click)="zoomToFeatureExtent()" *ngIf="feature.geometry">\r\n      <mat-icon svgIcon="zoom-in"></mat-icon>\r\n    </button>\r\n\r\n    <igo-feature-details [feature]="feature"></igo-feature-details>\r\n  </igo-panel>\r\n\r\n</igo-flexible>\r\n',styles:[":host{position:absolute;bottom:0;width:100%;max-height:calc(100% - 50px);background-color:#fff}igo-feature-details ::ng-deep table{width:100%}"]}]}],tc.ctorParameters=function(){return[]},tc.propDecorators={expanded:[{type:Se.Input}],map:[{type:Se.Input}],feature:[{type:Se.Input}],opened:[{type:Se.Output}]},tc);function tc(){this.format=new ye,this.opened=new Se.EventEmitter}var rc=(oc.forRoot=function(){return{ngModule:oc}},oc.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatIconModule,me.MatButtonModule,be.IgoPanelModule,be.IgoFlexibleModule,oi],exports:[ec],declarations:[ec]}]}],oc);function oc(){}var nc=(ic.prototype.onUpdateInputs=function(){this.cdRef.detectChanges()},ic.prototype.onClose=function(){this.cancel.emit()},ic.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter",template:'<igo-ogc-filterable-item\r\n  [layer]="layer" \r\n  [map]="map" >\r\n</igo-ogc-filterable-item>\r\n\r\n<div>\r\n  <button\r\n    mat-button\r\n    type="button"\r\n    (click)="onClose()">\r\n    {{ \'igo.geo.workspace.ogcFilter.close\' | translate }}\r\n  </button>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],ic.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},ic.propDecorators={layer:[{type:Se.Input}],map:[{type:Se.Input}],complete:[{type:Se.Output}],cancel:[{type:Se.Output}]},ic);function ic(e){this.cdRef=e,this.complete=new Se.EventEmitter,this.cancel=new Se.EventEmitter}var ac=new Se.InjectionToken("OgcFilterWidget");function sc(e){return e.create(nc)}function lc(){return{provide:ac,useFactory:sc,deps:[be.WidgetService]}}var uc=(cc.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,me.MatButtonModule,Ie.IgoLanguageModule,Li],exports:[nc],declarations:[nc],entryComponents:[nc]}]}],cc);function cc(){}var pc,dc=(je(gc,pc=be.Workspace),Object.defineProperty(gc.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(gc.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),gc);function gc(e){var t=pc.call(this,e)||this;return t.options=e,t}var hc=(fc.prototype.createWorkspace=function(e,t){return new dc({id:e.id,title:e.title,layer:e,map:t,entityStore:this.createFeatureStore(e,t),actionStore:new be.ActionStore([]),meta:{tableTemplate:this.createTableTemplate(e)}})},fc.prototype.createFeatureStore=function(e,t){var r=new zr([],{map:t});r.bindLayer(e);var o=new Vr({}),n=new Jr({map:t,hitTolerance:5});return r.addStrategy(o,!0),r.addStrategy(n,!0),r},fc.prototype.createTableTemplate=function(e){return{selection:!0,sort:!0,columns:(e.dataSource.options.sourceFields||[]).map(function(e){return{name:"properties."+e.name,title:e.alias?e.alias:e.name}})}},fc.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],fc.ctorParameters=function(){return[]},fc.ngInjectableDef=Se.defineInjectable({factory:function(){return new fc},token:fc,providedIn:"root"}),fc);function fc(){}var yc,mc=(je(vc,yc=be.Workspace),Object.defineProperty(vc.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(vc.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),vc);function vc(e){var t=yc.call(this,e)||this;return t.options=e,t}var bc=(Sc.prototype.createWorkspace=function(e,t){return new mc({id:e.id,title:e.title,layer:e,map:t,actionStore:new be.ActionStore([])})},Sc.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],Sc.ctorParameters=function(){return[]},Sc.ngInjectableDef=Se.defineInjectable({factory:function(){return new Sc},token:Sc,providedIn:"root"}),Sc);function Sc(){}var wc=(Object.defineProperty(Oc.prototype,"workspaceStore",{get:function(){return this.component.store},enumerable:!0,configurable:!0}),Oc.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.pipe(Oe.debounceTime(50)).subscribe(function(e){return t.onLayersChange(e)})},Oc.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Oc.prototype.onLayersChange=function(e){var t=this,r=e.filter(function(e){return t.layerIsEditable(e)}),o=r.map(function(e){return e.id}),n=r.map(function(e){return t.getOrCreateWorkspace(e)}).filter(function(e){return e!==undefined}),i=this.workspaceStore.all().filter(function(e){return o.indexOf(e.id)<0});0<i.length&&(i.forEach(function(e){e.deactivate()}),this.workspaceStore.state.updateMany(i,{active:!1,selected:!1}),this.workspaceStore.deleteMany(i)),0<n.length&&this.workspaceStore.insertMany(n)},Oc.prototype.getOrCreateWorkspace=function(e){if(this.workspaceStore.get(e.id)===undefined)return e.dataSource instanceof ht?this.wfsWorkspaceService.createWorkspace(e,this.map):e.dataSource instanceof Ot?this.wmsWorkspaceService.createWorkspace(e,this.map):void 0},Oc.prototype.layerIsEditable=function(e){var t=e.dataSource;if(t instanceof ht)return!0;if(t instanceof Ot){var r=t.options||{};return r.ogcFilters&&r.ogcFilters.enabled}return!1},Oc.decorators=[{type:Se.Directive,args:[{selector:"[igoWorkspaceSelector]"}]}],Oc.ctorParameters=function(){return[{type:be.WorkspaceSelectorComponent},{type:hc},{type:bc}]},Oc.propDecorators={map:[{type:Se.Input}]},Oc);function Oc(e,t,r){this.component=e,this.wfsWorkspaceService=t,this.wmsWorkspaceService=r}var Fc=(Ic.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule],exports:[wc],declarations:[wc]}]}],Ic);function Ic(){}var xc=(Mc.decorators=[{type:Se.NgModule,args:[{imports:[ve.CommonModule,be.IgoWidgetModule,Fc,uc],exports:[Fc,uc],declarations:[],providers:[lc()]}]}],Mc);function Mc(){}var Tc=(Cc.forRoot=function(){return{ngModule:Cc,providers:[]}},Cc.decorators=[{type:Se.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],Cc);function Cc(){}var Lc=(Pc.forRoot=function(){return{ngModule:Pc,providers:[]}},Pc.decorators=[{type:Se.NgModule,args:[{imports:[],declarations:[],exports:[jn,Rn,Kn,oi,Li,Ha,Es,As,Gs,Ws,Le,Js,dl,yl,$l,Ju,rc,xc,Tc]}]}],Pc);function Pc(){}var Dc={GeoJSON:0,JSON:1};Dc[Dc.GeoJSON]="GeoJSON",Dc[Dc.JSON]="JSON";var jc,kc={Route:"Route",Trip:"Trip"},Rc=(je(Ec,jc=Il),Object.defineProperty(Ec.prototype,"enabled",{get:function(){return!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),Ec.prototype.getName=function(){return Ec._name},Ec.prototype.route=function(e){var t=this,r=this.getRouteParams();return this.http.get(this.routingUrl+e.join(";"),{params:r}).pipe(Oe.map(function(e){return t.extractRoutesData(e)}))},Ec.prototype.extractRoutesData=function(t){var r=this,o=[];return t.routes.forEach(function(e){o.push(r.formatRoute(e,t.waypoints))}),o},Ec.prototype.getRouteParams=function(){return new we.HttpParams({fromObject:{overview:"full",steps:"true",geometries:"geojson",alternatives:"true"}})},Ec.prototype.formatRoute=function(e,t){var r=[];return e.legs.forEach(function(e){e.steps.forEach(function(e){r.push(e)})}),{id:Fe.uuid(),title:e.legs[0].summary,source:Ec._name,sourceType:kc.Route,order:1,format:Dc.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:e.distance,duration:e.duration,geometry:e.geometry,legs:e.legs,steps:r,weight:e.weight,weight_name:e.weight_name}},Ec._name="OSRM Québec",Ec.decorators=[{type:Se.Injectable}],Ec.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.ConfigService}]},Ec);function Ec(e,t){var r=jc.call(this)||this;return r.http=e,r.config=t,r.routingUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/",r.options=r.config.getConfig("routingSources.osrm")||{},r.routingUrl=r.options.url||r.routingUrl,r}function $c(e,t){return new Rc(e,t)}e.IgoGeoModule=Lc,e.IgoCatalogModule=jn,e.IgoCatalogBrowserModule=In,e.IgoCatalogLibraryModule=Pn,e.IgoDataSourceModule=Rn,e.IgoDownloadModule=Kn,e.IgoGeoWorkspaceModule=xc,e.IgoWorkspaceSelectorModule=Fc,e.IgoOgcFilterModule=uc,e.IgoFeatureModule=oi,e.IgoFeatureFormModule=ti,e.IgoFeatureDetailsModule=Zn,e.IgoFilterModule=Li,e.IgoGeometryModule=Ha,e.IgoGeometryFormFieldModule=za,e.IgoImportExportModule=Es,e.IgoLayerModule=As,e.IgoMapModule=Gs,e.IgoMeasureModule=Ws,e.IgoMeasurerModule=Vs,e.IgoMetadataModule=Le,e.IgoOverlayModule=Js,e.IgoPrintModule=dl,e.IgoQueryModule=yl,e.IgoRoutingModule=$l,e.IgoSearchModule=Ju,e.IgoSearchBarModule=Bu,e.IgoSearchResultsModule=Yu,e.IgoToastModule=rc,e.IgoWktModule=Tc,e.querySearchSourceFactory=hl,e.provideQuerySearchSource=fl,e.defaultIChercheSearchResultFormatterFactory=Yl,e.provideDefaultIChercheSearchResultFormatter=Zl,e.ichercheSearchSourceFactory=Jl,e.provideIChercheSearchSource=function _c(){return{provide:pn,useFactory:Jl,multi:!0,deps:[we.HttpClient,Ie.ConfigService,Nl]}},e.ichercheReverseSearchSourceFactory=Xl,e.provideIChercheReverseSearchSource=function Gc(){return{provide:pn,useFactory:Xl,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.defaultCoordinatesSearchResultFormatterFactory=iu,e.provideDefaultCoordinatesSearchResultFormatter=au,e.CoordinatesReverseSearchSourceFactory=su,e.provideCoordinatesReverseSearchSource=function qc(){return{provide:pn,useFactory:su,multi:!0,deps:[Ie.ConfigService]}},e.ilayerSearchResultFormatterFactory=hu,e.provideILayerSearchResultFormatter=fu,e.ilayerSearchSourceFactory=yu,e.provideILayerSearchSource=function Bc(){return{provide:pn,useFactory:yu,multi:!0,deps:[we.HttpClient,Ie.LanguageService,Ie.ConfigService,uu]}},e.nominatimSearchSourceFactory=Su,e.provideNominatimSearchSource=function Nc(){return{provide:pn,useFactory:Su,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.storedqueriesSearchSourceFactory=Tu,e.provideStoredQueriesSearchSource=function Vc(){return{provide:pn,useFactory:Tu,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.storedqueriesReverseSearchSourceFactory=Cu,e.provideStoredQueriesReverseSearchSource=function Uc(){return{provide:pn,useFactory:Cu,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.osrmRoutingSourcesFactory=$c,e.provideOsrmRoutingSource=function Wc(){return{provide:Il,useFactory:$c,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.routingSourceServiceFactory=Ml,e.provideRoutingSourceService=Tl,e.RoutingSourceService=xl,e.CatalogService=yn,e.CatalogItemType=an,e.CatalogBrowserComponent=vn,e.CatalogLibaryComponent=Mn,e.DataService=Ge,e.DataSource=ze,e.FeatureDataSource=Qe,e.OSMDataSource=Je,e.XYZDataSource=tt,e.WFSDataSource=ht,e.WFSService=mt,e.WMSDataSource=Ot,e.formatWFSQueryString=pt,e.checkWfsParams=dt,e.defaultEpsg=it,e.defaultMaxFeatures=at,e.defaultWfsVersion=st,e.defaultFieldNameGeometry=lt,e.gmlRegex=ut,e.jsonRegex=ct,e.WMTSDataSource=Mt,e.CartoDataSource=Lt,e.ArcGISRestDataSource=jt,e.TileArcGISRestDataSource=Et,e.WebSocketDataSource=_t,e.MVTDataSource=Bt,e.ClusterDataSource=Ut,e.DataSourceService=tn,e.CapabilitiesService=Xo,e.EsriStyleGenerator=Zo,e.generateIdFromSourceOptions=qe,e.generateWMSIdFromSourceOptions=Be,e.generateWMTSIdFromSourceOptions=Ne,e.generateXYZIdFromSourceOptions=Ve,e.generateFeatureIdFromSourceOptions=Ue,e.generateId=We,e.createDefaultTileGrid=It,e.DownloadService=Vn,e.DownloadButtonComponent=Wn,e.FEATURE=zt,e.FeatureMotion=Kt,e.featureToOl=eo,e.featureFromOl=to,e.computeOlFeatureExtent=ro,e.computeOlFeaturesExtent=oo,e.scaleExtent=no,e.featuresAreOutOfView=io,e.featuresAreTooDeepInView=ao,e.moveToOlFeatures=so,e.hideOlFeature=function zc(e){e.setStyle(new le.Style({}))},e.tryBindStoreLayer=lo,e.tryAddLoadingStrategy=uo,e.tryAddSelectionStrategy=co,e.FeatureStore=zr,e.FeatureStoreLoadingStrategy=qr,e.FeatureStoreLoadingLayerStrategy=Vr,e.FeatureStoreSelectionStrategy=Jr,e.FeatureStoreStrategy=Ar,e.FilterableDataSourcePipe=$n,e.TimeFilterService=_n,e.OgcFilterOperatorType=qn,e.OGCFilterService=Bn,e.OgcFilterWriter=ot,e.TimeFilterFormComponent=ii,e.TimeFilterItemComponent=si,e.TimeFilterListComponent=ui,e.TimeFilterListBindingDirective=pi,e.OgcFilterableFormComponent=mi,e.OgcFilterableItemComponent=bi,e.OgcFilterableListComponent=wi,e.OgcFilterableListBindingDirective=Fi,e.OgcFilterFormComponent=fi,e.OgcFilterToggleButtonComponent=Ti,e.OgcFilterButtonComponent=xi,e.GeometrySliceError=fa,e.GeometrySliceMultiPolygonError=va,e.GeometrySliceLineStringError=wa,e.GeometrySliceTooManyIntersectionError=Ia,e.createDrawInteractionStyle=Ma,e.createDrawHoleInteractionStyle=Ta,e.sliceOlGeometry=Ca,e.sliceOlLineString=La,e.sliceOlPolygon=Pa,e.addLinearRingToOlPolygon=Da,e.DrawControl=ja,e.ModifyControl=Ra,e.SliceControl=$a,e.DropGeoFileDirective=ks,e.ExportError=Za,e.ExportInvalidFileError=es,e.ExportNothingToExportError=os,e.ExportService=us,e.ExportFormat=ls,e.exportToCSV=function Kc(e,t,r){void 0===r&&(r=";"),is(e.map(function(e,t){return e.join(r)}).join("\n"),"text/csv;charset=utf-8",t)},e.entitiesToRowData=function Hc(e,t){return e.map(function(r){return t.map(function(e){var t;return e.renderer!==undefined&&e.renderer!==be.EntityTableColumnRenderer.Default||(t=e.valueAccessor),(t=t||be.getEntityProperty)(r,e.name)})})},e.downloadContent=is,e.handleFileExportError=as,e.handleNothingToExportError=ss,e.ImportError=ds,e.ImportInvalidFileError=fs,e.ImportUnreadableFileError=vs,e.ImportNothingToImportError=ws,e.ImportService=Cs,e.addLayerAndFeaturesToMap=Fs,e.handleFileImportSuccess=Is,e.handleFileImportError=xs,e.handleNothingToImportError=function Qc(e,t,r){var o=r.translate,n=o.instant("igo.geo.dropGeoFile.empty.title"),i=o.instant("igo.geo.dropGeoFile.empty.text",{value:e.name,mimeType:e.type});t.error(i,n)},e.getFileExtension=Ms,e.computeLayerTitleFromFile=Ts,e.ImportExportComponent=Ps,e.LayerService=on,e.LAYER=Ht,e.Layer=Qt,e.TooltipType=Jt,e.ImageLayer=ur,e.TileLayer=dr,e.VectorLayer=fr,e.VectorTileLayer=vr,e.StyleService=Sr,e.LayerItemComponent=Ir,e.LayerLegendComponent=Mr,e.LayerListComponent=Dr,e.LayerListBindingDirective=Er,e.LayerListControlsEnum=Cr,e.LayerListService=Lr,e.ImageWatcher=Xt,e.TileWatcher=rr,e.VectorWatcher=ir,e.getLayersLegends=sr,e.IgoMap=jo,e.MapViewAction=bo,e.MapService=kr,e.stringToLonLat=So,e.viewStatesAreEqual=Oo,e.formatScale=Fo,e.getResolutionFromScale=Io,e.getScaleFromResolution=xo,e.ctrlKeyDown=Mo,e.MapOfflineDirective=$o,e.ProjectionService=_o,e.MapController=To,e.MapViewController=Po,e.MapBrowserComponent=Ro,e.ZoomButtonComponent=qo,e.GeolocateButtonComponent=No,e.BaseLayersSwitcherComponent=Wo,e.MiniBaseMapComponent=Ko,e.RotationButtonComponent=Qo,e.MEASURE_UNIT_AUTO="auto",e.MeasureType=Ei,e.MeasureLengthUnit=$i,e.MeasureLengthUnitAbbreviation=Ai,e.MeasureAreaUnit=_i,e.MeasureAreaUnitAbbreviation=Gi,e.metersToKilometers=qi,e.metersToFeet=Bi,e.metersToMiles=Ni,e.squareMetersToSquareKilometers=Vi,e.squareMetersToSquareMiles=Ui,e.squareMetersToSquareFeet=Wi,e.squareMetersToHectares=zi,e.squareMetersToAcres=Ki,e.metersToUnit=Hi,e.squareMetersToUnit=Qi,e.formatMeasure=Yi,e.computeBestLengthUnit=Zi,e.computeBestAreaUnit=Ji,e.createMeasureInteractionStyle=Xi,e.createMeasureLayerStyle=ea,e.measureOlGeometryLength=ta,e.measureOlGeometryArea=ra,e.measureOlGeometry=oa,e.updateOlGeometryMidpoints=na,e.clearOlGeometryMidpoints=function Yc(e){for(var t=e.get("_midpoints")||[],r=t.length,o=0;o<r;o++){var n=t[o];n!==undefined&&n!==undefined&&aa(n)}return e.set("_midpoints",undefined,!0),t},e.updateOlTooltipsAtMidpoints=sa,e.getOlTooltipsAtMidpoints=la,e.updateOlGeometryCenter=ua,e.updateOlTooltipAtCenter=ca,e.getOlTooltipAtCenter=pa,e.getTooltipsOfOlGeometry=da,e.createOlTooltipAtPoint=ga,e.MeasurerComponent=qa,e.MeasureFormatPipe=Na,e.MetadataService=xe,e.MetadataButtonComponent=Te,e.Overlay=ho,e.OverlayDirective=Ys,e.OverlayService=Hs,e.OverlayAction=Ks,e.createOverlayLayer=po,e.createOverlayMarkerStyle=go,e.PrintService=tl,e.PrintOutputFormat=il,e.PrintPaperFormat=al,e.PrintOrientation=sl,e.PrintResolution=ll,e.PrintSaveImageFormat=ul,e.PrintComponent=ol,e.PrintFormComponent=cl,e.QueryService=sn,e.QueryDirective=un,e.QueryFormat=St,e.QueryHtmlTarget=wt,e.layerIsQueryable=Or,e.olLayerIsQueryable=Fr,e.QuerySearchSource=hn,e.RoutingService=Cl,e.RoutingFormat=Dc,e.SourceRoutingType=kc,e.RoutingSource=Il,e.OsrmRoutingSource=Rc,e.RoutingFormComponent=jl,e.RoutingFormBindingDirective=Rl,e.RoutingFormService=Pl,e.SEARCH_TYPES=lu,e.SearchService=Ol,e.SearchSourceService=vl,e.sourceCanSearch=Sl,e.sourceCanReverseSearch=wl,e.featureToSearchResult=function Zc(e,t){return{source:t,data:e,meta:{dataType:zt,id:e.meta.id,title:e.meta.title,icon:"map-marker"}}},e.SearchSource=pn,e.IChercheSearchResultFormatter=Nl,e.IChercheSearchSource=Wl,e.IChercheReverseSearchSource=Hl,e.ILayerSearchResultFormatter=uu,e.ILayerSearchSource=du,e.NominatimSearchSource=vu,e.StoredQueriesSearchSource=Ou,e.StoredQueriesReverseSearchSource=xu,e.CoordinatesSearchResultFormatter=eu,e.CoordinatesReverseSearchSource=ou,e.ToastComponent=ec,e.GoogleLinks=ql,e.WktService=gi,e.ɵj=On,e.ɵk=Sn,e.ɵc=vn,e.ɵm=Cn,e.ɵl=Mn,e.ɵg=Xo,e.ɵf=tn,e.ɵi=Ge,e.ɵh=mt,e.ɵn=Wn,e.ɵo=Vn,e.ɵp=Qn,e.ɵr=Xn,e.ɵba=xi,e.ɵy=fi,e.ɵbb=Ti,e.ɵbd=mi,e.ɵbe=bi,e.ɵbg=Fi,e.ɵbf=wi,e.ɵs=$n,e.ɵbc=Bn,e.ɵv=_n,e.ɵt=ii,e.ɵu=si,e.ɵx=pi,e.ɵw=ui,e.ɵbi=Ua,e.ɵbh=ki,e.ɵbj=Ps,e.ɵbm=ks,e.ɵbl=us,e.ɵbk=Cs,e.ɵbo=Ir,e.ɵbp=Mr,e.ɵbs=Er,e.ɵbq=Dr,e.ɵbr=Lr,e.ɵd=on,e.ɵe=Sr,e.ɵbx=Uo,e.ɵbw=Wo,e.ɵby=Ko,e.ɵbu=No,e.ɵbn=Ro,e.ɵbv=Qo,e.ɵq=kr,e.ɵbz=$o,e.ɵbt=qo,e.ɵca=Na,e.ɵcd=_a,e.ɵcb=Bs,e.ɵcc=qa,e.ɵa=Te,e.ɵb=xe,e.ɵcf=Ys,e.ɵcg=Hs,e.ɵcj=cl,e.ɵch=ol,e.ɵci=tl,e.ɵco=hn,e.ɵck=un,e.ɵcl=sn,e.ɵcv=Rl,e.ɵcp=jl,e.ɵcu=Pl,e.ɵeb=Rc,e.ɵcr=Il,e.ɵcq=Cl,e.ɵda=Au,e.ɵdb=Gu,e.ɵdd=Hu,e.ɵde=zu,e.ɵdc=Uu,e.ɵcx=Lu,e.ɵcw=Du,e.ɵcz=ku,e.ɵcy=Eu,e.ɵdm=fu,e.ɵdg=Gl,e.ɵdf=_l,e.ɵct=vl,e.ɵcs=Ol,e.ɵdl=ou,e.ɵdk=eu,e.ɵdj=Hl,e.ɵdh=Nl,e.ɵdi=Wl,e.ɵdv=uu,e.ɵdw=du,e.ɵdy=vu,e.ɵcm=pn,e.ɵea=xu,e.ɵdz=Ou,e.ɵdn=ec,e.ɵz=gi,e.ɵdp=hc,e.ɵdq=bc,e.ɵdr=nc,e.ɵds=ac,e.ɵdt=sc,e.ɵdu=lc,e.ɵdo=wc,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-geo.umd.min.js.map