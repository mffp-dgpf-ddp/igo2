!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ol/source/OSM"),require("ol/source/XYZ"),require("ol/format/filter"),require("ol/format/WFS"),require("ol/source/ImageWMS"),require("ol/source/WMTS"),require("ol/tilegrid/WMTS"),require("ol/extent.js"),require("ol/source/CartoDB"),require("ol/loadingstrategy"),require("ol/source/TileArcGISRest"),require("ts-md5"),require("ol/source/VectorTile"),require("ol/format/MVT"),require("ol/source/Cluster"),require("ngx-cacheable"),require("ol/source/WMTS.js"),require("ol/Map"),require("ol/View"),require("ol/Geolocation"),require("ol/control/Attribution"),require("ol/control/ScaleLine"),require("ol/geom/Circle"),require("ol/layer/Image"),require("ol/layer/Tile"),require("ol/color"),require("ol/layer/VectorTile"),require("ol/easing"),require("ol/has"),require("proj4"),require("ol/proj/proj4"),require("@angular/animations"),require("ol/format/GML2"),require("ol/format/GML3"),require("ol/format/EsriJSON"),require("ol/proj/Projection"),require("@angular/platform-browser"),require("moment"),require("ol/format/WKT"),require("ol/geom/Point"),require("ol/Overlay"),require("ol/sphere"),require("ol/style/Style"),require("ol/geom/LineString"),require("@turf/line-intersect"),require("@turf/helpers"),require("ol/interaction/Modify"),require("ol/interaction/Translate"),require("ol/interaction/Draw"),require("ol/geom/Polygon"),require("ol/geom/LinearRing"),require("ol/interaction/DragBox"),require("ol/source/Vector"),require("ol/layer/Vector"),require("file-saver"),require("jspdf"),require("html2canvas"),require("jszip"),require("ol/Feature"),require("ol/geom"),require("ol/proj"),require("ol/style"),require("ol/events/condition"),require("ol/interaction"),require("ol/extent"),require("ol/Observable"),require("@angular/forms"),require("rxjs"),require("ol/format/GeoJSON"),require("@angular/material"),require("@angular/common"),require("@igo2/common"),require("ol/format"),require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("@igo2/utils"),require("@igo2/core")):"function"==typeof define&&define.amd?define("@igo2/geo",["exports","ol/source/OSM","ol/source/XYZ","ol/format/filter","ol/format/WFS","ol/source/ImageWMS","ol/source/WMTS","ol/tilegrid/WMTS","ol/extent.js","ol/source/CartoDB","ol/loadingstrategy","ol/source/TileArcGISRest","ts-md5","ol/source/VectorTile","ol/format/MVT","ol/source/Cluster","ngx-cacheable","ol/source/WMTS.js","ol/Map","ol/View","ol/Geolocation","ol/control/Attribution","ol/control/ScaleLine","ol/geom/Circle","ol/layer/Image","ol/layer/Tile","ol/color","ol/layer/VectorTile","ol/easing","ol/has","proj4","ol/proj/proj4","@angular/animations","ol/format/GML2","ol/format/GML3","ol/format/EsriJSON","ol/proj/Projection","@angular/platform-browser","moment","ol/format/WKT","ol/geom/Point","ol/Overlay","ol/sphere","ol/style/Style","ol/geom/LineString","@turf/line-intersect","@turf/helpers","ol/interaction/Modify","ol/interaction/Translate","ol/interaction/Draw","ol/geom/Polygon","ol/geom/LinearRing","ol/interaction/DragBox","ol/source/Vector","ol/layer/Vector","file-saver","jspdf","html2canvas","jszip","ol/Feature","ol/geom","ol/proj","ol/style","ol/events/condition","ol/interaction","ol/extent","ol/Observable","@angular/forms","rxjs","ol/format/GeoJSON","@angular/material","@angular/common","@igo2/common","ol/format","@angular/core","@angular/common/http","rxjs/operators","@igo2/utils","@igo2/core"],t):t((e.igo2=e.igo2||{},e.igo2.geo={}),e.olSourceOSM,e.olSourceXYZ,e.olfilter,e.olFormatWFS,e.olSourceImageWMS,e.olSourceWMTS,e.olTileGridWMTS,e.extent_js,e.olSourceCarto,e.olloadingstrategy,e.olSourceTileArcGISRest,e.tsMd5,e.olSourceVectorTile,e.olFormatMVT,e.olSourceCluster,e.ngxCacheable,e.WMTS_js,e.olMap,e.olView,e.olGeolocation,e.olAttribution,e.olControlScaleLine,e.olCircle,e.olLayerImage,e.olLayerTile,e.color,e.olLayerVectorTile,e.oleasing,e.has,e.proj4,e.olproj4,e.ng.animations,e.olFormatGML2,e.olFormatGML3,e.olFormatEsriJSON,e.olProjection,e.ng.platformBrowser,e.moment,e.olWKT,e.OlPoint,e.OlOverlay,e.sphere,e.OlStyle,e.OlLineString,e.lineIntersect,e.helpers,e.OlModify,e.OlTranslate,e.OlDraw,e.OlPolygon,e.OlLinearRing,e.OlDragBoxInteraction,e.OlVectorSource,e.OlVectorLayer,e.fileSaver,e.jsPDF,e._html2canvas,e.JSZip,e.olFeature,e.olgeom,e.olproj,e.olstyle,e.olcondition,e.olinteraction,e.olextent,e.olobservable,e.ng.forms,e.rxjs,e.OlGeoJSON,e.ng.material,e.ng.common,e.common$1,e.olformat,e.ng.core,e.ng.common.http,e.rxjs.operators,e.utils,e.i1$1)}(this,function(e,r,o,b,l,t,n,a,s,i,f,u,c,p,d,h,g,y,m,v,S,w,F,O,I,x,M,C,T,L,P,D,j,k,E,R,_,$,A,G,q,B,N,W,V,U,z,K,H,Q,Y,Z,J,X,ee,te,re,oe,ne,ie,ae,se,le,ue,ce,pe,de,fe,he,ge,ye,me,ve,be,Se,we,Fe,Oe,Ie){"use strict";r=r&&r.hasOwnProperty("default")?r["default"]:r,o=o&&o.hasOwnProperty("default")?o["default"]:o,l=l&&l.hasOwnProperty("default")?l["default"]:l,t=t&&t.hasOwnProperty("default")?t["default"]:t,n=n&&n.hasOwnProperty("default")?n["default"]:n,a=a&&a.hasOwnProperty("default")?a["default"]:a,i=i&&i.hasOwnProperty("default")?i["default"]:i,u=u&&u.hasOwnProperty("default")?u["default"]:u,p=p&&p.hasOwnProperty("default")?p["default"]:p,d=d&&d.hasOwnProperty("default")?d["default"]:d,h=h&&h.hasOwnProperty("default")?h["default"]:h,m=m&&m.hasOwnProperty("default")?m["default"]:m,v=v&&v.hasOwnProperty("default")?v["default"]:v,S=S&&S.hasOwnProperty("default")?S["default"]:S,w=w&&w.hasOwnProperty("default")?w["default"]:w,F=F&&F.hasOwnProperty("default")?F["default"]:F,O=O&&O.hasOwnProperty("default")?O["default"]:O,I=I&&I.hasOwnProperty("default")?I["default"]:I,x=x&&x.hasOwnProperty("default")?x["default"]:x,C=C&&C.hasOwnProperty("default")?C["default"]:C,P=P&&P.hasOwnProperty("default")?P["default"]:P,k=k&&k.hasOwnProperty("default")?k["default"]:k,E=E&&E.hasOwnProperty("default")?E["default"]:E,R=R&&R.hasOwnProperty("default")?R["default"]:R,_=_&&_.hasOwnProperty("default")?_["default"]:_,G=G&&G.hasOwnProperty("default")?G["default"]:G,q=q&&q.hasOwnProperty("default")?q["default"]:q,B=B&&B.hasOwnProperty("default")?B["default"]:B,W=W&&W.hasOwnProperty("default")?W["default"]:W,V=V&&V.hasOwnProperty("default")?V["default"]:V,U=U&&U.hasOwnProperty("default")?U["default"]:U,K=K&&K.hasOwnProperty("default")?K["default"]:K,H=H&&H.hasOwnProperty("default")?H["default"]:H,Q=Q&&Q.hasOwnProperty("default")?Q["default"]:Q,Y=Y&&Y.hasOwnProperty("default")?Y["default"]:Y,Z=Z&&Z.hasOwnProperty("default")?Z["default"]:Z,J=J&&J.hasOwnProperty("default")?J["default"]:J,X=X&&X.hasOwnProperty("default")?X["default"]:X,ee=ee&&ee.hasOwnProperty("default")?ee["default"]:ee,ie=ie&&ie.hasOwnProperty("default")?ie["default"]:ie,ge=ge&&ge.hasOwnProperty("default")?ge["default"]:ge;var xe=function(e,t){return(xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function Me(e,t){function r(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Ce=function(){return(Ce=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function Te(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(i<3?n(a):3<i?n(t,r,a):n(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a}function Le(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Pe(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function De(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)a.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return a}function je(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(De(arguments[t]));return e}var ke=function(){};function Ee(e){return({wms:Re,wmts:_e,xyz:$e,feature:Ae,osm:function(e){return"OSM"}}[e.type]||Ge)(e)}function Re(e){var t=e.params.layers,r="wms"+e.url+t;return c.Md5.hashStr(r)}function _e(e){var t=e.layer,r="wmts"+e.url+t;return c.Md5.hashStr(r)}function $e(e){var t="xyz"+e.url;return c.Md5.hashStr(t)}function Ae(e){if(!e.url)return Ge(e);var t="feature"+e.url;return c.Md5.hashStr(t)}function Ge(e){return Oe.uuid()}var qe=function(){function e(e,t,r){void 0===e&&(e={}),this.options=e,this.networkService=t,this.dataService=r,this.options=e,this.id=this.generateId(),this.ol=this.createOlSource()}return e.prototype.generateId=function(){return Ee(this.options)},e.prototype.getLegend=function(e){return this.options.legend?[this.options.legend]:[]},e.prototype.onLayerStatusChange=function(e){},e}(),Be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.createOlSource=function(){var e={format:this.getSourceFormatFromOptions(this.options)};return new X(Object.assign(e,this.options))},t.prototype.getSourceFormatFromOptions=function(e){if(e.format)return e.format;var t,r=e.formatType;if(r){if((t=be[r])===undefined)throw new Error("Invalid vector source format ${formatType}.")}else t=be.GeoJSON;var o=e.formatOptions;return o?new t(o):new t},t}(qe),Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.createOlSource=function(){return this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png",new r(this.options)},t}(qe),We=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.createOlSource=function(){return new o(this.options)},t}(qe),Ve=function(){function e(){this.filterSequence=[],this.operators={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsLike:{spatial:!1,fieldRestrict:["string"]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsBetween:{spatial:!1,fieldRestrict:["number"]},During:{spatial:!1,fieldRestrict:[]},PropertyIsNull:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]},Contains:{spatial:!0,fieldRestrict:[]}}}return e.prototype.buildFilter=function(e,t,r,o){var n,i;if(i=!/intersects|contains|within/gi.test(JSON.stringify(e)),e&&(o=e.geometryName!==undefined?e.geometryName:o),t&&e&&(n=b.bbox(o,t,r.getCode())),!e)return"bbox="+t.join(",")+","+r.getCode();e=this.checkIgoFiltersProperties(e,o);var a={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:t&&i?b.and(n,this.bundleFilter(e)):this.bundleFilter(e),outputFormat:"",geometryName:o},s=(new l).writeGetFeature(a);return"filter="+(new XMLSerializer).serializeToString(s).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]},e.prototype.bundleFilter=function(e){var t=this;if(e instanceof Array){var r=[];return e.forEach(function(e){r.push(t.bundleFilter(e))}),r}return e.hasOwnProperty("logical")?this.createFilter({operator:e.logical,logicalArray:this.bundleFilter(e.filters)}):e.hasOwnProperty("operator")?this.createFilter(e):void 0},e.prototype.createFilter=function(e){var t,r=e.operator,o=e.logicalArray,n=e.propertyName,i=e.pattern,a=!e.matchCase||e.matchCase,s=e.wildCard?e.wildCard:"*",l=e.singleChar?e.singleChar:".",u=e.escapeChar?e.escapeChar:"!",c=e.lowerBoundary,p=e.upperBoundary,d=e.geometryName,f=e.extent,h=e.wkt_geometry,g=e.srsName?e.srsName:"EPSG:3857",y=e.begin,m=e.end,v=e.expression;h&&(t=(new G).readGeometry(h,{dataProjection:g,featureProjection:"EPSG:3857"}));switch(r){case"BBOX":return b.bbox(d,f,g);case"PropertyIsBetween":return b.between(n,c,p);case"Contains":return b.contains(d,t,g);case"During":return b.during(n,y,m);case"PropertyIsEqualTo":return b.equalTo(n,v,a);case"PropertyIsGreaterThan":return b.greaterThan(n,v);case"PropertyIsGreaterThanOrEqualTo":return b.greaterThanOrEqualTo(n,v);case"Intersects":return b.intersects(d,t,g);case"PropertyIsNull":return b.isNull(n);case"PropertyIsLessThan":return b.lessThan(n,v);case"PropertyIsLessThanOrEqualTo":return b.lessThanOrEqualTo(n,v);case"PropertyIsLike":return b.like(n,i.replace(/[()_]/gi,l),s,l,u,a);case"PropertyIsNotEqualTo":return b.notEqualTo(n,v,a);case"Within":return b.within(d,t,g);case"And":return b.and.apply(null,o);case"Or":return b.or.apply(null,o);case"Not":return b.not.apply(null,o);default:return undefined}},e.prototype.defineInterfaceFilterSequence=function(e,t,r,o){var n=this;return void 0===r&&(r=""),void 0===o&&(o=-1),e instanceof Array?e.forEach(function(e){n.filterSequence.concat(n.defineInterfaceFilterSequence(e,t,r,o))}):e.hasOwnProperty("logical")?(o+=1,this.filterSequence.concat(this.defineInterfaceFilterSequence(e.filters,t,e.logical,o))):e.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(e,t,o,r)),this.filterSequence},e.prototype.addInterfaceFilter=function(e,t,r,o){void 0===e&&(e={operator:"PropertyIsEqualTo"}),void 0===r&&(r=0),void 0===o&&(o="Or");var n={propertyName:"",operator:"",active:"",filterid:Oe.uuid(),begin:"",end:"",lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(n,{parentLogical:o,level:r,geometryName:t},e)},e.prototype.checkIgoFiltersProperties=function(e,t,r){var o=this;void 0===r&&(r=!1);var n=[];return e instanceof Array?(e.forEach(function(e){n.push(o.checkIgoFiltersProperties(e,t,r))}),n):e.hasOwnProperty("logical")?Object.assign({},{logical:e.logical,filters:this.checkIgoFiltersProperties(e.filters,t,r)}):e.hasOwnProperty("operator")?this.addFilterProperties(e,t,r):void 0},e.prototype.addFilterProperties=function(e,t,r){void 0===r&&(r=!1);var o=e.hasOwnProperty("filterid")?e.filterid:Oe.uuid(),n=e.hasOwnProperty("active")?e.active:r;return Object.assign({},{filterid:o,active:n,igoSpatialSelector:"fixedExtent"},e,{geometryName:t})},e.prototype.rebuiltIgoOgcFilterObjectFromSequence=function(o){if(o instanceof Array){if(1<=o.length){var n,i,a=o[0].parentLogical,s=[];return o.forEach(function(e){var t=Object.assign({},e),r=o.indexOf(e);n=0<=r&&r<o.length-1?o[r+1]:t,delete t.active,delete t.filterid,delete t.parentLogical,s.push(t),1===o.length?i=t:a!==n.parentLogical&&(1===s.length?console.log("You must set at least two operator in a logical ("+a+")"):(i=Object.assign({},{logical:a,filters:s}),s=[i],a=n.parentLogical))}),i}return undefined}return undefined},e}(),Ue=function(n){function e(e,t,r){var o=n.call(this,e,t)||this;return o.options=e,o.networkService=t,o.wfsService=r,o.options=o.wfsService.checkWfsOptions(e),o.ogcFilterWriter=new Ve,o.wfsService.getSourceFieldsFromWFS(o.options),o}return Me(e,n),e.prototype.createOlSource=function(){var a=this;this.options.paramsWFS=this.options.params,this.options.urlWfs=this.options.url,this.options.paramsWFS.version=this.options.paramsWFS.version?this.options.paramsWFS.version:"2.0.0";this.options.ogcFilters=this.options.ogcFilters===undefined?{}:this.options.ogcFilters,this.options.ogcFilters.enabled=this.options.ogcFilters.enabled===undefined||this.options.ogcFilters.enabled,this.options.ogcFilters.editable=this.options.ogcFilters.editable===undefined||this.options.ogcFilters.editable;var s="service=WFS&request=GetFeature",l=this.options.urlWfs,u=this.options.paramsWFS.outputFormat?"outputFormat="+this.options.paramsWFS.outputFormat:"",c=this.options.paramsWFS.version?"version="+this.options.paramsWFS.version:"version=2.0.0",e="typename",t="maxFeatures";"2.0.0"!==this.options.paramsWFS.version&&this.options.paramsWFS.version||(e="typenames",t="count");var p=e+"="+this.options.paramsWFS.featureTypes,d=this.options.paramsWFS.maxFeatures?t+"="+this.options.paramsWFS.maxFeatures:t+"=5000",r=l+"?"+s+"&"+c+"&"+p+"&";return r+=u+"&"+d,this.options.download=Object.assign({},this.options.download,{dynamicUrl:r}),new X({format:this.getFormatFromOptions(),overlaps:!1,url:function(e,t,r){var o,n=a.options.paramsWFS.srsName?"srsname="+a.options.paramsWFS.srsName:"srsname="+r.getCode();a.options.ogcFilters&&a.options.ogcFilters.enabled&&(o=a.options.ogcFilters.filters),a.options.paramsWFS.xmlFilter=a.ogcFilterWriter.buildFilter(o,e,r,a.options.paramsWFS.fieldNameGeometry);var i=l+"?"+s+"&"+c+"&"+p+"&";i+=u+"&"+n+"&"+d;return/(filter|bbox)=.*/gi.test(a.options.paramsWFS.xmlFilter)&&(i+="&"+a.options.paramsWFS.xmlFilter),a.options.download=Object.assign({},a.options.download,{dynamicUrl:i}),i},strategy:f.bbox})},e.prototype.getFormatFromOptions=function(){var e,t=this.options.paramsWFS.outputFormat.toLowerCase(),r=new RegExp(".*?gml.*?");return new RegExp(".*?json.*?").test(t)&&(e=be.GeoJSON),r.test(t)&&(e=be.WFS),new e},e}(qe),ze=function(r){function e(e){var t=r.call(this)||this;return t.http=e,t}return Me(e,r),e.prototype.getData=function(){return console.log("This is defining a data service."),"This is defining a data service."},e.prototype.getSourceFieldsFromWFS=function(r){var o=this;r.sourceFields===undefined||0===Object.keys(r.sourceFields).length?(r.sourceFields=[],this.wfsGetCapabilities(r).subscribe(function(e){r.paramsWFS.wfsCapabilities={xmlBody:e.body,GetPropertyValue:!!/GetPropertyValue/gi.test(e.body)},o.defineFieldAndValuefromWFS(r).subscribe(function(e){r.sourceFields=e})})):(r.sourceFields.forEach(function(e){e.alias===undefined&&(e.alias=e.name)}),r.sourceFields.filter(function(e){return e.values===undefined||0===e.values.length}).forEach(function(t){o.getValueFromWfsGetPropertyValues(r,t.name,200,0,0).subscribe(function(e){return t.values=e})}))},e.prototype.checkWfsOptions=function(e){return new RegExp(/.*?gml.*?/gi).test(e.paramsWFS.outputFormat)&&(e.paramsWFS.version="1.1.0"),Object.assign({},e,{wfsCapabilities:{xmlBody:"",GetPropertyValue:!1}})},e.prototype.buildBaseWfsUrl=function(e,t){var r="typename";"2.0.0"!==e.paramsWFS.version&&e.paramsWFS.version||(r="typenames");var o="service=wfs&request="+t,n=r+"="+e.paramsWFS.featureTypes,i=e.paramsWFS.version?"version="+e.paramsWFS.version:"version=2.0.0";return e.urlWfs+"?"+o+"&"+i+"&"+n},e.prototype.wfsGetFeature=function(e,t,r,o){void 0===t&&(t=5e3),void 0===r&&(r=3857),void 0===o&&(o="");var n=this.buildBaseWfsUrl(e,"GetFeature"),i=e.paramsWFS.outputFormat?"outputFormat="+e.paramsWFS.outputFormat:"",a=e.paramsWFS.srsName?"srsname="+e.paramsWFS.srsName:"srsname=EPSG:"+r,s=""===o?o:"&propertyname="+o,l="maxFeatures";"2.0.0"!==e.paramsWFS.version&&e.paramsWFS.version||(l="count");var u=n+"&"+i+"&"+a+"&"+(5e3!==t?l+"="+t:e.paramsWFS.maxFeatures?l+"="+e.paramsWFS.maxFeatures:l+"="+t)+s;return new RegExp(".*?gml.*?").test(e.paramsWFS.outputFormat.toLowerCase())?this.http.get(u,{responseType:"text"}):this.http.get(u)},e.prototype.getValueFromWfsGetPropertyValues=function(i,a,s,l,u){var c=this;return void 0===s&&(s=30),void 0===l&&(l=0),void 0===u&&(u=0),new he.Observable(function(o){var n=[];c.wfsGetPropertyValue(i,a,s,l).subscribe(function(e){e=e.replace(/&#39;/gi,"'");if(/exception/gi.test(e))++u<2&&c.getValueFromWfsGetPropertyValues(i,a,s,l,u).subscribe(function(e){return o.next(e)});else{for(var t=new RegExp("<(.+?)"+a+">(.+?)</(.+?)"+a+">","gi"),r=t.exec(e);null!==r;)r.index===t.lastIndex&&t.lastIndex++,-1===n.indexOf(r[2])&&n.push(r[2]),r=t.exec(e);o.next(n),o.complete()}},function(e){u<2&&(u++,c.getValueFromWfsGetPropertyValues(i,a,s,l,u).subscribe(function(e){return o.next(e)}))})})},e.prototype.wfsGetCapabilities=function(e){var t=e.version?"version="+e.version:"version=2.0.0",r=e.urlWfs+"?service=wfs&request=GetCapabilities&"+t;return this.http.get(r,{observe:"response",responseType:"text"})},e.prototype.defineFieldAndValuefromWFS=function(u){var c=this;return new he.Observable(function(o){var n,i,a,s,l=[];s=u.paramsWFS.outputFormat.match(/gml/gi)?be.WFS:be.GeoJSON,u.paramsWFS.wfsCapabilities.GetPropertyValue?c.wfsGetFeature(u,1).subscribe(function(e){var r=(new s).readFeatures(e);n=r[0].getKeys(),i=n.filter(function(e){return e!==r[0].getGeometryName()&&!e.match(/boundedby/gi)}),a=i.join(","),i.forEach(function(t){"object"==typeof r[0].get(t)?undefined:r[0].get(t);c.getValueFromWfsGetPropertyValues(u,t,200).subscribe(function(e){l.push({name:t,alias:t,values:e}),o.next(l)})})}):c.wfsGetFeature(u,1).subscribe(function(e){var t=(new s).readFeatures(e);n=t[0].getKeys(),i=n.filter(function(e){return e!==t[0].getGeometryName()&&!e.match(/boundedby/gi)}),a=i.join(","),c.wfsGetFeature(u,200,3857,a).subscribe(function(e){var t=(new s).readFeatures(e);c.built_properties_value(t).forEach(function(e){l.push(e)}),o.next(l),o.complete()})})})},e.prototype.wfsGetPropertyValue=function(e,t,r,o){void 0===r&&(r=30),void 0===o&&(o=0);var n="service=wfs&request=GetPropertyValue&count="+r,i="typenames="+e.paramsWFS.featureTypes,a="valueReference="+t,s=e.urlWfs+"?"+n+"&version=2.0.0&"+i+"&"+a;return this.http.get(s,{responseType:"text"})},e.prototype.built_properties_value=function(e){var n=Object.assign({},e[0].getProperties());delete n[e[0].getGeometryName()],delete n.boundedBy;var i=[];for(var t in n)if(n.hasOwnProperty(t)){var r="object"==typeof e[0].get(t)?undefined:typeof e[0].get(t);i.push({name:t,alias:t,type:r,values:[n[t]]})}return e.every(function(e){var r=e.getProperties(),t=function(t){r.hasOwnProperty(t)&&t in n&&i.filter(function(e){return e.name===t}).forEach(function(e){-1===e.values.indexOf(r[t])&&e.values.push(r[t])})};for(var o in r)t(o);return!0}),i},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:we.HttpClient}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(we.HttpClient))},token:e,providedIn:"root"}),e}(ke),Ke={GML2:"gml2",GML3:"gml3",JSON:"json",GEOJSON:"geojson",ESRIJSON:"esrijson",TEXT:"text",HTML:"html"},He={IFRAME:"iframe",BLANK:"_blank"},Qe=function(p){function e(e,t,r){var o=p.call(this,e,t)||this;o.options=e,o.networkService=t,o.wfsService=r;var n=e.params;if(n&&n.version&&(n.VERSION=n.version),n&&n.VERSION&&"1.3.0"!==n.version&&!n.SRS&&!n.srs)throw new Error("You must set a SRS (or srs) param for your WMS\n           (layer =  "+n.layers+') because your want to use a WMS version under 1.3.0\n        Ex: "srs": "EPSG:3857" ');if(n&&n.INFO_FORMAT&&(n.info_format=n.INFO_FORMAT),e.refreshIntervalSec&&0<e.refreshIntervalSec&&setInterval(function(){o.refresh()},1e3*e.refreshIntervalSec),e.paramsWFS){var i=o.wfsService.checkWfsOptions(e);e.paramsWFS.version=i.paramsWFS.version,e.paramsWFS.wfsCapabilities=i.params.wfsCapabilities,o.wfsService.getSourceFieldsFromWFS(e),o.options.download=Object.assign({},o.options.download,{dynamicUrl:o.buildDynamicDownloadUrlFromParamsWFS(o.options)})}o.ogcFilterWriter=new Ve,e.sourceFields&&0!==e.sourceFields.length||(e.sourceFields=[]);var a=o.options.ogcFilters;if(1<n.layers.split(",").length&&o.options&&a&&a.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+n.layers+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),o.options&&a&&a.enabled&&a.filters){var s=a.filters,l=o.ogcFilterWriter.buildFilter(s),u=o.formatProcessedOgcFilter(l,n.layers),c=0<u.length?u.replace("filter=",""):undefined;o.ol.updateParams({filter:c})}return o}return Me(e,p),Object.defineProperty(e.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:He.BLANK},enumerable:!0,configurable:!0}),e.prototype.refresh=function(){this.ol.updateParams({igoRefresh:Math.random()})},e.prototype.formatProcessedOgcFilter=function(t,e){var r="";return 0===t.length&&-1===e.indexOf(",")?r=t:e.split(",").forEach(function(e){r=r+"("+t.replace("filter=","")+")"}),"filter="+r},e.prototype.buildDynamicDownloadUrlFromParamsWFS=function(e){var t=e.paramsWFS.outputFormat!==undefined?"outputFormat="+e.paramsWFS.outputFormat:"",r="maxFeatures";"2.0.0"!==e.paramsWFS.version&&e.paramsWFS.version||(r="count");var o=e.paramsWFS.maxFeatures?r+"="+e.paramsWFS.maxFeatures:r+"=5000",n=e.paramsWFS.srsName?"srsname="+e.paramsWFS.srsName:"srsname=EPSG:3857";return this.wfsService.buildBaseWfsUrl(e,"GetFeature")+"&"+t+"&"+n+"&"+o},e.prototype.createOlSource=function(){this.options.paramsWFS&&(this.options.urlWfs=this.options.urlWfs?this.options.urlWfs:this.options.url,this.options.paramsWFS.version=this.options.paramsWFS.version?this.options.paramsWFS.version:"2.0.0");var e=this.options.ogcFilters;return(e=e===undefined?{}:e).enabled=e.enabled!==undefined&&e.enabled,e.editable=e.editable!==undefined&&e.editable,new t(this.options)},e.prototype.getLegend=function(e){var t=p.prototype.getLegend.call(this);if(0<t.length)return t;var r=this.params,o=[];r.layers!==undefined&&(o=r.layers.split(","));var n=this.options.url.replace(/\?$/,""),i=["REQUEST=GetLegendGraphic","SERVICE=wms","FORMAT=image/png","LEGEND_OPTIONS=forceLabels:on","SLD_VERSION=1.1.0","VERSION="+(r.version||"1.3.0")];return e!==undefined&&i.push("SCALE="+e),t=o.map(function(e){return{url:n+"?"+i.join("&")+"&LAYER="+e,title:1<o.length?e:undefined}})},e}(qe);function Ye(e){for(var t=(e?se.get(e):se.get("EPSG:3857")).getExtent(),r=s.getWidth(t)/256,o=new Array(20),n=new Array(20),i=0;i<20;++i)o[i]=r/Math.pow(2,i),n[i]=i;return new a({origin:s.getTopLeft(t),resolutions:o,matrixIds:n})}var Ze=function(r){function e(e,t){return r.call(this,e,t)||this}return Me(e,r),e.prototype.createOlSource=function(){var e=Object.assign({tileGrid:Ye(this.options.projection)},this.options);return new n(e)},e}(qe),Je=function(g){function e(){return null!==g&&g.apply(this,arguments)||this}return Me(e,g),Object.defineProperty(e.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:He.BLANK},enumerable:!0,configurable:!0}),e.prototype.createOlSource=function(){var e=this.options.crossOrigin?this.options.crossOrigin:"Anonymous",t=Object.assign({crossOrigin:e},this.options);return new i(t)},e.prototype.getLegend=function(){var e,t,r=g.prototype.getLegend.call(this);if(0<r.length)return r;var o="<table>";if(null!=this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(function(e){!0===e.visible&&(o+='<tr><td><p><font size="5" color="'+e.value+'"> &#9679</font></p></td><td>'+e.name+"</td></tr>")}),[{html:o+="</table>"}];var n=this.options.config.layers[0].options;try{for(var i=Pe(["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"]),a=i.next();!a.done;a=i.next()){var s=a.value;if(n.cartocss.includes(s)){var l=n.cartocss.split(s).pop(),u=l.substr(0,l.indexOf(";"));if(u.includes("ramp")){for(var c=u.split(", (")[1].split(","),p=u.split(", (")[2].split(","),d=0;d<c.length;d++)c[d]=c[d].replace(/("|\))/g,""),p[d]=p[d].replace(/("|\))/g,""),"="===p[d].replace(/\s+/g,"")&&(p[d]="Autres"),o+='<tr><td><p><font size="5" color="'+c[d]+'"> &#9679</font></p></td><td>'+p[d]+"</td></tr>";break}var f=n.layer_name?n.layer_name:"";o+='<tr><td><p><font size="5" color="'+u+'"> &#9679</font></p></td><td>'+f+"</td></tr>";break}}}catch(h){e={error:h}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}return[{html:o+="</table>"}]},e}(qe),Xe=function(p){function e(){return null!==p&&p.apply(this,arguments)||this}return Me(e,p),e.prototype.createOlSource=function(){var e=new R;return new X({attributions:this.options.params.attributions,overlaps:!1,format:e,url:function(e,t,r){var o=this.options.url+"/"+this.options.layer+"/query/",n=["f=json","geometry="+encodeURIComponent('{"xmin":'+e[0]+',"ymin":'+e[1]+',"xmax":'+e[2]+',"ymax":'+e[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];if(this.options.params.timeFilter){var i="time="+this.options.params.timeExtent;n.push(i)}return this.options.params.customParams&&this.options.params.customParams.forEach(function(e){n.push(e)}),o+"?"+n.join("&")}.bind(this),strategy:f.bbox})},e.prototype.getLegend=function(){var e,t,r=this.options.params.legendInfo,o=p.prototype.getLegend.call(this);if(r===undefined||0<o.length)return o;var n=parseInt(this.options.layer,10),i=r.layers[n],a="<table><tr><td>"+i.layerName+"</td></tr>";try{for(var s=Pe(i.legend),l=s.next();!l.done;l=s.next()){var u=l.value;a+="<tr><td align='left'><img src=\""+(this.options.url.replace("FeatureServer","MapServer")+"/"+i.layerId+"/images/"+u.url)+"\" alt ='' /></td><td>"+u.label.replace("<Null>","Null")+"</td></tr>"}}catch(c){e={error:c}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}return[{html:a+="</table>"}]},e}(qe),et=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return Me(e,c),Object.defineProperty(e.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:He.BLANK},enumerable:!0,configurable:!0}),e.prototype.createOlSource=function(){return new u(this.options)},e.prototype.getLegend=function(){var e,t,r=c.prototype.getLegend.call(this);if(this.options.legendInfo===undefined||0<r.length)return r;var o=parseInt(this.options.layer,10),n=this.options.legendInfo.layers[o],i="<table><tr><td>"+n.layerName+"</td></tr>";try{for(var a=Pe(n.legend),s=a.next();!s.done;s=a.next()){var l=s.value;i+="<tr><td align='left'><img src=\""+(this.options.url+"/"+n.layerId+"/images/"+l.url)+"\" alt ='' /></td><td>"+l.label.replace("<Null>","Null")+"</td></tr>"}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}return[{html:i+="</table>"}]},e}(qe),tt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.createOlSource=function(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),e.prototype.createOlSource.call(this)},t.prototype.createWebSocket=function(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))},t.prototype.onMessage=function(e){var t=this.options.format.readFeature(e.data);switch(this.options.onmessage){case"update":var r=this.ol.getFeatureById(t.getId());r&&this.ol.removeFeature(r),this.ol.addFeature(t);break;case"delete":this.ol.clear(!0),this.ol.addFeature(t);break;case"add":default:this.ol.addFeature(t)}},t.prototype.onClose=function(e){},t.prototype.onError=function(e){},t.prototype.onOpen=function(e){},t}(Be),rt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.createOlSource=function(){var e=new d({featureClass:ie});return this.options.format=e,new p(this.options)},t.prototype.generateId=function(){if(!this.options.url)return Oe.uuid();var e="mvt"+this.options.url;return c.Md5.hashStr(e)},t.prototype.onLayerStatusChange=function(e){},t}(qe),ot=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.createOlSource=function(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=e.prototype.createOlSource.call(this),new h(this.options)},t.prototype.generateId=function(){return Oe.uuid()},t}(Be),nt="Feature",it={None:0,Move:1,Zoom:2,Default:3};it[it.None]="None",it[it.Move]="Move",it[it.Zoom]="Zoom",it[it.Default]="Default";var at="Layer",st=function(){function e(e){this.options=e,this.dataSource=this.options.source,this.ol=this.createOlLayer(),this.options.zIndex!==undefined&&(this.zIndex=this.options.zIndex),this.options.baseLayer&&this.options.visible===undefined&&(this.options.visible=!1),this.visible=this.options.visible===undefined||this.options.visible,this.opacity=this.options.opacity===undefined?1:this.options.opacity,this.ol.set("_layer",this,!0)}return Object.defineProperty(e.prototype,"id",{get:function(){return this.options.id||this.dataSource.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alias",{get:function(){return this.options.alias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this.options.title},set:function(e){this.options.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this.ol.getZIndex()},set:function(e){this.ol.setZIndex(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseLayer",{get:function(){return this.options.baseLayer},set:function(e){this.options.baseLayer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this.ol.get("visible")},set:function(e){this.ol.setVisible(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{get:function(){return this.ol.get("opacity")},set:function(e){this.ol.setOpacity(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInResolutionsRange",{get:function(){if(!this.map)return!1;var e=this.map.viewController.getResolution(),t=this.ol.getMinResolution(),r=this.ol.getMaxResolution();return t<=e&&e<=r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showInLayerList",{get:function(){return!1!==this.options.showInLayerList},enumerable:!0,configurable:!0}),e.prototype.setMap=function(e){this.map=e},e}(),lt={TITLE:"title",ABSTRACT:"abstract",CUSTOM:"custom"},ut=function(r){function e(e){var t=r.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=Oe.uuid(),t}return Me(e,r),e.prototype.watch=function(){var t=this;this.source.on("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("imageloaderror",function(e){return t.handleLoadEnd(e)})},e.prototype.unwatch=function(){var t=this;this.source.un("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("imageloaderror",function(e){return t.handleLoadEnd(e)})},e.prototype.handleLoadStart=function(e){e.image.__watchers__||(e.image.__watchers__=[]),e.image.__watchers__.push(this.id),this.loading+=1,this.status=Oe.SubjectStatus.Working},e.prototype.handleLoadEnd=function(e){if(e.image.__watchers__){var t=e.image.__watchers__.indexOf(this.id);if(!(t<0)){e.image.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=Oe.SubjectStatus.Done,this.loaded=this.loading=0)}}},e}(Oe.Watcher),ct=function(r){function e(e){var t=r.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=Oe.uuid(),t}return Me(e,r),e.prototype.watch=function(){var t=this;this.source.on("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("tileloaderror",function(e){return t.handleLoadEnd(e)})},e.prototype.unwatch=function(){var t=this;this.source.un("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("tileloaderror",function(e){return t.handleLoadEnd(e)})},e.prototype.handleLoadStart=function(e){e.tile.__watchers__||(e.tile.__watchers__=[]),e.tile.__watchers__.push(this.id),this.loading+=1,this.status=Oe.SubjectStatus.Working},e.prototype.handleLoadEnd=function(e){if(e.tile.__watchers__){var t=e.tile.__watchers__.indexOf(this.id);if(!(t<0)){e.tile.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=Oe.SubjectStatus.Done,this.loaded=this.loading=0)}}},e}(Oe.Watcher);function pt(e,t){var r,o,n,i,a=[],s=document.createElement("canvas").getContext("2d");s.font="20px Calibri";var l=0;try{for(var u=Pe(e),c=u.next();!c.done;c=u.next()){var p=c.value;if(!1!==p.visible){var d=p.dataSource.getLegend(t)||[],f=function(e){if(e.url===undefined)return"continue";var t=p.title,r=new Image;r.crossOrigin="Anonymous",r.src=e.url,r.onload=function(){s.fillText(t,0,l),s.drawImage(r,0,l+20),l+=r.height+5},a.push({title:t,url:e.url,image:r})};try{for(var h=Pe(d),g=h.next();!g.done;g=h.next()){f(g.value)}}catch(y){n={error:y}}finally{try{g&&!g.done&&(i=h["return"])&&i.call(h)}finally{if(n)throw n.error}}}}}catch(m){r={error:m}}finally{try{c&&!c.done&&(o=u["return"])&&o.call(u)}finally{if(r)throw r.error}}return a}var dt=function(r){function e(e){var t=r.call(this,e)||this;return t.watcher=new ut(t),t.status$=t.watcher.status$,t}return Me(e,r),e.prototype.createOlLayer=function(){var r=this,e=Object.assign({},this.options,{source:this.options.source.ol}),t=new I(e),o=this.options.token;return o&&t.getSource().setImageLoadFunction(function(e,t){r.customLoader(e,t,o)}),t},e.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),r.prototype.setMap.call(this,e)},e.prototype.customLoader=function(o,e,t){var r=new XMLHttpRequest;r.open("GET",e),r.setRequestHeader("Authorization","Bearer "+t),r.responseType="arraybuffer",r.onload=function(){var e=new Uint8Array(this.response),t=new Blob([e],{type:"image/png"}),r=window.URL.createObjectURL(t);o.getImage().src=r},r.send()},e}(st),ft=function(r){function e(e){var t=r.call(this,e)||this;return t.watcher=new ct(t),t.status$=t.watcher.status$,t}return Me(e,r),e.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new x(e)},e.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),r.prototype.setMap.call(this,e)},e}(st),ht=function(t){function e(e){return t.call(this,e)||this}return Me(e,t),Object.defineProperty(e.prototype,"browsable",{get:function(){return!1!==this.options.browsable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exportable",{get:function(){return!1!==this.options.exportable},enumerable:!0,configurable:!0}),e.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return this.options.animation&&this.dataSource.ol.on("addfeature",function(e){this.flash(e.feature)}.bind(this)),new ee(e)},e.prototype.flash=function(c){var p=(new Date).getTime(),d=this.map.ol.on("postcompose",function(e){var t=e.vectorContext,r=e.frameState,o=c.getGeometry().clone(),n=r.time-p,i=n/this.options.animation.duration,a=T.easeOut(1-i),s=M.asArray(this.options.animation.color||"red");s[3]=a;var l=this.ol.getStyleFunction().call(this,c)[0].clone();switch(c.getGeometry().getType()){case"Point":var u=T.easeOut(i)*(3*l.getImage().getRadius());l.getImage().setRadius(u),l.getImage().setOpacity(a);break;case"LineString":l.getImage().getStroke()&&(l.getImage().getStroke().setColor(s),l.getImage().getStroke().setWidth(T.easeOut(i)*(3*l.getImage().getStroke().getWidth()))),l.getStroke()&&(l.getStroke().setColor(s),l.getStroke().setWidth(T.easeOut(i)*(3*l.getStroke().getWidth())));break;case"Polygon":l.getImage().getFill()&&l.getImage().getFill().setColor(s),l.getFill()&&l.getFill().setColor(s)}if(t.setStyle(l),t.drawGeometry(o),n>this.options.animation.duration)return de.unByKey(d),void this.map.ol.render();this.map.ol.render()}.bind(this))},e}(st),gt=function(t){function e(e){return t.call(this,e)||this}return Me(e,t),e.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new C(e)},e}(st),yt=function(){function e(){}return e.prototype.createStyle=function(e){return this.parseStyle("style",e)},e.prototype.parseStyle=function(e,r){var o=this,n={},t=this.getOlCls(e);return t&&r instanceof Object?(Object.keys(r).forEach(function(e){var t=o.getOlKey(e);n[t]=o.parseStyle(e,r[e])}),new t(n)):r},e.prototype.getOlKey=function(e){var t=e.toLowerCase();switch(t){case"circle":case"regularshape":case"icon":t="image"}return t},e.prototype.getOlCls=function(e){var t=le[e.charAt(0).toUpperCase()+e.slice(1)];return"regularshape"===e&&(t=le.RegularShape),t},e.prototype.createStyleByAttribute=function(e,t){var r=t.type,o=t.attribute,n=t.data,i=t.stroke,a=t.width,s=t.fill,l=t.radius,u=t.icon,c=t.scale,p=n.length,d=t.label,f=t.baseStyle;if("circle"===r){for(var h=0;h<p;h++)if(e.get(o)===n[h])return u?[new le.Style({image:new le.Icon({src:u[h],scale:c?c[h]:1})})]:[new le.Style({image:new le.Circle({radius:l?l[h]:4,stroke:new le.Stroke({color:i?i[h]:"black"}),fill:new le.Fill({color:s?s[h]:"black"})})})];if(!e.getStyle())return[new le.Style({image:new le.Circle({radius:4,stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:"#bbbbf2"})})})]}else if("regular"===r){for(h=0;h<p;h++)if(e.get(o)===n[h])return[new le.Style({stroke:new le.Stroke({color:i?i[h]:"black",width:a?a[h]:1}),fill:new le.Fill({color:s?s[h]:"rgba(255,255,255,0.4)"}),text:new le.Text({text:e.get(d),stroke:new le.Stroke({color:"black"})})})];if(!e.getStyle())return f?this.createStyle(f):[new le.Style({stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:"#bbbbf2"})})]}},e.prototype.createClusterStyle=function(e,t){var r,o,n=t.clusterRange,i=t.clusterIcon,a=t.clusterScale,s=e.get("features").length;return 1!==s?(n&&(s>=n[1]?o="red":s<n[1]&&s>=n[0]?o="orange":s<n[0]&&(o="green")),r=[new le.Style({image:new le.Circle({radius:2*s+3.4,stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:n?o:"blue"})}),text:new le.Text({text:s.toString(),fill:new le.Fill({color:"#fff"})})})]):r=i?[new le.Style({image:new le.Icon({src:i,scale:a})})]:[new le.Style({image:new le.Circle({radius:2*s+3.4,stroke:new le.Stroke({color:"black"}),fill:new le.Fill({color:"blue"})})})],r},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();function mt(e){return!0===e.dataSource.options.queryable}function vt(e){var t=e.get("_layer");return t!==undefined&&mt(t)}var bt=function(){function e(e){this.cdRef=e,this.showLegend$=new he.BehaviorSubject(!1),this.inResolutionRange$=new he.BehaviorSubject(!0),this.queryBadgeHidden$=new he.BehaviorSubject(!0),this.toggleLegendOnVisibilityChange=!1,this.expandLegendIfVisible=!1,this.updateLegendOnResolutionChange=!1,this.orderable=!0,this.queryBadge=!1}return Object.defineProperty(e.prototype,"removable",{get:function(){return!1!==this.layer.options.removable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{get:function(){return 100*this.layer.opacity},set:function(e){this.layer.opacity=e/100},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this,e=!1!==(this.layer.dataSource.options.legend||{}).collapsed;this.layer.visible&&this.expandLegendIfVisible&&(e=!1),this.toggleLegend(e),this.updateQueryBadge();var r=this.layer.map.viewController.resolution$;this.resolution$$=r.subscribe(function(e){t.onResolutionChange(e)}),this.tooltipText=this.computeTooltip()},e.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},e.prototype.toggleLegend=function(e){this.showLegend$.next(!e)},e.prototype.toggleVisibility=function(){this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()},e.prototype.computeTooltip=function(){var e=this.layer.options;if(!e.tooltip)return this.layer.title;var t=e.tooltip,r=e.metadata;switch(e.tooltip.type){case lt.TITLE:return this.layer.title;case lt.ABSTRACT:return r&&r["abstract"]?r["abstract"]:this.layer.title;case lt.CUSTOM:return t&&t.text?t.text:this.layer.title;default:return this.layer.title}},e.prototype.onResolutionChange=function(e){var t=this.layer.isInResolutionsRange;!1===t&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(t)},e.prototype.updateQueryBadge=function(){var e=!1===this.queryBadge||!1===this.layer.visible||!mt(this.layer);this.queryBadgeHidden$.next(e)},e.decorators=[{type:Se.Component,args:[{selector:"igo-layer-item",template:'<mat-list-item>\r\n  <mat-icon\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]="legend"\r\n    [collapsed]="!(showLegend$ | async)"\r\n    (toggle)="toggleLegend($event)"\r\n    svgIcon="chevron-up" >\r\n  </mat-icon>\r\n  <h4 matLine [matTooltip]="tooltipText" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [color]="layer.visible ? \'primary\' : \'default\'"\r\n    collapsibleButton\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="layer.visible ?\r\n                  (\'igo.geo.layer.hideLayer\' | translate) :\r\n                  (\'igo.geo.layer.showLayer\' | translate)"\r\n    (click)="toggleVisibility()">\r\n    <mat-icon\r\n      matBadge="?"\r\n      matBadgeColor="accent"\r\n      matBadgeSize="small"\r\n      matBadgePosition="after"\r\n      [matBadgeHidden]="queryBadgeHidden$ | async"\r\n      [ngClass]="{disabled: !(inResolutionRange$ | async)}"\r\n      [svgIcon]="layer.visible ? \'eye\' : \'eye-off\'">\r\n    </mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    color="primary"\r\n    igoCollapse\r\n    [target]="actions"\r\n    [collapsed]="true">\r\n    <mat-icon svgIcon="dots-horizontal"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #actions class="igo-layer-actions-container">\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <mat-slider\r\n      id="opacity-slider"\r\n      thumbLabel\r\n      tickInterval="5"\r\n      step="5"\r\n      [min]="0"\r\n      [max]="100"\r\n      [(ngModel)]="opacity"\r\n      [matTooltip]="\'igo.geo.layer.opacity\' | translate"\r\n      matTooltipShowDelay="500"\r\n      tooltip-position="below">\r\n    </mat-slider>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <div class="igo-layer-button-group">\r\n      <button\r\n        color="primary"\r\n        mat-icon-button\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.raiseLayer\' | translate"\r\n        [disabled]="!orderable"\r\n        (click)="layer.map.raiseLayer(layer)">\r\n        <mat-icon svgIcon="arrow-up"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        mat-icon-button\r\n        color="primary"\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.lowerLayer\' | translate"\r\n        [disabled]="!orderable"\r\n        (click)="layer.map.lowerLayer(layer)">\r\n        <mat-icon svgIcon="arrow-down"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        *ngIf="removable === true"\r\n        mat-icon-button\r\n        color="warn"\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.removeLayer\' | translate"\r\n        (click)="layer.map.removeLayer(layer)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n      <ng-content select="[igoLayerItemToolbar]"></ng-content>\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div #legend class="igo-layer-legend-container">\r\n  <igo-layer-legend\r\n    *ngIf="showLegend$ | async"\r\n    [layer]="layer"\r\n    [updateLegendOnResolutionChange]="updateLegendOnResolutionChange">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{overflow:hidden}.igo-layer-actions-container{width:100%;display:inline-block}.igo-layer-actions-container>div{text-align:center}.igo-layer-legend-container{padding-left:18px;width:calc(100% - 18px);display:inline-block}#opacity-slider{width:100%}.igo-layer-button-group{float:right;padding:0 3px}@media only screen and (max-width:450px),only screen and (max-height:450px){#opacity-slider{width:70%}.igo-layer-button-group{float:none}}mat-icon.disabled{color:rgba(0,0,0,.38)}.mat-badge-small .mat-badge-content{font-size:12px}"]}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},e.propDecorators={layer:[{type:Se.Input}],toggleLegendOnVisibilityChange:[{type:Se.Input}],expandLegendIfVisible:[{type:Se.Input}],updateLegendOnResolutionChange:[{type:Se.Input}],orderable:[{type:Se.Input}],queryBadge:[{type:Se.Input}]},e}(),St=function(){function e(e){this.capabilitiesService=e,this.updateLegendOnResolutionChange=!1,this.legendItems$=new he.BehaviorSubject([])}return e.prototype.ngOnInit=function(){var t=this;if(!0===this.updateLegendOnResolutionChange){var e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(function(e){return t.onResolutionChange(e)})}else this.updateLegend(undefined)},e.prototype.ngOnDestroy=function(){this.resolution$$!==undefined&&this.resolution$$.unsubscribe()},e.prototype.computeItemTitle=function(t){var e=this.layer.dataSource.options;if("wms"!==e.type)return he.of(t.title);var r=e.params.layers.split(","),o=JSON.parse(JSON.stringify(e));return o.params.layers=r.find(function(e){return e===t.title}),this.capabilitiesService.getWMSOptions(o).pipe(Fe.map(function(e){return e._layerOptionsFromCapabilities.title}))},e.prototype.onResolutionChange=function(e){var t=this.layer.map.viewController.getScale();this.updateLegend(t)},e.prototype.updateLegend=function(e){var t=this.layer.dataSource.getLegend(e);0===t.length&&0===this.legendItems$.value.length||this.legendItems$.next(t)},e.decorators=[{type:Se.Component,args:[{selector:"igo-layer-legend",template:'<ng-container *ngIf="legendItems$ | async as items">\r\n  <ng-container *ngIf="items.length; else noItems">\r\n    <ng-container *ngFor="let item of items">\r\n      <mat-list-item *ngIf="item.title">\r\n        <mat-icon\r\n          id="legend-toggle"\r\n          class="igo-chevron"\r\n          mat-list-avatar\r\n          igoCollapse\r\n          [target]="legend"\r\n          [collapsed]="false"\r\n          svgIcon="chevron-up">\r\n        </mat-icon>\r\n        <h4 matLine>{{computeItemTitle(item) | async}}</h4>\r\n      </mat-list-item>\r\n    \r\n      <div #legend class="igo-layer-legend" [ngClass]="{\'with-title\': item.title}">\r\n        <img\r\n          *ngIf="item.url"\r\n          src="{{(item.url | secureImage) |async}}"\r\n          alt="{{\'igo.geo.layer.loadingLegendText\' | translate}}">\r\n        <div\r\n          [ngStyle]="item.style"\r\n          [innerHTML]="item.html"\r\n          *ngIf="item.html">\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </ng-container>\r\n\r\n  <ng-template #noItems>\r\n    <small>\r\n      {{\'igo.geo.layer.noLegendText\' | translate}}\r\n    </small>\r\n  </ng-template>\r\n\r\n</ng-container>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".igo-layer-legend.with-title{padding-left:18px}"]}]}],e.ctorParameters=function(){return[{type:gr}]},e.propDecorators={updateLegendOnResolutionChange:[{type:Se.Input}],layer:[{type:Se.Input}]},e}(),wt={always:"always",never:"never","default":"default"},Ft=function(){function e(){this.sortedAlpha=!1,this.onlyVisible=!1,this.onlyInRange=!1,this.keywordInitialized=!1,this.sortedAlphaInitialized=!1,this.onlyVisibleInitialized=!1,this.onlyInRangeInitialized=!1}return e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Ot=function(){function e(e,t){this.cdRef=e,this.layerListService=t,this.hasLayerNotVisible=!1,this.hasLayerOutOfRange=!1,this.orderable=!0,this.thresholdToFilterAndSort=5,this.layers$=new he.BehaviorSubject([]),this.change$=new he.ReplaySubject(1),this.showToolbar$=new he.BehaviorSubject(!1),this.placeholder="",this.floatLabel="auto",this.layerFilterAndSortOptions={},this.excludeBaseLayers=!1,this.toggleLegendOnVisibilityChange=!1,this.expandLegendOfVisibleLayers=!1,this.updateLegendOnResolutionChange=!1,this.queryBadge=!1}return Object.defineProperty(e.prototype,"layers",{get:function(){return this._layers},set:function(e){this.setLayers(e),this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyword",{get:function(){return this.layerListService.keyword},set:function(e){this.layerListService.keyword=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keywordInitialized",{get:function(){return this.layerListService.keywordInitialized},set:function(e){this.layerListService.keywordInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onlyVisible",{get:function(){return this.layerListService.onlyVisible},set:function(e){this.layerListService.onlyVisible=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onlyVisibleInitialized",{get:function(){return this.layerListService.onlyVisibleInitialized},set:function(e){this.layerListService.onlyVisibleInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onlyInRange",{get:function(){return this.layerListService.onlyInRange},set:function(e){this.layerListService.onlyInRange=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onlyInRangeInitialized",{get:function(){return this.layerListService.onlyInRangeInitialized},set:function(e){this.layerListService.onlyInRangeInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortedAlpha",{get:function(){return this.layerListService.sortedAlpha},set:function(e){this.layerListService.sortedAlpha=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortedAlphaInitialized",{get:function(){return this.layerListService.sortedAlphaInitialized},set:function(e){this.layerListService.sortedAlphaInitialized=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.change$$=this.change$.pipe(Fe.debounce(function(){return 0===e.layers.length?he.EMPTY:he.timer(50)})).subscribe(function(){e.showToolbar$.next(e.computeShowToolbar()),e.layers$.next(e.computeLayers(e.layers.slice(0)))}),this.initLayerFilterAndSortOptions()},e.prototype.ngOnDestroy=function(){this.change$$.unsubscribe()},e.prototype.toggleOnlyVisible=function(){this.onlyVisible=!this.onlyVisible},e.prototype.toggleOnlyInRange=function(){this.onlyInRange=!this.onlyInRange},e.prototype.toggleSort=function(e){this.sortedAlpha=e},e.prototype.clearKeyword=function(){this.keyword=undefined},e.prototype.next=function(){this.change$.next()},e.prototype.computeLayers=function(e){var t=this.filterLayers(e);return t=this.sortedAlpha?this.sortLayersByTitle(t):this.sortLayersByZindex(t)},e.prototype.filterLayers=function(e){var c=this,p=this.keyword;if(this.layerFilterAndSortOptions.showToolbar===wt.never)return e;if(!p&&!this.onlyInRange&&!this.onlyVisible)return e;var d=e.map(function(e){return e.id});return e.forEach(function(e){var t=e.options||{},r=e.dataSource.options||{},o=((t.metadata||{}).keywordList||[]).map(function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")});if(p){var n,i=p.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=r.type||"",l=new RegExp(i,"gi"),u=o.find(function(e){return l.test(e)})!==undefined;if(!l.test(a)&&p.toLowerCase()!==s.toLowerCase()&&!u)-1<(n=d.indexOf(e.id))&&d.splice(n,1)}c.onlyVisible&&!1===e.visible&&(-1<(n=d.indexOf(e.id))&&d.splice(n,1));c.onlyInRange&&!1===e.isInResolutionsRange&&(-1<(n=d.indexOf(e.id))&&d.splice(n,1))}),e.filter(function(e){return-1!==d.indexOf(e.id)})},e.prototype.sortLayersByZindex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},e.prototype.sortLayersByTitle=function(e){return e.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0})},e.prototype.computeOrderable=function(){return!(this.onlyInRange||this.onlyVisible||this.sortedAlpha||this.keyword)},e.prototype.computeShowToolbar=function(){switch(this.layerFilterAndSortOptions.showToolbar){case wt.always:return!0;case wt.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyInRange||this.onlyVisible)}},e.prototype.initLayerFilterAndSortOptions=function(){this.layerFilterAndSortOptions.toolbarThreshold&&(this.thresholdToFilterAndSort=this.layerFilterAndSortOptions.toolbarThreshold),this.layerFilterAndSortOptions.keyword&&!this.keywordInitialized&&(this.keyword=this.layerFilterAndSortOptions.keyword,this.keywordInitialized=!0),this.layerFilterAndSortOptions.sortedAlpha&&!this.sortedAlphaInitialized&&(this.sortedAlpha=this.layerFilterAndSortOptions.sortedAlpha,this.sortedAlphaInitialized=!0),this.layerFilterAndSortOptions.onlyVisible&&!this.onlyVisibleInitialized&&this.hasLayerNotVisible&&(this.onlyVisible=this.layerFilterAndSortOptions.onlyVisible,this.onlyVisibleInitialized=!0),this.layerFilterAndSortOptions.onlyInRange&&!this.onlyInRangeInitialized&&this.hasLayerOutOfRange&&(this.onlyInRange=this.layerFilterAndSortOptions.onlyInRange,this.onlyInRangeInitialized=!0)},e.prototype.setLayers=function(e){this._layers=e,this.orderable=this.computeOrderable(),this.excludeBaseLayers?(this.hasLayerNotVisible=e.find(function(e){return!1===e.visible&&!e.baseLayer})!==undefined,this.hasLayerOutOfRange=e.find(function(e){return!1===e.isInResolutionsRange&&!e.baseLayer})!==undefined):(this.hasLayerNotVisible=e.find(function(e){return!1===e.visible})!==undefined,this.hasLayerOutOfRange=e.find(function(e){return!1===e.isInResolutionsRange})!==undefined)},e.decorators=[{type:Se.Component,args:[{selector:"igo-layer-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <mat-list-item *ngIf="showToolbar$ | async">\r\n    <ng-container>\r\n      <mat-form-field class="inputFilter" [floatLabel]="floatLabel">\r\n        <input\r\n          matInput\r\n          [placeholder]="placeholder"\r\n          [matTooltip]="\'igo.geo.layer.subsetLayersListKeyword\' | translate"\r\n          matTooltipShowDelay="500"\r\n          type="text" [(ngModel)]="keyword">\r\n        <button\r\n          mat-button\r\n          *ngIf="keyword"\r\n          matSuffix\r\n          mat-icon-button\r\n          aria-label="Clear"\r\n          color="warn"\r\n          (click)="clearKeyword()">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <button\r\n        *ngIf="!sortedAlpha"\r\n        mat-icon-button\r\n        [matTooltip]="\'igo.geo.layer.sortAlphabetically\' | translate"\r\n        matTooltipShowDelay="500"\r\n        (click)="toggleSort(true)">\r\n        <mat-icon color="primary" svgIcon="sort-alphabetical"></mat-icon>\r\n      </button>\r\n      <button\r\n        *ngIf="sortedAlpha"\r\n        mat-icon-button\r\n        [matTooltip]="\'igo.geo.layer.sortMapOrder\' | translate"\r\n        matTooltipShowDelay="500"\r\n        (click)="toggleSort(false)">\r\n        <mat-icon color="warn" svgIcon="alert"></mat-icon>\r\n      </button>\r\n      <button\r\n        mat-icon-button\r\n        [disabled]="!hasLayerNotVisible"\r\n        [matTooltip]="onlyVisible ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyVisible\' | translate)"\r\n        matTooltipShowDelay="500"\r\n        [color]="onlyVisible ? \'warn\' : \'primary\'"\r\n        (click)="toggleOnlyVisible()">\r\n        <mat-icon [svgIcon]="!onlyVisible ? \'eye\' : \'alert\'"></mat-icon>\r\n      </button>\r\n      <button\r\n        mat-icon-button\r\n        [disabled]="!hasLayerOutOfRange"\r\n        [matTooltip]="onlyInRange ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyInRange\' | translate)"\r\n        matTooltipShowDelay="500"\r\n        [color]="onlyInRange ? \'warn\' : \'primary\'"\r\n        (click)="toggleOnlyInRange()">\r\n        <mat-icon [svgIcon]="!onlyInRange ? \'playlist-check\' : \'alert\'"></mat-icon>\r\n      </button>\r\n    </ng-container>\r\n  </mat-list-item>\r\n\r\n  <ng-template ngFor let-layer [ngForOf]="layers$ | async">\r\n    <igo-layer-item *ngIf="!(excludeBaseLayers && layer.baseLayer)"\r\n        igoListItem\r\n        [layer]="layer"\r\n        [orderable]="orderable"\r\n        [queryBadge]="queryBadge"\r\n        [expandLegendIfVisible]="expandLegendOfVisibleLayers"\r\n        [updateLegendOnResolutionChange]="updateLegendOnResolutionChange"\r\n        [toggleLegendOnVisibilityChange]="toggleLegendOnVisibilityChange">\r\n\r\n        <ng-container igoLayerItemToolbar\r\n          [ngTemplateOutlet]="templateLayerToolbar"\r\n          [ngTemplateOutletContext]="{layer: layer}">\r\n        </ng-container>\r\n\r\n    </igo-layer-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:["mat-form-field.inputFilter{width:calc(100% - 100px);max-width:200px}"]}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef},{type:Ft}]},e.propDecorators={templateLayerToolbar:[{type:Se.ContentChild,args:["igoLayerItemToolbar"]}],layers:[{type:Se.Input}],placeholder:[{type:Se.Input}],floatLabel:[{type:Se.Input}],layerFilterAndSortOptions:[{type:Se.Input}],excludeBaseLayers:[{type:Se.Input}],toggleLegendOnVisibilityChange:[{type:Se.Input}],expandLegendOfVisibleLayers:[{type:Se.Input}],updateLegendOnResolutionChange:[{type:Se.Input}],queryBadge:[{type:Se.Input}]},e}(),It=function(){function e(){}return e.prototype.getMap=function(){return this.map},e.prototype.setMap=function(e){this.map=e},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),xt=function(){function e(e,t,r,o){this.mapService=t,this.layerListService=r,this.route=o,this.component=e}return e.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e.filter(function(e){return!0===e.showInLayerList})})},e.prototype.ngAfterViewInit=function(){this.initRoutes()},e.prototype.initRoutes=function(){var i=this;this.route&&(this.route.options.llcKKey||this.route.options.llcAKey||this.route.options.llcVKey||this.route.options.llcVKey)&&this.route.queryParams.subscribe(function(e){var t=e[i.route.options.llcKKey],r=e[i.route.options.llcAKey],o=e[i.route.options.llcVKey],n=e[i.route.options.llcRKey];t&&!i.layerListService.keywordInitialized&&(i.layerListService.keyword=t,i.layerListService.keywordInitialized=!0),r&&!i.layerListService.sortedAlphaInitialized&&(i.layerListService.sortedAlpha="1"===r,i.layerListService.sortedAlphaInitialized=!0),o&&!i.layerListService.onlyVisibleInitialized&&i.component.hasLayerNotVisible&&(i.layerListService.onlyVisible="1"===o,i.layerListService.onlyVisibleInitialized=!0),n&&!i.layerListService.onlyInRangeInitialized&&i.component.hasLayerOutOfRange&&(i.layerListService.onlyInRange="1"===n,i.layerListService.onlyInRangeInitialized=!0)})},e.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},e.decorators=[{type:Se.Directive,args:[{selector:"[igoLayerListBinding]"}]}],e.ctorParameters=function(){return[{type:Ot,decorators:[{type:Se.Self}]},{type:It},{type:Ft},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},e}(),Mt=function(){function e(e){void 0===e&&(e={}),this.options=e,this.stores=[],this.active=!1,this.options=e}return e.prototype.isActive=function(){return this.active},e.prototype.activate=function(){!0===this.active&&this.doDeactivate(),this.active=!0,this.doActivate()},e.prototype.deactivate=function(){this.active=!1,this.doDeactivate()},e.prototype.bindStore=function(e){this.stores.indexOf(e)<0&&this.stores.push(e)},e.prototype.unbindStore=function(e){var t=this.stores.indexOf(e);0<=t&&this.stores.splice(t,1)},e.prototype.doActivate=function(){},e.prototype.doDeactivate=function(){},e}(),Ct=function(r){function e(e){var t=r.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}return Me(e,r),e.prototype.bindStore=function(e){r.prototype.bindStore.call(this,e),!0===this.isActive()&&this.watchStore(e)},e.prototype.unbindStore=function(e){r.prototype.unbindStore.call(this,e),!0===this.isActive()&&this.unwatchStore(e)},e.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},e.prototype.doDeactivate=function(){this.unwatchAll()},e.prototype.watchStore=function(t){var r=this;if(!this.stores$$.has(t)){var e=t.view.all$().subscribe(function(e){return r.onFeaturesChange(e,t)});this.stores$$.set(t,e)}},e.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(t.unsubscribe(),this.stores$$["delete"](e))},e.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){e[1].unsubscribe()}),this.stores$$.clear()},e.prototype.onFeaturesChange=function(e,t){0===e.length?t.clearLayer():t.setLayerFeatures(e,this.selectMotion(t),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},e.prototype.selectMotion=function(e){return this.options.motion!==undefined?this.options.motion:!0===e.pristine?it.Default:e.count>e.view.count?it.Default:it.None},e}(Mt),Tt=function(r){function e(e){var t=r.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}return Me(e,r),e.prototype.bindStore=function(e){r.prototype.bindStore.call(this,e),!0===this.isActive()&&this.watchStore(e)},e.prototype.unbindStore=function(e){r.prototype.unbindStore.call(this,e),!0===this.isActive()&&this.unwatchStore(e)},e.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},e.prototype.doDeactivate=function(){this.unwatchAll()},e.prototype.watchStore=function(t){var r=this;this.stores$$.has(t)||(this.onSourceChanges(t),t.layer.ol.getSource().on("change",function(e){r.onSourceChanges(t)}))},e.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(de.unByKey(t),this.stores$$["delete"](e))},e.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){de.unByKey(e[1])}),this.stores$$.clear()},e.prototype.onSourceChanges=function(e){var t=e.layer.ol.getSource().getFeatures();0===t.length?e.clear():e.setStoreOlFeatures(t)},e}(Mt),Lt=function(o){function e(e,t){var r=o.call(this,e,t)||this;return r.strategies=[],r.map=t.map,r}return Me(e,o),Object.defineProperty(e.prototype,"source",{get:function(){return this.layer?this.layer.dataSource:undefined},enumerable:!0,configurable:!0}),e.prototype.bindLayer=function(e){return this.layer=e,this},e.prototype.addStrategy=function(t,e){if(void 0===e&&(e=!1),this.strategies.find(function(e){return t.constructor===e.constructor})!==undefined)throw new Error("A strategy of this type already exists on that FeatureStore.");return this.strategies.push(t),t.bindStore(this),!0===e&&t.activate(),this},e.prototype.removeStrategy=function(e){var t=this.strategies.indexOf(e);return 0<=t&&(this.strategies.splice(t,1),e.unbindStore(this)),this},e.prototype.getStrategyOfType=function(t){return this.strategies.find(function(e){return e instanceof t})},e.prototype.activateStrategyOfType=function(e){var t=this.getStrategyOfType(e);t!==undefined&&t.activate()},e.prototype.deactivateStrategyOfType=function(e){var t=this.getStrategyOfType(e);t!==undefined&&t.deactivate()},e.prototype.setLayerFeatures=function(e,t,r,o,n){var i=this;void 0===t&&(t=it.Default),n=n||ve.getEntityId,this.checkLayer();var a=e.map(function(e){return jt(e,i.map.projection,n)});this.setLayerOlFeatures(a,t,r,o)},e.prototype.setStoreOlFeatures=function(e){var t=this;this.checkLayer();var r=e.map(function(e){return e.set("_featureStore",t,!0),kt(e,t.layer.map.projection)});this.load(r)},e.prototype.clearLayer=function(){this.checkLayer(),this.source.ol.clear()},e.prototype.checkLayer=function(){if(this.layer===undefined)throw new Error("This FeatureStore is not bound to a layer.")},e.prototype.setLayerOlFeatures=function(e,t,r,o){void 0===t&&(t=it.Default);var n=new Map;e.forEach(function(e){n.set(e.getId(),e)});var i=[];this.source.ol.forEachFeature(function(e){var t=n.get(e.getId());t===undefined?i.push(e):t.get("_entityRevision")!==e.get("_entityRevision")?i.push(e):n["delete"](t.getId())});var a=Array.from(n.keys()),s=e.filter(function(e){return 0<=a.indexOf(e.getId())});0<i.length&&this.removeOlFeaturesFromLayer(i),0<s.length&&this.addOlFeaturesToLayer(s),0<s.length?Gt(this.map,s,t,r,o):0<e.length&&Gt(this.map,e,t,r,o)},e.prototype.addOlFeaturesToLayer=function(e){var t=this;e.forEach(function(e){e.set("_featureStore",t,!0)}),this.source.ol.addFeatures(e)},e.prototype.removeOlFeaturesFromLayer=function(e){var t=this;e.forEach(function(e){t.source.ol.removeFeature(e)})},e}(ve.EntityStore),Pt=function(t){function e(e){return t.call(this,e)||this}return Me(e,t),e}(J),Dt=function(r){function e(e){var t=r.call(this,e)||this;return t.options=e,t.overlayStore=t.createOverlayStore(),t}return Me(e,r),Object.defineProperty(e.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),e.prototype.bindStore=function(e){r.prototype.bindStore.call(this,e),!0===this.isActive()&&this.activate()},e.prototype.unbindStore=function(e){r.prototype.unbindStore.call(this,e),!0===this.isActive()&&this.activate()},e.prototype.unselectAll=function(){this.stores.forEach(function(e){e.state.updateAll({selected:!1})})},e.prototype.clear=function(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()},e.prototype.doActivate=function(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()},e.prototype.doDeactivate=function(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll(),this.removeOverlayLayer()},e.prototype.watchAll=function(){var t=this;this.unwatchAll();var e=this.stores.map(function(e){return e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(Fe.map(function(e){return e.map(function(e){return e.entity})}))});this.stores$$=he.combineLatest.apply(void 0,je(e)).pipe(Fe.debounceTime(25),Fe.skip(1),Fe.map(function(e){return e.reduce(function(e,t){return e.concat(t)})})).subscribe(function(e){return t.onSelectFromStore(e)})},e.prototype.unwatchAll=function(){this.stores$$!==undefined&&this.stores$$.unsubscribe()},e.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){t.onMapClick(e)})},e.prototype.unlistenToMapClick=function(){this.mapClickListener!==undefined&&this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener)},e.prototype.onMapClick=function(e){var r=this,t=!er(e),o=!t,n=e.map.getFeaturesAtPixel(e.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:function(t){return r.stores.find(function(e){return e.layer.ol===t})!==undefined}});this.onSelectFromMap(n,t,o)},e.prototype.addDragBoxInteraction=function(){var e,t,r,o=this,n=this.map.ol.getInteractions().getArray();try{for(var i=Pe(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(s instanceof Pt){r=s;break}}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}r===undefined&&(r=new Pt({condition:er}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",function(e){return o.onDragBoxEnd(e)})},e.prototype.removeDragBoxInteraction=function(){this.olDragSelectInteractionEndKey!==undefined&&de.unByKey(this.olDragSelectInteractionEndKey),this.olDragSelectInteraction!==undefined&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=undefined},e.prototype.onDragBoxEnd=function(e){var t=!er(e.mapBrowserEvent),o=e.target.getGeometry().getExtent(),r=this.stores.reduce(function(e,t){var r=t.layer.ol.getSource();return e.push.apply(e,je(r.getFeaturesInExtent(o))),e},[]);this.onSelectFromMap(r,t,!1)},e.prototype.onSelectFromStore=function(e){var t=this.options?this.options.motion:undefined,r=this.overlayStore.layer.ol.getSource().getFeatures().map(function(e){return e.getId()}),o=e.map(this.overlayStore.getKey),n=r.length!==o.length||!r.every(function(e){return 0<=o.indexOf(e)});this.overlayStore.setLayerFeatures(e,n?t:it.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},e.prototype.onSelectFromMap=function(e,r,o){var n=this,i=this.groupFeaturesByStore(e);this.stores.forEach(function(e){var t=i.get(e);t===undefined&&!0===r?n.unselectAllFeaturesFromStore(e):t===undefined&&!1===r||n.selectFeaturesFromStore(e,t,r,o)})},e.prototype.selectFeaturesFromStore=function(e,t,r,o){!0===o?e.state.reverseMany(t,["selected"]):e.state.updateMany(t,{selected:!0},r)},e.prototype.unselectAllFeaturesFromStore=function(e){e.state.updateAll({selected:!1})},e.prototype.groupFeaturesByStore=function(e){var n=new Map;return null===e||e===undefined||e.forEach(function(e){var t=e.get("_featureStore");if(t!==undefined){var r=n.get(t);r===undefined&&(r=[],n.set(t,r));var o=t.get(e.getId());o!==undefined&&r.push(o)}}),n},e.prototype.createOverlayStore=function(){var e=this.options.layer?this.options.layer:this.createOverlayLayer();return new Lt([],{map:this.map}).bindLayer(e)},e.prototype.createOverlayLayer=function(){return new ht({zIndex:300,source:new Be,style:undefined,showInLayerList:!1,exportable:!1,browsable:!1})},e.prototype.addOverlayLayer=function(){this.overlayStore.layer.map===undefined&&this.map.addLayer(this.overlayStore.layer)},e.prototype.removeOverlayLayer=function(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)},e}(Mt);function jt(e,t,r){r=r||ve.getEntityId;var o=(new ge).readFeature(e,{dataProjection:e.projection,featureProjection:t});o.setId(r(e));var n=ve.getEntityTitle(e);n!==undefined&&o.set("_title",n,!0),e.extent!==undefined&&o.set("_extent",e.extent,!0),e.projection!==undefined&&o.set("_projection",e.projection,!0),e.extent!==undefined&&o.set("_extent",e.extent,!0);var i=ve.getEntityProperty(e,"meta.mapTitle");return i!==undefined&&o.set("_mapTitle",i,!0),o.set("_entityRevision",ve.getEntityRevision(e),!0),o}function kt(r,e,t,o){var n,i;void 0===o&&(o="EPSG:4326");var a=new ge,s=r.getKeys().filter(function(e){return!e.startsWith("_")&&"geometry"!==e}).reduce(function(e,t){return e[t]=r.get(t),e},{}),l=a.writeGeometryObject(r.getGeometry(),{dataProjection:o,featureProjection:e});t?(n=t.get("title"),i=t.get("sourceOptions").type):n=r.get("_title");var u=r.get("_mapTitle"),c=r.getId();return{type:nt,projection:o,extent:r.get("_extent"),meta:{id:c,title:n||(u||c),mapTitle:u,typeSource:i,revision:r.getRevision()},properties:s,geometry:l}}function Et(e,t){var r=pe.createEmpty(),o=t.get("_extent"),n=t.get("_projection");if(o!==undefined&&n!==undefined)r=se.transformExtent(o,n,e.projection);else{var i=t.getGeometry();null!==i&&(r=i.getExtent())}return r}function Rt(r,e){var o=pe.createEmpty();return e.forEach(function(e){var t=Et(r,e);pe.extend(o,t)}),o}function _t(e,t){var r=De(pe.getSize(e),2),o=r[0],n=r[1];return[t[3]?e[0]-o*t[3]:e[0],t[2]?e[1]-n*t[2]:e[1],t[1]?e[2]+o*t[1]:e[2],t[0]?e[3]+n*t[0]:e[3]]}function $t(e,t){var r=e.getExtent(),o=_t(r,[-1,-1,-1,-1].map(function(e){return.05*e}));return!pe.containsExtent(o,t)}function At(e,t,r){r=r||.004;var o=e.getExtent(),n=pe.getArea(o);return pe.getArea(t)/n<r}function Gt(e,t,r,o,n){void 0===r&&(r=it.Default);var i=Rt(e,t),a=i;o!==undefined&&(a=_t(a,o)),r===it.Zoom?e.viewController.zoomToExtent(a):r===it.Move?e.viewController.moveToExtent(a):r===it.Default&&($t(e,i)||At(e,i,n))&&e.viewController.zoomToExtent(a)}function qt(e,t){e.layer===undefined&&(t=t||new ht({source:new Be}),e.bindLayer(t)),e.layer.map===undefined&&e.map.addLayer(e.layer)}function Bt(e,t){e.getStrategyOfType(Ct)===undefined?(t=t||new Ct({}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(Ct)}function Nt(e,t){e.getStrategyOfType(Dt)===undefined?(t=t||new Dt({map:e.map}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(Dt)}function Wt(){var e=new Be;return new ht({title:"Overlay",zIndex:300,source:e,style:function(){var r,o=(e=new le.Stroke({width:2,color:[0,161,222,1]}),t=new le.Stroke({color:[0,161,222,.15]}),new le.Style({stroke:e,fill:t,image:new le.Circle({radius:5,stroke:e,fill:t}),text:new le.Text({font:"12px Calibri,sans-serif",fill:new le.Fill({color:"#000"}),stroke:new le.Stroke({color:"#fff",width:3}),overflow:!0})})),n=Vt();Ut();var e,t;return function(e){if(console.log(e.getId()),"bufferFeature"!==e.getId()){var t=e.getGeometry().getType();return(r="Point"===t?n:o).getText().setText(e.get("_mapTitle")),r}r=Ut(e.get("bufferStroke"),2,e.get("bufferFill"),e.get("bufferText")),console.log(r)}}()})}function Vt(e){var t;switch(void 0===e&&(e="blue"),e){case"blue":case"red":case"yellow":case"green":t=e;break;default:t="blue"}return new le.Style({image:new le.Icon({src:"./assets/igo2/geo/icons/place_"+t+"_36px.svg",imgSize:[36,36],anchor:[.5,1]}),text:new le.Text({font:"12px Calibri,sans-serif",fill:new le.Fill({color:"#000"}),stroke:new le.Stroke({color:"#fff",width:3}),overflow:!0})})}function Ut(e,t,r,o){void 0===e&&(e=[0,161,222,1]),void 0===t&&(t=2),void 0===r&&(r=[0,161,222,.15]);var n=new le.Stroke({color:e,width:t}),i=new le.Fill({color:r});return new le.Style({stroke:n,fill:i,image:new le.Circle({radius:5,stroke:n,fill:i}),text:new le.Text({font:"12px Calibri,sans-serif",text:o,fill:new le.Fill({color:"#000"}),stroke:new le.Stroke({color:"#fff",width:3})})})}var zt=function(){function e(e){this.layer=Wt(),this.setMap(e)}return Object.defineProperty(e.prototype,"dataSource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),e.prototype.setMap=function(e){e===undefined?this.map!==undefined&&this.map.ol.removeLayer(this.layer.ol):e.ol.addLayer(this.layer.ol),this.map=e},e.prototype.setFeatures=function(e,t){void 0===t&&(t=it.Default),this.clear(),this.addFeatures(e,t)},e.prototype.addFeature=function(e,t){void 0===t&&(t=it.Default),this.addFeatures([e],t)},e.prototype.addFeatures=function(e,t){var r=this;void 0===t&&(t=it.Default);var o=[];e.forEach(function(e){var t=jt(e,r.map.projection);null!==t.getGeometry()&&o.push(t)}),this.addOlFeatures(o,t)},e.prototype.addOlFeature=function(e,t){void 0===t&&(t=it.Default),this.addOlFeatures([e],t)},e.prototype.addOlFeatures=function(e,t){void 0===t&&(t=it.Default),this.dataSource.ol.addFeatures(e),Gt(this.map,e,t)},e.prototype.clear=function(){this.dataSource.ol.clear()},e}(),Kt=function(t){function e(){var e=t.call(this)||this;return e.loaded=0,e.loading=0,e.layers=[],e.subscriptions=[],e}return Me(e,t),e.prototype.watch=function(){},e.prototype.unwatch=function(){var t=this;this.layers.forEach(function(e){return t.unwatchLayer(e)},this)},e.prototype.watchLayer=function(e){var t=this;if(e.status$!==undefined){this.layers.push(e);var r=e.status$.pipe(Fe.distinctUntilChanged()).subscribe(function(e){e===Oe.SubjectStatus.Working?t.loading+=1:e===Oe.SubjectStatus.Done&&(t.loaded+=1),t.loaded>=t.loading?(t.loading=t.loaded=0,t.status=Oe.SubjectStatus.Done):0<t.loading&&(t.status=Oe.SubjectStatus.Working)});this.subscriptions.push(r)}},e.prototype.unwatchLayer=function(e){var t=this.layers.indexOf(e);if(0<=t){var r=e.watcher.status;-1!==[Oe.SubjectStatus.Working,Oe.SubjectStatus.Waiting].indexOf(r)&&(this.loaded+=1),this.subscriptions[t].unsubscribe(),this.subscriptions.splice(t,1),this.layers.splice(t,1)}},e}(Oe.Watcher),Ht={Move:0,Zoom:1};function Qt(e){var t,r="(;[\\d]{4,5})";if(!new RegExp("^[-+]?[\\d]{1,8}(\\.)?(\\d+)?,(\\s)*[-+]?[\\d]{1,8}(\\.)?(\\d+)?(;[\\d]{4,5})?","g").test(e))return undefined;var o=e;new RegExp(r,"g").test(e)&&(o=(t=De(e.split(";"),2))[0],t[1]);var n=De(o.split(","),2),i=n[0],a=n[1];return[parseFloat(i),parseFloat(a)]}function Yt(e,t){if(e===undefined||t===undefined)return!1;return e.zoom===t.zoom&&Math.trunc(e.center[0]/1e-4)===Math.trunc(t.center[0]/1e-4)&&Math.trunc(e.center[1]/1e-4)===Math.trunc(t.center[1]/1e-4)}function Zt(e){return(e=Math.round(e))<1e4?e+"":(e=Math.round(e/1e3))<1e3?e+"K":(e=Math.round(e/1e3))+"M"}function Jt(e,t){return void 0===t&&(t=72),e/(39.37*t)}function Xt(e,t,r){return void 0===t&&(t="m"),void 0===r&&(r=72),e*se.METERS_PER_UNIT[t]*39.37*r}function er(e){var t=e.originalEvent;return!t.altKey&&(L.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey}Ht[Ht.Move]="Move",Ht[Ht.Zoom]="Zoom";var tr=function(){function e(){this.observerKeys=[]}return e.prototype.getOlMap=function(){return this.olMap},e.prototype.setOlMap=function(e){if(e!==undefined&&this.getOlMap()!==undefined)throw new Error("This controller is already bound to a map.");if(e===undefined)return this.teardownObservers(),void(this.olMap=e);this.olMap=e},e.prototype.teardownObservers=function(){this.observerKeys.forEach(function(e){return de.unByKey(e)}),this.observerKeys=[]},e}(),rr=function(r){function e(e){var t=r.call(this)||this;return t.options=e,t.resolution$=new he.BehaviorSubject(undefined),t.state$=new he.BehaviorSubject(undefined),t.extent$=new he.Subject,t.states=[],t.stateIndex=0,t}return Me(e,r),Object.defineProperty(e.prototype,"stateHistory",{get:function(){return!!this.options&&!0===this.options.stateHistory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"olView",{get:function(){return this.olMap.getView()},enumerable:!0,configurable:!0}),e.prototype.setOlMap=function(e){r.prototype.setOlMap.call(this,e),this.setupObservers()},e.prototype.setupObservers=function(){var t=this;!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",function(e){return t.onMoveEnd(e)})),this.extent$$=this.extent$.pipe(Fe.debounceTime(25)).subscribe(function(e){t.setExtent(e.extent,e.action)})},e.prototype.teardownObservers=function(){r.prototype.teardownObservers.call(this),this.extent$$!==undefined&&(this.extent$$.unsubscribe(),this.extent$$=undefined)},e.prototype.getOlProjection=function(){return this.olView.getProjection()},e.prototype.getCenter=function(e){var t=this.olView.getCenter();return e&&t&&(t=se.transform(t,this.getOlProjection(),e)),t},e.prototype.getExtent=function(e){var t=this.olView.calculateExtent(this.olMap.getSize());return e&&t&&(t=se.transformExtent(t,this.getOlProjection(),e)),t},e.prototype.getScale=function(e){return void 0===e&&(e=72),Xt(this.getResolution(),this.getOlProjection().getUnits(),e)},e.prototype.getResolution=function(){return this.olView.getResolution()},e.prototype.getZoom=function(){return Math.round(this.olView.getZoom())},e.prototype.zoomIn=function(){this.zoomTo(this.olView.getZoom()+1)},e.prototype.zoomOut=function(){this.zoomTo(this.olView.getZoom()-1)},e.prototype.zoomTo=function(e){this.olView.animate({zoom:e,duration:250,easing:T.easeOut})},e.prototype.moveToExtent=function(e){this.extent$.next({extent:e,action:Ht.Move})},e.prototype.zoomToExtent=function(e){this.extent$.next({extent:e,action:Ht.Zoom})},e.prototype.getRotation=function(){return this.olView.getRotation()},e.prototype.resetRotation=function(){this.olView.setRotation(0)},e.prototype.hasPreviousState=function(){return 1<this.states.length&&0<this.stateIndex},e.prototype.hasNextState=function(){return 1<this.states.length&&this.stateIndex<this.states.length-1},e.prototype.previousState=function(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)},e.prototype.nextState=function(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)},e.prototype.clearStateHistory=function(){this.states=[],this.stateIndex=0},e.prototype.setInitialState=function(){0<this.states.length&&this.setStateIndex(0)},e.prototype.setExtent=function(e,t){var r=this.olView;t===Ht.Zoom?r.fit(e,{maxZoom:17}):t===Ht.Move&&r.fit(e,{maxZoom:r.getZoom()})},e.prototype.setStateIndex=function(e){this.stateIndex=e,this.setState(this.states[e])},e.prototype.setState=function(e){this.olView.animate({resolution:e.resolution,center:e.center,duration:0})},e.prototype.onMoveEnd=function(e){var t=this.getResolution();this.resolution$.value!==t&&this.resolution$.next(t);var r={resolution:t,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){var o=this.stateIndex;Yt(r,0===this.states.length?undefined:this.states[o])||(this.states=this.states.slice(0,o+1).concat([r]),this.stateIndex=this.states.length-1)}this.state$.next(r)},e}(tr),or=function(){function e(e){this.layers$=new he.BehaviorSubject([]),this.geolocation$=new he.BehaviorSubject(undefined),this.defaultOptions={controls:{attribution:!1}},this.options=Object.assign({},this.defaultOptions,e),this.layerWatcher=new Kt,this.status$=this.layerWatcher.status$,D.register(P),this.init()}return Object.defineProperty(e.prototype,"layers",{get:function(){return this.layers$.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this.viewController.getOlProjection().getCode()},enumerable:!0,configurable:!0}),e.prototype.init=function(){var e=[];if(this.options.controls){if(this.options.controls.attribution){var t=!0===this.options.controls.attribution?{}:this.options.controls.attribution;e.push(new w(t))}if(this.options.controls.scaleLine){var r=!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine;e.push(new F(r))}}var o={};!1===this.options.interactions&&(o={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new m({interactions:ce.defaults(o),controls:e}),this.setView(this.options.view||{}),this.viewController=new rr({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new zt(this),this.buffer=new zt(this)},e.prototype.setTarget=function(e){this.ol.setTarget(e),e!==undefined?this.layerWatcher.subscribe(function(){},null):this.layerWatcher.unsubscribe()},e.prototype.updateView=function(e){var t=this.ol.getView(),r=Object.assign({zoom:t.getZoom()},t.getProperties());this.setView(Object.assign(r,e))},e.prototype.setView=function(e){this.viewController!==undefined&&this.viewController.clearStateHistory();var t=new v(e);if(this.ol.setView(t),this.unsubscribeGeolocate(),e){if(e.center){var r=t.getProjection().getCode(),o=se.fromLonLat(e.center,r);t.setCenter(o)}e.geolocate&&this.geolocate(!0)}},e.prototype.getCenter=function(e){return this.viewController.getCenter()},e.prototype.getExtent=function(e){return this.viewController.getExtent()},e.prototype.getZoom=function(){return this.viewController.getZoom()},e.prototype.changeBaseLayer=function(e){var t,r;if(e){try{for(var o=Pe(this.getBaseLayers()),n=o.next();!n.done;n=o.next()){n.value.visible=!1}}catch(i){t={error:i}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}e.visible=!0}},e.prototype.getBaseLayers=function(){return this.layers.filter(function(e){return!0===e.baseLayer})},e.prototype.getLayerById=function(t){return this.layers.find(function(e){return e.id&&e.id===t})},e.prototype.getLayerByAlias=function(t){return this.layers.find(function(e){return e.alias&&e.alias===t})},e.prototype.addLayer=function(e,t){void 0===t&&(t=!0),this.addLayers([e])},e.prototype.addLayers=function(e,t){var r=this;void 0===t&&(t=!0);var o=e.map(function(e){return r.doAddLayer(e)}).filter(function(e){return e!==undefined});this.setLayers([].concat(this.layers,o))},e.prototype.addBuffer=function(e){null!==e.getGeometry()&&this.bufferDataSource.ol.addFeature(e)},e.prototype.removeLayer=function(e){this.removeLayers([e])},e.prototype.removeLayers=function(e){var r=this,o=this.layers$.value.slice(0),n=[];e.forEach(function(e){var t=r.getLayerIndex(e);0<=t&&(n.push(e),o.splice(t,1))}),n.forEach(function(e){return r.doRemoveLayer(e)}),this.setLayers(o)},e.prototype.removeAllLayers=function(){var t=this;this.layers.forEach(function(e){return t.doRemoveLayer(e)}),this.layers$.next([])},e.prototype.raiseLayer=function(e){var t=this.getLayerIndex(e);0<t&&this.moveLayer(e,t,t-1)},e.prototype.lowerLayer=function(e){var t=this.getLayerIndex(e);t<this.layers.length-1&&this.moveLayer(e,t,t+1)},e.prototype.moveLayer=function(e,t,r){var o=this.layers[r],n=o.zIndex,i=e.zIndex;e.zIndex=n,o.zIndex=i,this.layers[r]=e,this.layers[t]=o,this.layers$.next(this.layers.slice(0))},e.prototype.doAddLayer=function(e){e.baseLayer&&e.visible&&this.changeBaseLayer(e);var t=this.getLayerById(e.id);if(t===undefined){if(e.zIndex===undefined||0===e.zIndex){var r=e.baseLayer?1:10;e.zIndex=this.layers.length+r}return e.setMap(this),this.layerWatcher.watchLayer(e),this.ol.addLayer(e.ol),e}t.visible=!0},e.prototype.doRemoveLayer=function(e){this.layerWatcher.unwatchLayer(e),this.ol.removeLayer(e.ol),e.setMap(undefined)},e.prototype.setLayers=function(e){this.layers$.next(this.sortLayersByZIndex(e).slice(0))},e.prototype.sortLayersByZIndex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},e.prototype.getLayerIndex=function(t){return this.layers.findIndex(function(e){return e===t})},e.prototype.geolocate=function(u){var c=this;void 0===u&&(u=!1);var p=!0;this.geolocation$$&&(u=this.geolocation.getTracking(),this.unsubscribeGeolocate()),this.startGeolocation(),this.geolocation$$=this.geolocation$.subscribe(function(e){if(e){if(e.getAccuracy()<414e4){var t=e.getAccuracyGeometry(),r=t.getExtent();if(c.geolocationFeature&&c.overlay.dataSource.ol.getFeatureById(c.geolocationFeature.getId())&&c.overlay.dataSource.ol.removeFeature(c.geolocationFeature),c.geolocationFeature=new ie({geometry:t}),c.geolocationFeature.setId("geolocationFeature"),c.overlay.addOlFeature(c.geolocationFeature),c.ol.getView().options_.buffer){var o=c.ol.getView().options_.buffer.bufferRadius,n=e.getPosition();c.bufferGeom=new O(n,o);var i=c.ol.getView().options_.buffer.bufferStroke,a=c.ol.getView().options_.buffer.bufferFill,s=void 0;s=c.ol.getView().options_.buffer.showBufferRadius?o.toString()+"m":"",c.bufferFeature=new ie(c.bufferGeom),c.bufferFeature.setId("bufferFeature"),c.bufferFeature.set("bufferStroke",i),c.bufferFeature.set("bufferFill",a),c.bufferFeature.set("bufferText",s),console.log(c.bufferFeature),c.buffer.addOlFeature(c.bufferFeature)}p&&c.viewController.zoomToExtent(r)}else if(p){var l=c.ol.getView();n=e.getPosition();l.setCenter(n),l.setZoom(14)}u&&c.unsubscribeGeolocate(),p=!1}})},e.prototype.unsubscribeGeolocate=function(){this.stopGeolocation(),this.geolocation$$&&(this.geolocation$$.unsubscribe(),this.geolocation$$=undefined)},e.prototype.startGeolocation=function(){var t=this;this.geolocation?this.geolocation.setTracking(!0):(this.geolocation=new S({projection:this.projection,tracking:!0}),this.geolocation.on("change",function(e){t.geolocation$.next(t.geolocation)}))},e.prototype.stopGeolocation=function(){this.geolocation&&this.geolocation.setTracking(!1)},e}(),nr=function(){function e(e){var t=this;this.config=e,(this.config.getConfig("projections")||[]).forEach(function(e){t.registerProjection(e)})}return e.prototype.registerProjection=function(e){P.defs(e.code,e.def),D.register(P),se.get(e.code).setExtent(e.extent)},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Ie.ConfigService}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(Ie.ConfigService))},token:e,providedIn:"root"}),e}(),ir=function(){function e(e){this.activityService=e,this.id="igo-map-target-"+(new Date).getTime()}return Object.defineProperty(e.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e,this.map!==undefined&&this.map.updateView(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.status$$=this.map.status$.subscribe(function(e){return t.handleStatusChange(e)})},e.prototype.ngAfterViewInit=function(){this.map.setTarget(this.id)},e.prototype.ngOnDestroy=function(){this.map.setTarget(undefined),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()},e.prototype.handleStatusChange=function(e){e===Oe.SubjectStatus.Working&&this.activityId===undefined?this.activityId=this.activityService.register():e===Oe.SubjectStatus.Done&&this.activityId!==undefined&&(this.activityService.unregister(this.activityId),this.activityId=undefined)},e.decorators=[{type:Se.Component,args:[{selector:"igo-map-browser",template:'<div [id]="id" class="igo-map-browser-target"></div>\r\n<ng-content></ng-content>\r\n',styles:[":host{position:relative;display:block}.igo-map-browser-target,:host{width:100%;height:100%}:host>>>igo-zoom-button{position:absolute;bottom:5px;right:5px}:host>>>igo-geolocate-button{position:absolute;bottom:95px;right:5px}:host>>>igo-rotation-button{position:absolute;top:calc(40px + 5px + 5px);right:5px}:host>>>igo-user-button{position:absolute;bottom:5px;right:calc(5px + 50px)}:host>>>igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}:host.igo-attribution-offset>>>.ol-attribution{left:90px;width:calc(100% - 200px)}@media only screen and (max-width:450px),only screen and (max-height:450px){:host>>>igo-zoom-button{display:none}:host>>>igo-geolocate-button{bottom:5px}:host>>>igo-rotation-button{top:calc(40px + 5px + 5px)}:host>>>igo-user-button{right:calc(5px + 90px)}:host.igo-attribution-offset>>>.ol-attribution{left:50px}}:host>>>.ol-attribution{left:5px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:rgba(255,255,255,0);width:calc(100% - 100px)}:host>>>.ol-attribution.ol-logo-only{height:inherit}:host>>>.ol-attribution.ol-collapsed{background:0 0}:host>>>.ol-attribution.ol-collapsed button{-webkit-transform:none;transform:none}:host>>>.ol-attribution button{-webkit-transform:rotate(180deg);transform:rotate(180deg);background-color:#fff;cursor:pointer}:host>>>.ol-scale-line-inner{color:#000;border-color:#000}:host>>>.ol-scale-line{background-color:rgba(255,255,255,0);bottom:4px;-webkit-transform:translate(-50%);transform:translate(-50%);left:50%}:host>>>canvas{display:block}"]}]}],e.ctorParameters=function(){return[{type:Ie.ActivityService}]},e.propDecorators={map:[{type:Se.Input}],view:[{type:Se.Input}]},e}(),ar=function(){function e(){}return Object.defineProperty(e.prototype,"zoom",{get:function(){return this.map.viewController.getZoom()},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-zoom-button",template:'<div class="igo-zoom-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomIn\' | translate: {zoom: zoom + 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.viewController.zoomIn()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomOut\' | translate: {zoom: zoom - 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.viewController.zoomOut()">\r\n    <mat-icon svgIcon="minus"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-zoom-button-container{width:40px}.igo-zoom-button-container button{background-color:#fff}.igo-zoom-button-container button:hover{background-color:#efefef}.igo-zoom-button-container button:first-child{margin-bottom:2px}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={map:[{type:Se.Input}],color:[{type:Se.Input}]},e}(),sr=function(){function e(){}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-geolocate-button",template:'<div class="igo-geolocate-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.geolocate\' | translate"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.geolocate()">\r\n    <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-geolocate-button-container{width:40px;background-color:#fff}.igo-geolocate-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={map:[{type:Se.Input}],color:[{type:Se.Input}]},e}();function lr(){return j.trigger("baseLayerSwitcherState",[j.state("collapseIcon",j.style({height:"40px",width:"40px",overflow:"hidden"})),j.state("collapseMap",j.style({height:"85px",overflow:"hidden"})),j.state("expand",j.style({overflow:"hidden"})),j.transition("collapse => expand",j.animate("200ms")),j.transition("expand => collapse",j.animate("200ms"))])}var ur,cr,pr=function(){function e(e){this.mediaService=e,this._baseLayers=[],this.expand=!1,this.showButton=!0,this.mediaService.media$.value===Ie.Media.Mobile&&this.useStaticIcon===undefined&&(this.useStaticIcon=!0)}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useStaticIcon",{get:function(){return this._useStaticIcon},set:function(e){this._useStaticIcon=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t._baseLayers=e.filter(function(e){return e.baseLayer})})},e.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},e.prototype.collapseOrExpand=function(){1<this.baseLayers.length||this.useStaticIcon?this.expand=!this.expand:this.expand=!1},Object.defineProperty(e.prototype,"baseLayers",{get:function(){var t=this.map.viewController.getResolution(),e=this._baseLayers.filter(function(e){return(!e.options.maxResolution||t<=e.options.maxResolution)&&(!e.options.minResolution||t>=e.options.minResolution)}),r=e.filter(function(e){return!e.visible});return r.length+1===e.length?r:e},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-baselayers-switcher",template:'<div *ngIf="baseLayers.length > 0"\r\n     class="igo-baselayers-switcher-container"\r\n     [ngClass]="{\'container-expand\': expand}"\r\n     [@baseLayerSwitcherState]="expand ? \'expand\' : useStaticIcon ? \'collapseIcon\' : \'collapseMap\'"\r\n     (@baseLayerSwitcherState.start)="showButton=false"\r\n     (@baseLayerSwitcherState.done)="showButton=true"\r\n     (click)="collapseOrExpand()">\r\n\r\n     <div *ngIf="useStaticIcon && !expand && showButton" class="igo-baselayers-switcher-button-container">\r\n       <button\r\n         mat-icon-button\r\n         [matTooltip]="\'igo.geo.mapButtons.baselayerSwitcher\' | translate"\r\n         matTooltipPosition="right"\r\n         color="primary">\r\n         <mat-icon svgIcon="photo-library"></mat-icon>\r\n       </button>\r\n     </div>\r\n\r\n     <igo-mini-basemap *ngFor="let baseLayer of baseLayers; let i = index"\r\n       [map]="map"\r\n       [baseLayer]="baseLayer"\r\n       [display]="expand || (i === 0 && !useStaticIcon)"\r\n       [disabled]="!expand && baseLayers.length > 1">\r\n     </igo-mini-basemap>\r\n\r\n    <div class="more-baselayers">\r\n      <mat-icon class="material-icons mat-icon mat-list-avatar" color="primary" svgIcon="menu-down"></mat-icon>\r\n    </div>\r\n\r\n</div>\r\n',animations:[lr()],styles:[".igo-baselayers-switcher-container{height:auto;position:relative}.container-expand{overflow:hidden;border-width:0}.more-baselayers{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers:hover{background-color:#efefef}.igo-baselayers-switcher-button-container{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],e.ctorParameters=function(){return[{type:Ie.MediaService}]},e.propDecorators={map:[{type:Se.Input}],useStaticIcon:[{type:Se.Input}]},e}(),dr=function(){function e(e){this.layerService=e,this.basemap=new or({controls:{},interactions:!1})}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e,this.handleMoveEnd()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseLayer",{get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this.handleBaseLayerChanged(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return this._display},set:function(e){this._display=e},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this;this.map.ol.on("moveend",function(){return e.handleMoveEnd()}),this.handleMoveEnd()},e.prototype.ngOnDestroy=function(){var e=this;this.map.ol.un("moveend",function(){return e.handleMoveEnd()})},e.prototype.changeBaseLayer=function(e){this.disabled||this.map.changeBaseLayer(e)},e.prototype.handleMoveEnd=function(){this.basemap.ol.setView(this.map.ol.getView())},e.prototype.handleBaseLayerChanged=function(e){this.basemap.removeAllLayers();var t=Object.assign(Object.create(e.options),e.options);t.visible=!0;var r=this.layerService.createLayer(t);this.basemap.addLayer(r)},e.decorators=[{type:Se.Component,args:[{selector:"igo-mini-basemap",template:'<div class="igo-mini-basemap-container">\r\n\r\n  <div *ngIf="display" (click)="changeBaseLayer(baseLayer)">\r\n    <igo-map-browser [map]="basemap"></igo-map-browser>\r\n    <div class=\'igo-mini-basemap-title\'>{{baseLayer.title}}</div>\r\n  </div>\r\n\r\n</div>\r\n',styles:[".igo-mini-basemap-container{width:calc(40px * 2);height:calc(40px * 2);background-color:rgba(255,255,255,.01);border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.3);cursor:pointer;margin-top:5px}.igo-mini-basemap-container:hover .igo-mini-basemap-title{color:#000;text-shadow:0 0 5px #fff}.igo-mini-basemap-container>div{width:100%;height:100%}.igo-mini-basemap-title{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px #000;white-space:normal;display:flex;align-items:flex-end;justify-content:center}"]}]}],e.ctorParameters=function(){return[{type:mr}]},e.propDecorators={map:[{type:Se.Input}],baseLayer:[{type:Se.Input}],disabled:[{type:Se.Input}],display:[{type:Se.Input}]},e}(),fr=function(){function e(){}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),e.prototype.rotationStyle=function(e){return{transform:"rotate("+e+"rad)"}},e.decorators=[{type:Se.Component,args:[{selector:"igo-rotation-button",template:'<div class="igo-rotation-button-container">\r\n  <button\r\n    *ngIf="map.viewController.getRotation() !== 0" \r\n    mat-icon-button \r\n    [matTooltip]="\'igo.geo.mapButtons.resetRotation\' | translate"\r\n    matTooltipPosition="left" \r\n    [color]="color" \r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>',styles:[".igo-rotation-button-container{width:40px;background-color:#fff}.igo-rotation-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={map:[{type:Se.Input}],color:[{type:Se.Input}]},e}(),hr=function(){function f(){this._converters={},this._converters.esriPMS=f._convertEsriPMS,this._converters.esriSFS=f._convertEsriSFS,this._converters.esriSLS=f._convertEsriSLS,this._converters.esriSMS=f._convertEsriSMS,this._converters.esriTS=f._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}return f._convertPointToPixel=function(e){return e/.75},f._transformColor=function(e){return[e[0],e[1],e[2],e[3]/255]},f._getResolutionForScale=function(e,t){var r=se.METERS_PER_UNIT[t];return parseFloat(e)/(39.37*r*(25.4/.28))},f._convertEsriTS=function(e){var t=f._transformAngle(e.angle),r=e.text!==undefined?e.text:undefined;return new le.Style({text:new le.Text({fill:new le.Fill({color:f._transformColor(e.color)}),font:e.font.style+" "+e.font.weight+" "+e.font.size+" px "+e.font.family,textBaseline:e.verticalAlignment,textAlign:e.horizontalAlignment,offsetX:f._convertPointToPixel(e.xoffset),offsetY:f._convertPointToPixel(e.yoffset),rotation:t,text:r})})},f._convertEsriPMS=function(e){var t="data:"+e.contentType+";base64, "+e.imageData,r=f._transformAngle(e.angle);return new le.Style({image:new le.Icon({src:t,rotation:r})})},f._convertEsriSFS=function(e){var t=new le.Fill({color:f._transformColor(e.color)}),r=e.outline?f._convertOutline(e.outline):undefined;return new le.Style({fill:t,stroke:r})},f._convertOutline=function(e){var t,r=f._transformColor(e.color);return"esriSLSDash"===e.style?t=[5]:"esriSLSDashDot"===e.style?t=[5,5,1,2]:"esriSLSDashDotDot"===e.style?t=[5,5,1,2,1,2]:"esriSLSDot"===e.style?t=[1,2]:"esriSLSNull"===e.style&&(r[3]=0),new le.Stroke({color:r,lineDash:t,width:f._convertPointToPixel(e.width)})},f._convertEsriSLS=function(e){return new le.Style({stroke:f._convertOutline(e)})},f._transformAngle=function(e){if(0===e||e===undefined)return undefined;var t=-(e*Math.PI/180)+Math.PI/2;return t<0?2*Math.PI+t:t},f._convertEsriSMS=function(e){var t=new le.Fill({color:f._transformColor(e.color)}),r=e.outline?f._convertOutline(e.outline):undefined,o=f._convertPointToPixel(e.size)/2,n=f._transformAngle(e.angle);return"esriSMSCircle"===e.style?new le.Style({image:new le.Circle({radius:o,fill:t,stroke:r})}):"esriSMSCross"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:0,rotation:n})}):"esriSMSDiamond"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,rotation:n})}):"esriSMSSquare"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,angle:Math.PI/4,rotation:n})}):"esriSMSX"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:Math.PI/4,rotation:n})}):"esriSMSTriangle"===e.style?new le.Style({image:new le.RegularShape({fill:t,stroke:r,points:3,radius:o,angle:0,rotation:n})}):void 0},f.prototype._convertLabelingInfo=function(e,t){for(var r=[],o=0,n=e.length;o<n;++o){var i=e[o].labelExpression,a=i.substr(i.indexOf("[")+1,i.indexOf("]")-1),s=e[o].symbol,l=e[o].maxScale,u=e[o].minScale,c=null;0!==l&&(c=f._getResolutionForScale(l,t));var p=null;0!==u&&(p=f._getResolutionForScale(u,t));var d=this._converters[s.type].call(this,s);r.push(function(e,t){var r=!0;if(null!==this.minResolution&&null!==this.maxResolution?r=t<this.maxResolution&&t>=this.minResolution:null!==this.minResolution?r=t>=this.minResolution:null!==this.maxResolution&&(r=t<this.maxResolution),r){var o=e.get(this.field);return this.style.getText().setText(o),[this.style]}}.bind({minResolution:c,maxResolution:p,field:a,style:d}))}return r},f.prototype._renderSimple=function(e){var t=this._converters[e.symbol.type].call(this,e.symbol);return function(){return[t]}},f.prototype._renderClassBreaks=function(e){for(var t=e.defaultSymbol,n=this._converters[t.type].call(this,t),i=e.field,a=[],r=0,o=e.classBreakInfos.length;r<o;++r){var s=e.classBreakInfos[r],l=void 0;l=null===s.classMinValue||s.classMinValue===undefined?0===r?e.minValue:e.classBreakInfos[r-1].classMaxValue:s.classMinValue;var u=s.classMaxValue,c=s.symbol,p=this._converters[c.type].call(this,c);a.push({min:l,max:u,style:p})}return function(e){for(var t=e.get(i),r=0,o=a.length;r<o;++r)if(0===r?t>=a[r].min&&t<=a[r].max:t>a[r].min&&t<=a[r].max)return[a[r].style];return[n]}},f.prototype._renderUniqueValue=function(e){var t=e.defaultSymbol,i=[];t&&(i=[this._converters[t.type].call(this,t)]);var a=e.field1,s=e.uniqueValueInfos,l=this;return function(){for(var r={},e=0,t=s.length;e<t;++e){var o=s[e],n=o.symbol;r[o.value]=[l._converters[n.type].call(l,n)]}return function(e){var t=r[e.get(a)];return t||i}}()},f.prototype.generateStyle=function(e,t){var r=e.drawingInfo,a=[],o=this._renderers[r.renderer.type].call(this,r.renderer);if(o!==undefined&&a.push(o),e.labelingInfo){var n=this._convertLabelingInfo(e.labelingInfo,t);a=a.concat(n)}return 1===a.length?a[0]:function(e,t){for(var r=[],o=0,n=a.length;o<n;++o){var i=a[o].call(null,e,t);i&&(r=r.concat(i))}return r}},f}(),gr=function(){function e(e){this.http=e,this.capabilitiesStore=[],this.parsers={wms:new be.WMSCapabilities,wmts:new be.WMTSCapabilities}}return e.prototype.getWMSOptions=function(t){var r=this,e=t.url,o=t.params.version;return this.getCapabilities("wms",e,o).pipe(Fe.map(function(e){return r.parseWMSOptions(t,e)}))},e.prototype.getWMTSOptions=function(t){var r=this,e=t.url,o=t.version;return this.getCapabilities("wmts",e,o).pipe(Fe.map(function(e){return r.parseWMTSOptions(t,e)}))},e.prototype.getCartoOptions=function(t){var r=this,e="https://"+t.account+".carto.com/api/v2/viz/"+t.mapId+"/viz.json";return this.http.jsonp(e,"callback").pipe(Fe.map(function(e){return r.parseCartoOptions(t,e)}))},e.prototype.getArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url.replace("FeatureServer","MapServer")+"/legend?f=json",n=this.http.get(e),i=this.http.get(o).pipe(Fe.map(function(e){return e}),Fe.catchError(function(e){return console.log("No legend associated with this Feature Service"),he.of(e)}));return he.forkJoin([n,i]).pipe(Fe.map(function(e){return r.parseArcgisOptions(t,e[0],e[1])}))},e.prototype.getTileArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url+"/legend?f=json",n=this.http.get(e),i=this.http.get(o);return he.forkJoin([n,i]).pipe(Fe.map(function(e){return r.parseTileArcgisOptions(t,e[0],e[1])}))},e.prototype.getCapabilities=function(t,e,r){var o=this,n=new we.HttpParams({fromObject:{request:"GetCapabilities",service:t,version:r||"1.3.0"}});return this.http.get(e,{params:n,responseType:"text"}).pipe(Fe.map(function(e){return o.parsers[t].read(e)}))},e.prototype.parseWMSOptions=function(e,t){var r=e.params.layers,o=this.findDataSourceInCapabilities(t.Capability.Layer,r);if(!o)return e;var n=o.DataURL?o.DataURL[0]:undefined,i=o.Abstract?o.Abstract:undefined,a=o.KeywordList?o.KeywordList:undefined,s=o.queryable,l=this.getTimeFilter(o),u=l&&0<Object.keys(l).length,c=Oe.ObjectUtils.removeUndefined({_layerOptionsFromCapabilities:{title:o.Title,maxResolution:Jt(o.MaxScaleDenominator)||Infinity,minResolution:Jt(o.MinScaleDenominator)||0,metadata:{url:n?n.OnlineResource:undefined,extern:!!n||undefined,"abstract":i,keywordList:a}},queryable:s,timeFilter:u?l:undefined,timeFilterable:!!u||undefined});return Oe.ObjectUtils.mergeDeep(c,e)},e.prototype.parseWMTSOptions=function(e,t){var r=y.optionsFromCapabilities(t,e);return Object.assign(r,e)},e.prototype.parseCartoOptions=function(e,t){var r=[],o=t.layers[1].options.layer_definition;o.layers.forEach(function(e){r.push({type:e.type.toLowerCase(),options:e.options,legend:e.legend})});var n=Oe.ObjectUtils.removeUndefined({config:{version:o.version,layers:r}});return Oe.ObjectUtils.mergeDeep(n,e)},e.prototype.parseArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new hr,s="esriMeters"===t.units?"m":"degrees",l=a.generateStyle(t,s),u=new w({html:t.copyrightText});if(t.timeInfo){var c=t.timeInfo.timeExtent;o=c[0]+","+c[1];var p=new Date;p.setTime(c[0]);var d=new Date;d.setTime(c[1]),n={min:p.toUTCString(),max:d.toUTCString(),range:!0,type:"datetime",style:"calendar"}}var f=Object.assign({},{legendInfo:i,style:l,timeFilter:n,timeExtent:o,attributions:u}),h=Oe.ObjectUtils.removeUndefined({params:f});return Oe.ObjectUtils.mergeDeep(h,e)},e.prototype.parseTileArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new w({html:t.copyrightText});if(t.timeInfo){var s=t.timeInfo.timeExtent;o=s[0]+","+s[1];var l=new Date;l.setTime(s[0]);var u=new Date;u.setTime(s[1]),n={min:l.toUTCString(),max:u.toUTCString(),range:!0,type:"datetime",style:"calendar"}}var c=Object.assign({},{layers:"show:"+e.layer,time:o}),p=Oe.ObjectUtils.removeUndefined({params:c,legendInfo:i,timeFilter:n,attributions:a});return Oe.ObjectUtils.mergeDeep(p,e)},e.prototype.findDataSourceInCapabilities=function(e,t){var r,o=this;return Array.isArray(e)?(e.find(function(e){return(r=o.findDataSourceInCapabilities(e,t))!==undefined},this),r):e.Layer?this.findDataSourceInCapabilities(e.Layer,t):e.Name&&e.Name===t?e:undefined},e.prototype.getTimeFilter=function(e){var t;if(e.Dimension){var r={};if((t=e.Dimension[0]).values){var o=t.values.split("/");r.min=o[0]!==undefined?o[0]:undefined,r.max=o[1]!==undefined?o[1]:undefined,r.step=o[2]!==undefined?o[2]:undefined}return t["default"]&&(r.value=t["default"]),r}},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:we.HttpClient}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(we.HttpClient))},token:e,providedIn:"root"}),Te([g.Cacheable(),Le("design:type",Function),Le("design:paramtypes",[String,String,String]),Le("design:returntype",he.Observable)],e.prototype,"getCapabilities",null),e}(),yr=function(){function e(e,t,r){this.capabilitiesService=e,this.wfsDataSourceService=t,this.networkService=r,this.datasources$=new he.BehaviorSubject([])}return e.prototype.createAsyncDataSource=function(e){if(!e.type)throw console.error(e),new Error("Datasource needs a type");var t;switch(e.type.toLowerCase()){case"osm":t=this.createOSMDataSource(e);break;case"vector":t=this.createFeatureDataSource(e);break;case"wfs":t=this.createWFSDataSource(e);break;case"wms":t=this.createWMSDataSource(e);break;case"wmts":t=this.createWMTSDataSource(e);break;case"xyz":t=this.createXYZDataSource(e);break;case"carto":t=this.createCartoDataSource(e);break;case"arcgisrest":t=this.createArcGISRestDataSource(e);break;case"websocket":t=this.createWebSocketDataSource(e);break;case"mvt":t=this.createMVTDataSource(e);break;case"tilearcgisrest":t=this.createTileArcGISRestDataSource(e);break;case"cluster":t=this.createClusterDataSource(e);break;default:throw console.error(e),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([t])),t},e.prototype.createOSMDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new Ne(t,r.networkService))})},e.prototype.createFeatureDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new Be(t,r.networkService))})},e.prototype.createWebSocketDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new tt(t,r.networkService))})},e.prototype.createWFSDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new Ue(t,r.networkService,r.wfsDataSourceService))})},e.prototype.createWMSDataSource=function(t){var r=this;return t.optionsFromCapabilities?this.capabilitiesService.getWMSOptions(t).pipe(Fe.map(function(e){return new Qe(t,r.networkService,r.wfsDataSourceService)})):new he.Observable(function(e){return e.next(new Qe(t,r.networkService,r.wfsDataSourceService))})},e.prototype.createWMTSDataSource=function(t){var r=this;return t.optionsFromCapabilities?this.capabilitiesService.getWMTSOptions(t).pipe(Fe.map(function(e){return new Ze(e,r.networkService)})):new he.Observable(function(e){return e.next(new Ze(t,r.networkService))})},e.prototype.createXYZDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new We(t,r.networkService))})},e.prototype.createCartoDataSource=function(t){var r=this;return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe(Fe.map(function(e){return new Je(e,r.networkService)})):new he.Observable(function(e){return e.next(new Je(t,r.networkService))})},e.prototype.createArcGISRestDataSource=function(e){var t=this;return this.capabilitiesService.getArcgisOptions(e).pipe(Fe.map(function(e){return new Xe(e,t.networkService)}))},e.prototype.createTileArcGISRestDataSource=function(e){var t=this;return this.capabilitiesService.getTileArcgisOptions(e).pipe(Fe.map(function(e){return new et(e,t.networkService)}))},e.prototype.createMVTDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new rt(t,r.networkService))})},e.prototype.createClusterDataSource=function(t){var r=this;return new he.Observable(function(e){return e.next(new ot(t,r.networkService))})},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:gr},{type:ze},{type:Ie.NetworkService}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(gr),Se.inject(ze),Se.inject(Ie.NetworkService))},token:e,providedIn:"root"}),e}(),mr=function(){function e(e,t,r){this.styleService=e,this.dataSourceService=t,this.config=r,this.config&&(this.tokenKey=this.config.getConfig("auth.tokenKey"))}return e.prototype.createLayer=function(e){if(e.source){var t;switch(e.source.options&&e.source.options.optionsFromCapabilities&&(e=Oe.ObjectUtils.mergeDeep(e.source.options._layerOptionsFromCapabilities||{},e||{})),e.source.constructor){case Ne:case Ze:case We:case Je:case et:t=this.createTileLayer(e);break;case Be:case Ue:case Xe:case tt:case ot:t=this.createVectorLayer(e);break;case Qe:t=this.createImageLayer(e);break;case rt:t=this.createVectorTileLayer(e)}return t}},e.prototype.createAsyncLayer=function(t){var r=this;return t.source?new he.Observable(function(e){return e.next(r.createLayer(t))}):this.dataSourceService.createAsyncDataSource(t.sourceOptions).pipe(Fe.map(function(e){return t.source=e,r.createLayer(t)}))},e.prototype.createImageLayer=function(e){return this.tokenKey&&(e.token=localStorage.getItem(this.tokenKey)),new dt(e)},e.prototype.createTileLayer=function(e){return new ft(e)},e.prototype.createVectorLayer=function(t){var e;(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.source instanceof Xe)&&(e=t.source.options.params.style);if(t.source instanceof ot){var r=this.styleService;return t.style=function(e){return r.createClusterStyle(e,t.clusterParam)},new ht(t)}if(t.styleByAttribute){var o=this.styleService;return t.style=function(e){return o.createStyleByAttribute(e,t.styleByAttribute)},new ht(t)}var n=Object.assign({},t,{style:e});return new ht(n)},e.prototype.createVectorTileLayer=function(t){var e;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.styleByAttribute){var r=this.styleService;return t.style=function(e){return r.createStyleByAttribute(e,t.styleByAttribute)},new gt(t)}var o=Object.assign({},t,{style:e});return new gt(o)},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:yt},{type:yr},{type:Ie.ConfigService,decorators:[{type:Se.Optional}]}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(yt),Se.inject(yr),Se.inject(Ie.ConfigService,8))},token:e,providedIn:"root"}),e}(),vr={Layer:"layer",Group:"group"},br=function(){function e(e){this.http=e,this.queryEnabled=!0}return e.prototype.query=function(e,t){var r=this;return e.filter(function(e){return e.visible&&e.isInResolutionsRange}).map(function(e){return r.queryLayer(e,t)})},e.prototype.queryLayer=function(t,r){var o=this,n=this.getQueryUrl(t.dataSource,r);return n?this.http.get(n,{responseType:"text"}).pipe(Fe.map(function(e){return o.extractData(e,t,r,n)})):he.of([])},e.prototype.extractData=function(e,n,i,t){var r,a=n.dataSource;n.options&&n.options.sourceOptions&&n.options.sourceOptions.sourceFields&&1<=n.options.sourceOptions.sourceFields.length&&(r={},n.options.sourceOptions.sourceFields.forEach(function(e){var t=e.alias?e.alias:e.name;r[e.name]=t}));var s=[];switch(a.options.queryFormat){case Ke.GML3:s=this.extractGML3Data(e,n.zIndex,r);break;case Ke.JSON:case Ke.GEOJSON:s=this.extractGeoJSONData(e);break;case Ke.ESRIJSON:s=this.extractEsriJSONData(e,n.zIndex);break;case Ke.TEXT:s=this.extractTextData(e);break;case Ke.HTML:s=this.extractHtmlData(e,a.queryHtmlTarget,t);break;case Ke.GML2:default:s=this.extractGML2Data(e,n,r)}return s.map(function(e,t){var r=e.properties[a.queryTitle];!r&&1<s.length?r=n.title+" ("+(t+1)+")":r||(r=n.title);var o=Object.assign({},e.meta||{},{id:Oe.uuid(),title:r,mapTitle:r,sourceTitle:n.title,order:1e3-n.zIndex});return Object.assign(e,{meta:o,projection:"carto"===a.options.type?"EPSG:4326":i.projection})})},e.prototype.extractGML2Data=function(e,t,r){var o=this,n=new k,i=n.readFeatures(e);return 0===i.length&&(i=(n=new be.WMSGetFeatureInfo).readFeatures(e)),i.map(function(e){return o.featureToResult(e,t,r)})},e.prototype.extractGML3Data=function(e,t,r){var o=this;return(new E).readFeatures(e).map(function(e){return o.featureToResult(e,t,r)})},e.prototype.extractGeoJSONData=function(e){var t=[];try{t=JSON.parse(e).features}catch(r){console.warn("query.service: Unable to parse geojson","\n",e)}return t},e.prototype.extractEsriJSONData=function(e,t){var r=this;return(new R).readFeatures(e).map(function(e){return r.featureToResult(e,t)})},e.prototype.extractTextData=function(e){return[]},e.prototype.extractHtmlData=function(e,t,r){var o=this.getQueryParams(r.toLowerCase()),n=o.bbox,i=parseInt(o.width,10),a=parseInt(o.height,10),s=parseInt(o.i||o.x,10),l=parseInt(o.j||o.y,10),u=o.crs||o.srs||"EPSG:3857",c=n.split(","),p=.05*(Math.abs(parseFloat(c[0]))-Math.abs(parseFloat(c[2])));Math.abs(parseFloat(c[0]))<180&&(p=.045);var d=parseFloat(c[0])+Math.abs(parseFloat(c[0])-parseFloat(c[2]))*s/i-p,f=parseFloat(c[1])+Math.abs(parseFloat(c[1])-parseFloat(c[3]))*l/a-p,h=d+2*p,g=f+2*p,y="POLYGON(("+d+" "+f+", "+d+" "+g+", "+h+" "+g+", "+h+" "+f+", "+d+" "+f+"))",m=(new be.WKT).readFeature(y).getGeometry();t!==He.BLANK&&t!==He.IFRAME&&(t=He.IFRAME);var v=e.toLowerCase().indexOf("<body>"),b=e.toLowerCase().lastIndexOf("</body>")+7;return"<body></body>"===e.slice(v,b).replace(/(\r|\n|\s)/g,"")||""===e?[]:[{type:nt,projection:u,properties:{target:t,body:e,url:r},geometry:{type:m.getType(),coordinates:m.getCoordinates()}}]},e.prototype.getQueryParams=function(e){var t=e.split("?");if(t[1]){var r=t[1].split("&"),o={};return r.forEach(function(e){e=e.split("="),o[e[0]]=decodeURIComponent(e[1]||"")}),o}},e.prototype.featureToResult=function(e,t,r){var o,n=e.getGeometry(),i=Object.assign({},e.getProperties());return delete i.geometry,delete i.boundedBy,delete i.shape,delete i.SHAPE,delete i.the_geom,n!==undefined&&(o={type:n.getType(),coordinates:n.getCoordinates()}),{type:nt,projection:undefined,properties:i,geometry:o,meta:{id:Oe.uuid(),order:1e3-t,alias:r}}},e.prototype.getQueryUrl=function(e,t){var r;switch(e.constructor){case Qe:var o=e;r=o.ol.getGetFeatureInfoUrl(t.coordinates,t.resolution,t.projection,{INFO_FORMAT:o.params.info_format||this.getMimeInfoFormat(e.options.queryFormat),QUERY_LAYERS:o.params.layers,FEATURE_COUNT:o.params.feature_count||"5"}),"1.3.0"!==o.params.version&&(r=(r=r.replace("&I=","&X=")).replace("&J=","&Y="));break;case Je:var n=e,i="https://"+n.options.account+".carto.com/api/v2/sql?",a="&q="+n.options.config.layers[0].options.sql,s=n.options.queryPrecision?n.options.queryPrecision:"1000";r=i+"format=GeoJSON"+a+" WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT("+(t.coordinates[0]+","+t.coordinates[1]+"),3857),"+s+"))");break;case et:var l=e,u=pe.boundingExtent([t.coordinates]);l.options.queryPrecision&&(u=pe.buffer(u,l.options.queryPrecision)),r=l.options.url+"/"+l.options.layer+"/query/"+"?"+["f=json","geometry="+encodeURIComponent('{"xmin":'+u[0]+',"ymin":'+u[1]+',"xmax":'+u[2]+',"ymax":'+u[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}return r},e.prototype.getMimeInfoFormat=function(e){var t;switch(e){case Ke.GML2:t="application/vnd.ogc.gml";break;case Ke.GML3:t="application/vnd.ogc.gml/3.1.1";break;case Ke.JSON:t="application/json";break;case Ke.GEOJSON:t="application/geojson";break;case Ke.TEXT:t="text/plain";break;case Ke.HTML:t="text/html";break;default:t="application/vnd.ogc.gml"}return t},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:we.HttpClient}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(we.HttpClient))},token:e,providedIn:"root"}),e}(),Sr=function(){function e(e,t){this.component=e,this.queryService=t,this.queries$$=[],this.queryFeatures=!0,this.queryFeaturesHitTolerance=0,this.waitForAllQueries=!1,this.query=new Se.EventEmitter}return Object.defineProperty(e.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.listenToMapClick()},e.prototype.ngOnDestroy=function(){this.cancelOngoingQueries(),this.unlistenToMapClick()},e.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onMapEvent(e)})},e.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},e.prototype.onMapEvent=function(r){var o=this;if(this.cancelOngoingQueries(),this.queryService.queryEnabled){var e=[];this.queryFeatures&&e.push(this.doQueryFeatures(r)),console.log(e);var t=this.map.ol.getView().getResolution(),n=this.map.layers.filter(mt);e.push.apply(e,je(this.queryService.query(n,{coordinates:r.coordinate,projection:this.map.projection,resolution:t}))),0!==e.length&&(this.waitForAllQueries?this.queries$$.push(he.zip.apply(void 0,je(e)).subscribe(function(e){var t=[].concat.apply([],je(e));console.log(e),console.log(t),o.query.emit({features:t,event:r})})):this.queries$$=e.map(function(e){return e.subscribe(function(e){console.log(e),o.query.emit({features:e,event:r})})}),console.log(this.queries$$),console.log(this.query))}},e.prototype.doQueryFeatures=function(e){var u,c,p=this,d=[];this.map.ol.forEachFeatureAtPixel(e.pixel,function(e,t){var r,o;if(e){if(e.get("features")&&(e=e.get("features")[0],console.log(e),1<e.length))return;if(u=kt(e,p.map.projection,t),d.push(u),console.log(t),"mvt"===u.meta.typeSource){var n=p.sameDataTilesFeature(u,t);try{for(var i=Pe(n),a=i.next();!a.done;a=i.next()){var s=a.value;c=kt(s,p.map.projection),d.push(c)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}}}else u=kt(e,p.map.projection,t),d.push(u);console.log(t),console.log(u)},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:vt});var t=d.shift();return d.shift(),d.push(t),console.log(d),he.of(d)},e.prototype.cancelOngoingQueries=function(){this.queries$$.forEach(function(e){return e.unsubscribe()}),this.queries$$=[]},e.prototype.getTiles=function(t,r,o){var n,i=[];return Object.keys(t).forEach(function(e){null!==(n=t[e]).features_&&n.features_.forEach(function(e){e.get(o)===r.properties[o]&&i.push(e)})}),i},e.prototype.sameDataTilesFeature=function(e,t){var r,o,n=t.values_.sourceOptions.key;return o=(o=t.values_.source.tileCache.entries_)[Object.keys(o)[0]].value_.sourceTiles_,r=this.getTiles(o,e,n),console.log(r),r},e.decorators=[{type:Se.Directive,args:[{selector:"[igoQuery]"}]}],e.ctorParameters=function(){return[{type:ir,decorators:[{type:Se.Self}]},{type:br}]},e.propDecorators={queryFeatures:[{type:Se.Input}],queryFeaturesHitTolerance:[{type:Se.Input}],queryFeaturesCondition:[{type:Se.Input}],waitForAllQueries:[{type:Se.Input}],query:[{type:Se.Output}]},e}(),wr=function(){function e(e){this.options=Object.assign({},this.getDefaultOptions(),e)}return e.prototype.getId=function(){throw new Error('You have to implement the method "getId".')},e.prototype.getDefaultOptions=function(){throw new Error('You have to implement the method "getDefaultOptions".')},Object.defineProperty(e.prototype,"title",{get:function(){return this.options.title},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return!1!==this.options.available},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this.available&&!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchUrl",{get:function(){return this.options.searchUrl},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"params",{get:function(){return this.options.params===undefined?{}:this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayOrder",{get:function(){return this.options.order===undefined?99:this.options.order},enumerable:!0,configurable:!0}),e.id="",e.type="",e}(),Fr=function(t){function e(e){return t.call(this,e)||this}return Me(e,t),e.prototype.getId=function(){return e.id},e.prototype.getDefaultOptions=function(){return{title:"Carte"}},e.id="map",e.type=nt,e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},e}(wr),Or=function(){function e(e,t,r,o){this.http=e,this.config=t,this.languageService=r,this.capabilitiesService=o}return e.prototype.loadCatalogs=function(){var e=this.config.getConfig("context")||{},t=this.config.getConfig("catalog")||{},r=t.url||e.url,o=t.sources||[];if(r===undefined)return he.of(o);var n=[];if(t.baseLayers){var i={id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:r+"/baselayers",type:"baselayers"};n.push(he.of(i))}var a=this.http.get(r+"/catalogs").pipe(Fe.catchError(function(e){return he.EMPTY}));return n.push(a),0<o.length&&n.push(he.of(o)),he.concat.apply(void 0,je(n))},e.prototype.loadCatalogItems=function(e){return"baselayers"===e.type?this.loadCatalogBaseLayerItems(e):"wmts"===e.type?this.loadCatalogWMTSLayerItems(e):this.loadCatalogWMSLayerItems(e)},e.prototype.loadCatalogBaseLayerItems=function(r){return this.getCatalogBaseLayersOptions(r).pipe(Fe.map(function(e){var t=e.map(function(e){return{id:Ee(e.sourceOptions),title:e.title,type:vr.Layer,options:e}});return[{id:"catalog.group.baselayers",type:vr.Group,title:r.title,items:t}]}))},e.prototype.getCatalogBaseLayersOptions=function(e){return this.http.get(e.url)},e.prototype.loadCatalogWMSLayerItems=function(r){var o=this;return this.getCatalogWMSCapabilities(r).pipe(Fe.map(function(e){var t=[];return o.includeRecursiveItems(r,e.Capability.Layer,t),t}))},e.prototype.loadCatalogWMTSLayerItems=function(t){var r=this;return this.getCatalogWMTSCapabilities(t).pipe(Fe.map(function(e){return r.getWMTSItems(t,e)}))},e.prototype.getCatalogWMSCapabilities=function(e){return this.capabilitiesService.getCapabilities("wms",e.url,e.version)},e.prototype.getCatalogWMTSCapabilities=function(e){return this.capabilitiesService.getCapabilities("wmts",e.url,e.version)},e.prototype.includeRecursiveItems=function(p,r,o){var e,t,d=this,f=(p.regFilters||[]).map(function(e){return new RegExp(e)}),n=function(e){if(e.Layer!==undefined)return i.includeRecursiveItems(p,e,o),"continue";var u=i.retrieveTooltipType(p),c=i.findCatalogInfoFormat(p),t={id:"catalog.group."+r.Name,type:vr.Group,title:r.Title,items:r.Layer.reduce(function(e,t){var r=d.retriveLayerInfoFormat(t.Name,c);if(!1===d.testLayerRegexes(t.Name,f))return e;var o=t.DataURL?t.DataURL[0]:undefined,n=t.Abstract?t.Abstract:undefined,i=t.KeywordList?t.KeywordList:undefined,a=d.capabilitiesService.getTimeFilter(t),s=!!(a&&0<Object.keys(a).length),l={type:"wms",url:p.url,params:{layers:t.Name,feature_count:p.count},timeFilter:Ce({},a,p.timeFilter),timeFilterable:!!s,queryable:t.queryable,queryFormat:r,queryHtmlTarget:p.queryHtmlTarget||He.IFRAME};return e.push({id:Ee(l),type:vr.Layer,title:t.Title,options:{title:t.Title,maxResolution:Jt(t.MaxScaleDenominator)||Infinity,minResolution:Jt(t.MinScaleDenominator)||0,metadata:{url:o?o.OnlineResource:undefined,extern:!!o||undefined,"abstract":n,keywordList:i},tooltip:{type:u},sourceOptions:l}}),e},[])};return 0!==t.items.length&&o.push(t),"break"},i=this;try{for(var a=Pe(r.Layer),s=a.next();!s.done;s=a.next()){if("break"===n(s.value))break}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}},e.prototype.getWMTSItems=function(r,e){var o=this,t=e.Contents.Layer,n=(r.regFilters||[]).map(function(e){return new RegExp(e)});return t.map(function(e){if(!1===o.testLayerRegexes(e.Identifier,n))return undefined;var t={type:"wmts",url:r.url,layer:e.Identifier,matrixSet:r.matrixSet,optionsFromCapabilities:!0,requestEncoding:r.requestEncoding||"KVP",style:"default",params:{version:"1.0.0"}};return{id:Ee(t),type:vr.Layer,title:e.Title,options:{title:e.Title,sourceOptions:t}}}).filter(function(e){return e!==undefined})},e.prototype.testLayerRegexes=function(t,e){return 0===e.length||e.find(function(e){return e.test(t)})!==undefined},e.prototype.retriveLayerInfoFormat=function(t,e){var r,o=e.find(function(e){return e.layer===t}),n=e.find(function(e){return"*"===e.layer});return o?r=o.queryFormat:n&&(r=n.queryFormat),r},e.prototype.retrieveTooltipType=function(e){return e.tooltipType?e.tooltipType:lt.TITLE},e.prototype.findCatalogInfoFormat=function(t){var e=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(function(r){t.queryFormat[r]instanceof Array?t.queryFormat[r].forEach(function(t){e.find(function(e){return e.layer===t})||e.push({layer:t,queryFormat:r})}):e.find(function(e){return e.layer===t.queryFormat[r]})||e.push({layer:t.queryFormat[r],queryFormat:r})}),e},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.ConfigService},{type:Ie.LanguageService},{type:gr}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(we.HttpClient),Se.inject(Ie.ConfigService),Se.inject(Ie.LanguageService),Se.inject(gr))},token:e,providedIn:"root"}),e}(),Ir=function(){function e(e,t){this.layerService=e,this.cdRef=t}return e.prototype.ngOnInit=function(){var e=this.map.layers.map(function(e){return{id:e.id,title:e.title,type:vr.Layer}});this.store.state.updateMany(e,{added:!0},!0),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}}),this.watcher=new ve.EntityStoreWatcher(this.store,this.cdRef)},e.prototype.ngOnDestroy=function(){this.watcher.destroy()},e.prototype.isGroup=function(e){return e.type===vr.Group},e.prototype.isLayer=function(e){return e.type===vr.Layer},e.prototype.onLayerAddedChange=function(e){var t=e.layer;this.store.state.update(t,{added:e.added},!1),e.added?this.addLayerToMap(t):this.removeLayerFromMap(t)},e.prototype.onGroupAddedChange=function(e){var t=e.group;this.store.state.update(t,{added:e.added},!1),e.added?this.addGroupToMap(t):this.removeGroupFromMap(t)},e.prototype.addLayerToMap=function(e){this.addLayersToMap([e])},e.prototype.removeLayerFromMap=function(e){this.removeLayersFromMap([e])},e.prototype.addLayersToMap=function(t){var r=this,e=t.map(function(e){return r.layerService.createAsyncLayer(e.options)});he.zip.apply(void 0,je(e)).subscribe(function(e){r.store.state.updateMany(t,{added:!0}),r.map.addLayers(e)})},e.prototype.removeLayersFromMap=function(e){var r=this;e.forEach(function(e){r.store.state.update(e,{added:!1});var t=r.map.getLayerById(e.id);t!==undefined&&r.map.removeLayer(t)})},e.prototype.addGroupToMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!1===t});this.addLayersToMap(t)},e.prototype.removeGroupFromMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!0===t});this.removeLayersFromMap(t)},e.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-browser",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)">\r\n      <igo-catalog-browser-group\r\n        [catalog]="catalog"\r\n        [group]="item"\r\n        [state]="store.state"\r\n        (addedChange)="onGroupAddedChange($event)"\r\n        (layerAddedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-group>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [added]="store.state.get(item).added"\r\n        [disabled]="store.state.get(item).added"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:mr},{type:Se.ChangeDetectorRef}]},e.propDecorators={catalog:[{type:Se.Input}],store:[{type:Se.Input}],map:[{type:Se.Input}]},e}(),xr=function(){function e(){this.addedChange=new Se.EventEmitter}return Object.defineProperty(e.prototype,"title",{get:function(){return ve.getEntityTitle(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return ve.getEntityIcon(this.layer)||"layers"},enumerable:!0,configurable:!0}),e.prototype.onToggleClick=function(){this.added?this.remove():this.add()},e.prototype.add=function(){this.added=!0,this.addedChange.emit({added:!0,layer:this.layer})},e.prototype.remove=function(){this.added=!1,this.addedChange.emit({added:!1,layer:this.layer})},e.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-browser-layer",template:'<mat-list-item>\r\n  <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n  <h4 mat-line>{{title}}</h4>\r\n  \r\n  <button\r\n    mat-icon-button\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="(added ? \'igo.geo.catalog.layer.removeFromMap\' : \'igo.geo.catalog.layer.addToMap\') | translate"\r\n    [color]="added ? \'warn\' : \'\'"\r\n    (click)="onToggleClick()">\r\n    <mat-icon [svgIcon]="added ? \'delete\' : \'plus\'"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[]},e.propDecorators={layer:[{type:Se.Input}],added:[{type:Se.Input}],addedChange:[{type:Se.Output}]},e}(),Mr=function(){function e(){this.store=new ve.EntityStore([]),this.added$=new he.BehaviorSubject(!1),this.addedChange=new Se.EventEmitter,this.layerAddedChange=new Se.EventEmitter}return Object.defineProperty(e.prototype,"title",{get:function(){return this.group.title},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.store.load(this.group.items),this.evaluateAdded(),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}})},e.prototype.ngOnDestroy=function(){this.store.destroy()},e.prototype.isGroup=function(e){return e.type===vr.Group},e.prototype.isLayer=function(e){return e.type===vr.Layer},e.prototype.onToggleClick=function(){this.added$.value?this.remove():this.add()},e.prototype.onLayerAddedChange=function(e){this.layerAddedChange.emit(e),this.tryToggleGroup(e)},e.prototype.add=function(){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group})},e.prototype.remove=function(){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group})},e.prototype.tryToggleGroup=function(e){var t=this,r=e.added,o=e.layer;this.store.view.all().filter(function(e){return e.id!==o.id}).map(function(e){return t.state.get(e).added||!1}).every(function(e){return e===r})?r?this.add():this.remove():!0===this.added$.value&&this.added$.next(!1)},e.prototype.evaluateAdded=function(){var t=this,e=this.store.all().every(function(e){return!0===(t.state.get(e).added||!1)});this.added$.next(e)},e.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-browser-group",template:'<mat-list-item>\r\n  <mat-icon\r\n    mat-list-avatar\r\n    igoCollapse\r\n    class="igo-chevron"\r\n    [target]="items"\r\n    [collapsed]="true"\r\n    svgIcon="chevron-up">\r\n  </mat-icon>\r\n\r\n  <h4 matLine>{{title}}</h4>\r\n\r\n  <ng-container *ngIf="added$ | async; else notadded">\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.removeFromMap\' | translate"\r\n      color="warn"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n  </ng-container>\r\n\r\n  <ng-template #notadded>\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.addToMap\' | translate"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="plus"></mat-icon>\r\n    </button>\r\n  </ng-template>\r\n</mat-list-item>\r\n\r\n<div #items>\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)"></ng-container>\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [added]="state.get(item).added"\r\n        [disabled]="state.get(item).added"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={catalog:[{type:Se.Input}],group:[{type:Se.Input}],state:[{type:Se.Input}],addedChange:[{type:Se.Output}],layerAddedChange:[{type:Se.Output}]},e}(),Cr=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatButtonModule,ye.MatIconModule,ye.MatListModule,ye.MatTooltipModule,Ie.IgoLanguageModule,ve.IgoListModule,ve.IgoCollapsibleModule],exports:[Ir],declarations:[Ir,Mr,xr]}]}],e}(),Tr=function(){function e(){this.catalogSelectChange=new Se.EventEmitter}return e.prototype.ngOnInit=function(){this.store.state.clear()},e.prototype.onCatalogSelect=function(e){this.store.state.update(e,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:e})},e.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-library",template:'<igo-list [navigation]="false">\r\n  <ng-template ngFor let-catalog [ngForOf]="store.view.all$() | async">\r\n    <igo-catalog-library-item\r\n      igoListItem\r\n      color="accent"\r\n      [map]="map"\r\n      [catalog]="catalog"\r\n      (select)="onCatalogSelect(catalog)">\r\n    </igo-catalog-library-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={store:[{type:Se.Input}],map:[{type:Se.Input}],catalogSelectChange:[{type:Se.Output}]},e}(),Lr=function(){function e(){}return Object.defineProperty(e.prototype,"title",{get:function(){return ve.getEntityTitle(this.catalog)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return ve.getEntityIcon(this.catalog)||"image-multiple"},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-catalog-library-item",template:'<mat-list-item>\r\n  <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n  <h4 mat-line>{{title}}</h4>\r\n</mat-list-item>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.propDecorators={catalog:[{type:Se.Input}],map:[{type:Se.Input}]},e}(),Pr=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatIconModule,ye.MatListModule,ye.MatTooltipModule,ve.IgoListModule],exports:[Tr],declarations:[Tr,Lr]}]}],e}(),Dr=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatIconModule,ye.MatListModule,ye.MatTooltipModule,ve.IgoListModule,ve.IgoCollapsibleModule],exports:[Cr,Pr],declarations:[]}]}],e}(),jr=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e.decorators=[{type:Se.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],e}(),kr=function(){function e(){}return e.prototype.transform=function(e,t){var r,o=this;return"time"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isTimeFilterable(t)&&t.options.timeFilter!==undefined&&Object.keys(t.options.timeFilter).length})),"ogc"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isOgcFilterable(t)})),r},e.prototype.isTimeFilterable=function(e){return"wms"===e.options.type&&e.options.timeFilterable},e.prototype.isOgcFilterable=function(e){return!(!e.options.ogcFilters||!e.options.ogcFilters.enabled)},e.decorators=[{type:Se.Pipe,args:[{name:"filterableDataSource"}]}],e}(),Er=function(){function e(){}return e.prototype.filterByDate=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=this.reformatDateTime(t[0]),i.push(t[0])),t[1]&&(n=this.reformatDateTime(t[1]),i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof et?o+","+n:o+"/"+n),o===n&&(r=o)}else t&&(r=this.reformatDateTime(t));var a={time:r};e.ol.updateParams(a)},e.prototype.filterByYear=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=t[0],i.push(t[0])),t[1]&&(n=t[1],i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof et?o+","+n:o+"/"+n),o===n&&(r=o)}else t&&(r=t);var a={time:r};e.ol.updateParams(a)},e.prototype.reformatDateTime=function(e){var t=e.getFullYear(),r=e.getMonth()+1,o=e.getUTCDate(),n=e.getUTCHours(),i=e.getUTCMinutes();return Number(r)<10&&(r="0"+r),Number(o)<10&&(o="0"+o),Number(n)<10&&(n="0"+n),Number(i)<10&&(i="0"+i),t+"-"+r+"-"+o+"T"+n+":"+i+":00Z"},e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[]},e}(),Rr=function(){function e(){}return e.prototype.filterByOgc=function(e,t){var r=e.formatProcessedOgcFilter(t,e.options.params.layers),o=0<r.length?r.replace("filter=",""):undefined;e.ol.updateParams({filter:o})},e.prototype.setOgcWFSFiltersOptions=function(e){var t=e.options,r=new Ve;t.ogcFilters.enabled&&t.ogcFilters.filters&&(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry,!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry)))},e.prototype.setOgcWMSFiltersOptions=function(e){var t=e.options,r=new Ve;t.ogcFilters.enabled&&t.ogcFilters.filters?(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.fieldNameGeometry,!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.fieldNameGeometry)),this.filterByOgc(e,r.buildFilter(t.ogcFilters.filters)),t.filtered=!0):(t.ogcFilters.filters=undefined,t.ogcFilters.interfaceOgcFilters=[],t.filtered=!1)},e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[]},e}(),_r=function(){function e(e,t){this.messageService=e,this.languageService=t,this.ogcFilterWriter=new Ve}return e.prototype.open=function(e){var t=this.languageService.translate,r=t.instant("igo.geo.download.title");this.messageService.success(t.instant("igo.geo.download.start"),r);var o=e.dataSource.options;if(0<Object.keys(o.download).length)if(o.download.dynamicUrl&&o.download.url===undefined){var n=void 0,i=(n=e.dataSource.options.paramsWFS&&0<Object.keys(e.dataSource.options.paramsWFS).length?e.dataSource.options.paramsWFS:e.dataSource.options.params).outputFormatDownload===undefined?"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,a=o.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),s=this.ogcFilterWriter.buildFilter(e.dataSource.options.ogcFilters.filters,e.map.getExtent(),new _({code:e.map.projection}),n.fieldNameGeometry);window.open(a+"&"+s+"&"+i,"_blank")}else o.download&&window.open(o.download.url,"_blank")},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Ie.MessageService},{type:Ie.LanguageService}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(Ie.MessageService),Se.inject(Ie.LanguageService))},token:e,providedIn:"root"}),e}(),$r=function(){function e(e){this.downloadService=e,this._color="primary"}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),e.prototype.openDownload=function(e){this.downloadService.open(e)},Object.defineProperty(e.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-download-button",template:'<button\r\n  *ngIf="options && options.download && (options.download[\'dynamicUrl\'] || options.download[\'url\']) "\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.download.action\' | translate"\r\n  [color]="color"\r\n  (click)="openDownload(layer)">\r\n  <mat-icon svgIcon="download"></mat-icon>\r\n</button>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],e.ctorParameters=function(){return[{type:_r}]},e.propDecorators={layer:[{type:Se.Input}],color:[{type:Se.Input}]},e}(),Ar=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatIconModule,ye.MatButtonModule,ye.MatTooltipModule,Ie.IgoLanguageModule],exports:[$r],declarations:[$r]}]}],e}(),Gr=function(){function e(e,t,r){this.cdRef=e,this.sanitizer=t,this.mapService=r}return Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return ve.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return ve.getEntityIcon(this.feature)||"link"},enumerable:!0,configurable:!0}),e.prototype.htmlSanitizer=function(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)},e.prototype.isObject=function(e){return"object"==typeof e},e.prototype.isUrl=function(e){return"string"==typeof e&&("https://"===e.slice(0,8)||"http://"===e.slice(0,7))},e.prototype.filterFeatureProperties=function(r){var t=r.meta?r.meta.alias:undefined,o=Object.assign({},r.properties),n=r.meta.title,e=this.mapService.getMap().layers$.value;return t?(Object.keys(o).forEach(function(e){-1===Object.keys(t).indexOf(e)?delete o[e]:(o[t[e]]=o[e],t[e]!==e&&delete o[e])}),o):(e.forEach(function(t){if(t.dataSource.options.excludeAttribute)t.dataSource.options.excludeAttribute.forEach(function(e){n===t.title&&delete r.properties[e]});else if(t.dataSource.options.excludeAttributeOffline){t.dataSource.options.excludeAttributeOffline.forEach(function(e){n===t.title&&delete r.properties[e]})}}),r.properties)},e.decorators=[{type:Se.Component,args:[{selector:"igo-feature-details",template:'<table class="igo-striped" *ngIf="feature && isObject(feature.properties) && feature.properties.target !== \'iframe\'">\r\n  <tbody>\r\n    <tr *ngFor="let property of filterFeatureProperties(feature) | keyvalue">\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <a href="{{property.value}}" target=\'_blank\'> {{ \'igo.geo.targetHtmlUrl\' | translate }} {{title}}</a>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined">\r\n        {{property.key }}\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)" [innerHTML]=property.value>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)">\r\n        <a href="{{property.value}}" target=\'_blank\'>{{ \'igo.geo.targetHtmlUrl\' | translate }} </a>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && isObject(property.value)" [innerHTML]="property.value | json">\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n<iframe *ngIf="feature && isObject(feature.properties) && feature.properties.target === \'iframe\'" [src]=\'htmlSanitizer(feature.properties.url)\'></iframe>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:["table{width:100%;white-space:nowrap}table td{padding:5px}iframe{height:calc(100% - 4px);width:100%;border:0}"]}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef},{type:$.DomSanitizer},{type:It}]},e.propDecorators={feature:[{type:Se.Input}]},e}(),qr=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatIconModule,Ie.IgoLanguageModule,ve.IgoKeyValueModule],exports:[Gr],declarations:[Gr]}]}],e}(),Br=function(){function e(){this.feature$=new he.BehaviorSubject(undefined),this.submitForm=new Se.EventEmitter}return e.prototype.ngOnChanges=function(e){var t=e.store;t&&t.currentValue!==t.previousValue&&this.setStore(t.currentValue);var r=e.feature;r&&r.currentValue!==r.previousValue&&this.feature$.next(r.currentValue)},e.prototype.ngOnDestroy=function(){this.setStore(undefined)},e.prototype.onSubmit=function(e){var t=this.formDataToFeature(e);this.submitForm.emit(t)},e.prototype.formDataToFeature=function(e){var i={},t={};this.feature===undefined?t.id=Oe.uuid():(Object.assign(i,this.feature.properties),Object.assign(t,this.feature.meta,{revision:ve.getEntityRevision(this.feature)+1}));var a="properties.";Object.entries(e).forEach(function(e){var t=De(e,2),r=t[0],o=t[1];if(r.startsWith(a)){var n=r.substr(a.length);i[n]=o}});var r=e.geometry;return r===undefined&&this.feature!==undefined&&(r=this.feature.geometry),{meta:t,type:nt,geometry:r,projection:"EPSG:4326",properties:i}},e.prototype.setStore=function(e){this.store!==undefined&&this.activateStoreSelection(this.store),e!==undefined&&this.deactivateStoreSelection(e),this.store=e},e.prototype.deactivateStoreSelection=function(e){var t=e.getStrategyOfType(Dt);t!==undefined&&(t.deactivate(),t.unselectAll())},e.prototype.activateStoreSelection=function(e){e.activateStrategyOfType(Dt)},e.decorators=[{type:Se.Component,args:[{selector:"igo-feature-form",template:'\r\n<igo-form\r\n  [form]="form"\r\n  [formData]="feature$ | async"\r\n  (submitForm)="onSubmit($event)">\r\n\r\n  <ng-content></ng-content>\r\n  \r\n  <ng-content select="[formButtons]" formButtons></ng-content>\r\n  \r\n</igo-form>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}igo-form{height:100%}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={form:[{type:Se.Input}],feature:[{type:Se.Input}],store:[{type:Se.Input}],submitForm:[{type:Se.Output}]},e}(),Nr=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ve.IgoFormModule],exports:[ve.IgoFormModule,Br],declarations:[Br]}]}],e}(),Wr=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule],exports:[qr,Nr],declarations:[],providers:[]}]}],e}(),Vr=function(){function e(){this.listYears=[],this.startListYears=[],this.endListYears=[],this.playIcon="play_circle_filled",this.change=new Se.EventEmitter,this.yearChange=new Se.EventEmitter}return Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{set:function(e){if(e&&"year"!==this.type){var t=e.split("/");if(0<t.length){var r=new Date(t[0]),o=new Date(t[1]);isNaN(r.valueOf())||(this.startDate=r),isNaN(o.valueOf())||(this.endDate=o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this.options.type===undefined?"date":this.options.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRange",{get:function(){return this.options.range!==undefined&&"slider"!==this.options.style&&this.options.range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.options.style===undefined?"slider":this.options.style},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"step",{get:function(){var e=108e5;if(this.options.step===undefined)switch(this.type){case"date":case"datetime":e=108e5;break;case"time":e=36e5;break;case"year":e=31536e6;break;default:e=108e5}else e=this.getStepDefinition(this.options.step);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeInterval",{get:function(){return this.options.timeInterval===undefined?2e3:this.options.timeInterval},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this.options.min===undefined?undefined:new Date(this.options.min)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this.options.max===undefined?undefined:new Date(this.options.max)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is",{get:function(){return this.options.range!==undefined&&this.options.range},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){if(this.startDate===undefined){var e=new Date(this.min);this.startDate=new Date(e.getTime()+6e4*e.getTimezoneOffset())}if(this.endDate===undefined){var t=new Date(this.max);this.endDate=new Date(t.getTime()+6e4*t.getTimezoneOffset())}if(this.startYear===undefined&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),this.endYear===undefined&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(r=this.startYear;r<this.endYear;r++)this.startListYears.push(r);for(r=this.startYear+1;r<=this.endYear;r++)this.endListYears.push(r)}else for(var r=this.startYear;r<=this.endYear+1;r++)this.listYears.push(r)},e.prototype.handleDateChange=function(e){this.setupDateOutput(),this.applyTypeChange(),this.isRange?this.change.emit([this.startDate,this.endDate]):this.change.emit(this.startDate)},e.prototype.handleYearChange=function(e){if(this.isRange){this.endListYears=[];for(var t=this.startYear+1;t<=this.initEndYear;t++)this.endListYears.push(t);this.startListYears=[];for(t=this.initStartYear+1;t<this.endYear;t++)this.startListYears.push(t);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)},e.prototype.handleListYearChange=function(e){this.handleYearChange([this.startYear,this.endYear])},e.prototype.handleListYearStartChange=function(e){this.change.emit([this.startDate,this.endDate])},e.prototype.dateToNumber=function(e){return(e?new Date(e):new Date(this.min)).getTime()},e.prototype.setSliderThumbLabel=function(e){var t=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);t&&(t.textContent=e)},e.prototype.findThumbLabel=function(e){var t,r=this;return e.forEach(function(e){"mat-slider-thumb-label-text"===e.className&&(t=e),0<e.children.length&&!t&&(t=r.findThumbLabel(e.childNodes))},this),t},e.prototype.playFilter=function(e){this.interval?this.stopFilter():(this.playIcon="pause_circle_filled",this.interval=setInterval(function(e){var t,r=new Date(e.max);t=e.date===undefined?e.min.getTime():e.date.getTime(),t+=e.mySlider.step,e.date=new Date(t),t>r.getTime()&&e.stopFilter(),e.handleDateChange({value:e.date,date:e.date})},this.timeInterval,this))},e.prototype.stopFilter=function(){this.interval&&clearInterval(this.interval),this.interval=undefined,this.playIcon="play_circle_filled"},e.prototype.handleSliderDateChange=function(e){this.date=new Date(e.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(e)},e.prototype.handleSliderValue=function(){if(!0===this.options.current||!this.min){var e=new Date;this.date=this.getRoundedDate(e)}return this.date===undefined?this.min.getTime():this.date.getTime()},e.prototype.handleSliderTooltip=function(){var e;switch(this.type){case"date":e=this.date===undefined?this.min.toDateString():this.date.toDateString();break;case"time":e=this.date===undefined?this.min.toTimeString():this.date.toTimeString();break;default:e=this.date===undefined?this.min.toUTCString():this.date.toUTCString()}return e},e.prototype.setupDateOutput=function(){"slider"===this.style?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=this.startDate===undefined?new Date(this.min):this.startDate,this.endDate=this.endDate===undefined?new Date(this.max):this.endDate)},e.prototype.applyTypeChange=function(){switch(this.type){case"date":this.startDate===undefined&&this.endDate===undefined||(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case"time":if("calendar"===this.style){if(this.startDate.getDay()!==this.min.getDay()){var e=this.startDate.getHours(),t=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(e),this.startDate.setMinutes(t)}if(this.endDate.getDay()!==this.min.getDay()){e=this.endDate.getHours(),t=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(e),this.endDate.setMinutes(t)}}!this.isRange&&36e5<this.step&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}},e.prototype.getRangeMinDate=function(){return this.startDate===undefined?this.min:this.startDate},e.prototype.getRangeMaxDate=function(){return this.endDate===undefined?this.max:this.endDate},e.prototype.getRoundedDate=function(e,t){void 0===t&&(t=10);var r=6e4*t;return new Date(Math.round(e.getTime()/r)*r)},e.prototype.getStepDefinition=function(e){return A.duration(e).asMilliseconds()},e.decorators=[{type:Se.Component,args:[{selector:"igo-time-filter-form",template:'\x3c!-- <div *ngIf="style === \'calendar\' && type !==\'year\'">\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n    <mat-form-field>\r\n      <mat-datetimepicker-toggle [for]="datetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n      <mat-datetimepicker #datetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n      <input matInput autocomplete="false"\r\n        placeholder="{{\'igo.geo.timeFilter.date\' | translate}}"\r\n        [matDatetimepicker]="datetimePicker"\r\n        [(ngModel)]="date"\r\n        [min]="min"\r\n        [max]="max"\r\n        readonly="readonly"\r\n        (dateChange)="handleDateChange($event)">\r\n    </mat-form-field>\r\n\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="minDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #minDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}"\r\n          [matDatetimepicker]="minDatetimePicker"\r\n          [(ngModel)]="startDate"\r\n          [min]="min"\r\n          [max]="getRangeMaxDate()"\r\n          readonly="readonly"\r\n          (input)="startDate"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="maxDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #maxDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}"\r\n          [matDatetimepicker]="maxDatetimePicker"\r\n          [(ngModel)]="endDate"\r\n          [min]="getRangeMinDate()"\r\n          [max]="max"\r\n          readonly="readonly"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div *ngIf="style === \'calendar\' && type ===\'year\'">\r\n\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.date\' | translate}}" [(ngModel)]="year" (selectionChange)="handleYearChange($event)">\r\n                  <mat-option [value]="year" *ngFor="let year of listYears">{{year}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}" [(ngModel)]="startYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="startYear" *ngFor="let startYear of startListYears">{{startYear}}</mat-option>\r\n            </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n    <mat-form-field>\r\n        <mat-select placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}" [(ngModel)]="endYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="endYear" *ngFor="let endYear of endListYears">{{endYear}}</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n  <br>\r\n\r\n\r\n<div *ngIf="style === \'slider\'" class="igo-col igo-col-100 igo-col-100-m">\r\n  <mat-slider\r\n      id="time-slider"\r\n      tickInterval="auto"\r\n      step="{{step}}"\r\n      [min]="dateToNumber(min)"\r\n      [max]="dateToNumber(max)"\r\n      [value]="handleSliderValue()"\r\n      thumbLabel\r\n      (input)="handleSliderDateChange($event)"\r\n      (selectionChange)="handleSliderDateChange($event)">\r\n  </mat-slider>\r\n  <p class="date-below">{{handleSliderTooltip()}}</p>\r\n  <button mat-icon-button color="primary" (click)="playFilter($event)">\r\n   <mat-icon svgIcon="{{playIcon}}"></mat-icon>\r\n  </button>\r\n</div> --\x3e\r\n',styles:[".igo-layer-filters-container{padding-left:5px}mat-slider>>>div.mat-slider-thumb-label{width:32px;height:32px;margin:0 auto}mat-slider>>>span.mat-slider-thumb-label-text{font-size:8px}#time-slider{width:70%;margin:0 auto}@media only screen and (max-width:450px),only screen and (max-height:450px){#time-slider{width:60%;margin:0 auto}}#playFilterIcon{font-size:32px;cursor:pointer}.date-below{margin:0}mat-form-field{text-align:center}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={options:[{type:Se.Input}],currentValue:[{type:Se.Input}],change:[{type:Se.Output}],yearChange:[{type:Se.Output}],mySlider:[{type:Se.ViewChild,args:[ye.MatSlider]}]},e}(),Ur=function(){function e(e){this.timeFilterService=e}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),e.prototype.handleYearChange=function(e){this.timeFilterService.filterByYear(this.datasource,e)},e.prototype.handleDateChange=function(e){this.timeFilterService.filterByDate(this.datasource,e)},e.decorators=[{type:Se.Component,args:[{selector:"igo-time-filter-item",template:'<mat-list-item>\r\n  <mat-icon\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]="filters"\r\n    [collapsed]="false"\r\n    svgIcon="chevron-up" >\r\n  </mat-icon>\r\n  <h4 matLine>{{layer.title}}</h4>\r\n</mat-list-item>\r\n\r\n<div #filters class="igo-datasource-filters-container">\r\n  <igo-time-filter-form\r\n    [options]="datasource.options.timeFilter"\r\n    [currentValue]="datasource.options.params.time"\r\n    (change)="handleDateChange($event)"\r\n    (yearChange)="handleYearChange($event)">\r\n  </igo-time-filter-form>\r\n</div>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}"]}]}],e.ctorParameters=function(){return[{type:Er}]},e.propDecorators={layer:[{type:Se.Input}]},e}(),zr=function(){function e(e){this.cdRef=e,this._layers=[]}return Object.defineProperty(e.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-time-filter-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'time\'">\r\n    <igo-time-filter-item igoListItem [layer]="layer"></igo-time-filter-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},e.propDecorators={layers:[{type:Se.Input}]},e}(),Kr=function(){function e(e,t){this.mapService=t,this.component=e}return e.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},e.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},e.decorators=[{type:Se.Directive,args:[{selector:"[igoTimeFilterListBinding]"}]}],e.ctorParameters=function(){return[{type:zr,decorators:[{type:Se.Self}]},{type:It}]},e}(),Hr=function(){function e(){}return e.prototype.wktToFeature=function(e,t,r){return void 0===r&&(r="EPSG:3857"),(new G).readFeature(e,{dataProjection:t,featureProjection:r})},e.prototype.extentToWkt=function(e,t,r){var o=se.transformExtent(t,r,e);return o=this.roundCoordinateArray(o,e,0),{wktPoly:"POLYGON((\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+"))",wktLine:"LINESTRING(\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+")",wktMultiPoints:"MULTIPOINT(\n        "+t[0]+" "+t[1]+",\n        "+t[0]+" "+t[3]+",\n        "+t[2]+" "+t[3]+",\n        "+t[2]+" "+t[1]+")"}},e.prototype.roundCoordinateArray=function(e,t,r){void 0===r&&(r=0);var o=se.get(t).getUnits();return-1!==["ft","m","us-ft"].indexOf(o)&&(e=this.roundArray(e,r)),e},e.prototype.roundArray=function(e,t){void 0===t&&(t=0);for(var r=0;r<e.length;)e[r]=e[r].toFixed(t),r++;return e},e.prototype.snrcToWkt=function(e,t){void 0===t&&(t="EPSG:3857"),e=e.toLowerCase();var r=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],o=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]],n=!1,i=!1,a=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(e)?a=!0:/\d{2,3}[a-p]/gi.test(e)?i=!0:/\d{2,3}/gi.test(e)&&(n=!0),n?e+="a01":i&&(e+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(e)){var s=e.split(/(?=[a-p])/gi),l=s[0],u=s[1][0],c=s[1].split(u)[1],p=1;3===l.length&&(p=2);var d=l.substring(0,p),f=l.substring(p),h=0,g=0,y=0,m=0;r.forEach(function(e){-1!==e.indexOf(u)&&(g=r.indexOf(e),h=e.indexOf(u))}),o.forEach(function(e){-1!==e.indexOf(c)&&(m=o.indexOf(e),y=e.indexOf(c))});var v=0,b=0,S=0,w=0,F=8,O=4;i?(v=2*h,b=1*g,w=S=0,F=2,O=1):a&&(v=2*h,b=1*g,S=.5*y,w=.25*m,F=.5,O=.25);var I={ul:[{1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}}[d].to+v+S,{1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}}[f].to-b-w]};return I.lr=[I.ul[0]+F,I.ul[1]-O],I.ur=[I.ul[0],I.ul[1]-O],I.ll=[I.ul[0]+F,I.ul[1]],I.ul=se.transform([I.ul[0],I.ul[1]],"EPSG:4326",t),I.lr=se.transform([I.lr[0],I.lr[1]],"EPSG:4326",t),I.ur=se.transform([I.ur[0],I.ur[1]],"EPSG:4326",t),I.ll=se.transform([I.ll[0],I.ll[1]],"EPSG:4326",t),I.ul=this.roundCoordinateArray(I.ul,t,0),I.lr=this.roundCoordinateArray(I.lr,t,0),I.ur=this.roundCoordinateArray(I.ur,t,0),I.ll=this.roundCoordinateArray(I.ll,t,0),{wktPoly:"POLYGON(("+[I.ul.join(" "),I.ur.join(" "),I.lr.join(" "),I.ll.join(" "),I.ul.join(" ")].join(",")+"))",wktLine:"LINESTRING("+[I.ul.join(" "),I.ur.join(" "),I.lr.join(" "),I.ll.join(" "),I.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[I.ul.join(" "),I.ur.join(" "),I.lr.join(" "),I.ll.join(" ")].join(",")+")"}}},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Qr=function(){function e(e,t){this.cdRef=e,this.wktService=t,this._currentFilter={},this.value="",this.color="primary",this.snrc="",this.baseOverlayName="ogcFilterOverlay_",this.ogcFilterWriter=new Ve,this.operators=this.ogcFilterWriter.operators,this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}return Object.defineProperty(e.prototype,"datasource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showFeatureOnMap",{get:function(){return this._showFeatureOnMap},set:function(e){this._showFeatureOnMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFilter",{get:function(){return this._currentFilter},set:function(e){this._currentFilter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeFilters",{get:function(){return this.updateField(),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return!0===e.active})},enumerable:!0,configurable:!0}),e.prototype.ngAfterContentChecked=function(){var t=this;this.map&&this.activeFilters.filter(function(e){return-1!==["Contains","Intersects","Within"].indexOf(e.operator)}).forEach(function(e){e.wkt_geometry&&t.addWktAsOverlay(e.wkt_geometry,e.filterid,t.map.projection)})},e.prototype.updateField=function(e){var t=this;void 0===e&&(e=!0),this.datasource.options.sourceFields&&(this.fields=this.datasource.options.sourceFields.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),this.datasource.options.sourceFields.filter(function(e){return e.name===t.currentFilter.propertyName}).forEach(function(e){t.values=e.values!==undefined?e.values.sort():[]}))},e.prototype.addWktAsOverlay=function(e,t,r){var o=this.wktService.wktToFeature(e,r);o.setId(this.baseOverlayName+t);var n=0;this.showFeatureOnMap&&(n=.5);var i=new le.Stroke({width:2,color:[125,136,140,n]});return new le.Style({stroke:i,image:new le.Circle({radius:5,stroke:i})})},e.prototype.toggleFilterState=function(e,t,r){this.updateField();var o=this.map.projection;e.checked?(""!==t.wkt_geometry&&this.addWktAsOverlay(t.wkt_geometry,t.filterid,o),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!0})):(this.removeOverlayByID(t.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!1})),this.refreshFilters()},e.prototype.deleteFilter=function(t){var e=this.datasource.options.ogcFilters;e.interfaceOgcFilters=e.interfaceOgcFilters.filter(function(e){return e.filterid!==t.filterid}),this.removeOverlayByID(t.filterid),this.refreshFilters()},e.prototype.changeNumericProperty=function(e,t,r){this.changeProperty(e,t,parseFloat(r)),this.refreshFilters()},e.prototype.removeOverlayByID=function(e){var t=this.baseOverlayName+e;this.map.overlay.dataSource.ol.getFeatureById(t)&&this.map.overlay.dataSource.ol.removeFeature(this.map.overlay.dataSource.ol.getFeatureById(t))},e.prototype.changeOperator=function(e){!1===this.operators[e.operator].spatial&&this.removeOverlayByID(e.filterid),this.refreshFilters()},e.prototype.changeProperty=function(t,r,o){this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=o}),this.refreshFilters()},e.prototype.changeGeometry=function(r,o){var n=this,i=/\d{2,3}[a-l][0,1][0-9]/gi,a=/\d{2,3}[a-p]/gi,s=/\d{2,3}/gi,l=this.map.projection;this.removeOverlayByID(r.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===r.filterid}).forEach(function(e){var t;"snrc"===r.igoSpatialSelector?""===o&&""!==n.snrc?(t=n.wktService.snrcToWkt(n.snrc).wktPoly,e.wkt_geometry=t):""!==o&&(s.test(o)||a.test(o)||i.test(o))&&(t=n.wktService.snrcToWkt(o).wktPoly,e.wkt_geometry=t):"fixedExtent"===r.igoSpatialSelector&&(t=n.wktService.extentToWkt(l,n.map.getExtent(),l).wktPoly,e.wkt_geometry=t),t&&n.addWktAsOverlay(t,r.filterid,l)}),this.refreshFilters()},e.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter-form",template:'<mat-list-item>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m">\r\n    <mat-select class="logical" [disabled]="!currentFilter.active" (selectionChange)="refreshFilters()" [(ngModel)]="currentFilter.parentLogical"\r\n      *ngIf="activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true">\r\n      <mat-option value="And">{{\'igo.geo.operators.And\' | translate}}</mat-option>\r\n      <mat-option value="Or">{{\'igo.geo.operators.Or\' | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <span *ngIf="fields && fields.length > 0 && fields[0].name !== \'\'">\r\n      <mat-select [disabled]="!currentFilter.active" *ngIf="[\'Contains\',\'Intersects\',\'Within\'].indexOf(currentFilter.operator) === -1"\r\n        [(ngModel)]="currentFilter.propertyName" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.sourceFields.selectField\' | translate"\r\n        (selectionChange)="updateField(false)">\r\n        <mat-option *ngFor="let field of fields" [value]="field.name">{{field.alias}}</mat-option>\r\n      </mat-select>\r\n    </span>\r\n    <span *ngIf="fields && fields.length === 1 && fields[0].name === \'\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput #fieldPerUser (keyup)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)"\r\n          (blur)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)" [(ngModel)]="currentFilter.propertyName">\r\n\r\n        <button mat-button *ngIf="currentFilter.propertyName" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.propertyName=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of operators | keyvalue" [value]="operator.key">{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n\r\n    \x3c!-- PropertyIsEqualTo --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsEqualTo\' || currentFilter.operator === \'PropertyIsNotEqualTo\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionequalto (keyup)="changeProperty(currentFilter,\'expression\',expressionequalto.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'expression\',expressionequalto.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsEqualTo  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsLike\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #pattern (keyup)="changeProperty(currentFilter,\'pattern\',pattern.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'pattern\',pattern.value)" [ngModel]="currentFilter.pattern">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.pattern" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.pattern=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsNull\'"></span>\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsGreaterThan\' || currentFilter.operator === \'PropertyIsGreaterThanOrEqualTo\' || currentFilter.operator === \'PropertyIsLessThan\' || currentFilter.operator === \'PropertyIsLessThanOrEqualTo\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionthan type="number" (keyup)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n    </span>\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsBetween --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsBetween\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #lowerBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)" [ngModel]="currentFilter.lowerBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.lowerBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.lowerBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #upperBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)" [ngModel]="currentFilter.upperBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.upperBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.upperBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsBetween  --\x3e\r\n\r\n\r\n    \x3c!-- During --\x3e\r\n    <span *ngIf="currentFilter.operator === \'During\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #begin (keyup)="changeProperty(currentFilter,\'begin\',begin.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'begin\',begin.value)" [ngModel]="currentFilter.begin">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values " [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.begin" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.begin=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #end (keyup)="changeProperty(currentFilter,\'end\',end.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'end\',end.value)" [ngModel]="currentFilter.end">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.end" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.end=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n\r\n    </span>\r\n    \x3c!-- During  --\x3e\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n\r\n\r\n  \x3c!-- PropertySpatial  --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of operators | keyvalue" [value]="operator.key">{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.igoSpatialSelector" (selectionChange)="changeGeometry(currentFilter,value)">\r\n      <mat-option *ngFor="let igoSpatialSelector of igoSpatialSelectors" [value]="igoSpatialSelector.type">{{(\'igo.geo.spatialSelector.\'+ igoSpatialSelector.type) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <button mat-button [disabled]="!currentFilter.active" *ngIf="currentFilter.igoSpatialSelector === \'fixedExtent\'"\r\n      matSuffix mat-icon-button aria-label="Clear" (click)="changeGeometry(currentFilter,value)" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.spatialSelector.btnSetExtent\' | translate">\r\n      <mat-icon svgIcon="zoom-out_map"></mat-icon>\r\n    </button>\r\n\r\n\r\n    <mat-form-field *ngIf="currentFilter.igoSpatialSelector === \'snrc\'">\r\n      <input matInput #htmlSnrc (keyup)="changeGeometry(currentFilter,htmlSnrc.value)" (blur)="changeGeometry(currentFilter,htmlSnrc.value)"\r\n        [(ngModel)]="snrc">\r\n      <button mat-button *ngIf="snrc" matSuffix mat-icon-button aria-label="Clear" (click)="snrc=\'\'">\r\n        <mat-icon svgIcon="close"></mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n  </div>\r\n  \x3c!-- PropertySpatial  --\x3e\r\n\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <div class="igo-layer-button-group">\r\n      <mat-slide-toggle class="example-margin" (change)="toggleFilterState($event,currentFilter,\'active\')" tooltip-position="below"\r\n        matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.toggleFilterState\' | translate" [color]="color" [checked]="currentFilter.active"\r\n        [disabled]="disabled">\r\n      </mat-slide-toggle>\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.removeFilter\' | translate"\r\n        color="warn" (click)="deleteFilter(currentFilter)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <mat-divider></mat-divider>\r\n</mat-list-item>\r\n',styles:[":host{overflow:hidden}.mat-list-item{height:auto}.mat-list-item>>>div.mat-list-item-content{display:inline-table}.logical{font-weight:700}input,mat-select{margin-top:10px;text-align:center}.igo-layer-actions-container{width:100%;display:inline-block}.igo-layer-actions-container>div{text-align:center}.igo-layer-button-group{float:center;padding:0 3px}@media only screen and (max-width:450px),only screen and (max-height:450px){.igo-layer-button-group{float:none}}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef},{type:Hr}]},e.propDecorators={refreshFilters:[{type:Se.Input}],datasource:[{type:Se.Input}],showFeatureOnMap:[{type:Se.Input}],map:[{type:Se.Input}],currentFilter:[{type:Se.Input}]},e}(),Yr=function(){function e(){this.color="primary"}return Object.defineProperty(e.prototype,"datasource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshFunc",{get:function(){return this.refreshFilters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showFeatureOnMap",{get:function(){return this._showFeatureOnMap},set:function(e){this._showFeatureOnMap=e},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filterable-form",template:'<igo-list [navigation]="false" [selection]="true">\r\n  <ng-template ngFor let-currentFilter [ngForOf]="this.datasource.options.ogcFilters.interfaceOgcFilters">\r\n    <igo-ogc-filter-form igoListItem [color]="color" [currentFilter]="currentFilter" [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc" [showFeatureOnMap]="showFeatureOnMap">\r\n    </igo-ogc-filter-form>\r\n  </ng-template>\r\n</igo-list>\r\n'}]}],e.ctorParameters=function(){return[]},e.propDecorators={datasource:[{type:Se.Input}],map:[{type:Se.Input}],refreshFilters:[{type:Se.Input}],showFeatureOnMap:[{type:Se.Input}]},e}(),Zr=function(){function e(e,t){this.ogcFilterService=e,this.downloadService=t,this.color="primary",this.defaultLogicalParent="And",this.hasActiveSpatialFilter=!1,this.filtersAreEditable=!0,this.filtersCollapsed=!0,this._showFeatureOnMap=!1}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshFunc",{get:function(){return this.refreshFilters.bind(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showFeatureOnMap",{get:function(){return this._showFeatureOnMap},set:function(e){this._showFeatureOnMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ogcFiltersHeaderShown",{get:function(){return this._ogcFiltersHeaderShown},set:function(e){this._ogcFiltersHeaderShown=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){switch(this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}this.datasource.options.ogcFilters&&(this.datasource.options.ogcFilters.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(this.datasource.options.ogcFilters.interfaceOgcFilters)),1<=this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.wkt_geometry}).length&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!this.datasource.options.ogcFilters.editable&&this.datasource.options.ogcFilters.editable)},e.prototype.getOverlayByID=function(e){this.map.overlay.dataSource.ol.getFeatureById(e)},e.prototype.toggleShowFeatureOnMap=function(){var l=this;this.showFeatureOnMap=!this.showFeatureOnMap,this.datasource.options.ogcFilters.interfaceOgcFilters.forEach(function(e){var t,r=[125,136,140,0],o=2,n=[125,136,140,0];t=l.getOverlayByID("ogcFilterOverlay_"+e.filterid),!1!==l.showFeatureOnMap&&(r=[125,136,140,.5],o=2,n=[125,136,140,0]);var i=new le.Stroke({width:o,color:r}),a=new le.Stroke({color:n}),s=new le.Style({stroke:i,fill:a,image:new le.Circle({radius:5,stroke:i,fill:a})});t&&t.setStyle(s)})},e.prototype.addFilterToSequence=function(){this.filtersCollapsed=!1;var e,t=this.datasource.options.ogcFilters.interfaceOgcFilters||[],r=0===t.length?0:t[t.length-1].level,o="";0<this.datasource.options.sourceFields.length&&(o=this.datasource.options.sourceFields[0].name===undefined?"":this.datasource.options.sourceFields[0].name);var n=this.datasource.options;n.fieldNameGeometry?e=n.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(e=this.datasource.options.paramsWFS.fieldNameGeometry);var i=0===t.length;t.push(this.datasource.ogcFilterWriter.addInterfaceFilter({propertyName:o,operator:"PropertyIsEqualTo",active:i,igoSpatialSelector:"fixedExtent"},e,r,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=t},e.prototype.openDownload=function(){this.downloadService.open(this.layer)},e.prototype.refreshFilters=function(){var e=this.datasource.options.ogcFilters,t=e.interfaceOgcFilters.filter(function(e){return!0===e.active});if(0===t.length&&(e.filters=undefined,e.filtered=!1),1<t.length&&(t[0].parentLogical=t[1].parentLogical),0===t.filter(function(e){return-1!==["Contains","Intersects","Within"].indexOf(e.operator)}).length?this.hasActiveSpatialFilter=!1:this.hasActiveSpatialFilter=!0,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(t)){if("wfs"===this.layer.dataSource.options.type){var r=(i=this.layer.dataSource).options.ogcFilters,o=i.ogcFilterWriter;r.filters=o.rebuiltIgoOgcFilterObjectFromSequence(t),this.layer.dataSource.ol.clear()}else if("wms"===this.layer.dataSource.options.type&&e.enabled){var n="";if(1<=t.length){var i;r=(i=this.layer.dataSource).options.ogcFilters,o=i.ogcFilterWriter;r.filters=o.rebuiltIgoOgcFilterObjectFromSequence(t),n=this.layer.dataSource.ogcFilterWriter.buildFilter(r.filters,undefined,undefined,this.layer.dataSource.options.fieldNameGeometry)}this.ogcFilterService.filterByOgc(this.datasource,n),this.datasource.options.ogcFilters.filtered=0!==t.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(t))}},Object.defineProperty(e.prototype,"downloadable",{get:function(){return this.datasource.options.download},enumerable:!0,configurable:!0}),e.prototype.setVisible=function(){this.layer.visible=!0},e.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filterable-item",template:'<span *ngIf="filtersAreEditable">\r\n<mat-list-item>\r\n\r\n  <mat-icon *ngIf="ogcFiltersHeaderShown" class="igo-chevron" mat-list-avatar igoCollapse [target]="ogcFilters" [collapsed]="filtersCollapsed" svgIcon="chevron-up">\r\n  </mat-icon>\r\n  <h4 *ngIf="ogcFiltersHeaderShown" matLine [matTooltip]="layer.title" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n  <h4 *ngIf="!ogcFiltersHeaderShown" matLine></h4>\r\n\r\n  <button mat-icon-button *ngIf="hasActiveSpatialFilter && showFeatureOnMap" tooltip-position="below" matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.hideFeatureExtent\' | translate"\r\n  [disabled]="!layer.visible || !layer.isInResolutionsRange"\r\n  [color]="color"\r\n  (click)="toggleShowFeatureOnMap()">\r\n  <mat-icon svgIcon="border-outer"></mat-icon>\r\n  </button>\r\n\r\n  <button mat-icon-button *ngIf="hasActiveSpatialFilter && !showFeatureOnMap" tooltip-position="below" matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.showFeatureExtent\' | translate"\r\n  [disabled]="!layer.visible || !layer.isInResolutionsRange"\r\n  [color]="color"\r\n  (click)="toggleShowFeatureOnMap()">\r\n    <mat-icon svgIcon="border-none"></mat-icon>\r\n  </button>\r\n\r\n  <span *ngIf="downloadable && ogcFiltersHeaderShown">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.download.action\' | translate"\r\n      [color]="color" (click)="openDownload()">\r\n      <mat-icon svgIcon="download"></mat-icon>\r\n    </button>\r\n  </span>\r\n  <button [disabled]="!datasource.options.sourceFields ||datasource.options.sourceFields.length === 0" mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.filter.addFilter\' | translate" [color]="color" (click)="addFilterToSequence()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<button *ngIf="!layer.visible && ogcFiltersHeaderShown" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.layer.showLayer\' | translate"\r\ncolor="warn" (click)="setVisible()">\r\n<mat-icon svgIcon="error-outline"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilters class="igo-datasource-filters-container">\r\n  <igo-ogc-filterable-form [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc" [showFeatureOnMap]="showFeatureOnMap">\r\n  </igo-ogc-filterable-form>\r\n</div>\r\n</span>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],e.ctorParameters=function(){return[{type:Rr},{type:_r}]},e.propDecorators={layer:[{type:Se.Input}],map:[{type:Se.Input}],showFeatureOnMap:[{type:Se.Input}],ogcFiltersHeaderShown:[{type:Se.Input}]},e}(),Jr=function(){function e(e){this.cdRef=e,this._layers=[]}return Object.defineProperty(e.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filterable-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'ogc\'">\r\n    <igo-ogc-filterable-item igoListItem [ogcFiltersHeaderShown]="true" [layer]="layer" \r\n    [map]="layer.map" ></igo-ogc-filterable-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},e.propDecorators={layers:[{type:Se.Input}],map:[{type:Se.Input}]},e}(),Xr=function(){function e(e,t){this.mapService=t,this.component=e}return e.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},e.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},e.decorators=[{type:Se.Directive,args:[{selector:"[igoOgcFilterableListBinding]"}]}],e.ctorParameters=function(){return[{type:Jr,decorators:[{type:Se.Self}]},{type:It}]},e}(),eo=function(){function e(){this._color="primary",this.ogcFilterCollapse=!1,this._ogcFiltersInLayers=!1}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ogcFiltersInLayers",{get:function(){return this._ogcFiltersInLayers},set:function(e){this._ogcFiltersInLayers=e},enumerable:!0,configurable:!0}),e.prototype.toggleOgcFilter=function(){this.layer.isInResolutionsRange&&(this.ogcFilterCollapse=!this.ogcFilterCollapse)},Object.defineProperty(e.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter-button",template:'<button *ngIf="ogcFiltersInLayers && options.ogcFilters && (options.ogcFilters.enabled\r\n&& options.ogcFilters.editable)"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.filterBy\' | translate"\r\n  [color]="color"\r\n  (click)="toggleOgcFilter()">\r\n  <mat-icon\r\n    [ngClass]=\'{disabled: !layer.isInResolutionsRange}\'>\r\n    filter_list\r\n  </mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class="igo-layer-actions-container"\r\n*ngIf="options.ogcFilters && (options.ogcFilters.enabled\r\n&& options.ogcFilters.editable)">\r\n  <igo-ogc-filterable-item\r\n    *ngIf="ogcFilterCollapse && options.ogcFilters.enabled"\r\n    igoListItem\r\n    [ogcFiltersHeaderShown]="false"\r\n    [map]="layer.map"\r\n    [layer]="layer">\r\n  </igo-ogc-filterable-item>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],e.ctorParameters=function(){return[]},e.propDecorators={layer:[{type:Se.Input}],map:[{type:Se.Input}],color:[{type:Se.Input}],ogcFiltersInLayers:[{type:Se.Input}]},e}(),to=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[{provide:ye.MAT_DATE_LOCALE,useValue:"fr"}]}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,fe.FormsModule,fe.ReactiveFormsModule,ye.MatAutocompleteModule,ye.MatIconModule,ye.MatButtonModule,ye.MatSliderModule,ye.MatSlideToggleModule,ye.MatFormFieldModule,ye.MatInputModule,ye.MatOptionModule,ye.MatSelectModule,ye.MatListModule,ye.MatTooltipModule,ye.MatDatepickerModule,ye.MatNativeDateModule,Ie.IgoLanguageModule,ve.IgoCollapsibleModule,ve.IgoListModule,ve.IgoKeyValueModule],exports:[kr,Vr,Ur,zr,Kr,Qr,eo,Yr,Zr,Jr,Xr],declarations:[kr,Vr,Ur,zr,Kr,Qr,eo,Yr,Zr,Jr,Xr],providers:[Er,Rr]}]}],e}(),ro=function(){function e(e){this.cdRef=e,this.geometryType$=new he.BehaviorSubject(undefined),this.drawGuide$=new he.BehaviorSubject(0),this.value$=new he.BehaviorSubject(undefined),this.geometryTypeField=!1,this.geometryTypes=["Point","LineString","Polygon"],this.drawGuideField=!1,this.drawGuide=0,this.drawGuidePlaceholder="",this.measure=!1}return Object.defineProperty(e.prototype,"geometryTypeModel",{get:function(){return this.geometryType$.value},set:function(e){this.geometryType$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawGuideModel",{get:function(){return this.drawGuide$.value},set:function(e){this.drawGuide$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.geometryType$.next(this.geometryType),this.drawGuide$.next(this.drawGuide),this.value$.next(this.formControl.value?this.formControl.value:undefined),this.value$$=this.formControl.valueChanges.subscribe(function(e){t.value$.next(e||undefined)})},e.prototype.ngOnDestroy=function(){this.value$$.unsubscribe()},e.prototype.onGeometryTypeChange=function(e){this.value$.value===undefined&&this.geometryType$.next(e)},e.prototype.onDrawGuideChange=function(e){this.drawGuide$.next(e)},e.decorators=[{type:Se.Component,args:[{selector:"igo-geometry-form-field",template:'<igo-geometry-form-field-input\r\n  [formControl]="formControl"\r\n  [map]="map"\r\n  [geometryType]="geometryType$ | async"\r\n  [drawGuide]="drawGuide$ | async"\r\n  [measure]="measure">\r\n</igo-geometry-form-field-input>\r\n\r\n<div *ngIf="geometryTypeField" class="geometry-type-toggle">\r\n  <mat-button-toggle-group\r\n    [disabled]="(value$ | async) !== undefined"\r\n    [ngModel]="geometryTypeModel"\r\n    (ngModelChange)="onGeometryTypeChange($event)">\r\n    <mat-button-toggle\r\n      value="Point"\r\n      [disabled]="geometryTypes.indexOf(\'Point\') < 0">\r\n      {{\'igo.geo.geometry.point\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="LineString"\r\n      [disabled]="geometryTypes.indexOf(\'LineString\') < 0">\r\n      {{\'igo.geo.geometry.line\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="Polygon"\r\n      [disabled]="geometryTypes.indexOf(\'Polygon\') < 0">\r\n      {{\'igo.geo.geometry.polygon\' | translate}}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<mat-form-field *ngIf="drawGuideField" class="draw-guide-field">\r\n  <input\r\n    matInput\r\n    type="number"\r\n    [placeholder]="drawGuidePlaceholder"\r\n    [ngModel]="drawGuideModel"\r\n    (ngModelChange)="onDrawGuideChange($event)">\r\n  <mat-icon\r\n    matPrefix\r\n    [color]="\'primary\'"\r\n    svgIcon="adjust">    \r\n  </mat-icon>\r\n  <span matSuffix class="draw-guide-units">{{\'igo.geo.measure.meters\' | translate}}</span>\r\n</mat-form-field>',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;width:100%}.draw-guide-field,.geometry-type-toggle{width:100%}.geometry-type-toggle{padding:10px;text-align:center}.draw-guide-field mat-icon{margin:0 10px}.draw-guide-units{padding:10px}"]}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},e.propDecorators={formControl:[{type:Se.Input}],map:[{type:Se.Input}],geometryType:[{type:Se.Input}],geometryTypeField:[{type:Se.Input}],geometryTypes:[{type:Se.Input}],drawGuideField:[{type:Se.Input}],drawGuide:[{type:Se.Input}],drawGuidePlaceholder:[{type:Se.Input}],measure:[{type:Se.Input}]},e=Te([ve.FormFieldComponent("geometry"),Le("design:paramtypes",[Se.ChangeDetectorRef])],e)}(),oo={Length:"length",Area:"area"},no={Meters:"meters",Kilometers:"kilometers",Miles:"miles",Feet:"feet"},io=((ur={})[no.Meters]="m",ur[no.Kilometers]="km",ur[no.Miles]="mi",ur[no.Feet]="ft",ur),ao={SquareMeters:"squareMeters",SquareKilometers:"squareKilometers",SquareMiles:"squareMiles",SquareFeet:"squareFeet",Hectares:"hectares",Acres:"acres"},so=((cr={})[ao.SquareMeters]="m",cr[ao.SquareKilometers]="km",cr[ao.SquareMiles]="mi",cr[ao.SquareFeet]="ft",cr[ao.Hectares]="ha",cr[ao.Acres]="ac",cr);function lo(e){return.001*e}function uo(e){return 3.2808*e}function co(e){return 621e-6*e}function po(e){return 1e-6*e}function fo(e){return 3.861e-7*e}function ho(e){return 10.764*e}function go(e){return 1e-4*e}function yo(e){return 24711e-8*e}function mo(e,t){var r=new Map([[no.Meters,function(e){return e}],[no.Kilometers,lo],[no.Miles,co],[no.Feet,uo]]).get(t);return r?r(e):undefined}function vo(e,t){var r=new Map([[ao.SquareMeters,function(e){return e}],[ao.SquareKilometers,po],[ao.SquareMiles,fo],[ao.SquareFeet,ho],[ao.Hectares,go],[ao.Acres,yo]]).get(t);return r?r(e):undefined}function bo(e,t){var r=t.decimal;(r===undefined||r<0)&&(r=1);var o=[];return t.locale!==undefined?o.push(e.toLocaleString(t.locale,{minimumFractionDigits:r,maximumFractionDigits:r})):o.push(e.toFixed(r).toString()),t.unit!==undefined&&!0===t.unitAbbr&&o.push(io[t.unit]||so[t.unit]),o.filter(function(e){return e!==undefined}).join(" ")}function So(e){for(var t=no.Meters,r=e,o=[no.Kilometers];1e3<r&&0<o.length;)r=mo(e,t=o.pop());return t}function wo(e){for(var t=ao.SquareMeters,r=e,o=[ao.SquareKilometers];1e6<r&&0<o.length;)r=vo(e,t=o.pop());return t}function Fo(){return new le.Style({stroke:new le.Stroke({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new le.Fill({color:"rgba(255, 255, 255, 0.2)"}),image:new le.Circle({radius:5,stroke:new le.Stroke({color:"#ffcc33"}),fill:new le.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}function Oo(){return new le.Style({stroke:new le.Stroke({color:"#ffcc33",width:2}),fill:new le.Fill({color:"rgba(255, 255, 255, 0.2)"})})}function Io(e,t){return e instanceof q?undefined:0===e.getFlatCoordinates().length?undefined:N.getLength(e,{projection:t})}function xo(e,t){return e instanceof q||e instanceof V?undefined:0===e.getFlatCoordinates().length?undefined:N.getArea(e,{projection:t})}function Mo(e,t){for(var r=Io(e,t),o=xo(e,t),n=[],i=e.flatCoordinates,a=i.length,s=0;s<=a-4;s+=2){var l=new V([[i[s],i[s+1]],[i[s+2],i[s+3]]]);n.push(Io(l,t))}return{area:o,length:r,lengths:n}}function Co(e){for(var t=To(e),r=e.flatCoordinates,o=t.length,n=0;n<o;n++){var i=2*n,a=new V([[r[i],r[i+1]],[r[i+2],r[i+3]]]).getCoordinateAt(.5),s=t[n];s!==undefined?s.setCoordinates(a):t[n]=new q(a)}return t}function To(e){var t=Math.max(e.flatCoordinates.length/2-1,0),r=e.get("_midpoints");if(r===undefined)return r=new Array(t),e.set("_midpoints",r,!0),r;if(t===r.length)return r;if(t>r.length)return r.push.apply(r,je(new Array(t-r.length))),r;for(var o=t;o<r.length;o++){var n=r[t];n!==undefined&&Lo(n)}return r.splice(t),r}function Lo(e){var t=e.get("_tooltip");if(t!==undefined){var r=t.getMap();r!==undefined&&r.removeOverlay(t)}}function Po(e){return Co(e).map(function(e){var t=e.get("_tooltip");return t===undefined?t=_o(e):t.setPosition(e.flatCoordinates),t})}function Do(e){return To(e).map(function(e){return e?e.get("_tooltip"):undefined})}function jo(e){var t=e.get("_center"),r=pe.getCenter(e.getExtent());return t!==undefined?t.setCoordinates(r):(t=new q(r),e.set("_center",t)),t}function ko(e){var t=jo(e),r=t.get("_tooltip");return r===undefined?r=_o(t):r.setPosition(t.flatCoordinates),r}function Eo(e){var t=e.get("_center");return t?t.get("_tooltip"):undefined}function Ro(e){var t=[].concat(Do(e)||[]),r=Eo(e);return r!==undefined&&t.push(r),t}function _o(e){var t=new B({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1});return t.setPosition(e.flatCoordinates),e.set("_tooltip",t),t}var $o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t}(Error),Ao=function(t){function r(){var e=t.call(this,"Can't slice a MultiPolygon.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}($o),Go=function(t){function r(){var e=t.call(this,"Can't slice with a line that has more than 2 points.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}($o),qo=function(t){function r(){var e=t.call(this,"More than 2 intersections found between the target polygon and the slicing line.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}($o);function Bo(){return new le.Style({stroke:new le.Stroke({color:[0,153,255,1],width:2}),fill:new le.Fill({color:[0,153,255,.2]}),image:new le.Circle({radius:5,stroke:new le.Stroke({color:[0,153,255,1]}),fill:new le.Fill({color:[0,153,255,.2]})})})}function No(){return new le.Style({stroke:new le.Stroke({color:[0,153,255,1],width:2})})}function Wo(e,t){return e instanceof Y?Uo(e,t):[]}function Vo(e,t){return[]}function Uo(e,t){if(1<e.getLinearRingCount())throw new Ao;if(2<t.getCoordinates().length)throw new Go;for(var r=(new ge).writeGeometryObject(t),o=e.getLinearRing(0).getCoordinates(),n=[[],[]],i=0,a=0,s=o.length-1;a<s;a++){var l=[o[a],o[a+1]],u=z.lineString(l),c=U(u,r).features,p=c.length;if(i+=p,1<p||2<i)throw new qo;if(n[0].push(l[0]),1===p){var d=c[0].geometry.coordinates;n[0].push(d),n[1].push(d),n.reverse()}}return i<=1?[]:(n[0].push(n[0][0]),n[1].push(n[1][0]),[new Y([n[0]]),new Y([n[1]])])}function zo(e,t){e.appendLinearRing(t)}var Ko=function(){function e(e){this.options=e,this.start$=new he.Subject,this.end$=new he.Subject,this.changes$=new he.Subject,e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}return Object.defineProperty(e.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.options.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),e.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction()},e.prototype.getSource=function(){return this.olOverlaySource},e.prototype.createOlInnerOverlayLayer=function(){return new ee({source:this.options.source?this.options.source:new X,style:this.options.layerStyle,zIndex:500})},e.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},e.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},e.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},e.prototype.addOlDrawInteraction=function(){var t=this,e=new Q({type:this.geometryType,source:this.getSource(),stopClick:!0,style:this.options.drawStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:function(){return!1}});this.onDrawStartKey=e.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=e.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(e),this.olDrawInteraction=e},e.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),de.unByKey(this.onDrawStartKey),de.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction),this.olDrawInteraction=undefined)},e.prototype.onDrawStart=function(e){var t=this,r=e.feature.getGeometry();this.start$.next(r),this.clearOlInnerOverlaySource(),this.onChangesKey=r.on("change",function(e){t.changes$.next(e.target)}),this.subscribeToKeyDown()},e.prototype.onDrawEnd=function(e){this.unsubscribeToKeyDown(),this.onChangesKey!==undefined&&de.unByKey(this.onChangesKey),this.end$.next(e.feature.getGeometry())},e.prototype.subscribeToKeyDown=function(){var t=this;this.unsubscribeToKeyDown(),this.keyDown$$=he.fromEvent(document,"keydown").subscribe(function(e){27===e.keyCode&&t.olDrawInteraction.removeLastPoint()})},e.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&(this.keyDown$$.unsubscribe(),this.keyDown$$=undefined)},e}(),Ho=function(){function e(e){this.options=e,this.start$=new he.Subject,this.end$=new he.Subject,this.changes$=new he.Subject,this.olModifyInteractionIsActive=!1,this.olTranslateInteractionIsActive=!1,this.olDrawInteractionIsActive=!1,this.removedOlInteractions=[],e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}return Object.defineProperty(e.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"olLinearRingsSource",{get:function(){return this.olLinearRingsLayer.getSource()},enumerable:!0,configurable:!0}),e.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction(),this.addOlTranslateInteraction(),this.activateTranslateInteraction(),this.addOlModifyInteraction(),this.activateModifyInteraction()},e.prototype.getSource=function(){return this.olOverlaySource},e.prototype.setOlGeometry=function(e){var t=new ie({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},e.prototype.createOlInnerOverlayLayer=function(){return new ee({source:this.options.source?this.options.source:new X,style:this.options.layerStyle,zIndex:500})},e.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},e.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},e.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},e.prototype.createOlLinearRingsLayer=function(){return new ee({source:new X,style:No(),zIndex:500})},e.prototype.addOlLinearRingsLayer=function(){this.olMap.addLayer(this.olLinearRingsLayer)},e.prototype.removeOlLinearRingsLayer=function(){this.olMap.removeLayer(this.olLinearRingsLayer)},e.prototype.clearOlLinearRingsSource=function(){this.olLinearRingsSource.clear(!0)},e.prototype.addOlModifyInteraction=function(){var e=new K({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=e},e.prototype.removeOlModifyInteraction=function(){this.olModifyInteraction!==undefined&&(this.deactivateModifyInteraction(),this.olModifyInteraction=undefined)},e.prototype.activateModifyInteraction=function(){var t=this;!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",function(e){return t.onModifyStart(e)}),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",function(e){return t.onModifyEnd(e)}),this.olMap.addInteraction(this.olModifyInteraction))},e.prototype.deactivateModifyInteraction=function(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,de.unByKey(this.onModifyStartKey),de.unByKey(this.onModifyEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olModifyInteraction))},e.prototype.onModifyStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onModifyKey=r.on("change",function(e){t.changes$.next(e.target)})},e.prototype.onModifyEnd=function(e){this.onModifyKey!==undefined&&de.unByKey(this.onModifyKey),this.end$.next(e.features.item(0).getGeometry())},e.prototype.subscribeToKeyDown=function(){var t=this;this.keyDown$$=he.fromEvent(document,"keydown").subscribe(function(e){27===e.keyCode&&!0===t.olDrawInteractionIsActive&&t.olDrawInteraction.removeLastPoint()})},e.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&this.keyDown$$.unsubscribe()},e.prototype.addOlTranslateInteraction=function(){var e=new H({layers:[this.olOverlayLayer]});this.olTranslateInteraction=e},e.prototype.removeOlTranslateInteraction=function(){this.olTranslateInteraction!==undefined&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=undefined)},e.prototype.activateTranslateInteraction=function(){var t=this;!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",function(e){return t.onTranslateStart(e)}),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",function(e){return t.onTranslateEnd(e)}),this.olMap.addInteraction(this.olTranslateInteraction))},e.prototype.deactivateTranslateInteraction=function(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,de.unByKey(this.onTranslateStartKey),de.unByKey(this.onTranslateEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olTranslateInteraction))},e.prototype.onTranslateStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onTranslateKey=r.on("change",function(e){t.changes$.next(e.target)})},e.prototype.onTranslateEnd=function(e){this.onTranslateKey!==undefined&&de.unByKey(this.onTranslateKey),this.end$.next(e.features.item(0).getGeometry())},e.prototype.addOlDrawInteraction=function(){var t=this,e=new Q({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:No(),condition:function(e){return t.getOlGeometry().intersectsCoordinate(e.coordinate)}});this.olDrawInteraction=e,this.subscribeToDrawKeyDown()},e.prototype.subscribeToDrawKeyDown=function(){var r=this;this.drawKeyDown$$=he.fromEvent(document,"keydown").subscribe(function(e){if(17===e.keyCode){r.unsubscribeToDrawKeyDown();var t=r.getOlGeometry();t&&t instanceof Y&&(r.subscribeToDrawKeyUp(),r.deactivateModifyInteraction(),r.deactivateTranslateInteraction(),r.activateDrawInteraction())}})},e.prototype.subscribeToDrawKeyUp=function(){var t=this;this.drawKeyUp$$=he.fromEvent(document,"keyup").subscribe(function(e){17===e.keyCode&&(t.unsubscribeToDrawKeyUp(),t.subscribeToDrawKeyDown(),t.deactivateDrawInteraction(),t.activateModifyInteraction(),t.activateTranslateInteraction())})},e.prototype.unsubscribeToDrawKeyDown=function(){this.drawKeyDown$$!==undefined&&this.drawKeyDown$$.unsubscribe()},e.prototype.unsubscribeToDrawKeyUp=function(){this.drawKeyUp$$!==undefined&&this.drawKeyUp$$.unsubscribe()},e.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.olDrawInteraction=undefined)},e.prototype.activateDrawInteraction=function(){var t=this;!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(function(e){e instanceof J&&(t.olMap.removeInteraction(e),t.removedOlInteractions.push(e))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=this.olDrawInteraction.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(this.olDrawInteraction))},e.prototype.deactivateDrawInteraction=function(){var t=this;!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(function(e){t.olMap.addInteraction(e)}),this.olDrawInteractionIsActive=!1,de.unByKey(this.onDrawStartKey),de.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction))},e.prototype.onDrawStart=function(e){var r=this,t=e.feature.getGeometry(),o=t.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(o),this.start$.next(this.getOlGeometry()),this.onDrawKey=t.on("change",function(e){var t=e.target.getLinearRing().getCoordinates();r.updateLinearRingOfOlGeometry(t),r.changes$.next(r.getOlGeometry())}),this.subscribeToKeyDown()},e.prototype.onDrawEnd=function(e){this.onDrawKey!==undefined&&de.unByKey(this.onDrawKey);var t=e.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()},e.prototype.addLinearRingToOlGeometry=function(e){zo(this.getOlGeometry(),new Z(e))},e.prototype.updateLinearRingOfOlGeometry=function(e){var t=this.getOlGeometry(),r=t.getLinearRings().slice(0,-1).map(function(e){return e.getCoordinates()});r.push(e),t.setCoordinates(r)},e.prototype.getOlGeometry=function(){var e=this.olOverlaySource.getFeatures();return 0<e.length?e[0].getGeometry():undefined},e}(),Qo=function(){function e(e){this.options=e,this.end$=new he.Subject,this.error$=new he.Subject,e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}return Object.defineProperty(e.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),e.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeDrawLineControl(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addDrawLineControl()},e.prototype.getSource=function(){return this.olOverlaySource},e.prototype.setOlGeometry=function(e){var t=new ie({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},e.prototype.createOlInnerOverlayLayer=function(){return new ee({source:this.options.source?this.options.source:new X,style:this.options.layerStyle,zIndex:500})},e.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},e.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},e.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},e.prototype.addDrawLineControl=function(){var t=this;this.drawLineControl=new Ko({geometryType:"LineString",drawStyle:this.options.drawStyle,maxPoints:2}),this.drawLineStart$$=this.drawLineControl.start$.subscribe(function(e){return t.onDrawLineStart(e)}),this.drawLineEnd$$=this.drawLineControl.end$.subscribe(function(e){return t.onDrawLineEnd(e)}),this.drawLineControl.setOlMap(this.olMap)},e.prototype.removeDrawLineControl=function(){this.drawLineControl!==undefined&&(this.drawLineStart$$.unsubscribe(),this.drawLineEnd$$.unsubscribe(),this.drawLineControl.getSource().clear(),this.drawLineControl.setOlMap(undefined))},e.prototype.onDrawLineStart=function(e){this.drawLineControl.getSource().clear()},e.prototype.onDrawLineEnd=function(r){var t=this,o=[],e=r.getExtent(),n=[];try{this.olOverlaySource.forEachFeatureInExtent(e,function(e){var t=Wo(e.getGeometry(),r);0<t.length&&(o.push.apply(o,je(t)),n.push(e))})}catch(i){if(i instanceof $o)return void this.error$.next(i);throw i}this.drawLineControl.getSource().clear(),this.olOverlaySource.addFeatures(o.map(function(e){return new ie(e)})),n.forEach(function(e){t.olOverlaySource.removeFeature(e)}),this.error$.next(undefined),this.end$.next(o)},e}(),Yo=function(){function e(e,t){this.dialogRef=e,this.data=t,this.measureAreaUnit=ao,this.measureLengthUnit=no}return e.prototype.onNoClick=function(){this.dialogRef.close()},e.decorators=[{type:Se.Component,args:[{selector:"igo-measurer-dialog",template:"<div mat-dialog-content>\r\n  <h3>{{'igo.geo.measure.dialog.title' | translate}}</h3>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\r\n        <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\r\n        <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n",styles:["h3{text-align:center;margin:0}table{width:100%;padding:10px}table tbody tr td:last-child{padding-left:10px}"]}]}],e.ctorParameters=function(){return[{type:ye.MatDialogRef},{type:undefined,decorators:[{type:Se.Inject,args:[ye.MAT_DIALOG_DATA]}]}]},e}(),Zo=function(){function e(e,t){var o=this;this.languageService=e,this.dialog=t,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:function(e){var t=o.activeLengthUnit;return bo(mo(e.properties.measure.length,t),{decimal:1,unit:t,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:function(e){var t=o.activeAreaUnit,r=vo(e.properties.measure.area,t);return r?bo(r,{decimal:1,unit:t,unitAbbr:!1,locale:"fr"}):""}}]},this.measureType=oo,this.measureAreaUnit=ao,this.measureLengthUnit=no,this.measureUnitsAuto=!1,this.measure$=new he.BehaviorSubject({}),this.selectedFeatures$=new he.BehaviorSubject([]),this.showTooltips=!0,this.activeLengthUnit=no.Meters,this.activeAreaUnit=ao.SquareMeters,this.olDrawSource=new X,this._activeMeasureType=oo.Length,this.minSegmentLength=10}return Object.defineProperty(e.prototype,"activeMeasureType",{get:function(){return this._activeMeasureType},set:function(e){this.setActiveMeasureType(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawControlIsActive",{get:function(){return this.activeDrawControl!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this.map.ol.getView().getProjection()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.onToggleTooltips(this.showTooltips),this.updateTooltipsOfOlSource(this.store.source.ol)},e.prototype.ngOnDestroy=function(){this.setActiveMeasureType(undefined),this.deactivateModifyControl(),this.freezeStore()},e.prototype.onMeasureTypeChange=function(e){this.activeMeasureType=e},e.prototype.onToggleDrawControl=function(e){!0===e?this.toggleDrawControl():this.deactivateDrawControl()},e.prototype.onToggleTooltips=function(e){!0===(this.showTooltips=e)?this.showTooltipsOfOlSource(this.store.source.ol):this.clearTooltipsOfOlSource(this.store.source.ol)},e.prototype.onToggleMeasureUnitsAuto=function(e){this.measureUnitsAuto=e},e.prototype.onLengthUnitChange=function(e){this.activeLengthUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},e.prototype.onAreaUnitChange=function(e){this.activeAreaUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},e.prototype.onCalculateClick=function(){var e=this.selectedFeatures$.value,t=e.reduce(function(e,t){return e+t.properties.measure.area||0},0),r=e.reduce(function(e,t){return"Polygon"===t.geometry.type?e:e+t.properties.measure.length||0},0),o=e.reduce(function(e,t){return"LineString"===t.geometry.type?e:e+t.properties.measure.length||0},0);this.openDialog({area:t,length:r,perimeter:o})},e.prototype.onDeleteClick=function(){this.store.deleteMany(this.selectedFeatures$.value)},e.prototype.onModifyClick=function(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{var t=this.selectedFeatures$.value[0],e=this.store.layer.ol.getSource().getFeatures().find(function(e){return e.get("id")===t.properties.id});if(e!==undefined){this.deactivateDrawControl(),this.activateModifyControl();var r=e.getGeometry();this.clearTooltipsOfOlGeometry(r),this.modifyControl.setOlGeometry(r)}}},e.prototype.openDialog=function(e){this.dialog.open(Yo,{data:e})},e.prototype.initStore=function(){var o=this,e=this.store;qt(e,new ht({title:"Measures",zIndex:200,source:new Be,style:Oo(),showInLayerList:!1,exportable:!1,browsable:!1})),Bt(e),Nt(e,new Dt({map:this.map,many:!0})),this.onFeatureAddedKey=e.source.ol.on("addfeature",function(e){var t=e.feature,r=t.getGeometry();o.updateMeasureOfOlGeometry(r,t.get("measure"))}),this.onFeatureRemovedKey=e.source.ol.on("removefeature",function(e){var t=e.feature.getGeometry();o.clearTooltipsOfOlGeometry(t)}),this.selectedFeatures$$=e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(Fe.skip(1)).subscribe(function(e){!0===o.modifyControl.active&&o.deactivateModifyControl(),o.selectedFeatures$.next(e.map(function(e){return e.entity}))})},e.prototype.freezeStore=function(){var e=this.store;this.selectedFeatures$$.unsubscribe(),de.unByKey(this.onFeatureAddedKey),de.unByKey(this.onFeatureRemovedKey),this.clearTooltipsOfOlSource(e.source.ol),this.map.removeLayer(e.layer),e.deactivateStrategyOfType(Ct),e.deactivateStrategyOfType(Dt)},e.prototype.createDrawLineControl=function(){this.drawLineControl=new Ko({geometryType:"LineString",source:this.olDrawSource,drawStyle:Fo(),layerStyle:new W({})})},e.prototype.createDrawPolygonControl=function(){this.drawPolygonControl=new Ko({geometryType:"Polygon",source:this.olDrawSource,drawStyle:Fo(),layerStyle:new W({})})},e.prototype.createModifyControl=function(){this.modifyControl=new Ho({source:this.olDrawSource,drawStyle:Fo(),layerStyle:new W({})})},e.prototype.toggleDrawControl=function(){this.deactivateDrawControl(),this.activeMeasureType===oo.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===oo.Area&&this.activateDrawControl(this.drawPolygonControl)},e.prototype.activateDrawControl=function(e){var t=this;this.activeDrawControl=e,this.drawStart$$=e.start$.subscribe(function(e){return t.onDrawStart(e)}),this.drawEnd$$=e.end$.subscribe(function(e){return t.onDrawEnd(e)}),this.drawChanges$$=e.changes$.subscribe(function(e){return t.onDrawChanges(e)}),e.setOlMap(this.map.ol)},e.prototype.deactivateDrawControl=function(){this.activeDrawControl!==undefined&&(this.olDrawSource.clear(),this.drawStart$$!==undefined&&this.drawStart$$.unsubscribe(),this.drawEnd$$!==undefined&&this.drawEnd$$.unsubscribe(),this.drawChanges$$!==undefined&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),this.activeOlGeometry!==undefined&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(undefined),this.activeDrawControl=undefined,this.activeOlGeometry=undefined)},e.prototype.setActiveMeasureType=function(e){this._activeMeasureType=e,this.clearMeasures(),this.toggleDrawControl()},e.prototype.onDrawStart=function(e){this.activeOlGeometry=e},e.prototype.onDrawEnd=function(e){this.activeOlGeometry=undefined,this.finalizeMeasureOfOlGeometry(e),this.addFeatureToStore(e),this.clearTooltipsOfOlGeometry(e),this.olDrawSource.clear(!0)},e.prototype.onDrawChanges=function(e){var t=Mo(e,this.projection);this.updateMeasureOfOlGeometry(e,Object.assign({},t,{area:undefined})),this.measure$.next(t)},e.prototype.activateModifyControl=function(){var t=this,e=this.store.getStrategyOfType(Dt);e.deactivate(),e.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(function(e){return t.onModifyStart(e)}),this.modifyEnd$$=this.modifyControl.end$.subscribe(function(e){return t.onModifyEnd(e)}),this.modifyChanges$$=this.modifyControl.changes$.subscribe(function(e){return t.onModifyChanges(e)}),this.modifyControl.setOlMap(this.map.ol)},e.prototype.deactivateModifyControl=function(){if(this.modifyStart$$!==undefined&&this.modifyStart$$.unsubscribe(),this.modifyEnd$$!==undefined&&this.modifyEnd$$.unsubscribe(),this.modifyChanges$$!==undefined&&this.modifyChanges$$.unsubscribe(),this.activeOlGeometry!==undefined){if(1===this.selectedFeatures$.value.length){var e=this.selectedFeatures$.value[0];this.addFeatureToStore(this.activeOlGeometry,e)}this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)}this.olDrawSource.clear(),this.store.activateStrategyOfType(Dt),this.activeOlGeometry=undefined,this.modifyControl.setOlMap(undefined)},e.prototype.onModifyStart=function(e){this.onDrawStart(e)},e.prototype.onModifyChanges=function(e){this.onDrawChanges(e)},e.prototype.onModifyEnd=function(e){this.finalizeMeasureOfOlGeometry(e)},e.prototype.finalizeMeasureOfOlGeometry=function(e){var t=Mo(e,this.projection);e instanceof Y&&(t=Object.assign({},t,{lengths:[]})),this.updateMeasureOfOlGeometry(e,t)},e.prototype.updateMeasureOfOlGeometry=function(e,t){e.setProperties({_measure:t},!0),this.updateTooltipsOfOlGeometry(e)},e.prototype.clearMeasures=function(){this.measure$.next({})},e.prototype.addFeatureToStore=function(e,t){var r=t?t.properties.id:Oe.uuid(),o=this.map.ol.getView().getProjection(),n=(new ge).writeGeometryObject(e,{featureProjection:o,dataProjection:o});this.store.update({type:nt,geometry:n,projection:o.getCode(),properties:{id:r,measure:e.get("_measure")},meta:{id:r}})},e.prototype.updateTooltipsOfOlGeometry=function(e){var t=e.get("_measure"),r=t.lengths,o=t.area,n=Po(e);if(r.length===n.length)for(var i=0;i<n.length;i++){var a=r[i];a!==undefined&&this.updateOlTooltip(n[i],mo(a,this.activeLengthUnit),this.activeLengthUnit,oo.Length)}o!==undefined&&this.updateOlTooltip(ko(e),vo(o,this.activeAreaUnit),this.activeAreaUnit,oo.Area)},e.prototype.showTooltipsOfOlGeometry=function(e){var t=this;Ro(e).forEach(function(e){t.shouldShowTooltip(e)&&t.map.ol.addOverlay(e)})},e.prototype.clearTooltipsOfOlGeometry=function(e){var t=this;Ro(e).forEach(function(e){e!==undefined&&e.getMap()!==undefined&&t.map.ol.removeOverlay(e)})},e.prototype.updateTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.updateTooltipsOfOlGeometry(e.getGeometry())})},e.prototype.showTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.showTooltipsOfOlGeometry(e.getGeometry())})},e.prototype.clearTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){e.getGeometry()!==undefined&&t.clearTooltipsOfOlGeometry(e.getGeometry())})},e.prototype.updateOlTooltip=function(e,t,r,o){e.setProperties({_measure:t,_unit:r,_type:o},!0),e.getElement().innerHTML=this.computeTooltipInnerHTML(e),this.shouldShowTooltip(e)&&this.map.ol.addOverlay(e)},e.prototype.computeTooltipInnerHTML=function(e){var t=e.getProperties();return bo(t._measure,{decimal:1,unit:t._unit,unitAbbr:!0,locale:"fr"})},e.prototype.shouldShowTooltip=function(e){if(!1===this.showTooltips)return!1;var t=e.getProperties(),r=t._measure;if(r===undefined)return!1;if(t._unit===oo.Length){var o=mo(this.minSegmentLength,t._unit)||0;return r>Math.max(o,0)}return!0},e.decorators=[{type:Se.Component,args:[{selector:"igo-measurer",template:'<div>\r\n  <div class="measure-type-toggle">\r\n    <mat-button-toggle-group\r\n      [value]="activeMeasureType"\r\n      (change)="onMeasureTypeChange($event.value)">\r\n      <mat-button-toggle [value]="measureType.Length">\r\n        {{(\'igo.geo.measure.\' + measureType.Length) | translate}}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]="measureType.Area">\r\n        {{(\'igo.geo.measure.\' + measureType.Area) | translate}}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class="measure-options">\r\n    <mat-slide-toggle\r\n      [checked]="drawControlIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleDrawControl($event.checked)">\r\n      {{\'igo.geo.measure.toggleMeasure\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="showTooltips"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleTooltips($event.checked)">\r\n      {{\'igo.geo.measure.toggleMapTooltips\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="measureUnitsAuto"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleMeasureUnitsAuto($event.checked)">\r\n      {{\'igo.geo.measure.toggleAutoUnits\' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf="measure$ | async as measure">\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Length"\r\n      [measureUnit]="measureLengthUnit.Meters"\r\n      [measure]="measure.length"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="(activeMeasureType === measureType.Area ? \'igo.geo.measure.perimeter\' : \'igo.geo.measure.length\') | translate"\r\n      (measureUnitChange)="onLengthUnitChange($event)">\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Area"\r\n      [measureUnit]="measureAreaUnit.SquareMeters"\r\n      [measure]="measure.area"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="\'igo.geo.measure.area\' | translate"\r\n      (measureUnitChange)="onAreaUnitChange($event)">\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <div class="measure-store-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.calculate.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onCalculateClick()">\r\n      <mat-icon svgIcon="calculator"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.delete.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onDeleteClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n\r\n    \x3c!--button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.modify.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length !== 1"\r\n      (click)="onModifyClick()">\r\n      <mat-icon svgIcon="edit"></mat-icon>\r\n    </button--\x3e\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class="table-compact"\r\n    [store]="store"\r\n    [template]="tableTemplate">\r\n  </igo-entity-table>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".measure-type-toggle{padding:10px;text-align:center}.measure-type-toggle mat-button-toggle-group{width:100%}.measure-type-toggle mat-button-toggle-group mat-button-toggle{width:50%}.measure-options{overflow-x:hidden}.measure-options mat-slide-toggle{width:100%;margin:10px}.measure-options mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px);font-size:16px}.measure-store-buttons{width:100%;border-top:1px solid #ddd;border-bottom:1px solid #ddd}.measure-store-buttons button:first-of-type{margin-left:14px}"]}]}],e.ctorParameters=function(){return[{type:Ie.LanguageService},{type:ye.MatDialog}]},e.propDecorators={map:[{type:Se.Input}],store:[{type:Se.Input}],activeMeasureType:[{type:Se.Input}],minSegmentLength:[{type:Se.Input}],table:[{type:Se.ViewChild,args:["table"]}]},e}(),Jo=function(){function e(){}return e.prototype.transform=function(e,t,r,o){var n;return void 0===r&&(r=!1),void 0===o&&(o=1),0<=Object.values(ao).indexOf(t)?n=vo(e,t):0<=Object.values(no).indexOf(t)&&(n=mo(e,t)),n?bo(n,{decimal:1,unit:t,unitAbbr:r,locale:"fr"}):n},e.decorators=[{type:Se.Pipe,args:[{name:"measureFormat"}]}],e}(),Xo=function(){function e(e,t){this.cdRef=e,this.ngControl=t,this.olGeoJSON=new ge,this.ready=!1,this.olTooltip=B,this.drawGuide=0,this.measure=!1,this.onChange=function(){},this.onTouched=function(){},this.ngControl!==undefined&&(this.ngControl.valueAccessor=this)}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryType},set:function(e){this._geometryType=e,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.toggleControl())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){!1!==this.ready?(e?this.addGeoJSONToOverlay(e):this.olOverlaySource.clear(),this._value=e,this.onChange(e),this.toggleControl(),this.cdRef.detectChanges()):this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.addOlOverlayLayer(),this.createMeasureTooltip(),this.drawInteractionStyle=Bo(),this.defaultDrawStyleRadius=this.drawInteractionStyle.getImage().getRadius(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0},e.prototype.ngOnDestroy=function(){this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)},e.prototype.registerOnChange=function(e){this.onChange=e},e.prototype.registerOnTouched=function(e){this.onTouched=e},e.prototype.writeValue=function(e){this.value=e},e.prototype.addOlOverlayLayer=function(){this.olOverlayLayer=new ee({source:new X,zIndex:500}),this.map.ol.addLayer(this.olOverlayLayer)},e.prototype.createDrawControl=function(){var o=this;this.drawControl=new Ko({geometryType:this.geometryType,layer:this.olOverlayLayer,drawStyle:function(e,t){var r=o.drawInteractionStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},e.prototype.createModifyControl=function(){var o=this;this.modifyControl=new Ho({layer:this.olOverlayLayer,drawStyle:function(e,t){var r=o.drawInteractionStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},e.prototype.toggleControl=function(){this.deactivateControl(),this.value?this.activateControl(this.modifyControl):this.activateControl(this.drawControl)},e.prototype.activateControl=function(e){var t=this;this.activeControl=e,this.olGeometryEnds$$=e.end$.subscribe(function(e){return t.onOlGeometryEnds(e)}),!0===this.measure&&e===this.drawControl&&(this.olGeometryChanges$$=e.changes$.subscribe(function(e){return t.onOlGeometryChanges(e)})),e.setOlMap(this.map.ol)},e.prototype.deactivateControl=function(){this.removeMeasureTooltip(),this.activeControl!==undefined&&this.activeControl.setOlMap(undefined),this.olGeometryEnds$$!==undefined&&this.olGeometryEnds$$.unsubscribe(),this.olGeometryChanges$$!==undefined&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=undefined},e.prototype.onOlGeometryEnds=function(e){this.removeMeasureTooltip(),this.setOlGeometry(e)},e.prototype.onOlGeometryChanges=function(e){"Point"!==e.getType()&&this.updateMeasureTooltip(e)},e.prototype.setOlGeometry=function(e){if(e!==undefined){var t=this.olGeoJSON.writeGeometryObject(e,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"});this.writeValue(t)}},e.prototype.addGeoJSONToOverlay=function(e){var t=this.olGeoJSON.readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),r=new ie({geometry:t});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(r)},e.prototype.createMeasureTooltip=function(){this.olTooltip=new B({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})},e.prototype.updateMeasureTooltip=function(e){var t=Mo(e,this.map.projection).lengths,r="Polygon"===e.getType()?t.length-2:t.length-1,o=t[r],n=Co(e),i=n[r];if(0!==n.length&&i!==undefined){this.olTooltip.setPosition(i.flatCoordinates);var a=bo(o,{decimal:1,unit:no.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=a,this.olTooltip.getMap()===undefined&&this.map.ol.addOverlay(this.olTooltip)}else this.removeMeasureTooltip()},e.prototype.removeMeasureTooltip=function(){this.olTooltip.getMap()!==undefined&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(undefined))},e.prototype.updateDrawStyleWithDrawGuide=function(e,t){var r,o=this.drawGuide;r=o===undefined||o<0?this.defaultDrawStyleRadius:0<o?o/t:o,e.getImage().setRadius(r)},e.decorators=[{type:Se.Component,args:[{selector:"igo-geometry-form-field-input",template:"<ng-template></ng-template>",changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef},{type:fe.NgControl,decorators:[{type:Se.Optional},{type:Se.Self}]}]},e.propDecorators={map:[{type:Se.Input}],geometryType:[{type:Se.Input}],drawGuide:[{type:Se.Input}],measure:[{type:Se.Input}],value:[{type:Se.Input}]},e}(),en=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,fe.FormsModule,fe.ReactiveFormsModule,ye.MatIconModule,ye.MatFormFieldModule,ye.MatInputModule,ye.MatButtonModule,ye.MatButtonToggleModule,Ie.IgoLanguageModule],exports:[ro,Xo],declarations:[ro,Xo]}]}],e}(),tn=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,en],exports:[en],declarations:[],providers:[],entryComponents:[ro]}]}],e}(),rn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t}(Error),on=function(t){function r(){var e=t.call(this,"Invalid file.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}(rn),nn=function(t){function r(){var e=t.call(this,"Nothing to export.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}(rn);function an(e,t,r){var o=document.createElement("a");o.setAttribute("href","data:"+t+","+encodeURIComponent(e)),o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}function sn(e,t,r){if(e instanceof nn)ln(t,r);else{var o=r.translate,n=o.instant("igo.geo.export.failed.title"),i=o.instant("igo.geo.export.failed.text");t.error(i,n)}}function ln(e,t){var r=t.translate,o=r.instant("igo.geo.export.nothing.title"),n=r.instant("igo.geo.export.nothing.text");e.error(n,o)}var un=Oe.strEnum(["GeoJSON","GML","GPX","KML","Shapefile"]),cn=function(){function h(e){this.config=e,this.ogreUrl=this.config.getConfig("importExport.url")}return h.prototype["export"]=function(e,t,r,o,n){void 0===o&&(o="EPSG:4326"),void 0===n&&(n="EPSG:4326");var i=e.map(function(r){var e=r.getKeys().filter(function(e){return!e.startsWith("_")}).reduce(function(e,t){return e[t]=r.get(t),e},{geometry:r.getGeometry()});return new ie(e)});return this.exportAsync(i,t,r,o,n)},h.prototype.exportAsync=function(t,r,o,n,i){var a=this;return new he.Observable(function(e){if(!0!==a.nothingToExport(t,r))if(0<=Object.keys(h.ogreFormats).indexOf(r)){if(a.ogreUrl===undefined)return void(0<=h.noOgreFallbacks.indexOf(r)?a.exportToFile(t,e,r,o,n,i):e.error(new on));a.exportWithOgre(t,e,r,o,n,i)}else a.exportToFile(t,e,r,o,n,i);else e.error(new nn)})},h.prototype.exportToFile=function(e,t,r,o,n,i){an((new be[r]).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),"text/plain;charset=utf-8",o+"."+r.toLowerCase()),t.complete()},h.prototype.exportWithOgre=function(e,t,r,o,n,i){var a=(new be.GeoJSON).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),s=this.ogreUrl+"/convert",l=document.createElement("form");l.setAttribute("method","post"),l.setAttribute("action",s);var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","json"),u.setAttribute("value",a),l.appendChild(u);var c=document.createElement("input"),p="Shapefile"===r?o+".zip":o;c.setAttribute("type","hidden"),c.setAttribute("name","outputName"),c.setAttribute("value",p),l.appendChild(c);var d=h.ogreFormats[r],f=document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","formatOutput"),f.setAttribute("value",d),l.appendChild(f),document.body.appendChild(l),l.submit(),document.body.removeChild(l),t.complete()},h.prototype.nothingToExport=function(e,t){return 0===e.length||"GPX"===t&&e.find(function(e){return 0<=["Point","LineString"].indexOf(e.getGeometry().getType())})===undefined},h.ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile"},h.noOgreFallbacks=["GML","GPX","KML"],h.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],h.ctorParameters=function(){return[{type:Ie.ConfigService}]},h.ngInjectableDef=Se.defineInjectable({factory:function(){return new h(Se.inject(Ie.ConfigService))},token:h,providedIn:"root"}),h}(),pn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t}(Error),dn=function(t){function r(){var e=t.call(this,"Invalid file.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}(pn),fn=function(t){function r(){var e=t.call(this,"Failed to read file.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}(pn),hn=function(t){function r(){var e=t.call(this,"Nothing to import.")||this;return Object.setPrototypeOf(e,r.prototype),e}return Me(r,t),r}(pn);function gn(e,t,r){var o=e.map(function(e){return jt(e,t.projection)}),n=Math.floor(255*Math.random()),i=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),s=new le.Stroke({color:[n,i,a,1],width:2}),l=new le.Fill({color:[n,i,a,.4]}),u=new Be({queryable:!0});u.ol.addFeatures(o);var c=new ht({title:r,source:u,style:new le.Style({stroke:s,fill:l,image:new le.Circle({radius:5,stroke:s,fill:l})})});return t.addLayer(c),Gt(t,o),c}function yn(e,t,r,o,n){if(0!==t.length){var i=bn(e);gn(t,r,i);var a=n.translate,s=a.instant("igo.geo.dropGeoFile.success.title"),l=a.instant("igo.geo.dropGeoFile.success.text",{value:i});o.success(l,s)}else this.handleNothingToImportError(e,o,n)}function mn(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.invalid.title"),a=n.instant("igo.geo.dropGeoFile.invalid.text",{value:e.name,mimeType:e.type});r.error(a,i)}function vn(e){return e.name.split(".").pop().toLowerCase()}function bn(e){return e.name.substr(0,e.name.lastIndexOf("."))}var Sn=function(){function i(e,t){this.http=e,this.config=t,this.ogreUrl=this.config.getConfig("importExport.url")}return i.prototype["import"]=function(e,t,r){return void 0===t&&(t="EPSG:4326"),void 0===r&&(r="EPSG:4326"),this.importAsync(e,t,r)},i.prototype.getFileImporter=function(e){var t=vn(e),r=e.type,o=je(i.allowedMimeTypes,i.allowedZipMimeTypes),n=i.allowedExtensions;return o.indexOf(r)<0&&n.indexOf(t)<0?undefined:"application/json"===r||0<=["json","geojson","kml"].indexOf(t)?this.importFile:this.ogreUrl!==undefined?this.importFileWithOgre:undefined},i.prototype.importAsync=function(r,o,n){var i=this;return new he.Observable(function(e){var t=i.getFileImporter(r);t!==undefined?t.call(i,r,e,o,n):e.error(new dn)})},i.prototype.importFile=function(o,n,i,a){var s=this,e=new FileReader;e.onload=function(e){try{var t=s.parseFeaturesFromFile(o,e.target.result,i,a);n.next(t)}catch(r){n.error(new fn)}n.complete()},e.onerror=function(e){n.error(new fn)},e.readAsText(o,"UTF-8")},i.prototype.importFileWithOgre=function(r,o,e,n){var i=this,t=this.ogreUrl+"/convert",a=new FormData;a.append("upload",r),a.append("sourceSrs",e),a.append("targetSrs",n),a.append("formatOutput","GEOJSON"),a.append("skipFailures",""),this.http.post(t,a,{headers:new we.HttpHeaders}).subscribe(function(e){if(null!==e)if(0<(e.errors||[]).length)o.error(new fn);else{var t=i.parseFeaturesFromGeoJSON(r,e,n);o.next(t),o.complete()}else o.error(new fn)},function(e){o.error(new fn)})},i.prototype.parseFeaturesFromFile=function(t,e,r,o){var n,i=vn(t),a=t.type,s=new be.GeoJSON;if("application/vnd.google-earth.kml+xml"===a)n=new be.KML;else if("application/gml+xml"===a)n=new be.GML;else if("application/gpx+xml"===a)n=new be.GPX;else switch(i){case"kml":n=new be.KML;break;case"gpx":n=new be.GPX;break;case"gml":n=new be.GML;break;default:n=s}return n.readFeatures(e,{dataProjection:r,featureProjection:o}).map(function(e){return Object.assign(s.writeFeatureObject(e),{projection:o,meta:{id:Oe.uuid(),title:bn(t)}})})},i.prototype.parseFeaturesFromGeoJSON=function(t,e,r){var o=new be.GeoJSON;return o.readFeatures(e).map(function(e){return Object.assign(o.writeFeatureObject(e),{projection:r,meta:{id:Oe.uuid(),title:bn(t)}})})},i.allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"],i.allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"],i.allowedExtensions=["geojson","kml","gpx","json","gml"],i.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],i.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.ConfigService}]},i.ngInjectableDef=Se.defineInjectable({factory:function(){return new i(Se.inject(we.HttpClient),Se.inject(Ie.ConfigService))},token:i,providedIn:"root"}),i}(),wn=function(){function e(e,t,r,o,n){this.importService=e,this.exportService=t,this.languageService=r,this.messageService=o,this.formBuilder=n,this.formats=un,this.inputProj="EPSG:4326",this.buildForm()}return e.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t.layers=e.filter(function(e){return e instanceof ht&&!0===e.exportable})})},e.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},e.prototype.importFiles=function(e){var t,r,o=this,n=function(t){i.importService["import"](t,i.inputProj).subscribe(function(e){return o.onFileImportSuccess(t,e)},function(e){return o.onFileImportError(t,e)})},i=this;try{for(var a=Pe(e),s=a.next();!s.done;s=a.next()){n(s.value)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.handleExportFormSubmit=function(e){var t=this,r=this.map.getLayerById(e.layer),o=r.dataSource.ol.getFeatures();this.exportService["export"](o,e.format,r.title,this.map.projection).subscribe(function(){},function(e){return t.onFileExportError(e)})},e.prototype.buildForm=function(){this.form=this.formBuilder.group({format:["",[fe.Validators.required]],layer:["",[fe.Validators.required]]})},e.prototype.onFileImportSuccess=function(e,t){yn(e,t,this.map,this.messageService,this.languageService)},e.prototype.onFileImportError=function(e,t){mn(e,0,this.messageService,this.languageService)},e.prototype.onFileExportError=function(e){sn(e,this.messageService,this.languageService)},e.decorators=[{type:Se.Component,args:[{selector:"igo-import-export",template:'<mat-tab-group>\r\n\r\n  <mat-tab [label]="\'igo.geo.importExportForm.importTabTitle\' |translate">\r\n    <form class="igo-form">\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <input\r\n            matInput\r\n            placeholder="{{\'igo.geo.importExportForm.importProjPlaceholder\' | translate}}"\r\n            name="inputProj"\r\n            [(ngModel)]="inputProj">\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-form-button-group">\r\n        <button mat-raised-button type="button" (click)="fileInput.click()">\r\n          {{\'igo.geo.importExportForm.importButton\' | translate}}\r\n        </button>\r\n        <input\r\n          #fileInput\r\n          type="file"\r\n          [style.display]="\'none\'"\r\n          (click)="fileInput.value = null"\r\n          (change)="importFiles($event.target.files)">\r\n      </div>\r\n    </form>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]="\'igo.geo.importExportForm.exportTabTitle\' |translate">\r\n    <form class="igo-form" [formGroup]="form">\r\n\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName="layer"\r\n            placeholder="{{\'igo.geo.importExportForm.exportLayerPlaceholder\' | translate}}">\r\n            <mat-option *ngFor="let layer of layers" [value]="layer.id">\r\n              {{layer.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName="format"\r\n            placeholder="{{\'igo.geo.importExportForm.exportFormatPlaceholder\' | translate}}">\r\n            <mat-option *ngFor="let format of formats | keyvalue " [value]="format.key">\r\n              {{format.value}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-form-button-group">\r\n        <button\r\n          mat-raised-button\r\n          type="button"\r\n          [disabled]="!form.valid"\r\n          (click)="handleExportFormSubmit(form.value)">\r\n          {{\'igo.geo.importExportForm.exportButton\' | translate}}\r\n        </button>\r\n      </div>\r\n\r\n    </form>\r\n  </mat-tab>\r\n\r\n</mat-tab-group>\r\n',styles:["mat-form-field{width:100%}.igo-form{padding:5px}.igo-form-button-group{text-align:center;padding-top:10px}"]}]}],e.ctorParameters=function(){return[{type:Sn},{type:cn},{type:Ie.LanguageService},{type:Ie.MessageService},{type:fe.FormBuilder}]},e.propDecorators={map:[{type:Se.Input}]},e}(),Fn=function(i){function e(e,t,r,o){var n=i.call(this)||this;return n.component=e,n.importService=t,n.languageService=r,n.messageService=o,n.filesDropped=new Se.EventEmitter,n.filesInvalid=new Se.EventEmitter,n}return Me(e,i),Object.defineProperty(e.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.filesDropped$$=this.filesDropped.subscribe(function(e){t.onFilesDropped(e)})},e.prototype.ngOnDestroy=function(){this.filesDropped$$.unsubscribe()},e.prototype.onDragOver=function(e){i.prototype.onDragOver.call(this,e)},e.prototype.onDragLeave=function(e){i.prototype.onDragLeave.call(this,e)},e.prototype.onDrop=function(e){i.prototype.onDrop.call(this,e)},e.prototype.onFilesDropped=function(e){var t,r,o=this,n=function(t){i.importService["import"](t).subscribe(function(e){return o.onFileImportSuccess(t,e)},function(e){return o.onFileImportError(t,e)})},i=this;try{for(var a=Pe(e),s=a.next();!s.done;s=a.next()){n(s.value)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.onFileImportSuccess=function(e,t){yn(e,t,this.map,this.messageService,this.languageService)},e.prototype.onFileImportError=function(e,t){mn(e,0,this.messageService,this.languageService)},e.decorators=[{type:Se.Directive,args:[{selector:"[igoDropGeoFile]"}]}],e.ctorParameters=function(){return[{type:ir},{type:Sn},{type:Ie.LanguageService},{type:Ie.MessageService}]},e.propDecorators={onDragOver:[{type:Se.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:Se.HostListener,args:["dragleave",["$event"]]}],onDrop:[{type:Se.HostListener,args:["drop",["$event"]]}]},e}(ve.DragAndDropDirective),On=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e.decorators=[{type:Se.NgModule,args:[{imports:[fe.FormsModule,fe.ReactiveFormsModule,me.CommonModule,ye.MatButtonModule,ye.MatTabsModule,ye.MatSelectModule,ye.MatOptionModule,ye.MatFormFieldModule,ye.MatInputModule,Ie.IgoLanguageModule,ve.IgoKeyValueModule,ve.IgoDrapDropModule],exports:[wn,Fn],declarations:[wn,Fn]}]}],e}(),In=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[mr,yt,Ft]}},e.decorators=[{type:Se.NgModule,args:[{imports:[ye.MatInputModule,ye.MatFormFieldModule,me.CommonModule,fe.FormsModule,ye.MatIconModule,ye.MatButtonModule,ye.MatTooltipModule,ye.MatListModule,ye.MatSliderModule,ye.MatBadgeModule,Ie.IgoLanguageModule,ve.IgoListModule,ve.IgoCollapsibleModule,ve.IgoImageModule],exports:[bt,St,Ot,xt],declarations:[bt,St,Ot,xt]}]}],e}(),xn=function(){function e(e,t){this.networkService=t,this.component=e}return Object.defineProperty(e.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){var t=this;this.networkService.currentState().subscribe(function(e){console.log(e),t.state=e,t.changeLayer()}),this.map.layers$.subscribe(function(e){t.changeLayer()})},e.prototype.changeLayer=function(){var t=this;this.map.layers$.value.forEach(function(e){e.options.sourceOptions&&(e.options.sourceOptions.pathOffline&&!1===t.state.connection?(e.options.sourceOptions.excludeAttributeOffline&&(e.options.sourceOptions.excludeAttributeBackUp=e.options.sourceOptions.excludeAttribute,e.options.sourceOptions.excludeAttribute=e.options.sourceOptions.excludeAttributeOffline),e.ol.getSource().clear(),e.ol.getSource().setUrl(e.options.sourceOptions.pathOffline)):e.options.sourceOptions.pathOffline&&!0===t.state.connection&&(e.options.sourceOptions.excludeAttributeBackUp&&(e.options.sourceOptions.excludeAttribute=e.options.sourceOptions.excludeAttributeBackUp),e.ol.getSource().clear(),e.ol.getSource().setUrl(e.options.sourceOptions.url)))})},e.decorators=[{type:Se.Directive,args:[{selector:"[igoMapLayer]"}]}],e.ctorParameters=function(){return[{type:ir},{type:Ie.NetworkService}]},e}(),Mn=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,Ie.IgoLanguageModule,ve.IgoConfirmDialogModule,ye.MatIconModule,ye.MatButtonModule,ye.MatTooltipModule],exports:[ir,ar,sr,fr,pr,dr,xn],declarations:[ir,ar,sr,fr,pr,dr,xn]}]}],e}(),Cn=function(){function e(){this.measure$=new he.BehaviorSubject(undefined),this._auto=!1,this.measureUnitChange=new Se.EventEmitter}return Object.defineProperty(e.prototype,"measure",{get:function(){return this.measure$.value},set:function(e){this.measure$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auto",{get:function(){return this._auto},set:function(e){this.toggleAutoUnit(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"measureUnits",{get:function(){return this.measureType===oo.Area?Object.values(ao):Object.values(no)},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this.toggleAutoUnit(!1)},e.prototype.onMeasureUnitChange=function(e){this.measureUnit=e,this.measureUnitChange.emit(e)},e.prototype.toggleAutoUnit=function(e){var t=this;this.measure$$!==undefined&&this.measure$$.unsubscribe(),!0===e&&(this.measure$$=this.measure$.subscribe(function(e){t.computeBestMeasureUnit(e)})),this._auto=e},e.prototype.computeBestMeasureUnit=function(e){var t=this.measureUnit;this.measureType===oo.Area?t=wo(e):this.measureType===oo.Length&&(t=So(e)),t!==this.measureUnit&&this.onMeasureUnitChange(t)},e.decorators=[{type:Se.Component,args:[{selector:"igo-measurer-item",template:'<mat-form-field class="measure-field">\r\n  <input\r\n    matInput\r\n    [readonly]="true"\r\n    [placeholder]="placeholder"\r\n    [value]="((measure$ | async) || 0) | measureFormat: measureUnit">\r\n</mat-form-field>\r\n<mat-form-field class="unit-field">\r\n  <mat-select\r\n    [value]="measureUnit"\r\n    [disabled]="auto"\r\n    (selectionChange)="onMeasureUnitChange($event.value)">\r\n    <mat-option *ngFor="let measureUnit of measureUnits" [value]="measureUnit">\r\n      {{(\'igo.geo.measure.\' + measureUnit) | translate}}\r\n    </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host{display:flex;width:100%;padding:5px 10px}.measure-field{display:flex;flex-flow:column nowrap;width:100%}.unit-field{width:110px;margin-left:10px}"]}]}],e.ctorParameters=function(){return[]},e.propDecorators={measureType:[{type:Se.Input}],measureUnit:[{type:Se.Input}],measure:[{type:Se.Input}],auto:[{type:Se.Input}],placeholder:[{type:Se.Input}],measureUnitChange:[{type:Se.Output}]},e}(),Tn=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatButtonModule,ye.MatButtonToggleModule,ye.MatIconModule,ye.MatTooltipModule,ye.MatFormFieldModule,ye.MatInputModule,ye.MatSelectModule,ye.MatSlideToggleModule,Ie.IgoLanguageModule,ve.IgoEntityTableModule],declarations:[Jo,Cn,Zo,Yo],exports:[Jo,Zo],entryComponents:[Yo]}]}],e}(),Ln=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[],declarations:[],exports:[Tn]}]}],e}(),Pn=function(){function e(){}return e.prototype.open=function(e){e.extern&&window.open(e.url,"_blank")},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Dn=function(){function e(e){this.metadataService=e,this._color="primary"}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),e.prototype.openMetadata=function(e){this.metadataService.open(e)},Object.defineProperty(e.prototype,"options",{get:function(){if(this.layer)return this.layer.options},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-metadata-button",template:'<button\r\n  *ngIf="options && options.metadata && options.metadata.url"\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.metadata.show\' | translate"\r\n  [color]="color"\r\n  (click)="openMetadata(options.metadata)">\r\n  <mat-icon svgIcon="information-outline"></mat-icon>\r\n</button>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],e.ctorParameters=function(){return[{type:Pn}]},e.propDecorators={layer:[{type:Se.Input}],color:[{type:Se.Input}]},e}(),jn=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatIconModule,ye.MatButtonModule,ye.MatTooltipModule,Ie.IgoLanguageModule],exports:[Dn],declarations:[Dn]}]}],e}(),kn={None:0,Move:1,Zoom:2,ZoomIfOutMapExtent:3};kn[kn.None]="None",kn[kn.Move]="Move",kn[kn.Zoom]="Zoom",kn[kn.ZoomIfOutMapExtent]="ZoomIfOutMapExtent";var En=function(){function e(){this.features$=new he.BehaviorSubject([[],undefined])}return e.prototype.setFeatures=function(e,t){void 0===t&&(t=kn.None),this.features$.next([e,t])},e.prototype.clear=function(){this.features$.next([[],kn.None])},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Rn=function(){function e(e,t){this.component=e,this.overlayService=t,this.format=new ge}return Object.defineProperty(e.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.features$$=this.overlayService.features$.subscribe(function(e){return t.handleFeatures(e[0],e[1])})},e.prototype.ngOnDestroy=function(){this.features$$.unsubscribe()},e.prototype.handleFeatures=function(e,t){},e.decorators=[{type:Se.Directive,args:[{selector:"[igoOverlay]"}]}],e.ctorParameters=function(){return[{type:ir,decorators:[{type:Se.Self}]},{type:En}]},e}(),_n=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e.decorators=[{type:Se.NgModule,args:[{imports:[],exports:[Rn],declarations:[Rn]}]}],e}(),$n=oe,An=function(){function e(e,t,r){this.messageService=e,this.activityService=t,this.languageService=r}return e.prototype.print=function(t,r){var o=this,n=new he.Subject,e=r.paperFormat,i=+r.resolution,a=r.orientation;this.activityId=this.activityService.register();var s=new re({orientation:a,format:e.toLowerCase()}),l=[s.internal.pageSize.width,s.internal.pageSize.height],u=[20,10,20,10],c=[l[0]-u[3]-u[1],l[1]-u[0]-u[2]];return r.title!==undefined&&this.addTitle(s,r.title,l[0]),!0!==r.showProjection&&!0!==r.showScale||this.addProjScale(s,t,i,r.showProjection,r.showScale),""!==r.comment&&this.addComment(s,r.comment),this.addMap(s,t,i,c,u).subscribe(function(e){e===Oe.SubjectStatus.Done&&(!0===r.showLegend?o.addLegend(s,t,u,i):o.saveDoc(s)),e!==Oe.SubjectStatus.Done&&e!==Oe.SubjectStatus.Error||(o.activityService.unregister(o.activityId),n.next(Oe.SubjectStatus.Done))}),n},e.prototype.getLayersLegendHtml=function(e,t,r){var o="",n=pt(e.layers,e.viewController.getScale(r));return 0===n.length?o:(o+='<style media="screen" type="text/css">',o+=".html2canvas-container { width: "+t,o+="mm !important; height: 2000px !important; }",o+="</style>",o+='<font size="2" face="Courier New" >',o+='<div style="display:inline-block;max-width:'+t+'mm">',n.forEach(function(e){o+='<table border=1 style="display:inline-block;vertical-align:top">',o+='<tr><th width="170px">'+e.title+"</th>",o+='<td><img class="printImageLegend" src="'+e.url+'">',o+="</td></tr></table>"}),o+="</div>")},e.prototype.getLayersLegendImage=function(e,o,n,t){void 0===o&&(o="png");var i=new he.Subject,r=this.getLayersLegendHtml(e,200,t),a=this;o=o.toLowerCase(),0===r.length&&(r='<font size="12" face="Courier New" >',r+='<div align="center"><b>NO LEGEND</b></div>');var s=window.document.createElement("div");window.document.body.appendChild(s),s.innerHTML=r,setTimeout(function(){$n(s,{useCORS:!0}).then(function(e){var t=Oe.SubjectStatus.Done;try{n?a.generateCanvaFileToZip(e,"legendImage."+o):a.saveCanvasImageAsFile(e,"legendImage",o),s.parentNode.removeChild(s)}catch(r){t=Oe.SubjectStatus.Error}i.next(t)})},500)},e.prototype.addTitle=function(e,t,r){var o,n=812.8/96*t.length;o=r<n?0:(r-n)/2,e.setFont("courier"),e.setFontSize(32),e.text(t,o,15)},e.prototype.addComment=function(e,t){var r=e.internal.pageSize.height-5;e.setFont("courier"),e.setFontSize(16),e.text(t,20,r)},e.prototype.addProjScale=function(e,t,r,o,n){var i,a=this.languageService.translate,s=e.internal.pageSize.height-15;!0===o&&(i=a.instant("igo.geo.printForm.projection")+": "+t.projection);!0===n&&(!0===o&&(i+="   "),i+=a.instant("igo.geo.printForm.scale")+" ~ 1 "+Zt(t.viewController.getScale(r)));e.setFont("courier"),e.setFontSize(16),e.text(i,20,s)},e.prototype.addLegend=function(o,e,n,t){var i=this,a=this,r=o.internal.pageSize.width,s=this.getLayersLegendHtml(e,r,t);if(""===s)return this.saveDoc(o),!0;var l=window.document.createElement("div");$n(l,{useCORS:!0}).then(function(e){var t;t=e.toDataURL("image/png"),o.addPage();var r=i.getImageSizeToFitPdf(o,e,n);o.addImage(t,"PNG",10,10,r[0],r[1]),a.saveDoc(o),l.parentNode.removeChild(l)}),window.document.body.appendChild(l),l.innerHTML=s},e.prototype.addCanvas=function(e,t,r){var o;if((o=t.toDataURL("image/jpeg"))!==undefined){var n=this.getImageSizeToFitPdf(e,t,r);e.addImage(o,"JPEG",r[3],r[0],n[0],n[1]),e.rect(r[3],r[0],n[0],n[1])}},e.prototype.addMap=function(i,a,e,t,s){var l,u=this,c=new he.Subject,p=a.ol.getSize(),d=a.ol.getView().calculateExtent(p),r=Math.round(t[0]*e/25.4),o=Math.round(t[1]*e/25.4);return a.ol.once("postcompose",function(e){var o=e.context.canvas,n=a.status$.subscribe(function(e){if(clearTimeout(l),e===Oe.SubjectStatus.Done){n.unsubscribe();var t=Oe.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(r){t=Oe.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(t)}});l=window.setTimeout(function(){n.unsubscribe();var e=Oe.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(t){e=Oe.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(e)},200)}),this.renderMap(a,[r,o],d),c},e.prototype.defineNbFileToProcess=function(e){this.nbFileToProcess=e},e.prototype.downloadMapImage=function(x,M,C,T,L,e,P,D,j){var k=this;void 0===C&&(C="png"),void 0===T&&(T=!1),void 0===L&&(L=!1),void 0===e&&(e=!1),void 0===P&&(P=""),void 0===D&&(D=""),void 0===j&&(j=!0);var E=new he.Subject;this.activityId=this.activityService.register();var R=this.languageService.translate;x.ol.once("postcompose",function(e){C=C.toLowerCase();var t=e.context,r=document.createElement("canvas"),o=r.getContext("2d"),n=0,i=10,a=t.canvas.width,s=t.canvas.height;o.font="20px Calibri";var l=o.measureText(D).width;s=""!==P?s+30:s;var u=(s=!1!==T||!1!==L?s+30:s)-10,c=Math.ceil(l/a),p=(s=""!==D?s+30*c:s)-20*c+5;if(r.width=a,r.height=s,"jpeg"===C&&(o.fillStyle="#ffffff",o.fillRect(0,0,a,s),o.fillStyle="#000000"),""!==P&&(o.font="26px Calibri",n=30,o.textAlign="center",o.fillText(P,a/2,20)),!(o.font="20px Calibri")!==T){var d=R.instant("igo.geo.printForm.projection");o.textAlign="start",o.fillText(d+": "+x.projection,i,u),i+=200}if(!1!==L){var f=R.instant("igo.geo.printForm.scale"),h=x.viewController.getScale(M);o.textAlign="start",o.fillText(f+" ~ 1 : "+Zt(h),i,u)}if(""!==D)if(o.textAlign="center",1===c)o.fillText(D,a/2,p);else for(var g=D.length,y=Math.floor(g/c),m="",v=0,b=void 0,S=0;S<c;S++)S<c-1?(b=(m=D.substr(v,y)).lastIndexOf(" "),o.fillText(m.substr(0,b),a/2,p),v+=b,p+=20):o.fillText(D.substr(v),a/2,p);o.drawImage(t.canvas,0,n);var w=Oe.SubjectStatus.Done;try{j?"tiff"===C.toLowerCase()?k.generateCanvaFileToZip(r,"map"+x.projection.replace(":","_")+"."+C):k.generateCanvaFileToZip(r,"map."+C):k.saveCanvasImageAsFile(r,"map",C)}catch(I){w=Oe.SubjectStatus.Error}if(E.next(w),"tiff"===C.toLowerCase()){var F=k.getWorldFileInformation(x),O=new Blob([F],{type:"text/plain;charset=utf-8"});j?k.addFileToZip("map"+x.projection.replace(":","_")+".tfw",O):(te.saveAs(O,"map"+x.projection+".tfw"),k.saveFileProcessing())}}),x.ol.renderSync()},e.prototype.renderMap=function(e,t,r){e.ol.renderSync()},e.prototype.saveDoc=function(e){e.save("map.pdf")},e.prototype.getImageSizeToFitPdf=function(e,t,r){var o=e.internal.pageSize.getHeight()-(r[0]+r[2]),n=e.internal.pageSize.getWidth()-(r[1]+r[3]),i=t.height,a=t.width,s=i/o,l=a/n,u=l<s?s:l;return[1<u?a/u:a,1<u?i/u:i]},e.prototype.getWorldFileInformation=function(e){var t=e.viewController.getResolution(),r=e.getExtent();return[t,0,0,-t,r[0]+t/.5,r[3]-t/.5].join("\n")},e.prototype.saveCanvasImageAsFile=function(e,t,r){var o="image/"+r,n=this;try{e.toDataURL(),navigator.msSaveBlob?(navigator.msSaveBlob(e.msToBlob(),t+"."+r),this.saveFileProcessing()):e.toBlob(function(e){te.saveAs(e,t+"."+r),n.saveFileProcessing()},o)}catch(i){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},e.prototype.generateCanvaFileToZip=function(e,t){var r=this;this.hasOwnProperty("zipFile")&&"undefined"!=typeof this.zipFile||(this.zipFile=new ne);try{e.toDataURL(),navigator.msSaveBlob?this.addFileToZip(t,e.msToBlob()):e.toBlob(function(e){r.addFileToZip(t,e)},"image/jpeg")}catch(o){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},e.prototype.addFileToZip=function(e,t){this.zipFile.file(e,t),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))},e.prototype.saveFileProcessing=function(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)},e.prototype.getZipFile=function(){var t=this;this.zipFile.generateAsync({type:"blob"}).then(function(e){te.saveAs(e,"map.zip"),delete t.zipFile})},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Ie.MessageService},{type:Ie.ActivityService},{type:Ie.LanguageService}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(Ie.MessageService),Se.inject(Ie.ActivityService),Se.inject(Ie.LanguageService))},token:e,providedIn:"root"}),e}(),Gn=function(){function e(e){this.printService=e,this.disabled=!1}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputFormat",{get:function(){return this._outputFormat},set:function(e){this._outputFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paperFormat",{get:function(){return this._paperFormat},set:function(e){this._paperFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation},set:function(e){this._orientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageFormat",{get:function(){return this._imageFormat},set:function(e){this._imageFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!0,configurable:!0}),e.prototype.handleFormSubmit=function(e){if((this.disabled=!0)===e.isPrintService)this.printService.print(this.map,e).subscribe();else{var t=1;e.showLegend&&t++,"tiff"===e.imageFormat.toLowerCase()&&t++,this.printService.defineNbFileToProcess(t);var r=+e.resolution;this.printService.downloadMapImage(this.map,r,e.imageFormat,e.showProjection,e.showScale,e.showLegend,e.title,e.comment,e.doZipFile),e.showLegend&&this.printService.getLayersLegendImage(this.map,e.imageFormat,e.doZipFile,+r)}this.disabled=!1},e.decorators=[{type:Se.Component,args:[{selector:"igo-print",template:'<igo-print-form\r\n  [outputFormat]="outputFormat"\r\n  [paperFormat]="paperFormat"\r\n  [orientation]="orientation"\r\n  [imageFormat]="imageFormat"\r\n  [resolution]="resolution"\r\n  [disabled]="disabled"\r\n  (submit)="handleFormSubmit($event)">\r\n</igo-print-form>\r\n'}]}],e.ctorParameters=function(){return[{type:An}]},e.propDecorators={map:[{type:Se.Input}],outputFormat:[{type:Se.Input}],paperFormat:[{type:Se.Input}],orientation:[{type:Se.Input}],imageFormat:[{type:Se.Input}],resolution:[{type:Se.Input}]},e}(),qn=Oe.strEnum(["Pdf","Image"]),Bn=Oe.strEnum(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),Nn=Oe.strEnum(["landscape","portrait"]),Wn=Oe.strEnum(["72","96","150","300"]),Vn=Oe.strEnum(["Bmp","Gif","Jpeg","Png","Tiff"]),Un=function(){function e(e){this.formBuilder=e,this.outputFormats=qn,this.paperFormats=Bn,this.orientations=Nn,this.resolutions=Wn,this.imageFormats=Vn,this.isPrintService=!0,this._disabled=!1,this.submit=new Se.EventEmitter,this.form=this.formBuilder.group({title:["",[]],comment:["",[]],outputFormat:["",[fe.Validators.required]],paperFormat:["",[fe.Validators.required]],imageFormat:["",[fe.Validators.required]],resolution:["",[fe.Validators.required]],orientation:["",[fe.Validators.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}return Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageFormat",{get:function(){return this.imageFormatField.value},set:function(e){this.imageFormatField.setValue(e||Vn.Jpeg,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputFormat",{get:function(){return this.outputFormatField.value},set:function(e){this.outputFormatField.setValue(e||qn.Pdf,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paperFormat",{get:function(){return this.paperFormatField.value},set:function(e){this.paperFormatField.setValue(e||Bn.Letter,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientation",{get:function(){return this.orientationField.value},set:function(e){this.orientationField.setValue(e||Nn.landscape,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this.resolutionField.value},set:function(e){this.resolutionField.setValue(e||Wn[96],{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this.titleField.value},set:function(e){this.titleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"comment",{get:function(){return this.commentField.value},set:function(e){this.commentField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showProjection",{get:function(){return this.showProjectionField.value},set:function(e){this.showProjectionField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showScale",{get:function(){return this.showScaleField.value},set:function(e){this.showScaleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showLegend",{get:function(){return this.showLegendField.value},set:function(e){this.showLegendField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doZipFile",{get:function(){return this.doZipFileField.value},set:function(e){this.doZipFileField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputFormatField",{get:function(){return this.form.controls.outputFormat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paperFormatField",{get:function(){return this.form.controls.paperFormat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageFormatField",{get:function(){return this.form.controls.imageFormat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"orientationField",{get:function(){return this.form.controls.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolutionField",{get:function(){return this.form.controls.resolution},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"commentField",{get:function(){return this.form.controls.comment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showProjectionField",{get:function(){return this.form.controls.showProjection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showScaleField",{get:function(){return this.form.controls.showScale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showLegendField",{get:function(){return this.form.controls.showLegend},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doZipFileField",{get:function(){return this.form.controls.doZipFile},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleField",{get:function(){return this.form.controls.title},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.doZipFileField.setValue(!1)},e.prototype.handleFormSubmit=function(e,t){this.submitted=!0,e.isPrintService=this.isPrintService,t&&this.submit.emit(e)},e.prototype.toggleImageSaveProp=function(){"Image"===this.outputFormatField.value?this.isPrintService=!1:this.isPrintService=!0},e.decorators=[{type:Se.Component,args:[{selector:"igo-print-form",template:'<form class="igo-form" [formGroup]="form">\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="title"\r\n        placeholder="{{\'igo.geo.printForm.title\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="comment"\r\n        placeholder="{{\'igo.geo.printForm.comment\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <div class="print-slide-toggle-container">\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showProjection"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showProjection\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showScale"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showScale\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showLegend"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showLegend\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="doZipFile"\r\n        [labelPosition]="\'before\'"\r\n        [style.display]="isPrintService ? \'none\' : \'\'">\r\n        {{\'igo.geo.printForm.doZipFile\' | translate}}\r\n      </mat-slide-toggle>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <mat-select (selectionChange)="toggleImageSaveProp()"\r\n        formControlName="outputFormat"\r\n        placeholder="{{\'igo.geo.printForm.outputFormat\' | translate}}">\r\n        <mat-option *ngFor="let outputFormat of outputFormats | keyvalue " [value]="outputFormat.key">\r\n            {{outputFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="paperFormat"\r\n        placeholder="{{\'igo.geo.printForm.paperFormat\' | translate}}">\r\n        <mat-option *ngFor="let paperFormat of paperFormats | keyvalue " [value]="paperFormat.key">\r\n          {{(\'igo.geo.printForm.paperFormats.\' + paperFormat.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'none\' : \'block\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="imageFormat"\r\n        placeholder="{{\'igo.geo.printForm.imageFormat\' | translate}}">\r\n        <mat-option *ngFor="let imageFormat of imageFormats | keyvalue " [value]="imageFormat.key">\r\n          {{imageFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" style="display: none;">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="resolution"\r\n        placeholder="{{\'igo.geo.printForm.resolution\' | translate}}">\r\n        <mat-option *ngFor="let resolution of resolutions | keyvalue " [value]="resolution.key">\r\n          {{resolution.value + \' PPI\'}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="orientation"\r\n        placeholder="{{\'igo.geo.printForm.orientation\' | translate}}">\r\n        <mat-option *ngFor="let orientation of orientations | keyvalue " [value]="orientation.key">\r\n          {{(\'igo.geo.printForm.\' + orientation.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-form-button-group print-button-top-padding">\r\n    <button\r\n      mat-raised-button\r\n      type="button"\r\n      [disabled]="!form.valid || disabled"\r\n      (click)="handleFormSubmit(form.value, form.valid)">\r\n      {{\'igo.geo.printForm.saveBtn\' | translate}}\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n',styles:["mat-form-field{width:100%}.print-slide-toggle-container{overflow-x:hidden}.print-slide-toggle-container mat-slide-toggle{width:100%;margin:10px}.print-slide-toggle-container mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px);font-size:16px}.print-option{display:block;margin-right:10px;margin-bottom:15px}.print-button-top-padding{padding-top:25px}.igo-form{padding:10px 5px 5px}.igo-form-button-group{text-align:center}"]}]}],e.ctorParameters=function(){return[{type:fe.FormBuilder}]},e.propDecorators={disabled:[{type:Se.Input}],imageFormat:[{type:Se.Input}],outputFormat:[{type:Se.Input}],paperFormat:[{type:Se.Input}],orientation:[{type:Se.Input}],resolution:[{type:Se.Input}],title:[{type:Se.Input}],comment:[{type:Se.Input}],showProjection:[{type:Se.Input}],showScale:[{type:Se.Input}],showLegend:[{type:Se.Input}],doZipFile:[{type:Se.Input}],submit:[{type:Se.Output}]},e}(),zn=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,fe.FormsModule,fe.ReactiveFormsModule,ye.MatIconModule,ye.MatButtonModule,ye.MatSelectModule,ye.MatOptionModule,ye.MatInputModule,ye.MatFormFieldModule,ye.MatSlideToggleModule,Ie.IgoLanguageModule,ve.IgoKeyValueModule],exports:[Gn,Un],declarations:[Gn,Un]}]}],e}();function Kn(e){return new Fr(e.getConfig("searchSources."+Fr.id)||{})}function Hn(){return{provide:wr,useFactory:Kn,multi:!0,deps:[Ie.ConfigService]}}var Qn=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[Hn()]}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule],exports:[Sr],declarations:[Sr],providers:[br]}]}],e}(),Yn=function(){function e(e){this.sources=e}return e.prototype.getSources=function(){return this.sources},e.prototype.getEnabledSources=function(){return this.getSources().filter(function(e){return!0===e.enabled})},e.prototype.enableSourcesByType=function(t){this.getSources().forEach(function(e){e.constructor.type===t?e.enabled=!0:e.enabled=!1})},e}();function Zn(e){return e.search!==undefined}function Jn(e){return e.reverseSearch!==undefined}var Xn=function(){function e(e){this.searchSourceService=e}return e.prototype.search=function(e,t){if(!this.termIsValid(e))return[];var r=Qt(e);if(r!==undefined)return this.reverseSearch(r);var o=this.searchSourceService.getEnabledSources().filter(Zn);return this.searchSources(o,e,t||{})},e.prototype.reverseSearch=function(e,t){var r=this.searchSourceService.getEnabledSources().filter(Jn);return this.reverseSearchSources(r,e,t||{})},e.prototype.searchSources=function(e,t,r){return e.map(function(e){return{request:e.search(t,r),reverse:!1,source:e}})},e.prototype.reverseSearchSources=function(e,t,r){return e.map(function(e){return{request:e.reverseSearch(t,r),reverse:!0,source:e}})},e.prototype.termIsValid=function(e){return"string"==typeof e&&""!==e},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Yn}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(Yn))},token:e,providedIn:"root"}),e}(),ei=function(){},ti=function(e){this.sources=e};function ri(e){return new ti(e)}function oi(){return{provide:ti,useFactory:ri,deps:[ei]}}var ni=function(){function e(e){this.routingSourceService=e}return e.prototype.route=function(t){var r=this;if(0!==t.length)return this.routingSourceService.sources.filter(function(e){return e.enabled}).map(function(e){return r.routeSource(e,t)})},e.prototype.routeSource=function(e,t){return e.route(t)},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:ti}]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e(Se.inject(ti))},token:e,providedIn:"root"}),e}(),ii=function(){function e(){this.mapWaitingForRoutingClick=!1}return e.prototype.getStopsCoordinates=function(){return this.stopsCoordinates},e.prototype.setStopsCoordinates=function(e){this.stopsCoordinates=e},e.prototype.isMapWaitingForRoutingClick=function(){return this.mapWaitingForRoutingClick},e.prototype.setMapWaitingForRoutingClick=function(){this.mapWaitingForRoutingClick=!0},e.prototype.unsetMapWaitingForRoutingClick=function(){this.mapWaitingForRoutingClick=!1},e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[]},e}(),ai=function(){function e(e,t,r,o,n,i,a,s){this.formBuilder=e,this.routingService=t,this.languageService=r,this.messageService=o,this.searchService=n,this.queryService=i,this.routingFormService=a,this.route=s,this.invalidKeys=["Control","Shift","Alt"],this.projection="EPSG:4326",this.routesQueries$$=[],this.stream$=new he.Subject,this.focusOnStop=!1,this.focusKey=[],this._term="",this._debounce=300,this._length=3,this.submit=new Se.EventEmitter}return Object.defineProperty(e.prototype,"term",{get:function(){return this._term},set:function(e){this._term=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debounce",{get:function(){return this._debounce},set:function(e){this._debounce=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(e){this._length=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),e.prototype.changeRoute=function(e){this.showRouteGeometry()},e.prototype.ngOnDestroy=function(){this.unsubscribeRoutesQueries(),this.unlistenSingleClick(),this.queryService.queryEnabled=!0;var t=[];this.stops.value.forEach(function(e){t.push(e.stopCoordinates)}),this.routingRoutesOverlayDataSource.ol.clear(),this.routingStopsOverlayDataSource.ol.clear(),this.routingFormService.setStopsCoordinates(t)},e.prototype.ngOnInit=function(){this.browserLanguage=this.languageService.getLanguage(),this.stopsForm=this.formBuilder.group({routingType:"car",routingMode:"driving",stopOrderPriority:!0,routingFixedStartEnd:!1,stops:this.formBuilder.array([this.createStop("start"),this.createStop("end")])}),this.routingStopsOverlayDataSource=new Be({}),this.routingRoutesOverlayDataSource=new Be({})},e.prototype.ngAfterViewInit=function(){var n=this;this.queryService.queryEnabled=!1,this.focusOnStop=!1;var t,e=new ht({title:"routingStopOverlay",zIndex:999,id:"routingStops",source:this.routingStopsOverlayDataSource,showInLayerList:!1}),r=new ht({title:"routingRoutesOverlay",zIndex:999,id:"routingRoutes",opacity:.75,source:this.routingRoutesOverlayDataSource,showInLayerList:!1});this.map.addLayer(r),this.map.addLayer(e);var o=new ce.Select({layers:[e.ol],condition:ue.pointerMove,hitTolerance:7}),i=new ce.Translate({layers:[e.ol],features:t}),a=new ce.Select({layers:[r.ol],condition:ue.pointerMove,hitTolerance:7});this.selectRoute=new ce.Select({layers:[r.ol],hitTolerance:7}),this.map.ol.on("pointermove",function(e){0===a.getFeatures().getLength()?n.routingFormService.unsetMapWaitingForRoutingClick():n.routingFormService.setMapWaitingForRoutingClick()}),o.on("select",function(e){t=e.target.getFeatures()[0]}),this.selectRoute.on("select",function(e){if(!1===n.focusOnStop){var t=se.transform(e.mapBrowserEvent.coordinate,n.map.projection,n.projection);n.addStop();var r=n.stops.length-2;n.stops.at(r).patchValue({stopCoordinates:t}),n.handleLocationProposals(t,r),n.addStopOverlay(t,r),n.selectRoute.getFeatures().clear()}n.selectRoute.getFeatures().clear()}),this.routesQueries$$.push(this.stopsForm.statusChanges.pipe(Fe.debounceTime(this._debounce)).subscribe(function(e){return n.onFormChange()})),i.on("translateend",function(e){var t,r=e.features.getArray()[0].getId().split("_");switch(r[1]){case"start":t=0;break;case"end":t=n.stops.length-1;break;default:t=Number(r[1])}var o=se.transform(e.features.getArray()[0].getGeometry().getCoordinates(),n.map.projection,n.projection);n.stops.at(t).patchValue({stopCoordinates:o}),n.stops.at(t).patchValue({stopProposals:[]}),n.handleLocationProposals(o,t)}),this.map.ol.addInteraction(o),this.map.ol.addInteraction(a),this.map.ol.addInteraction(this.selectRoute),this.map.ol.addInteraction(i),this.routesQueries$$.push(this.stream$.pipe(Fe.debounceTime(this._debounce),Fe.distinctUntilChanged()).subscribe(function(e){return n.handleTermChanged(e)}))},e.prototype.handleLocationProposals=function(o,n){var i=this,a=[];this.searchService.reverseSearch(o,{zoom:this.map.getZoom()}).map(function(e){return i.routesQueries$$.push(e.request.pipe(Fe.map(function(e){return e})).subscribe(function(e){if(e.forEach(function(t){0===a.filter(function(e){return e.source===t.source}).length&&a.push({source:t.source,results:e.map(function(e){return e.data})})}),i.stops.at(n).patchValue({stopProposals:a}),e[0]){if("icherchereverse"===e[0].source.getId()){for(var t=0,r=0;r<e.length;r++){if("adresse"===e[r].data.properties.type){t=r;break}}i.stops.at(n).patchValue({stopPoint:ve.getEntityTitle(e[t])}),"Point"===e[t].data.geometry.type&&i.stops.at(n).patchValue({stopCoordinates:e[t].data.geometry.coordinates})}}else i.stops.at(n).patchValue({stopPoint:o}),i.stops.at(n).patchValue({stopProposals:[]})}))})},e.prototype.routingText=function(e){return 0===e?"start":e===this.stops.length-1||1===this.stops.length?"end":"intermediate"},e.prototype.raiseStop=function(e){0<e&&this.moveStop(e,-1)},e.prototype.lowerStop=function(e){e<this.stops.length-1&&this.moveStop(e,1)},e.prototype.moveStop=function(e,t){var r=this.stops.at(e);this.removeStop(e),this.stops.insert(e+t,r),this.stops.at(e).patchValue({routingText:this.routingText(e)}),this.stops.at(e+t).patchValue({routingText:this.routingText(e+t)}),this.stops.at(e).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e).value.stopCoordinates,e),this.stops.at(e+t).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e+t).value.stopCoordinates,e+t)},Object.defineProperty(e.prototype,"stops",{get:function(){return this.stopsForm.get("stops")},enumerable:!0,configurable:!0}),e.prototype.getStopsCoordinates=function(){var t=[];return this.stops.value.forEach(function(e){e.stopCoordinates instanceof Array&&t.push(e.stopCoordinates)}),this.routingFormService.setStopsCoordinates(t),t},e.prototype.addStop=function(){var e=this.stops.length-1;this.stops.insert(e,this.createStop())},e.prototype.createStop=function(e){return void 0===e&&(e="intermediate"),this.formBuilder.group({stopPoint:[""],stopProposals:[[]],routingText:e,stopCoordinates:["",[fe.Validators.required]]})},e.prototype.removeStop=function(e){var t=this;this.routingStopsOverlayDataSource.ol.clear(),this.stops.removeAt(e);var r=0;this.stops.value.forEach(function(e){t.stops.at(r).patchValue({routingText:t.routingText(r)}),t.addStopOverlay(t.stops.at(r).value.stopCoordinates,r),r++})},e.prototype.resetForm=function(){var t=this;this.routesResults=undefined;for(var e=this.stops.length,r=0;r<e;r++)this.stops.removeAt(0);this.stops.insert(0,this.createStop("start")),this.stops.insert(1,this.createStop("end")),this.routingStopsOverlayDataSource.ol.getFeatures().forEach(function(e){t.deleteRoutingOverlaybyID(e.getId())}),this.routingRoutesOverlayDataSource.ol.clear(),this.routingStopsOverlayDataSource.ol.clear(),this.selectRoute.getFeatures().clear()},e.prototype.onFormChange=function(){if(this.stopsForm.valid){this.routingRoutesOverlayDataSource.ol.clear();var e=this.getStopsCoordinates();2<=e.length?this.getRoutes(e):this.routingRoutesOverlayDataSource.ol.clear()}},e.prototype.formatStep=function(e,t){return this.formatInstruction(e.maneuver.type,e.maneuver.modifier,e.name,e.maneuver.bearing_after,t,e.maneuver.exit,t===this.activeRoute.steps.length-1)},e.prototype.formatInstruction=function(e,t,r,o,n,i,a){var s,l;void 0===a&&(a=!1);var u,c="arrow_forward",p="rotate-270",d=this.translateBearing(o),f=this.translateModifier(t),h=("straight"===t?"":" ")+f,g=("straight"===t?"":"on the ")+f;if(t&&0<=t.search("slight")&&(g=f),"uturn"===t?(c="fast_forward",p="rotate-90"):"sharp right"===t?(c="subdirectory_arrow_right",p="icon-flipped"):"right"===t?(c="subdirectory_arrow_right",p="icon-flipped"):"slight right"===t?(c="arrow_forward",p="rotate-290"):"straight"===t?c="arrow_forward":"slight left"===t?(c="arrow_forward",p="rotate-250"):"left"===t?(c="subdirectory_arrow_left",p="icon-flipped"):"sharp left"===t&&(c="subdirectory_arrow_left",p="icon-flipped"),"turn"===e)"straight"===t?(s="Continuer sur "+r,l="Continue on "+r):"uturn"===t?(s="Faire demi-tour sur "+r,l="Make u-turn on "+r):(s="Tourner "+h+" sur "+r,l="Turn "+f+" onto "+r);else if("new name"===e)s="Continuer en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="explore",p="";else if("depart"===e)s="Aller en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="explore",p="";else if("arrive"===e)if(a){var y=", ";f||(y=g=h=""),s="Vous tes arriv"+y+h,l="You have reached your destination"+y+g}else s="Vous atteignez le point intermdiare sur "+r,l="You have reached the intermediate stop onto "+r,c="location_on",p="";else"merge"===e?(s="Continuer sur "+r,l="Continue on "+r,c="arrow_forward",p="rotate-270"):"on ramp"===e?(s="Prendre l'entre d'autoroute "+h,l="Take the ramp "+g):"off ramp"===e?(s="Prendre la sortie d'autoroute "+h,l="Take exit "+g):"fork"===e?0<=t.search("left")?(s="Garder la gauche sur "+r,l="Merge left onto "+r):0<=t.search("right")?(s="Garder la droite sur "+r,l="Merge right onto "+r):(s="Continuer sur "+r,l="Continue on "+r):"end of road"===e?(s=" la fin de la route, tourner "+f+" sur "+r,l="At the end of the road, turn "+f+" onto "+r):"use lane"===e?(s="Prendre la voie de ... ",l="Take the lane ..."):"continue"===e&&"uturn"!==t?(s="Continuer sur "+r,l="Continue on "+r,c="arrow_forward",p="rotate-270"):"roundabout"===e?(s="Au rond-point, prendre la "+i,s+=1===i?"re":"e",s+=" sortie vers "+r,l="At the roundabout, take the "+i,l+=1===i?"st":"rd",l+=" exit towards "+r,c="donut_large",p=""):"rotary"===e?(s="Rond-point rotary....",l="Roundabout rotary....",c="donut_large",p=""):"roundabout turn"===e?(s="Rond-point, prendre la ...",l="Roundabout, take the ...",c="donut_large",p=""):"exit roundabout"===e?(s="Poursuivre vers "+r,l="Continue to "+r,c="arrow_forward",p="rotate-270"):"notification"===e?l=s="notification ....":"uturn"===t?(s="Faire demi-tour et continuer en direction "+d+" sur "+r,l="Make u-turn and head "+d+" on "+r):l=s="???";return a&&(c="flag",p=""),0===n&&(c="explore",p=""),"fr"===this.browserLanguage?u=s:"en"===this.browserLanguage&&(u=l),{instruction:u,image:c,cssClass:p}},e.prototype.translateModifier=function(e){return"uturn"===e?this.languageService.translate.instant("igo.geo.routing.uturn"):"sharp right"===e?this.languageService.translate.instant("igo.geo.routing.sharp right"):"right"===e?this.languageService.translate.instant("igo.geo.routing.right"):"slight right"===e?this.languageService.translate.instant("igo.geo.routing.slight right"):"sharp left"===e?this.languageService.translate.instant("igo.geo.routing.sharp left"):"left"===e?this.languageService.translate.instant("igo.geo.routing.left"):"slight left"===e?this.languageService.translate.instant("igo.geo.routing.slight left"):"straight"===e?this.languageService.translate.instant("igo.geo.routing.straight"):e},e.prototype.translateBearing=function(e){return 337<=e||e<23?this.languageService.translate.instant("igo.geo.cardinalPoints.n"):e<67?this.languageService.translate.instant("igo.geo.cardinalPoints.ne"):e<113?this.languageService.translate.instant("igo.geo.cardinalPoints.e"):e<157?this.languageService.translate.instant("igo.geo.cardinalPoints.se"):e<203?this.languageService.translate.instant("igo.geo.cardinalPoints.s"):e<247?this.languageService.translate.instant("igo.geo.cardinalPoints.sw"):e<293?this.languageService.translate.instant("igo.geo.cardinalPoints.w"):e<337?this.languageService.translate.instant("igo.geo.cardinalPoints.nw"):void 0},e.prototype.formatDistance=function(e){if(0!==e)return 1e5<=e?Math.round(e/1e3)+" km":1e4<=e?Math.round(e/100)/10+" km":100<=e?Math.round(e/100)/10+" km":e+" m"},e.prototype.formatDuration=function(e,t){if(void 0===t&&(t=!1),3600<=e){var r=Math.floor(e/3600),o=Math.round(60*(e/3600-r));return 60===o?r+1+" h":r+" h "+o+" min"}return 60<=e?Math.round(e/60)+" min":e+" s"},e.prototype.showSegment=function(e,t){void 0===t&&(t=!1),this.showRouteSegmentGeometry(e.geometry.coordinates,t)},e.prototype.showRouteSegmentGeometry=function(e,t){void 0===t&&(t=!1),this.deleteRoutingOverlaybyID("endSegment");var r=new ae.LineString(e).transform("EPSG:4326","EPSG:3857").getCoordinates()[0],o=new ae.Point(r),n=new ie({geometry:o});n.setId("endSegment"),null!==o&&("Point"===o.getType()&&n.setStyle([new le.Style({geometry:o,image:new le.Circle({radius:7,stroke:new le.Stroke({color:"#FF0000",width:3})})})]),t&&this.map.viewController.zoomToExtent(n.getGeometry().getExtent()),this.routingRoutesOverlayDataSource.ol.addFeature(n))},e.prototype.zoomRoute=function(){this.map.viewController.zoomToExtent(this.routingRoutesOverlayDataSource.ol.getExtent())},e.prototype.showRouteGeometry=function(e){void 0===e&&(e=!1);var t=this.activeRoute.geometry.coordinates,r=new ae.LineString(t).transform("EPSG:4326","EPSG:3857");this.routingRoutesOverlayDataSource.ol.clear();var o=new ie({geometry:r});o.setStyle([new le.Style({stroke:new le.Stroke({color:"#6a7982",width:10})}),new le.Style({stroke:new le.Stroke({color:"#4fa9dd",width:6})})]),this.routingRoutesOverlayDataSource.ol.addFeature(o),e&&this.map.viewController.zoomToExtent(this.routingRoutesOverlayDataSource.ol.getExtent())},e.prototype.getRoutes=function(e,t){var r=this;void 0===t&&(t=!1);var o=this.routingService.route(e);o&&o.map(function(e){return r.routesQueries$$.push(e.subscribe(function(e){r.routesResults=e,r.activeRoute=r.routesResults[0],r.showRouteGeometry(t)}))})},e.prototype.unlistenSingleClick=function(){0!==this.focusKey.length&&this.focusKey.forEach(function(e){de.unByKey(e)})},e.prototype.unsubscribeRoutesQueries=function(){this.routesQueries$$.forEach(function(e){return e.unsubscribe()}),this.routesQueries$$=[]},e.prototype.copyLinkToClipboard=function(){if(Oe.Clipboard.copy(this.getUrl())){var e=this.languageService.translate,t=e.instant("igo.geo.routingForm.dialog.copyTitle"),r=e.instant("igo.geo.routingForm.dialog.copyMsgLink");this.messageService.success(r,t)}},e.prototype.copyDirectionsToClipboard=function(){var o=this,n="\t",i=this.languageService.translate.instant("igo.geo.routingForm.instructions")+":\n",a="",e=this.languageService.translate.instant("igo.geo.routingForm.summary")+": \n"+n+this.activeRoute.title+"\n"+n+this.formatDistance(this.activeRoute.distance)+"\n"+n+this.formatDuration(this.activeRoute.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.routingForm.stopsList")+":\n",t=this.languageService.translate.instant("igo.geo.routingForm.link")+":\n"+n+this.getUrl(),s=1;this.stops.value.forEach(function(e){var t="",r="";e.stopPoint!==e.stopCoordinates?(r=e.stopPoint,t=" ("+[e.stopCoordinates[1],e.stopCoordinates[0]].join(",")+")"):r=[e.stopCoordinates[1],e.stopCoordinates[0]].join(","),a=a+n+s.toLocaleString()+". "+r+t+"\n",s++});var l=0;this.activeRoute.steps.forEach(function(e){var t=o.formatStep(e,l).instruction,r=o.formatDistance(e.distance)===undefined?"":" ("+o.formatDistance(e.distance)+")";i=i+n+(l+1).toLocaleString()+". "+t+r+"\n",l++});var r=e+a+"\n"+t+"\n\n"+i;if(Oe.Clipboard.copy(r)){var u=this.languageService.translate,c=u.instant("igo.geo.routingForm.dialog.copyTitle"),p=u.instant("igo.geo.routingForm.dialog.copyMsg");this.messageService.success(p,c)}},e.prototype.handleTermChanged=function(e){var t=this;if(e!==undefined||0!==e.length){var r=[];this.searchService.search(e).map(function(e){return t.routesQueries$$.push(e.request.subscribe(function(e){e.filter(function(e){return e.data.geometry}).forEach(function(t){0===r.filter(function(e){return e.source===t.source}).length&&r.push({source:t.source,results:e.map(function(e){return e.data})})}),t.stops.at(t.currentStopIndex).patchValue({stopProposals:r})}))})}},e.prototype.setTerm=function(e){this.term=e,this.keyIsValid(e)&&(e.length>=this.length||0===e.length)&&this.stream$.next(e)},e.prototype.keyIsValid=function(t){return this.invalidKeys.find(function(e){return e===t})===undefined},e.prototype.keyup=function(t,e){var r=this,o=e.target.value;this.setTerm(o),this.map.ol.un("singleclick",function(e){r.handleMapClick(e,t)})},e.prototype.clearStop=function(e){this.deleteRoutingOverlaybyID(this.getStopOverlayID(e)),this.stops.removeAt(e),this.stops.insert(e,this.createStop(this.routingText(e))),this.routingRoutesOverlayDataSource.ol.clear()},e.prototype.chooseProposal=function(e,t){if(e!==undefined){var r=void 0,o=e.geometry;if("Point"===o.type)r=o.coordinates;else if(0<=o.type.search("Line")){var n=[];r=(n=o.coordinates instanceof Array?o.coordinates[Math.floor(o.coordinates.length/2)]:o.coordinates)[Math.floor(n.length/2)]}else if(0<=o.type.search("Polygon")){var i=e.extent;r=[i[0]+(i[2]-i[0])/2,i[1]+(i[3]-i[1])/2]}if(r!==undefined){this.stops.at(t).patchValue({stopCoordinates:r}),this.addStopOverlay(r,t);var a=this.routingStopsOverlayDataSource.ol.getFeatureById(this.getStopOverlayID(t)).getGeometry().getExtent();pe.intersects(a,this.map.getExtent())||this.map.viewController.moveToExtent(a)}}},e.prototype.focus=function(t){var r=this;this.unlistenSingleClick(),this.currentStopIndex=t,this.focusOnStop=!0,this.routingFormService.setMapWaitingForRoutingClick(),this.focusKey.push(this.map.ol.once("singleclick",function(e){r.handleMapClick(e,t)}))},e.prototype.handleMapClick=function(e,t){var r=this;this.stops.at(t).patchValue({stopProposals:[]}),this.currentStopIndex===undefined?(this.addStop(),t=this.stops.length-2,this.stops.at(t).value.stopProposals=[]):t=this.currentStopIndex;var o=se.transform(e.coordinate,this.map.projection,this.projection);this.stops.at(t).patchValue({stopCoordinates:o}),this.handleLocationProposals(o,t),this.addStopOverlay(o,t),setTimeout(function(){r.focusOnStop=!1},500),this.routingFormService.unsetMapWaitingForRoutingClick()},e.prototype.geolocateStop=function(e){Gt(this.map,[this.map.geolocationFeature],it.Move);var t=this.map.getCenter(this.projection);this.stops.at(e).patchValue({stopCoordinates:t}),this.addStopOverlay(t,e),this.handleLocationProposals(t,e)},e.prototype.addStopOverlay=function(e,t){var r,o=this.routingText(t);"start"===o?(r="green",this.languageService.translate.instant("igo.geo.routingForm.start")):"end"===o?(r="red",this.languageService.translate.instant("igo.geo.routingForm.end")):(r="yellow",this.languageService.translate.instant("igo.geo.routingForm.intermediate"));var n=new ae.Point(se.transform(e,this.projection,this.map.projection)),i=new ie({geometry:n}),a=this.getStopOverlayID(t);if(this.deleteRoutingOverlaybyID(a),i.setId(a),null!==n){if("Point"===n.getType()){var s=Vt(r);i.setStyle(s)}this.routingStopsOverlayDataSource.ol.addFeature(i)}},e.prototype.getStopOverlayID=function(e){return"routingStop_"+(0===e?"start":e===this.stops.length-1?"end":e)},e.prototype.deleteRoutingOverlaybyID=function(e){this.routingStopsOverlayDataSource.ol.getFeatureById(e)&&this.routingStopsOverlayDataSource.ol.removeFeature(this.routingStopsOverlayDataSource.ol.getFeatureById(e)),this.routingRoutesOverlayDataSource.ol.getFeatureById(e)&&this.routingRoutesOverlayDataSource.ol.removeFeature(this.routingRoutesOverlayDataSource.ol.getFeatureById(e))},e.prototype.getUrl=function(){if(this.route){var e=this.route.options.routingCoordKey,t=[];this.routingFormService&&this.routingFormService.getStopsCoordinates()&&0!==this.routingFormService.getStopsCoordinates().length&&this.routingFormService.getStopsCoordinates().forEach(function(e){t.push(e)});var r="";return 2<=t.length&&(r=e+"="+t.join(";")),""+location.origin+location.pathname+"?tool=directions&"+r}},e.decorators=[{type:Se.Component,args:[{selector:"igo-routing-form",template:'<form class="igo-form" [formGroup]="stopsForm">\r\n  \x3c!-- <div class="igo-form-button-group">\r\n\r\n  </div> --\x3e\r\n  <div #inputs formArrayName="stops" *ngFor="let stop of stops.controls; let i = index;">\r\n    <mat-list-item [formGroupName]="i">\r\n\r\n      <div class="igo-input-container">\r\n        <button *ngIf="map.geolocationFeature" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.geolocate\' | translate" (click)="geolocateStop(i)">\r\n          <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n        </button>\r\n        <mat-form-field>\r\n          <input matInput formControlName="stopPoint" [matAutocomplete]="auto" placeholder="{{\'igo.geo.routingForm.\'+stop.value.routingText | translate}}"\r\n            (focus)="focus(i)" (keyup)="keyup(i,$event)">\r\n\r\n          <mat-autocomplete #auto="matAutocomplete">\r\n            <mat-optgroup *ngFor="let source of stop.value.stopProposals" [label]="source.source" [disabled]="source.disabled">\r\n              <mat-option *ngFor="let result of source.results" [value]="result.title" (onSelectionChange)="chooseProposal(result,i)">\r\n                {{ result.title }}\r\n              </mat-option>\r\n            </mat-optgroup>\r\n          </mat-autocomplete>\r\n        </mat-form-field>\r\n        <button mat-button *ngIf="stop.value && (stop.value.stopPoint.length>0 || stop.value.stopProposals.length>0)" matSuffix mat-icon-button\r\n          aria-label="Clear" (click)="clearStop(i)">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n        \x3c!-- <div class="igo-form-button-group"> --\x3e\r\n\r\n\r\n          \x3c!-- <button *ngIf="i !== 0" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.raiseStop\' | translate"\r\n            [color]="color" (click)="raiseStop(i)">\r\n            <mat-icon svgIcon="arrow-upward"></mat-icon>\r\n          </button>\r\n          <button *ngIf="i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.lowerStop\' | translate"\r\n            [color]="color" (click)="lowerStop(i)">\r\n            <mat-icon svgIcon="arrow-downward"></mat-icon>\r\n          </button> --\x3e\r\n\r\n          <button *ngIf="i !== 0 && i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.removeStop\' | translate"\r\n            color="warn" (click)="removeStop(i)">\r\n            <mat-icon svgIcon="delete"></mat-icon>\r\n          </button>\r\n        \x3c!-- </div> --\x3e\r\n      </div>\r\n\r\n    </mat-list-item>\r\n  </div>\r\n  <div class="igo-form-button-group">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.routingForm.zoomRoute\' | translate"\r\n      *ngIf="routesResults" color="primary" (click)="zoomRoute()">\r\n      <mat-icon svgIcon="zoom-in"></mat-icon>\r\n    </button>\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.addStop\' | translate"\r\n      color="primary" (click)="addStop()">\r\n      <mat-icon svgIcon="map-marker-plus"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.resetRoutingBtn\' | translate"\r\n      *ngIf="routesResults" color="warn" (click)="resetForm()">\r\n      <mat-icon svgIcon="restore-page"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.copy\' | translate"\r\n      color="primary" (click)="copyDirectionsToClipboard()">\r\n      <mat-icon svgIcon="content-copy"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.routingForm.link\' | translate"\r\n    color="primary" (click)="copyLinkToClipboard()">\r\n    <mat-icon svgIcon="link"></mat-icon>\r\n  </button>\r\n  </div>\r\n\r\n</form>\r\n\r\n<div class="igo-input-container" *ngIf="routesResults">\r\n  <mat-form-field *ngIf="routesResults && routesResults.length > 1">\r\n    <mat-select placeholder="{{\'igo.geo.routingForm.drivingOptions\' | translate}}" (selectionChange)="changeRoute($event)" [(ngModel)]="activeRoute">\r\n      <mat-option *ngFor="let pathRouting of routesResults; let cnt = index;" [value]="pathRouting">\r\n        Option {{cnt + 1}} : {{this.formatDistance(pathRouting.distance)}} ({{this.formatDuration(pathRouting.duration)}})\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf="routesResults && routesResults.length === 0"></mat-divider>\r\n\r\n  <mat-list>\r\n    <h3 mat-header>{{activeRoute.title}}</h3>\r\n    <h3 mat-subheader>{{this.formatDistance(activeRoute.distance)}}, {{this.formatDuration(activeRoute.duration)}}</h3>\r\n\r\n    <mat-list-item (mouseenter)="showSegment(step)" (click)="showSegment(step,true)" *ngFor="let step of activeRoute.steps; let cnt = index;"\r\n      igoListItem>\r\n      <mat-icon [ngClass]="this.formatStep(step,cnt).cssClass" mat-list-icon svgIcon="{{this.formatStep(step,cnt).image}}"></mat-icon>\r\n\r\n      <h4 mat-line (click)="showSegment(step,true)">{{cnt +1}}. {{this.formatStep(step,cnt).instruction}}</h4>\r\n      <h4 mat-line class="right">{{this.formatDistance(step.distance)}}</h4>\r\n    </mat-list-item>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n  </mat-list>\r\n\r\n</div>\r\n',styles:["mat-form-field{width:70%}.mat-list-item{height:auto}.mat-line{word-wrap:break-word!important;white-space:pre-wrap!important}.mat-line.right{text-align:right}.rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-45{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-250{-webkit-transform:rotate(250deg);transform:rotate(250deg)}.rotate-290{-webkit-transform:rotate(290deg);transform:rotate(290deg)}.icon-flipped{-webkit-transform:scaleY(-1);transform:scaleY(-1)}"]}]}],e.ctorParameters=function(){return[{type:fe.FormBuilder},{type:ni},{type:Ie.LanguageService},{type:Ie.MessageService},{type:Xn},{type:br},{type:ii},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},e.propDecorators={term:[{type:Se.Input}],length:[{type:Se.Input}],map:[{type:Se.Input}],submit:[{type:Se.Output}]},e}(),si=function(){function e(e,t,r){this.component=e,this.routingFormService=t,this.route=r}return e.prototype.ngAfterViewInit=function(){var i=this,e=this.routingFormService.getStopsCoordinates();if(!e&&this.route&&this.route.options.routingCoordKey)this.route.queryParams.subscribe(function(e){var t=e[i.route.options.routingCoordKey],r=[];if(t){var o=t.split(";");if(2<=o.length){var n=0;o.forEach(function(e){0!==n&&n!==o.length-1&&i.component.stops.insert(n,i.component.createStop());var t=JSON.parse("["+e+"]");i.component.stops.at(n).patchValue({stopCoordinates:t}),i.component.stops.at(n).patchValue({stopPoint:t}),i.component.handleLocationProposals(t,n),r.push(t),i.component.addStopOverlay(t,n),n++}),i.component.getRoutes(r,!0)}}});else if(e)for(var t=0;t<e.length;t++)0!==t&&t!==e.length-1&&this.component.stops.insert(t,this.component.createStop()),e[t]instanceof Array&&(this.component.addStopOverlay(e[t],t),this.component.stops.at(t).patchValue({stopCoordinates:e[t]}),this.component.stops.at(t).patchValue({stopPoint:e[t]}),this.component.handleLocationProposals(e[t],t))},e.decorators=[{type:Se.Directive,args:[{selector:"[igoRoutingFormBinding]"}]}],e.ctorParameters=function(){return[{type:ai,decorators:[{type:Se.Self}]},{type:ii},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},e}(),li=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,fe.FormsModule,fe.ReactiveFormsModule,ye.MatIconModule,ye.MatButtonModule,ye.MatListModule,ye.MatDividerModule,ye.MatFormFieldModule,ye.MatInputModule,ye.MatOptionModule,ye.MatSelectModule,ye.MatTooltipModule,ye.MatAutocompleteModule,Ie.IgoLanguageModule],exports:[ai,si],declarations:[ai,si],providers:[ii,oi()]}]}],e}();function ui(e){return new Yn(e)}function ci(){return{provide:Yn,useFactory:ui,deps:[wr]}}var pi=function(){function e(e){this.languageService=e}return e.prototype.formatResult=function(e){return e},e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[{type:Ie.LanguageService}]},e}(),di=function(n){function r(e,t,r){var o=n.call(this,t)||this;return o.http=e,o.formatter=r,o}return Me(r,n),r.prototype.getId=function(){return r.id},r.prototype.getDefaultOptions=function(){return{title:"ICherche Qubec",searchUrl:"https://geoegl.msp.gouv.qc.ca/icherche/geocode"}},r.prototype.search=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Fe.map(function(e){return r.extractResults(e)}))},r.prototype.computeRequestParams=function(e,t){return new we.HttpParams({fromObject:Object.assign({q:e,geometries:"geom",type:"adresse,code_postal,route,municipalite,mrc,region_administrative"},this.params,t.params||{})})},r.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.formatter.formatResult(t.dataToResult(e))})},r.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e._id].join(".");return{source:this,data:{type:nt,projection:"EPSG:4326",geometry:e.geometry,extent:e.bbox,properties:t,meta:{id:r,title:e.properties.recherche}},meta:{dataType:nt,id:r,title:e.properties.recherche,titleHtml:e.highlight,icon:"map-marker"}}},r.prototype.computeProperties=function(e){var t=Oe.ObjectUtils.removeKeys(e.properties,r.propertiesBlacklist);return Object.assign(t,{type:e.doc_type})},r.id="icherche",r.type=nt,r.propertiesBlacklist=["@timestamp","@version","recherche","id","idrte","cote","geometry","bbox"],r.decorators=[{type:Se.Injectable}],r.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]},{type:pi,decorators:[{type:Se.Inject,args:[pi]}]}]},r}(wr),fi=function(o){function r(e,t){var r=o.call(this,t)||this;return r.http=e,r}return Me(r,o),r.prototype.getId=function(){return r.id},r.prototype.getDefaultOptions=function(){return{title:"ICherche Qubec",searchUrl:"https://geoegl.msp.gouv.qc.ca/icherche/xy"}},r.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Fe.map(function(e){return r.extractResults(e)}))},r.prototype.computeRequestParams=function(e,t){var r=t.distance;return new we.HttpParams({fromObject:Object.assign({loc:e.join(","),distance:r?String(r):"",geometries:"geom",type:"adresse,municipalite,mrc,regadmin"},this.params,t.params||{})})},r.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},r.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeExtent(e),o=[this.getId(),t.type,e._id].join(".");return{source:this,data:{type:nt,projection:"EPSG:4326",geometry:e.geometry,extent:r,properties:t,meta:{id:o,title:e.properties.nom}},meta:{dataType:nt,id:o,title:e.properties.nom,icon:"map-marker"}}},r.prototype.computeProperties=function(e){var t=Oe.ObjectUtils.removeKeys(e.properties,r.propertiesBlacklist);return Object.assign(t,{type:e.properties.doc_type})},r.prototype.computeExtent=function(e){return e.bbox?[e.bbox[0],e.bbox[2],e.bbox[1],e.bbox[3]]:undefined},r.id="icherchereverse",r.type=nt,r.propertiesBlacklist=["doc_type"],r.decorators=[{type:Se.Injectable}],r.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},r}(wr);function hi(e){return new pi(e)}function gi(){return{provide:pi,useFactory:hi,deps:[Ie.LanguageService]}}function yi(e,t,r){return new di(e,t.getConfig("searchSources."+di.id),r)}function mi(e,t){return new fi(e,t.getConfig("searchSources."+fi.id))}var vi=function(){function e(){}return e.getGoogleMapsLink=function(e,t){return"https://www.google.com/maps?q="+t+","+e},e.getGoogleStreetViewLink=function(e,t){return"https://www.google.com/maps?q=&layer=c&cbll="+t+","+e},e}(),bi=function(){function e(e){this.languageService=e}return e.prototype.formatResult=function(e){return e},e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[{type:Ie.LanguageService}]},e}(),Si=function(t){function e(e){return t.call(this,e)||this}return Me(e,t),e.prototype.getId=function(){return e.id},e.prototype.getDefaultOptions=function(){return{title:"Coordinates"}},e.prototype.reverseSearch=function(e,t){return he.of([this.dataToResult(e)])},e.prototype.dataToResult=function(e){return{source:this,data:{type:nt,projection:"EPSG:4326",geometry:{type:"Point",coordinates:[e[0],e[1]]},extent:undefined,properties:{type:"point",coordonnees:String(e[0])+", "+String(e[1]),format:"degrs decimaux",systemeCoordonnees:"WGS84",GoogleMaps:vi.getGoogleMapsLink(e[0],e[1]),GoogleStreetView:vi.getGoogleStreetViewLink(e[0],e[1])}},meta:{dataType:nt,id:"1",title:String(e[0])+", "+String(e[1]),icon:"map-marker"}}},e.id="coordinatesreverse",e.type=nt,e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},e}(wr);function wi(e){return new bi(e)}function Fi(){return{provide:bi,useFactory:wi,deps:[Ie.LanguageService]}}function Oi(e){return new Si(e.getConfig("searchSources."+Si.id))}var Ii=[nt,at],xi=function(){function e(e){this.searchSourceService=e,this.searchTypes=Ii,this.change=new Se.EventEmitter}return e.prototype.ngOnInit=function(){var e=this.enabled||this.searchTypes[0];this.enableSearchType(e)},e.prototype.onSearchTypeChange=function(e){this.enableSearchType(e)},e.prototype.getSearchTypeTitle=function(e){return"search."+e.toLowerCase()+".title"},e.prototype.enableSearchType=function(e){this.enabled=e,this.searchSourceService.enableSourcesByType(e),this.change.emit(e)},e.decorators=[{type:Se.Component,args:[{selector:"igo-search-selector",template:'<div class="igo-search-selector">\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-selector-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSelectorMenu">\r\n    <mat-icon svgIcon="menu-down"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #searchSelectorMenu="matMenu"\r\n    class="no-border-radius"\r\n    overlapTrigger="false"\r\n    xPosition="before"\r\n    yPosition="above">\r\n    <mat-radio-group\r\n      class="igo-search-selector-radio-group"\r\n      [value]="enabled"\r\n      (change)="onSearchTypeChange($event.value)">\r\n      <mat-radio-button *ngFor="let searchType of searchTypes" [value]="searchType">\r\n        {{getSearchTypeTitle(searchType) | translate}}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </mat-menu>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[".igo-search-selector-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-selector-radio-group{display:inline-flex;flex-direction:column}.igo-search-selector-radio-group mat-radio-button{margin:5px}"]}]}],e.ctorParameters=function(){return[{type:Yn}]},e.propDecorators={searchTypes:[{type:Se.Input}],enabled:[{type:Se.Input}],change:[{type:Se.Output}]},e}(),Mi=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatTooltipModule,ye.MatIconModule,ye.MatButtonModule,ye.MatMenuModule,ye.MatRadioModule,Ie.IgoLanguageModule],exports:[xi],declarations:[xi]}]}],e}(),Ci=function(){function e(e){this.searchService=e,this.invalidKeys=["Control","Shift","Alt"],this.stream$=new he.Subject,this.term="",this.floatLabel="never",this.disabled=!1,this.color="primary",this.debounce=300,this.minLength=2,this.searchTypes=Ii,this.change=new Se.EventEmitter,this.search=new Se.EventEmitter,this.searchTypeChange=new Se.EventEmitter,this._placeholder=""}return Object.defineProperty(e.prototype,"emptyClass",{get:function(){return this.empty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.term.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholder",{get:function(){return this.empty?this._placeholder:""},set:function(e){this._placeholder=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.stream$$=this.stream$.pipe(Fe.debounce(function(e){return""===e?he.EMPTY:he.timer(300)}),Fe.distinctUntilChanged()).subscribe(function(e){return t.onTermChange(e)})},e.prototype.ngOnDestroy=function(){this.stream$$.unsubscribe()},e.prototype.onKeyup=function(e){var t=e.target.value;this.keyIsValid(t)&&this.setTerm(t)},e.prototype.onClearButtonClick=function(){this.clear()},e.prototype.onSearchTypeChange=function(e){this.searchTypeChange.emit(e),this.placeholder="search."+e.toLowerCase()+".placeholder",this.doSearch(this.term)},e.prototype.setTerm=function(e){this.disabled||((this.term=e).length>=this.minLength||0===e.length)&&this.stream$.next(e)},e.prototype.clear=function(){this.term="",this.stream$.next(this.term),this.input.nativeElement.focus()},e.prototype.keyIsValid=function(e){return-1===this.invalidKeys.indexOf(e)},e.prototype.onTermChange=function(e){this.change.emit(e),this.doSearch(e)},e.prototype.doSearch=function(e){var r=this;e!==undefined&&""!==e?(this.store!==undefined&&this.store.softClear(),this.searchService.search(e).map(function(t){t.request.subscribe(function(e){r.onResearchCompleted(t,e)})})):this.store!==undefined&&this.store.clear()},e.prototype.onResearchCompleted=function(t,e){if(this.search.emit({research:t,results:e}),this.store!==undefined){var r=this.store.entities$.value.filter(function(e){return e.source!==t.source}).concat(e);this.store.load(r)}},e.decorators=[{type:Se.Component,args:[{selector:"igo-search-bar",template:'<div class="igo-search-bar-container">\r\n  <mat-form-field [floatLabel]="floatLabel">\r\n    <input\r\n      #input\r\n      matInput\r\n      autocomplete="off"\r\n      [ngClass]="{\'hasSearchIcon\': searchIcon}"\r\n      [disabled]="disabled"\r\n      [placeholder]="placeholder | translate"\r\n      [ngModel]="term"\r\n      (keyup)="onKeyup($event)"\r\n      (touchend)="onKeyup($event)">\r\n  </mat-form-field>\r\n\r\n  <div class="search-bar-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [color]="color"\r\n      *ngIf="searchIcon !== undefined">\r\n      <mat-icon svgIcon="{{searchIcon}}"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [color]="color"\r\n      (click)="onClearButtonClick()"\r\n      *ngIf="!empty">\r\n      <mat-icon svgIcon="close"></mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n  <igo-search-selector\r\n    [searchTypes]="searchTypes"\r\n    (change)="onSearchTypeChange($event)">\r\n  </igo-search-selector>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep .mat-form-field{padding:0 5px}:host ::ng-deep .mat-form-field-wrapper{margin-bottom:-1.5em}:host ::ng-deep span.mat-form-field-label-wrapper{top:-20px}:host ::ng-deep div.mat-form-field-infix{left:5px;right:5px;padding:0 0 12px!important}:host ::ng-deep div.mat-form-field-underline{display:none}.igo-search-bar-container{position:relative;width:100%}.igo-search-bar-container>mat-form-field{width:calc(100% - (2 * 40px))}:host.empty .igo-search-bar-container>mat-form-field{width:calc(100% - 40px)}.search-bar-buttons{position:absolute;right:40px;top:0}.search-bar-buttons>button:nth-child(2)::before{content:'';position:absolute;left:0;top:5px;border-right:1px solid #ddd;height:28px}igo-search-selector{display:inline-block;background-color:#fff;position:absolute;right:0;top:0;border-radius:0}"]}]}],e.ctorParameters=function(){return[{type:Xn}]},e.propDecorators={term:[{type:Se.Input}],floatLabel:[{type:Se.Input}],disabled:[{type:Se.Input}],color:[{type:Se.Input}],debounce:[{type:Se.Input}],minLength:[{type:Se.Input}],searchIcon:[{type:Se.Input}],store:[{type:Se.Input}],searchTypes:[{type:Se.Input}],change:[{type:Se.Output}],search:[{type:Se.Output}],searchTypeChange:[{type:Se.Output}],input:[{type:Se.ViewChild,args:["input"]}],emptyClass:[{type:Se.HostBinding,args:["class.empty"]}]},e}(),Ti=function(){function e(e,t,r){this.component=e,this.ref=t,this.route=r}return e.prototype.ngOnInit=function(){var r=this;this.route&&this.route.options.searchKey&&this.route.queryParams.subscribe(function(e){var t=e[r.route.options.searchKey];t&&(r.component.setTerm(t),r.ref.detectChanges())})},e.decorators=[{type:Se.Directive,args:[{selector:"[igoSearchUrlParam]"}]}],e.ctorParameters=function(){return[{type:Ci,decorators:[{type:Se.Self}]},{type:Se.ChangeDetectorRef},{type:Ie.RouteService,decorators:[{type:Se.Optional}]}]},e}(),Li=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,fe.FormsModule,ye.MatTooltipModule,ye.MatIconModule,ye.MatButtonModule,ye.MatMenuModule,ye.MatRadioModule,ye.MatFormFieldModule,ye.MatInputModule,Ie.IgoLanguageModule,Mi],exports:[Ci,Ci],declarations:[Ci,Ti]}]}],e}(),Pi={Grouped:"grouped",Flat:"flat"},Di=function(){function e(e){this.cdRef=e,this.searchResultMode=Pi,this.mode=Pi.Grouped,this.resultFocus=new Se.EventEmitter,this.resultSelect=new Se.EventEmitter}return Object.defineProperty(e.prototype,"results$",{get:function(){return this._results$===undefined&&(this._results$=this.liftResults()),this._results$},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.watcher=new ve.EntityStoreWatcher(this.store,this.cdRef)},e.prototype.ngOnDestroy=function(){this.watcher.destroy()},e.prototype.onResultFocus=function(e){this.store.state.update(e,{focused:!0},!0),this.resultFocus.emit(e)},e.prototype.computeGroupTitle=function(e){var t=[e.source.title],r=e.results.length;return 1<r&&t.push("("+r+")"),t.join(" ")},e.prototype.onResultSelect=function(e){this.store.state.update(e,{focused:!0,selected:!0},!0),this.resultSelect.emit(e)},e.prototype.liftResults=function(){var t=this;return this.store.view.all$().pipe(Fe.debounce(function(e){return 0===e.length?he.EMPTY:he.timer(200)}),Fe.map(function(e){return t.groupResults(e.sort(t.sortByOrder))}))},e.prototype.sortByOrder=function(e,t){return e.source.displayOrder-t.source.displayOrder},e.prototype.groupResults=function(e){var o=new Map;return e.forEach(function(e){var t=e.source,r=o.get(t);r===undefined&&(r=[],o.set(t,r)),r.push(e)}),Array.from(o.keys()).map(function(e){return{source:e,results:o.get(e)}})},e.decorators=[{type:Se.Component,args:[{selector:"igo-search-results",template:'<igo-list [navigation]="true">\r\n  <ng-template\r\n    #groupTemplate\r\n    ngFor let-group\r\n    [ngForOf]="results$ | async">\r\n\r\n    <igo-collapsible\r\n      *ngIf="mode === searchResultMode.Grouped; else flatTemplate"\r\n      [title]="computeGroupTitle(group)">\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </igo-collapsible>\r\n\r\n    <ng-template #flatTemplate>\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </ng-template>\r\n\r\n    <ng-template #storeItemTemplate let-results="results">\r\n      <ng-template ngFor let-result [ngForOf]="results">\r\n        <igo-search-results-item\r\n          igoListItem\r\n          color="accent"\r\n          [result]="result"\r\n          [focused]="store.state.get(result).focused"\r\n          [selected]="store.state.get(result).selected"\r\n          (focus)="onResultFocus(result)"\r\n          (select)="onResultSelect(result)">\r\n        </igo-search-results-item>\r\n      </ng-template>\r\n    </ng-template>\r\n\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},e.propDecorators={store:[{type:Se.Input}],mode:[{type:Se.Input}],resultFocus:[{type:Se.Output}],resultSelect:[{type:Se.Output}]},e}(),ji=function(){function e(){}return Object.defineProperty(e.prototype,"title",{get:function(){return ve.getEntityTitle(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleHtml",{get:function(){return ve.getEntityTitleHtml(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{get:function(){return ve.getEntityIcon(this.result)},enumerable:!0,configurable:!0}),e.decorators=[{type:Se.Component,args:[{selector:"igo-search-results-item",template:'<mat-list-item>\r\n  <mat-icon *ngIf="icon" mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n  <h4 matLine *ngIf="titleHtml" [innerHtml]="titleHtml"></h4>\r\n  <h4 matLine *ngIf="!titleHtml">{{title}}</h4>\r\n</mat-list-item>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[]},e.propDecorators={result:[{type:Se.Input}]},e}(),ki=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatTooltipModule,ye.MatIconModule,ye.MatListModule,ve.IgoCollapsibleModule,ve.IgoListModule,Ie.IgoLanguageModule],exports:[Di],declarations:[Di,ji]}]}],e}(),Ei=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[ci(),gi(),Fi()]}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,Li,Mi,ki],exports:[Li,Mi,ki],declarations:[]}]}],e}(),Ri=function(){function t(){this.format=new ge,this.opened=new Se.EventEmitter}return Object.defineProperty(t.prototype,"expanded",{get:function(){return this._expanded},set:function(e){this.state=e?"expanded":"collapsed",this._expanded=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return ve.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),t.prototype.toggle=function(){this.expanded=!this.expanded,this.opened.emit(this.expanded)},t.prototype.zoomToFeatureExtent=function(){if(this.feature.geometry){var e=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projection});Gt(this.map,[e],it.Zoom)}},t.prototype.swipe=function(e){e===t.SWIPE_ACTION.UP?this.expanded||this.toggle():e===t.SWIPE_ACTION.DOWN&&this.expanded&&this.toggle()},t.SWIPE_ACTION={UP:"swipeup",DOWN:"swipedown"},t.decorators=[{type:Se.Component,args:[{selector:"igo-toast",template:'<igo-flexible #flex\r\n  collapsedMobile="51px"\r\n  expandedMobile="300px"\r\n  [state]="state"\r\n  (swipeup)="swipe($event.type)"\r\n  (swipedown)="swipe($event.type)">\r\n\r\n  <igo-panel [title]="title">\r\n    <button\r\n      mat-icon-button\r\n      panelLeftButton\r\n      (click)="toggle()">\r\n      <mat-icon [svgIcon]="[\'collapsed\', \'initial\'].indexOf(flex.state) >= 0 ? \'arrow_upward\' : \'arrow_downward\'"></mat-icon>\r\n    </button>\r\n\r\n    <button mat-icon-button panelRightButton class="igo-icon-button" (click)="zoomToFeatureExtent()" *ngIf="feature.geometry">\r\n      <mat-icon svgIcon="zoom-in"></mat-icon>\r\n    </button>\r\n\r\n    <igo-feature-details [feature]="feature"></igo-feature-details>\r\n  </igo-panel>\r\n\r\n</igo-flexible>\r\n',styles:[":host{position:absolute;bottom:0;width:100%;max-height:calc(100% - 50px);background-color:#fff}igo-feature-details ::ng-deep table{width:100%}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={expanded:[{type:Se.Input}],map:[{type:Se.Input}],feature:[{type:Se.Input}],opened:[{type:Se.Output}]},t}(),_i=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatIconModule,ye.MatButtonModule,ve.IgoPanelModule,ve.IgoFlexibleModule,Wr],exports:[Ri],declarations:[Ri]}]}],e}(),$i=function(){function e(e){this.cdRef=e,this.showFeatureOnMap=!0,this.complete=new Se.EventEmitter,this.cancel=new Se.EventEmitter}return e.prototype.onUpdateInputs=function(){this.cdRef.detectChanges()},e.prototype.onClose=function(){this.cancel.emit()},e.decorators=[{type:Se.Component,args:[{selector:"igo-ogc-filter",template:'<igo-ogc-filterable-item\r\n  [layer]="layer" \r\n  [map]="map" >\r\n</igo-ogc-filterable-item>\r\n\r\n<div>\r\n  <button\r\n    mat-button\r\n    type="button"\r\n    (click)="onClose()">\r\n    {{ \'igo.geo.workspace.ogcFilter.close\' | translate }}\r\n  </button>\r\n</div>\r\n',changeDetection:Se.ChangeDetectionStrategy.OnPush,styles:[""]}]}],e.ctorParameters=function(){return[{type:Se.ChangeDetectorRef}]},e.propDecorators={layer:[{type:Se.Input}],map:[{type:Se.Input}],showFeatureOnMap:[{type:Se.Input}],complete:[{type:Se.Output}],cancel:[{type:Se.Output}]},e}(),Ai=new Se.InjectionToken("OgcFilterWidget");function Gi(e){return e.create($i)}function qi(){return{provide:Ai,useFactory:Gi,deps:[ve.WidgetService]}}var Bi=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ye.MatButtonModule,Ie.IgoLanguageModule,to],exports:[$i],declarations:[$i],entryComponents:[$i]}]}],e}(),Ni=function(r){function e(e){var t=r.call(this,e)||this;return t.options=e,t}return Me(e,r),Object.defineProperty(e.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),e}(ve.Workspace),Wi=function(){function e(){}return e.prototype.createWorkspace=function(e,t){return new Ni({id:e.id,title:e.title,layer:e,map:t,entityStore:this.createFeatureStore(e,t),actionStore:new ve.ActionStore([]),meta:{tableTemplate:this.createTableTemplate(e)}})},e.prototype.createFeatureStore=function(e,t){var r=new Lt([],{map:t});r.bindLayer(e);var o=new Tt({}),n=new Dt({map:t,hitTolerance:5});return r.addStrategy(o,!0),r.addStrategy(n,!0),r},e.prototype.createTableTemplate=function(e){return{selection:!0,sort:!0,columns:(e.dataSource.options.sourceFields||[]).map(function(e){return{name:"properties."+e.name,title:e.alias?e.alias:e.name}})}},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Vi=function(r){function e(e){var t=r.call(this,e)||this;return t.options=e,t}return Me(e,r),Object.defineProperty(e.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),e}(ve.Workspace),Ui=function(){function e(){}return e.prototype.createWorkspace=function(e,t){return new Vi({id:e.id,title:e.title,layer:e,map:t,actionStore:new ve.ActionStore([])})},e.decorators=[{type:Se.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=Se.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),zi=function(){function e(e,t,r){this.component=e,this.wfsWorkspaceService=t,this.wmsWorkspaceService=r}return Object.defineProperty(e.prototype,"workspaceStore",{get:function(){return this.component.store},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.pipe(Fe.debounceTime(50)).subscribe(function(e){return t.onLayersChange(e)})},e.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},e.prototype.onLayersChange=function(e){var t=this,r=e.filter(function(e){return t.layerIsEditable(e)}),o=r.map(function(e){return e.id}),n=r.map(function(e){return t.getOrCreateWorkspace(e)}).filter(function(e){return e!==undefined}),i=this.workspaceStore.all().filter(function(e){return o.indexOf(e.id)<0});0<i.length&&(i.forEach(function(e){e.deactivate()}),this.workspaceStore.state.updateMany(i,{active:!1,selected:!1}),this.workspaceStore.deleteMany(i)),0<n.length&&this.workspaceStore.insertMany(n)},e.prototype.getOrCreateWorkspace=function(e){if(this.workspaceStore.get(e.id)===undefined)return e.dataSource instanceof Ue?this.wfsWorkspaceService.createWorkspace(e,this.map):e.dataSource instanceof Qe?this.wmsWorkspaceService.createWorkspace(e,this.map):void 0},e.prototype.layerIsEditable=function(e){var t=e.dataSource;if(t instanceof Ue)return!0;if(t instanceof Qe){var r=t.options||{};return r.ogcFilters&&r.ogcFilters.enabled}return!1},e.decorators=[{type:Se.Directive,args:[{selector:"[igoWorkspaceSelector]"}]}],e.ctorParameters=function(){return[{type:ve.WorkspaceSelectorComponent},{type:Wi},{type:Ui}]},e.propDecorators={map:[{type:Se.Input}]},e}(),Ki=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule],exports:[zi],declarations:[zi]}]}],e}(),Hi=function(){function e(){}return e.decorators=[{type:Se.NgModule,args:[{imports:[me.CommonModule,ve.IgoWidgetModule,Ki,Bi],exports:[Ki,Bi],declarations:[],providers:[qi()]}]}],e}(),Qi=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e.decorators=[{type:Se.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],e}(),Yi=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e.decorators=[{type:Se.NgModule,args:[{imports:[],declarations:[],exports:[Dr,jr,Ar,Wr,to,tn,On,In,Mn,Ln,jn,_n,zn,Qn,li,Ei,_i,Hi,Qi]}]}],e}(),Zi=function(n){function e(e,t,r){var o=n.call(this,r)||this;return o.http=e,o.languageService=t,o}return Me(e,n),Object.defineProperty(e.prototype,"title",{get:function(){return this.languageService.translate.instant(this.options.title)},enumerable:!0,configurable:!0}),e.prototype.getId=function(){return e.id},e.prototype.getDefaultOptions=function(){return{title:"igo.geo.search.dataSources.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search"}},e.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Fe.map(function(e){return r.extractResults(e)}))},e.prototype.computeSearchRequestParams=function(e,t){return new we.HttpParams({fromObject:Object.assign({q:e},this.params,t.params||{})})},e.prototype.extractResults=function(e){var t=this;return e.items.map(function(e){return t.dataToResult(e)})},e.prototype.dataToResult=function(e){var t=this.computeLayerOptions(e);return{source:this,meta:{dataType:at,id:[this.getId(),e.id].join("."),title:e.source.title,titleHtml:e.highlight.title,icon:"Layer"===e.source.type?"layers":"map"},data:t}},e.prototype.computeLayerOptions=function(e){var t=e.source.url,r=this.extractQueryParamsFromSourceUrl(t);return{title:e.source.title,sourceOptions:{crossOrigin:"anonymous",type:e.source.format,url:t,queryable:e.source.queryable,queryFormat:r.format,queryHtmlTarget:r.htmlTarget,params:{layers:e.source.name}}}},e.prototype.extractQueryParamsFromSourceUrl=function(o){var e,t,r,n=Ke.GML2,i=this.options.queryFormat;if(i){var a=function(t){var e=i[t];if("*"===e)return n=Ke[t.toUpperCase()],"break";var r=e.urls;return Array.isArray(r)?(r.forEach(function(e){-1!==o.indexOf(e)&&(n=Ke[t.toUpperCase()])}),"break"):void 0};try{for(var s=Pe(Object.keys(i)),l=s.next();!l.done;l=s.next()){if("break"===a(l.value))break}}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}}return n===Ke.HTML&&(r="iframe"),{format:n,htmlTarget:r}},e.id="ilayer",e.type=at,e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.LanguageService},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},e}(wr);function Ji(e,t,r){return new Zi(e,t,r.getConfig("searchSources."+Zi.id))}var Xi=function(o){function e(e,t){var r=o.call(this,t)||this;return r.http=e,r}return Me(e,o),e.prototype.getId=function(){return e.id},e.prototype.getDefaultOptions=function(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search"}},e.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return this.http.get(this.searchUrl,{params:o}).pipe(Fe.map(function(e){return r.extractResults(e)}))},e.prototype.computeSearchRequestParams=function(e,t){return new we.HttpParams({fromObject:Object.assign({q:e,format:"json"},this.params,t.params||{})})},e.prototype.extractResults=function(e){var t=this;return e.map(function(e){return t.dataToResult(e)})},e.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeGeometry(e),o=this.computeExtent(e),n=[this.getId(),"place",e.place_id].join(".");return{source:this,meta:{dataType:nt,id:n,title:e.display_name,icon:"map-marker"},data:{type:nt,projection:"EPSG:4326",geometry:r,extent:o,properties:t,meta:{id:n,title:e.display_name}}}},e.prototype.computeProperties=function(e){return{display_name:e.display_name,place_id:e.place_id,osm_type:e.osm_type,"class":e["class"],type:e.type}},e.prototype.computeGeometry=function(e){return{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}},e.prototype.computeExtent=function(e){return[parseFloat(e.boundingbox[2]),parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[3]),parseFloat(e.boundingbox[1])]},e.id="nominatim",e.type=nt,e.decorators=[{type:Se.Injectable}],e.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},e}(wr);function ea(e,t){return new Xi(e,t.getConfig("searchSources."+Xi.id))}var ta=function(n){function t(e,t){var r=n.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,!r.storedQueriesOptions.storedquery_id){var o='Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"';throw new Error(o)}if(!r.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&r.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){o="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw o+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(o)}if(!r.storedQueriesOptions.fields)throw new Error("Stored Queries :You must set a fields definition for your stored query");return r.storedQueriesOptions.fields instanceof Array||(r.storedQueriesOptions.fields=[r.storedQueriesOptions.fields]),r.multipleFieldsQuery=1<r.storedQueriesOptions.fields.length,r.storedQueriesOptions.fields.forEach(function(e,t){if(r.multipleFieldsQuery&&!e.splitPrefix&&0!==t)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!e.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}return Me(t,n),t.prototype.getId=function(){return t.id},t.prototype.getDefaultOptions=function(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}},t.prototype.search=function(e,t){var r=this,o=this.termSplitter(e,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},o);return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:n,responseType:"text"}).pipe(Fe.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:n}).pipe(Fe.map(function(e){return r.extractResults(r.extractWFSData(e))}))},t.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=be.GeoJSON),r.test(t)&&(e=be.WFS),new e},t.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=be.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},t.prototype.termSplitter=function(e,t){var o={},n=e,r=0;return t.forEach(function(e){o[e.name]=e.defaultValue;var t=new RegExp(e.splitPrefix+"(.+)","i");t.test(n)&&(r=e.splitPrefix?r+=1:r,n=n.split(t)[1])}),0===r?o[t[0].name]=e:(n=e,je(t).reverse().forEach(function(e){var t=new RegExp(e.splitPrefix||"(.+)","i");if(n||""!==n){var r=n.split(t);n=r[0],r[1]&&(o[e.name]=r[1].trim())}})),o},t.prototype.computeRequestParams=function(e,t){var r=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new we.HttpParams({fromObject:Object.assign({service:"wfs",version:r,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,e.params||{})})},t.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},t.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:nt,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:nt,id:r,title:e.properties.title,titleHtml:e.properties[o],icon:"map-marker"}}},t.prototype.computeProperties=function(e){return Oe.ObjectUtils.removeKeys(e.properties,t.propertiesBlacklist)},t.id="storedqueries",t.type=nt,t.propertiesBlacklist=[],t.decorators=[{type:Se.Injectable}],t.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},t}(wr),ra=function(o){function r(e,t){var r=o.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,!r.storedQueriesOptions.storedquery_id){throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"')}if(!r.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!r.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');return r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}return Me(r,o),r.prototype.getId=function(){return r.id},r.prototype.getDefaultOptions=function(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}},r.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:o,responseType:"text"}).pipe(Fe.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:o}).pipe(Fe.map(function(e){return r.extractResults(r.extractWFSData(e))}))},r.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=be.GeoJSON),r.test(t)&&(e=be.WFS),new e},r.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=be.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},r.prototype.computeRequestParams=function(e,t){var r={};return r[this.storedQueriesOptions.longField]=e[0],r[this.storedQueriesOptions.latField]=e[1],new we.HttpParams({fromObject:Object.assign({service:"wfs",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},r,this.params,t.params||{})})},r.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},r.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:nt,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:nt,id:r,title:e.properties[o],icon:"map-marker"}}},r.prototype.computeProperties=function(e){var t=Oe.ObjectUtils.removeKeys(e.properties,r.propertiesBlacklist);return Object.assign(t,{type:e.properties.doc_type})},r.id="storedqueriesreverse",r.type=nt,r.propertiesBlacklist=[],r.decorators=[{type:Se.Injectable}],r.ctorParameters=function(){return[{type:we.HttpClient},{type:undefined,decorators:[{type:Se.Inject,args:["options"]}]}]},r}(wr);function oa(e,t){return new ta(e,t.getConfig("searchSources."+ta.id))}function na(e,t){return new ra(e,t.getConfig("searchSources."+ra.id))}var ia={GeoJSON:0,JSON:1};ia[ia.GeoJSON]="GeoJSON",ia[ia.JSON]="JSON";var aa={Route:"Route",Trip:"Trip"},sa=function(o){function n(e,t){var r=o.call(this)||this;return r.http=e,r.config=t,r.routingUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/",r.options=r.config.getConfig("routingSources.osrm")||{},r.routingUrl=r.options.url||r.routingUrl,r}return Me(n,o),Object.defineProperty(n.prototype,"enabled",{get:function(){return!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),n.prototype.getName=function(){return n._name},n.prototype.route=function(e){var t=this,r=this.getRouteParams();return this.http.get(this.routingUrl+e.join(";"),{params:r}).pipe(Fe.map(function(e){return t.extractRoutesData(e)}))},n.prototype.extractRoutesData=function(t){var r=this,o=[];return t.routes.forEach(function(e){o.push(r.formatRoute(e,t.waypoints))}),o},n.prototype.getRouteParams=function(){return new we.HttpParams({fromObject:{overview:"full",steps:"true",geometries:"geojson",alternatives:"true"}})},n.prototype.formatRoute=function(e,t){var r=[];return e.legs.forEach(function(e){e.steps.forEach(function(e){r.push(e)})}),{id:Oe.uuid(),title:e.legs[0].summary,source:n._name,sourceType:aa.Route,order:1,format:ia.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:e.distance,duration:e.duration,geometry:e.geometry,legs:e.legs,steps:r,weight:e.weight,weight_name:e.weight_name}},n._name="OSRM Qubec",n.decorators=[{type:Se.Injectable}],n.ctorParameters=function(){return[{type:we.HttpClient},{type:Ie.ConfigService}]},n}(ei);function la(e,t){return new sa(e,t)}e.IgoGeoModule=Yi,e.IgoCatalogModule=Dr,e.IgoCatalogBrowserModule=Cr,e.IgoCatalogLibraryModule=Pr,e.IgoDataSourceModule=jr,e.IgoDownloadModule=Ar,e.IgoGeoWorkspaceModule=Hi,e.IgoWorkspaceSelectorModule=Ki,e.IgoOgcFilterModule=Bi,e.IgoFeatureModule=Wr,e.IgoFeatureFormModule=Nr,e.IgoFeatureDetailsModule=qr,e.IgoFilterModule=to,e.IgoGeometryModule=tn,e.IgoGeometryFormFieldModule=en,e.IgoImportExportModule=On,e.IgoLayerModule=In,e.IgoMapModule=Mn,e.IgoMeasureModule=Ln,e.IgoMeasurerModule=Tn,e.IgoMetadataModule=jn,e.IgoOverlayModule=_n,e.IgoPrintModule=zn,e.IgoQueryModule=Qn,e.IgoRoutingModule=li,e.IgoSearchModule=Ei,e.IgoSearchBarModule=Li,e.IgoSearchResultsModule=ki,e.IgoToastModule=_i,e.IgoWktModule=Qi,e.querySearchSourceFactory=Kn,e.provideQuerySearchSource=Hn,e.defaultIChercheSearchResultFormatterFactory=hi,e.provideDefaultIChercheSearchResultFormatter=gi,e.ichercheSearchSourceFactory=yi,e.provideIChercheSearchSource=function(){return{provide:wr,useFactory:yi,multi:!0,deps:[we.HttpClient,Ie.ConfigService,pi]}},e.ichercheReverseSearchSourceFactory=mi,e.provideIChercheReverseSearchSource=function(){return{provide:wr,useFactory:mi,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.defaultCoordinatesSearchResultFormatterFactory=wi,e.provideDefaultCoordinatesSearchResultFormatter=Fi,e.CoordinatesReverseSearchSourceFactory=Oi,e.provideCoordinatesReverseSearchSource=function(){return{provide:wr,useFactory:Oi,multi:!0,deps:[Ie.ConfigService]}},e.ilayerSearchSourceFactory=Ji,e.provideILayerSearchSource=function(){return{provide:wr,useFactory:Ji,multi:!0,deps:[we.HttpClient,Ie.LanguageService,Ie.ConfigService]}},e.nominatimSearchSourceFactory=ea,e.provideNominatimSearchSource=function(){return{provide:wr,useFactory:ea,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.storedqueriesSearchSourceFactory=oa,e.provideStoredQueriesSearchSource=function(){return{provide:wr,useFactory:oa,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.storedqueriesReverseSearchSourceFactory=na,e.provideStoredQueriesReverseSearchSource=function(){return{provide:wr,useFactory:na,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.osrmRoutingSourcesFactory=la,e.provideOsrmRoutingSource=function(){return{provide:ei,useFactory:la,multi:!0,deps:[we.HttpClient,Ie.ConfigService]}},e.routingSourceServiceFactory=ri,e.provideRoutingSourceService=oi,e.RoutingSourceService=ti,e.CatalogService=Or,e.CatalogItemType=vr,e.CatalogBrowserComponent=Ir,e.CatalogLibaryComponent=Tr,e.DataService=ke,e.DataSource=qe,e.FeatureDataSource=Be,e.OSMDataSource=Ne,e.XYZDataSource=We,e.WFSDataSource=Ue,e.WFSService=ze,e.WMSDataSource=Qe,e.WMTSDataSource=Ze,e.CartoDataSource=Je,e.ArcGISRestDataSource=Xe,e.TileArcGISRestDataSource=et,e.WebSocketDataSource=tt,e.MVTDataSource=rt,e.ClusterDataSource=ot,e.DataSourceService=yr,e.CapabilitiesService=gr,e.EsriStyleGenerator=hr,e.generateIdFromSourceOptions=Ee,e.generateWMSIdFromSourceOptions=Re,e.generateWMTSIdFromSourceOptions=_e,e.generateXYZIdFromSourceOptions=$e,e.generateFeatureIdFromSourceOptions=Ae,e.generateId=Ge,e.createDefaultTileGrid=Ye,e.DownloadService=_r,e.DownloadButtonComponent=$r,e.FEATURE=nt,e.FeatureMotion=it,e.featureToOl=jt,e.featureFromOl=kt,e.computeOlFeatureExtent=Et,e.computeOlFeaturesExtent=Rt,e.scaleExtent=_t,e.featuresAreOutOfView=$t,e.featuresAreTooDeepInView=At,e.moveToOlFeatures=Gt,e.hideOlFeature=function(e){e.setStyle(new le.Style({}))},e.tryBindStoreLayer=qt,e.tryAddLoadingStrategy=Bt,e.tryAddSelectionStrategy=Nt,e.FeatureStore=Lt,e.FeatureStoreLoadingStrategy=Ct,e.FeatureStoreLoadingLayerStrategy=Tt,e.FeatureStoreSelectionStrategy=Dt,e.FeatureStoreStrategy=Mt,e.FilterableDataSourcePipe=kr,e.TimeFilterService=Er,e.OGCFilterService=Rr,e.OgcFilterWriter=Ve,e.TimeFilterFormComponent=Vr,e.TimeFilterItemComponent=Ur,e.TimeFilterListComponent=zr,e.TimeFilterListBindingDirective=Kr,e.OgcFilterableFormComponent=Yr,e.OgcFilterableItemComponent=Zr,e.OgcFilterableListComponent=Jr,e.OgcFilterableListBindingDirective=Xr,e.OgcFilterFormComponent=Qr,e.OgcFilterButtonComponent=eo,e.GeometrySliceError=$o,e.GeometrySliceMultiPolygonError=Ao,e.GeometrySliceLineStringError=Go,e.GeometrySliceTooManyIntersectionError=qo,e.createDrawInteractionStyle=Bo,e.createDrawHoleInteractionStyle=No,e.sliceOlGeometry=Wo,e.sliceOlLineString=Vo,e.sliceOlPolygon=Uo,e.addLinearRingToOlPolygon=zo,e.DrawControl=Ko,e.ModifyControl=Ho,e.SliceControl=Qo,e.DropGeoFileDirective=Fn,e.ExportError=rn,e.ExportInvalidFileError=on,e.ExportNothingToExportError=nn,e.ExportService=cn,e.ExportFormat=un,e.exportToCSV=function(e,t,r){void 0===r&&(r=";"),an(e.map(function(e,t){return e.join(r)}).join("\n"),"text/csv;charset=utf-8",t)},e.entitiesToRowData=function(e,t){return e.map(function(r){return t.map(function(e){var t;return e.renderer!==undefined&&e.renderer!==ve.EntityTableColumnRenderer.Default||(t=e.valueAccessor),(t=t||ve.getEntityProperty)(r,e.name)})})},e.downloadContent=an,e.handleFileExportError=sn,e.handleNothingToExportError=ln,e.ImportError=pn,e.ImportInvalidFileError=dn,e.ImportUnreadableFileError=fn,e.ImportNothingToImportError=hn,e.ImportService=Sn,e.addLayerAndFeaturesToMap=gn,e.handleFileImportSuccess=yn,e.handleFileImportError=mn,e.handleNothingToImportError=function(e,t,r){var o=r.translate,n=o.instant("igo.geo.dropGeoFile.empty.title"),i=o.instant("igo.geo.dropGeoFile.empty.text",{value:e.name,mimeType:e.type});t.error(i,n)},e.getFileExtension=vn,e.computeLayerTitleFromFile=bn,e.ImportExportComponent=wn,e.LayerService=mr,e.LAYER=at,e.Layer=st,e.TooltipType=lt,e.ImageLayer=dt,e.TileLayer=ft,e.VectorLayer=ht,e.VectorTileLayer=gt,e.StyleService=yt,e.LayerItemComponent=bt,e.LayerLegendComponent=St,e.LayerListComponent=Ot,e.LayerListBindingDirective=xt,e.LayerListControlsEnum=wt,e.LayerListService=Ft,e.ImageWatcher=ut,e.TileWatcher=ct,e.getLayersLegends=pt,e.IgoMap=or,e.MapViewAction=Ht,e.MapService=It,e.stringToLonLat=Qt,e.viewStatesAreEqual=Yt,e.formatScale=Zt,e.getResolutionFromScale=Jt,e.getScaleFromResolution=Xt,e.ctrlKeyDown=er,e.ProjectionService=nr,e.MapController=tr,e.MapViewController=rr,e.MapBrowserComponent=ir,e.ZoomButtonComponent=ar,e.GeolocateButtonComponent=sr,e.BaseLayersSwitcherComponent=pr,e.MiniBaseMapComponent=dr,e.RotationButtonComponent=fr,e.MEASURE_UNIT_AUTO="auto",e.MeasureType=oo,e.MeasureLengthUnit=no,e.MeasureLengthUnitAbbreviation=io,e.MeasureAreaUnit=ao,e.MeasureAreaUnitAbbreviation=so,e.metersToKilometers=lo,e.metersToFeet=uo,e.metersToMiles=co,e.squareMetersToSquareKilometers=po,e.squareMetersToSquareMiles=fo,e.squareMetersToSquareFeet=ho,e.squareMetersToHectares=go,e.squareMetersToAcres=yo,e.metersToUnit=mo,e.squareMetersToUnit=vo,e.formatMeasure=bo,e.computeBestLengthUnit=So,e.computeBestAreaUnit=wo,e.createMeasureInteractionStyle=Fo,e.createMeasureLayerStyle=Oo,e.measureOlGeometryLength=Io,e.measureOlGeometryArea=xo,e.measureOlGeometry=Mo,e.updateOlGeometryMidpoints=Co,e.clearOlGeometryMidpoints=function(e){for(var t=e.get("_midpoints")||[],r=t.length,o=0;o<r;o++){var n=t[o];n!==undefined&&n!==undefined&&Lo(n)}return e.set("_midpoints",undefined,!0),t},e.updateOlTooltipsAtMidpoints=Po,e.getOlTooltipsAtMidpoints=Do,e.updateOlGeometryCenter=jo,e.updateOlTooltipAtCenter=ko,e.getOlTooltipAtCenter=Eo,e.getTooltipsOfOlGeometry=Ro,e.createOlTooltipAtPoint=_o,e.MeasurerComponent=Zo,e.MeasureFormatPipe=Jo,e.MetadataService=Pn,e.MetadataButtonComponent=Dn,e.Overlay=zt,e.OverlayDirective=Rn,e.OverlayService=En,e.OverlayAction=kn,e.createOverlayLayer=Wt,e.createOverlayMarkerStyle=Vt,e.PrintService=An,e.PrintOutputFormat=qn,e.PrintPaperFormat=Bn,e.PrintOrientation=Nn,e.PrintResolution=Wn,e.PrintSaveImageFormat=Vn,e.PrintComponent=Gn,e.PrintFormComponent=Un,e.QueryService=br,e.QueryDirective=Sr,e.QueryFormat=Ke,e.QueryHtmlTarget=He,e.layerIsQueryable=mt,e.olLayerIsQueryable=vt,e.QuerySearchSource=Fr,e.RoutingService=ni,e.RoutingFormat=ia,e.SourceRoutingType=aa,e.RoutingSource=ei,e.OsrmRoutingSource=sa,e.RoutingFormComponent=ai,e.RoutingFormBindingDirective=si,e.RoutingFormService=ii,e.SEARCH_TYPES=Ii,e.SearchService=Xn,e.SearchSourceService=Yn,e.sourceCanSearch=Zn,e.sourceCanReverseSearch=Jn,e.featureToSearchResult=function(e,t){return{source:t,data:e,meta:{dataType:nt,id:e.meta.id,title:e.meta.title,icon:"map-marker"}}},e.SearchSource=wr,e.IChercheSearchResultFormatter=pi,e.IChercheSearchSource=di,e.IChercheReverseSearchSource=fi,e.ILayerSearchSource=Zi,e.NominatimSearchSource=Xi,e.StoredQueriesSearchSource=ta,e.StoredQueriesReverseSearchSource=ra,e.CoordinatesSearchResultFormatter=bi,e.CoordinatesReverseSearchSource=Si,e.ToastComponent=Ri,e.GoogleLinks=vi,e.WktService=Hr,e.h=Mr,e.i=xr,e.a=Ir,e.k=Lr,e.j=Tr,e.e=gr,e.d=yr,e.g=ke,e.f=ze,e.l=$r,e.m=_r,e.n=Gr,e.p=Br,e.y=eo,e.w=Qr,e.z=Yr,e.ba=Zr,e.bd=Xr,e.bc=Jr,e.q=kr,e.bb=Rr,e.t=Er,e.r=Vr,e.s=Ur,e.v=Kr,e.u=zr,e.bf=Xo,e.be=ro,e.bg=wn,e.bj=Fn,e.bi=cn,e.bh=Sn,e.bl=bt,e.bm=St,e.bp=xt,e.bn=Ot,e.bo=Ft,e.b=mr,e.c=yt,e.bu=lr,e.bt=pr,e.bv=dr,e.br=sr,e.bk=ir,e.bs=fr,e.o=It,e.bw=xn,e.bq=ar,e.bx=Jo,e.ca=Yo,e.by=Cn,e.bz=Zo,e.cc=Dn,e.cd=Pn,e.ce=Rn,e.cf=En,e.ci=Un,e.cg=Gn,e.ch=An,e.cn=Fr,e.cj=Sr,e.ck=br,e.cu=si,e.co=ai,e.ct=ii,e.dv=sa,e.cq=ei,e.cp=ni,e.cx=Ci,e.cy=Ti,e.da=ji,e.cz=Di,e.cw=xi,e.cv=Mi,e.dc=ci,e.db=ui,e.cs=Yn,e.cr=Xn,e.dh=Si,e.dg=bi,e.df=fi,e.dd=pi,e.de=di,e.dq=Zi,e.ds=Xi,e.cl=wr,e.du=ra,e.dt=ta,e.di=Ri,e.x=Hr,e.dk=Wi,e.dl=Ui,e.dm=$i,e.dn=Ai,e.do=Gi,e.dp=qi,e.dj=zi,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-geo.umd.min.js.map