!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/platform-browser"),require("@angular/material"),require("@igo2/utils"),require("angular2-notifications"),require("@ngx-translate/core"),require("@angular/common/http"),require("@angular/router"),require("@angular/cdk/layout"),require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@igo2/core",["exports","@angular/platform-browser","@angular/material","@igo2/utils","angular2-notifications","@ngx-translate/core","@angular/common/http","@angular/router","@angular/cdk/layout","rxjs","rxjs/operators","@angular/core","@angular/common"],e):e((t.igo2=t.igo2||{},t.igo2.core={}),t.ng.platformBrowser,t.ng.material,t.utils,t.i1,t.i1$1,t.ng.common.http,t.ng.router,t.ng.cdk.layout,t.rxjs,t.rxjs.operators,t.ng.core,t.ng.common)}(this,function(t,e,o,s,n,r,a,i,c,u,p,l,f){"use strict";var d=function(){function t(){this.counter$=new u.BehaviorSubject(0),this.ids=[]}return t.prototype.register=function(){var t=s.uuid();return this.ids.push(t),this.counter$.next(this.ids.length),t},t.prototype.unregister=function(t){var e=this.ids.indexOf(t);-1!==e&&(this.ids.splice(e,1),this.counter$.next(this.ids.length))},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),g=function(){function t(t){this.activityService=t}return t.prototype.intercept=function(t,e){var o=this,n=t.headers.get("activityInterceptor");if(n){var r=t.clone({headers:t.headers["delete"]("activityInterceptor")});if("false"===n)return e.handle(r)}var i=this.activityService.register();return e.handle(t).pipe(p.finalize(function(){o.activityService.unregister(i)}))},t.decorators=[{type:l.Injectable}],t.ctorParameters=function(){return[{type:d}]},t}(),h=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:g,multi:!0}]}},t.decorators=[{type:l.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),m=function(){function t(t){this.injector=t,this.config={}}return t.prototype.getConfig=function(t){return s.ObjectUtils.resolve(this.config,t)},t.prototype.load=function(o){var n=this,r=o["default"]||{};if(!o.path)return this.config=r,!0;var i=this.injector.get(a.HttpClient);return new Promise(function(e,t){i.get(o.path).pipe(p.catchError(function(t){return console.log("Configuration file "+o.path+" could not be read"),e(!0),u.throwError(t.error||"Server error")})).subscribe(function(t){n.config=s.ObjectUtils.mergeDeep(r,t),e(!0)})})},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:l.Injector}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(l.INJECTOR))},token:t,providedIn:"root"}),t}(),v=new l.InjectionToken("configOptions");function y(t){return{provide:v,useValue:t}}function b(t,e){return function(){return t.load(e)}}function I(){return{provide:l.APP_INITIALIZER,useFactory:b,multi:!0,deps:[m,v]}}var x=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[y({}),I()]}},t.decorators=[{type:l.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),j=function(){function t(t,e,o,n){void 0===o&&(o=".json"),this.http=t,this.prefix=e,this.suffix=o,this.config=n}return t.prototype.getTranslation=function(t){var e=require("../locale/"+t+".json"),o=u.of(e);if(this.config&&!this.prefix&&(this.prefix=this.config.getConfig("language.prefix")),!this.prefix)return o;var n=this.http.get(""+this.prefix+t+this.suffix);return u.combineLatest(o,n).pipe(p.map(function(t){return Object.assign(t[0],t[1])}))},t}();function w(t,e){return new j(t,undefined,undefined,e)}function S(t){return{provide:r.TranslateLoader,useFactory:t||w,deps:[a.HttpClient,m]}}var E=function(){function t(){}return t.prototype.handle=function(t){if(!t.translateService.langs.length){throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.")}throw new Error('The Key "'+t.key+'" is missing in locale file.')},t}(),T=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[S()]}},t.decorators=[{type:l.NgModule,args:[{imports:[r.TranslateModule.forRoot({missingTranslationHandler:{provide:r.MissingTranslationHandler,useClass:E}})],declarations:[],exports:[r.TranslateModule]}]}],t}(),C=function(){function t(){this._options={}}return Object.defineProperty(t.prototype,"options",{get:function(){return Object.assign({},t.defaultOptions,this._options)},set:function(t){this._options=t},enumerable:!0,configurable:!0}),t.defaultOptions={timeOut:5e3,hasCloseIcon:!1,showProgressBar:!0,pauseOnHover:!0,clickToClose:!0,maxLength:100,maxStack:3,preventDuplicates:!0},t.decorators=[{type:l.Component,args:[{selector:"igo-message-center",template:'<simple-notifications\r\n  [ngClass]="{closeIcon: options.hasCloseIcon}"\r\n  [options]="options">\r\n</simple-notifications>\r\n',styles:["@charset \"UTF-8\";:host>>>div.simple-notification-wrapper{bottom:0;right:calc(50% - 150px)}:host>>>div.simple-notification{min-height:50px;margin-bottom:5px;padding-left:45px;padding-right:25px}:host>>>div.simple-notification.noIcon{padding-left:25px}@media only screen and (max-width:450px),only screen and (max-height:450px){:host>>>div.simple-notification-wrapper{right:0;left:0;width:100%}:host>>>div.simple-notification{margin-bottom:0}}:host>>>div.simple-notification .sn-title{line-height:23px;font-size:15px;font-weight:700}:host>>>div.simple-notification .sn-content{line-height:18px;font-size:15px}:host>>>div.simple-notification .icon{top:0;left:0;width:45px;height:100%;padding:7px}:host>>>div.simple-notification .icon mat-icon{display:flex;align-items:center;height:100%;font-size:32px}:host>>>.closeIcon>>>.sn-title:after{content:'close';font-family:'Material Icons';-webkit-font-feature-settings:'liga' 1;font-feature-settings:'liga' 1;font-size:24px;font-weight:400;right:5px;top:5px;position:absolute}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={options:[{type:l.Input}]},t}(),k=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[]}},t.decorators=[{type:l.NgModule,args:[{imports:[f.CommonModule,n.SimpleNotificationsModule.forRoot()],declarations:[C],exports:[C]}]}],t}(),M={ERROR:"error",ALERT:"alert",INFO:"info",SUCCESS:"success"},R=function(){function t(t,e){this.notificationService=t,this.configService=e,this.messages$=new u.BehaviorSubject([]),this.options=this.configService.getConfig("message")||{}}return t.prototype.showError=function(t){return t.error.caught=!0,this.error(t.error.message,t.error.title)},t.prototype.message=function(t){var e;if(this.messages$.next(this.messages$.value.concat([t])),t.options=t.options||{},(t=this.handleTemplate(t)).text)e=this.notificationService.create(t.title,t.text,t.type,t.options);else{if(!t.html)return;t.icon||(t.options.theClass=t.options.theClass?t.options.theClass+" noIcon":"noIcon"),e=this.notificationService.html(t.html,t.type,t.options)}return t.icon!==undefined&&this.addIcon(e,t.icon),e},t.prototype.success=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"check",options:o,type:M.SUCCESS})},t.prototype.error=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"error_outline",options:o,type:M.ERROR})},t.prototype.info=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"info_outline",options:o,type:M.INFO})},t.prototype.alert=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"access_alarm",options:o,type:M.ALERT})},t.prototype.remove=function(t){this.notificationService.remove(t)},t.prototype.addIcon=function(t,e){t.icon='\n      <mat-icon class="material-icons mat-icon mat-list-avatar" svgIcon="'+e+'">\n      </mat-icon>'},t.prototype.handleTemplate=function(t){if(!this.options.template||t.html)return t;var e=this.options.template;return e=(e=(e=e.replace("${text}",t.text)).replace("${title}",t.title)).replace("${icon}",t.icon),t.html=e,t.text=undefined,t.title=undefined,t.icon=undefined,t},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:n.NotificationsService},{type:m}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(n.NotificationsService),l.inject(m))},token:t,providedIn:"root"}),t}(),O=function(){function t(t){this.translate=t;var e=this.getLanguage();this.translate.setDefaultLang(e)}return t.prototype.getLanguage=function(){var t=this.translate.getBrowserLang();return t.match(/en|fr/)?t:"en"},t.prototype.setLanguage=function(t){this.translate.use(t),this.translate.reloadLang(t)},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.TranslateService}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(r.TranslateService))},token:t,providedIn:"root"}),t}(),P=function(){function t(t,e){this.messageService=t,this.injector=e}return t.prototype.intercept=function(e,t){var o=this;return t.handle(e).pipe(p.catchError(function(t){return o.handleError(t,e)}),p.finalize(function(){return o.handleCaughtError()}),p.finalize(function(){return o.handleUncaughtError()}))},t.prototype.handleError=function(t,e){var o=e.method+" "+e.urlWithParams+" "+t.status+" ("+t.statusText+")";if(t instanceof a.HttpErrorResponse){var n="object"===t.error?t.error:{};n.message=t.error.message||t.statusText,n.caught=!1,console.error(o,"\n",n.message,"\n\n",t),this.httpError=new a.HttpErrorResponse({error:n,headers:t.headers,status:t.status,statusText:t.statusText,url:t.url})}return u.throwError(this.httpError)},t.prototype.handleCaughtError=function(){this.httpError&&this.httpError.error.toDisplay&&(this.httpError.error.caught=!0,this.messageService.error(this.httpError.error.message,this.httpError.error.title))},t.prototype.handleUncaughtError=function(){if(this.httpError&&!this.httpError.error.caught){var t=this.injector.get(O).translate,e=t.instant("igo.core.errors.uncaught.message"),o=t.instant("igo.core.errors.uncaught.title");this.httpError.error.caught=!0,this.messageService.error(e,o)}},t.decorators=[{type:l.Injectable}],t.ctorParameters=function(){return[{type:R},{type:l.Injector}]},t}(),L=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:P,multi:!0}]}},t.decorators=[{type:l.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),N=function(){function t(t,e){t.addSvgIconSet(e.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}return t.forRoot=function(){return{ngModule:t,providers:[]}},t.decorators=[{type:l.NgModule,args:[{imports:[f.CommonModule,a.HttpClientModule,h.forRoot(),x.forRoot(),L.forRoot(),T.forRoot(),k.forRoot()],declarations:[],exports:[h,x,L,T,k]}]}],t.ctorParameters=function(){return[{type:o.MatIconRegistry},{type:e.DomSanitizer}]},t}(),$=function(){function t(){}return t.prototype.intercept=function(o,t){var n,r=Date.now();return t.handle(o).pipe(p.tap(function(t){return n=t instanceof a.HttpResponse?"succeeded":""},function(t){return n="failed"}),p.finalize(function(){var t=Date.now()-r,e=o.method+' "'+o.urlWithParams+'"\n             '+n+" in "+t+" ms.";console.log(e)}))},t.decorators=[{type:l.Injectable}],t}(),D=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:$,multi:!0}]}},t.decorators=[{type:l.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),q=new l.InjectionToken("routeServiceOptions");var _=function(){function t(t,e){this.route=t;this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",routingCoordKey:"routing",toolKey:"tool",llcKKey:"llck",llcAKey:"llca",llcVKey:"llcv",llcRKey:"llcr"},e)}return Object.defineProperty(t.prototype,"queryParams",{get:function(){return this.route.queryParams},enumerable:!0,configurable:!0}),t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:i.ActivatedRoute},{type:undefined,decorators:[{type:l.Inject,args:[q]},{type:l.Optional}]}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(i.ActivatedRoute),l.inject(q,8))},token:t,providedIn:"root"}),t}(),B=function(){function t(t){this.config=t,this.options=this.config.getConfig("analytics")||{},"matomo"===this.options.provider&&this.initMatomo()}return t.prototype.initMatomo=function(){var o=this;if(this.options.url&&this.options.id){window._paq=window._paq||[];var n=window._paq;n.push(["trackPageView"]),n.push(["enableLinkTracking"]),function(){n.push(["setTrackerUrl",o.options.url+"matomo.php"]),n.push(["setSiteId",o.options.id]);var t=document.createElement("script"),e=document.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.defer=!0,t.src=o.options.url+"matomo.js",e.parentNode.insertBefore(t,e)}()}},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:m}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(m))},token:t,providedIn:"root"}),t}(),H={Mobile:"mobile",Tablet:"tablet",Desktop:"desktop"},K={Portrait:"portrait",Landscape:"landscape"},A=function(){function t(t){var e=this;this.media$=new u.BehaviorSubject(undefined),this.orientation$=new u.BehaviorSubject(undefined),t.observe([c.Breakpoints.HandsetLandscape]).subscribe(function(t){t.matches&&(e.media$.next(H.Mobile),e.orientation$.next(K.Landscape))}),t.observe([c.Breakpoints.HandsetPortrait]).subscribe(function(t){t.matches&&(e.media$.next(H.Mobile),e.orientation$.next(K.Portrait))}),t.observe([c.Breakpoints.TabletLandscape]).subscribe(function(t){t.matches&&(e.media$.next(H.Tablet),e.orientation$.next(K.Landscape))}),t.observe([c.Breakpoints.TabletPortrait]).subscribe(function(t){t.matches&&(e.media$.next(H.Tablet),e.orientation$.next(K.Portrait))}),t.observe([c.Breakpoints.WebLandscape]).subscribe(function(t){t.matches&&(e.media$.next(H.Desktop),e.orientation$.next(K.Landscape))}),t.observe([c.Breakpoints.WebPortrait]).subscribe(function(t){t.matches&&(e.media$.next(H.Desktop),e.orientation$.next(K.Portrait))})}return t.prototype.getMedia=function(){return this.media$.value},t.prototype.getOrientation=function(){return this.orientation$.value},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:c.BreakpointObserver}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(c.BreakpointObserver))},token:t,providedIn:"root"}),t}(),z=function(){function t(t,e){this.messageService=t,this.injector=e,this.stateChangeEventEmitter=new l.EventEmitter,this.state={connection:window.navigator.onLine},this.checkNetworkState()}return t.prototype.checkNetworkState=function(){var n=this;this.onlineSubscription=u.fromEvent(window,"online").subscribe(function(){console.log("allo");var t=n.injector.get(O).translate,e=t.instant("igo.core.network.online.message"),o=t.instant("igo.core.network.online.title");n.messageService.info(e,o),n.state.connection=!0,n.emitEvent()}),this.offlineSubscription=u.fromEvent(window,"offline").subscribe(function(){var t=n.injector.get(O).translate,e=t.instant("igo.core.network.offline.message"),o=t.instant("igo.core.network.offline.title");n.messageService.info(e,o),n.state.connection=!1,n.emitEvent()})},t.prototype.emitEvent=function(){this.stateChangeEventEmitter.emit(this.state)},t.prototype.ngAfterViewInit=function(){if(!1===this.state.connection){console.log("yo");var t=this.injector.get(O).translate,e=t.instant("igo.core.network.offline.message"),o=t.instant("igo.core.network.offline.title");this.messageService.info(e,o)}},t.prototype.ngOnDestroy=function(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch(t){}},t.prototype.currentState=function(t){return void 0===t&&(t=!0),t?this.stateChangeEventEmitter.pipe(p.debounceTime(300),p.startWith(this.state)):this.stateChangeEventEmitter.pipe(p.debounceTime(300))},t.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:R},{type:l.Injector}]},t.ngInjectableDef=l.defineInjectable({factory:function(){return new t(l.inject(R),l.inject(l.INJECTOR))},token:t,providedIn:"root"}),t}(),U=function(){function t(){}return t.decorators=[{type:l.NgModule,args:[{declarations:[],imports:[f.CommonModule],providers:[z]}]}],t}();t.IgoCoreModule=N,t.IgoActivityModule=h,t.IgoConfigModule=x,t.IgoLanguageModule=T,t.IgoMessageModule=k,t.IgoErrorModule=L,t.IgoLoggingModule=D,t.provideConfigOptions=y,t.configFactory=b,t.provideConfigLoader=I,t.CONFIG_OPTIONS=v,t.defaultLanguageLoader=w,t.provideLanguageLoader=function(t){return{provide:r.TranslateLoader,useFactory:t||w,deps:[a.HttpClient]}},t.provideDefaultLanguageLoader=S,t.provideRouteServiceOptions=function(t){return{provide:q,useValue:t}},t.ROUTE_SERVICE_OPTIONS=q,t.RouteService=_,t.ActivityService=d,t.ActivityInterceptor=g,t.AnalyticsService=B,t.ConfigService=m,t.LanguageLoader=j,t.LanguageService=O,t.IgoMissingTranslationHandler=E,t.Media=H,t.MediaOrientation=K,t.MediaService=A,t.MessageCenterComponent=C,t.MessageType=M,t.MessageService=R,t.ErrorInterceptor=P,t.LoggingInterceptor=$,t.NetworkService=z,t.NetworkModule=U,t.ɵa=g,t.ɵb=d,t.ɵc=m,t.ɵg=j,t.ɵf=E,t.ɵh=C,t.ɵe=R,t.ɵd=P,t.ɵi=$,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-core.umd.min.js.map