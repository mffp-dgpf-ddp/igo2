!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/platform-browser"),require("@angular/material"),require("@igo2/utils"),require("angular2-notifications"),require("@ngx-translate/core"),require("@angular/common/http"),require("@angular/router"),require("@angular/cdk/layout"),require("rxjs"),require("rxjs/operators"),require("@ionic-native/network/ngx"),require("@ionic/angular"),require("@ionic-native/network/ngx/index"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@igo2/core",["exports","@angular/platform-browser","@angular/material","@igo2/utils","angular2-notifications","@ngx-translate/core","@angular/common/http","@angular/router","@angular/cdk/layout","rxjs","rxjs/operators","@ionic-native/network/ngx","@ionic/angular","@ionic-native/network/ngx/index","@angular/core","@angular/common"],e):e((t.igo2=t.igo2||{},t.igo2.core={}),t.ng.platformBrowser,t.ng.material,t.utils,t.i1,t.i1$1,t.ng.common.http,t.ng.router,t.ng.cdk.layout,t.rxjs,t.rxjs.operators,t.ngx,t.i3,t.i2,t.ng.core,t.ng.common)}(this,function(t,e,n,s,o,r,a,i,c,u,p,l,f,d,g,h){"use strict";var m=function(){function t(){this.counter$=new u.BehaviorSubject(0),this.ids=[]}return t.prototype.register=function(){var t=s.uuid();return this.ids.push(t),this.counter$.next(this.ids.length),t},t.prototype.unregister=function(t){var e=this.ids.indexOf(t);-1!==e&&(this.ids.splice(e,1),this.counter$.next(this.ids.length))},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),v=function(){function t(t){this.activityService=t}return t.prototype.intercept=function(t,e){var n=this,o=t.headers.get("activityInterceptor");if(o){var r=t.clone({headers:t.headers["delete"]("activityInterceptor")});if("false"===o)return e.handle(r)}var i=this.activityService.register();return e.handle(t).pipe(p.finalize(function(){n.activityService.unregister(i)}))},t.decorators=[{type:g.Injectable}],t.ctorParameters=function(){return[{type:m}]},t}(),y=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:v,multi:!0}]}},t.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),b=function(){function t(t){this.injector=t,this.config={}}return t.prototype.getConfig=function(t){return s.ObjectUtils.resolve(this.config,t)},t.prototype.load=function(n){var o=this,r=n["default"]||{};if(!n.path)return this.config=r,!0;var i=this.injector.get(a.HttpClient);return new Promise(function(e,t){i.get(n.path).pipe(p.catchError(function(t){return console.log("Configuration file "+n.path+" could not be read"),e(!0),u.throwError(t.error||"Server error")})).subscribe(function(t){o.config=s.ObjectUtils.mergeDeep(r,t),e(!0)})})},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:g.Injector}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(g.INJECTOR))},token:t,providedIn:"root"}),t}(),I=new g.InjectionToken("configOptions");function x(t){return{provide:I,useValue:t}}function j(t,e){return function(){return t.load(e)}}function w(){return{provide:g.APP_INITIALIZER,useFactory:j,multi:!0,deps:[b,I]}}var S=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[x({}),w()]}},t.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),E=function(){function t(t,e,n,o){void 0===n&&(n=".json"),this.http=t,this.prefix=e,this.suffix=n,this.config=o}return t.prototype.getTranslation=function(t){var e=require("../locale/"+t+".json"),n=u.of(e);if(this.config&&!this.prefix&&(this.prefix=this.config.getConfig("language.prefix")),!this.prefix)return n;var o=this.http.get(""+this.prefix+t+this.suffix);return u.combineLatest(n,o).pipe(p.map(function(t){return Object.assign(t[0],t[1])}))},t}();function k(t,e){return new E(t,undefined,undefined,e)}function T(t){return{provide:r.TranslateLoader,useFactory:t||k,deps:[a.HttpClient,b]}}var C=function(){function t(){}return t.prototype.handle=function(t){if(!t.translateService.langs.length){throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.")}throw new Error('The Key "'+t.key+'" is missing in locale file.')},t}(),M=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[T()]}},t.decorators=[{type:g.NgModule,args:[{imports:[r.TranslateModule.forRoot({missingTranslationHandler:{provide:r.MissingTranslationHandler,useClass:C}})],declarations:[],exports:[r.TranslateModule]}]}],t}(),R=function(){function t(){this._options={}}return Object.defineProperty(t.prototype,"options",{get:function(){return Object.assign({},t.defaultOptions,this._options)},set:function(t){this._options=t},enumerable:!0,configurable:!0}),t.defaultOptions={timeOut:5e3,hasCloseIcon:!1,showProgressBar:!0,pauseOnHover:!0,clickToClose:!0,maxLength:100,maxStack:3,preventDuplicates:!0},t.decorators=[{type:g.Component,args:[{selector:"igo-message-center",template:'<simple-notifications\r\n  [ngClass]="{closeIcon: options.hasCloseIcon}"\r\n  [options]="options">\r\n</simple-notifications>\r\n',styles:["@charset \"UTF-8\";:host>>>div.simple-notification-wrapper{bottom:0;right:calc(50% - 150px)}:host>>>div.simple-notification{min-height:50px;margin-bottom:5px;padding-left:45px;padding-right:25px}:host>>>div.simple-notification.noIcon{padding-left:25px}@media only screen and (max-width:450px),only screen and (max-height:450px){:host>>>div.simple-notification-wrapper{right:0;left:0;width:100%}:host>>>div.simple-notification{margin-bottom:0}}:host>>>div.simple-notification .sn-title{line-height:23px;font-size:15px;font-weight:700}:host>>>div.simple-notification .sn-content{line-height:18px;font-size:15px}:host>>>div.simple-notification .icon{top:0;left:0;width:45px;height:100%;padding:7px}:host>>>div.simple-notification .icon mat-icon{display:flex;align-items:center;height:100%;font-size:32px}:host>>>.closeIcon>>>.sn-title:after{content:'close';font-family:'Material Icons';-webkit-font-feature-settings:'liga' 1;font-feature-settings:'liga' 1;font-size:24px;font-weight:400;right:5px;top:5px;position:absolute}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={options:[{type:g.Input}]},t}(),O=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[]}},t.decorators=[{type:g.NgModule,args:[{imports:[h.CommonModule,o.SimpleNotificationsModule.forRoot()],declarations:[R],exports:[R]}]}],t}(),P={ERROR:"error",ALERT:"alert",INFO:"info",SUCCESS:"success"},L=function(){function t(t,e){this.notificationService=t,this.configService=e,this.messages$=new u.BehaviorSubject([]),this.options=this.configService.getConfig("message")||{}}return t.prototype.showError=function(t){return t.error.caught=!0,this.error(t.error.message,t.error.title)},t.prototype.message=function(t){var e;if(this.messages$.next(this.messages$.value.concat([t])),t.options=t.options||{},(t=this.handleTemplate(t)).text)e=this.notificationService.create(t.title,t.text,t.type,t.options);else{if(!t.html)return;t.icon||(t.options.theClass=t.options.theClass?t.options.theClass+" noIcon":"noIcon"),e=this.notificationService.html(t.html,t.type,t.options)}return t.icon!==undefined&&this.addIcon(e,t.icon),e},t.prototype.success=function(t,e,n){return void 0===n&&(n={}),this.message({text:t,title:e,icon:n.icon||"check",options:n,type:P.SUCCESS})},t.prototype.error=function(t,e,n){return void 0===n&&(n={}),this.message({text:t,title:e,icon:n.icon||"error_outline",options:n,type:P.ERROR})},t.prototype.info=function(t,e,n){return void 0===n&&(n={}),this.message({text:t,title:e,icon:n.icon||"info_outline",options:n,type:P.INFO})},t.prototype.alert=function(t,e,n){return void 0===n&&(n={}),this.message({text:t,title:e,icon:n.icon||"access_alarm",options:n,type:P.ALERT})},t.prototype.remove=function(t){this.notificationService.remove(t)},t.prototype.addIcon=function(t,e){t.icon='\n      <mat-icon class="material-icons mat-icon mat-list-avatar" svgIcon="'+e+'">\n      </mat-icon>'},t.prototype.handleTemplate=function(t){if(!this.options.template||t.html)return t;var e=this.options.template;return e=(e=(e=e.replace("${text}",t.text)).replace("${title}",t.title)).replace("${icon}",t.icon),t.html=e,t.text=undefined,t.title=undefined,t.icon=undefined,t},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NotificationsService},{type:b}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(o.NotificationsService),g.inject(b))},token:t,providedIn:"root"}),t}(),N=function(){function t(t){this.translate=t;var e=this.getLanguage();this.translate.setDefaultLang(e)}return t.prototype.getLanguage=function(){var t=this.translate.getBrowserLang();return t.match(/en|fr/)?t:"en"},t.prototype.setLanguage=function(t){this.translate.use(t),this.translate.reloadLang(t)},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.TranslateService}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(r.TranslateService))},token:t,providedIn:"root"}),t}(),$=function(){function t(t,e){this.messageService=t,this.injector=e}return t.prototype.intercept=function(e,t){var n=this;return t.handle(e).pipe(p.catchError(function(t){return n.handleError(t,e)}),p.finalize(function(){return n.handleCaughtError()}),p.finalize(function(){return n.handleUncaughtError()}))},t.prototype.handleError=function(t,e){var n=e.method+" "+e.urlWithParams+" "+t.status+" ("+t.statusText+")";if(t instanceof a.HttpErrorResponse){var o="object"===t.error?t.error:{};o.message=t.error.message||t.statusText,o.caught=!1,console.error(n,"\n",o.message,"\n\n",t),this.httpError=new a.HttpErrorResponse({error:o,headers:t.headers,status:t.status,statusText:t.statusText,url:t.url})}return u.throwError(this.httpError)},t.prototype.handleCaughtError=function(){this.httpError&&this.httpError.error.toDisplay&&(this.httpError.error.caught=!0,this.messageService.error(this.httpError.error.message,this.httpError.error.title))},t.prototype.handleUncaughtError=function(){if(this.httpError&&!this.httpError.error.caught){var t=this.injector.get(N).translate,e=t.instant("igo.core.errors.uncaught.message"),n=t.instant("igo.core.errors.uncaught.title");this.httpError.error.caught=!0,this.messageService.error(e,n)}},t.decorators=[{type:g.Injectable}],t.ctorParameters=function(){return[{type:L},{type:g.Injector}]},t}(),D=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:$,multi:!0}]}},t.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),q=function(){function t(t,e){t.addSvgIconSet(e.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}return t.forRoot=function(){return{ngModule:t,providers:[]}},t.decorators=[{type:g.NgModule,args:[{imports:[h.CommonModule,a.HttpClientModule,y.forRoot(),S.forRoot(),D.forRoot(),M.forRoot(),O.forRoot()],declarations:[],exports:[y,S,D,M,O]}]}],t.ctorParameters=function(){return[{type:n.MatIconRegistry},{type:e.DomSanitizer}]},t}(),_=function(){function t(){}return t.prototype.intercept=function(n,t){var o,r=Date.now();return t.handle(n).pipe(p.tap(function(t){return o=t instanceof a.HttpResponse?"succeeded":""},function(t){return o="failed"}),p.finalize(function(){var t=Date.now()-r,e=n.method+' "'+n.urlWithParams+'"\n             '+o+" in "+t+" ms.";console.log(e)}))},t.decorators=[{type:g.Injectable}],t}(),B=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:a.HTTP_INTERCEPTORS,useClass:_,multi:!0}]}},t.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],t}(),H=new g.InjectionToken("routeServiceOptions");var K=function(){function t(t,e){this.route=t;this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",routingCoordKey:"routing",toolKey:"tool",llcKKey:"llck",llcAKey:"llca",llcVKey:"llcv",llcRKey:"llcr"},e)}return Object.defineProperty(t.prototype,"queryParams",{get:function(){return this.route.queryParams},enumerable:!0,configurable:!0}),t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:i.ActivatedRoute},{type:undefined,decorators:[{type:g.Inject,args:[H]},{type:g.Optional}]}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(i.ActivatedRoute),g.inject(H,8))},token:t,providedIn:"root"}),t}(),z=function(){function t(t){this.config=t,this.options=this.config.getConfig("analytics")||{},"matomo"===this.options.provider&&this.initMatomo()}return t.prototype.initMatomo=function(){var n=this;if(this.options.url&&this.options.id){window._paq=window._paq||[];var o=window._paq;o.push(["trackPageView"]),o.push(["enableLinkTracking"]),function(){o.push(["setTrackerUrl",n.options.url+"matomo.php"]),o.push(["setSiteId",n.options.id]);var t=document.createElement("script"),e=document.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.defer=!0,t.src=n.options.url+"matomo.js",e.parentNode.insertBefore(t,e)}()}},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:b}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(b))},token:t,providedIn:"root"}),t}(),A={Mobile:"mobile",Tablet:"tablet",Desktop:"desktop"},U={Portrait:"portrait",Landscape:"landscape"},F=function(){function t(t){var e=this;this.media$=new u.BehaviorSubject(undefined),this.orientation$=new u.BehaviorSubject(undefined),t.observe([c.Breakpoints.HandsetLandscape]).subscribe(function(t){t.matches&&(e.media$.next(A.Mobile),e.orientation$.next(U.Landscape))}),t.observe([c.Breakpoints.HandsetPortrait]).subscribe(function(t){t.matches&&(e.media$.next(A.Mobile),e.orientation$.next(U.Portrait))}),t.observe([c.Breakpoints.TabletLandscape]).subscribe(function(t){t.matches&&(e.media$.next(A.Tablet),e.orientation$.next(U.Landscape))}),t.observe([c.Breakpoints.TabletPortrait]).subscribe(function(t){t.matches&&(e.media$.next(A.Tablet),e.orientation$.next(U.Portrait))}),t.observe([c.Breakpoints.WebLandscape]).subscribe(function(t){t.matches&&(e.media$.next(A.Desktop),e.orientation$.next(U.Landscape))}),t.observe([c.Breakpoints.WebPortrait]).subscribe(function(t){t.matches&&(e.media$.next(A.Desktop),e.orientation$.next(U.Portrait))})}return t.prototype.getMedia=function(){return this.media$.value},t.prototype.getOrientation=function(){return this.orientation$.value},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:c.BreakpointObserver}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(c.BreakpointObserver))},token:t,providedIn:"root"}),t}(),V=function(){function t(t,e,n,o){var r=this;this.messageService=t,this.injector=e,this.network=n,this.platform=o,this.stateChangeEventEmitter=new g.EventEmitter,this.state={connection:window.navigator.onLine},console.log(this.platform+"premier"),this.platform.ready().then(function(){console.log(r.platform),r.platform.is("cordova")?(console.log("cordova"),r.platform.is("android")&&(console.log("android"),r.initializeService())):(console.log("browser"),r.checkNetworkState())})}return t.prototype.checkNetworkState=function(){var o=this;this.onlineSubscription=u.fromEvent(window,"online").subscribe(function(){var t=o.injector.get(N).translate,e=t.instant("igo.core.network.online.message"),n=t.instant("igo.core.network.online.title");o.messageService.info(e,n),o.state.connection=!0,o.emitEvent()}),this.offlineSubscription=u.fromEvent(window,"offline").subscribe(function(){var t=o.injector.get(N).translate,e=t.instant("igo.core.network.offline.message"),n=t.instant("igo.core.network.offline.title");o.messageService.info(e,n),o.state.connection=!1,o.emitEvent()})},t.prototype.initializeService=function(){var o=this;this.network.type!==this.network.Connection.NONE&&(this.connectionType=this.network.type,this.state.connection=!0),this.offlineSubscription=this.network.onDisconnect().subscribe(function(){o.state.connection=!1,setTimeout(function(){if(!o.state.connection){var t=o.injector.get(N).translate,e=t.instant("igo.core.network.offline.message"),n=t.instant("igo.core.network.offline.title");o.messageService.info(e,n),o.state.connection=!1,o.emitEvent()}},1e4)}),this.onlineSubscription=this.network.onConnect().subscribe(function(){o.state.connection=!0,setTimeout(function(){if(!o.state.connection){var t=o.injector.get(N).translate,e=t.instant("igo.core.network.online.message"),n=t.instant("igo.core.network.online.title");o.messageService.info(e,n),o.state.connection=!0,o.emitEvent()}},1e4)})},t.prototype.emitEvent=function(){this.stateChangeEventEmitter.emit(this.state)},t.prototype.ngOnDestroy=function(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch(t){}},t.prototype.currentState=function(t){return void 0===t&&(t=!0),t?this.stateChangeEventEmitter.pipe(p.debounceTime(300),p.startWith(this.state)):this.stateChangeEventEmitter.pipe(p.debounceTime(300))},t.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:L},{type:g.Injector},{type:l.Network},{type:f.Platform}]},t.ngInjectableDef=g.defineInjectable({factory:function(){return new t(g.inject(L),g.inject(g.INJECTOR),g.inject(d.Network),g.inject(f.Platform))},token:t,providedIn:"root"}),t}(),W=function(){function t(){}return t.decorators=[{type:g.NgModule,args:[{declarations:[],imports:[h.CommonModule],providers:[V]}]}],t}();t.IgoCoreModule=q,t.IgoActivityModule=y,t.IgoConfigModule=S,t.IgoLanguageModule=M,t.IgoMessageModule=O,t.IgoErrorModule=D,t.IgoLoggingModule=B,t.provideConfigOptions=x,t.configFactory=j,t.provideConfigLoader=w,t.CONFIG_OPTIONS=I,t.defaultLanguageLoader=k,t.provideLanguageLoader=function(t){return{provide:r.TranslateLoader,useFactory:t||k,deps:[a.HttpClient]}},t.provideDefaultLanguageLoader=T,t.provideRouteServiceOptions=function(t){return{provide:H,useValue:t}},t.ROUTE_SERVICE_OPTIONS=H,t.RouteService=K,t.ActivityService=m,t.ActivityInterceptor=v,t.AnalyticsService=z,t.ConfigService=b,t.LanguageLoader=E,t.LanguageService=N,t.IgoMissingTranslationHandler=C,t.Media=A,t.MediaOrientation=U,t.MediaService=F,t.MessageCenterComponent=R,t.MessageType=P,t.MessageService=L,t.ErrorInterceptor=$,t.LoggingInterceptor=_,t.NetworkService=V,t.NetworkModule=W,t.ɵa=v,t.ɵb=m,t.ɵc=b,t.ɵg=E,t.ɵf=C,t.ɵh=R,t.ɵe=L,t.ɵd=$,t.ɵi=_,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-core.umd.min.js.map