!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/platform-browser"),require("@angular/material"),require("@igo2/utils"),require("angular2-notifications"),require("@ngx-translate/core"),require("@angular/common/http"),require("@angular/router"),require("@angular/cdk/layout"),require("rxjs"),require("rxjs/operators"),require("@ionic-native/network/ngx"),require("@ionic/angular"),require("@ionic-native/network/ngx/index"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@igo2/core",["exports","@angular/platform-browser","@angular/material","@igo2/utils","angular2-notifications","@ngx-translate/core","@angular/common/http","@angular/router","@angular/cdk/layout","rxjs","rxjs/operators","@ionic-native/network/ngx","@ionic/angular","@ionic-native/network/ngx/index","@angular/core","@angular/common"],e):e((t.igo2=t.igo2||{},t.igo2.core={}),t.ng.platformBrowser,t.ng.material,t.utils,t.i1,t.i1$1,t.ng.common.http,t.ng.router,t.ng.cdk.layout,t.rxjs,t.rxjs.operators,t.ngx,t.i3,t.i2,t.ng.core,t.ng.common)}(this,function(t,e,o,a,n,r,s,i,c,u,p,l,f,d,g,h){"use strict";var v=(m.prototype.register=function(){var t=a.uuid();return this.ids.push(t),this.counter$.next(this.ids.length),t},m.prototype.unregister=function(t){var e=this.ids.indexOf(t);-1!==e&&(this.ids.splice(e,1),this.counter$.next(this.ids.length))},m.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],m.ctorParameters=function(){return[]},m.ngInjectableDef=g.defineInjectable({factory:function(){return new m},token:m,providedIn:"root"}),m);function m(){this.counter$=new u.BehaviorSubject(0),this.ids=[]}var y=(b.prototype.intercept=function(t,e){var o=this,n=t.headers.get("activityInterceptor");if(n){var r=t.clone({headers:t.headers["delete"]("activityInterceptor")});if("false"===n)return e.handle(r)}var i=this.activityService.register();return e.handle(t).pipe(p.finalize(function(){o.activityService.unregister(i)}))},b.decorators=[{type:g.Injectable}],b.ctorParameters=function(){return[{type:v}]},b);function b(t){this.activityService=t}var I=(x.forRoot=function(){return{ngModule:x,providers:[{provide:s.HTTP_INTERCEPTORS,useClass:y,multi:!0}]}},x.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],x);function x(){}var j=(w.prototype.getConfig=function(t){return a.ObjectUtils.resolve(this.config,t)},w.prototype.load=function(o){var n=this,r=o["default"]||{};if(!o.path)return this.config=r,!0;var i=this.injector.get(s.HttpClient);return new Promise(function(e,t){i.get(o.path).pipe(p.catchError(function(t){return console.log("Configuration file "+o.path+" could not be read"),e(!0),u.throwError(t.error||"Server error")})).subscribe(function(t){n.config=a.ObjectUtils.mergeDeep(r,t),e(!0)})})},w.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],w.ctorParameters=function(){return[{type:g.Injector}]},w.ngInjectableDef=g.defineInjectable({factory:function(){return new w(g.inject(g.INJECTOR))},token:w,providedIn:"root"}),w);function w(t){this.injector=t,this.config={}}var S=new g.InjectionToken("configOptions");function k(t){return{provide:S,useValue:t}}function E(t,e){return function(){return t.load(e)}}function T(){return{provide:g.APP_INITIALIZER,useFactory:E,multi:!0,deps:[j,S]}}var C=(M.forRoot=function(){return{ngModule:M,providers:[k({}),T()]}},M.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],M);function M(){}var R=(O.prototype.getTranslation=function(t){var e=require("../locale/"+t+".json"),o=u.of(e);if(this.config&&!this.prefix&&(this.prefix=this.config.getConfig("language.prefix")),!this.prefix)return o;var n=this.http.get(""+this.prefix+t+this.suffix);return u.combineLatest(o,n).pipe(p.map(function(t){return Object.assign(t[0],t[1])}))},O);function O(t,e,o,n){void 0===o&&(o=".json"),this.http=t,this.prefix=e,this.suffix=o,this.config=n}function P(t,e){return new R(t,undefined,undefined,e)}function L(t){return{provide:r.TranslateLoader,useFactory:t||P,deps:[s.HttpClient,j]}}var N=($.prototype.handle=function(t){if(t.translateService.langs.length)throw new Error('The Key "'+t.key+'" is missing in locale file.');throw new Error("Translations are not yet loaded.          Check that the LanguageService is injected.")},$);function $(){}var D=(q.forRoot=function(){return{ngModule:q,providers:[L()]}},q.decorators=[{type:g.NgModule,args:[{imports:[r.TranslateModule.forRoot({missingTranslationHandler:{provide:r.MissingTranslationHandler,useClass:N}})],declarations:[],exports:[r.TranslateModule]}]}],q);function q(){}var _=(Object.defineProperty(B.prototype,"options",{get:function(){return Object.assign({},B.defaultOptions,this._options)},set:function(t){this._options=t},enumerable:!0,configurable:!0}),B.defaultOptions={timeOut:5e3,hasCloseIcon:!1,showProgressBar:!0,pauseOnHover:!0,clickToClose:!0,maxLength:100,maxStack:3,preventDuplicates:!0},B.decorators=[{type:g.Component,args:[{selector:"igo-message-center",template:'<simple-notifications\r\n  [ngClass]="{closeIcon: options.hasCloseIcon}"\r\n  [options]="options">\r\n</simple-notifications>\r\n',styles:["@charset \"UTF-8\";:host>>>div.simple-notification-wrapper{bottom:0;right:calc(50% - 150px)}:host>>>div.simple-notification{min-height:50px;margin-bottom:5px;padding-left:45px;padding-right:25px}:host>>>div.simple-notification.noIcon{padding-left:25px}@media only screen and (max-width:450px),only screen and (max-height:450px){:host>>>div.simple-notification-wrapper{right:0;left:0;width:100%}:host>>>div.simple-notification{margin-bottom:0}}:host>>>div.simple-notification .sn-title{line-height:23px;font-size:15px;font-weight:700}:host>>>div.simple-notification .sn-content{line-height:18px;font-size:15px}:host>>>div.simple-notification .icon{top:0;left:0;width:45px;height:100%;padding:7px}:host>>>div.simple-notification .icon mat-icon{display:flex;align-items:center;height:100%;font-size:32px}:host>>>.closeIcon>>>.sn-title:after{content:'close';font-family:'Material Icons';font-feature-settings:'liga' 1;font-size:24px;font-weight:400;right:5px;top:5px;position:absolute}"]}]}],B.ctorParameters=function(){return[]},B.propDecorators={options:[{type:g.Input}]},B);function B(){this._options={}}var H=(K.forRoot=function(){return{ngModule:K,providers:[]}},K.decorators=[{type:g.NgModule,args:[{imports:[h.CommonModule,n.SimpleNotificationsModule.forRoot()],declarations:[_],exports:[_]}]}],K);function K(){}var z={ERROR:"error",ALERT:"alert",INFO:"info",SUCCESS:"success"},A=(U.prototype.showError=function(t){return t.error.caught=!0,this.error(t.error.message,t.error.title)},U.prototype.message=function(t){var e;if(this.messages$.next(this.messages$.value.concat([t])),t.options=t.options||{},(t=this.handleTemplate(t)).text)e=this.notificationService.create(t.title,t.text,t.type,t.options);else{if(!t.html)return;t.icon||(t.options.theClass=t.options.theClass?t.options.theClass+" noIcon":"noIcon"),e=this.notificationService.html(t.html,t.type,t.options)}return t.icon!==undefined&&this.addIcon(e,t.icon),e},U.prototype.success=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"check",options:o,type:z.SUCCESS})},U.prototype.error=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"error_outline",options:o,type:z.ERROR})},U.prototype.info=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"info_outline",options:o,type:z.INFO})},U.prototype.alert=function(t,e,o){return void 0===o&&(o={}),this.message({text:t,title:e,icon:o.icon||"access_alarm",options:o,type:z.ALERT})},U.prototype.remove=function(t){this.notificationService.remove(t)},U.prototype.addIcon=function(t,e){t.icon='\n      <mat-icon class="material-icons mat-icon mat-list-avatar" svgIcon="'+e+'">\n      </mat-icon>'},U.prototype.handleTemplate=function(t){if(!this.options.template||t.html)return t;var e=this.options.template;return e=(e=(e=e.replace("${text}",t.text)).replace("${title}",t.title)).replace("${icon}",t.icon),t.html=e,t.text=undefined,t.title=undefined,t.icon=undefined,t},U.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],U.ctorParameters=function(){return[{type:n.NotificationsService},{type:j}]},U.ngInjectableDef=g.defineInjectable({factory:function(){return new U(g.inject(n.NotificationsService),g.inject(j))},token:U,providedIn:"root"}),U);function U(t,e){this.notificationService=t,this.configService=e,this.messages$=new u.BehaviorSubject([]),this.options=this.configService.getConfig("message")||{}}var F=(V.prototype.getLanguage=function(){var t=this.translate.getBrowserLang();return t.match(/en|fr/)?t:"en"},V.prototype.setLanguage=function(t){this.translate.use(t),this.translate.reloadLang(t)},V.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],V.ctorParameters=function(){return[{type:r.TranslateService}]},V.ngInjectableDef=g.defineInjectable({factory:function(){return new V(g.inject(r.TranslateService))},token:V,providedIn:"root"}),V);function V(t){this.translate=t;var e=this.getLanguage();this.translate.setDefaultLang(e)}var W=(J.prototype.intercept=function(e,t){var o=this;return t.handle(e).pipe(p.catchError(function(t){return o.handleError(t,e)}),p.finalize(function(){return o.handleCaughtError()}),p.finalize(function(){return o.handleUncaughtError()}))},J.prototype.handleError=function(t,e){var o=e.method+" "+e.urlWithParams+" "+t.status+" ("+t.statusText+")";if(t instanceof s.HttpErrorResponse){var n="object"===t.error?t.error:{};n.message=t.error.message||t.statusText,n.caught=!1,console.error(o,"\n",n.message,"\n\n",t),this.httpError=new s.HttpErrorResponse({error:n,headers:t.headers,status:t.status,statusText:t.statusText,url:t.url})}return u.throwError(this.httpError)},J.prototype.handleCaughtError=function(){this.httpError&&this.httpError.error.toDisplay&&(this.httpError.error.caught=!0,this.messageService.error(this.httpError.error.message,this.httpError.error.title))},J.prototype.handleUncaughtError=function(){if(this.httpError&&!this.httpError.error.caught){var t=this.injector.get(F).translate,e=t.instant("igo.core.errors.uncaught.message"),o=t.instant("igo.core.errors.uncaught.title");this.httpError.error.caught=!0,this.messageService.error(e,o)}},J.decorators=[{type:g.Injectable}],J.ctorParameters=function(){return[{type:A},{type:g.Injector}]},J);function J(t,e){this.messageService=t,this.injector=e}var G=(Z.forRoot=function(){return{ngModule:Z,providers:[{provide:s.HTTP_INTERCEPTORS,useClass:W,multi:!0}]}},Z.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],Z);function Z(){}var Q=(X.forRoot=function(){return{ngModule:X,providers:[]}},X.decorators=[{type:g.NgModule,args:[{imports:[h.CommonModule,s.HttpClientModule,I.forRoot(),C.forRoot(),G.forRoot(),D.forRoot(),H.forRoot()],declarations:[],exports:[I,C,G,D,H]}]}],X.ctorParameters=function(){return[{type:o.MatIconRegistry},{type:e.DomSanitizer}]},X);function X(t,e){t.addSvgIconSet(e.bypassSecurityTrustResourceUrl("./assets/igo2/core/icons/mdi.svg"))}var Y=(tt.prototype.intercept=function(o,t){var n,r=Date.now();return t.handle(o).pipe(p.tap(function(t){return n=t instanceof s.HttpResponse?"succeeded":""},function(t){return n="failed"}),p.finalize(function(){var t=Date.now()-r,e=o.method+' "'+o.urlWithParams+'"\n             '+n+" in "+t+" ms.";console.log(e)}))},tt.decorators=[{type:g.Injectable}],tt);function tt(){}var et=(ot.forRoot=function(){return{ngModule:ot,providers:[{provide:s.HTTP_INTERCEPTORS,useClass:Y,multi:!0}]}},ot.decorators=[{type:g.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],ot);function ot(){}var nt=new g.InjectionToken("routeServiceOptions");var rt=(Object.defineProperty(it.prototype,"queryParams",{get:function(){return this.route.queryParams},enumerable:!0,configurable:!0}),it.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],it.ctorParameters=function(){return[{type:i.ActivatedRoute},{type:undefined,decorators:[{type:g.Inject,args:[nt]},{type:g.Optional}]}]},it.ngInjectableDef=g.defineInjectable({factory:function(){return new it(g.inject(i.ActivatedRoute),g.inject(nt,8))},token:it,providedIn:"root"}),it);function it(t,e){this.route=t;this.options=Object.assign({},{centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",routingCoordKey:"routing",toolKey:"tool",llcKKey:"llck",llcAKey:"llca",llcVKey:"llcv",llcRKey:"llcr"},e)}var at=(st.prototype.initMatomo=function(){var o=this;if(this.options.url&&this.options.id){window._paq=window._paq||[];var n=window._paq;n.push(["trackPageView"]),n.push(["enableLinkTracking"]),function(){n.push(["setTrackerUrl",o.options.url+"matomo.php"]),n.push(["setSiteId",o.options.id]);var t=document.createElement("script"),e=document.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.defer=!0,t.src=o.options.url+"matomo.js",e.parentNode.insertBefore(t,e)}()}},st.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],st.ctorParameters=function(){return[{type:j}]},st.ngInjectableDef=g.defineInjectable({factory:function(){return new st(g.inject(j))},token:st,providedIn:"root"}),st);function st(t){this.config=t,this.options=this.config.getConfig("analytics")||{},"matomo"===this.options.provider&&this.initMatomo()}var ct={Mobile:"mobile",Tablet:"tablet",Desktop:"desktop"},ut={Portrait:"portrait",Landscape:"landscape"},pt=(lt.prototype.getMedia=function(){return this.media$.value},lt.prototype.getOrientation=function(){return this.orientation$.value},lt.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],lt.ctorParameters=function(){return[{type:c.BreakpointObserver}]},lt.ngInjectableDef=g.defineInjectable({factory:function(){return new lt(g.inject(c.BreakpointObserver))},token:lt,providedIn:"root"}),lt);function lt(t){var e=this;this.media$=new u.BehaviorSubject(undefined),this.orientation$=new u.BehaviorSubject(undefined),t.observe([c.Breakpoints.HandsetLandscape]).subscribe(function(t){t.matches&&(e.media$.next(ct.Mobile),e.orientation$.next(ut.Landscape))}),t.observe([c.Breakpoints.HandsetPortrait]).subscribe(function(t){t.matches&&(e.media$.next(ct.Mobile),e.orientation$.next(ut.Portrait))}),t.observe([c.Breakpoints.TabletLandscape]).subscribe(function(t){t.matches&&(e.media$.next(ct.Tablet),e.orientation$.next(ut.Landscape))}),t.observe([c.Breakpoints.TabletPortrait]).subscribe(function(t){t.matches&&(e.media$.next(ct.Tablet),e.orientation$.next(ut.Portrait))}),t.observe([c.Breakpoints.WebLandscape]).subscribe(function(t){t.matches&&(e.media$.next(ct.Desktop),e.orientation$.next(ut.Landscape))}),t.observe([c.Breakpoints.WebPortrait]).subscribe(function(t){t.matches&&(e.media$.next(ct.Desktop),e.orientation$.next(ut.Portrait))})}var ft=(dt.prototype.checkNetworkState=function(){var n=this;this.onlineSubscription=u.fromEvent(window,"online").subscribe(function(){var t=n.injector.get(F).translate,e=t.instant("igo.core.network.online.message"),o=t.instant("igo.core.network.online.title");n.messageService.info(e,o),n.state.connection=!0,n.emitEvent()}),this.offlineSubscription=u.fromEvent(window,"offline").subscribe(function(){var t=n.injector.get(F).translate,e=t.instant("igo.core.network.offline.message"),o=t.instant("igo.core.network.offline.title");n.messageService.info(e,o),n.state.connection=!1,n.emitEvent()})},dt.prototype.checkNetworkStateMobile=function(){var n=this;this.network.type!==this.network.Connection.NONE&&(this.connectionType=this.network.type,this.state.connection=!0),this.offlineSubscription=this.network.onDisconnect().subscribe(function(){n.state.connection=!1,setTimeout(function(){if(!n.state.connection){var t=n.injector.get(F).translate,e=t.instant("igo.core.network.offline.message"),o=t.instant("igo.core.network.offline.title");n.messageService.info(e,o),n.state.connection=!1,n.emitEvent()}},1e4)}),this.onlineSubscription=this.network.onConnect().subscribe(function(){n.state.connection=!0,setTimeout(function(){if(!n.state.connection){var t=n.injector.get(F).translate,e=t.instant("igo.core.network.online.message"),o=t.instant("igo.core.network.online.title");n.messageService.info(e,o),n.state.connection=!0,n.emitEvent()}},1e4)})},dt.prototype.emitEvent=function(){this.stateChangeEventEmitter.emit(this.state)},dt.prototype.ngOnDestroy=function(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch(t){}},dt.prototype.currentState=function(t){return void 0===t&&(t=!0),t?this.stateChangeEventEmitter.pipe(p.debounceTime(300),p.startWith(this.state)):this.stateChangeEventEmitter.pipe(p.debounceTime(300))},dt.decorators=[{type:g.Injectable,args:[{providedIn:"root"}]}],dt.ctorParameters=function(){return[{type:A},{type:g.Injector},{type:l.Network},{type:f.Platform}]},dt.ngInjectableDef=g.defineInjectable({factory:function(){return new dt(g.inject(A),g.inject(g.INJECTOR),g.inject(d.Network),g.inject(f.Platform))},token:dt,providedIn:"root"}),dt);function dt(t,e,o,n){var r=this;this.messageService=t,this.injector=e,this.network=o,this.platform=n,this.stateChangeEventEmitter=new g.EventEmitter,this.state={connection:window.navigator.onLine},this.platform.ready().then(function(){r.platform.is("cordova")?r.platform.is("android")&&r.checkNetworkStateMobile():(console.log("browser"),r.checkNetworkState())})}var gt=(ht.decorators=[{type:g.NgModule,args:[{declarations:[],imports:[h.CommonModule],providers:[ft]}]}],ht);function ht(){}t.IgoCoreModule=Q,t.IgoActivityModule=I,t.IgoConfigModule=C,t.IgoLanguageModule=D,t.IgoMessageModule=H,t.IgoErrorModule=G,t.IgoLoggingModule=et,t.provideConfigOptions=k,t.configFactory=E,t.provideConfigLoader=T,t.CONFIG_OPTIONS=S,t.defaultLanguageLoader=P,t.provideLanguageLoader=function vt(t){return{provide:r.TranslateLoader,useFactory:t||P,deps:[s.HttpClient]}},t.provideDefaultLanguageLoader=L,t.provideRouteServiceOptions=function mt(t){return{provide:nt,useValue:t}},t.ROUTE_SERVICE_OPTIONS=nt,t.RouteService=rt,t.ActivityService=v,t.ActivityInterceptor=y,t.AnalyticsService=at,t.ConfigService=j,t.LanguageLoader=R,t.LanguageService=F,t.IgoMissingTranslationHandler=N,t.Media=ct,t.MediaOrientation=ut,t.MediaService=pt,t.MessageCenterComponent=_,t.MessageType=z,t.MessageService=A,t.ErrorInterceptor=W,t.LoggingInterceptor=Y,t.NetworkService=ft,t.NetworkModule=gt,t.ɵa=y,t.ɵb=v,t.ɵc=j,t.ɵg=R,t.ɵf=N,t.ɵh=_,t.ɵe=A,t.ɵd=W,t.ɵi=Y,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-core.umd.min.js.map