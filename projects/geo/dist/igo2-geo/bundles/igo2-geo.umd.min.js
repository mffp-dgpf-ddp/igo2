!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ol-mapbox-style/stylefunction"),require("ol/source/OSM"),require("ol/source/XYZ"),require("ol/format/filter"),require("ol/format/WFS"),require("ol/format/GML32"),require("ol/format/OSMXML"),require("ol/source/ImageWMS"),require("ol/source/WMTS"),require("ol/tilegrid/WMTS"),require("ol/extent.js"),require("ol/source/CartoDB"),require("ol/loadingstrategy"),require("ol/source/TileArcGISRest"),require("ts-md5"),require("ol/source/VectorTile"),require("ol/format/MVT"),require("ol/source/Cluster"),require("ngx-cacheable"),require("ol/source/WMTS.js"),require("ol/Map"),require("ol/View"),require("ol/Geolocation"),require("ol/control/Attribution"),require("ol/control/ScaleLine"),require("ol/geom/Circle"),require("ol/geom/GeometryLayout"),require("ol/layer/Image"),require("ol/layer/Tile"),require("ol/color"),require("ol/layer/VectorTile"),require("ol/easing"),require("ol/has"),require("proj4"),require("ol/proj/proj4"),require("@angular/animations"),require("ol/format/GML2"),require("ol/format/GML3"),require("ol/format/EsriJSON"),require("ol/render/Feature"),require("ol/proj/Projection"),require("@angular/platform-browser"),require("@mat-datetimepicker/core"),require("ol/geom/Point"),require("ol/Overlay"),require("ol/extent"),require("ol/sphere"),require("ol/style/Style"),require("ol/geom/LineString"),require("@turf/line-intersect"),require("@turf/helpers"),require("ol/interaction/Modify"),require("ol/interaction/Translate"),require("ol/interaction/Draw"),require("ol/geom/Polygon"),require("ol/geom/LinearRing"),require("ol/interaction/DragBox"),require("ol/source/Vector"),require("ol/layer/Vector"),require("moment"),require("@angular/cdk/collections"),require("@angular/cdk/tree"),require("file-saver"),require("jspdf"),require("html2canvas"),require("jszip"),require("ol/events/condition"),require("ol/interaction"),require("ol/Observable"),require("@igo2/auth"),require("@angular/forms"),require("ol/Feature"),require("ol/proj"),require("ol/style"),require("ol/geom"),require("ol/format/GeoJSON"),require("@angular/material"),require("@angular/common"),require("@igo2/common"),require("ol/format/WKT"),require("rxjs"),require("ol/format"),require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("@igo2/utils"),require("@igo2/core")):"function"==typeof define&&define.amd?define("@igo2/geo",["exports","ol-mapbox-style/stylefunction","ol/source/OSM","ol/source/XYZ","ol/format/filter","ol/format/WFS","ol/format/GML32","ol/format/OSMXML","ol/source/ImageWMS","ol/source/WMTS","ol/tilegrid/WMTS","ol/extent.js","ol/source/CartoDB","ol/loadingstrategy","ol/source/TileArcGISRest","ts-md5","ol/source/VectorTile","ol/format/MVT","ol/source/Cluster","ngx-cacheable","ol/source/WMTS.js","ol/Map","ol/View","ol/Geolocation","ol/control/Attribution","ol/control/ScaleLine","ol/geom/Circle","ol/geom/GeometryLayout","ol/layer/Image","ol/layer/Tile","ol/color","ol/layer/VectorTile","ol/easing","ol/has","proj4","ol/proj/proj4","@angular/animations","ol/format/GML2","ol/format/GML3","ol/format/EsriJSON","ol/render/Feature","ol/proj/Projection","@angular/platform-browser","@mat-datetimepicker/core","ol/geom/Point","ol/Overlay","ol/extent","ol/sphere","ol/style/Style","ol/geom/LineString","@turf/line-intersect","@turf/helpers","ol/interaction/Modify","ol/interaction/Translate","ol/interaction/Draw","ol/geom/Polygon","ol/geom/LinearRing","ol/interaction/DragBox","ol/source/Vector","ol/layer/Vector","moment","@angular/cdk/collections","@angular/cdk/tree","file-saver","jspdf","html2canvas","jszip","ol/events/condition","ol/interaction","ol/Observable","@igo2/auth","@angular/forms","ol/Feature","ol/proj","ol/style","ol/geom","ol/format/GeoJSON","@angular/material","@angular/common","@igo2/common","ol/format/WKT","rxjs","ol/format","@angular/core","@angular/common/http","rxjs/operators","@igo2/utils","@igo2/core"],t):t((e.igo2=e.igo2||{},e.igo2.geo={}),e.stylefunction,e.olSourceOSM,e.olSourceXYZ,e.olfilter,e.olFormatWFS,e.olFormatGML32,e.olFormatOSMXML,e.olSourceImageWMS,e.olSourceWMTS,e.olTileGridWMTS,e.extent_js,e.olSourceCarto,e.OlLoadingStrategy,e.olSourceTileArcGISRest,e.tsMd5,e.olSourceVectorTile,e.olFormatMVT,e.olSourceCluster,e.ngxCacheable,e.WMTS_js,e.olMap,e.olView,e.olGeolocation,e.olAttribution,e.olControlScaleLine,e.olCircle,e.OlGeometryLayout,e.olLayerImage,e.olLayerTile,e.color,e.olLayerVectorTile,e.oleasing,e.has,e.proj4,e.olproj4,e.ng.animations,e.olFormatGML2,e.olFormatGML3,e.olFormatEsriJSON,e.OlRenderFeature,e.olProjection,e.ng.platformBrowser,e.core,e.OlPoint,e.OlOverlay,e.olextent,e.sphere,e.OlStyle,e.OlLineString,e.lineIntersect,e.helpers,e.OlModify,e.OlTranslate,e.OlDraw,e.OlPolygon,e.OlLinearRing,e.OlDragBoxInteraction,e.OlVectorSource,e.OlVectorLayer,e.moment,e.ng.cdk.collections,e.ng.cdk.tree,e.fileSaver,e.jsPDF,e._html2canvas,e.JSZip,e.olcondition,e.olinteraction,e.olobservable,e.i4,e.ng.forms,e.olFeature,e.olproj,e.olstyle,e.olgeom,e.OlGeoJSON,e.ng.material,e.ng.common,e.common$1,e.olWKT,e.rxjs,e.olformat,e.ng.core,e.ng.common.http,e.rxjs.operators,e.utils,e.i1$1)}(this,function(e,o,t,r,b,l,n,i,a,s,u,c,p,d,h,g,f,m,y,v,S,w,I,F,O,T,x,C,M,L,P,D,k,j,E,R,$,A,G,B,_,q,N,V,U,W,z,K,H,Y,Z,Q,J,X,ee,te,re,oe,ne,ie,ae,se,le,ue,ce,pe,de,he,ge,fe,me,ye,ve,be,Se,we,Ie,Fe,Oe,Te,xe,Ce,Me,Le,Pe,De,ke,je){"use strict";o=o&&o.hasOwnProperty("default")?o["default"]:o,t=t&&t.hasOwnProperty("default")?t["default"]:t,r=r&&r.hasOwnProperty("default")?r["default"]:r,l=l&&l.hasOwnProperty("default")?l["default"]:l,n=n&&n.hasOwnProperty("default")?n["default"]:n,i=i&&i.hasOwnProperty("default")?i["default"]:i,a=a&&a.hasOwnProperty("default")?a["default"]:a,s=s&&s.hasOwnProperty("default")?s["default"]:s,u=u&&u.hasOwnProperty("default")?u["default"]:u,p=p&&p.hasOwnProperty("default")?p["default"]:p,h=h&&h.hasOwnProperty("default")?h["default"]:h,f=f&&f.hasOwnProperty("default")?f["default"]:f,m=m&&m.hasOwnProperty("default")?m["default"]:m,y=y&&y.hasOwnProperty("default")?y["default"]:y,w=w&&w.hasOwnProperty("default")?w["default"]:w,I=I&&I.hasOwnProperty("default")?I["default"]:I,F=F&&F.hasOwnProperty("default")?F["default"]:F,O=O&&O.hasOwnProperty("default")?O["default"]:O,T=T&&T.hasOwnProperty("default")?T["default"]:T,x=x&&x.hasOwnProperty("default")?x["default"]:x,C=C&&C.hasOwnProperty("default")?C["default"]:C,M=M&&M.hasOwnProperty("default")?M["default"]:M,L=L&&L.hasOwnProperty("default")?L["default"]:L,D=D&&D.hasOwnProperty("default")?D["default"]:D,E=E&&E.hasOwnProperty("default")?E["default"]:E,A=A&&A.hasOwnProperty("default")?A["default"]:A,G=G&&G.hasOwnProperty("default")?G["default"]:G,B=B&&B.hasOwnProperty("default")?B["default"]:B,_=_&&_.hasOwnProperty("default")?_["default"]:_,q=q&&q.hasOwnProperty("default")?q["default"]:q,U=U&&U.hasOwnProperty("default")?U["default"]:U,W=W&&W.hasOwnProperty("default")?W["default"]:W,H=H&&H.hasOwnProperty("default")?H["default"]:H,Y=Y&&Y.hasOwnProperty("default")?Y["default"]:Y,Z=Z&&Z.hasOwnProperty("default")?Z["default"]:Z,J=J&&J.hasOwnProperty("default")?J["default"]:J,X=X&&X.hasOwnProperty("default")?X["default"]:X,ee=ee&&ee.hasOwnProperty("default")?ee["default"]:ee,te=te&&te.hasOwnProperty("default")?te["default"]:te,re=re&&re.hasOwnProperty("default")?re["default"]:re,oe=oe&&oe.hasOwnProperty("default")?oe["default"]:oe,ne=ne&&ne.hasOwnProperty("default")?ne["default"]:ne,ie=ie&&ie.hasOwnProperty("default")?ie["default"]:ie,ve=ve&&ve.hasOwnProperty("default")?ve["default"]:ve,Ie=Ie&&Ie.hasOwnProperty("default")?Ie["default"]:Ie,xe=xe&&xe.hasOwnProperty("default")?xe["default"]:xe;var Ee=(Re.prototype.open=function(e){e.extern&&window.open(e.url,"_blank")},Re.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Re.ctorParameters=function(){return[]},Re.ngInjectableDef=Le.defineInjectable({factory:function(){return new Re},token:Re,providedIn:"root"}),Re);function Re(){}var $e=(Object.defineProperty(Ae.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ae.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Ae.prototype.openMetadata=function(e){this.metadataService.open(e)},Object.defineProperty(Ae.prototype,"options",{get:function(){if(this.layer)return this.layer.options},enumerable:!0,configurable:!0}),Ae.decorators=[{type:Le.Component,args:[{selector:"igo-metadata-button",template:'<button\r\n  *ngIf="options && options.metadata && options.metadata.url"\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.metadata.show\' | translate"\r\n  [color]="color"\r\n  (click)="openMetadata(options.metadata)">\r\n  <mat-icon svgIcon="information-outline"></mat-icon>\r\n</button>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Ae.ctorParameters=function(){return[{type:Ee}]},Ae.propDecorators={layer:[{type:Le.Input}],color:[{type:Le.Input}]},Ae);function Ae(e){this.metadataService=e,this._color="primary"}var Ge=(Be.forRoot=function(){return{ngModule:Be,providers:[]}},Be.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTooltipModule,je.IgoLanguageModule],exports:[$e],declarations:[$e]}]}],Be);function Be(){}var _e=function(e,t){return(_e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function qe(e,t){function r(){this.constructor=e}_e(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Ne=function(){return(Ne=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function Ve(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(i<3?n(a):3<i?n(t,r,a):n(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a}function Ue(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function We(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function ze(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)a.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return a}function Ke(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ze(arguments[t]));return e}var He=function gd(){};function Ye(e){return({wms:Ze,wmts:Qe,xyz:Je,feature:Xe,osm:function(e){return"OSM"}}[e.type]||et)(e)}function Ze(e){var t=e.params.LAYERS,r="wms"+("/"===e.url.charAt(0)?window.location.origin+e.url:e.url)+t;return g.Md5.hashStr(r)}function Qe(e){var t=e.layer,r="wmts"+e.url+t;return g.Md5.hashStr(r)}function Je(e){var t="xyz"+e.url;return g.Md5.hashStr(t)}function Xe(e){if(!e.url)return et(e);var t="feature"+e.url;return g.Md5.hashStr(t)}function et(e){return ke.uuid()}var tt=(rt.prototype.generateId=function(){return Ye(this.options)},rt.prototype.getLegend=function(e,t){return this.legend?this.legend:[]},rt.prototype.setLegend=function(e){return e.url?this.legend=[{url:e.url}]:e.html?this.legend=[{html:e.html}]:this.legend=[],this.legend},rt);function rt(e,t){void 0===e&&(e={}),this.options=e,this.dataService=t,this.options=e,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}var ot,nt=(qe(it,ot=tt),it.prototype.createOlSource=function(){var e={format:this.getSourceFormatFromOptions(this.options)};return new ne(Object.assign(e,this.options))},it.prototype.getSourceFormatFromOptions=function(e){if(e.format)return e.format;var t,r=e.formatType;if(r){if((t=Me[r])===undefined)throw new Error("Invalid vector source format ${formatType}.")}else t=Me.GeoJSON;var o=e.formatOptions;return o?new t(o):new t},it.prototype.onUnwatch=function(){},Object.defineProperty(it.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),it);function it(){return null!==ot&&ot.apply(this,arguments)||this}var at,st=(qe(lt,at=tt),lt.prototype.createOlSource=function(){return this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png",new t(this.options)},lt.prototype.onUnwatch=function(){},lt);function lt(){return null!==at&&at.apply(this,arguments)||this}var ut,ct=(qe(pt,ut=tt),pt.prototype.createOlSource=function(){return new r(this.options)},pt.prototype.onUnwatch=function(){},pt);function pt(){return null!==ut&&ut.apply(this,arguments)||this}var dt=(ht.prototype.defineOgcFiltersDefaultOptions=function(e,t,r){var o=!0;return r&&"wms"===r&&(o=!1),(e=e||{}).enabled=e.enabled===undefined?o:e.enabled,e.editable=e.editable===undefined?o:e.editable,e.geometryName=t,e.advancedOgcFilters=!0,e.enabled&&e.pushButtons&&(e.advancedOgcFilters=!1),e},ht.prototype.buildFilter=function(e,t,r,o){var n,i;if(i=!/intersects|contains|within/gi.test(JSON.stringify(e)),e&&(o=e.geometryName!==undefined?e.geometryName:o),t&&e&&(n=b.bbox(o,t,r.getCode())),!e)return"bbox="+t.join(",")+","+r.getCode();e=this.checkIgoFiltersProperties(e,o,r);var a={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:t&&i?b.and(n,this.bundleFilter(e)):this.bundleFilter(e),outputFormat:"",geometryName:o},s=(new l).writeGetFeature(a);return"filter="+(new XMLSerializer).serializeToString(s).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]},ht.prototype.bundleFilter=function(e){var t=this;if(e instanceof Array){var r=[];return e.forEach(function(e){r.push(t.bundleFilter(e))}),r}return e.hasOwnProperty("logical")?this.createFilter({operator:e.logical,logicalArray:this.bundleFilter(e.filters)}):e.hasOwnProperty("operator")?this.createFilter(e):void 0},ht.prototype.createFilter=function(e){var t,r=e.operator,o=e.logicalArray,n=e.propertyName,i=e.pattern,a=!e.matchCase||e.matchCase,s=e.wildCard?e.wildCard:"*",l=e.singleChar?e.singleChar:".",u=e.escapeChar?e.escapeChar:"!",c=e.lowerBoundary,p=e.upperBoundary,d=e.geometryName,h=e.extent,g=e.wkt_geometry,f=e.srsName?e.srsName:"EPSG:3857",m=e.begin,y=e.end,v=e.expression;switch(g&&(t=(new xe).readGeometry(g,{dataProjection:f,featureProjection:f||"EPSG:3857"})),r){case"BBOX":return b.bbox(d,h,f);case"PropertyIsBetween":return b.between(n,c,p);case"Contains":return b.contains(d,t,f);case"During":return b.during(n,m,y);case"PropertyIsEqualTo":return b.equalTo(n,v,a);case"PropertyIsGreaterThan":return b.greaterThan(n,v);case"PropertyIsGreaterThanOrEqualTo":return b.greaterThanOrEqualTo(n,v);case"Intersects":return b.intersects(d,t,f);case"PropertyIsNull":return b.isNull(n);case"PropertyIsLessThan":return b.lessThan(n,v);case"PropertyIsLessThanOrEqualTo":return b.lessThanOrEqualTo(n,v);case"PropertyIsLike":return b.like(n,i.replace(/[()_]/gi,l),s,l,u,a);case"PropertyIsNotEqualTo":return b.notEqualTo(n,v,a);case"Within":return b.within(d,t,f);case"And":return b.and.apply(null,o);case"Or":return b.or.apply(null,o);case"Not":return b.not.apply(null,o);default:return undefined}},ht.prototype.defineInterfaceFilterSequence=function(e,t,r,o){var n=this;return void 0===r&&(r=""),void 0===o&&(o=-1),e instanceof Array?e.forEach(function(e){n.filterSequence.concat(n.defineInterfaceFilterSequence(e,t,r,o))}):e.hasOwnProperty("logical")?(o+=1,this.filterSequence.concat(this.defineInterfaceFilterSequence(e.filters,t,e.logical,o))):e.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(e,t,o,r)),this.filterSequence},ht.prototype.addInterfaceFilter=function(e,t,r,o){void 0===r&&(r=0),void 0===o&&(o="Or"),e=e||{operator:"PropertyIsEqualTo"};var n={propertyName:"",operator:"",active:"",filterid:ke.uuid(),begin:"",end:"",lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(n,{parentLogical:o,level:r,geometryName:t},e)},ht.prototype.checkIgoFiltersProperties=function(e,t,r,o){var n=this;void 0===o&&(o=!1);var i=[];return e instanceof Array?(e.forEach(function(e){i.push(n.checkIgoFiltersProperties(e,t,r,o))}),i):e.hasOwnProperty("logical")?Object.assign({},{logical:e.logical,filters:this.checkIgoFiltersProperties(e.filters,t,r,o)}):e.hasOwnProperty("operator")?this.addFilterProperties(e,t,r,o):void 0},ht.prototype.addFilterProperties=function(e,t,r,o){void 0===o&&(o=!1);var n=e.hasOwnProperty("filterid")?e.filterid:ke.uuid(),i=e.hasOwnProperty("active")?e.active:o,a=e.hasOwnProperty("srsName")?e.srsName:r?r.getCode():"EPSG:3857";return Object.assign({},{filterid:n,active:i,igoSpatialSelector:"fixedExtent",srsName:a},e,{geometryName:t})},ht.prototype.rebuiltIgoOgcFilterObjectFromSequence=function(o){if(o instanceof Array){if(1<=o.length){var n,i,a=o[0].parentLogical,s=[];return o.forEach(function(e){var t=Object.assign({},e),r=o.indexOf(e);n=0<=r&&r<o.length-1?o[r+1]:t,delete t.active,delete t.filterid,delete t.parentLogical,s.push(t),1===o.length?i=t:a!==n.parentLogical&&(1===s.length?console.log("You must set at least two operator in a logical ("+a+")"):(i=Object.assign({},{logical:a,filters:s}),s=[i],a=n.parentLogical))}),i}return undefined}return undefined},ht.prototype.computeIgoPushButton=function(e){if(e.groups.every(function(e){return e.computedButtons!==undefined}))return e;var r;if(e.groups&&e.bundles){if(!e.bundles.every(function(e){return e.id!==undefined}))throw new Error("You must set an id for each of your pushButtons bundles");(r=ke.ObjectUtils.copyDeep(e)).groups.forEach(function(t){t.title=t.title?t.title:t.name,t.enabled=!!t.enabled&&t.enabled,t.computedButtons=ke.ObjectUtils.copyDeep(r.bundles.filter(function(e){return t.ids.includes(e.id)}))})}else!e.groups&&e.bundles?(r=ke.ObjectUtils.copyDeep(e)).groups=[{title:"group1",name:"group1",computedButtons:ke.ObjectUtils.copyDeep(r.bundles)}]:r={bundles:e,groups:[{title:"group1",name:"group1",computedButtons:ke.ObjectUtils.copyDeep(e)}]};return r.groups.find(function(e){return e.enabled})||(r.groups[0].enabled=!0),r},ht.prototype.handleOgcFiltersAppliedValue=function(e,t,r,o){var n=e.ogcFilters;if(n){var i="",a="";if(n.enabled&&n.pushButtons){n.pushButtons=this.computeIgoPushButton(n.pushButtons);var s=n.pushButtons.groups.find(function(e){return e.enabled}).computedButtons,l=[];s.map(function(e){var t=[];e.buttons.filter(function(e){return!0===e.enabled}).forEach(function(e){return t.push(e.filters)}),1===t.length?l.push(t[0]):1<t.length&&l.push({logical:e.logical,filters:t})}),1<=l.length&&(i=this.buildFilter(1===l.length?l[0]:{logical:"And",filters:l},r,o,n.geometryName))}if(n.enabled&&n.filters){n.geometryName=n.geometryName||t;var u=n.filters;a=this.buildFilter(u,r,o,n.geometryName)}var c=n.advancedOgcFilters?a:i;return"wms"===e.type&&(c=this.formatProcessedOgcFilter(c,e.params.LAYERS)),"wfs"===e.type&&(c=this.formatProcessedOgcFilter(c,e.params.featureTypes)),c}},ht.prototype.formatProcessedOgcFilter=function(t,e){var r="";return 0===t.length&&-1===e.indexOf(",")?r=t:e.split(",").forEach(function(e){r=r+"("+t.replace("filter=","")+")"}),0<r.length?r.replace("filter=",""):undefined},ht);function ht(){this.filterSequence=[],this.operators={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsLike:{spatial:!1,fieldRestrict:["string"]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsBetween:{spatial:!1,fieldRestrict:["number"]},During:{spatial:!1,fieldRestrict:[]},PropertyIsNull:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]},Contains:{spatial:!0,fieldRestrict:[]}}}var gt="EPSG:3857",ft=5e3,mt="2.0.0",yt="geometry",vt=new RegExp(/(.*)?gml(.*)?/gi),bt=new RegExp(/(.*)?json(.*)?/gi);function St(e,t,r,o){var n="2.0.0",i=e.urlWfs,a=e.paramsWFS,s=t||ft,l=r||gt,u=a.outputFormat?"outputFormat="+a.outputFormat:"",c=a.version?"version="+a.version:"version="+mt,p=(a.version===n?"typenames":"typename")+"="+a.featureTypes,d=a.version===n?"count":"maxFeatures",h=t?d+"="+s:a.maxFeatures?d+"="+a.maxFeatures:d+"="+s,g=r?"srsname="+l:a.srsName?"srsname="+a.srsName:"srsname="+l,f="",m="";o&&(f="propertyName="+o,m="valueReference="+o);var y=e.sourceFields;if(!f&&y&&0<y.length){var v=[];e.sourceFields.forEach(function(e){v.push(e.name)}),f="propertyName="+v.join(",")+","+a.fieldNameGeometry}var b=i+"?service=WFS&request=GetFeature&"+c+"&"+p+"&";b+=u+"&"+g+"&"+h+"&"+f;var S=i+"?service=WFS&request=GetPropertyValue&version="+n+"&"+p+"&";return S+="&"+h+"&"+m,[{name:"outputformat",value:u},{name:"version",value:c},{name:"typename",value:p},{name:"count",value:h},{name:"srsname",value:g},{name:"propertyname",value:f},{name:"valuereference",value:m},{name:"getcapabilities",value:(i+"?service=WFS&request=GetCapabilities&"+c).replace(/&&/g,"&")},{name:"getfeature",value:b.replace(/&&/g,"&")},{name:"getpropertyvalue",value:S.replace(/&&/g,"&")}]}function wt(e,t){t&&"wfs"===t&&(e.paramsWFS=e.params);var r,o=e.paramsWFS;return e.urlWfs=e.urlWfs||e.url,o.version=o.version||mt,o.fieldNameGeometry=o.fieldNameGeometry||yt,o.maxFeatures=o.maxFeatures||ft,o.outputFormat&&(r=o.outputFormat),!vt.test(r)&&r||(o.version="1.1.0"),Object.assign({},e)}function It(e){var t=Me.WFS,r=e.paramsWFS.outputFormat?e.paramsWFS.outputFormat:undefined;return r?Me[r]?new(t=Me[r]):r.toLowerCase().match("gml2")?new(t=Me.WFS)({gmlFormat:A}):r.toLowerCase().match("gml32")?new(t=Me.WFS)({gmlFormat:n}):r.toLowerCase().match("gml3")?new(t=Me.WFS)({gmlFormat:G}):r.toLowerCase().match("topojson")?new(t=Me.TopoJSON):r.toLowerCase().match("geojson")?new(t=Me.GeoJSON):r.toLowerCase().match("esrijson")?new(t=Me.EsriJSON):r.toLowerCase().match("json")?new(t=Me.GeoJSON):r.toLowerCase().match("gpx")?new(t=Me.GPX):r.toLowerCase().match("WKT")?new(t=Me.WKT):r.toLowerCase().match("osmxml")?new(t=i):r.toLowerCase().match("kml")?new(t=Me.KML):new t:new t}var Ft,Ot=(qe(Tt,Ft=tt),Tt.prototype.createOlSource=function(){var o=this;return new ne({format:It(this.options),overlaps:!1,url:function(e,t,r){return o.options.paramsWFS.srsName=o.options.paramsWFS.srsName||r.getCode(),o.buildUrl(e,r,o.options.ogcFilters)},strategy:d.bbox})},Tt.prototype.buildUrl=function(e,t,r){var o,n=this.options.paramsWFS,i=St(this.options,undefined,t.getCode());r&&r.enabled&&(o=r.filters);var a=new dt,s=a.buildFilter(o,e,t,r.geometryName),l=a.handleOgcFiltersAppliedValue(this.options,r.geometryName),u="filter";l||(u="bbox",l=e.join(",")+","+t.getCode()),n.xmlFilter=r.advancedOgcFilters?s:u+"="+l;var c=i.find(function(e){return"getfeature"===e.name}).value;return c=/(filter|bbox)=.*/gi.test(n.xmlFilter)?c+"&"+n.xmlFilter:c,this.options.download=Object.assign({},this.options.download,{dynamicUrl:c}),c.replace(/&&/g,"&")},Tt.prototype.onUnwatch=function(){},Tt);function Tt(e,t){var r=Ft.call(this,wt(e,"wfs"))||this;r.options=e,r.wfsService=t;var o=r.options.ogcFilters,n=r.options.paramsWFS.fieldNameGeometry||yt,i=new dt;return r.options.ogcFilters=i.defineOgcFiltersDefaultOptions(o,n),r.options.ogcFilters.enabled&&r.options.ogcFilters.editable&&r.wfsService.getSourceFieldsFromWFS(r.options),r}var xt,Ct=(qe(Mt,xt=He),Mt.prototype.getData=function(){return console.log("This is defining a data service."),"This is defining a data service."},Mt.prototype.getSourceFieldsFromWFS=function(t){t.sourceFields&&0!==t.sourceFields.length?this.defineFieldAndValuefromWFS(t).subscribe(function(e){t.sourceFields.forEach(function(t){t.alias===undefined&&(t.alias=t.name),t.values!==undefined&&0!==t.values.length||(t.values=e.find(function(e){return e.name===t.name}).values)})}):(t.sourceFields=[],this.defineFieldAndValuefromWFS(t).subscribe(function(e){t.sourceFields=e}))},Mt.prototype.wfsGetFeature=function(e,t,r,o){void 0===t&&(t=ft),void 0===r&&(r=gt);var n=St(e,t,r,o).find(function(e){return"getfeature"===e.name}).value,i=e.paramsWFS.outputFormat;return vt.test(i)||!i?this.http.get(n,{responseType:"text"}):this.http.get(n)},Mt.prototype.defineFieldAndValuefromWFS=function(l){var u=this;return new Ce.Observable(function(r){var o,n,i,a,s=[];a=It(l),u.wfsGetFeature(l,1).subscribe(function(e){var t=a.readFeatures(e);o=t[0].getKeys(),n=o.filter(function(e){return e!==t[0].getGeometryName()&&!e.match(/boundedby/gi)}),i=n.join(","),u.wfsGetFeature(l,l.paramsWFS.maxFeatures||ft,undefined,i).subscribe(function(e){var t=a.readFeatures(e);u.built_properties_value(t).forEach(function(e){s.push(e)}),r.next(s),r.complete()})})})},Mt.prototype.built_properties_value=function(e){var n=Object.assign({},e[0].getProperties());delete n[e[0].getGeometryName()],delete n.boundedBy;var i=[];for(var t in n)if(n.hasOwnProperty(t)){var r="object"==typeof e[0].get(t)?undefined:typeof e[0].get(t);i.push({name:t,alias:t,type:r,values:[n[t]]})}return e.every(function(e){var r=e.getProperties(),t=function(t){r.hasOwnProperty(t)&&t in n&&i.filter(function(e){return e.name===t}).forEach(function(e){-1===e.values.indexOf(r[t])&&e.values.push(r[t])})};for(var o in r)t(o);return!0}),i},Mt.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Mt.ctorParameters=function(){return[{type:Pe.HttpClient}]},Mt.ngInjectableDef=Le.defineInjectable({factory:function(){return new Mt(Le.inject(Pe.HttpClient))},token:Mt,providedIn:"root"}),Mt);function Mt(e){var t=xt.call(this)||this;return t.http=e,t}var Lt,Pt={GML2:"gml2",GML3:"gml3",JSON:"json",GEOJSON:"geojson",ESRIJSON:"esrijson",TEXT:"text",HTML:"html",HTMLGML2:"htmlgml2"},Dt={IFRAME:"iframe",BLANK:"_blank"},kt=(qe(jt,Lt=tt),Object.defineProperty(jt.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(jt.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(jt.prototype,"mapLabel",{get:function(){return this.options.mapLabel},enumerable:!0,configurable:!0}),Object.defineProperty(jt.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Dt.BLANK},enumerable:!0,configurable:!0}),jt.prototype.refresh=function(){this.ol.updateParams({igoRefresh:Math.random()})},jt.prototype.buildDynamicDownloadUrlFromParamsWFS=function(e){return St(e).find(function(e){return"getfeature"===e.name}).value},jt.prototype.createOlSource=function(){return new a(this.options)},jt.prototype.getLegend=function(r,e){var t=Lt.prototype.getLegend.call(this);if(0<t.length&&r===undefined&&!e)return t;var o=this.params,n=[];o.LAYERS!==undefined&&(n=o.LAYERS.split(","));var i=this.options.url.replace(/\?$/,""),a=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0","VERSION="+(o.VERSION||"1.3.0")];return r!==undefined&&a.push("STYLE="+r),e!==undefined&&a.push("SCALE="+e),t=n.map(function(e){var t=i.match(/\?/)?"&":"?";return{url:i+t+a.join("&")+"&LAYER="+e,title:1<n.length?e:undefined,currentStyle:r===undefined?undefined:r}})},jt.prototype.onUnwatch=function(){},jt);function jt(e,t){var r=Lt.call(this,e)||this;r.options=e,r.wfsService=t;var o=e.params,n=o.DPI||96;o.DPI=n,o.MAP_RESOLUTION=n,o.FORMAT_OPTIONS="dpi:"+n,e.refreshIntervalSec&&0<e.refreshIntervalSec&&setInterval(function(){r.refresh()},1e3*e.refreshIntervalSec);var i=yt;if(e.paramsWFS){var a=wt(e,"wms");ke.ObjectUtils.mergeDeep(e.paramsWFS,a.paramsWFS),i=e.paramsWFS.fieldNameGeometry||i,e.download=Object.assign({},e.download,{dynamicUrl:r.buildDynamicDownloadUrlFromParamsWFS(e)})}e.sourceFields&&0!==e.sourceFields.length?e.sourceFields.forEach(function(e){e.alias=e.alias?e.alias:e.name}):e.sourceFields=[];var s=e.ogcFilters,l=new dt;s?s.advancedOgcFilters=!s.pushButtons:e.ogcFilters=l.defineOgcFiltersDefaultOptions(s,i,"wms"),1<o.LAYERS.split(",").length&&s&&s.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+o.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),e.paramsWFS&&s&&s.enabled&&s.editable&&r.wfsService.getSourceFieldsFromWFS(e);var u=l.handleOgcFiltersAppliedValue(e,i);return o.FILTER=u,r}function Et(e){for(var t=(e?be.get(e):be.get("EPSG:3857")).getExtent(),r=c.getWidth(t)/256,o=new Array(20),n=new Array(20),i=0;i<20;++i)o[i]=r/Math.pow(2,i),n[i]=i;return new u({origin:c.getTopLeft(t),resolutions:o,matrixIds:n})}var Rt,$t=(qe(At,Rt=tt),At.prototype.createOlSource=function(){var e=Object.assign({tileGrid:Et(this.options.projection)},this.options);return new s(e)},At.prototype.onUnwatch=function(){},At);function At(e){return Rt.call(this,e)||this}var Gt,Bt=(qe(_t,Gt=tt),Object.defineProperty(_t.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"mapLabel",{get:function(){return this.options.mapLabel},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Dt.BLANK},enumerable:!0,configurable:!0}),_t.prototype.createOlSource=function(){var e=this.options.crossOrigin?this.options.crossOrigin:"anonymous",t=Object.assign({crossOrigin:e},this.options);return new p(t)},_t.prototype.getLegend=function(){var e,t,r=Gt.prototype.getLegend.call(this);if(0<r.length)return r;var o="<table>";if(null!=this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(function(e){!0===e.visible&&(o+='<tr><td><p><font size="5" color="'+e.value+'"> &#9679</font></p></td><td>'+e.name+"</td></tr>")}),[{html:o+="</table>"}];var n=this.options.config.layers[0].options;try{for(var i=We(["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"]),a=i.next();!a.done;a=i.next()){var s=a.value;if(n.cartocss.includes(s)){var l=n.cartocss.split(s).pop(),u=l.substr(0,l.indexOf(";"));if(u.includes("ramp")){for(var c=u.split(", (")[1].split(","),p=u.split(", (")[2].split(","),d=0;d<c.length;d++)c[d]=c[d].replace(/("|\))/g,""),p[d]=p[d].replace(/("|\))/g,""),"="===p[d].replace(/\s+/g,"")&&(p[d]="Autres"),o+='<tr><td><p><font size="5" color="'+c[d]+'"> &#9679</font></p></td><td>'+p[d]+"</td></tr>";break}var h=n.layer_name?n.layer_name:"";o+='<tr><td><p><font size="5" color="'+u+'"> &#9679</font></p></td><td>'+h+"</td></tr>";break}}}catch(g){e={error:g}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}return[{html:o+="</table>"}]},_t.prototype.onUnwatch=function(){},_t);function _t(){return null!==Gt&&Gt.apply(this,arguments)||this}var qt,Nt=(qe(Vt,qt=tt),Vt.prototype.createOlSource=function(){var e=new B;return new ne({attributions:this.options.params.attributions,overlaps:!1,format:e,url:function(e,t,r){var o=this.options.url+"/"+this.options.layer+"/query/",n=["f=json","geometry="+encodeURIComponent('{"xmin":'+e[0]+',"ymin":'+e[1]+',"xmax":'+e[2]+',"ymax":'+e[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];if(this.options.params.timeFilter){var i="time="+this.options.params.timeExtent;n.push(i)}return this.options.params.customParams&&this.options.params.customParams.forEach(function(e){n.push(e)}),o+"?"+n.join("&")}.bind(this),strategy:d.bbox})},Vt.prototype.getLegend=function(){var e,t,r=this.options.params.legendInfo,o=qt.prototype.getLegend.call(this);if(r===undefined||0<o.length)return o;var n=parseInt(this.options.layer,10),i=r.layers[n],a="<table><tr><td>"+i.layerName+"</td></tr>";try{for(var s=We(i.legend),l=s.next();!l.done;l=s.next()){var u=l.value;a+="<tr><td align='left'><img src=\""+this.options.url.replace("FeatureServer","MapServer")+"/"+i.layerId+"/images/"+u.url+"\" alt ='' /></td><td>"+u.label.replace("<Null>","Null")+"</td></tr>"}}catch(c){e={error:c}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}return[{html:a+="</table>"}]},Vt.prototype.onUnwatch=function(){},Vt);function Vt(){return null!==qt&&qt.apply(this,arguments)||this}var Ut,Wt=(qe(zt,Ut=tt),Object.defineProperty(zt.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(zt.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(zt.prototype,"mapLabel",{get:function(){return this.options.mapLabel},enumerable:!0,configurable:!0}),Object.defineProperty(zt.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Dt.BLANK},enumerable:!0,configurable:!0}),zt.prototype.createOlSource=function(){return new h(this.options)},zt.prototype.getLegend=function(){var e,t,r=Ut.prototype.getLegend.call(this);if(this.options.legendInfo===undefined||0<r.length)return r;var o=parseInt(this.options.layer,10),n=this.options.legendInfo.layers[o],i="<table><tr><td>"+n.layerName+"</td></tr>";try{for(var a=We(n.legend),s=a.next();!s.done;s=a.next()){var l=s.value;i+="<tr><td align='left'><img src=\""+this.options.url+"/"+n.layerId+"/images/"+l.url+"\" alt ='' /></td><td>"+l.label.replace("<Null>","Null")+"</td></tr>"}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}return[{html:i+="</table>"}]},zt.prototype.onUnwatch=function(){},zt);function zt(){return null!==Ut&&Ut.apply(this,arguments)||this}var Kt,Ht=(qe(Yt,Kt=nt),Yt.prototype.createOlSource=function(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),Kt.prototype.createOlSource.call(this)},Yt.prototype.createWebSocket=function(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))},Yt.prototype.onMessage=function(e){var t=this.options.format.readFeature(e.data);switch(this.options.onmessage){case"update":var r=this.ol.getFeatureById(t.getId());r&&this.ol.removeFeature(r),this.ol.addFeature(t);break;case"delete":this.ol.clear(!0),this.ol.addFeature(t);break;case"add":default:this.ol.addFeature(t)}},Yt.prototype.onClose=function(e){},Yt.prototype.onError=function(e){},Yt.prototype.onOpen=function(e){},Yt.prototype.onUnwatch=function(){this.ws.close()},Yt);function Yt(){return null!==Kt&&Kt.apply(this,arguments)||this}var Zt,Qt=(qe(Jt,Zt=tt),Jt.prototype.createOlSource=function(){var e;return"feature"===this.options.featureClass?e=new m({featureClass:ve}):this.options.featureClass===undefined&&(e=new m),this.options.format=e,new f(this.options)},Jt.prototype.generateId=function(){if(!this.options.url)return ke.uuid();var e="mvt"+this.options.url;return g.Md5.hashStr(e)},Jt.prototype.onUnwatch=function(){},Jt);function Jt(){return null!==Zt&&Zt.apply(this,arguments)||this}var Xt,er=(qe(tr,Xt=nt),tr.prototype.createOlSource=function(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=Xt.prototype.createOlSource.call(this),new y(this.options)},tr.prototype.generateId=function(){return ke.uuid()},tr.prototype.onUnwatch=function(){},tr);function tr(){return null!==Xt&&Xt.apply(this,arguments)||this}var rr="Feature",or={None:0,Move:1,Zoom:2,Default:3};or[or.None]="None",or[or.Move]="Move",or[or.Zoom]="Zoom",or[or.Default]="Default";var nr="Layer",ir=(Object.defineProperty(ar.prototype,"id",{get:function(){return this.options.id||this.dataSource.id},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"alias",{get:function(){return this.options.alias},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"title",{get:function(){return this.options.title},set:function(e){this.options.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"zIndex",{get:function(){return this.ol.getZIndex()},set:function(e){this.ol.setZIndex(e)},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"baseLayer",{get:function(){return this.options.baseLayer},set:function(e){this.options.baseLayer=e},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"opacity",{get:function(){return this.ol.get("opacity")},set:function(e){this.ol.setOpacity(e)},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"isInResolutionsRange",{get:function(){return this.isInResolutionsRange$.value},set:function(e){this.isInResolutionsRange$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"maxResolution",{get:function(){return this.ol.getMaxResolution()},set:function(e){this.ol.setMaxResolution(e),this.updateInResolutionsRange()},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"minResolution",{get:function(){return this.ol.getMinResolution()},set:function(e){this.ol.setMinResolution(e),this.updateInResolutionsRange()},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"visible",{get:function(){return this.visible$.value},set:function(e){this.ol.setVisible(e),this.visible$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"displayed",{get:function(){return this.visible&&this.isInResolutionsRange},enumerable:!0,configurable:!0}),Object.defineProperty(ar.prototype,"showInLayerList",{get:function(){return!1!==this.options.showInLayerList},enumerable:!0,configurable:!0}),ar.prototype.setMap=function(e){this.map=e,this.unobserveResolution(),e!==undefined&&this.observeResolution()},ar.prototype.observeResolution=function(){var e=this;this.resolution$$=this.map.viewController.resolution$.subscribe(function(){return e.updateInResolutionsRange()})},ar.prototype.unobserveResolution=function(){this.resolution$$!==undefined&&(this.resolution$$.unsubscribe(),this.resolution$$=undefined)},ar.prototype.updateInResolutionsRange=function(){if(this.map!==undefined){var e=this.map.viewController.getResolution(),t=this.minResolution||0,r=this.maxResolution||Infinity;this.isInResolutionsRange=t<=e&&e<=r}else this.isInResolutionsRange=!1},ar);function ar(e,t){this.options=e,this.authInterceptor=t,this.legendCollapsed=!0,this.firstLoadComponent=!0,this.isInResolutionsRange$=new Ce.BehaviorSubject(!1),this.visible$=new Ce.BehaviorSubject(undefined),this.displayed$=Ce.combineLatest([this.isInResolutionsRange$,this.visible$]).pipe(De.map(function(e){return e[0]&&e[1]})),this.dataSource=e.source,this.ol=this.createOlLayer(),e.zIndex!==undefined&&(this.zIndex=e.zIndex),e.baseLayer&&e.visible===undefined&&(e.visible=!1),e.maxResolution!==undefined&&(this.maxResolution=e.maxResolution),e.minResolution!==undefined&&(this.minResolution=e.minResolution),this.visible=e.visible===undefined||e.visible,this.opacity=e.opacity===undefined?1:e.opacity,e.legendOptions&&(e.legendOptions.url||e.legendOptions.html)&&(this.legend=this.dataSource.setLegend(e.legendOptions)),this.legendCollapsed=!e.legendOptions||(!e.legendOptions.collapsed||e.legendOptions.collapsed),this.ol.set("_layer",this,!0)}var sr,lr={TITLE:"title",ABSTRACT:"abstract",CUSTOM:"custom"},ur=(qe(cr,sr=ke.Watcher),cr.prototype.watch=function(){var t=this;this.source.on("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("imageloaderror",function(e){return t.handleLoadEnd(e)})},cr.prototype.unwatch=function(){var t=this;this.source.un("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("imageloaderror",function(e){return t.handleLoadEnd(e)})},cr.prototype.handleLoadStart=function(e){e.image.__watchers__||(e.image.__watchers__=[]),e.image.__watchers__.push(this.id),this.loading+=1,this.status=ke.SubjectStatus.Working},cr.prototype.handleLoadEnd=function(e){if(e.image.__watchers__){var t=e.image.__watchers__.indexOf(this.id);if(!(t<0)){e.image.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=ke.SubjectStatus.Done,this.loaded=this.loading=0)}}},cr);function cr(e){var t=sr.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=ke.uuid(),t}var pr,dr=(qe(hr,pr=ke.Watcher),hr.prototype.watch=function(){var t=this;this.source.on("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("tileloaderror",function(e){return t.handleLoadEnd(e)})},hr.prototype.unwatch=function(){var t=this;this.source.un("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("tileloaderror",function(e){return t.handleLoadEnd(e)})},hr.prototype.handleLoadStart=function(e){e.tile.__watchers__||(e.tile.__watchers__=[]),e.tile.__watchers__.push(this.id),this.loading+=1,this.status=ke.SubjectStatus.Working},hr.prototype.handleLoadEnd=function(e){if(e.tile.__watchers__){var t=e.tile.__watchers__.indexOf(this.id);if(!(t<0)){e.tile.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=ke.SubjectStatus.Done,this.loaded=this.loading=0)}}},hr);function hr(e){var t=pr.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=ke.uuid(),t}function gr(e,t){var r,o,n,i,a=[],s=document.createElement("canvas").getContext("2d");s.font="20px Calibri";var l=0;try{for(var u=We(e),c=u.next();!c.done;c=u.next()){var p=c.value;if(!1!==p.visible){var d=p.dataSource.getLegend(undefined,t)||[],h=function(e){if(e.url===undefined)return"continue";var t=p.title,r=new Image;r.crossOrigin="anonymous",r.src=e.url,r.onload=function(){s.fillText(t,0,l),s.drawImage(r,0,l+20),l+=r.height+5},a.push({title:t,url:e.url,image:r})};try{for(var g=We(d),f=g.next();!f.done;f=g.next()){h(f.value)}}catch(m){n={error:m}}finally{try{f&&!f.done&&(i=g["return"])&&i.call(g)}finally{if(n)throw n.error}}}}}catch(y){r={error:y}}finally{try{c&&!c.done&&(o=u["return"])&&o.call(u)}finally{if(r)throw r.error}}return a}var fr,mr=(qe(yr,fr=ke.Watcher),yr.prototype.watch=function(){},yr.prototype.unwatch=function(){this.layer.onUnwatch()},yr);function yr(e){var t=fr.call(this)||this;return t.loaded=0,t.loading=0,t.layer=e,t.id=ke.uuid(),t}var vr,br=(qe(Sr,vr=ir),Sr.prototype.createOlLayer=function(){var r=this,e=Object.assign({},this.options,{source:this.options.source.ol}),t=new M(e);return this.authInterceptor&&t.getSource().setImageLoadFunction(function(e,t){r.customLoader(e,t)}),t},Sr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),vr.prototype.setMap.call(this,e)},Sr.prototype.customLoader=function(o,e){var t=new XMLHttpRequest;if(t.open("GET",e),!this.authInterceptor.interceptXhr(t,e))return t.abort(),void(o.getImage().src=e);t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(this.response),t=new Blob([e],{type:"image/png"}),r=window.URL.createObjectURL(t);o.getImage().src=r},t.send()},Sr);function Sr(e,t){var r=vr.call(this,e,t)||this;return r.authInterceptor=t,r.watcher=new ur(r),r.status$=r.watcher.status$,r}var wr,Ir=(qe(Fr,wr=ir),Fr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new L(e)},Fr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),wr.prototype.setMap.call(this,e)},Fr);function Fr(e){var t=wr.call(this,e)||this;return t.watcher=new dr(t),t.status$=t.watcher.status$,t}var Or,Tr=(qe(xr,Or=ir),Object.defineProperty(xr.prototype,"browsable",{get:function(){return!1!==this.options.browsable},enumerable:!0,configurable:!0}),Object.defineProperty(xr.prototype,"exportable",{get:function(){return!1!==this.options.exportable},enumerable:!0,configurable:!0}),xr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return this.options.animation&&this.dataSource.ol.on("addfeature",function(e){this.flash(e.feature)}.bind(this)),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature),new ie(e)},xr.prototype.flash=function(p){var d=(new Date).getTime(),h=this.map.ol.on("postcompose",function g(e){var t=e.vectorContext,r=e.frameState,o=p.getGeometry().clone(),n=r.time-d,i=n/this.options.animation.duration,a=k.easeOut(1-i),s=P.asArray(this.options.animation.color||"red");s[3]=a;var l=this.ol.getStyleFunction().call(this,p).find(function(e){return e.getImage()}),u=(l=l||this.ol.getStyleFunction().call(this,p)[0]).clone();switch(p.getGeometry().getType()){case"Point":var c=k.easeOut(i)*(3*u.getImage().getRadius());u.getImage().setRadius(c),u.getImage().setOpacity(a);break;case"LineString":u.getImage()&&(u.getImage().getStroke().setColor(s),u.getImage().getStroke().setWidth(k.easeOut(i)*(3*u.getImage().getStroke().getWidth()))),u.getStroke()&&(u.getStroke().setColor(s),u.getStroke().setWidth(k.easeOut(i)*(3*u.getStroke().getWidth())));break;case"Polygon":u.getImage()&&u.getImage().getFill().setColor(s),u.getFill()&&u.getFill().setColor(s)}if(u.setText(""),t.setStyle(u),t.drawGeometry(o),n>this.options.animation.duration)return fe.unByKey(h),void this.map.ol.render();this.map.ol.render()}.bind(this))},xr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),Or.prototype.setMap.call(this,e)},xr.prototype.onUnwatch=function(){this.dataSource.onUnwatch(),this.stopAnimation()},xr.prototype.stopAnimation=function(){this.dataSource.ol.un("addfeature",function(e){this.visible&&this.flash(e.feature)}.bind(this))},xr.prototype.enableTrackFeature=function(e){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,e))},xr.prototype.centerMapOnFeature=function(e){var t=this.dataSource.ol.getFeatureById(e);t&&this.map.ol.getView().setCenter(t.getGeometry().getCoordinates())},xr.prototype.trackFeature=function(e,t){t.feature.getId()===e&&this.visible&&this.centerMapOnFeature(e)},xr.prototype.disableTrackFeature=function(e){fe.unByKey(this.trackFeatureListenerId)},xr);function xr(e){var t=Or.call(this,e)||this;return t.watcher=new mr(t),t.status$=t.watcher.status$,t}var Cr,Mr=(qe(Lr,Cr=ir),Lr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new D(e)},Lr);function Lr(e){var t=Cr.call(this,e)||this;return t.watcher=new dr(t),t.status$=t.watcher.status$,t}var Pr=(Object.defineProperty(Dr.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e,this.map!==undefined&&this.map.updateView(e)},enumerable:!0,configurable:!0}),Dr.prototype.ngOnInit=function(){var t=this;this.status$$=this.map.status$.subscribe(function(e){return t.handleStatusChange(e)})},Dr.prototype.ngAfterViewInit=function(){this.map.setTarget(this.id)},Dr.prototype.ngOnDestroy=function(){this.map.setTarget(undefined),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()},Dr.prototype.handleStatusChange=function(e){e===ke.SubjectStatus.Working&&this.activityId===undefined?this.activityId=this.activityService.register():e===ke.SubjectStatus.Done&&this.activityId!==undefined&&(this.activityService.unregister(this.activityId),this.activityId=undefined)},Dr.decorators=[{type:Le.Component,args:[{selector:"igo-map-browser",template:'<div [id]="id" class="igo-map-browser-target"></div>\r\n<ng-content></ng-content>\r\n',styles:[":host{position:relative;display:block}.igo-map-browser-target,:host{width:100%;height:100%}:host>>>igo-zoom-button{position:absolute;bottom:5px;right:5px}:host>>>igo-offline-button{position:absolute;bottom:15px;right:5px}:host>>>igo-geolocate-button{position:absolute;bottom:5px;right:5px}:host>>>igo-rotation-button{position:absolute;top:calc(40px + 5px + 5px);right:5px}:host>>>igo-user-button{position:absolute;bottom:5px;right:calc(5px + 50px)}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){:host>>>igo-zoom-button{display:none}:host>>>igo-offline-button{bottom:5px}:host>>>igo-geolocate-button{bottom:5px}:host>>>igo-rotation-button{top:calc(40px + 5px + 5px)}:host>>>igo-user-button{right:calc(5px + 90px)}}:host>>>igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}:host>>>.ol-attribution{left:5px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:rgba(255,255,255,0);width:calc(100% - 100px)}:host>>>.ol-attribution.ol-logo-only{height:inherit}:host>>>.ol-attribution.ol-collapsed{background:0 0}:host>>>.ol-attribution.ol-collapsed button{-webkit-transform:none;transform:none}:host>>>.ol-attribution button{-webkit-transform:rotate(180deg);transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:0}:host>>>.ol-scale-line-inner{color:#000;border-color:#000}:host>>>.ol-scale-line{background-color:rgba(255,255,255,0);bottom:4px;-webkit-transform:translate(-50%);transform:translate(-50%);left:50%}:host>>>canvas{display:block}"]}]}],Dr.ctorParameters=function(){return[{type:je.ActivityService}]},Dr.propDecorators={map:[{type:Le.Input}],view:[{type:Le.Input}]},Dr);function Dr(e){this.activityService=e,this.id="igo-map-target-"+(new Date).getTime()}var kr={None:0,Move:1,Zoom:2,ZoomIfOutMapExtent:3};kr[kr.None]="None",kr[kr.Move]="Move",kr[kr.Zoom]="Zoom",kr[kr.ZoomIfOutMapExtent]="ZoomIfOutMapExtent";var jr=(Er.prototype.setFeatures=function(e,t){void 0===t&&(t=kr.None),this.features$.next([e,t])},Er.prototype.clear=function(){this.features$.next([[],kr.None])},Er.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Er.ctorParameters=function(){return[]},Er.ngInjectableDef=Le.defineInjectable({factory:function(){return new Er},token:Er,providedIn:"root"}),Er);function Er(){this.features$=new Ce.BehaviorSubject([[],undefined])}var Rr=(Object.defineProperty($r.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),$r.prototype.ngOnInit=function(){var t=this;this.features$$=this.overlayService.features$.subscribe(function(e){return t.handleFeatures(e[0],e[1])})},$r.prototype.ngOnDestroy=function(){this.features$$.unsubscribe()},$r.prototype.handleFeatures=function(e,t){},$r.decorators=[{type:Le.Directive,args:[{selector:"[igoOverlay]"}]}],$r.ctorParameters=function(){return[{type:Pr,decorators:[{type:Le.Self}]},{type:jr}]},$r);function $r(e,t){this.component=e,this.overlayService=t,this.format=new Ie}function Ar(){var e=new nt;return new Tr({title:"Overlay",zIndex:300,source:e,style:function t(){var o,n=Gr(),i=Br();return function(e){if("bufferFeature"===e.getId())return o=function a(e,t,r,o){void 0===e&&(e=[0,161,222,1]);void 0===t&&(t=2);void 0===r&&(r=[0,161,222,.15]);var n=new Se.Stroke({width:t,color:e}),i=new Se.Stroke({color:r});return new Se.Style({stroke:n,fill:i,image:new Se.Circle({radius:5,stroke:n,fill:i}),text:new Se.Text({font:"12px Calibri,sans-serif",text:o,fill:new Se.Fill({color:"#000"}),stroke:new Se.Stroke({color:"#fff",width:3}),overflow:!0})})}(e.get("bufferStroke"),2,e.get("bufferFill"),e.get("bufferText"));var t=e.get("_style");if(t)return(new _r).createStyle(t);var r=e.getGeometry().getType();return(o="Point"===r?i:n).getText().setText(e.get("_mapTitle")),o}}()})}function Gr(e){var t=void 0===e?{}:e,r=t.text,o=t.fillOpacity,n=t.strokeWidth,i=void 0===n?2:n,a=t.strokeOpacity,s=t.color,l=void 0===s?[0,161,222,.3]:s,u=l.slice(0),c=l.slice(0);c[3]=1,o&&(u[3]=o),a&&(c[3]=a);var p=new Se.Stroke({width:i,color:c}),d=new Se.Fill({color:u});return new Se.Style({stroke:p,fill:d,image:new Se.Circle({radius:5,stroke:p,fill:d}),text:new Se.Text({text:r,font:"12px Calibri,sans-serif",fill:new Se.Fill({color:"#000"}),stroke:new Se.Stroke({color:"#fff",width:3}),overflow:!0})})}function Br(e){var t,r=void 0===e?{}:e,o=r.text,n=r.opacity,i=void 0===n?1:n,a=r.color,s=void 0===a?"blue":a;switch(s){case"blue":case"red":case"yellow":case"green":t=s;break;default:t="blue"}return new Se.Style({image:new Se.Icon({src:"./assets/igo2/geo/icons/place_"+t+"_36px.svg",opacity:i,imgSize:[36,36],anchor:[.5,.92]}),text:new Se.Text({text:o,font:"12px Calibri,sans-serif",fill:new Se.Fill({color:"#000"}),stroke:new Se.Stroke({color:"#fff",width:3}),overflow:!0})})}var _r=(qr.prototype.createStyle=function(e){return e?"function"==typeof e||e instanceof Se.Style?e:this.parseStyle("style",e):Br()},qr.prototype.parseStyle=function(e,r){var o=this,n={},t=this.getOlCls(e);return t&&r instanceof Object?(Object.keys(r).forEach(function(e){var t=o.getOlKey(e);n[t]=o.parseStyle(e,r[e])}),new t(n)):r},qr.prototype.getOlKey=function(e){var t;switch(e.toLowerCase()){case"circle":case"regularshape":case"icon":t="image"}return t||e},qr.prototype.getOlCls=function(e){var t=Se[e.charAt(0).toUpperCase()+e.slice(1)];return"regularshape"===e&&(t=Se.RegularShape),"backgroundFill"===e&&(t=Se.Fill),"backgroundStroke"===e&&(t=Se.Stroke),t},qr.prototype.createStyleByAttribute=function(e,t){var r=t.type,o=t.attribute,n=t.data,i=t.stroke,a=t.width,s=t.fill,l=t.radius,u=t.icon,c=t.scale,p=n.length,d=t.label.attribute||t.label,h=this.parseStyle("text",t.label.style)||new Se.Text;h.setText(this.getLabel(e,d));var g=t.baseStyle;if("circle"===r){for(var f=0;f<p;f++)if((m=void 0!==e.get(o)?e.get(o):"")===n[f]||m.toString().match(n[f]))return u?[new Se.Style({image:new Se.Icon({src:u[f],scale:c?c[f]:1})})]:[new Se.Style({image:new Se.Circle({radius:l?l[f]:4,stroke:new Se.Stroke({color:i?i[f]:"black",width:a?a[f]:1}),fill:new Se.Fill({color:s?s[f]:"black"})}),text:h})];if(!e.getStyle())return[new Se.Style({image:new Se.Circle({radius:4,stroke:new Se.Stroke({color:"black"}),fill:new Se.Fill({color:"#bbbbf2"})})})]}else if("regular"===r){for(f=0;f<p;f++){var m;if((m=void 0!==e.get(o)?e.get(o):"")===n[f]||m.toString().match(n[f]))return[new Se.Style({stroke:new Se.Stroke({color:i?i[f]:"black",width:a?a[f]:1}),fill:new Se.Fill({color:s?s[f]:"rgba(255,255,255,0.4)"}),text:h})]}if(e instanceof ve&&!e.getStyle())return g?this.createStyle(g):[new Se.Style({stroke:new Se.Stroke({color:"black"}),fill:new Se.Fill({color:"#bbbbf2"})})]}},qr.prototype.createClusterStyle=function(e,t,r){var o,n,i;void 0===t&&(t={});var a=e.get("features").length;if(1!==a){if(t.clusterRanges)try{for(var s=We(t.clusterRanges),l=s.next();!l.done;l=s.next()){var u=l.value;if((!u.minRadius||u.minRadius<=a)&&(!u.maxRadius||u.maxRadius>=a)){i=this.createStyle(u.style);break}}}catch(p){o={error:p}}finally{try{l&&!l.done&&(n=s["return"])&&n.call(s)}finally{if(o)throw o.error}}if(!i){var c=void 0;t.radiusCalc?c=t.radiusCalc(a):(c=5*Math.log(a))<6&&(c=6),i=[new Se.Style({image:new Se.Circle({radius:c,opacity:.4,stroke:new Se.Stroke({color:"black"}),fill:new Se.Fill({color:"rgba(24, 134, 45, 0.5)"})}),text:new Se.Text({text:a.toString(),fill:new Se.Fill({color:"#fff"})})})]}}else i=this.createStyle(r);return i},qr.prototype.getLabel=function(t,e){var r=e,o=Array.from(e.matchAll(/\$\{([^\{\}]+)\}/g));return o.forEach(function(e){r=r.replace(e[0],t.get(e[1]))}),0===o.length&&r===e&&(r=t.get(e)||e),r},qr.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],qr.ngInjectableDef=Le.defineInjectable({factory:function(){return new qr},token:qr,providedIn:"root"}),qr);function qr(){}function Nr(e){return!0===e.dataSource.options.queryable}function Vr(e){var t=e.get("_layer");return t!==undefined&&Nr(t)}var Ur=(Object.defineProperty(Wr.prototype,"removable",{get:function(){return!1!==this.layer.options.removable},enumerable:!0,configurable:!0}),Object.defineProperty(Wr.prototype,"opacity",{get:function(){return 100*this.layer.opacity},set:function(e){this.layer.opacity=e/100},enumerable:!0,configurable:!0}),Wr.prototype.ngOnInit=function(){var t=this;this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge();var e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(function(){t.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.networkService.currentState().subscribe(function(e){t.state=e,t.onResolutionChange()})},Wr.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},Wr.prototype.toggleLegend=function(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)},Wr.prototype.toggleLegendOnClick=function(){this.toggleLegend(this.showLegend$.value)},Wr.prototype.toggleVisibility=function(){this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()},Wr.prototype.computeTooltip=function(){var e=this.layer.options;if(!e.tooltip)return this.layer.title;var t=e.tooltip,r=e.metadata;switch(e.tooltip.type){case lr.TITLE:return this.layer.title;case lr.ABSTRACT:return r&&r["abstract"]?r["abstract"]:this.layer.title;case lr.CUSTOM:return t&&t.text?t.text:this.layer.title;default:return this.layer.title}},Wr.prototype.onResolutionChange=function(){var e=this.layer.isInResolutionsRange;!1===e&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(e)},Wr.prototype.updateQueryBadge=function(){var e=!1===this.queryBadge||!1===this.layer.visible||!Nr(this.layer);this.queryBadgeHidden$.next(e)},Wr.decorators=[{type:Le.Component,args:[{selector:"igo-layer-item",template:'<mat-list-item class= "igo-layer-list-item">\r\n  <h4 (click)="toggleLegendOnClick()" matLine class="igo-layer-title" [matTooltip]="tooltipText" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [color]="layer.visible ? \'primary\' : \'default\'"\r\n    collapsibleButton\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="layer.visible ?\r\n                  (\'igo.geo.layer.hideLayer\' | translate) :\r\n                  (\'igo.geo.layer.showLayer\' | translate)"\r\n    (click)="toggleVisibility()">\r\n    <mat-icon\r\n      matBadge="?"\r\n      matBadgeColor="accent"\r\n      matBadgeSize="small"\r\n      matBadgePosition="after"\r\n      [matBadgeHidden]="queryBadgeHidden$ | async"\r\n      [ngClass]="{disabled: !(inResolutionRange$ | async)}"\r\n      [svgIcon]="layer.visible ? \'eye\' : \'eye-off\'">\r\n    </mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]= "\'igo.geo.layer.moreOptions\' | translate"\r\n    mat-icon-button\r\n    color="primary"\r\n    igoCollapse\r\n    [target]="actions"\r\n    [collapsed]="true">\r\n    <mat-icon svgIcon="dots-horizontal"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #actions class="igo-layer-actions-container">\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n\r\n    <div class="igo-layer-button-group">\r\n      \x3c!-- <label>{{ \'igo.geo.layer.opacity\' | translate }} </label> --\x3e\r\n      <mat-slider\r\n        id="opacity-slider"\r\n        color="primary"\r\n        thumbLabel\r\n        tickInterval="5"\r\n        step="5"\r\n        [min]="0"\r\n        [max]="100"\r\n        [(ngModel)]="opacity"\r\n        [matTooltip]="\'igo.geo.layer.opacity\' | translate"\r\n        matTooltipShowDelay="500"\r\n        tooltip-position="below">\r\n      </mat-slider>\r\n      \r\n      <button\r\n        color="primary"\r\n        mat-icon-button\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.raiseLayer\' | translate"\r\n        [disabled]="!orderable || raiseDisabled"\r\n        (click)="layer.map.raiseLayer(layer)">\r\n        <mat-icon svgIcon="arrow-up"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        mat-icon-button\r\n        color="primary"\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.lowerLayer\' | translate"\r\n        [disabled]="!orderable || lowerDisabled"\r\n        (click)="layer.map.lowerLayer(layer)">\r\n        <mat-icon svgIcon="arrow-down"></mat-icon>\r\n      </button>\r\n\r\n      <button\r\n        *ngIf="removable === true"\r\n        mat-icon-button\r\n        color="warn"\r\n        tooltip-position="below"\r\n        matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.removeLayer\' | translate"\r\n        (click)="layer.map.removeLayer(layer)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n      <ng-content select="[igoLayerItemToolbar]"></ng-content>\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div #legend class="igo-layer-legend-container">\r\n  <igo-layer-legend\r\n    *ngIf="showLegend$ | async"\r\n    [layer]="layer"\r\n    [updateLegendOnResolutionChange]="updateLegendOnResolutionChange">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[":host{overflow:hidden}.igo-layer-list-item{height:46px;clear:both}.igo-layer-title{cursor:pointer}.igo-layer-actions-container{width:100%;display:inline-block;padding-left:10px}.igo-layer-actions-container>div{text-align:center}.igo-layer-legend-container{padding-left:18px;width:calc(100% - 18px)}#opacity-slider{float:left}.igo-layer-button-group{text-align:right;padding:0 10px 0 0;width:100%}mat-icon.disabled{color:rgba(0,0,0,.38)}.mat-badge-small .mat-badge-content{font-size:12px}"]}]}],Wr.ctorParameters=function(){return[{type:je.NetworkService}]},Wr.propDecorators={layer:[{type:Le.Input}],toggleLegendOnVisibilityChange:[{type:Le.Input}],expandLegendIfVisible:[{type:Le.Input}],updateLegendOnResolutionChange:[{type:Le.Input}],orderable:[{type:Le.Input}],lowerDisabled:[{type:Le.Input}],raiseDisabled:[{type:Le.Input}],queryBadge:[{type:Le.Input}]},Wr);function Wr(e){this.networkService=e,this.showLegend$=new Ce.BehaviorSubject(!0),this.inResolutionRange$=new Ce.BehaviorSubject(!0),this.queryBadgeHidden$=new Ce.BehaviorSubject(!0),this.toggleLegendOnVisibilityChange=!1,this.expandLegendIfVisible=!1,this.updateLegendOnResolutionChange=!1,this.orderable=!0,this.lowerDisabled=!1,this.raiseDisabled=!1,this.queryBadge=!1}var zr=(Kr.prototype.ngOnInit=function(){var t=this,e=this.layer.legend;this.styles=this.listStyles();var r=this.layer.options.source.options;if(r&&r.params&&r.params.STYLES?this.currentStyle=this.styles.find(function(e){return e.name===r.params.STYLES}).name:this.layer.legend?this.styles&&1<this.styles.length&&(this.currentStyle=e[0].currentStyle):this.styles&&1<this.styles.length&&(this.currentStyle=this.styles[0].name),e=this.layer.dataSource.getLegend(this.currentStyle,this.scale),!0===this.updateLegendOnResolutionChange){var o=this.layer.map.viewController.resolution$;this.resolution$$=o.subscribe(function(e){return t.onResolutionChange(e)})}else 0!==e.length&&this.legendItems$.next(e)},Kr.prototype.ngOnDestroy=function(){this.resolution$$!==undefined&&this.resolution$$.unsubscribe()},Kr.prototype.toggleLegendItem=function(e,t){t.collapsed=e},Kr.prototype.transfertToggleLegendItem=function(e){for(var t=e,r=this.layer.legend,o=0;o<r.length;o++)t[o].collapsed=r[o].collapsed;return t},Kr.prototype.computeItemTitle=function(t){var e=this.layer.dataSource.options;if("wms"!==e.type)return Ce.of(t.title);var r=e.params.LAYERS.split(","),o=JSON.parse(JSON.stringify(e));return o.params.LAYERS=r.find(function(e){return e===t.title}),this.capabilitiesService.getWMSOptions(o).pipe(De.map(function(e){return e._layerOptionsFromCapabilities.title}))},Kr.prototype.onResolutionChange=function(e){this.scale=this.layer.map.viewController.getScale(),this.updateLegend()},Kr.prototype.updateLegend=function(){var e=this.layer.dataSource.getLegend(this.currentStyle,this.scale);this.layer.legend&&1<this.layer.legend.length&&(e=this.transfertToggleLegendItem(e)),0===(this.layer.legend=e).length&&0===this.legendItems$.value.length||this.legendItems$.next(e)},Kr.prototype.listStyles=function(){var e=this.layer.options;if(e&&e.legendOptions){var t=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}].concat(e.legendOptions.stylesAvailable.filter(function(e){return"default"!==e.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==e.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")}));return t.map(function(e){return e.title=e.title.charAt(0).toUpperCase()+e.title.slice(1).replace(/_/g," ")}),t}},Kr.prototype.onChangeStyle=function(){this.updateLegend(),this.layer.dataSource.ol.updateParams({STYLES:this.currentStyle})},Kr.prototype.onLoadImage=function(t){var e;e=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(function(e){return e.nativeElement.id===t}).nativeElement,this.imagesHeight[t]=e.height},Kr.decorators=[{type:Le.Component,args:[{selector:"igo-layer-legend",template:'<ng-container *ngIf="legendItems$ | async as items">\r\n  <ng-container *ngIf="items.length; else noItems">\r\n    <ng-container *ngFor="let item of items.slice().reverse()" #renderedLegends >\r\n      <mat-list-item *ngIf="item.title">\r\n        <mat-icon\r\n          id="legend-toggle"\r\n          class="igo-chevron"\r\n          mat-list-avatar\r\n          igoCollapse\r\n          [target]="legend"\r\n          [collapsed]="(item.collapsed)"\r\n          (toggle)="toggleLegendItem($event, item)"\r\n          svgIcon="chevron-up">\r\n        </mat-icon>\r\n        <h4 matLine>{{computeItemTitle(item) | async}}</h4>\r\n      </mat-list-item>  \r\n      <div #legend class="igo-layer-legend" [ngClass]="{\'with-title\': item.title}">\r\n        <div *ngIf="currentStyle !== undefined">\r\n            <mat-form-field>\r\n              <mat-select tooltip-position="below" matTooltipShowDelay="500"\r\n                [matTooltip]="\'igo.geo.layer.legend.selectStyle\' | translate" [(ngModel)]="currentStyle"\r\n                (selectionChange)="onChangeStyle()">\r\n                <mat-option *ngFor="let style of styles" [value]="style.name">{{style.title}}</mat-option>\r\n              </mat-select>\r\n          </mat-form-field>\r\n        </div>\r\n        <div *ngIf="!(item.collapsed)">\r\n          <div *ngIf="item.url">\r\n            <img #renderedLegend id="{{item.title}}" (load)="onLoadImage(item.title)"\r\n              src="{{(item.url | secureImage) |async}}"\r\n              alt="{{\'igo.geo.layer.legend.loadingLegendText\' | translate}}"\r\n            >\r\n            <small *ngIf="imagesHeight[item.title]<16">\r\n                {{\'igo.geo.layer.legend.noLegendScale\' | translate}}\r\n            </small>\r\n          </div>\r\n          <div\r\n            [ngStyle]="item.style"\r\n            [innerHTML]="item.html"\r\n            *ngIf="item.html">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </ng-container>\r\n\r\n  <ng-template #noItems>\r\n    <small>\r\n      {{\'igo.geo.layer.legend.noLegendText\' | translate}}\r\n    </small>\r\n  </ng-template>\r\n\r\n</ng-container>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".igo-layer-legend.with-title{padding-left:18px}img:after{content:' ';position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;-webkit-animation:2s linear infinite spin;animation:2s linear infinite spin}@-moz-document url-prefix(){img:after{margin-left:19px}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}"]}]}],Kr.ctorParameters=function(){return[{type:jn},{type:je.LanguageService}]},Kr.propDecorators={updateLegendOnResolutionChange:[{type:Le.Input}],renderedLegends:[{type:Le.ViewChildren,args:["renderedLegend"]}],layer:[{type:Le.Input}]},Kr);function Kr(e,t){this.capabilitiesService=e,this.languageService=t,this.updateLegendOnResolutionChange=!1,this.legendItems$=new Ce.BehaviorSubject([]),this.scale=undefined,this.imagesHeight={}}var Hr={always:"always",never:"never","default":"default"},Yr=(Zr.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Zr.ctorParameters=function(){return[]},Zr.ngInjectableDef=Le.defineInjectable({factory:function(){return new Zr},token:Zr,providedIn:"root"}),Zr);function Zr(){this.sortedAlpha=!1,this.onlyVisible=!1,this.onlyInRange=!1,this.keywordInitialized=!1,this.sortedAlphaInitialized=!1,this.onlyVisibleInitialized=!1,this.onlyInRangeInitialized=!1}var Qr=(Object.defineProperty(Jr.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"keyword",{get:function(){return this.layerListService.keyword},set:function(e){this.layerListService.keyword=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"keywordInitialized",{get:function(){return this.layerListService.keywordInitialized},set:function(e){this.layerListService.keywordInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"onlyVisible",{get:function(){return this.layerListService.onlyVisible},set:function(e){this.layerListService.onlyVisible=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"onlyVisibleInitialized",{get:function(){return this.layerListService.onlyVisibleInitialized},set:function(e){this.layerListService.onlyVisibleInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"onlyInRange",{get:function(){return this.layerListService.onlyInRange},set:function(e){this.layerListService.onlyInRange=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"onlyInRangeInitialized",{get:function(){return this.layerListService.onlyInRangeInitialized},set:function(e){this.layerListService.onlyInRangeInitialized=e},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"sortedAlpha",{get:function(){return this.layerListService.sortedAlpha},set:function(e){this.layerListService.sortedAlpha=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(Jr.prototype,"sortedAlphaInitialized",{get:function(){return this.layerListService.sortedAlphaInitialized},set:function(e){this.layerListService.sortedAlphaInitialized=e},enumerable:!0,configurable:!0}),Jr.prototype.ngOnInit=function(){var e=this;this.change$$=this.change$.pipe(De.debounce(function(){return 0===e.layers.length?Ce.EMPTY:Ce.timer(50)})).subscribe(function(){e.showToolbar$.next(e.computeShowToolbar()),e.layers$.next(e.computeLayers(e.layers.slice(0)))}),this.initLayerFilterAndSortOptions()},Jr.prototype.ngOnDestroy=function(){this.change$$.unsubscribe()},Jr.prototype.toggleOnlyVisible=function(){this.onlyVisible=!this.onlyVisible},Jr.prototype.toggleOnlyInRange=function(){this.onlyInRange=!this.onlyInRange},Jr.prototype.toggleSort=function(e){this.sortedAlpha=e},Jr.prototype.clearKeyword=function(){this.keyword=undefined},Jr.prototype.getLowerLayer=function(){return this.layers.filter(function(e){return!e.baseLayer}).reduce(function(e,t){return e.zIndex<t.zIndex?e:t},{zIndex:undefined,id:undefined})},Jr.prototype.getUpperLayer=function(){return this.layers.filter(function(e){return!e.baseLayer}).reduce(function(e,t){return e.zIndex>t.zIndex?e:t},{zIndex:undefined,id:undefined})},Jr.prototype.next=function(){this.change$.next()},Jr.prototype.computeLayers=function(e){var t=this.filterLayers(e);return t=this.sortedAlpha?this.sortLayersByTitle(t):this.sortLayersByZindex(t)},Jr.prototype.filterLayers=function(e){var c=this,p=this.keyword;if(this.layerFilterAndSortOptions.showToolbar===Hr.never)return e;if(!p&&!this.onlyInRange&&!this.onlyVisible)return e;var d=e.map(function(e){return e.id});return e.forEach(function(e){var t=e.options||{},r=e.dataSource.options||{},o=((t.metadata||{}).keywordList||[]).map(function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")});if(p){var n,i=p.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=r.type||"",l=new RegExp(i,"gi"),u=o.find(function(e){return l.test(e)})!==undefined;l.test(a)||p.toLowerCase()===s.toLowerCase()||u||-1<(n=d.indexOf(e.id))&&d.splice(n,1)}c.onlyVisible&&!1===e.visible&&-1<(n=d.indexOf(e.id))&&d.splice(n,1),c.onlyInRange&&!1===e.isInResolutionsRange&&-1<(n=d.indexOf(e.id))&&d.splice(n,1)}),e.filter(function(e){return-1!==d.indexOf(e.id)})},Jr.prototype.sortLayersByZindex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},Jr.prototype.sortLayersByTitle=function(e){return e.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0})},Jr.prototype.computeShowToolbar=function(){switch(this.layerFilterAndSortOptions.showToolbar){case Hr.always:return!0;case Hr.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyInRange||this.onlyVisible)}},Jr.prototype.initLayerFilterAndSortOptions=function(){this.layerFilterAndSortOptions.toolbarThreshold&&(this.thresholdToFilterAndSort=this.layerFilterAndSortOptions.toolbarThreshold),this.layerFilterAndSortOptions.keyword&&!this.keywordInitialized&&(this.keyword=this.layerFilterAndSortOptions.keyword,this.keywordInitialized=!0),this.layerFilterAndSortOptions.sortedAlpha&&!this.sortedAlphaInitialized&&(this.sortedAlpha=this.layerFilterAndSortOptions.sortedAlpha,this.sortedAlphaInitialized=!0),!this.layerFilterAndSortOptions.onlyVisible||this.onlyVisibleInitialized||this.layersAreAllVisible||(this.onlyVisible=this.layerFilterAndSortOptions.onlyVisible,this.onlyVisibleInitialized=!0),!this.layerFilterAndSortOptions.onlyInRange||this.onlyInRangeInitialized||this.layersAreAllInRange||(this.onlyInRange=this.layerFilterAndSortOptions.onlyInRange,this.onlyInRangeInitialized=!0)},Jr.decorators=[{type:Le.Component,args:[{selector:"igo-layer-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <mat-list-item *ngIf="showToolbar$ | async">\r\n    <ng-container>\r\n      <mat-form-field class="inputFilter" [floatLabel]="floatLabel">\r\n        <input\r\n          matInput\r\n          [placeholder]="\'igo.geo.layer.filterPlaceholder\' | translate"\r\n          [matTooltip]="\'igo.geo.layer.subsetLayersListKeyword\' | translate"\r\n          matTooltipShowDelay="500"\r\n          type="text" [(ngModel)]="keyword">\r\n        <button\r\n          mat-button\r\n          *ngIf="keyword"\r\n          matSuffix\r\n          mat-icon-button\r\n          aria-label="Clear"\r\n          color="warn"\r\n          (click)="clearKeyword()">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <button\r\n        *ngIf="!sortedAlpha"\r\n        mat-icon-button\r\n        [matTooltip]="\'igo.geo.layer.sortAlphabetically\' | translate"\r\n        matTooltipShowDelay="500"\r\n        (click)="toggleSort(true)">\r\n        <mat-icon color="primary" svgIcon="sort-alphabetical"></mat-icon>\r\n      </button>\r\n      <button\r\n        *ngIf="sortedAlpha"\r\n        mat-icon-button\r\n        [matTooltip]="\'igo.geo.layer.sortMapOrder\' | translate"\r\n        matTooltipShowDelay="500"\r\n        (click)="toggleSort(false)">\r\n        <mat-icon color="warn" svgIcon="sort-variant-remove"></mat-icon>\r\n      </button>\r\n      <div [matTooltip]="onlyVisible ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyVisible\' | translate)"\r\n        matTooltipShowDelay="500">\r\n        <button\r\n          mat-icon-button\r\n          [disabled]="layersAreAllVisible && !onlyVisible"\r\n          [color]="onlyVisible ? \'warn\' : \'primary\'"\r\n          (click)="toggleOnlyVisible()">\r\n          <mat-icon\r\n          [svgIcon]="onlyVisible ? \'sort-variant-remove\' : \'eye\'"></mat-icon>\r\n        </button>\r\n      </div>\r\n      <div [matTooltip]="onlyInRange ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyInRange\' | translate)"\r\n        matTooltipShowDelay="500">\r\n        <button\r\n          mat-icon-button\r\n          [disabled]="layersAreAllInRange && !onlyInRange"\r\n          [color]="onlyInRange ? \'warn\' : \'primary\'"\r\n          (click)="toggleOnlyInRange()">\r\n          <mat-icon\r\n          [svgIcon]="onlyInRange ? \'sort-variant-remove\' : \'playlist-check\'"></mat-icon>\r\n        </button>\r\n      </div>\r\n    </ng-container>\r\n  </mat-list-item>\r\n\r\n  <ng-template ngFor let-layer let-i="index" [ngForOf]="layers$ | async">\r\n    <igo-layer-item *ngIf="!(excludeBaseLayers && layer.baseLayer)"\r\n        igoListItem\r\n        [layer]="layer"\r\n        [orderable]="orderable && !layer.baseLayer"\r\n        [lowerDisabled]="getLowerLayer().id === layer.id"\r\n        [raiseDisabled]="getUpperLayer().id === layer.id"\r\n        [queryBadge]="queryBadge"\r\n        [expandLegendIfVisible]="expandLegendOfVisibleLayers"\r\n        [updateLegendOnResolutionChange]="updateLegendOnResolutionChange"\r\n        [toggleLegendOnVisibilityChange]="toggleLegendOnVisibilityChange">\r\n\r\n        <ng-container igoLayerItemToolbar\r\n          [ngTemplateOutlet]="templateLayerToolbar"\r\n          [ngTemplateOutletContext]="{layer: layer}">\r\n        </ng-container>\r\n\r\n    </igo-layer-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:["mat-form-field.inputFilter{width:calc(100% - 100px);max-width:200px}"]}]}],Jr.ctorParameters=function(){return[{type:Yr}]},Jr.propDecorators={templateLayerToolbar:[{type:Le.ContentChild,args:["igoLayerItemToolbar"]}],layersAreAllVisible:[{type:Le.Input}],layersAreAllInRange:[{type:Le.Input}],layers:[{type:Le.Input}],floatLabel:[{type:Le.Input}],layerFilterAndSortOptions:[{type:Le.Input}],excludeBaseLayers:[{type:Le.Input}],toggleLegendOnVisibilityChange:[{type:Le.Input}],expandLegendOfVisibleLayers:[{type:Le.Input}],updateLegendOnResolutionChange:[{type:Le.Input}],queryBadge:[{type:Le.Input}]},Jr);function Jr(e){this.layerListService=e,this.orderable=!0,this.thresholdToFilterAndSort=5,this.layers$=new Ce.BehaviorSubject([]),this.change$=new Ce.ReplaySubject(1),this.showToolbar$=new Ce.BehaviorSubject(!1),this.layersAreAllVisible=!0,this.layersAreAllInRange=!0,this.floatLabel="auto",this.layerFilterAndSortOptions={},this.excludeBaseLayers=!1,this.toggleLegendOnVisibilityChange=!1,this.expandLegendOfVisibleLayers=!1,this.updateLegendOnResolutionChange=!1,this.queryBadge=!1}var Xr=(eo.prototype.getMap=function(){return this.map},eo.prototype.setMap=function(e){this.map=e},eo.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],eo.ctorParameters=function(){return[]},eo.ngInjectableDef=Le.defineInjectable({factory:function(){return new eo},token:eo,providedIn:"root"}),eo);function eo(){}var to=(ro.prototype.ngOnInit=function(){var r=this;this.component.layers=[],this.layersOrResolutionChange$$=Ce.combineLatest([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe(De.debounceTime(10)).subscribe(function(e){var t=e[0].filter(function(e){return!0===e.showInLayerList});r.component.layers=t,r.setLayersVisibilityRangeStatus(t,r.component.excludeBaseLayers)})},ro.prototype.ngAfterViewInit=function(){this.initRoutes()},ro.prototype.setLayersVisibilityRangeStatus=function(e,t){var r=this;this.layersVisibility$$!==undefined&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=undefined),this.layersRange$$!==undefined&&(this.layersRange$$.unsubscribe(),this.layersRange$$=undefined),this.layersVisibility$$=Ce.combineLatest(e.filter(function(e){return e.baseLayer!==t}).map(function(e){return e.visible$})).pipe(De.map(function(e){return e.every(Boolean)})).subscribe(function(e){return r.component.layersAreAllVisible=e}),this.layersRange$$=Ce.combineLatest(e.map(function(e){return e.isInResolutionsRange$})).pipe(De.map(function(e){return e.every(Boolean)})).subscribe(function(e){return r.component.layersAreAllInRange=e})},ro.prototype.initRoutes=function(){var i=this;this.route&&(this.route.options.llcKKey||this.route.options.llcAKey||this.route.options.llcVKey||this.route.options.llcVKey)&&this.route.queryParams.subscribe(function(e){var t=e[i.route.options.llcKKey],r=e[i.route.options.llcAKey],o=e[i.route.options.llcVKey],n=e[i.route.options.llcRKey];t&&!i.layerListService.keywordInitialized&&(i.layerListService.keyword=t,i.layerListService.keywordInitialized=!0),r&&!i.layerListService.sortedAlphaInitialized&&(i.layerListService.sortedAlpha="1"===r,i.layerListService.sortedAlphaInitialized=!0),!o||i.layerListService.onlyVisibleInitialized||i.component.layersAreAllVisible||(i.layerListService.onlyVisible="1"===o,i.layerListService.onlyVisibleInitialized=!0),!n||i.layerListService.onlyInRangeInitialized||i.component.layersAreAllInRange||(i.layerListService.onlyInRange="1"===n,i.layerListService.onlyInRangeInitialized=!0)})},ro.prototype.ngOnDestroy=function(){this.layersOrResolutionChange$$.unsubscribe(),this.layersVisibility$$!==undefined&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=undefined),this.layersRange$$!==undefined&&(this.layersRange$$.unsubscribe(),this.layersRange$$=undefined)},ro.decorators=[{type:Le.Directive,args:[{selector:"[igoLayerListBinding]"}]}],ro.ctorParameters=function(){return[{type:Qr,decorators:[{type:Le.Self}]},{type:Xr},{type:Yr},{type:je.RouteService,decorators:[{type:Le.Optional}]}]},ro);function ro(e,t,r,o){this.mapService=t,this.layerListService=r,this.route=o,this.component=e}var oo=(Object.defineProperty(no.prototype,"options",{get:function(){if(this.layer)return this.layer.options},enumerable:!0,configurable:!0}),no.prototype.ngOnInit=function(){this.color=this.trackFeature?"primary":"basic"},no.prototype.toggleTrackFeature=function(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature},no.decorators=[{type:Le.Component,args:[{selector:"igo-track-feature-button",template:'<button *ngIf="options.trackFeature"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.layer.trackFeature\' | translate"\r\n  [color]="color"\r\n  (click)="toggleTrackFeature()">\r\n  <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n</button>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[""]}]}],no.ctorParameters=function(){return[]},no.propDecorators={layer:[{type:Le.Input}],trackFeature:[{type:Le.Input}]},no);function no(){this.trackFeature=!1,this.color="primary"}var io,ao=(qe(so,io=Te.EntityStoreStrategy),so.prototype.bindStore=function(e){io.prototype.bindStore.call(this,e),!0===this.active&&this.watchStore(e)},so.prototype.unbindStore=function(e){io.prototype.unbindStore.call(this,e),!0===this.active&&this.unwatchStore(e)},so.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},so.prototype.doDeactivate=function(){this.unwatchAll()},so.prototype.watchStore=function(t){var r=this;if(!this.stores$$.has(t)){var e=t.view.all$().subscribe(function(e){return r.onFeaturesChange(e,t)});this.stores$$.set(t,e)}},so.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(t.unsubscribe(),this.stores$$["delete"](e))},so.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){e[1].unsubscribe()}),this.stores$$.clear()},so.prototype.onFeaturesChange=function(e,t){0===e.length?t.clearLayer():t.setLayerFeatures(e,this.selectMotion(t),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},so.prototype.selectMotion=function(e){return this.options.motion!==undefined?this.options.motion:!0===e.pristine?or.Default:e.count>e.view.count?or.Default:or.None},so);function so(e){var t=io.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}var lo,uo=(qe(co,lo=Te.EntityStoreStrategy),co.prototype.bindStore=function(e){lo.prototype.bindStore.call(this,e),!0===this.active&&this.watchStore(e)},co.prototype.unbindStore=function(e){lo.prototype.unbindStore.call(this,e),!0===this.active&&this.unwatchStore(e)},co.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},co.prototype.doDeactivate=function(){this.unwatchAll()},co.prototype.watchStore=function(t){var r=this;this.stores$$.has(t)||(this.onSourceChanges(t),t.layer.ol.getSource().on("change",function(e){r.onSourceChanges(t)}))},co.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(fe.unByKey(t),this.stores$$["delete"](e))},co.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){fe.unByKey(e[1])}),this.stores$$.clear()},co.prototype.onSourceChanges=function(e){var t=e.layer.ol.getSource().getFeatures();0===t.length?e.clear():e.setStoreOlFeatures(t)},co);function co(e){var t=lo.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}var po,ho=(qe(go,po=Te.EntityStore),Object.defineProperty(go.prototype,"source",{get:function(){return this.layer?this.layer.dataSource:undefined},enumerable:!0,configurable:!0}),go.prototype.bindLayer=function(e){return this.layer=e,this},go.prototype.setLayerFeatures=function(e,t,r,o,n){var i=this;void 0===t&&(t=or.Default),n=n||Te.getEntityId,this.checkLayer();var a=e.map(function(e){return wo(e,i.map.projection,n)});this.setLayerOlFeatures(a,t,r,o)},go.prototype.setStoreOlFeatures=function(e){var t=this;this.checkLayer();var r=e.map(function(e){return e.set("_featureStore",t,!0),Fo(e,t.layer.map.projection)});this.load(r)},go.prototype.clearLayer=function(){this.checkLayer(),this.source.ol.clear()},go.prototype.checkLayer=function(){if(this.layer===undefined)throw new Error("This FeatureStore is not bound to a layer.")},go.prototype.setLayerOlFeatures=function(e,t,r,o){void 0===t&&(t=or.Default);var n=jo(this.layer.ol.getSource().getFeatures(),e);0<n.remove.length&&this.removeOlFeaturesFromLayer(n.remove),0<n.add.length&&this.addOlFeaturesToLayer(n.add),0<n.add.length?Lo(this.map,n.add,t,r,o):0<n.remove.length&&Lo(this.map,e,t,r,o)},go.prototype.addOlFeaturesToLayer=function(e){var t=this;e.forEach(function(e){e.set("_featureStore",t,!0)}),this.source.ol.addFeatures(e)},go.prototype.removeOlFeaturesFromLayer=function(e){var t=this;e.forEach(function(e){t.source.ol.removeFeature(e)})},go);function go(e,t){var r=po.call(this,e,t)||this;return r.map=t.map,r}var fo,mo=(qe(yo,fo=oe),yo);function yo(e){return fo.call(this,e)||this}var vo,bo=(qe(So,vo=Te.EntityStoreStrategy),Object.defineProperty(So.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),Object.defineProperty(So.prototype,"overlayStore",{get:function(){return this._overlayStore},enumerable:!0,configurable:!0}),So.prototype.bindStore=function(e){vo.prototype.bindStore.call(this,e),!0===this.active&&this.activate()},So.prototype.unbindStore=function(e){vo.prototype.unbindStore.call(this,e),!0===this.active&&this.activate()},So.prototype.unselectAll=function(){this.stores.forEach(function(e){e.state.updateAll({selected:!1})})},So.prototype.clear=function(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()},So.prototype.doActivate=function(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()},So.prototype.doDeactivate=function(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll(),this.removeOverlayLayer()},So.prototype.watchAll=function(){var t=this;this.unwatchAll();var e=this.stores.map(function(e){return e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(De.map(function(e){return e.map(function(e){return e.entity})}))});this.stores$$=Ce.combineLatest.apply(void 0,Ke(e)).pipe(De.debounceTime(5),De.skip(1),De.map(function(e){return e.reduce(function(e,t){return e.concat(t)})})).subscribe(function(e){return t.onSelectFromStore(e)})},So.prototype.unwatchAll=function(){this.stores$$!==undefined&&this.stores$$.unsubscribe()},So.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){t.onMapClick(e)})},So.prototype.unlistenToMapClick=function(){this.mapClickListener!==undefined&&this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener)},So.prototype.onMapClick=function(e){var r=this,t=!Ho(e),o=!t,n=e.map.getFeaturesAtPixel(e.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:function(t){return r.stores.find(function(e){return e.layer.ol===t})!==undefined}});this.onSelectFromMap(n,t,o)},So.prototype.addDragBoxInteraction=function(){var e,t,r,o=this,n=this.map.ol.getInteractions().getArray();try{for(var i=We(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(s instanceof mo){r=s;break}}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}r===undefined&&(r=new mo({condition:Ho}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",function(e){return o.onDragBoxEnd(e)})},So.prototype.removeDragBoxInteraction=function(){this.olDragSelectInteractionEndKey!==undefined&&fe.unByKey(this.olDragSelectInteractionEndKey),this.olDragSelectInteraction!==undefined&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=undefined},So.prototype.onDragBoxEnd=function(e){var t=!Ho(e.mapBrowserEvent),o=e.target.getGeometry().getExtent(),r=this.stores.reduce(function(e,t){var r=t.layer.ol.getSource();return e.push.apply(e,Ke(r.getFeaturesInExtent(o))),e},[]);this.onSelectFromMap(r,t,!1)},So.prototype.onSelectFromStore=function(e){var t,r=this.options?this.options.motion:undefined,o=this.overlayStore.layer.ol.getSource().getFeatures().map(function(e){return e.getId()}),n=e.map(this.overlayStore.getKey);t=0!==e.length&&(o.length!==n.length||!o.every(function(e){return 0<=n.indexOf(e)})),this.overlayStore.setLayerFeatures(e,t?r:or.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},So.prototype.onSelectFromMap=function(e,r,o){var n=this,i=this.groupFeaturesByStore(e);this.stores.forEach(function(e){var t=i.get(e);t===undefined&&!0===r?n.unselectAllFeaturesFromStore(e):t===undefined&&!1===r||n.selectFeaturesFromStore(e,t,r,o)})},So.prototype.selectFeaturesFromStore=function(e,t,r,o){!0===o?e.state.reverseMany(t,["selected"]):e.state.updateMany(t,{selected:!0},r)},So.prototype.unselectAllFeaturesFromStore=function(e){e.state.updateAll({selected:!1})},So.prototype.groupFeaturesByStore=function(e){var n=new Map;return null===e||e===undefined||e.forEach(function(e){var t=e.get("_featureStore");if(t!==undefined){var r=n.get(t);r===undefined&&(r=[],n.set(t,r));var o=t.get(e.getId());o!==undefined&&r.push(o)}}),n},So.prototype.createOverlayStore=function(){var e=this.options.layer?this.options.layer:this.createOverlayLayer();return new ho([],{map:this.map}).bindLayer(e)},So.prototype.createOverlayLayer=function(){return new Tr({zIndex:300,source:new nt,style:undefined,showInLayerList:!1,exportable:!1,browsable:!1})},So.prototype.addOverlayLayer=function(){this.overlayStore.layer.map===undefined&&this.map.addLayer(this.overlayStore.layer)},So.prototype.removeOverlayLayer=function(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)},So);function So(e){var t=vo.call(this,e)||this;return t.options=e,t._overlayStore=t.createOverlayStore(),t}function wo(e,t,r){r=r||Te.getEntityId;var o=(new Ie).readFeature(e,{dataProjection:e.projection,featureProjection:t});o.setId(r(e));var n=Te.getEntityTitle(e);n!==undefined&&o.set("_title",n,!0),e.extent!==undefined&&o.set("_extent",e.extent,!0),e.projection!==undefined&&o.set("_projection",e.projection,!0);var i=Te.getEntityProperty(e,"meta.mapTitle");i!==undefined&&o.set("_mapTitle",i,!0),o.set("_entityRevision",Te.getEntityRevision(e),!0);var a=Te.getEntityIcon(e);return a!==undefined&&o.set("_icon",a,!0),e.meta&&e.meta.style&&o.set("_style",e.meta.style,!0),o}function Io(e,t,r,o){var n,i,a,s;void 0===o&&(o="EPSG:4326"),r?(i=r.get("title"),r.get("sourceOptions")&&(a=r.get("sourceOptions").excludeAttribute,s=r.get("sourceOptions").excludeAttributeOffline)):i=e.get("_title");var l=new Ie,u=e.getProperties(),c=e.getType();if("Polygon"===c){var p=e.ends_;n=new te(e.flatCoordinates_,C.XY,p)}else"Point"===c?n=new U(e.flatCoordinates_,C.XY):"LineString"===c&&(n=new Y(e.flatCoordinates_,C.XY));var d=l.writeGeometryObject(n,{dataProjection:o,featureProjection:t}),h=e.getId()?e.getId():ke.uuid(),g=e.get("_mapTitle");return{type:rr,projection:o,extent:e.getExtent(),meta:{id:h,title:i||(g||h),mapTitle:g,excludeAttribute:a,excludeAttributeOffline:s},properties:u,geometry:d,ol:e}}function Fo(r,e,t,o){var n,i,a;void 0===o&&(o="EPSG:4326");var s=new Ie,l=r.getKeys().filter(function(e){return!e.startsWith("_")&&"geometry"!==e}).reduce(function(e,t){return e[t]=r.get(t),e},{}),u=s.writeGeometryObject(r.getGeometry(),{dataProjection:o,featureProjection:e});t?(n=t.get("title"),t.get("sourceOptions")&&(i=t.get("sourceOptions").excludeAttribute,a=t.get("sourceOptions").excludeAttributeOffline)):n=r.get("_title");var c=r.get("_mapTitle"),p=r.getId()?r.getId():ke.uuid();return{type:rr,projection:o,extent:r.get("_extent"),meta:{id:p,title:n||(c||p),mapTitle:c,revision:r.getRevision(),style:r.get("_style"),excludeAttribute:i,excludeAttributeOffline:a},properties:l,geometry:u,ol:r}}function Oo(e,t){var r=z.createEmpty(),o=t.get("_extent"),n=t.get("_projection");if(o!==undefined&&n!==undefined)r=be.transformExtent(o,n,e.projection);else{var i=t.getGeometry();null!==i&&(r=i.getExtent())}return r}function To(r,e){var o=z.createEmpty();return e.forEach(function(e){var t=Oo(r,e);z.extend(o,t)}),o}function xo(e,t){var r=ze(z.getSize(e),2),o=r[0],n=r[1];return[t[3]?e[0]-o*t[3]:e[0],t[2]?e[1]-n*t[2]:e[1],t[1]?e[2]+o*t[1]:e[2],t[0]?e[3]+n*t[0]:e[3]]}function Co(e,t){var r=e.viewController.getExtent(),o=xo(r,[-1,-1,-1,-1].map(function(e){return.05*e}));return!z.containsExtent(o,t)}function Mo(e,t,r){r=r||.004;var o=e.viewController.getExtent(),n=z.getArea(o),i=z.getArea(t);return!(0===i&&13<e.viewController.getZoom())&&i/n<r}function Lo(e,t,r,o,n){void 0===r&&(r=or.Default);var i=To(e,t),a=i;o!==undefined&&(a=xo(a,o)),r===or.Zoom?e.viewController.zoomToExtent(a):r===or.Move?e.viewController.moveToExtent(a):r===or.Default&&(Co(e,i)||Mo(e,i,n))&&e.viewController.zoomToExtent(a)}function Po(e,t){e.layer===undefined&&(t=t||new Tr({source:new nt}),e.bindLayer(t)),e.layer.map===undefined&&e.map.addLayer(e.layer)}function Do(e,t){e.getStrategyOfType(ao)===undefined?(t=t||new ao({}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(ao)}function ko(e,t){e.getStrategyOfType(bo)===undefined?(t=t||new bo({map:e.map}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(bo)}function jo(e,t){var r=new Map;t.forEach(function(e){r.set(e.getId(),e)});var o=[];e.forEach(function(e){var t=r.get(e.getId());t===undefined?o.push(e):t.get("_entityRevision")!==e.get("_entityRevision")?o.push(e):r["delete"](t.getId())});var n=Array.from(r.keys());return{add:t.filter(function(e){return 0<=n.indexOf(e.getId())}),remove:o}}var Eo=(Object.defineProperty(Ro.prototype,"feature",{get:function(){return this.feature$.value},set:function(e){this.feature$.next(e)},enumerable:!0,configurable:!0}),Ro.prototype.onSubmit=function(e){var t=this.formDataToFeature(e);this.submitForm.emit(t)},Ro.prototype.getData=function(){return this.formDataToFeature(this.igoForm.getData())},Ro.prototype.formDataToFeature=function(e){var i={},t={};this.feature===undefined?t.id=ke.uuid():(Object.assign(i,this.feature.properties),Object.assign(t,this.feature.meta,{revision:Te.getEntityRevision(this.feature)+1}));var a="properties.";Object.entries(e).forEach(function(e){var t=ze(e,2),r=t[0],o=t[1];if(r.startsWith(a)){var n=r.substr(a.length);i[n]=o}});var r=e.geometry;return r===undefined&&this.feature!==undefined&&(r=this.feature.geometry),{meta:t,type:rr,geometry:r,projection:"EPSG:4326",properties:i}},Ro.decorators=[{type:Le.Component,args:[{selector:"igo-feature-form",template:'\r\n<igo-form\r\n  #igoForm\r\n  [form]="form"\r\n  [formData]="feature$ | async"\r\n  (submitForm)="onSubmit($event)">\r\n\r\n  <ng-content></ng-content>\r\n  \r\n  <ng-content select="[formButtons]" formButtons></ng-content>\r\n  \r\n</igo-form>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}igo-form{height:100%}"]}]}],Ro.ctorParameters=function(){return[]},Ro.propDecorators={form:[{type:Le.Input}],feature:[{type:Le.Input}],submitForm:[{type:Le.Output}],igoForm:[{type:Le.ViewChild,args:["igoForm"]}]},Ro);function Ro(){this.feature$=new Ce.BehaviorSubject(undefined),this.submitForm=new Le.EventEmitter}var $o=(Object.defineProperty(Ao.prototype,"dataSource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),Ao.prototype.setMap=function(e){e===undefined?this.map!==undefined&&this.map.ol.removeLayer(this.layer.ol):e.ol.addLayer(this.layer.ol),this.map=e},Ao.prototype.setFeatures=function(e,t){void 0===t&&(t=or.Default),this.clear(),this.addFeatures(e,t)},Ao.prototype.addFeature=function(e,t){void 0===t&&(t=or.Default),this.addFeatures([e],t)},Ao.prototype.addFeatures=function(e,t){var r=this;void 0===t&&(t=or.Default);var o=[];e.forEach(function(e){var t=wo(e,r.map.projection);null!==t.getGeometry()&&o.push(t)}),this.addOlFeatures(o,t)},Ao.prototype.addOlFeature=function(e,t){void 0===t&&(t=or.Default),this.addOlFeatures([e],t)},Ao.prototype.addOlFeatures=function(e,t){void 0===t&&(t=or.Default),this.dataSource.ol.addFeatures(e),Lo(this.map,e,t)},Ao.prototype.clear=function(){this.dataSource.ol.clear()},Ao);function Ao(e){this.layer=Ar(),this.setMap(e)}var Go,Bo=(qe(_o,Go=ke.Watcher),_o.prototype.watch=function(){},_o.prototype.unwatch=function(){var t=this;this.layers.forEach(function(e){return t.unwatchLayer(e)},this)},_o.prototype.watchLayer=function(e){var t=this;if(e.status$!==undefined){this.layers.push(e);var r=e.status$.pipe(De.distinctUntilChanged()).subscribe(function(e){e===ke.SubjectStatus.Working?t.loading+=1:e===ke.SubjectStatus.Done&&(t.loaded+=1),t.loaded>=t.loading?(t.loading=t.loaded=0,t.status=ke.SubjectStatus.Done):0<t.loading&&(t.status=ke.SubjectStatus.Working)});this.subscriptions.push(r)}},_o.prototype.unwatchLayer=function(e){e.status$.next(ke.SubjectStatus.Done);var t=this.layers.indexOf(e);if(0<=t){var r=e.watcher.status;-1!==[ke.SubjectStatus.Working,ke.SubjectStatus.Waiting].indexOf(r)&&(this.loaded+=1),this.subscriptions[t].unsubscribe(),this.subscriptions.splice(t,1),this.layers.splice(t,1),e.watcher.unwatch()}},_o);function _o(){var e=Go.call(this)||this;return e.loaded=0,e.loading=0,e.layers=[],e.subscriptions=[],e}var qo={Move:0,Zoom:1};function No(e,t,r){var o,n,i,a,s,l,u,c,p,d,h,g,f,m,y,v,b,S,w,I,F,O,T,x,C,M,L,P,D,k;void 0===r&&(r={});var j,E=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),R="([-+])?([\\d]{1,3})([,.](\\d+))?",$=R+"[\\s,]+"+R,A=new RegExp("^"+$+"$","g"),G="([0-9]{1,2})[:|]?\\s*([0-9]{1,2})?[:|'||]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"||]?\\s*",B=G+"([N|S|E|W|O]),?\\s*"+G+"([N|S|E|W|O])",_=new RegExp("^"+B,"gi"),q="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",N=new RegExp("^"+q,"gi"),V="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",U=new RegExp("^"+V,"gi"),W="([-+])?(\\d{1,3})[,.](\\d+)",z=W+"\\s*[,]?\\s*"+W,K=new RegExp("^"+z,"g"),H="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Y=H+"\\s*[,.]?\\s*"+H,Z=new RegExp("^"+Y,"g"),Q="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",J=new RegExp("^"+Q+"?","gi"),X="([-+]?\\d+)[,.]?(\\d+)?",ee=X+"[\\s,]+"+X,te=new RegExp("^"+ee+"$","g"),re=!1;if(e=e.toLocaleUpperCase().trim(),E.test(e)?(f=(o=ze(e.split(";").map(function(e){return e.trim()}),2))[0],j=o[1]):f=e,A.test(f))m=(n=ze(f.match($),9))[1],D=n[2],w=n[4],I=n[5],k=n[6],C=n[8],D=parseFloat((m||"")+D+"."+w),k=parseFloat((I||"")+k+"."+C);else if(_.test(f))y=(i=ze(f.match(B),9))[1],v=i[2],b=i[3],S=i[4],F=i[5],O=i[6],T=i[7],x=i[8],"S"!==S&&"N"!==S||(y=[F,F=y][0],v=[O,O=v][0],b=[T,T=b][0],S=[x,x=S][0]),D=Vo(parseFloat(y),parseFloat(v),parseFloat(b),S),k=Vo(parseFloat(F),parseFloat(O),parseFloat(T),x);else if(N.test(f)){re=!0,M=(a=ze(f.match(q),5))[2],D=a[3],k=a[4];var oe=Number(M)<10?"EPSG:3260"+M:"EPSG:326"+M;D=(s=ze(be.transform([parseFloat(D),parseFloat(k)],oe,"EPSG:4326"),2))[0],k=s[1]}else if(U.test(f)){re=!0,M=(l=ze(f.match(V),5))[2],D=l[3],k=l[4];var ne=Number(M)<10?"EPSG:3218"+M:"EPSG:321"+(80+Number(M));D=(u=ze(be.transform([parseFloat(D),parseFloat(k)],ne,"EPSG:4326"),2))[0],k=u[1]}else if(Z.test(f))m=(c=ze(f.match(Y),11))[1],y=c[2],v=c[3],b=c[4],w=c[5],I=c[6],F=c[7],O=c[8],T=c[9],C=c[10],D=Vo(parseFloat((m||"")+y),parseFloat(v),parseFloat(b),S),k=Vo(parseFloat((I||"")+F),parseFloat(O),parseFloat(T),x);else if(K.test(f))m=(p=ze(f.match(z),7))[1],y=p[2],w=p[3],I=p[4],F=p[5],C=p[6],D=Vo(parseFloat((m||"")+y),parseFloat(v),parseFloat(b),S),k=Vo(parseFloat((I||"")+F),parseFloat(O),parseFloat(T),x);else if(J.test(f))I=(d=ze(f.match(Q),15))[1],F=d[2],O=d[3],T=d[4],x=d[6],m=d[7],y=d[8],v=d[9],b=d[10],S=d[12],L=d[13],P=d[14],S=S||"W",D=v&&2<v.length?parseFloat((m||"")+y+"."+v):Vo(parseFloat(y),parseFloat(v),parseFloat(b),S),k=O&&2<O.length?parseFloat((I||"")+F+"."+O):Vo(parseFloat(F),parseFloat(O),parseFloat(T),x);else{if(!te.test(f))return{lonLat:undefined,message:"",radius:undefined,conf:undefined};re=!0,D=(h=ze(f.match(ee),5))[1],w=h[2],k=h[3],C=h[4],w&&(D=parseFloat(D+"."+w)),C&&(k=parseFloat(k+"."+C))}if(r.forceNA&&!re&&(0<D&&0<k&&(k<D?D=-D:k=-k),k<D&&(D=[k,k=D][0])),g=[Number(D),Number(k)],j!==undefined&&"4326"!==j||180<g[0]||g[0]<-180||90<g[1]||g[1]<-90){var ie=j?"EPSG:"+j:t;try{g=be.transform(g,ie,"EPSG:4326")}catch(ae){return{lonLat:undefined,message:"Projection "+ie+" not supported",radius:undefined,conf:undefined}}}return{lonLat:g,message:"",radius:L?parseInt(L,10):undefined,conf:P?parseInt(P,10):undefined}}function Vo(e,t,r,o){var n=e+(t=t||0)/60+(r=r||0)/3600;return"S"!==o&&"W"!==o||(n=-n),n}function Uo(e,t){if(e===undefined||t===undefined)return!1;return e.zoom===t.zoom&&Math.trunc(e.center[0]/1e-4)===Math.trunc(t.center[0]/1e-4)&&Math.trunc(e.center[1]/1e-4)===Math.trunc(t.center[1]/1e-4)}function Wo(e){return(e=Math.round(e))<1e4?e+"":(e=Math.round(e/1e3))<1e3?e+"K":(e=Math.round(e/1e3))+"M"}function zo(e,t){void 0===t&&(t=96);return e/(39.3701*t)}function Ko(e,t,r){void 0===t&&(t="m"),void 0===r&&(r=96);return e*be.METERS_PER_UNIT[t]*39.3701*r}function Ho(e){var t=e.originalEvent;return!t.altKey&&(j.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey}function Yo(e,t){return void 0===t&&(t=3),[e[0].toFixed(t),e[1].toFixed(t)]}function Zo(o,e){var t=be.transform(o,"EPSG:4326","EPSG:3857"),n=[{code:"EPSG:3857",alias:"Web mercator",coord:t,igo2CoordFormat:Yo(t).join(", ")+" ; 3857"}],r=Qo(o),i=r<10?"EPSG:3260"+r:"EPSG:326"+r,a="UTM-"+r,s=be.transform(o,"EPSG:4326",i);n.push({code:i,alias:"UTM",coord:s,igo2CoordFormat:a+" "+Yo(s).join(", ")});var l=Jo(o);if(l){var u=l<10?"EPSG:3218"+l:"EPSG:321"+(80+l),c="MTM-"+l,p=be.transform(o,"EPSG:4326",u);n.push({code:u,alias:"MTM",coord:p,igo2CoordFormat:c+" "+Yo(p).join(", ")})}return e.forEach(function(e){var t=be.transform(o,"EPSG:4326",e.code),r=e.code.split(":")[1];n.push({code:e.code,alias:e.alias||e.code,coord:t,igo2CoordFormat:Yo(t).join(", ")+" ; "+r})}),n}function Qo(e){return Math.ceil((e[0]+180)/6)}function Jo(e){var t,r=e[0];return r<-51&&-54<r&&(t=1),r<-54&&-57<r&&(t=2),r<-57&&-60<r&&(t=3),r<-60&&-63<r&&(t=4),r<-63&&-66<r&&(t=5),r<-66&&-69<r&&(t=6),r<-69&&-72<r&&(t=7),r<-72&&-75<r&&(t=8),r<-75&&-78<r&&(t=9),r<-78&&-81<r&&(t=10),t}qo[qo.Move]="Move",qo[qo.Zoom]="Zoom";var Xo=(en.prototype.getOlMap=function(){return this.olMap},en.prototype.setOlMap=function(e){if(e!==undefined&&this.getOlMap()!==undefined)throw new Error("This controller is already bound to a map.");if(e===undefined)return this.teardownObservers(),void(this.olMap=e);this.olMap=e},en.prototype.teardownObservers=function(){this.observerKeys.forEach(function(e){return fe.unByKey(e)}),this.observerKeys=[]},en);function en(){this.observerKeys=[]}var tn,rn=(qe(on,tn=Xo),Object.defineProperty(on.prototype,"stateHistory",{get:function(){return!!this.options&&!0===this.options.stateHistory},enumerable:!0,configurable:!0}),Object.defineProperty(on.prototype,"olView",{get:function(){return this.olMap.getView()},enumerable:!0,configurable:!0}),on.prototype.setOlMap=function(e){tn.prototype.setOlMap.call(this,e),this.setupObservers()},on.prototype.setupObservers=function(){var t=this;!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",function(e){return t.onMoveEnd(e)})),this.extent$$=this.extent$.pipe(De.debounceTime(25)).subscribe(function(e){t.setExtent(e.extent,e.action)})},on.prototype.teardownObservers=function(){tn.prototype.teardownObservers.call(this),this.extent$$!==undefined&&(this.extent$$.unsubscribe(),this.extent$$=undefined)},on.prototype.getOlProjection=function(){return this.olView.getProjection()},on.prototype.getCenter=function(e){var t=this.olView.getCenter();return e&&t&&(t=be.transform(t,this.getOlProjection(),e)),t},on.prototype.getExtent=function(e){var t=this.olView.calculateExtent(this.olMap.getSize());return e&&t&&(t=be.transformExtent(t,this.getOlProjection(),e)),t},on.prototype.getScale=function(e){return void 0===e&&(e=96),Ko(this.getResolution(),this.getOlProjection().getUnits(),e)},on.prototype.getResolution=function(){return this.olView.getResolution()},on.prototype.getZoom=function(){return Math.round(this.olView.getZoom())},on.prototype.zoomIn=function(){this.zoomTo(this.olView.getZoom()+1)},on.prototype.zoomOut=function(){this.zoomTo(this.olView.getZoom()-1)},on.prototype.zoomTo=function(e){this.olView.cancelAnimations(),this.olView.animate({zoom:e,duration:250,easing:k.easeOut})},on.prototype.moveToExtent=function(e){this.extent$.next({extent:e,action:qo.Move})},on.prototype.zoomToExtent=function(e){this.extent$.next({extent:e,action:qo.Zoom})},on.prototype.getRotation=function(){return this.olView.getRotation()},on.prototype.resetRotation=function(){this.olView.animate({rotation:0})},on.prototype.hasPreviousState=function(){return 1<this.states.length&&0<this.stateIndex},on.prototype.hasNextState=function(){return 1<this.states.length&&this.stateIndex<this.states.length-1},on.prototype.previousState=function(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)},on.prototype.nextState=function(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)},on.prototype.clearStateHistory=function(){this.states=[],this.stateIndex=0},on.prototype.setInitialState=function(){0<this.states.length&&this.setStateIndex(0)},on.prototype.setExtent=function(e,t,r){void 0===r&&(r=!0);var o=this.olView;o.cancelAnimations();var n=r?500:0,i=o.getZoom(),a=o.getCenter(),s=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2],l=Math.sqrt(Math.pow(a[0]-s[0],2)+Math.pow(a[1]-s[1],2)),u=o.calculateExtent(),c=Math.sqrt(Math.pow(u[2]-u[0],2)+Math.pow(u[3]-u[1],2)),p=l/((Math.sqrt(Math.pow(e[2]-e[0],2)+Math.pow(e[3]-e[1],2))+c)/2),d=t===qo.Move||i>this.maxZoomOnExtent?i:this.maxZoomOnExtent;o.fit(e,{maxZoom:d,padding:this.padding,duration:4<p?0:n})},on.prototype.setStateIndex=function(e){this.stateIndex=e,this.setState(this.states[e])},on.prototype.setState=function(e){this.olView.animate({resolution:e.resolution,center:e.center,duration:0})},on.prototype.onMoveEnd=function(e){var t=this.getResolution();this.resolution$.value!==t&&this.resolution$.next(t);var r={resolution:t,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){var o=this.stateIndex;Uo(r,0===this.states.length?undefined:this.states[o])||(this.states=this.states.slice(0,o+1).concat([r]),this.stateIndex=this.states.length-1)}this.state$.next(r)},on);function on(e){var t=tn.call(this)||this;return t.options=e,t.resolution$=new Ce.BehaviorSubject(undefined),t.state$=new Ce.BehaviorSubject(undefined),t.padding=[0,0,0,0],t.maxZoomOnExtent=19,t.extent$=new Ce.Subject,t.states=[],t.stateIndex=0,t}var nn=(Object.defineProperty(an.prototype,"layers",{get:function(){return this.layers$.value},enumerable:!0,configurable:!0}),Object.defineProperty(an.prototype,"projection",{get:function(){return this.viewController.getOlProjection().getCode()},enumerable:!0,configurable:!0}),an.prototype.init=function(){var e=[];if(this.options.controls){if(this.options.controls.attribution){var t=!0===this.options.controls.attribution?{}:this.options.controls.attribution;e.push(new O(t))}if(this.options.controls.scaleLine){var r=!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine;e.push(new T(r))}}var o={};!1===this.options.interactions&&(o={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new w({interactions:ge.defaults(o),controls:e}),this.setView(this.options.view||{}),this.viewController=new rn({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new $o(this),this.buffer=new $o(this)},an.prototype.setTarget=function(e){this.ol.setTarget(e),e!==undefined?this.layerWatcher.subscribe(function(){},null):this.layerWatcher.unsubscribe()},an.prototype.updateView=function(e){var t=this.ol.getView(),r=Object.assign({zoom:t.getZoom()},t.getProperties());this.setView(Object.assign(r,e)),e.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=e.maxZoomOnExtent)},an.prototype.setView=function(e){this.viewController!==undefined&&this.viewController.clearStateHistory();var t=new I(e);if(this.ol.setView(t),this.unsubscribeGeolocate(),e){if(e.center){var r=t.getProjection().getCode(),o=be.fromLonLat(e.center,r);t.setCenter(o)}e.geolocate&&this.geolocate(!0)}},an.prototype.getCenter=function(e){return this.viewController.getCenter(e)},an.prototype.getExtent=function(e){return this.viewController.getExtent(e)},an.prototype.getZoom=function(){return this.viewController.getZoom()},an.prototype.changeBaseLayer=function(e){var t,r;if(e){try{for(var o=We(this.getBaseLayers()),n=o.next();!n.done;n=o.next())n.value.visible=!1}catch(i){t={error:i}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}e.visible=!0,this.viewController.olView.setMinZoom(e.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(e.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}},an.prototype.getBaseLayers=function(){return this.layers.filter(function(e){return!0===e.baseLayer})},an.prototype.getLayerById=function(t){return this.layers.find(function(e){return e.id&&e.id===t})},an.prototype.getLayerByAlias=function(t){return this.layers.find(function(e){return e.alias&&e.alias===t})},an.prototype.addLayer=function(e,t){void 0===t&&(t=!0),this.addLayers([e])},an.prototype.addLayers=function(e,t){var r=this;void 0===t&&(t=!0);var o=0,n=e.map(function(e){return r.doAddLayer(e,o++)}).filter(function(e){return e!==undefined});this.setLayers([].concat(this.layers,n))},an.prototype.removeLayer=function(e){this.removeLayers([e])},an.prototype.removeLayers=function(e){var r=this,o=this.layers$.value.slice(0),n=[];e.forEach(function(e){var t=r.getLayerIndex(e);0<=t&&(n.push(e),o.splice(t,1))}),n.forEach(function(e){return r.doRemoveLayer(e)}),this.setLayers(o)},an.prototype.removeAllLayers=function(){var t=this;this.layers.forEach(function(e){return t.doRemoveLayer(e)}),this.layers$.next([])},an.prototype.raiseLayer=function(e){var t=this.getLayerIndex(e);0<t&&this.moveLayer(e,t,t-1)},an.prototype.lowerLayer=function(e){var t=this.getLayerIndex(e);t<this.layers.length-1&&this.moveLayer(e,t,t+1)},an.prototype.moveLayer=function(e,t,r){var o=this.layers[r],n=o.zIndex,i=e.zIndex;o.baseLayer||(e.zIndex=n,o.zIndex=i,this.layers[r]=e,this.layers[t]=o,this.layers$.next(this.layers.slice(0)))},an.prototype.doAddLayer=function(e,t){e.baseLayer&&e.visible&&this.changeBaseLayer(e);var r=this.getLayerById(e.id);if(r===undefined){if(e.zIndex===undefined||0===e.zIndex){var o=e.baseLayer?1:10;e.zIndex=this.layers.length+o+t}return e.setMap(this),this.layerWatcher.watchLayer(e),this.ol.addLayer(e.ol),e}r.visible=!0},an.prototype.doRemoveLayer=function(e){this.layerWatcher.unwatchLayer(e),this.ol.removeLayer(e.ol),e.setMap(undefined)},an.prototype.setLayers=function(e){this.layers$.next(this.sortLayersByZIndex(e).slice(0))},an.prototype.sortLayersByZIndex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},an.prototype.getLayerIndex=function(t){return this.layers.findIndex(function(e){return e===t})},an.prototype.geolocate=function(u){var c=this;void 0===u&&(u=!1);var p=!0;this.geolocation$$&&(u=this.geolocation.getTracking(),this.unsubscribeGeolocate()),this.startGeolocation(),this.geolocation$$=this.geolocation$.subscribe(function(e){if(e){if(e.getAccuracy()<1e4){var t=e.getAccuracyGeometry(),r=t.getExtent();if(c.geolocationFeature&&c.overlay.dataSource.ol.getFeatureById(c.geolocationFeature.getId())&&(c.overlay.dataSource.ol.removeFeature(c.geolocationFeature),c.buffer.dataSource.ol.removeFeature(c.bufferFeature)),c.geolocationFeature=new ve({geometry:t}),c.geolocationFeature.setId("geolocationFeature"),c.overlay.addOlFeature(c.geolocationFeature),c.ol.getView().options_.buffer){var o=c.ol.getView().options_.buffer.bufferRadius,n=e.getPosition();c.bufferGeom=new x(n,o);var i=c.ol.getView().options_.buffer.bufferStroke,a=c.ol.getView().options_.buffer.bufferFill,s=void 0;s=c.ol.getView().options_.buffer.showBufferRadius?o.toString()+"m":"",c.bufferFeature=new ve(c.bufferGeom),c.bufferFeature.setId("bufferFeature"),c.bufferFeature.set("bufferStroke",i),c.bufferFeature.set("bufferFill",a),c.bufferFeature.set("bufferText",s),c.buffer.addOlFeature(c.bufferFeature)}p&&c.viewController.zoomToExtent(r)}else if(p){var l=c.ol.getView();n=e.getPosition(),l.setCenter(n),l.setZoom(14)}u&&c.unsubscribeGeolocate(),p=!1}})},an.prototype.unsubscribeGeolocate=function(){this.stopGeolocation(),this.geolocation$$&&(this.geolocation$$.unsubscribe(),this.geolocation$$=undefined)},an.prototype.startGeolocation=function(){var t=this;this.geolocation?this.geolocation.setTracking(!0):(this.geolocation=new F({trackingOptions:{enableHighAccuracy:!0},projection:this.projection,tracking:!0}),this.geolocation.on("change",function(e){t.geolocation$.next(t.geolocation)}))},an.prototype.stopGeolocation=function(){this.geolocation&&this.geolocation.setTracking(!1)},an.prototype.onOfflineToggle=function(e){this.offlineButtonToggle$.next(e)},an);function an(e){this.offlineButtonToggle$=new Ce.BehaviorSubject(!1),this.layers$=new Ce.BehaviorSubject([]),this.geolocation$=new Ce.BehaviorSubject(undefined),this.defaultOptions={controls:{attribution:!1}},this.options=Object.assign({},this.defaultOptions,e),this.layerWatcher=new Bo,this.status$=this.layerWatcher.status$,R.register(E),this.init()}var sn=(Object.defineProperty(ln.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),ln.prototype.ngAfterViewInit=function(){var l=this;this.map.offlineButtonToggle$.subscribe(function(e){l.offlineButtonStatus=e;var t=l.languageService.translate;if(l.offlineButtonStatus&&l.networkState.connection){var r=t.instant("igo.geo.network.offline.message"),o=t.instant("igo.geo.network.offline.title");l.messageService.info(r,o),l.offlineButtonState.connection=!1,l.changeLayer()}else if(l.offlineButtonStatus||l.networkState.connection){if(!l.offlineButtonStatus&&l.networkState.connection){var n,i,a=t.get("igo.geo.network.online.message"),s=t.get("igo.geo.network.online.title");a.subscribe(function(e){n=e}),s.subscribe(function(e){i=e}),l.messageService.info(n,i),l.offlineButtonState.connection=!0,l.changeLayer()}}else r=t.instant("igo.geo.network.offline.message"),o=t.instant("igo.geo.network.offline.title"),l.messageService.info(r,o),l.offlineButtonState.connection=!1,l.changeLayer()}),this.networkService.currentState().subscribe(function(e){l.networkState=e,l.offlineButtonStatus||l.changeLayer()}),this.map.layers$.subscribe(function(e){l.changeLayer()})},ln.prototype.changeLayer=function(){var t,r=this;this.map.layers$.value.forEach(function(e){if("mvt"===e.options.sourceOptions.type)t=e.options.sourceOptions,e.ol.getSource().clear();else if("xyz"===e.options.sourceOptions.type)t=e.options.sourceOptions;else if("vector"===e.options.sourceOptions.type)t=e.options.sourceOptions;else if("cluster"===e.options.sourceOptions.type)t=e.options.sourceOptions;else{if(!1===r.networkState.connection||!1===r.offlineButtonState.connection)return void e.ol.setMaxResolution(0);if(!0===r.networkState.connection||!0===r.offlineButtonState.connection)return void e.ol.setMaxResolution(Infinity)}if(t.pathOffline&&!1===r.networkState.connection||t.pathOffline&&!1===r.offlineButtonState.connection){if("vector"===t.type||"cluster"===t.type)return;e.ol.getSource().setUrl(t.pathOffline)}else if(t.pathOffline&&!1===r.networkState.connection||t.pathOffline&&!0===r.offlineButtonState.connection){if("vector"===t.type||"cluster"===t.type)return;e.ol.getSource().setUrl(t.url)}else!1===r.networkState.connection||!1===r.offlineButtonState.connection?e.ol.setMaxResolution(0):!0!==r.networkState.connection&&!0!==r.offlineButtonState.connection||e.ol.setMaxResolution(Infinity)})},ln.decorators=[{type:Le.Directive,args:[{selector:"[igoMapOffline]"}]}],ln.ctorParameters=function(){return[{type:Pr},{type:je.NetworkService},{type:je.MessageService},{type:je.LanguageService}]},ln);function ln(e,t,r,o){this.networkService=t,this.messageService=r,this.languageService=o,this.offlineButtonStatus=!1,this.networkState={connection:!0},this.offlineButtonState={connection:!0},this.component=e}var un=(Object.defineProperty(cn.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Object.defineProperty(cn.prototype,"mapProjection",{get:function(){return this.component.map.projection},enumerable:!0,configurable:!0}),cn.prototype.ngOnInit=function(){this.listenToMapPointerMove(),this.listenToMapClick()},cn.prototype.ngOnDestroy=function(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()},cn.prototype.listenToMapPointerMove=function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(e){return t.onPointerEvent(e,t.pointerPositionDelay)})},cn.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onPointerEvent(e,0)})},cn.prototype.unlistenToMapPointerMove=function(){this.map.ol.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.pointerMoveListener=undefined},cn.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},cn.prototype.onPointerEvent=function(e,t){var r=this;if(!e.dragging&&!this.mediaService.isTouchScreen()){"undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest);var o=be.transform(e.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(function(){r.pointerPositionCoord.emit(o)},t)}},cn.decorators=[{type:Le.Directive,args:[{selector:"[igoPointerPosition]"}]}],cn.ctorParameters=function(){return[{type:Pr,decorators:[{type:Le.Self}]},{type:je.MediaService}]},cn.propDecorators={pointerPositionDelay:[{type:Le.Input}],pointerPositionCoord:[{type:Le.Output}]},cn);function cn(e,t){this.component=e,this.mediaService=t,this.pointerPositionDelay=1e3,this.pointerPositionCoord=new Le.EventEmitter}var pn=(Object.defineProperty(dn.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Object.defineProperty(dn.prototype,"mapProjection",{get:function(){return this.component.map.projection},enumerable:!0,configurable:!0}),dn.prototype.ngOnInit=function(){this.listenToMapPointerMove(),this.listenToMapClick(),this.subscribeToKeyDown(),this.subscribeToKeyUp()},dn.prototype.ngOnDestroy=function(){this.unlistenToMapPointerMove(),this.unlistenToMapClick(),this.unsubscribeToKeyDown(),this.unsubscribeToKeyUp()},dn.prototype.listenToMapPointerMove=function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(e){return t.onPointerEvent(e,t.pointerPositionByKeyDelay)})},dn.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onPointerEvent(e,0)})},dn.prototype.subscribeToKeyDown=function(){var t=this;this.unsubscribeToKeyDown(),this.keyDown$$=Ce.fromEvent(document,"keydown").subscribe(function(e){e.keyCode!==t.pointerPositionByKeyCode||t.definedKeyIsDown$.next(!0)})},dn.prototype.subscribeToKeyUp=function(){var t=this;this.unsubscribeToKeyUp(),this.keyUp$$=Ce.fromEvent(document,"keyup").subscribe(function(e){e.keyCode!==t.pointerPositionByKeyCode||t.definedKeyIsDown$.next(!1)})},dn.prototype.unlistenToMapPointerMove=function(){this.map.ol.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.pointerMoveListener=undefined},dn.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},dn.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&(this.keyDown$$.unsubscribe(),this.keyDown$$=undefined)},dn.prototype.unsubscribeToKeyUp=function(){this.keyUp$$!==undefined&&(this.keyUp$$.unsubscribe(),this.keyUp$$=undefined)},dn.prototype.onPointerEvent=function(e,t){var r=this;if(!e.dragging&&!this.mediaService.isTouchScreen()&&("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.definedKeyIsDown$.value)){var o=be.transform(e.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(function(){r.pointerPositionByKeyCoord.emit(o)},t)}},dn.decorators=[{type:Le.Directive,args:[{selector:"[igoPointerPositionByKey]"}]}],dn.ctorParameters=function(){return[{type:Pr,decorators:[{type:Le.Self}]},{type:je.MediaService}]},dn.propDecorators={pointerPositionByKeyDelay:[{type:Le.Input}],pointerPositionByKeyCode:[{type:Le.Input}],pointerPositionByKeyCoord:[{type:Le.Output}]},dn);function dn(e,t){this.component=e,this.mediaService=t,this.definedKeyIsDown$=new Ce.BehaviorSubject(!1),this.pointerPositionByKeyDelay=1e3,this.pointerPositionByKeyCode=17,this.pointerPositionByKeyCoord=new Le.EventEmitter}var hn=(gn.prototype.registerProjection=function(e){E.defs(e.code,e.def),R.register(E),e.extent&&be.get(e.code).setExtent(e.extent)},gn.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],gn.ctorParameters=function(){return[{type:je.ConfigService}]},gn.ngInjectableDef=Le.defineInjectable({factory:function(){return new gn(Le.inject(je.ConfigService))},token:gn,providedIn:"root"}),gn);function gn(e){var t=this;this.config=e,(this.config.getConfig("projections")||[]).forEach(function(e){e.alias=e.alias?e.alias:e.code,t.registerProjection(e)});for(var r=1;r<61;r++){var o={code:r<10?"EPSG:3260"+r:"EPSG:326"+r,def:"+proj=utm +zone="+r+" +datum=WGS84 +units=m +no_defs",extent:undefined};this.registerProjection(o)}for(var n=1;n<11;n++){o={code:n<10?"EPSG:3218"+n:"EPSG:321"+(80+n),def:"+proj=tmerc +lat_0=0 +lon_0="+(Number(n)<=2?-50-3*Number(n):12<=Number(n)?-81-3*(Number(n)-12):-49.5-3*Number(n))+' +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"',extent:undefined};this.registerProjection(o)}}var fn=(Object.defineProperty(mn.prototype,"zoom",{get:function(){return this.map.viewController.getZoom()},enumerable:!0,configurable:!0}),Object.defineProperty(mn.prototype,"minZoom",{get:function(){return this.map.viewController.olView.getMinZoom()||1},enumerable:!0,configurable:!0}),Object.defineProperty(mn.prototype,"maxZoom",{get:function(){return this.map.viewController.olView.getMaxZoom()},enumerable:!0,configurable:!0}),mn.decorators=[{type:Le.Component,args:[{selector:"igo-zoom-button",template:'<div class="igo-zoom-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomIn\' | translate: {zoom: zoom + 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    [disabled]="zoom >= maxZoom"\r\n    (click)="map.viewController.zoomIn()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomOut\' | translate: {zoom: zoom - 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    [disabled]="zoom <= minZoom"\r\n    (click)="map.viewController.zoomOut()">\r\n    <mat-icon svgIcon="minus"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-zoom-button-container{width:40px}.igo-zoom-button-container button{background-color:#fff}.igo-zoom-button-container button:hover{background-color:#efefef}.igo-zoom-button-container button:first-child{margin-bottom:2px}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],mn.ctorParameters=function(){return[]},mn.propDecorators={map:[{type:Le.Input}],color:[{type:Le.Input}]},mn);function mn(){}var yn=(Object.defineProperty(vn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(vn.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),vn.decorators=[{type:Le.Component,args:[{selector:"igo-geolocate-button",template:'<div class="igo-geolocate-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.geolocate\' | translate"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.geolocate()">\r\n    <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-geolocate-button-container{width:40px;background-color:#fff}.igo-geolocate-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],vn.ctorParameters=function(){return[]},vn.propDecorators={map:[{type:Le.Input}],color:[{type:Le.Input}]},vn);function vn(){}var bn=(Object.defineProperty(Sn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Sn.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(Sn.prototype,"checked",{get:function(){return this.check},enumerable:!0,configurable:!0}),Sn.prototype.onToggle=function(){this.check=!this.check,this.check?this.btnStyle="toggleStyle":this.btnStyle="baseStyle"},Sn.decorators=[{type:Le.Component,args:[{selector:"igo-offline-button",template:'<div *ngIf="visible" class="igo-user-button-container">\r\n  <div>\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="checked ? (\'igo.geo.mapButtons.online\' | translate): (\'igo.geo.mapButtons.offline\' | translate)"\r\n      matTooltipPosition="left"\r\n      [ngClass]="[btnStyle]"\r\n      [color]="checked ? color : [colorOff]"\r\n      (click)="onToggle()"\r\n      (click)="map.onOfflineToggle(check)">\r\n      <mat-icon svgIcon="wifi-strength-off"></mat-icon>\r\n    </button>\r\n  </div>\r\n</div>',styles:[".baseStyle{width:40px;background-color:#fff}.baseStyle:hover{background-color:#efefef}.toggleStyle{width:40px;background-color:#b9b9b9}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],Sn.ctorParameters=function(){return[{type:je.ConfigService}]},Sn.propDecorators={change:[{type:Le.Output}],map:[{type:Le.Input}],color:[{type:Le.Input}],check:[{type:Le.Input}]},Sn);function Sn(e){this.config=e,this.btnStyle="baseStyle",this.colorOff="rgb(255,255,255)",this.change=new Le.EventEmitter,this.check=!1,this.visible=!1,this.visible=!!this.config.getConfig("offlineButton")}function wn(){return $.trigger("baseLayerSwitcherState",[$.state("collapseIcon",$.style({height:"40px",width:"40px",overflow:"hidden"})),$.state("collapseMap",$.style({height:"85px",overflow:"hidden"})),$.state("expand",$.style({overflow:"hidden"})),$.transition("collapse => expand",$.animate("200ms")),$.transition("expand => collapse",$.animate("200ms"))])}var In=(Object.defineProperty(Fn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fn.prototype,"useStaticIcon",{get:function(){return this._useStaticIcon},set:function(e){this._useStaticIcon=e},enumerable:!0,configurable:!0}),Fn.prototype.ngAfterViewInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t._baseLayers=e.filter(function(e){return e.baseLayer})})},Fn.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Fn.prototype.collapseOrExpand=function(){1<this.baseLayers.length||this.useStaticIcon?this.expand=!this.expand:this.expand=!1},Object.defineProperty(Fn.prototype,"baseLayers",{get:function(){var t=this.map.viewController.getResolution(),r=this.map.viewController.getZoom(),e=this._baseLayers.filter(function(e){return(!e.options.maxResolution||t<=e.options.maxResolution)&&(!e.options.minResolution||t>=e.options.minResolution)&&(!e.options.source.options.maxZoom||r<=e.options.source.options.maxZoom)&&(!e.options.source.options.minZoom||r>=e.options.source.options.minZoom)}),o=e.filter(function(e){return!e.visible});return o.length+1===e.length?o:e},enumerable:!0,configurable:!0}),Fn.decorators=[{type:Le.Component,args:[{selector:"igo-baselayers-switcher",template:'<div *ngIf="baseLayers.length > 0"\r\n     class="igo-baselayers-switcher-container"\r\n     [ngClass]="{\'container-expand\': expand}"\r\n     [@baseLayerSwitcherState]="expand ? \'expand\' : useStaticIcon ? \'collapseIcon\' : \'collapseMap\'"\r\n     (@baseLayerSwitcherState.start)="showButton=false"\r\n     (@baseLayerSwitcherState.done)="showButton=true"\r\n     (click)="collapseOrExpand()">\r\n\r\n     <div *ngIf="useStaticIcon && !expand && showButton" class="igo-baselayers-switcher-button-container">\r\n       <button\r\n         mat-icon-button\r\n         [matTooltip]="\'igo.geo.mapButtons.baselayerSwitcher\' | translate"\r\n         matTooltipPosition="right"\r\n         color="primary">\r\n         <mat-icon svgIcon="image-multiple"></mat-icon>\r\n       </button>\r\n     </div>\r\n\r\n     <igo-mini-basemap *ngFor="let baseLayer of baseLayers; let i = index"\r\n       [map]="map"\r\n       [baseLayer]="baseLayer"\r\n       [title]="(baseLayers.length > 2 && !expand) ? (\'igo.geo.baselayersSwitcher.title\' | translate) : baseLayer.title"\r\n       [display]="expand || (i === 0 && !useStaticIcon)"\r\n       [disabled]="!expand && baseLayers.length > 1">\r\n     </igo-mini-basemap>\r\n\r\n    <div class="more-baselayers">\r\n      <mat-icon class="material-icons mat-icon mat-list-avatar" color="primary" svgIcon="menu-down"></mat-icon>\r\n    </div>\r\n\r\n</div>\r\n',animations:[wn()],styles:[".igo-baselayers-switcher-container{height:auto;position:relative}.container-expand{overflow:hidden;border-width:0}.more-baselayers{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers:hover{background-color:#efefef}.igo-baselayers-switcher-button-container{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],Fn.ctorParameters=function(){return[{type:je.MediaService}]},Fn.propDecorators={map:[{type:Le.Input}],useStaticIcon:[{type:Le.Input}]},Fn);function Fn(e){this.mediaService=e,this._baseLayers=[],this.expand=!1,this.showButton=!0,this.mediaService.media$.value===je.Media.Mobile&&this.useStaticIcon===undefined&&(this.useStaticIcon=!0)}var On=(Object.defineProperty(Tn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e,this.handleMoveEnd()},enumerable:!0,configurable:!0}),Object.defineProperty(Tn.prototype,"baseLayer",{get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this.handleBaseLayerChanged(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Tn.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Tn.prototype,"display",{get:function(){return this._display},set:function(e){this._display=e},enumerable:!0,configurable:!0}),Tn.prototype.ngAfterViewInit=function(){var e=this;this.map.ol.on("moveend",function(){return e.handleMoveEnd()}),this.handleMoveEnd()},Tn.prototype.ngOnDestroy=function(){var e=this;this.map.ol.un("moveend",function(){return e.handleMoveEnd()})},Tn.prototype.changeBaseLayer=function(e){this.disabled||(this.map.changeBaseLayer(e),this.appRef.tick())},Tn.prototype.handleMoveEnd=function(){this.basemap.ol.setView(this.map.ol.getView())},Tn.prototype.handleBaseLayerChanged=function(e){this.basemap.removeAllLayers();var t=Object.assign(Object.create(e.options),e.options,{visible:!0,baseLayer:!1}),r=this.layerService.createLayer(t);this.basemap.addLayer(r)},Tn.decorators=[{type:Le.Component,args:[{selector:"igo-mini-basemap",template:'<div class="igo-mini-basemap-container">\r\n\r\n  <div *ngIf="display" (click)="changeBaseLayer(baseLayer)">\r\n    <igo-map-browser [map]="basemap"></igo-map-browser>\r\n    <div *ngIf=\'title\' class=\'igo-mini-basemap-title\'> {{title}} </div>\r\n  </div>\r\n\r\n</div>\r\n',styles:[".igo-mini-basemap-container{width:calc(40px * 2);height:calc(40px * 2);background-color:rgba(255,255,255,.01);border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.3);cursor:pointer;margin-top:5px}.igo-mini-basemap-container:hover .igo-mini-basemap-title{color:#000;text-shadow:0 0 5px #fff}.igo-mini-basemap-container>div{width:100%;height:100%}.igo-mini-basemap-title{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px #000;white-space:normal;display:-webkit-box;display:flex;-webkit-box-align:end;align-items:flex-end;-webkit-box-pack:center;justify-content:center}"]}]}],Tn.ctorParameters=function(){return[{type:An},{type:Le.ApplicationRef}]},Tn.propDecorators={map:[{type:Le.Input}],baseLayer:[{type:Le.Input}],disabled:[{type:Le.Input}],display:[{type:Le.Input}],title:[{type:Le.Input}]},Tn);function Tn(e,t){this.layerService=e,this.appRef=t,this.basemap=new nn({controls:{},interactions:!1})}var xn=(Object.defineProperty(Cn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cn.prototype,"showIfNoRotation",{get:function(){return this._showIfNoRotation},set:function(e){this._showIfNoRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cn.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cn.prototype,"rotated",{get:function(){return 0!==this.map.viewController.getRotation()},enumerable:!0,configurable:!0}),Cn.prototype.rotationStyle=function(e){return{transform:"rotate("+e+"rad)"}},Cn.decorators=[{type:Le.Component,args:[{selector:"igo-rotation-button",template:'<div *ngIf="rotated && !showIfNoRotation" class="igo-rotation-button-container"\r\n  [matTooltip]="rotated ? (\'igo.geo.mapButtons.resetRotation\' | translate): (\'igo.geo.mapButtons.tipRotation\' | translate)"\r\n  matTooltipPosition="left">\r\n  <button mat-icon-button matTooltipPosition="left" [color]="color" [disabled]="!rotated"\r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>\r\n\r\n<div *ngIf="showIfNoRotation" class="igo-rotation-button-container"\r\n  [matTooltip]="rotated ? (\'igo.geo.mapButtons.resetRotation\' | translate): (\'igo.geo.mapButtons.tipRotation\' | translate)"\r\n  matTooltipPosition="left">\r\n  <button mat-icon-button matTooltipPosition="left" [color]="color" [disabled]="!rotated"\r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>',styles:[".igo-rotation-button-container{width:40px;background-color:#fff}.igo-rotation-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){:host>>>button .mat-button-ripple-round:disabled,button:disabled{display:none}}"]}]}],Cn.ctorParameters=function(){return[]},Cn.propDecorators={map:[{type:Le.Input}],showIfNoRotation:[{type:Le.Input}],color:[{type:Le.Input}]},Cn);function Cn(){}var Mn=(Ln._convertPointToPixel=function(e){return e/.75},Ln._transformColor=function(e){return[e[0],e[1],e[2],e[3]/255]},Ln._getResolutionForScale=function(e,t){var r=be.METERS_PER_UNIT[t];return parseFloat(e)/(39.3701*r*96)},Ln._convertEsriTS=function(e){var t=Ln._transformAngle(e.angle),r=e.text!==undefined?e.text:undefined;return new Se.Style({text:new Se.Text({fill:new Se.Fill({color:Ln._transformColor(e.color)}),font:e.font.style+" "+e.font.weight+" "+e.font.size+" px "+e.font.family,textBaseline:e.verticalAlignment,textAlign:e.horizontalAlignment,offsetX:Ln._convertPointToPixel(e.xoffset),offsetY:Ln._convertPointToPixel(e.yoffset),rotation:t,text:r})})},Ln._convertEsriPMS=function(e){var t="data:"+e.contentType+";base64, "+e.imageData,r=Ln._transformAngle(e.angle);return new Se.Style({image:new Se.Icon({src:t,rotation:r})})},Ln._convertEsriSFS=function(e){var t=new Se.Fill({color:Ln._transformColor(e.color)}),r=e.outline?Ln._convertOutline(e.outline):undefined;return new Se.Style({fill:t,stroke:r})},Ln._convertOutline=function(e){var t,r=Ln._transformColor(e.color);return"esriSLSDash"===e.style?t=[5]:"esriSLSDashDot"===e.style?t=[5,5,1,2]:"esriSLSDashDotDot"===e.style?t=[5,5,1,2,1,2]:"esriSLSDot"===e.style?t=[1,2]:"esriSLSNull"===e.style&&(r[3]=0),new Se.Stroke({color:r,lineDash:t,width:Ln._convertPointToPixel(e.width)})},Ln._convertEsriSLS=function(e){return new Se.Style({stroke:Ln._convertOutline(e)})},Ln._transformAngle=function(e){if(0===e||e===undefined)return undefined;var t=-e*Math.PI/180+Math.PI/2;return t<0?2*Math.PI+t:t},Ln._convertEsriSMS=function(e){var t=new Se.Fill({color:Ln._transformColor(e.color)}),r=e.outline?Ln._convertOutline(e.outline):undefined,o=Ln._convertPointToPixel(e.size)/2,n=Ln._transformAngle(e.angle);return"esriSMSCircle"===e.style?new Se.Style({image:new Se.Circle({radius:o,fill:t,stroke:r})}):"esriSMSCross"===e.style?new Se.Style({image:new Se.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:0,rotation:n})}):"esriSMSDiamond"===e.style?new Se.Style({image:new Se.RegularShape({fill:t,stroke:r,points:4,radius:o,rotation:n})}):"esriSMSSquare"===e.style?new Se.Style({image:new Se.RegularShape({fill:t,stroke:r,points:4,radius:o,angle:Math.PI/4,rotation:n})}):"esriSMSX"===e.style?new Se.Style({image:new Se.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:Math.PI/4,rotation:n})}):"esriSMSTriangle"===e.style?new Se.Style({image:new Se.RegularShape({fill:t,stroke:r,points:3,radius:o,angle:0,rotation:n})}):void 0},Ln.prototype._convertLabelingInfo=function(e,t){for(var r=[],o=0,n=e.length;o<n;++o){var i=e[o].labelExpression,a=i.substr(i.indexOf("[")+1,i.indexOf("]")-1),s=e[o].symbol,l=e[o].maxScale,u=e[o].minScale,c=null;0!==l&&(c=Ln._getResolutionForScale(l,t));var p=null;0!==u&&(p=Ln._getResolutionForScale(u,t));var d=this._converters[s.type].call(this,s);r.push(function(e,t){var r=!0;if(null!==this.minResolution&&null!==this.maxResolution?r=t<this.maxResolution&&t>=this.minResolution:null!==this.minResolution?r=t>=this.minResolution:null!==this.maxResolution&&(r=t<this.maxResolution),r){var o=e.get(this.field);return this.style.getText().setText(o),[this.style]}}.bind({minResolution:c,maxResolution:p,field:a,style:d}))}return r},Ln.prototype._renderSimple=function(e){var t=this._converters[e.symbol.type].call(this,e.symbol);return function(){return[t]}},Ln.prototype._renderClassBreaks=function(e){for(var t=e.defaultSymbol,n=this._converters[t.type].call(this,t),i=e.field,a=[],r=0,o=e.classBreakInfos.length;r<o;++r){var s=e.classBreakInfos[r],l=void 0;l=null===s.classMinValue||s.classMinValue===undefined?0===r?e.minValue:e.classBreakInfos[r-1].classMaxValue:s.classMinValue;var u=s.classMaxValue,c=s.symbol,p=this._converters[c.type].call(this,c);a.push({min:l,max:u,style:p})}return function(e){for(var t=e.get(i),r=0,o=a.length;r<o;++r)if(0===r?t>=a[r].min&&t<=a[r].max:t>a[r].min&&t<=a[r].max)return[a[r].style];return[n]}},Ln.prototype._renderUniqueValue=function(e){var t=e.defaultSymbol,i=[];t&&(i=[this._converters[t.type].call(this,t)]);var a=e.field1,s=e.uniqueValueInfos,l=this;return function(){for(var r={},e=0,t=s.length;e<t;++e){var o=s[e],n=o.symbol;r[o.value]=[l._converters[n.type].call(l,n)]}return function(e){var t=r[e.get(a)];return t||i}}()},Ln.prototype.generateStyle=function(e,t){var r=e.drawingInfo,a=[],o=this._renderers[r.renderer.type].call(this,r.renderer);if(o!==undefined&&a.push(o),e.labelingInfo){var n=this._convertLabelingInfo(e.labelingInfo,t);a=a.concat(n)}return 1===a.length?a[0]:function(e,t){for(var r=[],o=0,n=a.length;o<n;++o){var i=a[o].call(null,e,t);i&&(r=r.concat(i))}return r}},Ln);function Ln(){this._converters={},this._converters.esriPMS=Ln._convertEsriPMS,this._converters.esriSFS=Ln._convertEsriSFS,this._converters.esriSLS=Ln._convertEsriSLS,this._converters.esriSMS=Ln._convertEsriSMS,this._converters.esriTS=Ln._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}var Pn={DATE:"date",TIME:"time",DATETIME:"datetime",YEAR:"year"},Dn={CALENDAR:"calendar",SLIDER:"slider"},kn={wms:"wms",wmts:"wmts"},jn=(En.prototype.getWMSOptions=function(t){var r=this,e=t.url,o=t.params.VERSION;return this.getCapabilities("wms",e,o).pipe(De.map(function(e){return e?r.parseWMSOptions(t,e):undefined}))},En.prototype.getWMTSOptions=function(t){var r=this,e=t.url,o=t.version;return this.getCapabilities("wmts",e,o).pipe(De.map(function(e){return e?r.parseWMTSOptions(t,e):undefined}))},En.prototype.getCartoOptions=function(t){var r=this,e="https://"+t.account+".carto.com/api/v2/viz/"+t.mapId+"/viz.json";return this.http.jsonp(e,"callback").pipe(De.map(function(e){return r.parseCartoOptions(t,e)}))},En.prototype.getArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url.replace("FeatureServer","MapServer")+"/legend?f=json",n=this.http.get(e),i=this.http.get(o).pipe(De.map(function(e){return e}),De.catchError(function(e){return console.log("No legend associated with this Feature Service"),Ce.of(e)}));return Ce.forkJoin([n,i]).pipe(De.map(function(e){return r.parseArcgisOptions(t,e[0],e[1])}))},En.prototype.getTileArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url+"/legend?f=json",n=this.http.get(e),i=this.http.get(o);return Ce.forkJoin([n,i]).pipe(De.map(function(e){return r.parseTileArcgisOptions(t,e[0],e[1])}))},En.prototype.getCapabilities=function(r,e,t){var o=this,n=new Pe.HttpParams({fromObject:{request:"GetCapabilities",service:r.toUpperCase(),version:t||"1.3.0",_i:"true"}});return this.http.get(e,{params:n,responseType:"text"}).pipe(De.map(function(e){try{return o.parsers[r].read(e)}catch(t){return undefined}}))},En.prototype.parseWMSOptions=function(e,t){var r=e.params.LAYERS,o=this.findDataSourceInCapabilities(t.Capability.Layer,r);if(!o)return e;var n=o.DataURL?o.DataURL[0]:undefined,i=o.Abstract?o.Abstract:undefined,a=o.KeywordList?o.KeywordList:undefined,s=o.queryable,l=this.getTimeFilter(o),u=l&&0<Object.keys(l).length,c=o.Style?this.getStyle(o.Style):undefined,p=ke.ObjectUtils.removeUndefined({_layerOptionsFromCapabilities:{title:o.Title,maxResolution:zo(o.MaxScaleDenominator)||Infinity,minResolution:zo(o.MinScaleDenominator)||0,metadata:{url:n?n.OnlineResource:undefined,extern:!!n||undefined,"abstract":i,keywordList:a},legendOptions:c},queryable:s,timeFilter:u?l:undefined,timeFilterable:!!u||undefined});return ke.ObjectUtils.mergeDeep(p,e)},En.prototype.parseWMTSOptions=function(e,t){var r=S.optionsFromCapabilities(t,e);return Object.assign(r,e)},En.prototype.parseCartoOptions=function(e,t){var r=[],o=t.layers[1].options.layer_definition;o.layers.forEach(function(e){r.push({type:e.type.toLowerCase(),options:e.options,legend:e.legend})});var n=ke.ObjectUtils.removeUndefined({config:{version:o.version,layers:r}});return ke.ObjectUtils.mergeDeep(n,e)},En.prototype.parseArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new Mn,s="esriMeters"===t.units?"m":"degrees",l=a.generateStyle(t,s),u=new O({html:t.copyrightText});if(t.timeInfo){var c=t.timeInfo.timeExtent;o=c[0]+","+c[1];var p=new Date;p.setTime(c[0]);var d=new Date;d.setTime(c[1]),n={min:p.toUTCString(),max:d.toUTCString(),range:!0,type:Pn.DATETIME,style:Dn.CALENDAR}}var h=Object.assign({},{legendInfo:i,style:l,timeFilter:n,timeExtent:o,attributions:u}),g=ke.ObjectUtils.removeUndefined({params:h});return ke.ObjectUtils.mergeDeep(g,e)},En.prototype.parseTileArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new O({html:t.copyrightText});if(t.timeInfo){var s=t.timeInfo.timeExtent;o=s[0]+","+s[1];var l=new Date;l.setTime(s[0]);var u=new Date;u.setTime(s[1]),n={min:l.toUTCString(),max:u.toUTCString(),range:!0,type:Pn.DATETIME,style:Dn.CALENDAR}}var c=Object.assign({},{layers:"show:"+e.layer,time:o}),p=ke.ObjectUtils.removeUndefined({params:c,legendInfo:i,timeFilter:n,attributions:a});return ke.ObjectUtils.mergeDeep(p,e)},En.prototype.findDataSourceInCapabilities=function(e,t){var r,o=this;return Array.isArray(e)?(e.find(function(e){return(r=o.findDataSourceInCapabilities(e,t))!==undefined},this),r):e.Layer?this.findDataSourceInCapabilities(e.Layer,t):e.Name&&e.Name===t?e:undefined},En.prototype.getTimeFilter=function(e){var t;if(e.Dimension){var r={};if((t=e.Dimension[0]).values){var o=t.values.split("/");r.min=o[0]!==undefined?o[0]:undefined,r.max=o[1]!==undefined?o[1]:undefined,r.step=o[2]!==undefined?o[2]:undefined}return t["default"]&&(r.value=t["default"]),r}},En.prototype.getStyle=function(e){return{stylesAvailable:e.map(function(e){return{name:e.Name,title:e.Title}}).filter(function(t,e,r){return r.findIndex(function(e){return e.name===t.name})===e})}},En.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],En.ctorParameters=function(){return[{type:Pe.HttpClient}]},En.ngInjectableDef=Le.defineInjectable({factory:function(){return new En(Le.inject(Pe.HttpClient))},token:En,providedIn:"root"}),Ve([v.Cacheable({maxCacheCount:20}),Ue("design:type",Function),Ue("design:paramtypes",[String,String,String]),Ue("design:returntype",Ce.Observable)],En.prototype,"getCapabilities",null),En);function En(e){this.http=e,this.capabilitiesStore=[],this.parsers={wms:new Me.WMSCapabilities,wmts:new Me.WMTSCapabilities}}var Rn=($n.prototype.createAsyncDataSource=function(e){if(!e.type)throw console.error(e),new Error("Datasource needs a type");var t;switch(e.type.toLowerCase()){case"osm":t=this.createOSMDataSource(e);break;case"vector":t=this.createFeatureDataSource(e);break;case"wfs":t=this.createWFSDataSource(e);break;case"wms":var r=e;ke.ObjectUtils.removeDuplicateCaseInsensitive(r.params),t=this.createWMSDataSource(r);break;case"wmts":t=this.createWMTSDataSource(e);break;case"xyz":t=this.createXYZDataSource(e);break;case"carto":t=this.createCartoDataSource(e);break;case"arcgisrest":t=this.createArcGISRestDataSource(e);break;case"websocket":t=this.createWebSocketDataSource(e);break;case"mvt":t=this.createMVTDataSource(e);break;case"tilearcgisrest":t=this.createTileArcGISRestDataSource(e);break;case"cluster":t=this.createClusterDataSource(e);break;default:throw console.error(e),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([t])),t},$n.prototype.createOSMDataSource=function(t){return new Ce.Observable(function(e){return e.next(new st(t))})},$n.prototype.createFeatureDataSource=function(t){return new Ce.Observable(function(e){return e.next(new nt(t))})},$n.prototype.createWebSocketDataSource=function(t){return new Ce.Observable(function(e){return e.next(new Ht(t))})},$n.prototype.createWFSDataSource=function(t){var r=this;return new Ce.Observable(function(e){return e.next(new Ot(t,r.wfsDataSourceService))})},$n.prototype.createWMSDataSource=function(t){var r=this;return t.optionsFromCapabilities?this.capabilitiesService.getWMSOptions(t).pipe(De.map(function(e){return e?new kt(e,r.wfsDataSourceService):undefined})):new Ce.Observable(function(e){return e.next(new kt(t,r.wfsDataSourceService))})},$n.prototype.createWMTSDataSource=function(t){return t.optionsFromCapabilities?this.capabilitiesService.getWMTSOptions(t).pipe(De.map(function(e){return e?new $t(e):undefined})):new Ce.Observable(function(e){return e.next(new $t(t))})},$n.prototype.createXYZDataSource=function(t){return new Ce.Observable(function(e){return e.next(new ct(t))})},$n.prototype.createCartoDataSource=function(t){return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe(De.map(function(e){return new Bt(e)})):new Ce.Observable(function(e){return e.next(new Bt(t))})},$n.prototype.createArcGISRestDataSource=function(e){return this.capabilitiesService.getArcgisOptions(e).pipe(De.map(function(e){return new Nt(e)}))},$n.prototype.createTileArcGISRestDataSource=function(e){return this.capabilitiesService.getTileArcgisOptions(e).pipe(De.map(function(e){return new Wt(e)}))},$n.prototype.createMVTDataSource=function(t){return new Ce.Observable(function(e){return e.next(new Qt(t))})},$n.prototype.createClusterDataSource=function(t){return new Ce.Observable(function(e){return e.next(new er(t))})},$n.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],$n.ctorParameters=function(){return[{type:jn},{type:Ct}]},$n.ngInjectableDef=Le.defineInjectable({factory:function(){return new $n(Le.inject(jn),Le.inject(Ct))},token:$n,providedIn:"root"}),$n);function $n(e,t){this.capabilitiesService=e,this.wfsDataSourceService=t,this.datasources$=new Ce.BehaviorSubject([])}var An=(Gn.prototype.createLayer=function(e){if(e.source){var t;switch(e.source.options&&e.source.options.optionsFromCapabilities&&(e=ke.ObjectUtils.mergeDeep(e.source.options._layerOptionsFromCapabilities||{},e||{})),e.source.constructor){case st:case $t:case ct:case Bt:case Wt:t=this.createTileLayer(e);break;case nt:case Ot:case Nt:case Ht:case er:t=this.createVectorLayer(e);break;case kt:t=this.createImageLayer(e);break;case Qt:t=this.createVectorTileLayer(e)}return t}},Gn.prototype.createAsyncLayer=function(t){var r=this;return t.source?new Ce.Observable(function(e){return e.next(r.createLayer(t))}):this.dataSourceService.createAsyncDataSource(t.sourceOptions).pipe(De.map(function(e){return e===undefined?undefined:r.createLayer(Object.assign(t,{source:e}))}))},Gn.prototype.createImageLayer=function(e){return new br(e,this.authInterceptor)},Gn.prototype.createTileLayer=function(e){return new Ir(e)},Gn.prototype.createVectorLayer=function(t){var e,r;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.source instanceof Nt)e=t.source.options.params.style;else if(t.styleByAttribute){var o=this.styleService;t.style=function(e){return o.createStyleByAttribute(e,t.styleByAttribute)},r=new Tr(t)}if(t.source instanceof er){var n=this.styleService,i=t.style;t.style=function(e){return n.createClusterStyle(e,t.clusterParam,i)},r=new Tr(t)}var a=Object.assign({},t,{style:e});return r=r||new Tr(a),this.applyMapboxStyle(r,a),r},Gn.prototype.createVectorTileLayer=function(t){var e,r;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.styleByAttribute){var o=this.styleService;t.style=function(e){return o.createStyleByAttribute(e,t.styleByAttribute)},r=new Mr(t)}var n=Object.assign({},t,{style:e});return r=r||new Mr(n),this.applyMapboxStyle(r,n),r},Gn.prototype.applyMapboxStyle=function(t,r){r.mapboxStyle&&this.getMapboxGlStyle(r.mapboxStyle.url).subscribe(function(e){o(t.ol,e,r.mapboxStyle.source)})},Gn.prototype.getMapboxGlStyle=function(e){return this.http.get(e).pipe(De.map(function(e){return e}),De.catchError(function(e){return console.log("No style was found"),Ce.of(e)}))},Gn.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Gn.ctorParameters=function(){return[{type:Pe.HttpClient},{type:_r},{type:Rn},{type:me.AuthInterceptor,decorators:[{type:Le.Optional}]}]},Gn.ngInjectableDef=Le.defineInjectable({factory:function(){return new Gn(Le.inject(Pe.HttpClient),Le.inject(_r),Le.inject(Rn),Le.inject(me.AuthInterceptor,8))},token:Gn,providedIn:"root"}),Gn);function Gn(e,t,r,o){this.http=e,this.styleService=t,this.dataSourceService=r,this.authInterceptor=o}var Bn={Layer:"layer",Group:"group"},_n={wms:0,wmts:1,baselayers:2,composite:3};_n[_n.wms]="wms",_n[_n.wmts]="wmts",_n[_n.baselayers]="baselayers",_n[_n.composite]="composite";var qn,Nn=function fd(e,t){Object.assign(this,e),this.catalogService=t},Vn=(qe(Un,qn=Nn),Un.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogWMSLayerItems(this)},Un);function Un(e,t){var r=qn.call(this,e,t)||this,o=_n[_n.wms];return r.type=_n[o],r}var Wn,zn=(qe(Kn,Wn=Nn),Kn.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogWMTSLayerItems(this)},Kn);function Kn(e,t){var r=Wn.call(this,e,t)||this,o=_n[_n.wmts];return r.type=_n[o],r}var Hn,Yn=(qe(Zn,Hn=Nn),Zn.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogBaseLayerItems(this)},Zn);function Zn(e,t){var r=Hn.call(this,e,t)||this,o=_n[_n.baselayers];return r.type=_n[o],r}var Qn,Jn=(qe(Xn,Qn=Nn),Xn.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogCompositeLayerItems(this)},Xn);function Xn(e,t){var r=Qn.call(this,e,t)||this,o=_n[_n.composite];return r.type=_n[o],r.url=null,r}var ei=(ti.createInstanceCatalog=function(e,t){return e.hasOwnProperty("composite")?new Jn(e,t):e.type===_n[_n.baselayers]?new Yn(e,t):e.type===_n[_n.wmts]?new zn(e,t):new Vn(e,t)},ti);function ti(){}var ri=(oi.prototype.query=function(e,t){var r=this;return e.filter(function(e){return e.visible&&e.isInResolutionsRange}).map(function(e){return r.queryLayer(e,t)})},oi.prototype.queryLayer=function(r,o){var n=this,i=this.getQueryUrl(r.dataSource,o);if(!i)return Ce.of([]);if(r.dataSource.options.queryFormat!==Pt.HTMLGML2)return this.http.get(i,{responseType:"text"}).pipe(De.map(function(e){return n.extractData(e,r,o,i)}));var e=this.getQueryUrl(r.dataSource,o,!0);return this.http.get(e,{responseType:"text"}).pipe(De.mergeMap(function(e){var t=n.mergeGML(e,i);return n.http.get(i,{responseType:"text"}).pipe(De.map(function(e){return n.extractData(e,r,o,i,t)}))}))},oi.prototype.mergeGML=function(e,t){var r=new A,o=r.readFeatures(e);0===o.length&&(o=(r=new Me.WMSGetFeatureInfo).readFeatures(e));var n,i,a,s=new we.MultiLineString([]),l=[],u=new we.MultiPolygon([]),c=o.length,p=this.getQueryParams(t.toLowerCase()).bbox.split(","),d=z.createEmpty();switch(z.extend(d,p),o.map(function(e){var t=e.getGeometry().getCoordinates(),r=e.getGeometry().getType();switch(i=i||r,r){case"Point":1===c?n=new we.Point(t,"XY"):l.push(t);break;case"LineString":s.appendLineString(new we.LineString(t,"XY"));break;case"Polygon":u.appendPolygon(new we.Polygon(t,"XY"));break;case"MultiPolygon":u=new we.MultiPolygon(t,"XY");break;default:return}}),a=0===l.length&&n?{type:n.getType(),coordinates:n.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(l)]},i){case"LineString":return{type:s.getType(),coordinates:s.getCoordinates()};case"Point":return a;case"Polygon":case"MultiPolygon":return{type:u.getType(),coordinates:u.getCoordinates()};default:return}},oi.prototype.cross=function(e,t,r){return(e[0]-r[0])*(t[1]-r[1])-(e[1]-r[1])*(t[0]-r[0])},oi.prototype.convexHull=function(e){var t,r;e.sort(function(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]});var o=[];try{for(var n=We(e),i=n.next();!i.done;i=n.next()){for(var a=i.value;2<=o.length&&this.cross(o[o.length-2],o[o.length-1],a)<=0;)o.pop();o.push(a)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}for(var s=[],l=e.length-1;0<=l;l--){for(;2<=s.length&&this.cross(s[s.length-2],s[s.length-1],e[l])<=0;)s.pop();s.push(e[l])}return s.pop(),o.pop(),o.concat(s)},oi.prototype.extractData=function(e,s,l,t,r){var u=this,c=s.dataSource,o=this.getAllowedFieldsAndAlias(s),p=[];switch(c.options.queryFormat){case Pt.GML3:p=this.extractGML3Data(e,s.zIndex,o);break;case Pt.JSON:case Pt.GEOJSON:p=this.extractGeoJSONData(e);break;case Pt.ESRIJSON:p=this.extractEsriJSONData(e,s.zIndex);break;case Pt.TEXT:p=this.extractTextData(e);break;case Pt.HTML:p=this.extractHtmlData(e,c.queryHtmlTarget,t);break;case Pt.HTMLGML2:p=this.extractHtmlData(e,c.queryHtmlTarget,t,r);break;case Pt.GML2:default:p=this.extractGML2Data(e,s,o)}return p.map(function(e,t){var r,o=e.properties[c.mapLabel];if("wms"===s.options.sourceOptions.type){var n=s.options.sourceOptions;r=n?n.excludeAttribute:undefined}var i=u.getQueryTitle(e,s);i=!i&&1<p.length?s.title+" ("+(t+1)+")":i||s.title;var a=Object.assign({},e.meta||{},{id:ke.uuid(),title:i,mapTitle:o,sourceTitle:s.title,order:1e3-s.zIndex,excludeAttribute:r});return Object.assign(e,{meta:a,projection:"carto"===c.options.type?"EPSG:4326":l.projection})})},oi.prototype.extractGML2Data=function(e,t,r){var o=this,n=new A,i=n.readFeatures(e);if(0===i.length){n=new Me.WMSGetFeatureInfo;try{i=n.readFeatures(e)}catch(a){console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return i.map(function(e){return o.featureToResult(e,t,r)})},oi.prototype.extractGML3Data=function(e,t,r){var o=this;return(new G).readFeatures(e).map(function(e){return o.featureToResult(e,t,r)})},oi.prototype.extractGeoJSONData=function(e){var t=[];try{t=JSON.parse(e).features}catch(r){console.warn("query.service: Unable to parse geojson","\n",e)}return t},oi.prototype.extractEsriJSONData=function(e,t){var r=this;return(new B).readFeatures(e).map(function(e){return r.featureToResult(e,t)})},oi.prototype.extractTextData=function(e){return[]},oi.prototype.extractHtmlData=function(e,t,r,o){var n=this.getQueryParams(r.toLowerCase()),i=n.bbox,a=parseInt(n.width,10),s=parseInt(n.height,10),l=parseInt(n.i||n.x,10),u=parseInt(n.j||n.y,10),c=n.crs||n.srs||"EPSG:3857",p=i.split(","),d=.05*(Math.abs(parseFloat(p[0]))-Math.abs(parseFloat(p[2])));Math.abs(parseFloat(p[0]))<180&&(d=.045);var h=parseFloat(p[0])+Math.abs(parseFloat(p[0])-parseFloat(p[2]))*l/a-d,g=parseFloat(p[1])+Math.abs(parseFloat(p[1])-parseFloat(p[3]))*u/s-d,f=h+2*d,m=g+2*d,y="POLYGON(("+h+" "+g+", "+h+" "+m+", "+f+" "+m+", "+f+" "+g+", "+h+" "+g+"))",v=(new Me.WKT).readFeature(y).getGeometry();t!==Dt.BLANK&&t!==Dt.IFRAME&&(t=Dt.IFRAME);var b=e.toLowerCase().indexOf("<body>"),S=e.toLowerCase().lastIndexOf("</body>")+7;return"<body></body>"===e.slice(b,S).replace(/(\r|\n|\s)/g,"")||""===e?[]:[{type:rr,projection:c,properties:{target:t,body:e,url:r},geometry:o||{type:v.getType(),coordinates:v.getCoordinates()}}]},oi.prototype.getQueryParams=function(e){var t=e.split("?");if(t[1]){var r=t[1].split("&"),o={};return r.forEach(function(e){e=e.split("="),o[e[0]]=decodeURIComponent(e[1]||"")}),o}},oi.prototype.featureToResult=function(e,t,r){var o,n=e.getGeometry(),i=Object.assign({},e.getProperties());return delete i.geometry,delete i.boundedBy,delete i.shape,delete i.SHAPE,delete i.the_geom,n!==undefined&&(o={type:n.getType(),coordinates:n.getCoordinates()}),{type:rr,projection:undefined,properties:i,geometry:o,meta:{id:ke.uuid(),order:1e3-t,alias:r}}},oi.prototype.getQueryUrl=function(e,t,r){var o;switch(void 0===r&&(r=!1),e.constructor){case kt:var n=e,i={INFO_FORMAT:n.params.INFO_FORMAT||this.getMimeInfoFormat(e.options.queryFormat),QUERY_LAYERS:n.params.LAYERS,FEATURE_COUNT:n.params.FEATURE_COUNT||"5"};r&&(i.INFO_FORMAT=this.getMimeInfoFormat(Pt.GML2)),o=n.ol.getGetFeatureInfoUrl(t.coordinates,t.resolution,t.projection,i);break;case Bt:var a=e,s="https://"+a.options.account+".carto.com/api/v2/sql?",l="&q="+a.options.config.layers[0].options.sql,u=a.options.queryPrecision?a.options.queryPrecision:"1000";o=s+"format=GeoJSON"+l+" WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT("+t.coordinates[0]+","+t.coordinates[1]+"),3857),"+u+"))";break;case Wt:var c=e,p=z.boundingExtent([t.coordinates]);c.options.queryPrecision&&(p=z.buffer(p,c.options.queryPrecision)),o=c.options.url+"/"+c.options.layer+"/query/?"+["f=json","geometry="+encodeURIComponent('{"xmin":'+p[0]+',"ymin":'+p[1]+',"xmax":'+p[2]+',"ymax":'+p[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}return o},oi.prototype.getMimeInfoFormat=function(e){var t;switch(e){case Pt.GML2:t="application/vnd.ogc.gml";break;case Pt.GML3:t="application/vnd.ogc.gml/3.1.1";break;case Pt.JSON:t="application/json";break;case Pt.GEOJSON:t="application/geojson";break;case Pt.TEXT:t="text/plain";break;case Pt.HTML:case Pt.HTMLGML2:t="text/html";break;default:t="application/vnd.ogc.gml"}return t},oi.prototype.getAllowedFieldsAndAlias=function(e){var r;return e.options&&e.options.source&&e.options.source.options&&e.options.source.options.sourceFields&&1<=e.options.source.options.sourceFields.length&&(r={},e.options.source.options.sourceFields.forEach(function(e){var t=e.alias?e.alias:e.name;r[e.name]=t})),r},oi.prototype.getQueryTitle=function(e,t){var r;if(t.options&&t.options.source&&t.options.source.options){var o=t.options.source.options;o.queryTitle&&(r=this.getLabelMatch(e,o.queryTitle))}return r},oi.prototype.getLabelMatch=function(t,e){var r=e,o=Array.from(e.matchAll(/\$\{([^\{\}]+)\}/g));return o.forEach(function(e){r=r.replace(e[0],t.properties[e[1]])}),0===o.length&&r===e&&(r=t.properties[e]||e),r},oi.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],oi.ctorParameters=function(){return[{type:Pe.HttpClient}]},oi.ngInjectableDef=Le.defineInjectable({factory:function(){return new oi(Le.inject(Pe.HttpClient))},token:oi,providedIn:"root"}),oi);function oi(e){this.http=e,this.queryEnabled=!0}var ni=(Object.defineProperty(ii.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),ii.prototype.ngAfterViewInit=function(){this.listenToMapClick()},ii.prototype.ngOnDestroy=function(){this.cancelOngoingQueries(),this.unlistenToMapClick()},ii.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onMapEvent(e)})},ii.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},ii.prototype.onMapEvent=function(r){var o=this;if(this.cancelOngoingQueries(),this.queryService.queryEnabled){var e=[];this.queryFeatures&&e.push(this.doQueryFeatures(r));var t=this.map.ol.getView().getResolution(),n=this.map.layers.filter(Nr);e.push.apply(e,Ke(this.queryService.query(n,{coordinates:r.coordinate,projection:this.map.projection,resolution:t}))),0!==e.length&&(this.waitForAllQueries?this.queries$$.push(Ce.zip.apply(void 0,Ke(e)).subscribe(function(e){var t=[].concat.apply([],Ke(e));o.query.emit({features:t,event:r})})):this.queries$$=e.map(function(e){return e.subscribe(function(e){o.query.emit({features:e,event:r})})}))}},ii.prototype.doQueryFeatures=function(e){var u=this,c=[];this.map.ol.forEachFeatureAtPixel(e.pixel,function(e,t){var r,o;if(e)if(e.get("features"))try{for(var n=We(e.get("features")),i=n.next();!i.done;i=n.next()){var a=Fo(s=i.value,u.map.projection);a.meta={title:s.values_.nom,id:s.id_,icon:s.values_._icon,sourceTitle:t.values_.title},c.push(a)}}catch(l){r={error:l}}finally{try{i&&!i.done&&(o=n["return"])&&o.call(n)}finally{if(r)throw r.error}}else if(e instanceof _){var s=Io(e,u.map.projection,t);c.push(s)}else s=Fo(e,u.map.projection,t),c.push(s)},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:Vr});var r=this.map.layers.filter(Nr);return c.forEach(function(t){r.forEach(function(e){"undefined"!=typeof e.ol.getSource().hasFeature&&e.ol.getSource().hasFeature(t.ol)&&(t.meta.id=t.ol._id,t.meta.alias=u.queryService.getAllowedFieldsAndAlias(e),t.meta.title=t.meta.title||u.queryService.getQueryTitle(t,e),t.meta.sourceTitle=e.title)})}),Ce.of(c)},ii.prototype.cancelOngoingQueries=function(){this.queries$$.forEach(function(e){return e.unsubscribe()}),this.queries$$=[]},ii.decorators=[{type:Le.Directive,args:[{selector:"[igoQuery]"}]}],ii.ctorParameters=function(){return[{type:Pr,decorators:[{type:Le.Self}]},{type:ri}]},ii.propDecorators={queryFeatures:[{type:Le.Input}],queryFeaturesHitTolerance:[{type:Le.Input}],queryFeaturesCondition:[{type:Le.Input}],waitForAllQueries:[{type:Le.Input}],query:[{type:Le.Output}]},ii);function ii(e,t){this.component=e,this.queryService=t,this.queries$$=[],this.queryFeatures=!1,this.queryFeaturesHitTolerance=0,this.waitForAllQueries=!0,this.query=new Le.EventEmitter}var ai=(si.prototype.getId=function(){throw new Error('You have to implement the method "getId".')},si.prototype.getType=function(){throw new Error('You have to implement the method "getType".')},si.prototype.getDefaultOptions=function(){throw new Error('You have to implement the method "getDefaultOptions".')},Object.defineProperty(si.prototype,"title",{get:function(){return this.options.title},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"available",{get:function(){return!1!==this.options.available},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"enabled",{get:function(){return this.available&&!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"showInPointerSummary",{get:function(){var e=this.options.showInPointerSummary;return e||!1},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"showInSettings",{get:function(){var e=this.options.showInSettings;return e===undefined||e},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"searchUrl",{get:function(){return this.options.searchUrl},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"params",{get:function(){return this.options.params===undefined?{}:this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(si.prototype,"settings",{get:function(){return this.options.settings===undefined?[]:this.options.settings},enumerable:!0,configurable:!0}),si.prototype.setParamFromSetting=function(r){var e,o=this;switch(r.type){case"radiobutton":r.values.forEach(function(e){var t;e.enabled&&(o.options.params=Object.assign(o.options.params||{},((t={})[r.name]=e.value,t)))});break;case"checkbox":var t="";r.values.filter(function(e){return!1!==e.available}).forEach(function(e){e.enabled&&(t+=e.value+",")}),t=t.slice(0,-1),this.options.params=Object.assign(this.options.params||{},((e={})[r.name]=t,e))}},Object.defineProperty(si.prototype,"displayOrder",{get:function(){return this.options.order===undefined?99:this.options.order},enumerable:!0,configurable:!0}),si.prototype.getHashtagsValid=function(e,t){var r=e.match(/(#[^\s]+)/g);if(!r)return undefined;var o=this.getSettingsValues(t),i=[];return r.forEach(function(n){o.values.forEach(function(e){var t=n.substring(1);if("string"==typeof e.value){var r=e.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),o=r.indexOf(t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==o&&i.push(r[o])}e.hashtags&&-1!==e.hashtags.indexOf(t)&&i.push(e.value)})}),i.filter(function(e,t){return i.indexOf(e)===t})},si.prototype.getSettingsValues=function(t){return this.getDefaultOptions().settings.find(function(e){return e.name===t})},si.id="",si.type="",si);function si(e){var t=this;this.options=e,this.options=Object.assign({},this.getDefaultOptions(),e),this.settings.forEach(function(e){t.setParamFromSetting(e)})}var li,ui=(qe(ci,li=ai),ci.prototype.getId=function(){return ci.id},ci.prototype.getType=function(){return ci.type},ci.prototype.getDefaultOptions=function(){return{title:"Carte"}},ci.id="map",ci.type=rr,ci.decorators=[{type:Le.Injectable}],ci.ctorParameters=function(){return[{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]}]},ci);function ci(e){return li.call(this,e)||this}var pi=(di.getGoogleMapsLink=function(e,t){return"https://www.google.com/maps?q="+t+","+e},di.getGoogleStreetViewLink=function(e,t){return"https://www.google.com/maps?q=&layer=c&cbll="+t+","+e},di);function di(){}var hi=(gi.getOpenStreetMapLink=function(e,t,r){return void 0===r&&(r=17),"https://www.openstreetmap.org/?mlat="+t+"&mlon="+e+"#map="+r+"/"+t+"/"+e},gi.getOpenStreetCamLink=function(e,t,r){return void 0===r&&(r=17),"https://openstreetcam.org/map/@"+t+","+e+","+r+"z"},gi);function gi(){}var fi=(mi.prototype.loadCatalogs=function(){var e=this.config.getConfig("context")||{},t=this.config.getConfig("catalog")||{},r=t.url||e.url,o=t.sources||[],n=[];if(r){if(t.baseLayers){var i=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:r+"/baselayers",type:"baselayers"}];n.push(Ce.of(i))}var a=this.http.get(r+"/catalogs").pipe(De.map(function(e){return e.map(function(e){return Object.assign(e,e.options)})}),De.catchError(function(e){return Ce.EMPTY}));n.push(a)}return 0<o.length&&n.push(Ce.of(o).pipe(De.map(function(e){return e.map(function(e){return e.id||(e.id=ke.uuid()),e})}))),Ce.zip.apply(void 0,Ke(n)).pipe(De.map(function(e){return[].concat.apply([],e)}))},mi.prototype.loadCatalogItems=function(e){return ei.createInstanceCatalog(e,this).collectCatalogItems()},mi.prototype.loadCatalogBaseLayerItems=function(r){return this.getCatalogBaseLayersOptions(r).pipe(De.map(function(e){var t=e.map(function(e){return{id:Ye(e.sourceOptions),title:e.title,type:Bn.Layer,options:e}});return[{id:"catalog.group.baselayers",type:Bn.Group,title:r.title,items:t}]}))},mi.prototype.getCatalogBaseLayersOptions=function(e){return this.http.get(e.url)},mi.prototype.loadCatalogWMSLayerItems=function(r){var o=this;return this.getCatalogCapabilities(r).pipe(De.map(function(e){var t=[];return o.includeRecursiveItems(r,e.Capability.Layer,t),t}))},mi.prototype.loadCatalogWMTSLayerItems=function(t){var r=this;return this.getCatalogCapabilities(t).pipe(De.map(function(e){return r.getWMTSItems(t,e)}))},mi.prototype.loadCatalogCompositeLayerItems=function(e){var t=this,r=e.composite,a=[];r.map(function(e){return a.push(ei.createInstanceCatalog(e,t))});var o=[];a.map(function(e){return o.push(e.collectCatalogItems())});var n=[];if(Object.keys(r).find(function(e){return r[e].groupImpose})){var i=function(e,t){var r=a[t],o=Object.assign({},r.groupImpose);o.address=r.id,o.type=Bn.Group,o.items=[];var n=function i(e){return e.reduce(function(e,t){return e.concat(t.type===Bn.Group?i(t.items):t)},[])}(e);return n.map(function(e){return e.address=o.address+"."+o.id}),o.items=n,o};n=o.map(function(e,t){return e.pipe(De.map(function(e){return r[t].groupImpose?i(e,t):e}))})}else n=o;var s=Ce.zip.apply(void 0,Ke(n)).pipe(De.map(function(e){return[].concat.apply([],Ke(e))})),u=function(e,l){return e.reduce(function(e,o,n,t){var i=l(o),r=Object.assign({},o);if(o.type===Bn.Layer){var a=[];if(0<t.filter(function(e,t){var r=!1;return e.title===i&&e.type===Bn.Layer&&(t!==n&&e.address!==o.address&&(r=!0),a.push(t)),r}).length){var s=a.findIndex(function(e){return e===n})+1;r.title=o.title+" ("+s+")"}e.find(function(e){return e.title===r.title&&e.type===Bn.Layer})||(e[e.length]=r)}else o.type===Bn.Group&&(r.items=u(o.items,function(e){return e.title}),e[e.length]=r);return e},[])};return s.pipe(De.map(function(e){return function(e,a){return e.reduce(function(e,t){var r,o=a(t),n=e.find(function(e){return e.id===o});if(n){var i=e.indexOf(n);-1===e[i].address.split("|").indexOf(t.address)&&(e[i].address=e[i].address+"|"+t.address),(r=e[i].items).push.apply(r,Ke(t.items))}else e[e.length]=t;return e},[])}(e,function(e){return e.id})}),De.map(function(e){return[].concat.apply([],Ke(e))}),De.map(function(e){return u(e,function(e){return e.title})}))},mi.prototype.getCatalogCapabilities=function(e){var t=_n[e.type];return this.capabilitiesService.getCapabilities(kn[t],e.url,e.version)},mi.prototype.prepareCatalogItemLayer=function(e,t,r,o,n,i,a){var s=this.retriveLayerInfoFormat(e.Name,r),l=e.DataURL?e.DataURL[0]:undefined,u=e.Abstract?e.Abstract:undefined,c=e.KeywordList?e.KeywordList:undefined,p=this.capabilitiesService.getTimeFilter(e),d=!!(p&&0<Object.keys(p).length),h=e.Style?this.capabilitiesService.getStyle(e.Style):undefined,g=Object.assign({},n,{LAYERS:e.Name,FEATURE_COUNT:o.count,VERSION:o.version||"1.3.0"}),f={type:"wms",url:o.url,crossOrigin:o.setCrossOriginAnonymous?"anonymous":undefined,timeFilter:Ne({},p,o.timeFilter),timeFilterable:d,queryable:e.queryable,queryFormat:s,queryHtmlTarget:o.queryHtmlTarget||Dt.IFRAME},m=Object.assign({},f,i,{params:g});return{id:Ye(m),type:Bn.Layer,title:e.Title,address:t,options:{title:e.Title,maxResolution:zo(e.MaxScaleDenominator)||Infinity,minResolution:zo(e.MinScaleDenominator)||0,metadata:{url:l?l.OnlineResource:undefined,extern:!!l||undefined,"abstract":u,keywordList:c},legendOptions:h,tooltip:{type:a},sourceOptions:m}}},mi.prototype.prepareCatalogItemGroup=function(e,i,a,s,l,u,c,p){var d=this;return{id:a,type:Bn.Group,title:e.Title,address:l.id,items:e.Layer.reduce(function(e,t){if(t.Layer!==undefined){var r=a+".group."+(t.Name||t.Layer[0].Name),o=d.prepareCatalogItemGroup(t,i,r,s,l,u,c,p);e.push(o)}else{if(!1===d.testLayerRegexes(t.Name,i))return e;var n=d.prepareCatalogItemLayer(t,a,s,l,u,c,p);e.push(n)}return e},[])}},mi.prototype.includeRecursiveItems=function(e,t,r,o){var n,i;void 0===o&&(o=0);var a=(e.regFilters||[]).map(function(e){return new RegExp(e)}),s=e.queryParams||{},l=e.sourceOptions||{};if(t.Layer)try{for(var u=We(t.Layer),c=u.next();!c.done;c=u.next()){var p=c.value;if(p.Layer===undefined){var d=this.retrieveTooltipType(e),h=this.findCatalogInfoFormat(e);if(0!==o){var g="catalog.group."+(t.Name||p.Name),f=this.prepareCatalogItemGroup(t,a,g,h,e,s,l,d);0!==f.items.length&&r.push(f);break}var m=this.prepareCatalogItemLayer(p,e.id,h,e,s,l,d);r.push(m)}else this.includeRecursiveItems(e,p,r,o+1)}}catch(y){n={error:y}}finally{try{c&&!c.done&&(i=u["return"])&&i.call(u)}finally{if(n)throw n.error}}},mi.prototype.getWMTSItems=function(n,e){var i=this,t=e.Contents.Layer,a=(n.regFilters||[]).map(function(e){return new RegExp(e)}),s=n.queryParams||{},l=n.sourceOptions||{};return t.map(function(e){if(!1===i.testLayerRegexes(e.Identifier,a))return undefined;var t=Object.assign({},s,{version:"1.0.0"}),r={type:"wmts",url:n.url,crossOrigin:n.setCrossOriginAnonymous?"anonymous":undefined,layer:e.Identifier,matrixSet:n.matrixSet,optionsFromCapabilities:!0,requestEncoding:n.requestEncoding||"KVP",style:"default"},o=Object.assign({},r,l,{params:t});return{id:Ye(o),type:Bn.Layer,title:e.Title,address:n.id,options:{title:e.Title,sourceOptions:o,maxResolution:Infinity,minResolution:0}}}).filter(function(e){return e!==undefined})},mi.prototype.testLayerRegexes=function(t,e){return 0===e.length||e.find(function(e){return e.test(t)})!==undefined},mi.prototype.retriveLayerInfoFormat=function(t,e){var r,o=e.find(function(e){return e.layer===t}),n=e.find(function(e){return"*"===e.layer});return o?r=o.queryFormat:n&&(r=n.queryFormat),r},mi.prototype.retrieveTooltipType=function(e){return e.tooltipType?e.tooltipType:lr.TITLE},mi.prototype.findCatalogInfoFormat=function(t){var e=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(function(r){t.queryFormat[r]instanceof Array?t.queryFormat[r].forEach(function(t){e.find(function(e){return e.layer===t})||e.push({layer:t,queryFormat:r})}):e.find(function(e){return e.layer===t.queryFormat[r]})||e.push({layer:t.queryFormat[r],queryFormat:r})}),e},mi.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],mi.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.ConfigService},{type:je.LanguageService},{type:jn}]},mi.ngInjectableDef=Le.defineInjectable({factory:function(){return new mi(Le.inject(Pe.HttpClient),Le.inject(je.ConfigService),Le.inject(je.LanguageService),Le.inject(jn))},token:mi,providedIn:"root"}),mi);function mi(e,t,r,o){this.http=e,this.config=t,this.languageService=r,this.capabilitiesService=o}var yi=(Object.defineProperty(vi.prototype,"resolution$",{get:function(){return this.map.viewController.resolution$},enumerable:!0,configurable:!0}),vi.prototype.ngOnInit=function(){var e=this.map.layers.map(function(e){return{id:e.options.source.id,title:e.title,type:Bn.Layer}});this.store.state.updateMany(e,{added:!0},!0),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}}),this.catalogAllowLegend=this.catalog.showLegend?this.catalog.showLegend:this.catalogAllowLegend,this.watcher=new Te.EntityStoreWatcher(this.store,this.cdRef)},vi.prototype.ngOnDestroy=function(){this.watcher.destroy()},vi.prototype.isGroup=function(e){return e.type===Bn.Group},vi.prototype.isLayer=function(e){return e.type===Bn.Layer},vi.prototype.onLayerAddedChange=function(e){var t=e.layer;this.store.state.update(t,{added:e.added},!1),e.added?this.addLayerToMap(t):this.removeLayerFromMap(t)},vi.prototype.onGroupAddedChange=function(e){var t=e.group;this.store.state.update(t,{added:e.added},!1),e.added?this.addGroupToMap(t):this.removeGroupFromMap(t)},vi.prototype.addLayerToMap=function(e){this.addLayersToMap([e])},vi.prototype.removeLayerFromMap=function(e){this.removeLayersFromMap([e])},vi.prototype.addLayersToMap=function(t){var r=this,e=t.map(function(e){return r.layerService.createAsyncLayer(e.options)});Ce.zip.apply(void 0,Ke(e)).subscribe(function(e){r.store.state.updateMany(t,{added:!0}),r.map.addLayers(e)})},vi.prototype.removeLayersFromMap=function(e){var r=this;e.forEach(function(e){var t;r.store.state.update(e,{added:!1}),!0===e.options.baseLayer?(t=r.map.getLayerById(e.options.id))!==undefined&&r.map.removeLayer(t):(t=r.map.getLayerById(e.id))!==undefined&&r.map.removeLayer(t)})},vi.prototype.sortCatalogItemsByTitle=function(e,t){var r=e.sort(function(e,t){var r=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),o=t.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r<o?-1:o<r?1:0});switch(t){case"asc":return r;case"desc":return r.reverse();default:return e}},vi.prototype.addGroupToMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!1===t});this.catalog&&this.catalog.sortDirection!==undefined&&(t=this.sortCatalogItemsByTitle(t,this.catalog.sortDirection)),this.addLayersToMap(t.reverse())},vi.prototype.removeGroupFromMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!0===t});this.removeLayersFromMap(t)},vi.decorators=[{type:Le.Component,args:[{selector:"igo-catalog-browser",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)">\r\n      <igo-catalog-browser-group\r\n        [catalog]="catalog"\r\n        [group]="item"\r\n        [state]="store.state"\r\n        [resolution]="resolution$ | async"\r\n        [catalogAllowLegend]="catalogAllowLegend"\r\n        [toggleCollapsed]="toggleCollapsedGroup"\r\n        (addedChange)="onGroupAddedChange($event)"\r\n        (layerAddedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-group>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [resolution]="resolution$ | async"\r\n        [catalogAllowLegend]="catalogAllowLegend"\r\n        [added]="store.state.get(item).added"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush}]}],vi.ctorParameters=function(){return[{type:An},{type:Le.ChangeDetectorRef}]},vi.propDecorators={catalogAllowLegend:[{type:Le.Input}],catalog:[{type:Le.Input}],store:[{type:Le.Input}],map:[{type:Le.Input}],toggleCollapsedGroup:[{type:Le.Input}]},vi);function vi(e,t){this.layerService=e,this.cdRef=t,this.catalogAllowLegend=!1,this.toggleCollapsedGroup=!0}var bi=(Object.defineProperty(Si.prototype,"title",{get:function(){return Te.getEntityTitle(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(Si.prototype,"icon",{get:function(){return Te.getEntityIcon(this.layer)||"layers"},enumerable:!0,configurable:!0}),Si.prototype.ngOnInit=function(){var t=this;this.isInResolutionsRange(),this.isPreview$.subscribe(function(e){return t.addedLayerIsPreview.emit(e)})},Si.prototype.onMouseEvent=function(e){this.onToggleClick(e)},Si.prototype.askForLegend=function(e){var t=this;this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe(De.first()).subscribe(function(e){return t.igoLayer$.next(e)})},Si.prototype.onToggleClick=function(e){var t=this;switch("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),e.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add()),this.isPreview$.next(!1);break;case"mouseenter":this.isPreview$.value||this.added||(this.lastTimeoutRequest=setTimeout(function(){t.add(),t.isPreview$.next(!0)},500));break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1))}},Si.prototype.add=function(){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer}))},Si.prototype.remove=function(){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer}))},Si.prototype.haveGroup=function(){return!(!this.layer.address||1===this.layer.address.split(".").length)},Si.prototype.isInResolutionsRange=function(){var e=this.layer.options.minResolution,t=this.layer.options.maxResolution;return this.inRange$.next(this.resolution>=e&&this.resolution<=t),this.inRange$.value},Si.prototype.computeTooltip=function(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"},Si.decorators=[{type:Le.Component,args:[{selector:"igo-catalog-browser-layer",template:'<mat-list-item>\r\n  <mat-icon *ngIf="haveGroup()" mat-list-avatar svgIcon="blank"></mat-icon>\r\n  <h4 mat-line matTooltipShowDelay="500" [ngClass]="(catalogAllowLegend)?\'igo-cataloglayer-title\':\'\'" (click)="askForLegend($event)" [matTooltip]="title">{{title}}</h4>\r\n\r\n  <igo-metadata-button [layer]="layer"></igo-metadata-button>\r\n\r\n  <button\r\n    (mouseenter)="onMouseEvent($event)" (mouseleave)="onMouseEvent($event)"\r\n    mat-icon-button\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="computeTooltip() | translate"\r\n    [color]="(isPreview$ | async) ? \'\' : added ? \'warn\' : \'\'"\r\n    (click)="onToggleClick($event)">\r\n    <mat-icon\r\n       matBadge\r\n       igoMatBadgeIcon="eye-off"\r\n       [matBadgeHidden]="isInResolutionsRange()"\r\n       matBadgeColor="accent"\r\n       matBadgeSize="small"\r\n       matBadgePosition="after"\r\n       [svgIcon]="(isPreview$ | async) ? \'plus\' : added ? \'delete\' : \'plus\'">\r\n    </mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n\r\n<div #legend class="igo-cataloglayer-legend-container">\r\n  <igo-layer-legend\r\n    *ngIf="(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend"\r\n    [layer]="igoLayer$ | async">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".mat-badge-small .mat-badge-content{color:rgba(0,0,0,.38)}.igo-cataloglayer-title{cursor:pointer}.igo-cataloglayer-legend-container{padding-left:18px;width:calc(100% - 18px);margin-left:40px}"]}]}],Si.ctorParameters=function(){return[{type:An}]},Si.propDecorators={resolution:[{type:Le.Input}],catalogAllowLegend:[{type:Le.Input}],layer:[{type:Le.Input}],added:[{type:Le.Input}],addedChange:[{type:Le.Output}],addedLayerIsPreview:[{type:Le.Output}]},Si);function Si(e){this.layerService=e,this.inRange$=new Ce.BehaviorSubject(!0),this.isPreview$=new Ce.BehaviorSubject(!1),this.layerLegendShown$=new Ce.BehaviorSubject(!1),this.igoLayer$=new Ce.BehaviorSubject(undefined),this.catalogAllowLegend=!1,this.added=!1,this.addedChange=new Le.EventEmitter,this.addedLayerIsPreview=new Le.EventEmitter}var wi=(Object.defineProperty(Ii.prototype,"title",{get:function(){return this.group.title},enumerable:!0,configurable:!0}),Ii.prototype.ngOnInit=function(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}})},Ii.prototype.ngOnDestroy=function(){this.store.destroy()},Ii.prototype.isGroup=function(e){return e.type===Bn.Group},Ii.prototype.isLayer=function(e){return e.type===Bn.Layer},Ii.prototype.onToggleClick=function(){this.added$.value?this.remove():this.add()},Ii.prototype.onToggleCollapsed=function(e){this.evaluateDisabled(e)},Ii.prototype.onLayerAddedChange=function(e){this.layerAddedChange.emit(e),this.tryToggleGroup(e)},Ii.prototype.add=function(){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group})},Ii.prototype.remove=function(){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group})},Ii.prototype.onLayerPreview=function(e){this.preview$.next(e)},Ii.prototype.tryToggleGroup=function(e){var t=this,r=e.added,o=e.layer;this.store.view.all().filter(function(e){return e.id!==o.id}).map(function(e){return t.state.get(e).added||!1}).every(function(e){return e===r})?r?this.add():this.remove():!0===this.added$.value&&this.added$.next(!1)},Ii.prototype.evaluateAdded=function(){var t=this,e=this.store.all().every(function(e){return!0===(t.state.get(e).added||!1)});this.added$.next(e)},Ii.prototype.evaluateDisabled=function(e){var t=!1;!1===this.toggleCollapsed&&(t=e),this.disabled$.next(t)},Ii.prototype.onTitleClick=function(){this.collapsed=!this.collapsed},Ii.decorators=[{type:Le.Component,args:[{selector:"igo-catalog-browser-group",template:'<mat-list-item>\r\n  <mat-icon\r\n    mat-list-avatar\r\n    svgIcon="chevron-up"\r\n    igoCollapse\r\n    class="igo-chevron"\r\n    [target]="items"\r\n    [collapsed]="collapsed"\r\n    (toggle)="onToggleCollapsed($event)">\r\n  </mat-icon>\r\n\r\n  <h4 class="igo-catalog-group-title" id="catalog-group-title" mat-line matTooltipShowDelay="500" [matTooltip]="title" (click)="onTitleClick()">{{title}}</h4>\r\n  <ng-container *ngIf="(added$ | async) && !(preview$ | async); else notadded">\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.removeFromMap\' | translate"\r\n      color="warn"\r\n      [disabled]="disabled$ | async"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n  </ng-container>\r\n\r\n  <ng-template #notadded>\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.addToMap\' | translate"\r\n      [disabled]="disabled$ | async"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="plus"></mat-icon>\r\n    </button>\r\n  </ng-template>\r\n</mat-list-item>\r\n\r\n<div #items>\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)">\r\n      \x3c!-- todo: add display ans manage CatalogItemGroup --\x3e\r\n    </ng-container>\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [resolution]="resolution"\r\n        [catalogAllowLegend]="catalogAllowLegend"\r\n        [added]="state.get(item).added"\r\n        (addedLayerIsPreview)="onLayerPreview($event)"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".igo-catalog-group-title{cursor:pointer;opacity:.8}#catalog-group-title{font-weight:700}"]}]}],Ii.propDecorators={catalog:[{type:Le.Input}],group:[{type:Le.Input}],collapsed:[{type:Le.Input}],resolution:[{type:Le.Input}],catalogAllowLegend:[{type:Le.Input}],toggleCollapsed:[{type:Le.Input}],state:[{type:Le.Input}],addedChange:[{type:Le.Output}],layerAddedChange:[{type:Le.Output}]},Ii);function Ii(){this.store=new Te.EntityStore([]),this.added$=new Ce.BehaviorSubject(!1),this.preview$=new Ce.BehaviorSubject(!1),this.disabled$=new Ce.BehaviorSubject(!1),this.collapsed=!0,this.catalogAllowLegend=!1,this.toggleCollapsed=!0,this.addedChange=new Le.EventEmitter,this.layerAddedChange=new Le.EventEmitter}var Fi=(Oi.forRoot=function(){return{ngModule:Oi,providers:[An,_r,Yr]}},Oi.decorators=[{type:Le.NgModule,args:[{imports:[Fe.MatInputModule,Fe.MatFormFieldModule,Oe.CommonModule,ye.FormsModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatSelectModule,Fe.MatTooltipModule,Fe.MatListModule,Fe.MatSliderModule,Fe.MatBadgeModule,je.IgoLanguageModule,Te.IgoListModule,Te.IgoCollapsibleModule,Te.IgoImageModule],exports:[Ur,zr,Qr,to,oo],declarations:[Ur,zr,Qr,to,oo]}]}],Oi);function Oi(){}var Ti=(xi.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatBadgeModule,Fe.MatButtonModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatTooltipModule,Te.IgoMatBadgeIconModule,je.IgoLanguageModule,Te.IgoListModule,Te.IgoCollapsibleModule,Ge,Fi],exports:[yi],declarations:[yi,wi,bi]}]}],xi);function xi(){}var Ci=(Mi.prototype.ngOnInit=function(){this.store.state.clear()},Mi.prototype.onCatalogSelect=function(e){this.store.state.update(e,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:e})},Mi.decorators=[{type:Le.Component,args:[{selector:"igo-catalog-library",template:'<igo-list [navigation]="false">\r\n  <ng-template ngFor let-catalog [ngForOf]="store.view.all$() | async">\r\n    <igo-catalog-library-item\r\n      igoListItem\r\n      color="accent"\r\n      [map]="map"\r\n      [catalog]="catalog"\r\n      (select)="onCatalogSelect(catalog)">\r\n    </igo-catalog-library-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush}]}],Mi.propDecorators={store:[{type:Le.Input}],map:[{type:Le.Input}],catalogSelectChange:[{type:Le.Output}]},Mi);function Mi(){this.catalogSelectChange=new Le.EventEmitter}var Li=(Object.defineProperty(Pi.prototype,"title",{get:function(){return Te.getEntityTitle(this.catalog)},enumerable:!0,configurable:!0}),Pi.decorators=[{type:Le.Component,args:[{selector:"igo-catalog-library-item",template:"<mat-list-item>\r\n  <h4 mat-line>{{title}}</h4>\r\n</mat-list-item>\r\n",changeDetection:Le.ChangeDetectionStrategy.OnPush}]}],Pi.propDecorators={catalog:[{type:Le.Input}],map:[{type:Le.Input}]},Pi);function Pi(){}var Di=(ki.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatTooltipModule,Te.IgoListModule],exports:[Ci],declarations:[Ci,Li]}]}],ki);function ki(){}var ji=(Ei.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatBadgeModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatTooltipModule,Te.IgoMatBadgeIconModule,Te.IgoListModule,Te.IgoCollapsibleModule],exports:[Ti,Di],declarations:[]}]}],Ei);function Ei(){}var Ri=($i.forRoot=function(){return{ngModule:$i,providers:[]}},$i.decorators=[{type:Le.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],$i);function $i(){}var Ai=(Gi.prototype.transform=function(e,t){var r,o=this;return"time"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isTimeFilterable(t)&&t.options.timeFilter!==undefined&&Object.keys(t.options.timeFilter).length})),"ogc"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isOgcFilterable(t)})),r},Gi.prototype.isTimeFilterable=function(e){return"wms"===e.options.type&&e.options.timeFilterable},Gi.prototype.isOgcFilterable=function(e){var t=!1;return e.options.ogcFilters&&e.options.ogcFilters.enabled&&e.options.ogcFilters.editable&&(t=!0),e.options.ogcFilters&&e.options.ogcFilters.enabled&&e.options.ogcFilters.pushButtons&&(t=!0),t},Gi.decorators=[{type:Le.Pipe,args:[{name:"filterableDataSource"}]}],Gi);function Gi(){}var Bi=(_i.prototype.filterByDate=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=this.reformatDateTime(t[0]),i.push(t[0])),t[1]&&(n=this.reformatDateTime(t[1]),i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof Wt?o+","+n:o+"/"+n),o===n&&(r=o)}else t&&(r=this.reformatDateTime(t));var a={TIME:r};e.ol.updateParams(a)},_i.prototype.filterByYear=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=t[0],i.push(t[0])),t[1]&&(n=t[1],i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof Wt?o+","+n:o+"/"+n),o===n&&(r=o)}else r=t;var a={TIME:r};e.ol.updateParams(a)},_i.prototype.reformatDateTime=function(e){var t=e.getFullYear(),r=e.getMonth()+1,o=e.getUTCDate(),n=e.getUTCHours(),i=e.getUTCMinutes();return Number(r)<10&&(r="0"+r),Number(o)<10&&(o="0"+o),Number(n)<10&&(n="0"+n),Number(i)<10&&(i="0"+i),t+"-"+r+"-"+o+"T"+n+":"+i+":00Z"},_i.decorators=[{type:Le.Injectable}],_i.ctorParameters=function(){return[]},_i);function _i(){}var qi={BasicNumericOperator:"BasicNumericOperator",Basic:"Basic",BasicAndSpatial:"BasicAndSpatial",Spatial:"Spatial",All:"All"},Ni=(Vi.prototype.filterByOgc=function(e,t){var r=(new dt).formatProcessedOgcFilter(t,e.options.params.LAYERS);e.ol.updateParams({FILTER:r})},Vi.prototype.setOgcWFSFiltersOptions=function(e){var t=e.options,r=new dt;t.ogcFilters.enabled&&t.ogcFilters.filters&&(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry,new q({code:t.paramsWFS.srsName}),!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry)))},Vi.prototype.setOgcWMSFiltersOptions=function(e){var t=e.options,r=new dt;t.ogcFilters.enabled&&t.ogcFilters.filters?(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.fieldNameGeometry,undefined,!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.fieldNameGeometry)),this.filterByOgc(e,r.buildFilter(t.ogcFilters.filters)),t.filtered=!0):(t.ogcFilters.filters=undefined,t.ogcFilters.interfaceOgcFilters=[],t.filtered=!1)},Vi.decorators=[{type:Le.Injectable}],Vi.ctorParameters=function(){return[]},Vi);function Vi(){}var Ui={Predefined:"Predefined",Polygon:"Polygon",Point:"Point"},Wi={Address:"Address",Thematics:"Thematics"},zi=(Ki.prototype.getKeyByValue=function(t,r){return Object.keys(t).find(function(e){return t[e]===r})},Ki.prototype.loadFilterList=function(e){var t=e;if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe(De.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code},e})}))},Ki.prototype.loadThematicsList=function(){var s=this,l=[];return this.http.get(this.baseUrl+"types").pipe(De.map(function(e){return e.forEach(function(e){if(e.startsWith("lieux")){var t={name:undefined,source:e},r=e.substring(6,e.length),o=r;if(r.includes(".")){var n=r.indexOf(".");o=r.substring(n+1,r.length),r=r.substring(0,n)}try{t.name=s.languageService.translate.instant("igo.geo.terrapi."+o)}catch(a){t.name=o.substring(0,1).toUpperCase()+o.substring(1,o.length-1)}try{t.group=s.languageService.translate.instant("igo.geo.spatialFilter.group."+r)}catch(a){t.group=r.substring(0,1).toUpperCase()+r.substring(1,o.length-1)}l.push(t)}else if(s.getKeyByValue(s.urlFilterList,e)){t={name:undefined,source:e};var i=s.getKeyByValue(s.urlFilterList,e);try{t.name=s.languageService.translate.instant("igo.geo.terrapi."+i)}catch(a){t.name=i.substring(0,1).toUpperCase()+i.substring(1,i.length-1)}t.source=e,l.push(t)}}),l}))},Ki.prototype.loadFilterItem=function(e,t,r,o,n){var i=this;if(r){var a=r,s=this.baseUrl+this.urlFilterList[a],l="";return t===Wi.Address?(l="adresses",this.http.get(s+"/"+e.properties.code+"/"+l,{params:{geometry:"true",icon:"true"}}).pipe(De.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:i.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:e.icon},e})}))):(l=o.source,this.http.get(s+"/"+e.properties.code+"/"+l,{params:{geometry:"true",icon:"true"}}).pipe(De.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:o.name,icon:e.icon},e})})))}return s=this.baseUrl+"locate",t===Wi.Address?(l="?type=adresses",this.http.post(s+l,{geometry:"true",icon:"true",buffer:n,loc:JSON.stringify(e)}).pipe(De.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:i.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:e.icon},e})}))):(l="?type="+o.source,this.http.post(s+l,{geometry:"true",icon:"true",buffer:n,loc:JSON.stringify(e)}).pipe(De.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:o.name,icon:e.icon},e})})))},Ki.prototype.loadItemById=function(e,t){var r=this.urlFilterList[t],o="/"+e.properties.code;if(r&&o)return this.http.get(this.baseUrl+r+o,{params:{geometry:"true"}}).pipe(De.map(function(e){return e.meta={id:e.properties.code,alias:e.properties.nom,title:e.properties.nom},e}))},Ki.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Ki.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.LanguageService},{type:je.ConfigService}]},Ki.ngInjectableDef=Le.defineInjectable({factory:function(){return new Ki(Le.inject(Pe.HttpClient),Le.inject(je.LanguageService),Le.inject(je.ConfigService))},token:Ki,providedIn:"root"}),Ki);function Ki(e,t,r){this.http=e,this.languageService=t,this.configService=r,this.baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/",this.urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"},this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}var Hi=(Yi.prototype.open=function(e){var t=this.languageService.translate,r=t.instant("igo.geo.download.title");this.messageService.success(t.instant("igo.geo.download.start"),r);var o=e.dataSource.options;if(0<Object.keys(o.download).length)if(o.download.dynamicUrl&&o.download.url===undefined){var n=void 0,i=(n=e.dataSource.options.paramsWFS&&0<Object.keys(e.dataSource.options.paramsWFS).length?e.dataSource.options.paramsWFS:e.dataSource.options.params).outputFormatDownload===undefined?"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,a=o.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),s=e.dataSource.options.ogcFilters,l=void 0;l=(l=(new dt).handleOgcFiltersAppliedValue(e.dataSource.options,s.geometryName,e.map.viewController.getExtent(),new q({code:e.map.projection})))?"filter="+encodeURIComponent(l):(new dt).buildFilter(undefined,e.map.viewController.getExtent(),new q({code:e.map.projection}),s.geometryName),window.open(a+"&"+l+"&"+i,"_blank")}else o.download&&window.open(o.download.url,"_blank")},Yi.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Yi.ctorParameters=function(){return[{type:je.MessageService},{type:je.LanguageService}]},Yi.ngInjectableDef=Le.defineInjectable({factory:function(){return new Yi(Le.inject(je.MessageService),Le.inject(je.LanguageService))},token:Yi,providedIn:"root"}),Yi);function Yi(e,t){this.messageService=e,this.languageService=t}var Zi=(Object.defineProperty(Qi.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Qi.prototype.openDownload=function(e){this.downloadService.open(e)},Object.defineProperty(Qi.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),Qi.decorators=[{type:Le.Component,args:[{selector:"igo-download-button",template:'<button\r\n  *ngIf="options && options.download && (options.download[\'dynamicUrl\'] || options.download[\'url\']) "\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.download.action\' | translate"\r\n  [color]="color"\r\n  (click)="openDownload(layer)">\r\n  <mat-icon svgIcon="download"></mat-icon>\r\n</button>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Qi.ctorParameters=function(){return[{type:Hi}]},Qi.propDecorators={layer:[{type:Le.Input}],color:[{type:Le.Input}]},Qi);function Qi(e){this.downloadService=e,this._color="primary"}var Ji=(Xi.forRoot=function(){return{ngModule:Xi}},Xi.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTooltipModule,je.IgoLanguageModule],exports:[Zi],declarations:[Zi]}]}],Xi);function Xi(){}var ea=(Object.defineProperty(ta.prototype,"source",{get:function(){return this._source},set:function(e){this._source=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(ta.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(ta.prototype,"title",{get:function(){return Te.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),Object.defineProperty(ta.prototype,"icon",{get:function(){return Te.getEntityIcon(this.feature)||"link"},enumerable:!0,configurable:!0}),ta.prototype.htmlSanitizer=function(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)},ta.prototype.isObject=function(e){return"object"==typeof e},ta.prototype.isUrl=function(e){return"string"==typeof e&&("https://"===e.slice(0,8)||"http://"===e.slice(0,7))},ta.prototype.filterFeatureProperties=function(t){var r=t.meta?t.meta.alias:undefined,o={};return r?(Object.keys(r).forEach(function(e){o[r[e]]=t.properties[e]}),o):(this.state.connection&&t.meta&&t.meta.excludeAttribute?t.meta.excludeAttribute.forEach(function(e){delete t.properties[e]}):!this.state.connection&&t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(function(e){delete t.properties[e]}),t.properties)},ta.decorators=[{type:Le.Component,args:[{selector:"igo-feature-details",template:'<table class="igo-striped mat-typography" *ngIf="feature && isObject(feature.properties) && feature.properties.target !== \'iframe\'">\r\n  <tbody>\r\n    <tr *ngFor="let property of filterFeatureProperties(feature) | keyvalue">\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <a href="{{property.value}}" target=\'_blank\'> {{ \'igo.geo.targetHtmlUrl\' | translate }} {{title}}</a>\r\n      </td>\r\n\r\n      <td id="keyValue" *ngIf="feature.properties.target === undefined">\r\n        {{property.key }}\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)" [innerHTML]=property.value>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)">\r\n        <a href="{{property.value}}" target=\'_blank\'>{{ \'igo.geo.targetHtmlUrl\' | translate }} </a>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && isObject(property.value)" [innerHTML]="property.value | json">\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<iframe *ngIf="feature && isObject(feature.properties) && feature.properties.target === \'iframe\'" [src]=\'htmlSanitizer(feature.properties.url)\'></iframe>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:["table{width:100%}table td{padding:5px}#keyValue{width:30%}iframe{height:calc(100% - 4px);width:100%;border:0}"]}]}],ta.ctorParameters=function(){return[{type:Le.ChangeDetectorRef},{type:N.DomSanitizer},{type:je.NetworkService}]},ta.propDecorators={source:[{type:Le.Input}],feature:[{type:Le.Input}]},ta);function ta(e,t,r){var o=this;this.cdRef=e,this.sanitizer=t,this.networkService=r,this.networkService.currentState().subscribe(function(e){o.state=e})}var ra=(oa.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatIconModule,je.IgoLanguageModule,Te.IgoKeyValueModule],exports:[ea],declarations:[ea]}]}],oa);function oa(){}var na=(ia.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Te.IgoFormModule],exports:[Te.IgoFormModule,Eo],declarations:[Eo]}]}],ia);function ia(){}var aa=(sa.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule],exports:[ra,na],declarations:[],providers:[]}]}],sa);function sa(){}var la,ua,ca=(Object.defineProperty(pa.prototype,"geometryType",{get:function(){return this.geometryType$.value},set:function(e){this.geometryType$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(pa.prototype,"drawGuide",{get:function(){return this.drawGuide$.value},set:function(e){this.drawGuide$.next(e)},enumerable:!0,configurable:!0}),pa.prototype.ngOnInit=function(){var t=this;this.value$.next(this.formControl.value?this.formControl.value:undefined),this.value$$=this.formControl.valueChanges.subscribe(function(e){t.value$.next(e||undefined)})},pa.prototype.ngOnDestroy=function(){this.value$$.unsubscribe()},pa.decorators=[{type:Le.Component,args:[{selector:"igo-geometry-form-field",template:'<igo-geometry-form-field-input\r\n  [formControl]="formControl"\r\n  [map]="map"\r\n  [geometryType]="geometryType$ | async"\r\n  [drawGuide]="drawGuide$ | async"\r\n  [measure]="measure"\r\n  [drawControlIsActive]="drawControlIsActive"\r\n  [freehandDrawIsActive]="freehandDrawIsActive"\r\n  [drawStyle]="drawStyle"\r\n  [overlayStyle]="overlayStyle">\r\n</igo-geometry-form-field-input>\r\n\r\n<div *ngIf="geometryTypeField" class="geometry-type-toggle">\r\n  <mat-button-toggle-group\r\n    [disabled]="(value$ | async) !== undefined"\r\n    [(ngModel)]="geometryType">\r\n    <mat-button-toggle\r\n      value="Point"\r\n      [disabled]="geometryTypes.indexOf(\'Point\') < 0">\r\n      {{\'igo.geo.geometry.point\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="LineString"\r\n      [disabled]="geometryTypes.indexOf(\'LineString\') < 0">\r\n      {{\'igo.geo.geometry.line\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="Polygon"\r\n      [disabled]="geometryTypes.indexOf(\'Polygon\') < 0">\r\n      {{\'igo.geo.geometry.polygon\' | translate}}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<mat-form-field *ngIf="drawGuideField" class="draw-guide-field">\r\n  <input\r\n    matInput\r\n    type="number"\r\n    [placeholder]="drawGuidePlaceholder"\r\n    [(ngModel)]="drawGuide">\r\n  <mat-icon\r\n    matPrefix\r\n    [color]="\'primary\'"\r\n    svgIcon="adjust">    \r\n  </mat-icon>\r\n  <span matSuffix class="draw-guide-units">{{\'igo.geo.measure.meters\' | translate}}</span>\r\n</mat-form-field>',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;width:100%}.draw-guide-field,.geometry-type-toggle{width:100%}.geometry-type-toggle{padding:10px;text-align:center}.draw-guide-field mat-icon{margin:0 10px}.draw-guide-units{padding:10px}"]}]}],pa.ctorParameters=function(){return[{type:Le.ChangeDetectorRef}]},pa.propDecorators={formControl:[{type:Le.Input}],map:[{type:Le.Input}],geometryType:[{type:Le.Input}],geometryTypeField:[{type:Le.Input}],geometryTypes:[{type:Le.Input}],drawGuideField:[{type:Le.Input}],drawGuide:[{type:Le.Input}],drawGuidePlaceholder:[{type:Le.Input}],measure:[{type:Le.Input}],drawStyle:[{type:Le.Input}],overlayStyle:[{type:Le.Input}]},pa=Ve([Te.FormFieldComponent("geometry"),Ue("design:paramtypes",[Le.ChangeDetectorRef])],pa));function pa(e){this.cdRef=e,this.value$=new Ce.BehaviorSubject(undefined),this.drawControlIsActive=!0,this.freehandDrawIsActive=!1,this.geometryType$=new Ce.BehaviorSubject(undefined),this.geometryTypeField=!1,this.geometryTypes=["Point","LineString","Polygon"],this.drawGuideField=!1,this.drawGuide$=new Ce.BehaviorSubject(0),this.drawGuidePlaceholder="",this.measure=!1}var da={Length:"length",Area:"area"},ha={Meters:"meters",Kilometers:"kilometers",Miles:"miles",Feet:"feet"},ga=((la={})[ha.Meters]="m",la[ha.Kilometers]="km",la[ha.Miles]="mi",la[ha.Feet]="ft",la),fa={SquareMeters:"squareMeters",SquareKilometers:"squareKilometers",SquareMiles:"squareMiles",SquareFeet:"squareFeet",Hectares:"hectares",Acres:"acres"},ma=((ua={})[fa.SquareMeters]="m",ua[fa.SquareKilometers]="km",ua[fa.SquareMiles]="mi",ua[fa.SquareFeet]="ft",ua[fa.Hectares]="ha",ua[fa.Acres]="ac",ua);function ya(e){return.001*e}function va(e){return 3.2808*e}function ba(e){return 621e-6*e}function Sa(e){return 1e-6*e}function wa(e){return 3.861e-7*e}function Ia(e){return 10.764*e}function Fa(e){return 1e-4*e}function Oa(e){return 24711e-8*e}function Ta(e,t){var r=new Map([[ha.Meters,function(e){return e}],[ha.Kilometers,ya],[ha.Miles,ba],[ha.Feet,va]]).get(t);return r?r(e):undefined}function xa(e,t){var r=new Map([[fa.SquareMeters,function(e){return e}],[fa.SquareKilometers,Sa],[fa.SquareMiles,wa],[fa.SquareFeet,Ia],[fa.Hectares,Fa],[fa.Acres,Oa]]).get(t);return r?r(e):undefined}function Ca(e,t,r){var o=t.decimal;(o===undefined||o<0)&&(o=1);var n=[];return t.locale!==undefined?n.push(e.toLocaleString(t.locale,{minimumFractionDigits:o,maximumFractionDigits:o})):n.push(e.toFixed(o).toString()),t.unit!==undefined&&!0===t.unitAbbr&&(r?n.push(ga[t.unit]?r.translate.instant("igo.geo.measure."+ga[t.unit]):r.translate.instant("igo.geo.measure."+ma[t.unit])):n.push(ga[t.unit]||ma[t.unit])),n.filter(function(e){return e!==undefined}).join(" ")}function Ma(e){for(var t=ha.Meters,r=e,o=[ha.Kilometers];1e3<r&&0<o.length;)r=Ta(e,t=o.pop());return t}function La(e){for(var t=fa.SquareMeters,r=e,o=[fa.SquareKilometers];1e6<r&&0<o.length;)r=xa(e,t=o.pop());return t}function Pa(){return new Se.Style({stroke:new Se.Stroke({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new Se.Fill({color:"rgba(255, 255, 255, 0.2)"}),image:new Se.Circle({radius:5,stroke:new Se.Stroke({color:"#ffcc33"}),fill:new Se.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}function Da(){return new Se.Style({stroke:new Se.Stroke({color:"#ffcc33",width:2}),fill:new Se.Fill({color:"rgba(255, 255, 255, 0.2)"})})}function ka(e,t){return e instanceof U?undefined:0===e.getFlatCoordinates().length?undefined:K.getLength(e,{projection:t})}function ja(e,t){return e instanceof U||e instanceof Y?undefined:0===e.getFlatCoordinates().length?undefined:K.getArea(e,{projection:t})}function Ea(e,t){for(var r=ka(e,t),o=ja(e,t),n=[],i=e.flatCoordinates,a=i.length,s=0;s<=a-4;s+=2){var l=new Y([[i[s],i[s+1]],[i[s+2],i[s+3]]]);n.push(ka(l,t))}return{area:o,length:r,lengths:n}}function Ra(e){for(var t=$a(e),r=e.flatCoordinates,o=t.length,n=0;n<o;n++){var i=2*n,a=new Y([[r[i],r[1+i]],[r[2+i],r[3+i]]]).getCoordinateAt(.5),s=t[n];s!==undefined?s.setCoordinates(a):t[n]=new U(a)}return t}function $a(e){var t=Math.max(e.flatCoordinates.length/2-1,0),r=e.get("_midpoints");if(r===undefined)return r=new Array(t),e.set("_midpoints",r,!0),r;if(t===r.length)return r;if(t>r.length)return r.push.apply(r,Ke(new Array(t-r.length))),r;for(var o=t;o<r.length;o++){var n=r[t];n!==undefined&&Aa(n)}return r.splice(t),r}function Aa(e){var t=e.get("_tooltip");if(t!==undefined){var r=t.getMap();r!==undefined&&r.removeOverlay(t)}}function Ga(e){return Ra(e).map(function(e){var t=e.get("_tooltip");return t===undefined?t=Ua(e):t.setPosition(e.flatCoordinates),t})}function Ba(e){return $a(e).map(function(e){return e?e.get("_tooltip"):undefined})}function _a(e){var t=e.get("_center"),r=z.getCenter(e.getExtent());return t!==undefined?t.setCoordinates(r):(t=new U(r),e.set("_center",t)),t}function qa(e){var t=_a(e),r=t.get("_tooltip");return r===undefined?r=Ua(t):r.setPosition(t.flatCoordinates),r}function Na(e){var t=e.get("_center");return t?t.get("_tooltip"):undefined}function Va(e){var t=[].concat(Ba(e)||[]),r=Na(e);return r!==undefined&&t.push(r),t}function Ua(e){var t=new W({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1});return t.setPosition(e.flatCoordinates),e.set("_tooltip",t),t}var Wa,za=(qe(Ka,Wa=Error),Ka);function Ka(){return null!==Wa&&Wa.apply(this,arguments)||this}var Ha,Ya=(qe(Za,Ha=za),Za);function Za(){var e=Ha.call(this,"Can't slice a MultiPolygon.")||this;return Object.setPrototypeOf(e,Za.prototype),e}var Qa,Ja=(qe(Xa,Qa=za),Xa);function Xa(){var e=Qa.call(this,"Can't slice with a line that has more than 2 points.")||this;return Object.setPrototypeOf(e,Xa.prototype),e}var es,ts=(qe(rs,es=za),rs);function rs(){var e=es.call(this,"More than 2 intersections found between the target polygon and the slicing line.")||this;return Object.setPrototypeOf(e,rs.prototype),e}function os(e){return e=e||[0,153,255],new Se.Style({stroke:new Se.Stroke({color:e.concat([1]),width:2}),fill:new Se.Fill({color:e.concat([.2])}),image:new Se.Circle({radius:8,stroke:new Se.Stroke({color:e.concat([1])}),fill:new Se.Fill({color:e.concat([.2])})})})}function ns(){return new Se.Style({stroke:new Se.Stroke({color:[0,153,255,1],width:2})})}function is(e,t){return e instanceof te?ss(e,t):[]}function as(e,t){return[]}function ss(e,t){if(1<e.getLinearRingCount())throw new Ya;if(2<t.getCoordinates().length)throw new Ja;for(var r=(new Ie).writeGeometryObject(t),o=e.getLinearRing(0).getCoordinates(),n=[[],[]],i=0,a=0,s=o.length-1;a<s;a++){var l=[o[a],o[a+1]],u=Q.lineString(l),c=Z(u,r).features,p=c.length;if(i+=p,1<p||2<i)throw new ts;if(n[0].push(l[0]),1===p){var d=c[0].geometry.coordinates;n[0].push(d),n[1].push(d),n.reverse()}}return i<=1?[]:(n[0].push(n[0][0]),n[1].push(n[1][0]),[new te([n[0]]),new te([n[1]])])}function ls(e,t){e.appendLinearRing(t)}function us(e){var t=e.target;return t instanceof te?t.flatCoordinates.slice(-4,-2):t.flatCoordinates.slice(-2)}var cs=(Object.defineProperty(ps.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(ps.prototype,"geometryType",{get:function(){return this.options.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(ps.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),ps.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction()},ps.prototype.getSource=function(){return this.olOverlaySource},ps.prototype.createOlInnerOverlayLayer=function(){return new ie({source:this.options.source?this.options.source:new ne,style:this.options.layerStyle,zIndex:500})},ps.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},ps.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},ps.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},ps.prototype.addOlDrawInteraction=function(){var e,t=this;e=!1===this.freehand$.getValue()?new ee({type:this.geometryType,source:this.getSource(),stopClick:!0,style:this.options.drawStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:function(){return!1}}):"Point"===this.geometryType?new ee({type:"Circle",source:this.getSource(),maxPoints:this.options.maxPoints,freehand:!0}):new ee({type:this.geometryType,source:this.getSource(),maxPoints:this.options.maxPoints,freehand:!0}),this.onDrawStartKey=e.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=e.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(e),this.olDrawInteraction=e},ps.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),fe.unByKey(this.onDrawStartKey),fe.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction),this.olDrawInteraction=undefined)},ps.prototype.onDrawStart=function(e){var t=this,r=e.feature.getGeometry();this.start$.next(r),this.clearOlInnerOverlaySource(),this.onChangesKey=r.on("change",function(e){t.mousePosition=us(e),t.changes$.next(e.target)}),this.subscribeToKeyDown()},ps.prototype.onDrawEnd=function(e){this.unsubscribeToKeyDown(),this.onChangesKey!==undefined&&fe.unByKey(this.onChangesKey),this.end$.next(e.feature.getGeometry())},ps.prototype.subscribeToKeyDown=function(){var t=this;this.unsubscribeToKeyDown(),this.keyDown$$=Ce.fromEvent(document,"keydown").subscribe(function(e){27!==e.keyCode?32!==e.keyCode||t.olMap.getView().animate({center:t.mousePosition,duration:0}):t.olDrawInteraction.removeLastPoint()})},ps.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&(this.keyDown$$.unsubscribe(),this.keyDown$$=undefined)},ps);function ps(e){this.options=e,this.start$=new Ce.Subject,this.end$=new Ce.Subject,this.changes$=new Ce.Subject,this.freehand$=new Ce.BehaviorSubject(!1),e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}var ds=(Object.defineProperty(hs.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(hs.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Object.defineProperty(hs.prototype,"olLinearRingsSource",{get:function(){return this.olLinearRingsLayer.getSource()},enumerable:!0,configurable:!0}),hs.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction(),this.addOlTranslateInteraction(),this.activateTranslateInteraction(),this.addOlModifyInteraction(),this.activateModifyInteraction()},hs.prototype.getSource=function(){return this.olOverlaySource},hs.prototype.setOlGeometry=function(e){var t=new ve({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},hs.prototype.createOlInnerOverlayLayer=function(){return new ie({source:this.options.source?this.options.source:new ne,style:this.options.layerStyle,zIndex:500})},hs.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},hs.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},hs.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},hs.prototype.createOlLinearRingsLayer=function(){return new ie({source:new ne,style:ns(),zIndex:500})},hs.prototype.addOlLinearRingsLayer=function(){this.olMap.addLayer(this.olLinearRingsLayer)},hs.prototype.removeOlLinearRingsLayer=function(){this.olMap.removeLayer(this.olLinearRingsLayer)},hs.prototype.clearOlLinearRingsSource=function(){this.olLinearRingsSource.clear(!0)},hs.prototype.addOlModifyInteraction=function(){var e=new J({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=e},hs.prototype.removeOlModifyInteraction=function(){this.olModifyInteraction!==undefined&&(this.deactivateModifyInteraction(),this.olModifyInteraction=undefined)},hs.prototype.activateModifyInteraction=function(){var t=this;!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",function(e){return t.onModifyStart(e)}),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",function(e){return t.onModifyEnd(e)}),this.olMap.addInteraction(this.olModifyInteraction))},hs.prototype.deactivateModifyInteraction=function(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,fe.unByKey(this.onModifyStartKey),fe.unByKey(this.onModifyEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olModifyInteraction))},hs.prototype.onModifyStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onModifyKey=r.on("change",function(e){t.mousePosition=us(e),t.changes$.next(e.target)}),this.subscribeToKeyDown()},hs.prototype.onModifyEnd=function(e){this.onModifyKey!==undefined&&fe.unByKey(this.onModifyKey),this.end$.next(e.features.item(0).getGeometry()),this.unsubscribeToKeyDown()},hs.prototype.subscribeToKeyDown=function(){var t=this;this.keyDown$$=Ce.fromEvent(document,"keydown").subscribe(function(e){32!==e.keyCode||t.olMap.getView().animate({center:t.mousePosition,duration:0})})},hs.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&this.keyDown$$.unsubscribe()},hs.prototype.addOlTranslateInteraction=function(){var e=new X({layers:[this.olOverlayLayer]});this.olTranslateInteraction=e},hs.prototype.removeOlTranslateInteraction=function(){this.olTranslateInteraction!==undefined&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=undefined)},hs.prototype.activateTranslateInteraction=function(){var t=this;!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",function(e){return t.onTranslateStart(e)}),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",function(e){return t.onTranslateEnd(e)}),this.olMap.addInteraction(this.olTranslateInteraction))},hs.prototype.deactivateTranslateInteraction=function(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,fe.unByKey(this.onTranslateStartKey),fe.unByKey(this.onTranslateEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olTranslateInteraction))},hs.prototype.onTranslateStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onTranslateKey=r.on("change",function(e){t.changes$.next(e.target)})},hs.prototype.onTranslateEnd=function(e){this.onTranslateKey!==undefined&&fe.unByKey(this.onTranslateKey),this.end$.next(e.features.item(0).getGeometry())},hs.prototype.addOlDrawInteraction=function(){var t=this,e=new ee({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:ns(),condition:function(e){return(t.olOuterGeometry||t.getOlGeometry()).intersectsCoordinate(e.coordinate)}});this.olDrawInteraction=e,this.subscribeToDrawKeyDown()},hs.prototype.subscribeToDrawKeyDown=function(){var r=this;this.drawKeyDown$$=Ce.fromEvent(document,"keydown").subscribe(function(e){if(17===e.keyCode){r.unsubscribeToDrawKeyDown();var t=r.getOlGeometry();t&&t instanceof te&&(r.subscribeToDrawKeyUp(),r.deactivateModifyInteraction(),r.deactivateTranslateInteraction(),r.activateDrawInteraction())}})},hs.prototype.subscribeToDrawKeyUp=function(){var t=this;this.drawKeyUp$$=Ce.fromEvent(document,"keyup").subscribe(function(e){17===e.keyCode&&(t.unsubscribeToDrawKeyUp(),t.unsubscribeToKeyDown(),t.deactivateDrawInteraction(),t.activateModifyInteraction(),t.activateTranslateInteraction(),t.subscribeToDrawKeyDown(),t.end$.next(t.getOlGeometry()))})},hs.prototype.unsubscribeToDrawKeyDown=function(){this.drawKeyDown$$!==undefined&&this.drawKeyDown$$.unsubscribe()},hs.prototype.unsubscribeToDrawKeyUp=function(){this.drawKeyUp$$!==undefined&&this.drawKeyUp$$.unsubscribe()},hs.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.olDrawInteraction=undefined)},hs.prototype.activateDrawInteraction=function(){var t=this;!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(function(e){e instanceof oe&&(t.olMap.removeInteraction(e),t.removedOlInteractions.push(e))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=this.olDrawInteraction.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(this.olDrawInteraction))},hs.prototype.deactivateDrawInteraction=function(){var t=this;!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(function(e){t.olMap.addInteraction(e)}),this.olDrawInteractionIsActive=!1,fe.unByKey(this.onDrawStartKey),fe.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction))},hs.prototype.onDrawStart=function(e){var r=this,t=e.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();var o=t.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(o),this.start$.next(this.getOlGeometry()),this.onDrawKey=t.on("change",function(e){var t=e.target.getLinearRing().getCoordinates();r.updateLinearRingOfOlGeometry(t),r.changes$.next(r.getOlGeometry())}),this.subscribeToKeyDown()},hs.prototype.onDrawEnd=function(e){this.onDrawKey!==undefined&&fe.unByKey(this.onDrawKey),this.olOuterGeometry=undefined;var t=e.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()},hs.prototype.addLinearRingToOlGeometry=function(e){ls(this.getOlGeometry(),new re(e))},hs.prototype.updateLinearRingOfOlGeometry=function(e){var t=this.getOlGeometry(),r=t.getLinearRings().slice(0,-1).map(function(e){return e.getCoordinates()});r.push(e),t.setCoordinates(r)},hs.prototype.getOlGeometry=function(){var e=this.olOverlaySource.getFeatures();return 0<e.length?e[0].getGeometry():undefined},hs);function hs(e){this.options=e,this.start$=new Ce.Subject,this.end$=new Ce.Subject,this.changes$=new Ce.Subject,this.olModifyInteractionIsActive=!1,this.olTranslateInteractionIsActive=!1,this.olDrawInteractionIsActive=!1,this.removedOlInteractions=[],e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}var gs=(Object.defineProperty(fs.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(fs.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),fs.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeDrawLineControl(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addDrawLineControl()},fs.prototype.getSource=function(){return this.olOverlaySource},fs.prototype.setOlGeometry=function(e){var t=new ve({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},fs.prototype.createOlInnerOverlayLayer=function(){return new ie({source:this.options.source?this.options.source:new ne,style:this.options.layerStyle,zIndex:500})},fs.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},fs.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},fs.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},fs.prototype.addDrawLineControl=function(){var t=this;this.drawLineControl=new cs({geometryType:"LineString",drawStyle:this.options.drawStyle,maxPoints:2}),this.drawLineStart$$=this.drawLineControl.start$.subscribe(function(e){return t.onDrawLineStart(e)}),this.drawLineEnd$$=this.drawLineControl.end$.subscribe(function(e){return t.onDrawLineEnd(e)}),this.drawLineControl.setOlMap(this.olMap)},fs.prototype.removeDrawLineControl=function(){this.drawLineControl!==undefined&&(this.drawLineStart$$.unsubscribe(),this.drawLineEnd$$.unsubscribe(),this.drawLineControl.getSource().clear(),this.drawLineControl.setOlMap(undefined))},fs.prototype.onDrawLineStart=function(e){this.drawLineControl.getSource().clear()},fs.prototype.onDrawLineEnd=function(r){var t=this,o=[],e=r.getExtent(),n=[];try{this.olOverlaySource.forEachFeatureInExtent(e,function(e){var t=is(e.getGeometry(),r);0<t.length&&(o.push.apply(o,Ke(t)),n.push(e))})}catch(i){if(i instanceof za)return void this.error$.next(i);throw i}this.drawLineControl.getSource().clear(),this.olOverlaySource.addFeatures(o.map(function(e){return new ve(e)})),n.forEach(function(e){t.olOverlaySource.removeFeature(e)}),this.error$.next(undefined),this.end$.next(o)},fs);function fs(e){this.options=e,this.end$=new Ce.Subject,this.error$=new Ce.Subject,e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}var ms=(ys.prototype.onNoClick=function(){this.dialogRef.close()},ys.decorators=[{type:Le.Component,args:[{selector:"igo-measurer-dialog",template:"<div mat-dialog-content>\r\n  <h3>{{'igo.geo.measure.dialog.title' | translate}}</h3>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\r\n        <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\r\n        <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n",styles:[':host{font-family:Roboto,"Helvetica Neue",sans-serif}h3{text-align:center;margin:0}table{width:100%;padding:10px}table tbody tr td:last-child{padding-left:10px}']}]}],ys.ctorParameters=function(){return[{type:Fe.MatDialogRef},{type:undefined,decorators:[{type:Le.Inject,args:[Fe.MAT_DIALOG_DATA]}]}]},ys);function ys(e,t){this.dialogRef=e,this.data=t,this.measureAreaUnit=fa,this.measureLengthUnit=ha}var vs=(Object.defineProperty(bs.prototype,"activeMeasureType",{get:function(){return this._activeMeasureType},set:function(e){this.setActiveMeasureType(e)},enumerable:!0,configurable:!0}),Object.defineProperty(bs.prototype,"drawControlIsActive",{get:function(){return this.activeDrawControl!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(bs.prototype,"projection",{get:function(){return this.map.ol.getView().getProjection()},enumerable:!0,configurable:!0}),bs.prototype.ngOnInit=function(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.onToggleTooltips(this.showTooltips),this.updateTooltipsOfOlSource(this.store.source.ol)},bs.prototype.ngOnDestroy=function(){this.setActiveMeasureType(undefined),this.deactivateModifyControl(),this.freezeStore()},bs.prototype.onMeasureTypeChange=function(e){this.activeMeasureType=e},bs.prototype.onToggleDrawControl=function(e){!0===e?this.toggleDrawControl():this.deactivateDrawControl()},bs.prototype.onToggleTooltips=function(e){!0===(this.showTooltips=e)?this.showTooltipsOfOlSource(this.store.source.ol):this.clearTooltipsOfOlSource(this.store.source.ol)},bs.prototype.onToggleMeasureUnitsAuto=function(e){this.measureUnitsAuto=e},bs.prototype.onLengthUnitChange=function(e){this.activeLengthUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},bs.prototype.onAreaUnitChange=function(e){this.activeAreaUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},bs.prototype.onCalculateClick=function(){var e=this.selectedFeatures$.value,t=e.reduce(function(e,t){return e+t.properties.measure.area||0},0),r=e.reduce(function(e,t){return"Polygon"===t.geometry.type?e:e+t.properties.measure.length||0},0),o=e.reduce(function(e,t){return"LineString"===t.geometry.type?e:e+t.properties.measure.length||0},0);this.openDialog({area:t,length:r,perimeter:o})},bs.prototype.onDeleteClick=function(){this.store.deleteMany(this.selectedFeatures$.value)},bs.prototype.onModifyClick=function(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{var t=this.selectedFeatures$.value[0],e=this.store.layer.ol.getSource().getFeatures().find(function(e){return e.get("id")===t.properties.id});if(e!==undefined){this.deactivateDrawControl(),this.activateModifyControl();var r=e.getGeometry();this.clearTooltipsOfOlGeometry(r),this.modifyControl.setOlGeometry(r)}}},bs.prototype.openDialog=function(e){this.dialog.open(ms,{data:e})},bs.prototype.initStore=function(){var o=this,e=this.store;Po(e,new Tr({title:"Measures",zIndex:200,source:new nt,style:Da(),showInLayerList:!1,exportable:!1,browsable:!1})),Do(e),ko(e,new bo({map:this.map,many:!0})),this.onFeatureAddedKey=e.source.ol.on("addfeature",function(e){var t=e.feature,r=t.getGeometry();o.updateMeasureOfOlGeometry(r,t.get("measure"))}),this.onFeatureRemovedKey=e.source.ol.on("removefeature",function(e){var t=e.feature.getGeometry();o.clearTooltipsOfOlGeometry(t)}),this.selectedFeatures$$=e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(De.skip(1)).subscribe(function(e){!0===o.modifyControl.active&&o.deactivateModifyControl(),o.selectedFeatures$.next(e.map(function(e){return e.entity}))})},bs.prototype.freezeStore=function(){var e=this.store;this.selectedFeatures$$.unsubscribe(),fe.unByKey(this.onFeatureAddedKey),fe.unByKey(this.onFeatureRemovedKey),this.clearTooltipsOfOlSource(e.source.ol),this.map.removeLayer(e.layer),e.deactivateStrategyOfType(ao),e.deactivateStrategyOfType(bo)},bs.prototype.createDrawLineControl=function(){this.drawLineControl=new cs({geometryType:"LineString",source:this.olDrawSource,drawStyle:Pa(),layerStyle:new H({})})},bs.prototype.createDrawPolygonControl=function(){this.drawPolygonControl=new cs({geometryType:"Polygon",source:this.olDrawSource,drawStyle:Pa(),layerStyle:new H({})})},bs.prototype.createModifyControl=function(){this.modifyControl=new ds({source:this.olDrawSource,drawStyle:Pa(),layerStyle:new H({})})},bs.prototype.toggleDrawControl=function(){this.deactivateDrawControl(),this.activeMeasureType===da.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===da.Area&&this.activateDrawControl(this.drawPolygonControl)},bs.prototype.activateDrawControl=function(e){var t=this;this.activeDrawControl=e,this.drawStart$$=e.start$.subscribe(function(e){return t.onDrawStart(e)}),this.drawEnd$$=e.end$.subscribe(function(e){return t.onDrawEnd(e)}),this.drawChanges$$=e.changes$.subscribe(function(e){return t.onDrawChanges(e)}),e.setOlMap(this.map.ol)},bs.prototype.deactivateDrawControl=function(){this.activeDrawControl!==undefined&&(this.olDrawSource.clear(),this.drawStart$$!==undefined&&this.drawStart$$.unsubscribe(),this.drawEnd$$!==undefined&&this.drawEnd$$.unsubscribe(),this.drawChanges$$!==undefined&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),this.activeOlGeometry!==undefined&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(undefined),this.activeDrawControl=undefined,this.activeOlGeometry=undefined)},bs.prototype.setActiveMeasureType=function(e){this._activeMeasureType=e,this.clearMeasures(),this.toggleDrawControl()},bs.prototype.onDrawStart=function(e){this.activeOlGeometry=e},bs.prototype.onDrawEnd=function(e){this.activeOlGeometry=undefined,this.finalizeMeasureOfOlGeometry(e),this.addFeatureToStore(e),this.clearTooltipsOfOlGeometry(e),this.olDrawSource.clear(!0)},bs.prototype.onDrawChanges=function(e){var t=Ea(e,this.projection);this.updateMeasureOfOlGeometry(e,Object.assign({},t,{area:undefined})),this.measure$.next(t)},bs.prototype.activateModifyControl=function(){var t=this,e=this.store.getStrategyOfType(bo);e.deactivate(),e.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(function(e){return t.onModifyStart(e)}),this.modifyEnd$$=this.modifyControl.end$.subscribe(function(e){return t.onModifyEnd(e)}),this.modifyChanges$$=this.modifyControl.changes$.subscribe(function(e){return t.onModifyChanges(e)}),this.modifyControl.setOlMap(this.map.ol)},bs.prototype.deactivateModifyControl=function(){if(this.modifyStart$$!==undefined&&this.modifyStart$$.unsubscribe(),this.modifyEnd$$!==undefined&&this.modifyEnd$$.unsubscribe(),this.modifyChanges$$!==undefined&&this.modifyChanges$$.unsubscribe(),this.activeOlGeometry!==undefined){if(1===this.selectedFeatures$.value.length){var e=this.selectedFeatures$.value[0];this.addFeatureToStore(this.activeOlGeometry,e)}this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)}this.olDrawSource.clear(),this.store.activateStrategyOfType(bo),this.activeOlGeometry=undefined,this.modifyControl.setOlMap(undefined)},bs.prototype.onModifyStart=function(e){this.onDrawStart(e)},bs.prototype.onModifyChanges=function(e){this.onDrawChanges(e)},bs.prototype.onModifyEnd=function(e){this.finalizeMeasureOfOlGeometry(e)},bs.prototype.finalizeMeasureOfOlGeometry=function(e){var t=Ea(e,this.projection);e instanceof te&&(t=Object.assign({},t,{lengths:[]})),this.updateMeasureOfOlGeometry(e,t)},bs.prototype.updateMeasureOfOlGeometry=function(e,t){e.setProperties({_measure:t},!0),this.updateTooltipsOfOlGeometry(e)},bs.prototype.clearMeasures=function(){this.measure$.next({})},bs.prototype.addFeatureToStore=function(e,t){var r=t?t.properties.id:ke.uuid(),o=this.map.ol.getView().getProjection(),n=(new Ie).writeGeometryObject(e,{featureProjection:o,dataProjection:o});this.store.update({type:rr,geometry:n,projection:o.getCode(),properties:{id:r,measure:e.get("_measure")},meta:{id:r}})},bs.prototype.updateTooltipsOfOlGeometry=function(e){var t=e.get("_measure"),r=t.lengths,o=t.area,n=Ga(e);if(r.length===n.length)for(var i=0;i<n.length;i++){var a=r[i];a!==undefined&&this.updateOlTooltip(n[i],Ta(a,this.activeLengthUnit),this.activeLengthUnit,da.Length)}o!==undefined&&this.updateOlTooltip(qa(e),xa(o,this.activeAreaUnit),this.activeAreaUnit,da.Area)},bs.prototype.showTooltipsOfOlGeometry=function(e){var t=this;Va(e).forEach(function(e){t.shouldShowTooltip(e)&&t.map.ol.addOverlay(e)})},bs.prototype.clearTooltipsOfOlGeometry=function(e){var t=this;Va(e).forEach(function(e){e!==undefined&&e.getMap()!==undefined&&t.map.ol.removeOverlay(e)})},bs.prototype.updateTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.updateTooltipsOfOlGeometry(e.getGeometry())})},bs.prototype.showTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.showTooltipsOfOlGeometry(e.getGeometry())})},bs.prototype.clearTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){e.getGeometry()!==undefined&&t.clearTooltipsOfOlGeometry(e.getGeometry())})},bs.prototype.updateOlTooltip=function(e,t,r,o){e.setProperties({_measure:t,_unit:r,_type:o},!0),e.getElement().innerHTML=this.computeTooltipInnerHTML(e),this.shouldShowTooltip(e)&&this.map.ol.addOverlay(e)},bs.prototype.computeTooltipInnerHTML=function(e){var t=e.getProperties();return Ca(t._measure,{decimal:1,unit:t._unit,unitAbbr:!0,locale:"fr"},this.languageService)},bs.prototype.shouldShowTooltip=function(e){if(!1===this.showTooltips)return!1;var t=e.getProperties(),r=t._measure;if(r===undefined)return!1;if(t._unit!==da.Length)return!0;var o=Ta(this.minSegmentLength,t._unit)||0;return r>Math.max(o,0)},bs.decorators=[{type:Le.Component,args:[{selector:"igo-measurer",template:'<div>\r\n  <div class="measure-type-toggle mat-typography">\r\n    <mat-button-toggle-group\r\n      [value]="activeMeasureType"\r\n      (change)="onMeasureTypeChange($event.value)">\r\n      <mat-button-toggle [value]="measureType.Length">\r\n        {{(\'igo.geo.measure.\' + measureType.Length) | translate}}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]="measureType.Area">\r\n        {{(\'igo.geo.measure.\' + measureType.Area) | translate}}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class="measure-options mat-typography">\r\n    <mat-slide-toggle\r\n      [checked]="drawControlIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleDrawControl($event.checked)">\r\n      {{\'igo.geo.measure.toggleActive\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="showTooltips"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleTooltips($event.checked)">\r\n      {{\'igo.geo.measure.toggleMapTooltips\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="measureUnitsAuto"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleMeasureUnitsAuto($event.checked)">\r\n      {{\'igo.geo.measure.toggleAutoUnits\' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf="measure$ | async as measure">\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Length"\r\n      [measureUnit]="measureLengthUnit.Meters"\r\n      [measure]="measure.length"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="(activeMeasureType === measureType.Area ? \'igo.geo.measure.perimeter\' : \'igo.geo.measure.length\') | translate"\r\n      (measureUnitChange)="onLengthUnitChange($event)">\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Area"\r\n      [measureUnit]="measureAreaUnit.SquareMeters"\r\n      [measure]="measure.area"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="\'igo.geo.measure.area\' | translate"\r\n      (measureUnitChange)="onAreaUnitChange($event)">\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <div class="measure-store-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.calculate.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onCalculateClick()">\r\n      <mat-icon svgIcon="calculator"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.delete.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onDeleteClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n\r\n    \x3c!--button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.modify.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length !== 1"\r\n      (click)="onModifyClick()">\r\n      <mat-icon svgIcon="edit"></mat-icon>\r\n    </button--\x3e\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class="table-compact"\r\n    [store]="store"\r\n    [template]="tableTemplate">\r\n  </igo-entity-table>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".measure-type-toggle{padding:10px;text-align:center}.measure-type-toggle mat-button-toggle-group{width:100%}.measure-type-toggle mat-button-toggle-group mat-button-toggle{width:50%}.measure-options{overflow-x:hidden}.measure-options mat-slide-toggle{width:100%;margin:10px}.measure-options mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px)}.measure-store-buttons{width:100%;border-top:1px solid #ddd;border-bottom:1px solid #ddd}.measure-store-buttons button:first-of-type{margin-left:14px}.table-compact ::ng-deep .mat-header-cell.mat-column-selectionCheckbox{width:52px}"]}]}],bs.ctorParameters=function(){return[{type:je.LanguageService},{type:Fe.MatDialog}]},bs.propDecorators={map:[{type:Le.Input}],store:[{type:Le.Input}],activeMeasureType:[{type:Le.Input}],minSegmentLength:[{type:Le.Input}],table:[{type:Le.ViewChild,args:["table"]}]},bs);function bs(e,t){var o=this;this.languageService=e,this.dialog=t,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:function(e){var t=o.activeLengthUnit;return Ca(Ta(e.properties.measure.length,t),{decimal:1,unit:t,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:function(e){var t=o.activeAreaUnit,r=xa(e.properties.measure.area,t);return r?Ca(r,{decimal:1,unit:t,unitAbbr:!1,locale:"fr"}):""}}]},this.measureType=da,this.measureAreaUnit=fa,this.measureLengthUnit=ha,this.measureUnitsAuto=!1,this.measure$=new Ce.BehaviorSubject({}),this.selectedFeatures$=new Ce.BehaviorSubject([]),this.showTooltips=!0,this.activeLengthUnit=ha.Meters,this.activeAreaUnit=fa.SquareMeters,this.olDrawSource=new ne,this._activeMeasureType=da.Length,this.minSegmentLength=10}var Ss=(ws.prototype.transform=function(e,t,r,o){var n;return void 0===r&&(r=!1),void 0===o&&(o=1),0<=Object.values(fa).indexOf(t)?n=xa(e,t):0<=Object.values(ha).indexOf(t)&&(n=Ta(e,t)),n?Ca(n,{decimal:1,unit:t,unitAbbr:r,locale:"fr"}):n},ws.decorators=[{type:Le.Pipe,args:[{name:"measureFormat"}]}],ws);function ws(){}var Is=(Object.defineProperty(Fs.prototype,"geometryType",{get:function(){return this._geometryType},set:function(e){this._geometryType=e,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"drawControlIsActive",{get:function(){return this._drawControlIsActive},set:function(e){this._drawControlIsActive=e,!1!==this.ready&&(this.deactivateControl(),this._drawControlIsActive&&this.toggleControl())},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"freehandDrawIsActive",{get:function(){return this._freehandDrawIsActive},set:function(e){this._freehandDrawIsActive=e,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"drawStyle",{get:function(){return this._drawStyle},set:function(e){e===undefined&&(e=os()),(this._drawStyle=e)&&this.isStyleWithRadius(e)?this.defaultDrawStyleRadius=e.getImage().getRadius():this.defaultDrawStyleRadius=null,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl()},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"overlayStyle",{get:function(){return this._overlayStyle},set:function(e){this._overlayStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,!1!==this.ready&&(e?this.addGeoJSONToOverlay(e):this.olOverlaySource.clear(),this.onChange(e),this.toggleControl(),this.cdRef.detectChanges())},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Object.defineProperty(Fs.prototype,"radius",{set:function(e){var t,r=this;!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive&&setTimeout(function(){(t=r.modifyControl.olModifyInteraction)&&t.features_&&t.features_.clear()},0))},enumerable:!0,configurable:!0}),Fs.prototype.ngOnInit=function(){this.drawStyle===undefined&&(this.drawStyle=os()),this.overlayStyle===undefined&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createMeasureTooltip(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0},Fs.prototype.ngOnDestroy=function(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)},Fs.prototype.registerOnChange=function(e){this.onChange=e},Fs.prototype.registerOnTouched=function(e){this.onTouched=e},Fs.prototype.writeValue=function(e){this.value=e},Fs.prototype.addOlOverlayLayer=function(){this.olOverlayLayer=new ie({source:new ne,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)},Fs.prototype.createDrawControl=function(){var o=this;this.drawControl=new cs({geometryType:this.geometryType||"Point",layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:function(e,t){var r=o.drawStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},Fs.prototype.createModifyControl=function(){var o=this;this.modifyControl=new ds({layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:function(e,t){var r=o.drawStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},Fs.prototype.toggleControl=function(){this.deactivateControl(),this.drawControlIsActive&&(!this.value&&this.geometryType?this.activateControl(this.drawControl):this.activateControl(this.modifyControl))},Fs.prototype.activateControl=function(e){var t=this;this.activeControl=e,this.olGeometryEnds$$=e.end$.subscribe(function(e){return t.onOlGeometryEnds(e)}),!0===this.measure&&e===this.drawControl&&(this.olGeometryChanges$$=e.changes$.subscribe(function(e){return t.onOlGeometryChanges(e)})),e.setOlMap(this.map.ol)},Fs.prototype.deactivateControl=function(){this.removeMeasureTooltip(),this.activeControl!==undefined&&this.activeControl.setOlMap(undefined),this.olGeometryEnds$$!==undefined&&this.olGeometryEnds$$.unsubscribe(),this.olGeometryChanges$$!==undefined&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=undefined},Fs.prototype.onOlGeometryEnds=function(e){this.removeMeasureTooltip(),this.setOlGeometry(e)},Fs.prototype.onOlGeometryChanges=function(e){"Point"!==e.getType()&&this.updateMeasureTooltip(e)},Fs.prototype.setOlGeometry=function(e){var t;e!==undefined&&("Circle"===e.getType()&&(e=this.circleToPoint(e)),t=this.olGeoJSON.writeGeometryObject(e,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),e.get("radius")&&(t.radius=e.get("radius"),e._radius=t.radius),this.writeValue(t))},Fs.prototype.circleToPoint=function(e){var t=e.getCenter(),r=be.transform(t,this.map.projection,"EPSG:4326"),o=Math.round(e.getRadius()*Math.cos(Math.PI/180*r[1]));return(e=new U(t)).set("radius",o,!0),e},Fs.prototype.addGeoJSONToOverlay=function(e){var t=this.olGeoJSON.readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),r=new ve({geometry:t});r.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(r)},Fs.prototype.createMeasureTooltip=function(){this.olTooltip=new W({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})},Fs.prototype.updateMeasureTooltip=function(e){var t=Ea(e,this.map.projection).lengths,r="Polygon"===e.getType()?t.length-2:t.length-1,o=t[r],n=Ra(e),i=n[r];if(0!==n.length&&i!==undefined){this.olTooltip.setPosition(i.flatCoordinates);var a=Ca(o,{decimal:1,unit:ha.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=a,this.olTooltip.getMap()===undefined&&this.map.ol.addOverlay(this.olTooltip)}else this.removeMeasureTooltip()},Fs.prototype.removeMeasureTooltip=function(){this.olTooltip.getMap&&this.olTooltip.getMap()!==undefined&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(undefined))},Fs.prototype.updateDrawStyleWithDrawGuide=function(e,t){if(this.isStyleWithRadius(e)){var r=this.drawGuide,o=void 0;o=!r||r<0?this.defaultDrawStyleRadius:0<r?r/t:r,e.getImage().setRadius(o)}},Fs.prototype.isStyleWithRadius=function(e){return"function"!=typeof e&&e.getImage&&e.getImage().setRadius},Fs.decorators=[{type:Le.Component,args:[{selector:"igo-geometry-form-field-input",template:"<ng-template></ng-template>",changeDetection:Le.ChangeDetectionStrategy.OnPush}]}],Fs.ctorParameters=function(){return[{type:Le.ChangeDetectorRef},{type:ye.NgControl,decorators:[{type:Le.Optional},{type:Le.Self}]}]},Fs.propDecorators={map:[{type:Le.Input}],geometryType:[{type:Le.Input}],drawGuide:[{type:Le.Input}],measure:[{type:Le.Input}],drawControlIsActive:[{type:Le.Input}],freehandDrawIsActive:[{type:Le.Input}],drawStyle:[{type:Le.Input}],overlayStyle:[{type:Le.Input}],value:[{type:Le.Input}],radius:[{type:Le.Input}]},Fs);function Fs(e,t){this.cdRef=e,this.ngControl=t,this.olGeoJSON=new Ie,this.ready=!1,this.olTooltip=W,this.drawGuide=null,this.measure=!1,this.onChange=function(){},this.onTouched=function(){},this.ngControl!==undefined&&(this.ngControl.valueAccessor=this)}var Os=(Ts.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,ye.FormsModule,ye.ReactiveFormsModule,Fe.MatIconModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatButtonModule,Fe.MatButtonToggleModule,je.IgoLanguageModule],exports:[ca,Is],declarations:[ca,Is]}]}],Ts);function Ts(){}var xs=(Cs.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Os],exports:[Os],declarations:[],providers:[],entryComponents:[ca]}]}],Cs);function Cs(){}var Ms=(Ls.prototype.ngOnInit=function(){this.options=this.layer.dataSource.options},Ls.prototype.toggleTimeFilter=function(){this.timeFilterCollapse=!this.timeFilterCollapse},Ls.decorators=[{type:Le.Component,args:[{selector:"igo-time-filter-button",template:'<button *ngIf="header && options.timeFilterable && options.timeFilter"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.filterBy\' | translate"\r\n  [color]="color"\r\n  (click)="toggleTimeFilter()">\r\n  <mat-icon svgIcon="history"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class="igo-layer-actions-container"\r\n*ngIf="header && options.timeFilterable && options.timeFilter">\r\n  <igo-time-filter-item\r\n    *ngIf="timeFilterCollapse && options.timeFilter"\r\n    igoListItem\r\n    [header]="false"\r\n    [layer]="layer">\r\n  </igo-time-filter-item>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Ls.ctorParameters=function(){return[]},Ls.propDecorators={layer:[{type:Le.Input}],map:[{type:Le.Input}],color:[{type:Le.Input}],header:[{type:Le.Input}]},Ls);function Ls(){this.color="primary",this.header=!0,this.timeFilterCollapse=!1}var Ps=(Object.defineProperty(Ds.prototype,"currentValue",{set:function(e){if(e&&this.type!==Pn.YEAR){var t=e.split("/");if(0<t.length){var r=new Date(t[0]),o=new Date(t[1]);isNaN(r.valueOf())||(this.startDate=r),isNaN(o.valueOf())||(this.endDate=o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"type",{get:function(){return this.options.type===undefined?Pn.DATE:this.options.type},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"isRange",{get:function(){return this.options.range!==undefined&&this.options.style!==Dn.SLIDER&&this.options.range},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"style",{get:function(){return this.options.style===undefined?Dn.SLIDER:this.options.style},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"step",{get:function(){var e=108e5;if(this.options.step===undefined)switch(this.type){case Pn.DATE:case Pn.DATETIME:e=108e5;break;case Pn.TIME:e=36e5;break;case Pn.YEAR:e=31536e6;break;default:e=108e5}else e=this.getStepDefinition(this.options.step);return e},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"timeInterval",{get:function(){return this.options.timeInterval===undefined?2e3:this.options.timeInterval},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"min",{get:function(){return this.options.min===undefined?undefined:new Date(this.options.min)},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"max",{get:function(){return this.options.max===undefined?undefined:new Date(this.options.max)},enumerable:!0,configurable:!0}),Object.defineProperty(Ds.prototype,"is",{get:function(){return this.options.range!==undefined&&this.options.range},enumerable:!0,configurable:!0}),Ds.prototype.ngOnInit=function(){if(this.startDate===undefined){var e=new Date(this.min);this.startDate=new Date(e.getTime()+6e4*e.getTimezoneOffset())}if(this.endDate===undefined){var t=new Date(this.max);this.endDate=new Date(t.getTime()+6e4*t.getTimezoneOffset())}if(this.startYear===undefined&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),this.endYear===undefined&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(r=this.startYear;r<this.endYear;r++)this.startListYears.push(r);for(r=this.startYear+1;r<=this.endYear;r++)this.endListYears.push(r)}else for(var r=this.startYear;r<=this.endYear+1;r++)this.listYears.push(r);this.options.enabled=this.options.enabled===undefined||this.options.enabled,this.checkFilterValue(),this.options.enabled?this.isRange||"slider"!==this.style||"year"!==this.type||this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(undefined))},Ds.prototype.storeCurrentFilterValue=function(){this.isRange||this.style!==Dn.SLIDER||this.type!==Pn.YEAR||(this.options.value=this.year.toString())},Ds.prototype.checkFilterValue=function(){var e=this.layer.dataSource.ol.getParams().TIME;this.isRange||this.style!==Dn.SLIDER||this.type!==Pn.YEAR||(e?this.year=new Date(e.toString()).getFullYear()+1:this.options.value?this.year=new Date(this.options.value.toString()).getFullYear()+1:this.year=new Date(this.min).getFullYear()+1)},Ds.prototype.handleDateChange=function(e){this.setupDateOutput(),this.applyTypeChange(),this.isRange?this.change.emit([this.startDate,this.endDate]):this.change.emit(this.startDate)},Ds.prototype.handleYearChange=function(e){if(this.isRange){this.endListYears=[];for(var t=this.startYear+1;t<=this.initEndYear;t++)this.endListYears.push(t);for(this.startListYears=[],t=this.initStartYear+1;t<this.endYear;t++)this.startListYears.push(t);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)},Ds.prototype.handleListYearChange=function(e){this.handleYearChange([this.startYear,this.endYear])},Ds.prototype.handleListYearStartChange=function(e){this.change.emit([this.startDate,this.endDate])},Ds.prototype.dateToNumber=function(e){return(e?new Date(e):new Date(this.min)).getTime()},Ds.prototype.setSliderThumbLabel=function(e){var t=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);t&&(t.textContent=e)},Ds.prototype.findThumbLabel=function(e){var t,r=this;return e.forEach(function(e){"mat-slider-thumb-label-text"===e.className&&(t=e),0<e.children.length&&!t&&(t=r.findThumbLabel(e.childNodes))},this),t},Ds.prototype.toggleFilterState=function(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Dn.SLIDER&&this.type===Pn.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(undefined))},Ds.prototype.resetFilter=function(e){this.date=new Date(this.min),this.year=this.date.getFullYear()+1,!this.isRange&&Dn.SLIDER&&this.type===Pn.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(undefined))},Ds.prototype.playFilter=function(e){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(e){var t,r=new Date(e.max);t=e.date===undefined?e.min.getTime():e.date.getTime(),t+=e.mySlider.step,e.date=new Date(t),t>r.getTime()&&e.stopFilter(),e.handleDateChange({value:e.date,date:e.date})},this.timeInterval,this))},Ds.prototype.playYear=function(e){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(e)),this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(e){e.year=e.year+e.mySlider.step,e.year>e.max.getFullYear()&&e.stopFilter(),e.yearChange.emit(e.year)},this.timeInterval,this))},Ds.prototype.stopFilter=function(){this.interval&&clearInterval(this.interval),this.interval=undefined,this.playIcon="play-circle"},Ds.prototype.handleSliderDateChange=function(e){this.date=new Date(e.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(e)},Ds.prototype.handleSliderYearChange=function(e){this.year=e.value,this.yearChange.emit(this.year)},Ds.prototype.handleSliderValue=function(){if(!0===this.options.current||!this.min){var e=new Date;this.date=this.getRoundedDate(e)}return this.type===Pn.YEAR?this.year:this.date===undefined?this.min.getTime():this.date.getTime()},Ds.prototype.handleSliderTooltip=function(){var e;switch(this.type){case Pn.DATE:e=this.date===undefined?this.min.toDateString():this.date.toDateString();break;case Pn.TIME:e=this.date===undefined?this.min.toTimeString():this.date.toTimeString();break;default:e=this.date===undefined?this.min.toUTCString():this.date.toUTCString()}return e},Ds.prototype.setupDateOutput=function(){this.style===Dn.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=this.startDate===undefined?new Date(this.min):this.startDate,this.endDate=this.endDate===undefined?new Date(this.max):this.endDate)},Ds.prototype.applyTypeChange=function(){switch(this.type){case Pn.DATE:this.startDate===undefined&&this.endDate===undefined||(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case Pn.TIME:if(this.style===Dn.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){var e=this.startDate.getHours(),t=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(e),this.startDate.setMinutes(t)}this.endDate.getDay()!==this.min.getDay()&&(e=this.endDate.getHours(),t=this.endDate.getMinutes(),this.endDate=this.min,this.endDate.setHours(e),this.endDate.setMinutes(t))}!this.isRange&&36e5<this.step&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}},Ds.prototype.getRangeMinDate=function(){return this.startDate===undefined?this.min:this.startDate},Ds.prototype.getRangeMaxDate=function(){return this.endDate===undefined?this.max:this.endDate},Ds.prototype.getRoundedDate=function(e,t){void 0===t&&(t=10);var r=6e4*t;return new Date(Math.round(e.getTime()/r)*r)},Ds.prototype.getStepDefinition=function(e){return ae.duration(e).asMilliseconds()},Ds.decorators=[{type:Le.Component,args:[{selector:"igo-time-filter-form",template:'<div *ngIf="style === \'calendar\' && type !==\'year\'">\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n    <mat-form-field>\r\n      <mat-datetimepicker-toggle [for]="datetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n      <mat-datetimepicker #datetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n      <input matInput autocomplete="false"\r\n        placeholder="{{\'igo.geo.timeFilter.date\' | translate}}"\r\n        [matDatetimepicker]="datetimePicker"\r\n        [(ngModel)]="date"\r\n        [min]="min"\r\n        [max]="max"\r\n        readonly="readonly"\r\n        (dateChange)="handleDateChange($event)">\r\n    </mat-form-field>\r\n\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="minDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #minDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}"\r\n          [matDatetimepicker]="minDatetimePicker"\r\n          [(ngModel)]="startDate"\r\n          [min]="min"\r\n          [max]="getRangeMaxDate()"\r\n          readonly="readonly"\r\n          (input)="startDate"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="maxDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #maxDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}"\r\n          [matDatetimepicker]="maxDatetimePicker"\r\n          [(ngModel)]="endDate"\r\n          [min]="getRangeMinDate()"\r\n          [max]="max"\r\n          readonly="readonly"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div *ngIf="style === \'calendar\' && type ===\'year\'">\r\n\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.date\' | translate}}" [(ngModel)]="year" (selectionChange)="handleYearChange($event)">\r\n                  <mat-option [value]="year" *ngFor="let year of listYears">{{year}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}" [(ngModel)]="startYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="startYear" *ngFor="let startYear of startListYears">{{startYear}}</mat-option>\r\n            </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n    <mat-form-field>\r\n        <mat-select placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}" [(ngModel)]="endYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="endYear" *ngFor="let endYear of endListYears">{{endYear}}</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n  <br>\r\n  <div *ngIf="!isRange && style === \'slider\' && type === \'year\'" class="igo-col igo-col-100 igo-col-100-m mat-typography">\r\n    <span>{{startYear}}</span>\r\n    <mat-slider\r\n        id="time-slider"\r\n        tickInterval="auto"\r\n        step="{{step}}"\r\n        [min]="startYear"\r\n        [max]="endYear"\r\n        [value]="handleSliderValue()"\r\n        [color]="color"\r\n        thumbLabel\r\n        (input)="handleSliderYearChange($event)"\r\n        (change)="handleSliderYearChange($event)"\r\n        [disabled]= "!options.enabled || !layer.visible">\r\n    </mat-slider>\r\n    <span>{{endYear}}</span>\r\n    <p *ngIf= "options.enabled" class="date-below">{{year}}</p>\r\n    <div #actions class="igo-layer-actions-container">\r\n      <mat-slide-toggle (change)="toggleFilterState()" tooltip-position="below" matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.filter.toggleFilterState\' | translate" [color]="color" [checked]="options.enabled"\r\n        [disabled]="!layer.visible">\r\n      </mat-slide-toggle>\r\n      <button [disabled]= "!options.enabled  || !layer.visible" mat-icon-button color="primary" (click)="playYear($event)">\r\n        <mat-icon svgIcon="{{playIcon}}"></mat-icon>\r\n       </button>\r\n      <button [disabled]="!options.enabled  || !layer.visible" mat-icon-button color="primary" (click)="resetFilter($event)">\r\n        <mat-icon svgIcon="{{resetIcon}}"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n<div *ngIf="style === \'slider\' && type !== \'year\'" class="igo-col igo-col-100 igo-col-100-m">\r\n  <mat-slider\r\n      id="time-slider"\r\n      tickInterval="auto"\r\n      step="{{step}}"\r\n      [min]="dateToNumber(min)"\r\n      [max]="dateToNumber(max)"\r\n      [value]="handleSliderValue()"\r\n      thumbLabel\r\n      (input)="handleSliderDateChange($event)"\r\n      (selectionChange)="handleSliderDateChange($event)">\r\n  </mat-slider>\r\n  <p class="date-below">{{handleSliderTooltip()}}</p>\r\n  <button mat-icon-button color="primary" (click)="playFilter($event)">\r\n   <mat-icon svgIcon="{{playIcon}}"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-layer-filters-container{padding-left:5px}mat-slider>>>div.mat-slider-thumb-label{width:32px;height:32px;margin:0 auto}mat-slider>>>span.mat-slider-thumb-label-text{font-size:10px}#time-slider{width:70%;margin:0 auto}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){#time-slider{width:60%;margin:0 auto}}.date-below{margin:0}mat-form-field{text-align:center}"]}]}],Ds.ctorParameters=function(){return[]},Ds.propDecorators={layer:[{type:Le.Input}],options:[{type:Le.Input}],currentValue:[{type:Le.Input}],change:[{type:Le.Output}],yearChange:[{type:Le.Output}],mySlider:[{type:Le.ViewChild,args:[Fe.MatSlider]}]},Ds);function Ds(){this.color="primary",this.listYears=[],this.startListYears=[],this.endListYears=[],this.playIcon="play-circle",this.resetIcon="replay",this.change=new Le.EventEmitter,this.yearChange=new Le.EventEmitter}var ks=(Object.defineProperty(js.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),js.prototype.handleYearChange=function(e){this.timeFilterService.filterByYear(this.datasource,e)},js.prototype.handleDateChange=function(e){this.timeFilterService.filterByDate(this.datasource,e)},js.prototype.toggleLegend=function(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)},js.prototype.toggleLegendOnClick=function(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)},js.prototype.setVisible=function(){this.layer.visible=!0},js.prototype.toggleFiltersCollapsed=function(){this.filtersCollapsed=!this.filtersCollapsed},js.decorators=[{type:Le.Component,args:[{selector:"igo-time-filter-item",template:'<mat-list-item *ngIf="header">\r\n  <mat-icon\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]="filters"\r\n    [collapsed]="filtersCollapsed"\r\n    (click)="toggleFiltersCollapsed()"\r\n    svgIcon="chevron-up" >\r\n  </mat-icon>\r\n  <h4 (click)="toggleLegendOnClick()" [ngStyle]="{\'cursor\': filtersCollapsed ? \'default\' : \'pointer\'}"  matLine>{{layer.title}}</h4>\r\n  \r\n  <button *ngIf="!layer.visible" mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.layer.showLayer\' | translate" color="warn" (click)="setVisible()">\r\n    <mat-icon svgIcon="alert-circle-outline"></mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n\r\n<div #filters class="igo-datasource-filters-container">\r\n  <div #legend class="igo-layer-legend-container">\r\n    <igo-layer-legend *ngIf="showLegend$ | async" [layer]="layer">\r\n    </igo-layer-legend>\r\n  </div>\r\n  <igo-time-filter-form\r\n    [layer]= "layer"\r\n    [options]="datasource.options.timeFilter"\r\n    [currentValue]="datasource.options.params.TIME"\r\n    (change)="handleDateChange($event)"\r\n    (yearChange)="handleYearChange($event)">\r\n  </igo-time-filter-form>\r\n</div>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}.igo-layer-legend-container{padding-left:1.125em;width:calc(100% - 18px)}"]}]}],js.ctorParameters=function(){return[{type:Bi}]},js.propDecorators={header:[{type:Le.Input}],layer:[{type:Le.Input}]},js);function js(e){this.timeFilterService=e,this.showLegend$=new Ce.BehaviorSubject(!1),this.filtersCollapsed=!1,this.header=!0}var Es=(Object.defineProperty(Rs.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Rs.decorators=[{type:Le.Component,args:[{selector:"igo-time-filter-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'time\'">\r\n    <igo-time-filter-item [header]="true" igoListItem [layer]="layer"></igo-time-filter-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush}]}],Rs.ctorParameters=function(){return[{type:Le.ChangeDetectorRef}]},Rs.propDecorators={layers:[{type:Le.Input}]},Rs);function Rs(e){this.cdRef=e,this._layers=[]}var $s=(As.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},As.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},As.decorators=[{type:Le.Directive,args:[{selector:"[igoTimeFilterListBinding]"}]}],As.ctorParameters=function(){return[{type:Es,decorators:[{type:Le.Self}]},{type:Xr}]},As);function As(e,t){this.mapService=t,this.component=e}var Gs=(Bs.prototype.wktToFeature=function(e,t,r){return(new xe).readFeature(e,{dataProjection:t,featureProjection:r})},Bs.prototype.extentToWkt=function(e,t,r){var o=be.transformExtent(t,r,e);return o=this.roundCoordinateArray(o,e,0),{wktPoly:"POLYGON((\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+"))",wktLine:"LINESTRING(\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+")",wktMultiPoints:"MULTIPOINT(\n        "+t[0]+" "+t[1]+",\n        "+t[0]+" "+t[3]+",\n        "+t[2]+" "+t[3]+",\n        "+t[2]+" "+t[1]+")"}},Bs.prototype.roundCoordinateArray=function(e,t,r){void 0===r&&(r=0);var o=be.get(t).getUnits();return-1!==["ft","m","us-ft"].indexOf(o)&&(e=this.roundArray(e,r)),e},Bs.prototype.roundArray=function(e,t){void 0===t&&(t=0);for(var r=0;r<e.length;)e[r]=e[r].toFixed(t),r++;return e},Bs.prototype.snrcToWkt=function(e,t){e=e.toLowerCase();var r=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],o=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]],n=!1,i=!1,a=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(e)?a=!0:/\d{2,3}[a-p]/gi.test(e)?i=!0:/\d{2,3}/gi.test(e)&&(n=!0),n?e+="a01":i&&(e+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(e)){var s=e.split(/(?=[a-p])/gi),l=s[0],u=s[1][0],c=s[1].split(u)[1],p=1;3===l.length&&(p=2);var d=l.substring(0,p),h=l.substring(p),g=0,f=0,m=0,y=0;r.forEach(function(e){-1!==e.indexOf(u)&&(f=r.indexOf(e),g=e.indexOf(u))}),o.forEach(function(e){-1!==e.indexOf(c)&&(y=o.indexOf(e),m=e.indexOf(c))});var v=0,b=0,S=0,w=0,I=8,F=4;i?(v=2*g,b=1*f,w=S=0,I=2,F=1):a&&(v=2*g,b=1*f,S=.5*m,w=.25*y,I=.5,F=.25);var O={ul:[{1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}}[d].to+v+S,{1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}}[h].to-b-w]};return O.lr=[O.ul[0]+I,O.ul[1]-F],O.ur=[O.ul[0],O.ul[1]-F],O.ll=[O.ul[0]+I,O.ul[1]],O.ul=be.transform([O.ul[0],O.ul[1]],"EPSG:4326",t),O.lr=be.transform([O.lr[0],O.lr[1]],"EPSG:4326",t),O.ur=be.transform([O.ur[0],O.ur[1]],"EPSG:4326",t),O.ll=be.transform([O.ll[0],O.ll[1]],"EPSG:4326",t),O.ul=this.roundCoordinateArray(O.ul,t,0),O.lr=this.roundCoordinateArray(O.lr,t,0),O.ur=this.roundCoordinateArray(O.ur,t,0),O.ll=this.roundCoordinateArray(O.ll,t,0),{wktPoly:"POLYGON(("+[O.ul.join(" "),O.ur.join(" "),O.lr.join(" "),O.ll.join(" "),O.ul.join(" ")].join(",")+"))",wktLine:"LINESTRING("+[O.ul.join(" "),O.ur.join(" "),O.lr.join(" "),O.ll.join(" "),O.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[O.ul.join(" "),O.ur.join(" "),O.lr.join(" "),O.ll.join(" ")].join(",")+")"}}},Bs.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Bs.ctorParameters=function(){return[]},Bs.ngInjectableDef=Le.defineInjectable({factory:function(){return new Bs},token:Bs,providedIn:"root"}),Bs);function Bs(){}var _s=(Object.defineProperty(qs.prototype,"activeFilters",{get:function(){return this.updateField(),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return!0===e.active})},enumerable:!0,configurable:!0}),qs.prototype.ngOnInit=function(){this.computeAllowedOperators()},qs.prototype.computeAllowedOperators=function(){var e=this.datasource.options.ogcFilters.allowedOperatorsType,t={};switch((e=e||qi.BasicAndSpatial).toLowerCase()){case"all":t=this.ogcFilterOperators;break;case"spatial":t={Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}};break;case"basicandspatial":t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}};break;case"basic":t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]}};break;case"basicnumeric":t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]}};break;default:t={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}}}this.ogcFilterOperators=t},qs.prototype.updateField=function(){var t=this;this.datasource.options.sourceFields&&(this.fields=this.datasource.options.sourceFields.filter(function(e){return e.excludeFromOgcFilters===undefined||!e.excludeFromOgcFilters}),this.fields.filter(function(e){return e.name===t.currentFilter.propertyName}).forEach(function(e){t.values=e.values!==undefined?e.values.sort():[]}))},qs.prototype.toggleFilterState=function(e,t,r){this.updateField(),e.checked?this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!0}):(this.removeOverlayByID(t.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!1})),this.refreshFilters()},qs.prototype.deleteFilter=function(t){var e=this.datasource.options.ogcFilters;e.interfaceOgcFilters=e.interfaceOgcFilters.filter(function(e){return e.filterid!==t.filterid}),this.removeOverlayByID(t.filterid),this.refreshFilters()},qs.prototype.changeNumericProperty=function(e,t,r){this.changeProperty(e,t,parseFloat(r)),this.refreshFilters()},qs.prototype.removeOverlayByID=function(e){var t=this.baseOverlayName+e;this.map.overlay.dataSource.ol.getFeatureById(t)&&this.map.overlay.dataSource.ol.removeFeature(this.map.overlay.dataSource.ol.getFeatureById(t))},qs.prototype.changeOperator=function(e){!1===this.ogcFilterOperators[e.operator].spatial&&this.removeOverlayByID(e.filterid),this.refreshFilters()},qs.prototype.changeProperty=function(t,r,o){this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=o}),this.refreshFilters()},qs.prototype.changeGeometry=function(r,o){var n=this,i=/\d{2,3}[a-l][0,1][0-9]/gi,a=/\d{2,3}[a-p]/gi,s=/\d{2,3}/gi,l=this.map.projection;this.removeOverlayByID(r.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===r.filterid}).forEach(function(e){var t;"snrc"===r.igoSpatialSelector?""===o&&""!==n.snrc?(t=n.wktService.snrcToWkt(n.snrc,n.map.projection).wktPoly,e.wkt_geometry=t):""!==o&&(s.test(o)||a.test(o)||i.test(o))&&(t=n.wktService.snrcToWkt(o,n.map.projection).wktPoly,e.wkt_geometry=t):"fixedExtent"===r.igoSpatialSelector&&(t=n.wktService.extentToWkt(l,n.map.viewController.getExtent(),l).wktPoly,e.wkt_geometry=t)}),this.refreshFilters()},qs.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filter-form",template:'<mat-list-item class="mat-typography">\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m">\r\n    <mat-select class="logical" [disabled]="!currentFilter.active" (selectionChange)="refreshFilters()" [(ngModel)]="currentFilter.parentLogical"\r\n      *ngIf="activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true">\r\n      <mat-option value="And">{{\'igo.geo.operators.And\' | translate}}</mat-option>\r\n      <mat-option value="Or">{{\'igo.geo.operators.Or\' | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <span *ngIf="fields && fields.length > 0 && fields[0].name !== \'\'">\r\n      <mat-select [disabled]="!currentFilter.active" *ngIf="[\'Contains\',\'Intersects\',\'Within\'].indexOf(currentFilter.operator) === -1"\r\n        [(ngModel)]="currentFilter.propertyName" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.sourceFields.selectField\' | translate"\r\n        (selectionChange)="updateField()">\r\n        <mat-option *ngFor="let field of fields" [value]="field.name">{{field.alias}}</mat-option>\r\n      </mat-select>\r\n    </span>\r\n    <span *ngIf="fields && fields.length === 1 && fields[0].name === \'\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput #fieldPerUser (keyup)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)"\r\n          (blur)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)" [(ngModel)]="currentFilter.propertyName">\r\n\r\n        <button mat-button *ngIf="currentFilter.propertyName" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.propertyName=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <mat-select \r\n    tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.selectOperator\' | translate"\r\n    [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of ogcFilterOperators | keyvalue" [value]="operator.key">{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n\r\n    \x3c!-- PropertyIsEqualTo --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsEqualTo\' || currentFilter.operator === \'PropertyIsNotEqualTo\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionequalto (keyup)="changeProperty(currentFilter,\'expression\',expressionequalto.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'expression\',expressionequalto.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsEqualTo  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsLike\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #pattern (keyup)="changeProperty(currentFilter,\'pattern\',pattern.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'pattern\',pattern.value)" [ngModel]="currentFilter.pattern">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.pattern" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.pattern=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsNull\'"></span>\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsGreaterThan\' || currentFilter.operator === \'PropertyIsGreaterThanOrEqualTo\' || currentFilter.operator === \'PropertyIsLessThan\' || currentFilter.operator === \'PropertyIsLessThanOrEqualTo\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionthan type="number" (keyup)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n    </span>\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsBetween --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsBetween\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #lowerBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)" [ngModel]="currentFilter.lowerBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.lowerBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.lowerBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #upperBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)" [ngModel]="currentFilter.upperBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.upperBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.upperBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsBetween  --\x3e\r\n\r\n\r\n    \x3c!-- During --\x3e\r\n    <span *ngIf="currentFilter.operator === \'During\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #begin (keyup)="changeProperty(currentFilter,\'begin\',begin.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'begin\',begin.value)" [ngModel]="currentFilter.begin">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values " [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.begin" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.begin=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #end (keyup)="changeProperty(currentFilter,\'end\',end.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'end\',end.value)" [ngModel]="currentFilter.end">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.end" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.end=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n\r\n    </span>\r\n    \x3c!-- During  --\x3e\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n\r\n\r\n  \x3c!-- PropertySpatial  --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select  \r\n      matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.selectOperator\' | translate" tooltip-position="below"\r\n      [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of ogcFilterOperators | keyvalue" [value]="operator.key">{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.igoSpatialSelector" (selectionChange)="changeGeometry(currentFilter,value)">\r\n      <mat-option *ngFor="let igoSpatialSelector of igoSpatialSelectors" [value]="igoSpatialSelector.type">{{(\'igo.geo.spatialSelector.\'+ igoSpatialSelector.type) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <button mat-button [disabled]="!currentFilter.active" *ngIf="currentFilter.igoSpatialSelector === \'fixedExtent\'"\r\n      matSuffix mat-icon-button aria-label="Clear" (click)="changeGeometry(currentFilter,value)" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.spatialSelector.btnSetExtent\' | translate">\r\n      <mat-icon svgIcon="arrow-expand-all"></mat-icon>\r\n    </button>\r\n\r\n\r\n    <mat-form-field *ngIf="currentFilter.igoSpatialSelector === \'snrc\'" [floatLabel]="floatLabel">\r\n      <input [placeholder]="\'igo.geo.filter.placeholderSnrc\' | translate" matInput #htmlSnrc (keyup)="changeGeometry(currentFilter,htmlSnrc.value)" (blur)="changeGeometry(currentFilter,htmlSnrc.value)"\r\n        [(ngModel)]="snrc">\r\n      <button mat-button *ngIf="snrc" matSuffix mat-icon-button aria-label="Clear" (click)="snrc=\'\'">\r\n        <mat-icon svgIcon="close"></mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n  </div>\r\n  \x3c!-- PropertySpatial  --\x3e\r\n\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <div class="igo-layer-button-group">\r\n      <mat-slide-toggle class="example-margin" (change)="toggleFilterState($event,currentFilter,\'active\')" tooltip-position="below"\r\n        matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.toggleFilterState\' | translate" [color]="color" [checked]="currentFilter.active"\r\n        [disabled]="disabled">\r\n      </mat-slide-toggle>\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.removeFilter\' | translate"\r\n        color="warn" (click)="deleteFilter(currentFilter)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <mat-divider></mat-divider>\r\n</mat-list-item>\r\n',styles:[":host{overflow:hidden}.mat-list-item{height:auto}.mat-form-field{width:100%}.mat-list-item>>>div.mat-list-item-content{display:inline-table;width:100%}.logical{font-weight:700}input,mat-select{margin-top:10px;text-align:center}.igo-layer-actions-container{width:100%;display:inline-block}.igo-layer-actions-container>div{text-align:center}.igo-layer-button-group{float:center;padding:0 3px}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){.igo-layer-button-group{float:none}}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],qs.ctorParameters=function(){return[{type:Gs}]},qs.propDecorators={refreshFilters:[{type:Le.Input}],datasource:[{type:Le.Input}],map:[{type:Le.Input}],currentFilter:[{type:Le.Input}],floatLabel:[{type:Le.Input}]},qs);function qs(e){this.wktService=e,this.value="",this.color="primary",this.snrc="",this.baseOverlayName="ogcFilterOverlay_",this.floatLabel="never",this.ogcFilterOperators=(new dt).operators,this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}var Ns=(Object.defineProperty(Vs.prototype,"refreshFunc",{get:function(){return this.refreshFilters},enumerable:!0,configurable:!0}),Object.defineProperty(Vs.prototype,"advancedOgcFilters",{get:function(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters},enumerable:!0,configurable:!0}),Vs.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filterable-form",template:'<igo-list *ngIf="!advancedOgcFilters" [navigation]="false" [selection]="true">\r\n  <igo-ogc-filter-toggle-button igoListItem [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc">\r\n  </igo-ogc-filter-toggle-button>\r\n</igo-list>\r\n\r\n<igo-list *ngIf="advancedOgcFilters && datasource.options.ogcFilters.editable " [navigation]="false" [selection]="true">\r\n  <ng-template ngFor let-currentFilter [ngForOf]="datasource.options.ogcFilters.interfaceOgcFilters">\r\n    <igo-ogc-filter-form igoListItem [color]="color" [currentFilter]="currentFilter" [datasource]="datasource"\r\n      [map]="map" [refreshFilters]="refreshFunc">\r\n    </igo-ogc-filter-form>\r\n  </ng-template>\r\n</igo-list>\r\n'}]}],Vs.ctorParameters=function(){return[]},Vs.propDecorators={datasource:[{type:Le.Input}],map:[{type:Le.Input}],refreshFilters:[{type:Le.Input}]},Vs);function Vs(){this.color="primary"}var Us=(Object.defineProperty(Ws.prototype,"refreshFunc",{get:function(){return this.refreshFilters.bind(this)},enumerable:!0,configurable:!0}),Object.defineProperty(Ws.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(Ws.prototype,"downloadable",{get:function(){return this.datasource.options.download},enumerable:!0,configurable:!0}),Ws.prototype.ngOnInit=function(){var e=this.datasource.options.ogcFilters;switch(e.pushButtons&&0<e.pushButtons.bundles.length&&(e.advancedOgcFilters===undefined&&(e.advancedOgcFilters=!1),this.hasPushButton=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}e&&(e.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(e.interfaceOgcFilters)),1<=e.interfaceOgcFilters.filter(function(e){return e.wkt_geometry}).length&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!e.editable&&e.editable)},Ws.prototype.addFilterToSequence=function(){this.filtersCollapsed=!1;var e,t=this.datasource.options.ogcFilters.interfaceOgcFilters||[],r=0===t.length?0:t[t.length-1].level,o="",n=this.datasource.options.sourceFields.filter(function(e){return!e.excludeFromOgcFilters});0<n.length&&(o=n[0].name===undefined?"":n[0].name);var i=this.datasource.options;i.fieldNameGeometry?e=i.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(e=this.datasource.options.paramsWFS.fieldNameGeometry);var a=0===t.length;t.push((new dt).addInterfaceFilter({propertyName:o,operator:"PropertyIsEqualTo",active:a,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},e,r,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=t},Ws.prototype.openDownload=function(){this.downloadService.open(this.layer)},Ws.prototype.refreshFilters=function(e){!0===e&&(this.lastRunOgcFilter=undefined);var t=this.datasource.options.ogcFilters,r=new dt,o=t.interfaceOgcFilters.filter(function(e){return!0===e.active});if(0===o.length&&(t.filters=undefined,t.filtered=!1),1<o.length&&(o[0].parentLogical=o[1].parentLogical),0===o.filter(function(e){return-1!==["Contains","Intersects","Within"].indexOf(e.operator)}).length?this.hasActiveSpatialFilter=!1:this.hasActiveSpatialFilter=!0,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(o)){if("wfs"===this.layer.dataSource.options.type)(n=this.layer.dataSource.options.ogcFilters).filters=r.rebuiltIgoOgcFilterObjectFromSequence(o),this.layer.dataSource.ol.clear();else if("wms"===this.layer.dataSource.options.type&&t.enabled){var n,i="";1<=o.length&&((n=this.layer.dataSource.options.ogcFilters).filters=r.rebuiltIgoOgcFilterObjectFromSequence(o),i=r.buildFilter(n.filters,undefined,undefined,this.layer.dataSource.options.fieldNameGeometry)),this.ogcFilterService.filterByOgc(this.datasource,i),this.datasource.options.ogcFilters.filtered=0!==o.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(o))}},Ws.prototype.setVisible=function(){this.layer.visible=!0},Ws.prototype.isAdvancedOgcFilters=function(){return this.datasource.options.ogcFilters.advancedOgcFilters},Ws.prototype.addFilterDisabled=function(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length},Ws.prototype.changeOgcFiltersAdvancedOgcFilters=function(e){this.datasource.options.ogcFilters.advancedOgcFilters=e},Ws.prototype.changeOgcFilterType=function(e){this.changeOgcFiltersAdvancedOgcFilters(e.checked),e.checked&&this.refreshFilters(!0)},Ws.prototype.toggleLegend=function(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)},Ws.prototype.toggleLegendOnClick=function(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)},Ws.prototype.toggleFiltersCollapsed=function(){this.filtersCollapsed=!this.filtersCollapsed},Ws.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filterable-item",template:'<mat-list-item>\r\n\r\n  <mat-icon \r\n    *ngIf="header" \r\n    class="igo-chevron" \r\n    mat-list-avatar \r\n    igoCollapse [target]="ogcFilters"\r\n    [collapsed]="filtersCollapsed"\r\n    (click)="toggleFiltersCollapsed()" \r\n    svgIcon="chevron-up">\r\n  </mat-icon>\r\n  <h4 (click)="toggleLegendOnClick()" *ngIf="header" [ngStyle]="{\'cursor\': filtersCollapsed ? \'default\' : \'pointer\'}" matLine [matTooltip]="layer.title" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n  <h4 *ngIf="!header" matLine></h4>\r\n\r\n  <span *ngIf="downloadable && header">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.download.action\' | translate"\r\n      [color]="color" (click)="openDownload()">\r\n      <mat-icon svgIcon="download"></mat-icon>\r\n    </button>\r\n  </span>\r\n  <button *ngIf="isAdvancedOgcFilters() && filtersAreEditable" [disabled]="addFilterDisabled()" mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.filter.addFilter\' | translate" [color]="color" (click)="addFilterToSequence()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n  <button *ngIf="!layer.visible && header" mat-icon-button tooltip-position="below"\r\n    matTooltipShowDelay="500" [matTooltip]="\'igo.geo.layer.showLayer\' | translate" color="warn" (click)="setVisible()">\r\n    <mat-icon svgIcon="alert-circle-outline"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #ogcFilters class="igo-datasource-filters-container">\r\n    <div *ngIf="header" #legend class="igo-layer-legend-container">\r\n      <igo-layer-legend *ngIf="showLegend$ | async" [layer]="layer">\r\n      </igo-layer-legend>\r\n    </div>\r\n  <igo-ogc-filterable-form [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc">\r\n  </igo-ogc-filterable-form>\r\n\r\n  <section class="mat-typography">\r\n  <mat-checkbox labelPosition=\'before\' *ngIf="hasPushButton && filtersAreEditable" (change)="changeOgcFilterType($event)"\r\n    [(ngModel)]="datasource.options.ogcFilters.advancedOgcFilters">\r\n    {{\'igo.geo.filter.advancedOgcFilters\' | translate}}\r\n  </mat-checkbox>\r\n</section>\r\n</div>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}.mat-list-item{height:auto}.igo-layer-legend-container{padding-left:1.125em;width:calc(100% - 18px)}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],Ws.ctorParameters=function(){return[{type:Ni},{type:Hi}]},Ws.propDecorators={layer:[{type:Le.Input}],map:[{type:Le.Input}],header:[{type:Le.Input}]},Ws);function Ws(e,t){this.ogcFilterService=e,this.downloadService=t,this.color="primary",this.defaultLogicalParent="And",this.hasActiveSpatialFilter=!1,this.filtersAreEditable=!0,this.filtersCollapsed=!0,this.hasPushButton=!1,this.showLegend$=new Ce.BehaviorSubject(!1),this.header=!0}var zs=(Ks.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filterable-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'ogc\'">\r\n    <igo-ogc-filterable-item igoListItem [header]="true" [layer]="layer" \r\n    [map]="layer.map" ></igo-ogc-filterable-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush}]}],Ks.ctorParameters=function(){return[]},Ks.propDecorators={layers:[{type:Le.Input}],map:[{type:Le.Input}]},Ks);function Ks(){}var Hs=(Ys.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},Ys.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Ys.decorators=[{type:Le.Directive,args:[{selector:"[igoOgcFilterableListBinding]"}]}],Ys.ctorParameters=function(){return[{type:zs,decorators:[{type:Le.Self}]},{type:Xr}]},Ys);function Ys(e,t){this.mapService=t,this.component=e}var Zs=(Qs.prototype.ngOnInit=function(){this.options=this.layer.dataSource.options},Qs.prototype.toggleOgcFilter=function(){this.ogcFilterCollapse=!this.ogcFilterCollapse},Qs.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filter-button",template:'<button *ngIf="header && options.ogcFilters && options.ogcFilters.enabled"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.filterBy\' | translate"\r\n  [color]="color"\r\n  (click)="toggleOgcFilter()">\r\n  <mat-icon svgIcon="filter"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class="igo-layer-actions-container"\r\n*ngIf="options.ogcFilters && options.ogcFilters.enabled">\r\n  <igo-ogc-filterable-item\r\n    *ngIf="ogcFilterCollapse && options.ogcFilters.enabled"\r\n    igoListItem\r\n    [header]="false"\r\n    [map]="layer.map"\r\n    [layer]="layer">\r\n  </igo-ogc-filterable-item>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Qs.ctorParameters=function(){return[]},Qs.propDecorators={layer:[{type:Le.Input}],map:[{type:Le.Input}],color:[{type:Le.Input}],header:[{type:Le.Input}]},Qs);function Qs(){this.color="primary",this.ogcFilterCollapse=!1}var Js=(Xs.prototype.getPushButtonsGroups=function(){return this.datasource.options.ogcFilters.pushButtons.groups},Xs.prototype.ngOnInit=function(){this.datasource.options.ogcFilters&&this.datasource.options.ogcFilters.pushButtons&&(this.currentPushButtonGroup=this.datasource.options.ogcFilters.pushButtons.groups.find(function(e){return e.enabled})||this.datasource.options.ogcFilters.pushButtons.groups[0]),this.applyFilters()},Xs.prototype.getToolTip=function(e){var t;return e.tooltip&&(t=Array.isArray(e.tooltip)?e.tooltip.join("\n"):e.tooltip),t||""},Xs.prototype.getButtonColor=function(e){var t;return e.color&&(t={"background-color":e.enabled?"rgba("+e.color+")":"rgba(255,255,255,0)"}),t},Xs.prototype.bundleIsVertical=function(e){return!!e.vertical&&e.vertical},Xs.prototype.onChangeGroup=function(){var t=this;this.getPushButtonsGroups().map(function(e){return e.enabled=!1}),this.getPushButtonsGroups().find(function(e){return e===t.currentPushButtonGroup}).enabled=!0,this.applyFilters()},Xs.prototype.applyFilters=function(e){e&&(e.enabled=!e.enabled);var t="",r=[];this.currentPushButtonGroup.computedButtons.map(function(e){var t=[];e.buttons.filter(function(e){return!0===e.enabled}).forEach(function(e){return t.push(e.filters)}),1<=t.length&&(1===t.length?r.push(t[0]):r.push({logical:e.logical,filters:t}))}),1<=r.length&&(t=this.ogcFilterWriter.buildFilter(1===r.length?r[0]:{logical:"And",filters:r})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.clear()},Xs.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filter-toggle-button",template:'<div *ngIf="getPushButtonsGroups().length > 1">\r\n    <mat-form-field>\r\n      <mat-select tooltip-position="below" matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.legend.selectStyle\' | translate" [(ngModel)]="currentPushButtonGroup"\r\n        (selectionChange)="onChangeGroup()">\r\n        <mat-option *ngFor="let pbg of getPushButtonsGroups()" [value]="pbg">{{pbg.title}}</mat-option>\r\n      </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n<ng-container *ngFor="let bundle of currentPushButtonGroup.computedButtons">\r\n        <mat-button-toggle-group \r\n        class="mat-typography"\r\n        appearance="legacy" vertical={{bundleIsVertical(bundle)}} multiple="true">\r\n            <mat-button-toggle [ngStyle]="getButtonColor(ogcPushButton)" [checked]="ogcPushButton.enabled"\r\n                (change)="applyFilters(ogcPushButton)" tooltip-position="below" matTooltipShowDelay="500"\r\n                [matTooltip]="getToolTip(ogcPushButton)" matTooltipClass="material-tooltip" \r\n                *ngFor="let ogcPushButton of bundle.buttons" [value]="ogcPushButton">{{ogcPushButton.title}}\r\n            </mat-button-toggle>\r\n        </mat-button-toggle-group>\r\n</ng-container>\r\n',styles:[".mat-button-toggle-group{margin:5px;flex-wrap:wrap}.mat-button-toggle{display:-webkit-inline-box;display:inline-flex}::ng-deep .material-tooltip{white-space:pre-line}"]}]}],Xs.ctorParameters=function(){return[{type:Ni}]},Xs.propDecorators={refreshFilters:[{type:Le.Input}],datasource:[{type:Le.Input}],map:[{type:Le.Input}]},Xs);function Xs(e){this.ogcFilterService=e,this.color="primary",this.ogcFilterWriter=new dt}var el=(Object.defineProperty(tl.prototype,"store",{get:function(){return this._store},set:function(e){this._store=e},enumerable:!0,configurable:!0}),tl.prototype.ngOnInit=function(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)},tl.prototype.onTypeChange=function(e){0===this.selectedTypeIndex.value&&(this.type=Ui.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)},tl.prototype.onQueryTypeChange=function(e){this.eventQueryType.emit(this.selectedQueryType)},tl.prototype.onZoneChange=function(e){this.zoneChange.emit(e)},tl.prototype.onDrawTypeChange=function(e){this.activeDrawType=e,this.eventType.emit(this.activeDrawType)},tl.decorators=[{type:Le.Component,args:[{selector:"igo-spatial-filter-type",template:'<mat-tab-group\r\n  [selectedIndex]="selectedTypeIndex.value"\r\n  (selectedIndexChange)="selectedTypeIndex.setValue($event)"\r\n  (selectedTabChange)="onTypeChange($event)">\r\n\r\n  <mat-tab [label]="\'igo.geo.spatialFilter.predefined\' |translate">\r\n    <mat-form-field>\r\n      <mat-label>{{\'igo.geo.spatialFilter.searchLabel\' | translate}}</mat-label>\r\n      <mat-select (selectionChange)="onQueryTypeChange($event)" [(value)]="selectedQueryType">\r\n        <mat-option *ngFor="let queryType of queryType" [value]="queryType">\r\n          {{(\'igo.geo.terrapi.\' + queryType) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n    <igo-spatial-filter-list\r\n      [store]="store"\r\n      [queryType]="selectedQueryType"\r\n      [selectedZone]="zone"\r\n      (zoneChange)="onZoneChange($event)">\r\n    </igo-spatial-filter-list>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]="\'igo.geo.spatialFilter.draw\' |translate">\r\n    <div class="spatial-type-toggle">\r\n      <mat-button-toggle-group\r\n        [value]="activeDrawType"\r\n        (change)="onDrawTypeChange($event.value)">\r\n        <mat-button-toggle [value]="spatialType.Polygon" [matTooltip]="\'igo.geo.spatialFilter.drawPolygon\' |translate">\r\n            <mat-icon svgIcon="pentagon-outline"></mat-icon>\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]="spatialType.Point" [matTooltip]="\'igo.geo.spatialFilter.drawCircle\' |translate">\r\n            <mat-icon svgIcon="record-circle-outline"></mat-icon>\r\n        </mat-button-toggle>\r\n      </mat-button-toggle-group>\r\n    </div>\r\n  </mat-tab>\r\n\r\n</mat-tab-group>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".mat-form-field{padding:5px;width:95%;margin-left:2px}.mat-tab-group ::ng-deep .mat-tab-body-content{overflow:hidden}.mat-tab-group ::ng-deep .mat-tab-label{padding:10px}.mat-tab-group ::ng-deep .mat-tab-body-wrapper{margin-top:5px}.spatial-type-toggle{padding:10px;text-align:center}.spatial-type-toggle mat-button-toggle-group,.spatial-type-toggle mat-button-toggle-group mat-button-toggle{width:50%}"]}]}],tl.ctorParameters=function(){return[]},tl.propDecorators={store:[{type:Le.Input}],selectedQueryType:[{type:Le.Input}],zone:[{type:Le.Input}],eventType:[{type:Le.Output}],eventQueryType:[{type:Le.Output}],zoneChange:[{type:Le.Output}]},tl);function tl(){this.queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"],this.selectedTypeIndex=new ye.FormControl(0),this.spatialType=Ui,this.activeDrawType=this.spatialType.Polygon,this.eventType=new Le.EventEmitter,this.eventQueryType=new Le.EventEmitter,this.zoneChange=new Le.EventEmitter}var rl=(Object.defineProperty(ol.prototype,"store",{get:function(){return this._store},set:function(e){this._store=e},enumerable:!0,configurable:!0}),Object.defineProperty(ol.prototype,"queryType",{get:function(){return this._queryType},set:function(e){this.formControl.setValue(""),this._queryType=e},enumerable:!0,configurable:!0}),ol.prototype.ngOnInit=function(){var e=this;this.formValueChanges$$=this.formControl.valueChanges.subscribe(function(r){r.length&&e.store.view.filter(function(e){var t=r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})})},ol.prototype.ngOnDestroy=function(){this.formValueChanges$$.unsubscribe()},ol.prototype.displayFn=function(e){return e?e.properties.nom:undefined},ol.prototype.onZoneChange=function(e){var t=this;e&&this.queryType&&this.spatialFilterService.loadItemById(e,this.queryType).subscribe(function(e){t.selectedZone=e,t.zoneChange.emit(e)})},ol.decorators=[{type:Le.Component,args:[{selector:"igo-spatial-filter-list",template:'<form class="form-list">\r\n    <mat-form-field>\r\n        <input #input type="text" placeholder="{{\'igo.geo.spatialFilter.listLabel\' |translate}}" matInput\r\n        [formControl]="formControl" [matAutocomplete]="auto">\r\n        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onZoneChange($event.option.value)"\r\n        [displayWith]="displayFn">\r\n            <mat-option *ngFor="let entities of this.store.view.all$() | async" [value]="entities">\r\n                {{entities.properties.nom}}\r\n            </mat-option>\r\n        </mat-autocomplete>\r\n    </mat-form-field>\r\n<form>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".mat-form-field{padding:5px;width:95%;margin-left:2px}"]}]}],ol.ctorParameters=function(){return[{type:zi}]},ol.propDecorators={store:[{type:Le.Input}],queryType:[{type:Le.Input}],selectedZone:[{type:Le.Input}],zoneChange:[{type:Le.Output}]},ol);function ol(e){this.spatialFilterService=e,this.formControl=new ye.FormControl,this.zoneChange=new Le.EventEmitter}var nl=(Object.defineProperty(il.prototype,"type",{get:function(){return this._type},set:function(e){var o=this;this._type=e;var t=this.geometryTypes.findIndex(function(e){return e===o.type});this.geometryType=this.geometryTypes[t],this.formControl.reset(),this.radius=undefined,this.drawGuide$.next(null),this.drawStyle$.next(undefined),this.type===Ui.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===Ui.Point?(this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=function(e,t){var r=be.transform(e.getGeometry().getCoordinates(),o.map.projection,"EPSG:4326");return new Se.Style({image:new Se.Circle({radius:o.radius/Math.cos(Math.PI/180*r[1])/t,stroke:new Se.Stroke({width:2,color:"rgba(0, 153, 255)"}),fill:new Se.Fill({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle)):(this.radius=undefined,this.PolyStyle=function(e,t){return new Se.Style({stroke:new Se.Stroke({width:2,color:"rgba(0, 153, 255)"}),fill:new Se.Fill({color:"rgba(0, 153, 255, 0.2)"})})},this.overlayStyle=this.PolyStyle),this.overlayStyle$.next(this.overlayStyle)},enumerable:!0,configurable:!0}),Object.defineProperty(il.prototype,"store",{get:function(){return this._store},set:function(e){var t=this;this._store=e,this._store.entities$.subscribe(function(){t.cdRef.detectChanges()})},enumerable:!0,configurable:!0}),Object.defineProperty(il.prototype,"measureUnits",{get:function(){return[ha.Meters]},enumerable:!0,configurable:!0}),il.prototype.ngOnInit=function(){var s=this;this.spatialFilterService.loadThematicsList().subscribe(function(e){var t,r;try{for(var o=We(e),n=o.next();!n.done;n=o.next()){var i=n.value;s.childrens.push(i),s.childrens.sort(function(e,t){return e.name.localeCompare(t.name)})}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}s.childrens.forEach(function(e){if(e.group&&-1===s.groups.indexOf(e.group)){s.groups.push(e.group);var t={name:e.group,children:[]};s.thematics.push(t)}e.group||(t={name:e.name,children:[],source:e.source},s.thematics.push(t)),s.thematics.sort(function(e,t){return e.name.localeCompare(t.name)})}),s.thematics.forEach(function(e){var t,r;try{for(var o=We(s.childrens),n=o.next();!n.done;n=o.next()){var i=n.value;i.group===e.name&&e.children.push(i)}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:undefined),this.value$$=this.formControl.valueChanges.subscribe(function(e){s.value$.next(e||undefined)}),this.value$.subscribe(function(){s.getRadius(),s.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(function(){s.getRadius(),s.cdRef.detectChanges()})},il.prototype.ngOnDestroy=function(){this.value$$.unsubscribe(),this.cdRef.detach()},il.prototype.onItemTypeChange=function(e){this.selectedItemType=e.value,this.itemTypeChange.emit(this.selectedItemType)},il.prototype.onMeasureUnitChange=function(e){this.measureUnit=e},il.prototype.isPredefined=function(){return this.type===Ui.Predefined},il.prototype.isPolygon=function(){return this.type===Ui.Polygon},il.prototype.isPoint=function(){return this.type===Ui.Point},il.prototype.hasChild=function(e,t){return!!t.children&&t.children.length},il.prototype.onToggleClick=function(e){this.treeControl.isExpanded(e)?this.treeControl.collapse(e):this.treeControl.expand(e)},il.prototype.isAllSelected=function(e){var t,r=this,o=0;return e?(t=e.children.length,e.children.forEach(function(t){r.selectedThematics.selected.find(function(e){return e===t})&&o++})):(t=this.selectedThematics.selected.length,this.thematics.forEach(function(e){-1===r.groups.indexOf(e.name)&&o++}),this.childrens.forEach(function(t){r.thematics.find(function(e){return e.source===t.source})||o++})),1<=o&&t===o},il.prototype.hasChildrenSelected=function(e){var r=this,o=!1;return e.children.forEach(function(t){r.selectedThematics.selected.find(function(e){return e.source===t.source})&&(o=!0)}),o},il.prototype.masterToggle=function(){var e,t,r=this;this.isAllSelected()?this.selectedThematics.clear():this.selectAll();var o=[];try{for(var n=We(this.selectedThematics.selected),i=n.next();!i.done;i=n.next()){var a=i.value;o.push(a)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.isAllSelected()?this.thematics.forEach(function(e){r.hasChild(0,e)&&r.treeControl.expand(e)}):this.thematics.forEach(function(e){r.hasChild(0,e)&&r.treeControl.collapse(e)}),this.thematicChange.emit(o)},il.prototype.selectAll=function(e){var r=this;e?this.hasChild(0,e)&&e.children.forEach(function(e){return r.selectedThematics.select(e)}):(this.thematics.forEach(function(e){-1===r.groups.indexOf(e.name)&&r.selectedThematics.select(e)}),this.childrens.forEach(function(t){r.selectedThematics.selected.find(function(e){return e.source===t.source})||r.selectedThematics.select(t)}))},il.prototype.childrensToggle=function(e){var t,r,o=this;this.isAllSelected(e)?e.children.forEach(function(e){return o.selectedThematics.deselect(e)}):this.selectAll(e);var n=[];try{for(var i=We(this.selectedThematics.selected),a=i.next();!a.done;a=i.next()){var s=a.value;n.push(s)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}this.treeControl.expand(e),this.thematicChange.emit(n)},il.prototype.onToggleChange=function(t){var e,r,o=this,n=!1;this.selectedThematics.selected.find(function(e){return e.source===t.source})!==undefined&&(n=!0),this.childrens.forEach(function(e){e===t&&!1===n&&o.selectedThematics.select(e),e===t&&!0===n&&o.selectedThematics.deselect(e)}),this.thematics.forEach(function(e){e===t&&!1===n&&o.selectedThematics.select(e),e===t&&!0===n&&o.selectedThematics.deselect(e)});var i=[];try{for(var a=We(this.selectedThematics.selected),s=a.next();!s.done;s=a.next()){var l=s.value;i.push(l)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}this.thematicChange.emit(i)},il.prototype.onDrawControlChange=function(){this.drawControlIsActive=!this.drawControlIsActive},il.prototype.onfreehandControlChange=function(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive)},il.prototype.toggleSearchButton=function(){(this.isPolygon()||this.isPoint())&&(this.drawZone=this.formControl.value,this.drawZone.meta={id:undefined,title:"Zone"},this.drawZone.properties={nom:"Zone"},this.drawZoneEvent.emit(this.drawZone)),this.radiusEvent.emit(this.radius),this.toggleSearch.emit()},il.prototype.clearButton=function(){this.loading=!0,this.map.removeLayers(this.layers),this.loading=!1,this.store&&this.store.clear(),this.clearButtonEvent.emit([])},il.prototype.clearSearch=function(){this.selectedThematics.clear(),this.thematicChange.emit([]),this.clearSearchEvent.emit()},il.prototype.disableSearchButton=function(){if(this.type===Ui.Predefined){if(this.selectedItemType===Wi.Address&&this.queryType!==undefined&&this.zone!==undefined)return this.loading;if(this.selectedItemType===Wi.Thematics&&this.queryType!==undefined&&this.zone!==undefined&&0<this.selectedThematics.selected.length)return this.loading}if(this.type===Ui.Polygon||this.type===Ui.Point){if(this.selectedItemType===Wi.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===Wi.Thematics&&0<this.selectedThematics.selected.length&&null!==this.formControl.value)return this.loading}return!0},il.prototype.getRadius=function(){var e;if(e=null!==this.formControl.value?this.formControl.value.radius:undefined,this.type===Ui.Point){if(this.freehandDrawIsActive){if(1e4<=this.radiusFormControl.value||this.radiusFormControl.value<0)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),this.radius=1e3,this.radiusFormControl.setValue(this.radius),void this.drawGuide$.next(this.radius);if(1e4<=e)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),void this.formControl.reset();e&&(e!==this.radiusFormControl.value&&this.radiusFormControl.setValue(e),this.formControl.value.radius=undefined)}else if(1e4<=this.radiusFormControl.value||this.radiusFormControl.value<0)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),this.radius=1e3,this.radiusFormControl.setValue(this.radius),void this.drawGuide$.next(this.radius);this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}},il.decorators=[{type:Le.Component,args:[{selector:"igo-spatial-filter-item",template:'<igo-geometry-form-field-input\r\n  [formControl]="formControl"\r\n  [map]="map"\r\n  [geometryType]="geometryType"\r\n  [drawGuide]="drawGuide$ | async"\r\n  [measure]="measure"\r\n  [drawControlIsActive]="drawControlIsActive"\r\n  [freehandDrawIsActive]="freehandDrawIsActive"\r\n  [drawStyle]="drawStyle$ | async"\r\n  [overlayStyle]="overlayStyle$ | async"\r\n  [radius]="radius">\r\n</igo-geometry-form-field-input>\r\n\r\n<div class="header">\r\n    <mat-slide-toggle *ngIf="!isPredefined()"\r\n      [checked]="drawControlIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onDrawControlChange()">\r\n      {{\'igo.geo.spatialFilter.drawControl\' | translate}}\r\n    </mat-slide-toggle>\r\n    <mat-slide-toggle *ngIf="!isPredefined()"\r\n      [checked]="freehandDrawIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onfreehandControlChange()">\r\n      {{\'igo.geo.spatialFilter.freehandControl\' | translate}}\r\n    </mat-slide-toggle>\r\n</div>\r\n\r\n  <div class="radius-unit" *ngIf="isPoint()">\r\n    <form class="radius-form">\r\n      <mat-form-field class="radius">\r\n        <input type="number" matInput placeholder="{{\'igo.geo.spatialFilter.radius\' | translate}}" [formControl]="radiusFormControl"\r\n        [value]="1000" (input)="getRadius()" [readonly]="this.freehandDrawIsActive && this.formControl.value === null">\r\n        <label class="unit-field">\r\n          {{(\'igo.geo.measure.\' + measureUnit) | translate}}\r\n        </label>\r\n      </mat-form-field>\r\n    </form>\r\n  </div>\r\n\r\n  <mat-label class="title mat-typography">{{\'igo.geo.spatialFilter.search\' | translate}} : </mat-label>\r\n  <mat-radio-group [value]="selectedItemType">\r\n      <mat-radio-button *ngFor="let item of itemType"\r\n        [value]="item"\r\n        (change)="onItemTypeChange($event)">\r\n        {{\'igo.geo.spatialFilter.\' + item | translate}}\r\n      </mat-radio-button>\r\n  </mat-radio-group>\r\n\r\n<div class="thematics" *ngIf="selectedItemType===\'Thematics\'">\r\n  <mat-table>\r\n      \x3c!-- Name Column --\x3e\r\n      <ng-container matColumnDef="name">\r\n        <mat-header-cell *matHeaderCellDef class="thematics-header">{{\'igo.geo.spatialFilter.Thematics\' | translate}}</mat-header-cell>\r\n      </ng-container>\r\n\r\n      \x3c!-- Select Column --\x3e\r\n      <ng-container matColumnDef="select">\r\n        <mat-header-cell *matHeaderCellDef class="checks-header">\r\n          <mat-checkbox (change)="$event ? masterToggle() : null"\r\n                        [checked]="isAllSelected()"\r\n                        [indeterminate]="selectedThematics.hasValue() && !isAllSelected()">\r\n          </mat-checkbox>\r\n        </mat-header-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\r\n    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\r\n\r\n  </mat-table>\r\n\r\n  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">\r\n    \x3c!-- This is the tree node template for leaf nodes --\x3e\r\n    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>\r\n      <li class="mat-tree-node">\r\n        \x3c!-- use a disabled button to provide padding for tree leaf --\x3e\r\n        <button mat-icon-button disabled></button>\r\n        {{node.name}}\r\n        <mat-checkbox class="tree-check" (click)="$event.stopPropagation()"\r\n                      (change)="$event ? onToggleChange(node) : null"\r\n                      [checked]="selectedThematics.isSelected(node)">\r\n        </mat-checkbox>\r\n      </li>\r\n    </mat-tree-node>\r\n\r\n    \x3c!-- This is the tree node template for expandable nodes --\x3e\r\n    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">\r\n        <div class="mat-tree-node">\r\n          <button mat-icon-button\r\n            (click)="onToggleClick(node)">\r\n            <mat-icon [svgIcon]="treeControl.isExpanded(node) ? \'chevron-down\' : \'chevron-right\'"></mat-icon>\r\n          </button>\r\n          {{node.name}}\r\n          <mat-checkbox class="tree-check-2" (change)="$event ? childrensToggle(node) : null"\r\n                        [checked]="isAllSelected(node)"\r\n                        [indeterminate]="hasChildrenSelected(node) && !isAllSelected(node)">\r\n          </mat-checkbox>\r\n        </div>\r\n        <ul class="tree-ul" [class.example-tree-invisible]="!treeControl.isExpanded(node)">\r\n          <ng-container matTreeNodeOutlet></ng-container>\r\n        </ul>\r\n    </mat-nested-tree-node>\r\n\r\n  </mat-tree>\r\n</div>\r\n\r\n<div class="buttons">\r\n\r\n    <button *ngIf="isPredefined()" mat-raised-button class="clear-search-button" [disabled]="!queryType && !zone"\r\n      (click)="clearSearch()">\r\n        {{\'igo.geo.spatialFilter.clearSearch\' | translate}}\r\n    </button>\r\n\r\n  <button *ngIf="isPolygon() || isPoint()" mat-raised-button class="clear-form-button" [disabled]="this.formControl.value === null"\r\n    (click)="this.formControl.reset()">\r\n    {{\'igo.geo.spatialFilter.clearForm\' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class="search-button" [disabled]="disableSearchButton()" color="primary"\r\n    (click)="toggleSearchButton()">\r\n    {{\'igo.geo.spatialFilter.goSearch\' | translate}}\r\n  </button>\r\n\r\n  <button *ngIf="selectedSourceAddress || selectedThematics" mat-raised-button class="remove-button"\r\n    [disabled]="!layers.length" (click)="clearButton()">\r\n    {{\'igo.geo.spatialFilter.removeLayer\' | translate}}\r\n  </button>\r\n\r\n</div>\r\n\r\n<div class="results" *ngIf="store">\r\n  <mat-table class="results-list" [dataSource]="store.entities$.value">\r\n\r\n    \x3c!-- Type Column --\x3e\r\n    <ng-container matColumnDef="typeResults">\r\n        <mat-header-cell *matHeaderCellDef>{{\'igo.geo.spatialFilter.type\' | translate}}</mat-header-cell>\r\n        <mat-cell *matCellDef="let result"> {{result.meta.title}} </mat-cell>\r\n      </ng-container>\r\n\r\n    \x3c!-- Name Column --\x3e\r\n    <ng-container matColumnDef="nameResults">\r\n      <mat-header-cell *matHeaderCellDef>{{\'igo.geo.spatialFilter.searchResults\' | translate}}</mat-header-cell>\r\n      <mat-cell *matCellDef="let result"> {{result.properties.nom}} </mat-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef="displayedColumnsResults"></mat-header-row>\r\n    <mat-row *matRowDef="let row; columns: displayedColumnsResults;"></mat-row>\r\n  </mat-table>\r\n</div>',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".header{margin-top:5px;width:100%}.mat-slide-toggle{padding:5px;margin-bottom:15px;width:98%}.mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 20px)}.radius-form,.title{margin-left:5px}.title{font-size:initial}.mat-radio-group{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;padding-top:10px}.mat-radio-button{display:-webkit-inline-box;display:inline-flex;position:relative;margin-left:16px;margin-top:10px}.mat-form-field{margin-top:5px}.mat-column-select{overflow:auto}.buttons{margin-top:10px}.search-button{left:25px;width:150px}.remove-button{left:75px;margin:15px;width:150px}.clear-form-button,.clear-search-button{left:10px;width:150px}.thematics{max-height:150px;overflow:auto;margin-top:5px;width:98%}.results{overflow:auto;max-height:250px;width:98%}.mat-column-typeResults{max-width:100px;margin-right:5px}.radius{width:90%}.radius ::ng-deep .mat-form-field-infix{display:-webkit-inline-box;display:inline-flex}.unit-field{padding-left:5px;padding-right:5px}.example-tree-invisible{display:none}.tree-ul{margin:0;padding:0 0 0 20px;list-style-type:none}.tree-check,.tree-check-2{position:relative;margin-left:auto;margin-right:5px}.thematics-header{max-width:250px}.checks-header{padding:none;max-width:calc(100% - 316px);overflow:hidden}.mat-checkbox{padding:5px}.mat-tree-node{position:relative;min-height:42px;width:280px}.mat-header-cell{height:56px}"]}]}],il.ctorParameters=function(){return[{type:Le.ChangeDetectorRef},{type:zi},{type:je.MessageService},{type:je.LanguageService}]},il.propDecorators={map:[{type:Le.Input}],type:[{type:Le.Input}],queryType:[{type:Le.Input}],zone:[{type:Le.Input}],loading:[{type:Le.Input}],store:[{type:Le.Input}],layers:[{type:Le.Input}],toggleSearch:[{type:Le.Output}],itemTypeChange:[{type:Le.Output}],thematicChange:[{type:Le.Output}],drawZoneEvent:[{type:Le.Output}],radiusEvent:[{type:Le.Output}],freehandControl:[{type:Le.Output}],clearButtonEvent:[{type:Le.Output}],clearSearchEvent:[{type:Le.Output}]},il);function il(e,t,r,o){this.cdRef=e,this.spatialFilterService=t,this.messageService=r,this.languageService=o,this.layers=[],this.toggleSearch=new Le.EventEmitter,this.itemTypeChange=new Le.EventEmitter,this.thematicChange=new Le.EventEmitter,this.drawZoneEvent=new Le.EventEmitter,this.radiusEvent=new Le.EventEmitter,this.freehandControl=new Le.EventEmitter,this.clearButtonEvent=new Le.EventEmitter,this.clearSearchEvent=new Le.EventEmitter,this.itemType=[Wi.Address,Wi.Thematics],this.selectedItemType=Wi.Address,this.treeControl=new le.NestedTreeControl(function(e){return e.children}),this.displayedColumns=["name","select"],this.childrens=[],this.groups=[],this.thematics=[],this.dataSource=new Fe.MatTreeNestedDataSource,this.selectedThematics=new se.SelectionModel(!0,[]),this.displayedColumnsResults=["typeResults","nameResults"],this.value$=new Ce.BehaviorSubject(undefined),this.drawGuide$=new Ce.BehaviorSubject(null),this.overlayStyle$=new Ce.BehaviorSubject(undefined),this.drawStyle$=new Ce.BehaviorSubject(undefined),this.formControl=new ye.FormControl,this.geometryTypeField=!1,this.geometryTypes=["Point","Polygon"],this.drawGuideField=!1,this.drawGuide=null,this.drawGuidePlaceholder="",this.measure=!1,this.drawControlIsActive=!0,this.freehandDrawIsActive=!1,this.radiusFormControl=new ye.FormControl,this.measureUnit=ha.Meters}var al=(sl.forRoot=function(){return{ngModule:sl,providers:[{provide:Fe.MAT_DATE_LOCALE,useValue:"fr"}]}},sl.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,ye.FormsModule,ye.ReactiveFormsModule,Fe.MatAutocompleteModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTabsModule,Fe.MatRadioModule,Fe.MatMenuModule,Fe.MatTableModule,Fe.MatTreeModule,Fe.MatButtonToggleModule,Fe.MatCheckboxModule,Fe.MatSliderModule,Fe.MatSlideToggleModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatOptionModule,Fe.MatSelectModule,Fe.MatListModule,Fe.MatTooltipModule,Fe.MatDatepickerModule,Fe.MatNativeDateModule,V.MatDatetimepickerModule,V.MatNativeDatetimeModule,je.IgoLanguageModule,Fi,Te.IgoCollapsibleModule,Te.IgoListModule,Te.IgoKeyValueModule,xs],exports:[Ai,Ms,Ps,ks,Es,$s,_s,Zs,Js,Ns,Us,zs,Hs,el,rl,nl],declarations:[Ai,Ms,Ps,ks,Es,$s,_s,Zs,Js,Ns,Us,zs,Hs,el,rl,nl],providers:[Bi,Ni,zi]}]}],sl);function sl(){}var ll,ul=(qe(cl,ll=Error),cl);function cl(){return null!==ll&&ll.apply(this,arguments)||this}var pl,dl=(qe(hl,pl=ul),hl);function hl(){var e=pl.call(this,"Invalid file")||this;return Object.setPrototypeOf(e,hl.prototype),e}var gl,fl=(qe(ml,gl=ul),ml);function ml(){var e=gl.call(this,"Nothing to export")||this;return Object.setPrototypeOf(e,ml.prototype),e}function yl(e,t,r){if(e instanceof fl)vl(t,r);else{var o=r.translate,n=o.instant("igo.geo.export.failed.title"),i=o.instant("igo.geo.export.failed.text");t.error(i,n)}}function vl(e,t){var r=t.translate,o=r.instant("igo.geo.export.nothing.title"),n=r.instant("igo.geo.export.nothing.text");e.error(n,o)}var bl=ke.strEnum(["GeoJSON","GML","GPX","KML","Shapefile","CSV"]),Sl=(wl.prototype["export"]=function(e,t,r,o,n){void 0===o&&(o="EPSG:4326"),void 0===n&&(n="EPSG:4326");var i=e.map(function(r){var e=r.getKeys().filter(function(e){return!e.startsWith("_")}).reduce(function(e,t){return e[t]=r.get(t),e},{geometry:r.getGeometry()});return new ve(e)});return this.exportAsync(i,t,r,o,n)},wl.prototype.exportAsync=function(t,r,o,n,i){var a=this;return new Ce.Observable(function(e){if(!0!==a.nothingToExport(t,r))if(0<=Object.keys(wl.ogreFormats).indexOf(r)){if(a.ogreUrl===undefined)return void(0<=wl.noOgreFallbacks.indexOf(r)?a.exportToFile(t,e,r,o,n,i):e.error(new dl));a.exportWithOgre(t,e,r,o,n,i)}else a.exportToFile(t,e,r,o,n,i);else e.error(new fl)})},wl.prototype.exportToFile=function(e,t,r,o,n,i){var a=(new Me[r]).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),s=o+"."+r.toLowerCase();ke.downloadContent(a,"text/plain;charset=utf-8",s),t.complete()},wl.prototype.exportWithOgre=function(e,t,r,o,n,i){var a=(new Me.GeoJSON).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),s=this.ogreUrl+"/convertJson",l=document.createElement("form");l.setAttribute("method","post"),l.setAttribute("target","_blank"),l.setAttribute("action",s),l.acceptCharset="UTF-8",l.enctype="application/x-www-form-urlencoded; charset=utf-8;";var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","json"),u.setAttribute("value",a),l.appendChild(u);var c=document.createElement("input"),p="Shapefile"===r?o+".zip":o+"."+r.toLowerCase();c.setAttribute("type","hidden"),c.setAttribute("name","outputName"),c.setAttribute("value",p),l.appendChild(c);var d=wl.ogreFormats[r],h=document.createElement("input");h.setAttribute("type","hidden"),h.setAttribute("name","format"),h.setAttribute("value",d),l.appendChild(h),document.body.appendChild(l),l.submit(),document.body.removeChild(l),t.complete()},wl.prototype.nothingToExport=function(e,t){return 0===e.length||"GPX"===t&&e.find(function(e){return 0<=["Point","LineString"].indexOf(e.getGeometry().getType())})===undefined},wl.ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSV:"CSV"},wl.noOgreFallbacks=["GML","GPX","KML"],wl.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],wl.ctorParameters=function(){return[{type:je.ConfigService}]},wl.ngInjectableDef=Le.defineInjectable({factory:function(){return new wl(Le.inject(je.ConfigService))},token:wl,providedIn:"root"}),wl);function wl(e){this.config=e,this.ogreUrl=this.config.getConfig("importExport.url")}var Il,Fl=(qe(Ol,Il=Error),Ol);function Ol(){return null!==Il&&Il.apply(this,arguments)||this}var Tl,xl=(qe(Cl,Tl=Fl),Cl);function Cl(){var e=Tl.call(this,"Invalid file")||this;return Object.setPrototypeOf(e,Cl.prototype),e}var Ml,Ll=(qe(Pl,Ml=Fl),Pl);function Pl(){var e=Ml.call(this,"Failed to read file")||this;return Object.setPrototypeOf(e,Pl.prototype),e}var Dl,kl=(qe(jl,Dl=Fl),jl);function jl(){var e=Dl.call(this,"Nothing to import")||this;return Object.setPrototypeOf(e,jl.prototype),e}var El,Rl=(qe($l,El=Fl),$l);function $l(){var e=El.call(this,"File is too large")||this;return Object.setPrototypeOf(e,kl.prototype),e}var Al,Gl=(qe(Bl,Al=Fl),Bl);function Bl(){var e=Al.call(this,"Invalid SRS definition")||this;return Object.setPrototypeOf(e,kl.prototype),e}function _l(e,t,r){var o=e.map(function(e){return wo(e,t.projection)}),n=Math.floor(255*Math.random()),i=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),s=new Se.Stroke({color:[n,i,a,1],width:2}),l=new Se.Fill({color:[n,i,a,.4]}),u=new nt({queryable:!0});u.ol.addFeatures(o);var c=new Tr({title:r,source:u,style:new Se.Style({stroke:s,fill:l,image:new Se.Circle({radius:5,stroke:s,fill:l})})});return t.addLayer(c),Lo(t,o),c}function ql(e,t,r,o,n){var i,a=e.map(function(e){return wo(e,t.projection)});if(o.getStyleList(r.toString()+".styleByAttribute")){var s=o.getStyleList(r.toString()+".styleByAttribute");i=function(e){return n.createStyleByAttribute(e,s)}}else if(o.getStyleList(r.toString()+".style")){var l=o.getStyleList(r.toString()+".style.radius"),u=new Se.Stroke({color:o.getStyleList(r.toString()+".style.stroke.color"),width:o.getStyleList(r.toString()+".style.stroke.width")}),c=new Se.Fill({color:o.getStyleList(r.toString()+".style.fill.color")});i=new Se.Style({stroke:u,fill:c,image:new Se.Circle({radius:l||5,stroke:u,fill:c})})}else{l=o.getStyleList("default.style.radius"),u=new Se.Stroke({color:o.getStyleList("default.style.stroke.color"),width:o.getStyleList("default.style.stroke.width")}),c=new Se.Fill({color:o.getStyleList("default.style.fill.color")});i=new Se.Style({stroke:u,fill:c,image:new Se.Circle({radius:l||5,stroke:u,fill:c})})}var p=new nt({queryable:!0});p.ol.addFeatures(a);var d=new Tr({title:r,source:p,style:i});return t.addLayer(d),Lo(t,a),d}function Nl(e,t,r,o,n,i,a){if(0!==t.length){var s=Zl(e);i?ql(t,r,s,i,a):_l(t,r,s);var l=n.translate,u=l.instant("igo.geo.dropGeoFile.success.title"),c=l.instant("igo.geo.dropGeoFile.success.text",{value:s});o.success(c,u)}else Kl(e,o,n)}function Vl(e,t,r,o){({"Invalid file":Ul,"File is too large":zl,"Failed to read file":Wl,"Invalid SRS definition":Hl})[t.message](e,t,r,o)}function Ul(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.invalid.title"),a=n.instant("igo.geo.dropGeoFile.invalid.text",{value:e.name,mimeType:e.type});r.error(a,i)}function Wl(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.unreadable.title"),a=n.instant("igo.geo.dropGeoFile.unreadable.text",{value:e.name});r.error(a,i)}function zl(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.tooLarge.title"),a=n.instant("igo.geo.dropGeoFile.tooLarge.text",{value:e.name});r.error(a,i)}function Kl(e,t,r){var o=r.translate,n=o.instant("igo.geo.dropGeoFile.empty.title"),i=o.instant("igo.geo.dropGeoFile.empty.text",{value:e.name,mimeType:e.type});t.error(i,n)}function Hl(e,t,r){var o=r.translate,n=o.instant("igo.geo.dropGeoFile.invalidSRS.title"),i=o.instant("igo.geo.dropGeoFile.invalidSRS.text",{value:e.name,mimeType:e.type});t.error(i,n)}function Yl(e){return e.name.split(".").pop().toLowerCase()}function Zl(e){return e.name.substr(0,e.name.lastIndexOf("."))}var Ql=(Jl.prototype["import"]=function(e,t,r){return void 0===t&&(t="EPSG:4326"),void 0===r&&(r="EPSG:4326"),this.importAsync(e,t,r)},Jl.prototype.getFileImporter=function(e){var t=Yl(e),r=e.type,o=Ke(Jl.allowedMimeTypes,Jl.allowedZipMimeTypes),n=Jl.allowedExtensions;return o.indexOf(r)<0&&n.indexOf(t)<0?undefined:"application/json"===r||0<=["json","geojson","kml","gpx"].indexOf(t)?this.importFile:this.ogreUrl!==undefined?this.importFileWithOgre:undefined},Jl.prototype.importAsync=function(r,o,n){var i=this;return new Ce.Observable(function(e){if(3e7<=r.size)e.error(new Rl);else{var t=i.getFileImporter(r);t!==undefined?t.call(i,r,e,o,n):e.error(new xl)}})},Jl.prototype.importFile=function(o,n,i,a){var s=this,e=new FileReader;e.onload=function(e){try{var t=s.parseFeaturesFromFile(o,e.target.result,i,a);n.next(t)}catch(r){n.error(new Ll)}n.complete()},e.onerror=function(e){n.error(new Ll)},e.readAsText(o,"UTF-8")},Jl.prototype.importFileWithOgre=function(r,o,e,n){var i=this,t=this.ogreUrl+"/convert",a=new FormData;a.append("upload",r),a.append("sourceSrs",e),a.append("targetSrs",n),a.append("formatOutput","GEOJSON"),a.append("skipFailures",""),this.http.post(t,a,{headers:new Pe.HttpHeaders}).subscribe(function(e){if(null!==e)if(0<(e.errors||[]).length)o.error(new Ll);else{var t=i.parseFeaturesFromGeoJSON(r,e,n);o.next(t),o.complete()}else o.error(new Ll)},function(e){e.error.caught=!0;var t=e.error.msg||"";"No valid files found"===t?o.error(new xl):t.startWith("ERROR 1: Failed to process SRS definition")?o.error(new Gl):o.error(new Ll)})},Jl.prototype.parseFeaturesFromFile=function(t,e,r,o){var n,i=Yl(t),a=t.type,s=new Me.GeoJSON;if("application/vnd.google-earth.kml+xml"===a)n=new Me.KML;else if("application/gml+xml"===a)n=new Me.GML;else if("application/gpx+xml"===a)n=new Me.GPX;else switch(i){case"kml":n=new Me.KML;break;case"gpx":n=new Me.GPX;break;case"gml":n=new Me.GML;break;default:n=s}return n.readFeatures(e,{dataProjection:r,featureProjection:o}).map(function(e){return Object.assign(s.writeFeatureObject(e),{projection:o,meta:{id:ke.uuid(),title:Zl(t)}})})},Jl.prototype.parseFeaturesFromGeoJSON=function(t,e,r){var o=new Me.GeoJSON;return o.readFeatures(e).map(function(e){return Object.assign(o.writeFeatureObject(e),{projection:r,meta:{id:ke.uuid(),title:Zl(t)}})})},Jl.allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"],Jl.allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"],Jl.allowedExtensions=["geojson","kml","gpx","json","gml"],Jl.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Jl.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.ConfigService}]},Jl.ngInjectableDef=Le.defineInjectable({factory:function(){return new Jl(Le.inject(Pe.HttpClient),Le.inject(je.ConfigService))},token:Jl,providedIn:"root"}),Jl);function Jl(e,t){this.http=e,this.config=t,this.ogreUrl=this.config.getConfig("importExport.url")}var Xl=(eu.prototype.getStyleList=function(e){return ke.ObjectUtils.resolve(this.styleList,e)},eu.prototype.load=function(r){var o=this,n=r["default"]||{};if(!r.path)return this.styleList=n,!0;var i=this.injector.get(Pe.HttpClient);return new Promise(function(t,e){i.get(r.path).pipe(De.catchError(function(e){return console.log("StyleList file "+r.path+" could not be read"),t(!0),Ce.throwError(e.error||"Server error")})).subscribe(function(e){o.styleList=ke.ObjectUtils.mergeDeep(n,e),t(!0)})})},eu.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],eu.ctorParameters=function(){return[{type:Le.Injector}]},eu.ngInjectableDef=Le.defineInjectable({factory:function(){return new eu(Le.inject(Le.INJECTOR))},token:eu,providedIn:"root"}),eu);function eu(e){this.injector=e,this.styleList={}}var tu=(ru.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t.layers=e.filter(function(e){return e instanceof Tr&&!0===e.exportable})})},ru.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},ru.prototype.importFiles=function(e){var t,r,o=this,n=this.inputProj;this.espgCodeRegex.test(n)&&(n="EPSG:"+n),this.loading$.next(!0);var i=function(t){a.importService["import"](t,n).subscribe(function(e){return o.onFileImportSuccess(t,e)},function(e){return o.onFileImportError(t,e)},function(){o.loading$.next(!1)})},a=this;try{for(var s=We(e),l=s.next();!l.done;l=s.next())i(l.value)}catch(u){t={error:u}}finally{try{l&&!l.done&&(r=s["return"])&&r.call(s)}finally{if(t)throw t.error}}},ru.prototype.handleExportFormSubmit=function(e){var t=this;this.loading$.next(!0);var r=this.map.getLayerById(e.layer),o=r.dataSource.ol.getFeatures();r.dataSource instanceof er&&(o=o.flatMap(function(e){return e.get("features")})),this.exportService["export"](o,e.format,r.title,this.map.projection).subscribe(function(){},function(e){return t.onFileExportError(e)},function(){t.loading$.next(!1)})},ru.prototype.buildForm=function(){this.form=this.formBuilder.group({format:["",[ye.Validators.required]],layer:["",[ye.Validators.required]]})},ru.prototype.onFileImportSuccess=function(e,t){this.config.getConfig("importWithStyle")?Nl(e,t,this.map,this.messageService,this.languageService,this.styleListService,this.styleService):Nl(e,t,this.map,this.messageService,this.languageService)},ru.prototype.onFileImportError=function(e,t){this.loading$.next(!1),Vl(e,t,this.messageService,this.languageService)},ru.prototype.onFileExportError=function(e){this.loading$.next(!1),yl(e,this.messageService,this.languageService)},ru.decorators=[{type:Le.Component,args:[{selector:"igo-import-export",template:'<mat-tab-group>\r\n\r\n  <mat-tab [label]="\'igo.geo.importExportForm.importTabTitle\' |translate">\r\n    <form class="igo-form">\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <input\r\n            matInput\r\n            placeholder="{{\'igo.geo.importExportForm.importProjPlaceholder\' | translate}}"\r\n            name="inputProj"\r\n            [(ngModel)]="inputProj">\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-form-button-group">\r\n        <button mat-raised-button type="button" (click)="fileInput.click()" [disabled]="loading$ | async">\r\n          {{\'igo.geo.importExportForm.importButton\' | translate}}\r\n        </button>\r\n        <igo-spinner [shown]="loading$ | async"></igo-spinner>\r\n        <input\r\n          #fileInput\r\n          type="file"\r\n          [style.display]="\'none\'"\r\n          (click)="fileInput.value = null"\r\n          (change)="importFiles($event.target.files)">\r\n      </div>\r\n    </form>\r\n    <section class="mat-typography">\r\n    <h4>{{\'igo.geo.importExportForm.importClarifications\' | translate}}</h4>\r\n    <ul>\r\n      <li>{{\'igo.geo.importExportForm.importSizeMax\' | translate}}</li>\r\n      <li>{{\'igo.geo.importExportForm.importShpZip\' | translate}}</li>\r\n    </ul>\r\n  </section>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]="\'igo.geo.importExportForm.exportTabTitle\' |translate">\r\n    <form class="igo-form" [formGroup]="form">\r\n\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName="layer"\r\n            placeholder="{{\'igo.geo.importExportForm.exportLayerPlaceholder\' | translate}}">\r\n            <mat-option *ngFor="let layer of layers" [value]="layer.id">\r\n              {{layer.title}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-input-container">\r\n        <mat-form-field>\r\n          <mat-select\r\n            formControlName="format"\r\n            placeholder="{{\'igo.geo.importExportForm.exportFormatPlaceholder\' | translate}}">\r\n            <mat-option *ngFor="let format of formats | keyvalue " [value]="format.key">\r\n              {{format.value}}\r\n            </mat-option>\r\n          </mat-select>\r\n        </mat-form-field>\r\n      </div>\r\n\r\n      <div class="igo-form-button-group">\r\n        <button\r\n          mat-raised-button\r\n          type="button"\r\n          [disabled]="!form.valid || (loading$ | async)"\r\n          (click)="handleExportFormSubmit(form.value)">\r\n          {{\'igo.geo.importExportForm.exportButton\' | translate}}\r\n        </button>\r\n        <igo-spinner [shown]="loading$ | async"></igo-spinner>\r\n      </div>\r\n\r\n    </form>\r\n  </mat-tab>\r\n\r\n</mat-tab-group>\r\n',styles:["mat-form-field{width:100%}h4{padding:0 5px}.igo-form{padding:15px 5px}.igo-form-button-group{text-align:center;padding-top:10px}igo-spinner{position:absolute;padding-left:10px}"]}]}],ru.ctorParameters=function(){return[{type:Ql},{type:Sl},{type:je.LanguageService},{type:je.MessageService},{type:Xl},{type:_r},{type:ye.FormBuilder},{type:je.ConfigService}]},ru.propDecorators={map:[{type:Le.Input}]},ru);function ru(e,t,r,o,n,i,a,s){this.importService=e,this.exportService=t,this.languageService=r,this.messageService=o,this.styleListService=n,this.styleService=i,this.formBuilder=a,this.config=s,this.formats=bl,this.inputProj="EPSG:4326",this.loading$=new Ce.BehaviorSubject(!1),this.espgCodeRegex=new RegExp("^\\d{4,6}"),this.buildForm()}var ou,nu=(qe(iu,ou=Te.DragAndDropDirective),Object.defineProperty(iu.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),iu.prototype.ngOnInit=function(){var t=this;this.filesDropped$$=this.filesDropped.subscribe(function(e){t.onFilesDropped(e)})},iu.prototype.ngOnDestroy=function(){this.filesDropped$$.unsubscribe()},iu.prototype.onDragOver=function(e){ou.prototype.onDragOver.call(this,e)},iu.prototype.onDragLeave=function(e){ou.prototype.onDragLeave.call(this,e)},iu.prototype.onDrop=function(e){ou.prototype.onDrop.call(this,e)},iu.prototype.onFilesDropped=function(e){var t,r,o=this,n=function(t){i.importService["import"](t).subscribe(function(e){return o.onFileImportSuccess(t,e)},function(e){return o.onFileImportError(t,e)})},i=this;try{for(var a=We(e),s=a.next();!s.done;s=a.next())n(s.value)}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}},iu.prototype.onFileImportSuccess=function(e,t){this.config.getConfig("importWithStyle")?Nl(e,t,this.map,this.messageService,this.languageService,this.styleListService,this.styleService):Nl(e,t,this.map,this.messageService,this.languageService)},iu.prototype.onFileImportError=function(e,t){Vl(e,t,this.messageService,this.languageService)},iu.decorators=[{type:Le.Directive,args:[{selector:"[igoDropGeoFile]"}]}],iu.ctorParameters=function(){return[{type:Pr},{type:Ql},{type:je.LanguageService},{type:Xl},{type:_r},{type:je.ConfigService},{type:je.MessageService}]},iu.propDecorators={onDragOver:[{type:Le.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:Le.HostListener,args:["dragleave",["$event"]]}],onDrop:[{type:Le.HostListener,args:["drop",["$event"]]}]},iu);function iu(e,t,r,o,n,i,a){var s=ou.call(this)||this;return s.component=e,s.importService=t,s.languageService=r,s.styleListService=o,s.styleService=n,s.config=i,s.messageService=a,s.filesDropped=new Le.EventEmitter,s.filesInvalid=new Le.EventEmitter,s}var au=new Le.InjectionToken("styleListOptions");function su(e){return{provide:au,useValue:e}}function lu(e,t){return function(){return e.load(t)}}function uu(){return{provide:Le.APP_INITIALIZER,useFactory:lu,multi:!0,deps:[Xl,au]}}var cu=(pu.forRoot=function(){return{ngModule:pu,providers:[su({}),uu()]}},pu.decorators=[{type:Le.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],pu);function pu(){}var du=(hu.forRoot=function(){return{ngModule:hu}},hu.decorators=[{type:Le.NgModule,args:[{imports:[ye.FormsModule,ye.ReactiveFormsModule,Oe.CommonModule,Fe.MatButtonModule,Fe.MatTabsModule,Fe.MatSelectModule,Fe.MatOptionModule,Fe.MatFormFieldModule,Fe.MatInputModule,je.IgoLanguageModule,Te.IgoSpinnerModule,Te.IgoKeyValueModule,Te.IgoDrapDropModule,cu.forRoot()],exports:[tu,nu,cu],declarations:[tu,nu]}]}],hu);function hu(){}var gu=(fu.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,je.IgoLanguageModule,Te.IgoConfirmDialogModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTooltipModule],exports:[Pr,fn,yn,xn,In,On,sn,bn,un,pn],declarations:[Pr,fn,yn,xn,In,On,sn,bn,un,pn]}]}],fu);function fu(){}var mu=(Object.defineProperty(yu.prototype,"measure",{get:function(){return this.measure$.value},set:function(e){this.measure$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yu.prototype,"auto",{get:function(){return this._auto},set:function(e){this.toggleAutoUnit(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yu.prototype,"measureUnits",{get:function(){return this.measureType===da.Area?Object.values(fa):Object.values(ha)},enumerable:!0,configurable:!0}),yu.prototype.ngOnDestroy=function(){this.toggleAutoUnit(!1)},yu.prototype.onMeasureUnitChange=function(e){this.measureUnit=e,this.measureUnitChange.emit(e)},yu.prototype.toggleAutoUnit=function(e){var t=this;this.measure$$!==undefined&&this.measure$$.unsubscribe(),!0===e&&(this.measure$$=this.measure$.subscribe(function(e){t.computeBestMeasureUnit(e)})),this._auto=e},yu.prototype.computeBestMeasureUnit=function(e){var t=this.measureUnit;this.measureType===da.Area?t=La(e):this.measureType===da.Length&&(t=Ma(e)),t!==this.measureUnit&&this.onMeasureUnitChange(t)},yu.decorators=[{type:Le.Component,args:[{selector:"igo-measurer-item",template:'<mat-form-field class="measure-field">\r\n  <input\r\n    matInput\r\n    [readonly]="true"\r\n    [placeholder]="placeholder"\r\n    [value]="((measure$ | async) || 0) | measureFormat: measureUnit">\r\n</mat-form-field>\r\n<mat-form-field class="unit-field">\r\n  <mat-select\r\n    [value]="measureUnit"\r\n    [disabled]="auto"\r\n    (selectionChange)="onMeasureUnitChange($event.value)">\r\n    <mat-option *ngFor="let measureUnit of measureUnits" [value]="measureUnit">\r\n      {{(\'igo.geo.measure.\' + measureUnit) | translate}}\r\n    </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[":host{display:-webkit-box;display:flex;width:100%;padding:5px 10px}.measure-field{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-flow:column nowrap;width:100%}.unit-field{width:110px;margin-left:10px}"]}]}],yu.ctorParameters=function(){return[]},yu.propDecorators={measureType:[{type:Le.Input}],measureUnit:[{type:Le.Input}],measure:[{type:Le.Input}],auto:[{type:Le.Input}],placeholder:[{type:Le.Input}],measureUnitChange:[{type:Le.Output}]},yu);function yu(){this.measure$=new Ce.BehaviorSubject(undefined),this._auto=!1,this.measureUnitChange=new Le.EventEmitter}var vu=(bu.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatButtonModule,Fe.MatButtonToggleModule,Fe.MatIconModule,Fe.MatTooltipModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatSelectModule,Fe.MatSlideToggleModule,je.IgoLanguageModule,Te.IgoEntityTableModule],declarations:[Ss,mu,vs,ms],exports:[Ss,vs],entryComponents:[ms]}]}],bu);function bu(){}var Su=(wu.decorators=[{type:Le.NgModule,args:[{imports:[],declarations:[],exports:[vu]}]}],wu);function wu(){}var Iu=(Fu.forRoot=function(){return{ngModule:Fu}},Fu.decorators=[{type:Le.NgModule,args:[{imports:[],exports:[Rr],declarations:[Rr]}]}],Fu);function Fu(){}var Ou=pe,Tu=(xu.prototype.print=function(t,r){var o=this,n=new Ce.Subject,e=r.paperFormat,i=+r.resolution,a=r.orientation;this.activityId=this.activityService.register();var s=new ce({orientation:a,format:e.toLowerCase()}),l=[s.internal.pageSize.width,s.internal.pageSize.height],u=[20,10,20,10],c=[l[0]-u[3]-u[1],l[1]-u[0]-u[2]];return r.title!==undefined&&this.addTitle(s,r.title,l[0]),!0!==r.showProjection&&!0!==r.showScale||this.addProjScale(s,t,i,r.showProjection,r.showScale),""!==r.comment&&this.addComment(s,r.comment),this.addMap(s,t,i,c,u).subscribe(function(e){e===ke.SubjectStatus.Done&&(!0===r.showLegend?o.addLegend(s,t,u,i):o.saveDoc(s)),e!==ke.SubjectStatus.Done&&e!==ke.SubjectStatus.Error||(o.activityService.unregister(o.activityId),n.next(ke.SubjectStatus.Done))}),n},xu.prototype.getLayersLegendHtml=function(e,t,r){var o="",n=gr(e.layers,e.viewController.getScale(r));return 0===n.length?o:(o+='<style media="screen" type="text/css">',o+=".html2canvas-container { width: "+t,o+="mm !important; height: 2000px !important; }",o+="</style>",o+='<font size="2" face="Courier New" >',o+='<div style="display:inline-block;max-width:'+t+'mm">',n.forEach(function(e){o+='<table border=1 style="display:inline-block;vertical-align:top">',o+='<tr><th width="170px">'+e.title+"</th>",o+='<td><img class="printImageLegend" src="'+e.url+'">',o+="</td></tr></table>"}),o+="</div>")},xu.prototype.getLayersLegendImage=function(e,o,n,t){void 0===o&&(o="png");var i=new Ce.Subject,r=this.getLayersLegendHtml(e,200,t),a=this;o=o.toLowerCase(),0===r.length&&(r='<font size="12" face="Courier New" >',r+='<div align="center"><b>NO LEGEND</b></div>');var s=window.document.createElement("div");window.document.body.appendChild(s),s.innerHTML=r,setTimeout(function(){Ou(s,{useCORS:!0}).then(function(e){var t=ke.SubjectStatus.Done;try{n?a.generateCanvaFileToZip(e,"legendImage."+o):a.saveCanvasImageAsFile(e,"legendImage",o),s.parentNode.removeChild(s)}catch(r){t=ke.SubjectStatus.Error}i.next(t)})["catch"](function(e){console.log(e)})},500)},xu.prototype.addTitle=function(e,t,r){var o,n=812.8/96*t.length;o=r<n?0:(r-n)/2,e.setFont("courier"),e.setFontSize(32),e.text(t,o,15)},xu.prototype.addComment=function(e,t){var r=e.internal.pageSize.height-5;e.setFont("courier"),e.setFontSize(16),e.text(t,20,r)},xu.prototype.addProjScale=function(e,t,r,o,n){var i=this.languageService.translate,a=e.internal.pageSize.height-15,s="";!0===o&&(s+=i.instant("igo.geo.printForm.projection")+": "+t.projection),!0===n&&(!0===o&&(s+="   "),s+=i.instant("igo.geo.printForm.scale")+": ~ 1 / "+Wo(t.viewController.getScale(r))),e.setFont("courier"),e.setFontSize(16),e.text(s,20,a)},xu.prototype.addLegend=function(o,e,n,t){var i=this,a=this,r=o.internal.pageSize.width,s=this.getLayersLegendHtml(e,r,t);if(""===s)return this.saveDoc(o),!0;var l=window.document.createElement("div");Ou(l,{useCORS:!0}).then(function(e){var t;t=e.toDataURL("image/png"),o.addPage();var r=i.getImageSizeToFitPdf(o,e,n);o.addImage(t,"PNG",10,10,r[0],r[1]),a.saveDoc(o),l.parentNode.removeChild(l)})["catch"](function(e){console.log(e)}),window.document.body.appendChild(l),l.innerHTML=s},xu.prototype.addCanvas=function(e,t,r){var o;if((o=t.toDataURL("image/jpeg"))!==undefined){var n=this.getImageSizeToFitPdf(e,t,r);e.addImage(o,"JPEG",r[3],r[0],n[0],n[1]),e.rect(r[3],r[0],n[0],n[1])}},xu.prototype.addMap=function(i,a,e,t,s){var l,u=this,c=new Ce.Subject,p=a.ol.getSize(),d=a.ol.getView().calculateExtent(p),r=Math.round(t[0]*e/25.4),o=Math.round(t[1]*e/25.4);return a.ol.once("postcompose",function(e){var o=e.context.canvas,n=a.status$.subscribe(function(e){if(clearTimeout(l),e===ke.SubjectStatus.Done){n.unsubscribe();var t=ke.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(r){t=ke.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(t)}});l=window.setTimeout(function(){n.unsubscribe();var e=ke.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(t){e=ke.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(e)},200)}),this.renderMap(a,[r,o],d),c},xu.prototype.defineNbFileToProcess=function(e){this.nbFileToProcess=e},xu.prototype.downloadMapImage=function(T,x,C,M,L,e,P,D,k){var j=this;void 0===C&&(C="png"),void 0===M&&(M=!1),void 0===L&&(L=!1),void 0===e&&(e=!1),void 0===P&&(P=""),void 0===D&&(D=""),void 0===k&&(k=!0);var E=new Ce.Subject;this.activityId=this.activityService.register();var R=this.languageService.translate;T.ol.once("postcompose",function(e){C=C.toLowerCase();var t=e.context,r=document.createElement("canvas"),o=r.getContext("2d"),n=0,i=10,a=t.canvas.width,s=t.canvas.height;o.font="20px Calibri";var l=o.measureText(D).width;s=""!==P?s+30:s;var u=(s=!1!==M||!1!==L?s+30:s)-10,c=Math.ceil(l/a),p=(s=""!==D?s+30*c:s)-20*c+5;if(r.width=a,r.height=s,"jpeg"===C&&(o.fillStyle="#ffffff",o.fillRect(0,0,a,s),o.fillStyle="#000000"),""!==P&&(o.font="26px Calibri",n=30,o.textAlign="center",o.fillText(P,a/2,20)),!(o.font="20px Calibri")!==M){var d=R.instant("igo.geo.printForm.projection");o.textAlign="start",o.fillText(d+": "+T.projection,i,u),i+=200}if(!1!==L){var h=R.instant("igo.geo.printForm.scale"),g=T.viewController.getScale(x);o.textAlign="start",o.fillText(h+": ~ 1 / "+Wo(g),i,u)}if(""!==D)if(o.textAlign="center",1===c)o.fillText(D,a/2,p);else for(var f=D.length,m=Math.floor(f/c),y="",v=0,b=void 0,S=0;S<c;S++)S<c-1?(b=(y=D.substr(v,m)).lastIndexOf(" "),o.fillText(y.substr(0,b),a/2,p),v+=b,p+=20):o.fillText(D.substr(v),a/2,p);o.drawImage(t.canvas,0,n);var w=ke.SubjectStatus.Done;try{k?"tiff"===C.toLowerCase()?j.generateCanvaFileToZip(r,"map"+T.projection.replace(":","_")+"."+C):j.generateCanvaFileToZip(r,"map."+C):j.saveCanvasImageAsFile(r,"map",C)}catch(O){w=ke.SubjectStatus.Error}if(E.next(w),"tiff"===C.toLowerCase()){var I=j.getWorldFileInformation(T),F=new Blob([I],{type:"text/plain;charset=utf-8"});k?j.addFileToZip("map"+T.projection.replace(":","_")+".tfw",F):(ue.saveAs(F,"map"+T.projection+".tfw"),j.saveFileProcessing())}}),T.ol.renderSync()},xu.prototype.renderMap=function(e,t,r){e.ol.renderSync()},xu.prototype.saveDoc=function(e){e.save("map.pdf")},xu.prototype.getImageSizeToFitPdf=function(e,t,r){var o=e.internal.pageSize.getHeight()-(r[0]+r[2]),n=e.internal.pageSize.getWidth()-(r[1]+r[3]),i=t.height,a=t.width,s=i/o,l=a/n,u=l<s?s:l;return[1<u?a/u:a,1<u?i/u:i]},xu.prototype.getWorldFileInformation=function(e){var t=e.viewController.getResolution(),r=e.viewController.getExtent();return[t,0,0,-t,r[0]+t/.5,r[3]-t/.5].join("\n")},xu.prototype.saveCanvasImageAsFile=function(e,t,r){var o="image/"+r,n=this;try{e.toDataURL(),navigator.msSaveBlob?(navigator.msSaveBlob(e.msToBlob(),t+"."+r),this.saveFileProcessing()):e.toBlob(function(e){ue.saveAs(e,t+"."+r),n.saveFileProcessing()},o)}catch(i){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},xu.prototype.generateCanvaFileToZip=function(e,t){var r=this;this.hasOwnProperty("zipFile")&&"undefined"!=typeof this.zipFile||(this.zipFile=new de);try{e.toDataURL(),navigator.msSaveBlob?this.addFileToZip(t,e.msToBlob()):e.toBlob(function(e){r.addFileToZip(t,e)},"image/jpeg")}catch(o){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},xu.prototype.addFileToZip=function(e,t){this.zipFile.file(e,t),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))},xu.prototype.saveFileProcessing=function(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)},xu.prototype.getZipFile=function(){var t=this;this.zipFile.generateAsync({type:"blob"}).then(function(e){ue.saveAs(e,"map.zip"),delete t.zipFile})},xu.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],xu.ctorParameters=function(){return[{type:je.MessageService},{type:je.ActivityService},{type:je.LanguageService}]},xu.ngInjectableDef=Le.defineInjectable({factory:function(){return new xu(Le.inject(je.MessageService),Le.inject(je.ActivityService),Le.inject(je.LanguageService))},token:xu,providedIn:"root"}),xu);function xu(e,t,r){this.messageService=e,this.activityService=t,this.languageService=r}var Cu=(Object.defineProperty(Mu.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Mu.prototype,"outputFormat",{get:function(){return this._outputFormat},set:function(e){this._outputFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(Mu.prototype,"paperFormat",{get:function(){return this._paperFormat},set:function(e){this._paperFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(Mu.prototype,"orientation",{get:function(){return this._orientation},set:function(e){this._orientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(Mu.prototype,"imageFormat",{get:function(){return this._imageFormat},set:function(e){this._imageFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(Mu.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!0,configurable:!0}),Mu.prototype.handleFormSubmit=function(e){if((this.disabled=!0)===e.isPrintService)this.printService.print(this.map,e).subscribe();else{var t=1;e.showLegend&&t++,"tiff"===e.imageFormat.toLowerCase()&&t++,this.printService.defineNbFileToProcess(t);var r=+e.resolution;this.printService.downloadMapImage(this.map,r,e.imageFormat,e.showProjection,e.showScale,e.showLegend,e.title,e.comment,e.doZipFile),e.showLegend&&this.printService.getLayersLegendImage(this.map,e.imageFormat,e.doZipFile,+r)}this.disabled=!1},Mu.decorators=[{type:Le.Component,args:[{selector:"igo-print",template:'<igo-print-form\r\n  [outputFormat]="outputFormat"\r\n  [paperFormat]="paperFormat"\r\n  [orientation]="orientation"\r\n  [imageFormat]="imageFormat"\r\n  [resolution]="resolution"\r\n  [disabled]="disabled"\r\n  (submit)="handleFormSubmit($event)">\r\n</igo-print-form>\r\n'}]}],Mu.ctorParameters=function(){return[{type:Tu}]},Mu.propDecorators={map:[{type:Le.Input}],outputFormat:[{type:Le.Input}],paperFormat:[{type:Le.Input}],orientation:[{type:Le.Input}],imageFormat:[{type:Le.Input}],resolution:[{type:Le.Input}]},Mu);function Mu(e){this.printService=e,this.disabled=!1}var Lu=ke.strEnum(["Pdf","Image"]),Pu=ke.strEnum(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),Du=ke.strEnum(["landscape","portrait"]),ku=ke.strEnum(["72","96","150","300"]),ju=ke.strEnum(["Bmp","Gif","Jpeg","Png","Tiff"]),Eu=(Object.defineProperty(Ru.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"imageFormat",{get:function(){return this.imageFormatField.value},set:function(e){this.imageFormatField.setValue(e||ju.Jpeg,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"outputFormat",{get:function(){return this.outputFormatField.value},set:function(e){this.outputFormatField.setValue(e||Lu.Pdf,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"paperFormat",{get:function(){return this.paperFormatField.value},set:function(e){this.paperFormatField.setValue(e||Pu.Letter,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"orientation",{get:function(){return this.orientationField.value},set:function(e){this.orientationField.setValue(e||Du.landscape,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"resolution",{get:function(){return this.resolutionField.value},set:function(e){this.resolutionField.setValue(e||ku[96],{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"title",{get:function(){return this.titleField.value},set:function(e){this.titleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"comment",{get:function(){return this.commentField.value},set:function(e){this.commentField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"showProjection",{get:function(){return this.showProjectionField.value},set:function(e){this.showProjectionField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"showScale",{get:function(){return this.showScaleField.value},set:function(e){this.showScaleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"showLegend",{get:function(){return this.showLegendField.value},set:function(e){this.showLegendField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"doZipFile",{get:function(){return this.doZipFileField.value},set:function(e){this.doZipFileField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"outputFormatField",{get:function(){return this.form.controls.outputFormat},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"paperFormatField",{get:function(){return this.form.controls.paperFormat},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"imageFormatField",{get:function(){return this.form.controls.imageFormat},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"orientationField",{get:function(){return this.form.controls.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"resolutionField",{get:function(){return this.form.controls.resolution},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"commentField",{get:function(){return this.form.controls.comment},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"showProjectionField",{get:function(){return this.form.controls.showProjection},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"showScaleField",{get:function(){return this.form.controls.showScale},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"showLegendField",{get:function(){return this.form.controls.showLegend},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"doZipFileField",{get:function(){return this.form.controls.doZipFile},enumerable:!0,configurable:!0}),Object.defineProperty(Ru.prototype,"titleField",{get:function(){return this.form.controls.title},enumerable:!0,configurable:!0}),Ru.prototype.ngOnInit=function(){this.doZipFileField.setValue(!1)},Ru.prototype.handleFormSubmit=function(e,t){this.submitted=!0,e.isPrintService=this.isPrintService,t&&this.submit.emit(e)},Ru.prototype.toggleImageSaveProp=function(){"Image"===this.outputFormatField.value?this.isPrintService=!1:this.isPrintService=!0},Ru.decorators=[{type:Le.Component,args:[{selector:"igo-print-form",template:'<form class="igo-form" [formGroup]="form">\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="title"\r\n        placeholder="{{\'igo.geo.printForm.title\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="comment"\r\n        placeholder="{{\'igo.geo.printForm.comment\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <div class="print-slide-toggle-container mat-typography">\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showProjection"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showProjection\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showScale"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showScale\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showLegend"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showLegend\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="doZipFile"\r\n        [labelPosition]="\'before\'"\r\n        [style.display]="isPrintService ? \'none\' : \'\'">\r\n        {{\'igo.geo.printForm.doZipFile\' | translate}}\r\n      </mat-slide-toggle>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <mat-select (selectionChange)="toggleImageSaveProp()"\r\n        formControlName="outputFormat"\r\n        placeholder="{{\'igo.geo.printForm.outputFormat\' | translate}}">\r\n        <mat-option *ngFor="let outputFormat of outputFormats | keyvalue " [value]="outputFormat.key">\r\n            {{outputFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="paperFormat"\r\n        placeholder="{{\'igo.geo.printForm.paperFormat\' | translate}}">\r\n        <mat-option *ngFor="let paperFormat of paperFormats | keyvalue " [value]="paperFormat.key">\r\n          {{(\'igo.geo.printForm.paperFormats.\' + paperFormat.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'none\' : \'block\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="imageFormat"\r\n        placeholder="{{\'igo.geo.printForm.imageFormat\' | translate}}">\r\n        <mat-option *ngFor="let imageFormat of imageFormats | keyvalue " [value]="imageFormat.key">\r\n          {{imageFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" style="display: none;">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="resolution"\r\n        placeholder="{{\'igo.geo.printForm.resolution\' | translate}}">\r\n        <mat-option *ngFor="let resolution of resolutions | keyvalue " [value]="resolution.key">\r\n          {{resolution.value + \' PPI\'}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="orientation"\r\n        placeholder="{{\'igo.geo.printForm.orientation\' | translate}}">\r\n        <mat-option *ngFor="let orientation of orientations | keyvalue " [value]="orientation.key">\r\n          {{(\'igo.geo.printForm.\' + orientation.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-form-button-group print-button-top-padding">\r\n    <button\r\n      mat-raised-button\r\n      type="button"\r\n      [disabled]="!form.valid || disabled"\r\n      (click)="handleFormSubmit(form.value, form.valid)">\r\n      {{\'igo.geo.printForm.saveBtn\' | translate}}\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n',styles:["mat-form-field{width:100%}.print-slide-toggle-container{overflow-x:hidden}.print-slide-toggle-container mat-slide-toggle{width:100%;margin:10px}.print-slide-toggle-container mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px)}.print-option{display:block;margin-right:10px;margin-bottom:15px}.print-button-top-padding{padding-top:25px}.igo-form{padding:10px 5px 5px}.igo-form-button-group{text-align:center}"]}]}],Ru.ctorParameters=function(){return[{type:ye.FormBuilder}]},Ru.propDecorators={disabled:[{type:Le.Input}],imageFormat:[{type:Le.Input}],outputFormat:[{type:Le.Input}],paperFormat:[{type:Le.Input}],orientation:[{type:Le.Input}],resolution:[{type:Le.Input}],title:[{type:Le.Input}],comment:[{type:Le.Input}],showProjection:[{type:Le.Input}],showScale:[{type:Le.Input}],showLegend:[{type:Le.Input}],doZipFile:[{type:Le.Input}],submit:[{type:Le.Output}]},Ru);function Ru(e){this.formBuilder=e,this.outputFormats=Lu,this.paperFormats=Pu,this.orientations=Du,this.resolutions=ku,this.imageFormats=ju,this.isPrintService=!0,this._disabled=!1,this.submit=new Le.EventEmitter,this.form=this.formBuilder.group({title:["",[]],comment:["",[]],outputFormat:["",[ye.Validators.required]],paperFormat:["",[ye.Validators.required]],imageFormat:["",[ye.Validators.required]],resolution:["",[ye.Validators.required]],orientation:["",[ye.Validators.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}var $u=(Au.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,ye.FormsModule,ye.ReactiveFormsModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatSelectModule,Fe.MatOptionModule,Fe.MatInputModule,Fe.MatFormFieldModule,Fe.MatSlideToggleModule,je.IgoLanguageModule,Te.IgoKeyValueModule],exports:[Cu,Eu],declarations:[Cu,Eu]}]}],Au);function Au(){}function Gu(e){return new ui(e.getConfig("searchSources."+ui.id)||{})}function Bu(){return{provide:ai,useFactory:Gu,multi:!0,deps:[je.ConfigService]}}var _u=(qu.forRoot=function(){return{ngModule:qu,providers:[Bu()]}},qu.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule],exports:[ni],declarations:[ni],providers:[ri]}]}],qu);function qu(){}var Nu=(Vu.prototype.getSources=function(){return this.sources},Vu.prototype.getEnabledSources=function(){return this.getSources().filter(function(e){return!0===e.enabled})},Vu.prototype.enableSourcesByType=function(t){this.getSources().forEach(function(e){e.constructor.type===t?e.enabled=!0:e.enabled=!1})},Vu.prototype.setParamFromSetting=function(e,t){e.setParamFromSetting(t)},Vu);function Vu(e){this.sources=e}function Uu(e){return e.search!==undefined}function Wu(e){return e.reverseSearch!==undefined}function zu(e){return e.reverseSearch!==undefined&&!0===e.showInPointerSummary}var Ku=(Hu.prototype.search=function(e,t){if(void 0===t&&(t={}),!this.termIsValid(e))return[];var r,o=No(e,this.mapService.getMap().projection,{forceNA:t.forceNA});return o.lonLat?this.reverseSearch(o.lonLat,{distance:o.radius}):(o.message&&console.log(o.message),t.extent=this.mapService.getMap().viewController.getExtent("EPSG:4326"),r=t.getEnabledOnly||t.getEnabledOnly===undefined?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),t.sourceId?r=r.filter(function(e){return e.getId()===t.sourceId}):t.searchType&&(r=r.filter(function(e){return e.getType()===t.searchType})),r=r.filter(Uu),this.searchSources(r,e,t))},Hu.prototype.reverseSearch=function(e,t,r){void 0===r&&(r=!1);var o=r?zu:Wu,n=this.searchSourceService.getEnabledSources().filter(o);return this.reverseSearchSources(n,e,t||{})},Hu.prototype.searchSources=function(e,t,r){return e.map(function(e){return{request:e.search(t,r),reverse:!1,source:e}})},Hu.prototype.reverseSearchSources=function(e,t,r){return e.map(function(e){return{request:e.reverseSearch(t,r),reverse:!0,source:e}})},Hu.prototype.termIsValid=function(e){return"string"==typeof e&&""!==e},Hu.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Hu.ctorParameters=function(){return[{type:Nu},{type:Xr}]},Hu.ngInjectableDef=Le.defineInjectable({factory:function(){return new Hu(Le.inject(Nu),Le.inject(Xr))},token:Hu,providedIn:"root"}),Hu);function Hu(e,t){this.searchSourceService=e,this.mapService=t}var Yu=function md(){},Zu=function yd(e){this.sources=e};function Qu(e){return new Zu(e)}function Ju(){return{provide:Zu,useFactory:Qu,deps:[Yu]}}var Xu=(ec.prototype.route=function(t,r){var o=this;if(void 0===r&&(r={}),0!==t.length)return this.directionsSourceService.sources.filter(function(e){return e.enabled}).map(function(e){return o.routeSource(e,t,r)})},ec.prototype.routeSource=function(e,t,r){return void 0===r&&(r={}),e.route(t,r)},ec.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],ec.ctorParameters=function(){return[{type:Zu}]},ec.ngInjectableDef=Le.defineInjectable({factory:function(){return new ec(Le.inject(Zu))},token:ec,providedIn:"root"}),ec);function ec(e){this.directionsSourceService=e}var tc=(rc.prototype.getStopsCoordinates=function(){var t=[];return this.stops&&this.stops.forEach(function(e){t.push(e.stopCoordinates)}),t},rc.prototype.setStops=function(e){this.stops=e},rc.prototype.getStops=function(){return this.stops},rc.decorators=[{type:Le.Injectable}],rc.ctorParameters=function(){return[]},rc);function rc(){}var oc=(nc.prototype.changeRoute=function(){this.showRouteGeometry()},nc.prototype.prevent=function(e){e.preventDefault()},nc.prototype.ngOnInit=function(){var e=this;this.queryService.queryEnabled=!1,this.focusOnStop=!1,this.browserLanguage=this.languageService.getLanguage(),this.stopsForm=this.formBuilder.group({directionsType:"car",directionsMode:"driving",stopOrderPriority:!0,directionsFixedStartEnd:!1,stops:this.formBuilder.array([this.createStop("start"),this.createStop("end")])}),this.directionsFormService.getStops()?this.conditionalInit():this.map.status$.pipe(De.take(1)).subscribe(function(){e.conditionalInit()})},nc.prototype.conditionalInit=function(){var t=this;this.initStores(),this.initOlInteraction(),this.subscribeToFormChange(),this.routesQueries$$.push(this.stream$.pipe(De.debounceTime(this.debounce),De.distinctUntilChanged()).subscribe(function(e){return t.handleTermChanged(e)}))},nc.prototype.ngOnDestroy=function(){this.unsubscribeRoutesQueries(),this.unlistenSingleClick(),this.queryService.queryEnabled=!0,this.freezeStores(),this.writeStopsToFormService()},nc.prototype.initStores=function(){var e=new ao({motion:or.None}),t=this.stopsStore;Po(t,new Tr({title:"Directions - stops",zIndex:911,source:new nt,showInLayerList:!1,exportable:!1,browsable:!1,style:ic})),Do(t,e);var r=this.routeStore;Po(r,new Tr({title:"Directions - route and vertex",zIndex:910,source:new nt,showInLayerList:!1,exportable:!1,browsable:!1,style:ic})),Do(r,e)},nc.prototype.initOlInteraction=function(){var t,o=this,e=new ge.Select({layers:[this.stopsStore.layer.ol],condition:he.pointerMove,hitTolerance:7,filter:function(e){return"stop"===e.get("type")}});e.on("select",function(e){t=e.target.getFeatures()[0]});var r=new ge.Translate({layers:[this.stopsStore.layer.ol],features:t});r.on("translating",function(e){var t=e.features;0!==t.getLength()&&o.executeTranslation(t,!1,50,!0)}),r.on("translateend",function(e){var t=e.features;0!==t.getLength()&&o.executeTranslation(t,!0,0,!1)});var n=new ge.Select({layers:[this.routeStore.layer.ol],condition:he.click,hitTolerance:7,filter:function(e){return"route"===e.getId()}});n.on("select",function(e){if(!1===o.focusOnStop){var t=be.transform(e.mapBrowserEvent.coordinate,o.map.projection,o.projection);o.addStop();var r=o.stops.length-2;o.stops.at(r).patchValue({stopCoordinates:t}),o.handleLocationProposals(t,r),o.addStopOverlay(t,r),n.getFeatures().clear()}n.getFeatures().clear()}),this.map.ol.addInteraction(e),this.map.ol.addInteraction(r),this.map.ol.addInteraction(n)},nc.prototype.subscribeToFormChange=function(){var t=this;this.routesQueries$$.push(this.stopsForm.valueChanges.pipe(De.debounceTime(this.debounce)).subscribe(function(e){t.writeStopsToFormService()}))},nc.prototype.freezeStores=function(){var e=this.stopsStore,t=this.routeStore;this.map.removeLayer(e.layer),this.map.removeLayer(t.layer),e.deactivateStrategyOfType(ao),t.deactivateStrategyOfType(ao)},nc.prototype.executeTranslation=function(e,t,r,o){var n=this;void 0===t&&(t=!1),void 0===r&&(r=0),void 0===o&&(o=!1),this.routeStore.clear();var i,a=e.getArray()[0],s=a.getId().split("_");switch(s[1]){case"start":i=0;break;case"end":i=this.stops.length-1;break;default:i=Number(s[1])}var l=be.transform(a.getGeometry().getCoordinates(),this.map.projection,this.projection);this.stops.at(i).patchValue({stopCoordinates:l,stopProposals:[]}),t&&this.handleLocationProposals(l,i);var u={steps:!0,overview:!1,alternatives:!0};o&&(u.overview=!0,u.steps=!1,u.alternatives=!1),0<r?("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.lastTimeoutRequest=setTimeout(function(){n.getRoutes(undefined,u)},r)):(clearTimeout(this.lastTimeoutRequest),this.getRoutes(undefined,u))},nc.prototype.handleLocationProposals=function(e,o){var n=this,i=[],a=[e[0].toFixed(5),e[1].toFixed(5)];this.stops.at(o).patchValue({stopPoint:a.join(",")}),this.searchService.reverseSearch(e,{zoom:this.map.viewController.getZoom()}).map(function(e){return n.routesQueries$$.push(e.request.pipe(De.map(function(e){return e})).subscribe(function(e){if(e.forEach(function(t){0===i.filter(function(e){return e.source===t.source}).length&&i.push({source:t.source,results:e.map(function(e){return e.data})})}),n.stops.at(o).patchValue({stopProposals:i}),e[0])if("icherchereverse"===e[0].source.getId()){for(var t=0,r=0;r<e.length;r++)if("adresses"===e[r].data.properties.type){t=r;break}n.stops.at(o).patchValue({stopPoint:Te.getEntityTitle(e[t])}),"Point"===e[t].data.geometry.type&&n.stops.at(o).patchValue({stopCoordinates:e[t].data.geometry.coordinates})}else"coordinatesreverse"===e[0].source.getId()&&(n.stops.at(o).patchValue({stopPoint:[e[0].data.geometry.coordinates[0].toFixed(5),e[0].data.geometry.coordinates[1].toFixed(5)].join(",")}),"Point"===e[0].data.geometry.type&&n.stops.at(o).patchValue({stopCoordinates:e[0].data.geometry.coordinates}));else n.stops.at(o).patchValue({stopPoint:a.join(","),stopProposals:[]});n.changeDetectorRefs.detectChanges()}))})},nc.prototype.directionsText=function(e,t){return void 0===t&&(t=this.stops.length),0===e?"start":e===t-1||1===t?"end":"intermediate"},nc.prototype.raiseStop=function(e){0<e&&this.moveStop(e,-1)},nc.prototype.lowerStop=function(e){e<this.stops.length-1&&this.moveStop(e,1)},nc.prototype.moveStop=function(e,t){var r=this.stops.at(e);this.removeStop(e),this.stops.insert(e+t,r),this.stops.at(e).patchValue({directionsText:this.directionsText(e)}),this.stops.at(e+t).patchValue({directionsText:this.directionsText(e+t)}),this.stops.at(e).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e).value.stopCoordinates,e),this.stops.at(e+t).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e+t).value.stopCoordinates,e+t)},Object.defineProperty(nc.prototype,"stops",{get:function(){return this.stopsForm.get("stops")},enumerable:!0,configurable:!0}),nc.prototype.writeStopsToFormService=function(){var t=[];this.stops.value.forEach(function(e){e.stopCoordinates instanceof Array&&t.push(e)}),this.directionsFormService.setStops(t)},nc.prototype.addStop=function(){var e=this.stops.length-1;this.stops.insert(e,this.createStop())},nc.prototype.createStop=function(e){return void 0===e&&(e="intermediate"),this.formBuilder.group({stopPoint:[""],stopProposals:[[]],directionsText:e,stopCoordinates:["",[ye.Validators.required]]})},nc.prototype.removeStop=function(e){var t=this,r=this.getStopOverlayID(e);this.deleteStoreFeatureByID(this.stopsStore,r),this.stops.removeAt(e);var o=0;this.stops.value.forEach(function(e){t.stops.at(o).patchValue({directionsText:t.directionsText(o)}),t.addStopOverlay(t.stops.at(o).value.stopCoordinates,o),o++})},nc.prototype.resetForm=function(){this.routesResults=undefined;for(var e=this.stops.length,t=0;t<e;t++)this.stops.removeAt(0);this.stops.insert(0,this.createStop("start")),this.stops.insert(1,this.createStop("end")),this.stopsStore.clear(),this.routeStore.clear()},nc.prototype.formatStep=function(e,t){return this.formatInstruction(e.maneuver.type,e.maneuver.modifier,e.name,e.maneuver.bearing_after,t,e.maneuver.exit,t===this.activeRoute.steps.length-1)},nc.prototype.formatInstruction=function(e,t,r,o,n,i,a){var s,l;void 0===a&&(a=!1);var u,c="forward",p="rotate-270",d=this.translateBearing(o),h=this.translateModifier(t),g=("straight"===t?"":" ")+h,f=("straight"===t?"":"on the ")+h;if(t&&0<=t.search("slight")&&(f=h),"uturn"===t?(c="forward",p="rotate-90"):"sharp right"===t?(c="subdirectory-arrow-right",p="icon-flipped"):"right"===t?(c="subdirectory-arrow-right",p="icon-flipped"):"slight right"===t?(c="forward",p="rotate-290"):"straight"===t?c="forward":"slight left"===t?(c="forward",p="rotate-250"):"left"===t?(c="subdirectory-arrow-left",p="icon-flipped"):"sharp left"===t&&(c="subdirectory-arrow-left",p="icon-flipped"),"turn"===e)l="straight"===t?(s="Continuer sur "+r,"Continue on "+r):"uturn"===t?(s="Faire demi-tour sur "+r,"Make u-turn on "+r):(s="Tourner "+g+" sur "+r,"Turn "+h+" onto "+r);else if("new name"===e)s="Continuer en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="compass",p="";else if("depart"===e)s="Aller en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="compass",p="";else if("arrive"===e)if(a){var m=", ";h||(m=f=g=""),s="Vous tes arriv"+m+g,l="You have reached your destination"+m+f}else s="Vous atteignez le point intermdiare sur "+r,l="You have reached the intermediate stop onto "+r,c="map-marker",p="";else"merge"===e?(s="Continuer sur "+r,l="Continue on "+r,c="forward",p="rotate-270"):"on ramp"===e?(s="Prendre l'entre d'autoroute "+g,l="Take the ramp "+f):"off ramp"===e?(s="Prendre la sortie d'autoroute "+g,l="Take exit "+f):"fork"===e?l=0<=t.search("left")?(s="Garder la gauche sur "+r,"Merge left onto "+r):0<=t.search("right")?(s="Garder la droite sur "+r,"Merge right onto "+r):(s="Continuer sur "+r,"Continue on "+r):"end of road"===e?(s=" la fin de la route, tourner "+h+" sur "+r,l="At the end of the road, turn "+h+" onto "+r):"use lane"===e?(s="Prendre la voie de ... ",l="Take the lane ..."):"continue"===e&&"uturn"!==t?(s="Continuer sur "+r,l="Continue on "+r,c="forward",p="rotate-270"):"roundabout"===e?(s="Au rond-point, prendre la "+i,s+=1===i?"re":"e",s+=" sortie vers "+r,l="At the roundabout, take the "+i,l+=1===i?"st":"rd",l+=" exit towards "+r,c="chart-donut",p=""):"rotary"===e?(s="Rond-point rotary....",l="Roundabout rotary....",c="chart-donut",p=""):"roundabout turn"===e?(s="Rond-point, prendre la ...",l="Roundabout, take the ...",c="chart-donut",p=""):"exit roundabout"===e?(s="Poursuivre vers "+r,l="Continue to "+r,c="forward",p="rotate-270"):l="notification"===e?s="notification ....":"uturn"===t?(s="Faire demi-tour et continuer en direction "+d+" sur "+r,"Make u-turn and head "+d+" on "+r):s="???";return a&&(c="flag-variant",p=""),0===n&&(c="compass",p=""),"fr"===this.browserLanguage?u=s:"en"===this.browserLanguage&&(u=l),{instruction:u,image:c,cssClass:p}},nc.prototype.translateModifier=function(e){return"uturn"===e?this.languageService.translate.instant("igo.geo.directions.uturn"):"sharp right"===e?this.languageService.translate.instant("igo.geo.directions.sharp right"):"right"===e?this.languageService.translate.instant("igo.geo.directions.right"):"slight right"===e?this.languageService.translate.instant("igo.geo.directions.slight right"):"sharp left"===e?this.languageService.translate.instant("igo.geo.directions.sharp left"):"left"===e?this.languageService.translate.instant("igo.geo.directions.left"):"slight left"===e?this.languageService.translate.instant("igo.geo.directions.slight left"):"straight"===e?this.languageService.translate.instant("igo.geo.directions.straight"):e},nc.prototype.translateBearing=function(e){return 337<=e||e<23?this.languageService.translate.instant("igo.geo.cardinalPoints.n"):e<67?this.languageService.translate.instant("igo.geo.cardinalPoints.ne"):e<113?this.languageService.translate.instant("igo.geo.cardinalPoints.e"):e<157?this.languageService.translate.instant("igo.geo.cardinalPoints.se"):e<203?this.languageService.translate.instant("igo.geo.cardinalPoints.s"):e<247?this.languageService.translate.instant("igo.geo.cardinalPoints.sw"):e<293?this.languageService.translate.instant("igo.geo.cardinalPoints.w"):e<337?this.languageService.translate.instant("igo.geo.cardinalPoints.nw"):void 0},nc.prototype.formatDistance=function(e){if(0!==e)return 1e5<=e?Math.round(e/1e3)+" km":1e4<=e?Math.round(e/100)/10+" km":100<=e?Math.round(e/100)/10+" km":e+" m"},nc.prototype.formatDuration=function(e,t){if(void 0===t&&(t=!1),3600<=e){var r=Math.floor(e/3600),o=Math.round(60*(e/3600-r));return 60===o?r+1+" h":r+" h "+o+" min"}return 60<=e?Math.round(e/60)+" min":e+" s"},nc.prototype.showSegment=function(e,t){void 0===t&&(t=!1),this.showRouteSegmentGeometry(e.geometry.coordinates,t)},nc.prototype.showRouteSegmentGeometry=function(e,t){void 0===t&&(t=!1);var r="vertex",o=new we.LineString(e).transform("EPSG:4326",this.map.projection).getCoordinates()[0],n=new we.Point(o),i=new ve({geometry:n}),a=(new Ie).writeGeometryObject(n,{featureProjection:this.map.projection,dataProjection:this.map.projection}),s=this.routeStore.get(r),l=s?s.meta.revision:0,u={type:rr,geometry:a,projection:this.map.projection,properties:{id:r,type:"vertex"},meta:{id:r,revision:l+1},ol:i};this.routeStore.update(u),t&&this.map.viewController.zoomToExtent(i.getGeometry().getExtent())},nc.prototype.zoomRoute=function(e){if(e)this.map.viewController.zoomToExtent(e);else{var t=this.routeStore.layer.ol.getSource().getFeatures().find(function(e){return"route"===e.getId()});if(t){var r=t.getGeometry().getExtent();this.map.viewController.zoomToExtent(r)}}},nc.prototype.showRouteGeometry=function(e){void 0===e&&(e=!1);var t=this.activeRoute.geometry.coordinates,r=new we.LineString(t).transform("EPSG:4326",this.map.projection);e&&this.zoomRoute(r.getExtent());var o=(new Ie).writeGeometryObject(r,{featureProjection:this.map.projection,dataProjection:this.map.projection}),n=this.routeStore.get("route"),i=n?n.meta.revision:0,a={type:rr,geometry:o,projection:this.map.projection,properties:{id:"route",type:"route"},meta:{id:"route",revision:i+1},ol:new ve({geometry:r})};this.routeStore.update(a)},nc.prototype.getRoutes=function(t,e){var r=this;void 0===t&&(t=!1),void 0===e&&(e={}),this.deleteStoreFeatureByID(this.routeStore,"vertex"),this.writeStopsToFormService();var o=this.directionsFormService.getStopsCoordinates();if(!(o.length<2)){var n=this.directionsService.route(o,e);n&&n.map(function(e){return r.routesQueries$$.push(e.subscribe(function(e){r.routesResults=e,r.activeRoute=r.routesResults[0],r.showRouteGeometry(t),r.changeDetectorRefs.detectChanges()}))})}},nc.prototype.unlistenSingleClick=function(){0!==this.focusKey.length&&this.focusKey.forEach(function(e){fe.unByKey(e)})},nc.prototype.unsubscribeRoutesQueries=function(){this.routesQueries$$.forEach(function(e){return e.unsubscribe()}),this.routesQueries$$=[]},nc.prototype.copyLinkToClipboard=function(){if(ke.Clipboard.copy(this.getUrl())){var e=this.languageService.translate,t=e.instant("igo.geo.directionsForm.dialog.copyTitle"),r=e.instant("igo.geo.directionsForm.dialog.copyMsgLink");this.messageService.success(r,t)}},nc.prototype.copyDirectionsToClipboard=function(){var o=this,n=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",i="",e=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n\t"+this.activeRoute.title+"\n\t"+this.formatDistance(this.activeRoute.distance)+"\n\t"+this.formatDuration(this.activeRoute.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",t=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n\t"+this.getUrl(),a=1;this.stops.value.forEach(function(e){var t="",r="";e.stopPoint!==e.stopCoordinates?(r=e.stopPoint,t=" ("+[e.stopCoordinates[1],e.stopCoordinates[0]].join(",")+")"):r=[e.stopCoordinates[1],e.stopCoordinates[0]].join(","),i=i+"\t"+a.toLocaleString()+". "+r+t+"\n",a++});var s=0;this.activeRoute.steps.forEach(function(e){var t=o.formatStep(e,s).instruction,r=o.formatDistance(e.distance)===undefined?"":" ("+o.formatDistance(e.distance)+")";n=n+"\t"+(s+1).toLocaleString()+". "+t+r+"\n",s++});var r=e+i+"\n"+t+"\n\n"+n;if(ke.Clipboard.copy(r)){var l=this.languageService.translate,u=l.instant("igo.geo.directionsForm.dialog.copyTitle"),c=l.instant("igo.geo.directionsForm.dialog.copyMsg");this.messageService.success(c,u)}},nc.prototype.handleTermChanged=function(e){var t=this;if(e!==undefined||0!==e.length){var r=[];this.search$$&&this.search$$.unsubscribe(),this.searchService.search(e,{searchType:"Feature"}).map(function(e){return t.search$$=e.request.subscribe(function(e){e.filter(function(e){return e.data.geometry}).forEach(function(t){0===r.filter(function(e){return e.source===t.source}).length&&r.push({source:t.source,meta:t.meta,results:e.map(function(e){return e.data})})}),t.stops.at(t.currentStopIndex).patchValue({stopProposals:r}),t.changeDetectorRefs.detectChanges()})})}},nc.prototype.setTerm=function(e){this.term=e,this.keyIsValid(e)&&(e.length>=this.length||0===e.length)&&this.stream$.next(e)},nc.prototype.keyIsValid=function(t){return this.invalidKeys.find(function(e){return e===t})===undefined},nc.prototype.keyup=function(t,e){var r=this,o=e.target.value;this.setTerm(o),this.map.ol.un("singleclick",function(e){r.handleMapClick(e,t)})},nc.prototype.clearStop=function(e){var t=this.getStopOverlayID(e);this.deleteStoreFeatureByID(this.stopsStore,t),this.routeStore.clear();var r=this.stops.length;this.stops.removeAt(e),this.stops.insert(e,this.createStop(this.directionsText(e,r))),this.routesResults=undefined,this.getRoutes()},nc.prototype.chooseProposal=function(e,t){if(e!==undefined){var r=void 0,o=e.geometry;"Point"===o.type?r=o.coordinates:0<=o.type.search("Line")?r=[(r=(new Ie).readFeatures(o)[0].getGeometry().getFirstCoordinate())[0],r[1]]:0<=o.type.search("Polygon")&&(r=[(r=(new Ie).readFeatures(o)[0].getGeometry().getInteriorPoints().getFirstCoordinate())[0],r[1]]),r!==undefined&&(this.stops.at(t).patchValue({stopCoordinates:r}),this.addStopOverlay(r,t))}},nc.prototype.focus=function(t){var r=this;this.unlistenSingleClick(),this.currentStopIndex=t,this.focusOnStop=!0,this.focusKey.push(this.map.ol.once("singleclick",function(e){r.handleMapClick(e,t)}))},nc.prototype.handleMapClick=function(e,t){var r=this;this.currentStopIndex===undefined?(this.addStop(),t=this.stops.length-2,this.stops.at(t).value.stopProposals=[]):t=this.currentStopIndex;var o=be.transform(e.coordinate,this.map.projection,this.projection);this.stops.at(t).patchValue({stopProposals:[],stopCoordinates:o}),this.handleLocationProposals(o,t),this.addStopOverlay(o,t),setTimeout(function(){r.focusOnStop=!1},500)},nc.prototype.geolocateStop=function(e){Lo(this.map,[this.map.geolocationFeature],or.Move);var t=this.map.viewController.getCenter(this.projection);this.stops.at(e).patchValue({stopCoordinates:t}),this.addStopOverlay(t,e),this.handleLocationProposals(t,e)},nc.prototype.addStopOverlay=function(e,t){var r,o,n=this.directionsText(t);o="start"===n?(r="green",this.languageService.translate.instant("igo.geo.directionsForm.start")):"end"===n?(r="red",this.languageService.translate.instant("igo.geo.directionsForm.end")):(r="yellow",this.languageService.translate.instant("igo.geo.directionsForm.intermediate")+" #"+t);var i=new we.Point(be.transform(e,this.projection,this.map.projection)),a=this.getStopOverlayID(t),s=(new Ie).writeGeometryObject(i,{featureProjection:this.map.projection,dataProjection:this.map.projection}),l=this.stopsStore.get(a),u=l?l.meta.revision:0,c={type:rr,geometry:s,projection:this.map.projection,properties:{id:a,type:"stop",stopText:o,stopColor:r,stopOpacity:1},meta:{id:a,revision:u+1},ol:new ve({geometry:i})};this.stopsStore.update(c),this.getRoutes()},nc.prototype.getStopOverlayID=function(e){return"directionsStop_"+(0===e?"start":e===this.stops.length-1?"end":e)},nc.prototype.deleteStoreFeatureByID=function(e,t){var r=e.get(t);r&&e["delete"](r)},nc.prototype.getUrl=function(){if(this.route){var e=this.route.options.directionsCoordKey,t=[];this.directionsFormService&&this.directionsFormService.getStopsCoordinates()&&0!==this.directionsFormService.getStopsCoordinates().length&&this.directionsFormService.getStopsCoordinates().forEach(function(e){t.push(Yo(e,6))});var r="";return 2<=t.length&&(r=e+"="+t.join(";")),""+location.origin+location.pathname+"?tool=directions&"+r}},nc.decorators=[{type:Le.Component,args:[{selector:"igo-directions-form",template:'<form class="igo-form" [formGroup]="stopsForm">\r\n  \x3c!-- <div class="igo-form-button-group">\r\n\r\n  </div> --\x3e\r\n  <div #inputs formArrayName="stops" *ngFor="let stop of stops.controls; let i = index;">\r\n    <mat-list-item [formGroupName]="i">\r\n\r\n      <div class="igo-input-container">\r\n        <button *ngIf="map.geolocationFeature" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.geolocate\' | translate" (click)="geolocateStop(i)">\r\n          <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n        </button>\r\n        <mat-form-field>\r\n          <input matInput formControlName="stopPoint" [matAutocomplete]="auto"\r\n            placeholder="{{\'igo.geo.directionsForm.\'+stop.value.directionsText | translate}}" (focus)="focus(i)"\r\n            (keyup)="keyup(i,$event)" (keydown.enter)="prevent($event)">\r\n            <button \r\n              mat-button \r\n              *ngIf="stop.value && (stop.value.stopPoint.length > 0 || stop.value.stopProposals.length > 0)"\r\n              matSuffix mat-icon-button color="warn" aria-label="Clear" (click)="clearStop(i)">\r\n              <mat-icon svgIcon="close"></mat-icon>\r\n            </button>\r\n\r\n          <mat-autocomplete #auto="matAutocomplete">\r\n            <mat-optgroup *ngFor="let source of stop.value.stopProposals" [label]="source.source.title" [disabled]="source.source.enabled === false">\r\n              <mat-option *ngFor="let result of source.results" [value]="result.meta ? result.meta.title : \'\'" \r\n              (onSelectionChange)="chooseProposal(result,i)"\r\n              matTooltipShowDelay="500" [matTooltip]="result.meta ? result.meta.title : \'\'">\r\n                {{ result.meta ? result.meta.title : \'\' }}\r\n              </mat-option>\r\n            </mat-optgroup>\r\n          </mat-autocomplete>\r\n        </mat-form-field>\r\n\r\n        \x3c!-- <div class="igo-form-button-group"> --\x3e\r\n\r\n\r\n          \x3c!-- <button *ngIf="i !== 0" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.raiseStop\' | translate"\r\n            [color]="color" (click)="raiseStop(i)">\r\n            <mat-icon svgIcon="arrow-upward"></mat-icon>\r\n          </button>\r\n          <button *ngIf="i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.lowerStop\' | translate"\r\n            [color]="color" (click)="lowerStop(i)">\r\n            <mat-icon svgIcon="arrow-downward"></mat-icon>\r\n          </button> --\x3e\r\n\r\n          <button *ngIf="i !== 0 && i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.removeStop\' | translate"\r\n            color="warn" (click)="removeStop(i)">\r\n            <mat-icon svgIcon="delete"></mat-icon>\r\n          </button>\r\n        \x3c!-- </div> --\x3e\r\n      </div>\r\n\r\n    </mat-list-item>\r\n  </div>\r\n  <div class="igo-form-button-group">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.addStop\' | translate" color="primary" (click)="addStop()">\r\n      <mat-icon svgIcon="map-marker-plus"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.zoomRoute\' | translate" *ngIf="routesResults" color="primary"\r\n      (click)="zoomRoute()">\r\n      <mat-icon svgIcon="magnify-plus-outline"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.resetDirectionsBtn\' | translate" *ngIf="routesResults" color="warn"\r\n      (click)="resetForm()">\r\n      <mat-icon svgIcon="file-restore"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.copy\' | translate" color="primary" (click)="copyDirectionsToClipboard()">\r\n      <mat-icon svgIcon="content-copy"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.link\' | translate" color="primary" (click)="copyLinkToClipboard()">\r\n      <mat-icon svgIcon="link"></mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n\r\n<div class="igo-input-container" *ngIf="routesResults">\r\n  <mat-form-field *ngIf="routesResults && routesResults.length > 1">\r\n    <mat-select placeholder="{{\'igo.geo.directionsForm.drivingOptions\' | translate}}" (selectionChange)="changeRoute()" [(ngModel)]="activeRoute">\r\n      <mat-option *ngFor="let pathDirections of routesResults; let cnt = index;" [value]="pathDirections">\r\n        Option {{cnt + 1}} : {{formatDistance(pathDirections.distance)}} ({{formatDuration(pathDirections.duration)}})\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf="routesResults && routesResults.length === 0"></mat-divider>\r\n\r\n  <mat-list>\r\n    <h2 mat-header class="igo-route-title mat-typography">{{activeRoute.title}}</h2>\r\n    <h2 mat-subheader>{{formatDistance(activeRoute.distance)}}, {{formatDuration(activeRoute.duration)}}</h2>\r\n\r\n    <mat-list-item \r\n    class="igo-steps"\r\n    (mouseenter)="showSegment(step)" \r\n    (click)="showSegment(step,true)" \r\n    *ngFor="let step of activeRoute.steps; let cnt = index;"\r\n      igoListItem>\r\n      <mat-icon [ngClass]="formatStep(step,cnt).cssClass" mat-list-icon svgIcon="{{formatStep(step,cnt).image}}"></mat-icon>\r\n\r\n      <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\r\n      <h4 mat-line class="right">{{formatDistance(step.distance)}}</h4>\r\n    </mat-list-item>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n  </mat-list>\r\n\r\n</div>\r\n',styles:["mat-form-field{width:85%}.igo-route-title{font-weight:700}.igo-steps{cursor:pointer}form{padding:10px}h3{padding-left:5px;padding-right:5px}.mat-line{word-wrap:break-word!important;white-space:pre-wrap!important}.mat-line.right{text-align:right}.rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-45{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-250{-webkit-transform:rotate(250deg);transform:rotate(250deg)}.rotate-290{-webkit-transform:rotate(290deg);transform:rotate(290deg)}.icon-flipped{-webkit-transform:scaleY(-1);transform:scaleY(-1)}"]}]}],nc.ctorParameters=function(){return[{type:ye.FormBuilder},{type:Xu},{type:je.LanguageService},{type:je.MessageService},{type:Ku},{type:ri},{type:tc},{type:Le.ChangeDetectorRef},{type:je.RouteService,decorators:[{type:Le.Optional}]}]},nc.propDecorators={term:[{type:Le.Input}],debounce:[{type:Le.Input}],length:[{type:Le.Input}],map:[{type:Le.Input}],stopsStore:[{type:Le.Input}],routeStore:[{type:Le.Input}],submit:[{type:Le.Output}]},nc);function nc(e,t,r,o,n,i,a,s,l){this.formBuilder=e,this.directionsService=t,this.languageService=r,this.messageService=o,this.searchService=n,this.queryService=i,this.directionsFormService=a,this.changeDetectorRefs=s,this.route=l,this.invalidKeys=["Control","Shift","Alt"],this.projection="EPSG:4326",this.routesQueries$$=[],this.stream$=new Ce.Subject,this.focusOnStop=!1,this.focusKey=[],this.debounce=200,this.length=2,this.submit=new Le.EventEmitter}function ic(e,t){var r=[new Se.Style({geometry:e.getGeometry(),image:new Se.Circle({radius:7,stroke:new Se.Stroke({color:"#FF0000",width:3})})})],o=new Se.Style({image:new Se.Icon({src:"./assets/igo2/geo/icons/place_"+e.get("stopColor")+"_36px.svg",opacity:e.get("stopOpacity"),imgSize:[36,36],anchor:[.5,.92]}),text:new Se.Text({text:e.get("stopText"),font:"12px Calibri,sans-serif",fill:new Se.Fill({color:"#000"}),stroke:new Se.Stroke({color:"#fff",width:3}),overflow:!0})}),n=[new Se.Style({stroke:new Se.Stroke({color:"#6a7982",width:10,opacity:.75})}),new Se.Style({stroke:new Se.Stroke({color:"#4fa9dd",width:6,opacity:.75})})];return"stop"===e.get("type")?o:"vertex"===e.get("type")?r:"route"===e.get("type")?n:void 0}var ac=(sc.prototype.ngAfterViewInit=function(){var n=this,e=this.directionsFormService.getStops();if(!e&&this.route&&this.route.options.directionsCoordKey)this.route.queryParams.subscribe(function(e){var t=e[n.route.options.directionsCoordKey];if(t){var r=t.split(";");if(2<=r.length){var o=0;r.forEach(function(e){0!==o&&o!==r.length-1&&n.component.stops.insert(o,n.component.createStop());var t=JSON.parse("["+e+"]");n.component.stops.at(o).patchValue({stopCoordinates:t}),n.component.stops.at(o).patchValue({stopPoint:t}),n.component.handleLocationProposals(t,o),n.component.addStopOverlay(t,o),o++}),n.component.getRoutes(!0)}}});else if(e){for(var t=0;t<e.length;t++)0!==t&&t!==e.length-1&&this.component.stops.insert(t,this.component.createStop()),e[t].stopCoordinates instanceof Array&&(this.component.addStopOverlay(e[t].stopCoordinates,t),this.component.stops.at(t).patchValue(e[t]));this.component.getRoutes()}this.component.writeStopsToFormService()},sc.decorators=[{type:Le.Directive,args:[{selector:"[igoDirectionsFormBinding]"}]}],sc.ctorParameters=function(){return[{type:oc,decorators:[{type:Le.Self}]},{type:tc},{type:je.RouteService,decorators:[{type:Le.Optional}]}]},sc);function sc(e,t,r){this.component=e,this.directionsFormService=t,this.route=r}var lc=(uc.forRoot=function(){return{ngModule:uc}},uc.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,ye.FormsModule,ye.ReactiveFormsModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatListModule,Fe.MatDividerModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatOptionModule,Fe.MatSelectModule,Fe.MatTooltipModule,Fe.MatAutocompleteModule,je.IgoLanguageModule],exports:[oc,ac],declarations:[oc,ac],providers:[tc,Ju()]}]}],uc);function uc(){}function cc(e){return new Nu(e)}function pc(){return{provide:Nu,useFactory:cc,deps:[ai]}}var dc=(hc.prototype.formatResult=function(e){return e},hc.decorators=[{type:Le.Injectable}],hc.ctorParameters=function(){return[{type:je.LanguageService}]},hc);function hc(e){this.languageService=e}var gc,fc=(qe(mc,gc=ai),Object.defineProperty(mc.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),mc.prototype.getId=function(){return mc.id},mc.prototype.getType=function(){return mc.type},mc.prototype.getDefaultOptions=function(){var e=this.options.params&&this.options.params.limit?Number(this.options.params.limit):undefined,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):undefined,r=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","municipalites","mrc","regadmin","lieux"];return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==r.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==r.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==r.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==r.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==r.indexOf("municipalites"),hashtags:["municipalit","mun"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==r.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==r.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==r.indexOf("regadmin"),hashtags:["rgion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==r.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==r.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==r.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:!1,hashtags:["borne","bornes","repre","km"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===e},{title:"5",value:5,enabled:5===e||!e},{title:"10",value:10,enabled:10===e},{title:"25",value:25,enabled:25===e},{title:"50",value:50,enabled:50===e}]},{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}]}},mc.prototype.search=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return o.get("type").length?(this.options.params.page=o.get("page")||"1",this.http.get(this.searchUrl+"/geocode",{params:o}).pipe(De.map(function(e){return r.extractResults(e)}),De.catchError(function(e){throw e.error.toDisplay=!0,e.error.title=r.languageService.translate.instant(r.getDefaultOptions().title),e}))):Ce.of([])},mc.prototype.getAllowedTypes=function(){var n=this;return this.http.get(this.searchUrl+"/types").subscribe(function(o){n.settings.find(function(e){return"type"===e.name}).values.forEach(function(e){var t=new RegExp("^"+e.value+"(\\.|$)"),r=o.filter(function(e){return t.test(e)});e.available=0<r.length,"lieux"===e.value&&(n.hashtagsLieuxToKeep=Ke(new Set(r.map(function(e){return e.split(".")}).reduce(function(e,t){return e.concat(t)}).filter(function(e){return"lieux"!==e}))))})})},mc.prototype.computeRequestParams=function(e,t){var r=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(e,t||{}).params,{q:this.computeTerm(e),page:t.page});if("true"===r.loc){var o=ze(t.extent,4),n=o[0],i=o[1],a=o[2],s=o[3];r.loc=n+","+i+";"+a+","+i+";"+a+","+s+";"+n+","+s+";"+n+","+i}else"false"===r.loc&&delete r.loc;return-1!==r.q.indexOf("#")&&(r.type="lieux"),new Pe.HttpParams({fromObject:ke.ObjectUtils.removeUndefined(r)})},mc.prototype.extractResults=function(t){var r=this;return t.features.map(function(e){return r.formatter.formatResult(r.dataToResult(e,t))})},mc.prototype.dataToResult=function(e,t){var r=this.computeProperties(e),o=[this.getId(),r.type,r.code].join("."),n=e.highlight.title||e.properties.nom,i=e.highlight.title2?" <small> "+e.highlight.title2+"</small>":"",a=e.highlight.title3?"<br><small> "+e.highlight.title3+"</small>":"";return{source:this,data:{type:rr,projection:"EPSG:4326",geometry:e.geometry,extent:e.bbox,properties:r,meta:{id:o,title:e.properties.nom}},meta:{dataType:rr,id:o,title:e.properties.nom,titleHtml:n+i+a,icon:e.icon||"map-marker",nextPage:t.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}},mc.prototype.computeProperties=function(e){var t=ke.ObjectUtils.removeKeys(e.properties,mc.propertiesBlacklist);if(e.geometry===undefined)return Object.assign({type:e.index},t);var r={GoogleMaps:pi.getGoogleMapsLink(e.geometry.coordinates[0],e.geometry.coordinates[1])};return"Point"===e.geometry.type&&(r.GoogleStreetView=pi.getGoogleStreetViewLink(e.geometry.coordinates[0],e.geometry.coordinates[1])),Object.assign({type:e.index},t,r)},mc.prototype.computeTerm=function(e){var r=this;return(e.match(/(#[^\s]+)/g)||[]).some(function(e){var t=e.substring(1);return r.hashtagsLieuxToKeep.some(function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})})||(e=e.replace(/(#[^\s]*)/g,"")),e.replace(/[^\w- !\-\(\),'#]+/g,"")},mc.prototype.computeOptionsParam=function(e,t){var r=gc.prototype.getHashtagsValid.call(this,e,"type");return r&&(t.params=Object.assign(t.params||{},{type:r.join(",")})),t},mc.id="icherche",mc.type=rr,mc.propertiesBlacklist=[],mc.decorators=[{type:Le.Injectable}],mc.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.LanguageService},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]},{type:dc,decorators:[{type:Le.Inject,args:[dc]}]},{type:Le.Injector}]},mc);function mc(e,t,r,o,n){var i=gc.call(this,r)||this;i.http=e,i.languageService=t,i.formatter=o,i.title$=new Ce.BehaviorSubject(""),i.hashtagsLieuxToKeep=[],i.languageService.translate.get(i.options.title).subscribe(function(e){return i.title$.next(e)});var a=n.get(me.AuthService);return i.settings.length&&(a?a.authenticate$.subscribe(function(){i.getAllowedTypes()}):i.getAllowedTypes()),i}var yc,vc=(qe(bc,yc=ai),Object.defineProperty(bc.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),bc.prototype.getId=function(){return bc.id},bc.prototype.getType=function(){return bc.type},bc.prototype.getDefaultOptions=function(){var e=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==e.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==e.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==e.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==e.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==e.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==e.indexOf("regadmin")}]},{type:"radiobutton",title:"radius",name:"buffer",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}},bc.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return o.get("type").length?this.http.get(this.searchUrl+"/locate",{params:o}).pipe(De.map(function(e){return r.extractResults(e)})):Ce.of([])},bc.prototype.getAllowedTypes=function(){var e=this;return this.http.get(this.searchUrl+"/types").subscribe(function(t){e.settings.find(function(e){return"type"===e.name}).values.forEach(function(e){e.available=-1<t.indexOf(e.value)})})},bc.prototype.computeRequestParams=function(e,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{buffer:t.distance||this.options.distance})),new Pe.HttpParams({fromObject:Object.assign({loc:e.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})},bc.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},bc.prototype.getSubtitle=function(t){if(!this.settings.length)return"";var e="";switch(t.properties.type){case"arrondissements":e=t.properties.municipalite+" (Arrondissement)";break;default:var r=this.settings.find(function(e){return"type"===e.name}).values.find(function(e){return e.value===t.properties.type});r&&(e=this.languageService.translate.instant(r.title))}return e},bc.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeExtent(e),o=[this.getId(),t.type,t.code].join("."),n=e.properties.nom,i=" <small> "+this.getSubtitle(e)+"</small>";return{source:this,data:{type:rr,projection:"EPSG:4326",geometry:e.geometry,extent:r,properties:t,meta:{id:o,title:e.properties.nom}},meta:{dataType:rr,id:o,title:e.properties.nom,titleHtml:n+i,icon:e.icon||"map-marker"}}},bc.prototype.computeProperties=function(e){return ke.ObjectUtils.removeKeys(e.properties,bc.propertiesBlacklist)},bc.prototype.computeExtent=function(e){return e.bbox?[e.bbox[0],e.bbox[2],e.bbox[1],e.bbox[3]]:undefined},bc.id="icherchereverse",bc.type=rr,bc.propertiesBlacklist=[],bc.decorators=[{type:Le.Injectable}],bc.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.LanguageService},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]},{type:Le.Injector}]},bc);function bc(e,t,r,o){var n=yc.call(this,r)||this;n.http=e,n.languageService=t,n.title$=new Ce.BehaviorSubject(""),n.languageService.translate.get(n.options.title).subscribe(function(e){return n.title$.next(e)});var i=o.get(me.AuthService);return n.settings.length&&(i?i.authenticate$.subscribe(function(){n.getAllowedTypes()}):n.getAllowedTypes()),n}function Sc(e){return new dc(e)}function wc(){return{provide:dc,useFactory:Sc,deps:[je.LanguageService]}}function Ic(e,t,r,o,n){return new fc(e,t,r.getConfig("searchSources."+fc.id),o,n)}function Fc(e,t,r,o){return new vc(e,t,r.getConfig("searchSources."+vc.id),o)}var Oc=(Tc.prototype.formatResult=function(e){return e},Tc.decorators=[{type:Le.Injectable}],Tc.ctorParameters=function(){return[{type:je.LanguageService}]},Tc);function Tc(e){this.languageService=e}var xc,Cc=(qe(Mc,xc=ai),Object.defineProperty(Mc.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),Mc.prototype.getId=function(){return Mc.id},Mc.prototype.getType=function(){return Mc.type},Mc.prototype.getDefaultOptions=function(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}},Mc.prototype.reverseSearch=function(e,t){return Ce.of([this.dataToResult(e)])},Mc.prototype.dataToResult=function(e){var t=Zo(e,this.projections).reduce(function(e,t){return e[t.alias]=t.igo2CoordFormat,e},{}),r=Yo(e,6).join(", "),o={};return o[this.languageService.translate.instant("igo.geo.search.coordinates.coord")]=r,{source:this,data:{type:rr,projection:"EPSG:4326",geometry:{type:"Point",coordinates:[e[0],e[1]]},extent:undefined,properties:Object.assign({},o,t,{GoogleMaps:pi.getGoogleMapsLink(e[0],e[1]),GoogleStreetView:pi.getGoogleStreetViewLink(e[0],e[1]),OpenStreetMap:hi.getOpenStreetMapLink(e[0],e[1],14)}),meta:{id:e[0].toString()+","+e[1].toString(),title:r}},meta:{dataType:rr,id:e[0].toString()+","+e[1].toString(),title:r,icon:"map-marker"}}},Mc.id="coordinatesreverse",Mc.type=rr,Mc.decorators=[{type:Le.Injectable}],Mc.ctorParameters=function(){return[{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]},{type:je.LanguageService},{type:Array,decorators:[{type:Le.Inject,args:["projections"]}]}]},Mc);function Mc(e,t,r){var o=xc.call(this,e)||this;return o.languageService=t,o.title$=new Ce.BehaviorSubject(""),o.projections=r,o.languageService.translate.get(o.options.title).subscribe(function(e){return o.title$.next(e)}),o}function Lc(e){return new Oc(e)}function Pc(){return{provide:Oc,useFactory:Lc,deps:[je.LanguageService]}}function Dc(e,t){return new Cc(e.getConfig("searchSources."+Cc.id),t,e.getConfig("projections")||[])}var kc=(jc.prototype.formatResult=function(e){var s=this,r=["title","abstract","groupTitle","metadataUrl"],t=Object.entries(e.properties).filter(function(e){var t=ze(e,1)[0];return-1!==r.indexOf(t)}).reduce(function(e,t){var r,o=ze(t,2),n=o[0],i=o[1];try{r=s.languageService.translate.instant("igo.geo.search.ilayer.properties."+n)}catch(a){r=n}return e[r]=i||"",e},{}),o=Object.assign({},e);return o.properties=t,o},jc.decorators=[{type:Le.Injectable}],jc.ctorParameters=function(){return[{type:je.LanguageService}]},jc);function jc(e){this.languageService=e}var Ec,Rc=(qe($c,Ec=ai),Object.defineProperty($c.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),$c.prototype.getId=function(){return $c.id},$c.prototype.getType=function(){return $c.type},$c.prototype.getDefaultOptions=function(){var e=this.options.params&&this.options.params.limit?Number(this.options.params.limit):undefined;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===e},{title:"5",value:5,enabled:5===e||!e},{title:"10",value:10,enabled:10===e},{title:"25",value:25,enabled:25===e},{title:"50",value:50,enabled:50===e}]}]}},$c.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return o.get("q")&&o.get("type")?(this.options.params.page=o.get("page")||"1",this.http.get(this.searchUrl,{params:o}).pipe(De.map(function(e){return r.extractResults(e)}))):Ce.of([])},$c.prototype.computeSearchRequestParams=function(e,t){return new Pe.HttpParams({fromObject:ke.ObjectUtils.removeUndefined(Object.assign({q:this.computeTerm(e)},this.params,this.computeOptionsParam(e,t||{}).params,{page:t.page}))})},$c.prototype.computeTerm=function(e){return e.replace(/(#[^\s]*)/g,"").replace(/[^\w- !\-\(\),'#]+/g,"")},$c.prototype.computeOptionsParam=function(e,t){var r=Ec.prototype.getHashtagsValid.call(this,e,"type");return r&&(t.params=Object.assign(t.params||{},{type:r.join(",")})),t},$c.prototype.extractResults=function(t){var r=this;return t.items.map(function(e){return r.dataToResult(e,t)})},$c.prototype.dataToResult=function(e,t){var r=this.computeLayerOptions(e),o=e.highlight.title||e.properties.title,n=e.highlight.groupTitle||e.properties.groupTitle,i=n?' <small style="color: #6f6969"> '+n+"</small>":"";return{source:this,meta:{dataType:nr,id:[this.getId(),e.properties.id].join("."),title:e.properties.title,titleHtml:o+i,icon:"Layer"===e.properties.type?"layers":"map",nextPage:t.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:r}},$c.prototype.computeLayerOptions=function(e){var t=e.properties.url,r=this.extractQueryParamsFromSourceUrl(t);return{sourceOptions:{id:e.properties.id,crossOrigin:"anonymous",type:e.properties.format,url:t,queryFormat:r.queryFormat,queryHtmlTarget:r.queryHtmlTarget,queryable:e.properties.queryable,params:{LAYERS:e.properties.name}},title:e.properties.title,maxResolution:zo(Number(e.properties.maxScaleDenom))||Infinity,minResolution:zo(Number(e.properties.minScaleDenom))||0,metadata:{url:e.properties.metadataUrl,extern:!0},properties:this.formatter.formatResult(e).properties}},$c.prototype.extractQueryParamsFromSourceUrl=function(o){var e,t,r,n=Pt.GML2,i=this.options.queryFormat;if(i){var a=function(t){var e=i[t];if("*"===e)return n=Pt[t.toUpperCase()],"break";var r=e.urls;return Array.isArray(r)?(r.forEach(function(e){-1!==o.indexOf(e)&&(n=Pt[t.toUpperCase()])}),"break"):void 0};try{for(var s=We(Object.keys(i)),l=s.next();!l.done&&"break"!==a(l.value);l=s.next());}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}}return n===Pt.HTML&&(r="iframe"),{queryFormat:n,queryHtmlTarget:r}},$c.id="ilayer",$c.type=nr,$c.decorators=[{type:Le.Injectable}],$c.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.LanguageService},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]},{type:kc,decorators:[{type:Le.Inject,args:[kc]}]}]},$c);function $c(e,t,r,o){var n=Ec.call(this,r)||this;return n.http=e,n.languageService=t,n.formatter=o,n.title$=new Ce.BehaviorSubject(""),n.languageService.translate.get(n.options.title).subscribe(function(e){return n.title$.next(e)}),n}function Ac(e){return new kc(e)}function Gc(){return{provide:kc,useFactory:Ac,deps:[je.LanguageService]}}function Bc(e,t,r,o){return new Rc(e,t,r.getConfig("searchSources."+Rc.id),o)}var _c=[rr,nr],qc=(Object.defineProperty(Nc.prototype,"searchType",{get:function(){return this.searchType$.value},set:function(e){this.setSearchType(e)},enumerable:!0,configurable:!0}),Nc.prototype.ngOnInit=function(){var t=this;this.searchType$$=this.searchType$.pipe(De.distinctUntilChanged()).subscribe(function(e){return t.onSetSearchType(e)})},Nc.prototype.ngOnDestroy=function(){this.searchType$$.unsubscribe()},Nc.prototype.onSearchTypeChange=function(e){this.setSearchType(e)},Nc.prototype.getSearchTypeTitle=function(e){return"igo.geo.search."+e.toLowerCase()+".title"},Nc.prototype.setSearchType=function(e){this.searchType$.next(e)},Nc.prototype.onSetSearchType=function(e){e!==undefined&&null!==e&&(this.searchSourceService.enableSourcesByType(e),this.searchTypeChange.emit(e))},Nc.decorators=[{type:Le.Component,args:[{selector:"igo-search-selector",template:'<div class="igo-search-selector">\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-selector-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSelectorMenu">\r\n    <mat-icon svgIcon="menu-down"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #searchSelectorMenu="matMenu"\r\n    class="no-border-radius"\r\n    xPosition="before"\r\n    yPosition="above">\r\n    <mat-radio-group\r\n      class="igo-search-selector-radio-group"\r\n      [value]="searchType$ | async"\r\n      (change)="onSearchTypeChange($event.value)">\r\n      <mat-radio-button *ngFor="let searchType of searchTypes" [value]="searchType">\r\n        {{getSearchTypeTitle(searchType) | translate}}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </mat-menu>\r\n\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".igo-search-selector-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-selector-radio-group{display:-webkit-inline-box;display:inline-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.igo-search-selector-radio-group mat-radio-button{margin:5px}"]}]}],Nc.ctorParameters=function(){return[{type:Nu}]},Nc.propDecorators={searchTypes:[{type:Le.Input}],searchType:[{type:Le.Input}],searchTypeChange:[{type:Le.Output}]},Nc);function Nc(e){this.searchSourceService=e,this.searchType$=new Ce.BehaviorSubject(undefined),this.searchTypes=_c,this.searchTypeChange=new Le.EventEmitter}var Vc=(Uc.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatMenuModule,Fe.MatRadioModule,Fe.MatTabsModule,Fe.MatCheckboxModule,je.IgoLanguageModule],exports:[qc],declarations:[qc]}]}],Uc);function Uc(){}var Wc=(Object.defineProperty(zc.prototype,"isTouchScreen",{get:function(){return this.mediaService.isTouchScreen()},enumerable:!0,configurable:!0}),zc.prototype.handleKeyboardEvent=function(e){113===e.keyCode&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))},zc.prototype.ngOnInit=function(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()},zc.prototype.getSearchSources=function(){var e=this.searchSourceService.getSources().filter(Uu).filter(function(e){return e.available&&"map"!==e.getId()&&e.showInSettings}),t=this.searchSourceService.getSources().filter(Wu).filter(function(e){return e.available&&"map"!==e.getId()&&e.showInSettings});return e.concat(t)},zc.prototype.hasReverseSearchSourcesForPointerSummary=function(){return!!this.searchSourceService.getEnabledSources().filter(zu).length},zc.prototype.settingsValueCheckedCheckbox=function(e,t,r,o){o.enabled=e.checked,t.setParamFromSetting(r),this.searchSourceChange.emit(t)},zc.prototype.computeCheckAllBehavior=function(e){e.allEnabled===undefined?e.values.find(function(e){return e.enabled})?e.allEnabled=!1:e.allEnabled=!0:e.allEnabled=!e.allEnabled},zc.prototype.checkUncheckAll=function(e,t,r){e.stopPropagation(),this.computeCheckAllBehavior(r),r.values.forEach(function(e){e.enabled=r.allEnabled}),t.setParamFromSetting(r),this.searchSourceChange.emit(t)},zc.prototype.settingsValueCheckedRadioButton=function(t,e,r,o){r.values.forEach(function(e){e.value!==o.value?e.enabled=!t.source.checked:e.enabled=t.source.checked}),e.setParamFromSetting(r),this.searchSourceChange.emit(e)},zc.prototype.onCheckSearchSource=function(e,t){t.enabled=e.checked,this.searchSourceChange.emit(t)},zc.prototype.getAvailableValues=function(e){return e.values.filter(function(e){return!1!==e.available})},zc.prototype.getAvailableHashtagsValues=function(e){var t,r;if(e.hashtags){var o=[];try{for(var n=We(e.hashtags),i=n.next();!i.done;i=n.next()){var a=i.value;a="#"+a,o.push(a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}return o}},zc.prototype.stopPropagation=function(e){e.stopPropagation()},zc.prototype.changePointerReverseSearch=function(e,t){t?(e.stopPropagation(),this.pointerSummaryEnabled=!this.pointerSummaryEnabled):this.pointerSummaryEnabled=e.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)},zc.decorators=[{type:Le.Component,args:[{selector:"igo-search-settings",template:'<div class="igo-search-settings">\r\n\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-settings-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSettingsMenu">\r\n    <mat-icon svgIcon="chevron-down"></mat-icon>\r\n  </button>\r\n  <mat-menu\r\n    #searchSettingsMenu="matMenu"\r\n    class="no-border-radius">\r\n      <ng-container *ngFor="let source of getSearchSources()">\r\n        <span class="igo-search-settings-search-source">\r\n          <mat-checkbox\r\n            class="igo-search-settings-checkbox"\r\n            [checked]="source.enabled"\r\n            [value]="source"\r\n            (click)="$event.stopPropagation()"\r\n            (change)="onCheckSearchSource($event, source)">\r\n          </mat-checkbox>\r\n          <button *ngIf="source.settings.length>0"\r\n            [matMenuTriggerFor]="sub_menu"\r\n            mat-menu-item>{{source.title}}\r\n          </button>\r\n          <button\r\n            mat-menu-item\r\n            *ngIf="source.settings.length===0">\r\n            {{source.title}}\r\n          </button>\r\n        </span>\r\n          <mat-menu #sub_menu="matMenu">\r\n            <ng-container *ngFor="let setting of source.settings">\r\n              <button\r\n                  mat-menu-item\r\n                  [matMenuTriggerFor]="test_sub_menu">\r\n                {{\'igo.geo.search.searchSources.settings.\'+ setting.title | translate}}\r\n              </button>\r\n              <mat-menu #test_sub_menu="matMenu"\r\n                [ngSwitch]="setting.type"\r\n                yPosition="above">\r\n                <span *ngSwitchCase="\'radiobutton\'">\r\n                  <mat-radio-group\r\n                    class="igo-search-settings-radio-group"\r\n                    [value]="setting">\r\n                    <mat-radio-button *ngFor="let settingValue of setting.values"\r\n                      class="mat-typography"\r\n                      [value]="settingValue"\r\n                      [checked]="settingValue.enabled"\r\n                      (click)="$event.stopPropagation()"\r\n                      (change)="settingsValueCheckedRadioButton($event, source, setting, settingValue)">\r\n                      {{settingValue.title | translate}}\r\n                    </mat-radio-button>\r\n                  </mat-radio-group>\r\n                </span>\r\n                <span *ngSwitchCase="\'checkbox\'">\r\n                  <div class="checkAllButton" *ngIf="setting.values.length>3">\r\n                    <button mat-raised-button\r\n                      (click)="checkUncheckAll($event, source, setting)">{{setting.allEnabled || setting.allEnabled === undefined  ? (\'igo.geo.search.searchSources.settings.unselectAll\' | translate): (\'igo.geo.search.searchSources.settings.selectAll\' | translate)}}</button>\r\n                  </div>\r\n                  <mat-checkbox *ngFor="let settingValue of getAvailableValues(setting)"\r\n                    class="mat-menu-item"\r\n                    [checked]="settingValue.enabled"\r\n                    [value]="setting"\r\n                    [matTooltip]="getAvailableHashtagsValues(settingValue)"\r\n                    (click)="$event.stopPropagation()"\r\n                    (change)="settingsValueCheckedCheckbox($event, source, setting, settingValue)">\r\n                    {{settingValue.title | translate}}\r\n                  </mat-checkbox>\r\n                </span>\r\n              </mat-menu>\r\n            </ng-container>\r\n          </mat-menu>\r\n      </ng-container>\r\n      <span *ngIf="hasPointerReverseSearchSource && !isTouchScreen">\r\n        <mat-divider></mat-divider>\r\n        <span class="pointer-summary-slide-toggle-container mat-typography">\r\n          <mat-slide-toggle class="pointer-summary-option" (change)="changePointerReverseSearch($event)" tooltip-position="below"\r\n            matTooltipShowDelay="500" [matTooltip]="\'igo.geo.search.pointerSearchSummary.tooltip\' | translate"\r\n            (click)="$event.stopPropagation()" [checked]="pointerSummaryEnabled" [labelPosition]="\'after\'">\r\n            {{\'igo.geo.search.pointerSearchSummary.title\' | translate}}\r\n          </mat-slide-toggle>\r\n        </span>\r\n      </span>\r\n  </mat-menu>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".checkAllButton{text-align:center;padding:0 5px}.igo-search-settings-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-settings-radio-group{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.igo-search-settings-radio-group mat-radio-button{margin:5px}.igo-search-settings-checkbox mat-radio-button{display:-webkit-box;display:flex}.igo-search-settings-search-source{display:-webkit-box;display:flex;width:100%}.igo-search-settings-search-source mat-checkbox{display:-webkit-box;display:flex;margin-left:5px;margin-right:5px}.pointer-summary-option{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container{overflow-x:hidden}.pointer-summary-slide-toggle-container mat-slide-toggle{margin:10px}"]}]}],zc.ctorParameters=function(){return[{type:Nu},{type:je.MediaService}]},zc.propDecorators={pointerSummaryEnabled:[{type:Le.Input}],searchSourceChange:[{type:Le.Output}],pointerSummaryStatus:[{type:Le.Output}],handleKeyboardEvent:[{type:Le.HostListener,args:["document:keydown",["$event"]]}]},zc);function zc(e,t){this.searchSourceService=e,this.mediaService=t,this.hasPointerReverseSearchSource=!1,this.buffer=[],this.lastKeyTime=Date.now(),this.pointerSummaryEnabled=!1,this.searchSourceChange=new Le.EventEmitter,this.pointerSummaryStatus=new Le.EventEmitter}var Kc=(Hc.decorators=[{type:Le.NgModule,args:[{declarations:[Wc],imports:[Oe.CommonModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatMenuModule,Fe.MatRadioModule,Fe.MatCheckboxModule,Fe.MatDividerModule,Fe.MatSlideToggleModule,je.IgoLanguageModule],exports:[Wc]}]}],Hc);function Hc(){}var Yc=(Object.defineProperty(Zc.prototype,"searchType",{get:function(){return this.searchType$.value},set:function(e){this.setSearchType(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"term",{get:function(){return this.term$.value},set:function(e){this.setTerm(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"disabled",{get:function(){return this.disabled$.value},set:function(e){this.disabled$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Zc.prototype,"empty",{get:function(){return 0===this.term.length},enumerable:!0,configurable:!0}),Zc.prototype.ngOnInit=function(){var t=this;this.term$$=this.term$.subscribe(function(e){t.empty$.next(e===undefined||0===e.length)}),this.stream$$=this.stream$.pipe(De.debounce(function(e){return""===e?Ce.EMPTY:Ce.timer(t.debounce)})).subscribe(function(e){return t.onSetTerm(e)}),this.searchType$$=this.searchType$.pipe(De.distinctUntilChanged()).subscribe(function(e){return t.onSetSearchType(e)})},Zc.prototype.ngOnDestroy=function(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()},Zc.prototype.onKeyup=function(e){var t=e.key;if(this.keyIsValid(t)){var r=e.target.value;this.setTerm(r)}},Zc.prototype.onClearButtonClick=function(){this.clear(),this.clearFeature.emit()},Zc.prototype.onSearchTypeChange=function(e){this.setSearchType(e)},Zc.prototype.setSearchType=function(e){this.searchType$.next(e)},Zc.prototype.onSearchSettingsChange=function(){this.doSearch(this.term),this.searchSettingsChange.emit()},Zc.prototype.setTerm=function(e){if(!this.disabled){(e=e||"")!==this.term&&this.term$.next(e);var t=e.replace(/(#[^\s]*)/g,"").trim();(t.length>=this.minLength||0===t.length)&&this.stream$.next(e)}},Zc.prototype.clear=function(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()},Zc.prototype.keyIsValid=function(e){return-1===Zc.invalidKeys.indexOf(e)},Zc.prototype.onSetTerm=function(e){this.searchTermChange.emit(e),this.doSearch(e)},Zc.prototype.onSetSearchType=function(e){if(e!==undefined&&null!==e){this.searchTypeChange.emit(e);var t="igo.geo.search."+e.toLowerCase()+".placeholder";this.placeholder$.next(t),this.setTerm(this.term)}},Zc.prototype.doSearch=function(e){var r=this;""!==(e?e.replace(/(#[^\s]*)/g,"").trim():"")?(this.store!==undefined&&this.store.softClear(),this.searchService.search(e,{forceNA:this.forceNA}).map(function(t){t.request.subscribe(function(e){r.onResearchCompleted(t,e)})})):this.store!==undefined&&this.store.clear()},Zc.prototype.onResearchCompleted=function(t,e){if(this.search.emit({research:t,results:e}),this.store!==undefined){var r=this.store.all().filter(function(e){return e.source!==t.source}).concat(e);this.store.load(r)}},Zc.invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"],Zc.decorators=[{type:Le.Component,args:[{selector:"igo-search-bar",template:'<div class="igo-search-bar-container" [ngClass]="{empty: empty$ | async}">\r\n  <mat-form-field [floatLabel]="floatLabel">\r\n    <input\r\n      #input\r\n      matInput\r\n      autocomplete="off"\r\n      [ngClass]="{\'hasSearchIcon\': searchIcon}"\r\n      [disabled]="disabled$ | async"\r\n      [placeholder]="(placeholder$ | async) ? (placeholder$.value | translate) : undefined"\r\n      [value]="term$ | async"\r\n      (keyup)="onKeyup($event)"\r\n      (touchend)="onKeyup($event)">\r\n  </mat-form-field>\r\n\r\n  <div class="search-bar-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [color]="color"\r\n      *ngIf="searchIcon !== undefined">\r\n      <mat-icon svgIcon="{{searchIcon}}"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf="!(empty$ | async)"\r\n      mat-icon-button\r\n      [color]="color"\r\n      (click)="onClearButtonClick()">\r\n      <mat-icon svgIcon="close"></mat-icon>\r\n    </button>\r\n\r\n    <igo-search-selector\r\n      *ngIf="searchSelector"\r\n      [searchTypes]="searchTypes"\r\n      [searchType]="searchType$ | async"\r\n      (searchTypeChange)="onSearchTypeChange($event)">\r\n    </igo-search-selector>\r\n\r\n    <igo-search-settings\r\n      *ngIf="searchSettings"\r\n      [pointerSummaryEnabled]="pointerSummaryEnabled"\r\n      (pointerSummaryStatus)="pointerSummaryStatus.emit($event)"\r\n      (searchSourceChange)="onSearchSettingsChange()">\r\n    </igo-search-settings>\r\n  </div>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep .mat-form-field{padding:0 5px}:host ::ng-deep .mat-form-field-wrapper{margin-bottom:-1.5em}:host ::ng-deep span.mat-form-field-label-wrapper{top:-20px}:host ::ng-deep div.mat-form-field-infix{left:5px;right:5px;padding:0 0 12px!important}:host ::ng-deep div.mat-form-field-underline{display:none}.igo-search-bar-container{position:relative;width:100%;display:-webkit-inline-box;display:inline-flex;overflow:hidden}.igo-search-bar-container>mat-form-field{width:calc(100% - (2 * 40px))}.igo-search-bar-container.empty>mat-form-field{width:calc(100% - 40px)}.search-bar-buttons{position:relative;right:0;display:-webkit-inline-box;display:inline-flex;top:0}.search-bar-buttons>button:nth-child(2)::before{content:'';left:0;top:5px;border-right:1px solid #ddd;height:28px}igo-search-selector,igo-search-settings{background-color:#fff;top:0;border-radius:0}"]}]}],Zc.ctorParameters=function(){return[{type:je.LanguageService},{type:Ku}]},Zc.propDecorators={searchTypes:[{type:Le.Input}],searchType:[{type:Le.Input}],pointerSummaryStatus:[{type:Le.Output}],term:[{type:Le.Input}],disabled:[{type:Le.Input}],pointerSummaryEnabled:[{type:Le.Input}],floatLabel:[{type:Le.Input}],color:[{type:Le.Input}],debounce:[{type:Le.Input}],minLength:[{type:Le.Input}],searchIcon:[{type:Le.Input}],searchSelector:[{type:Le.Input}],searchSettings:[{type:Le.Input}],forceNA:[{type:Le.Input}],store:[{type:Le.Input}],searchTermChange:[{type:Le.Output}],search:[{type:Le.Output}],searchTypeChange:[{type:Le.Output}],clearFeature:[{type:Le.Output}],searchSettingsChange:[{type:Le.Output}],input:[{type:Le.ViewChild,args:["input"]}]},Zc);function Zc(e,t){this.languageService=e,this.searchService=t,this.placeholder$=new Ce.BehaviorSubject("igo.geo.search.placeholder"),this.empty$=new Ce.BehaviorSubject(!0),this.stream$=new Ce.BehaviorSubject(""),this.searchTypes=_c,this.searchType$=new Ce.BehaviorSubject(undefined),this.pointerSummaryStatus=new Le.EventEmitter,this.term$=new Ce.BehaviorSubject(""),this.disabled$=new Ce.BehaviorSubject(!1),this.pointerSummaryEnabled=!1,this.floatLabel="never",this.color="primary",this.debounce=200,this.minLength=2,this.searchSelector=!1,this.searchSettings=!1,this.forceNA=!1,this.searchTermChange=new Le.EventEmitter,this.search=new Le.EventEmitter,this.searchTypeChange=new Le.EventEmitter,this.clearFeature=new Le.EventEmitter,this.searchSettingsChange=new Le.EventEmitter}var Qc=(Jc.prototype.ngOnInit=function(){var r=this;this.route&&this.route.options.searchKey&&this.route.queryParams.subscribe(function(e){var t=e[r.route.options.searchKey];t&&(r.component.setTerm(t),r.ref.detectChanges())})},Jc.decorators=[{type:Le.Directive,args:[{selector:"[igoSearchUrlParam]"}]}],Jc.ctorParameters=function(){return[{type:Yc,decorators:[{type:Le.Self}]},{type:Le.ChangeDetectorRef},{type:je.RouteService,decorators:[{type:Le.Optional}]}]},Jc);function Jc(e,t,r){this.component=e,this.ref=t,this.route=r}var Xc=(ep.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,ye.FormsModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatMenuModule,Fe.MatRadioModule,Fe.MatFormFieldModule,Fe.MatInputModule,je.IgoLanguageModule,Vc,Kc],exports:[Yc],declarations:[Yc,Qc]}]}],ep);function ep(){}var tp={Grouped:"grouped",Flat:"flat"},rp=(Object.defineProperty(op.prototype,"term",{get:function(){return this._term},set:function(e){this._term=e,this.pageIterator=[]},enumerable:!0,configurable:!0}),Object.defineProperty(op.prototype,"results$",{get:function(){return this._results$===undefined&&(this._results$=this.liftResults()),this._results$},enumerable:!0,configurable:!0}),op.prototype.ngOnInit=function(){var e=this;this.watcher=new Te.EntityStoreWatcher(this.store,this.cdRef),this.settingsChange$.subscribe(function(){e.pageIterator=[]})},op.prototype.ngOnDestroy=function(){this.watcher.destroy()},op.prototype.onResultFocus=function(e){this.store.state.get(e)&&!0===this.store.state.get(e).focused||(this.store.state.update(e,{focused:!0},!0),this.resultFocus.emit(e))},op.prototype.onResultUnfocus=function(e){this.resultUnfocus.emit(e)},op.prototype.computeGroupTitle=function(e){var t=[e.source.title],r=e.results.length;return 1<r&&t.push("("+r+")"),t.join(" ")},op.prototype.onResultSelect=function(e){this.store.state.get(e)&&!0===this.store.state.get(e).selected||(this.store.state.update(e,{focused:!0,selected:!0},!0),this.resultSelect.emit(e))},op.prototype.liftResults=function(){var t=this;return this.store.view.all$().pipe(De.debounce(function(e){return 0===e.length?Ce.EMPTY:Ce.timer(200)}),De.map(function(e){return t.groupResults(e.sort(t.sortByOrder))}))},op.prototype.sortByOrder=function(e,t){return e.source.displayOrder-t.source.displayOrder},op.prototype.groupResults=function(e){var t=this,o=new Map;return e.forEach(function(e){var t=e.source,r=o.get(t);r===undefined&&(r=[],o.set(t,r)),r.push(e)}),Array.from(o.keys()).map(function(e){return t.pageIterator[e.getId()]===undefined&&(t.pageIterator[e.getId()]=1),{source:e,results:o.get(e)}})},op.prototype.isMoreResults=function(e){return e.results&&!0===e.results[e.results.length-1].meta.nextPage},op.prototype.displayMoreResults=function(o){var n=this,e={sourceId:o.source.getId(),page:++this.pageIterator[o.source.getId()]};this.searchService.search(this.term,e).map(function(r){r.request.subscribe(function(e){var t=o.results.concat(e);e.length||(t[t.length-1].meta.nextPage=!1),n.moreResults.emit({research:r,results:t})})})},op.decorators=[{type:Le.Component,args:[{selector:"igo-search-results",template:'<igo-list [navigation]="true">\r\n  <ng-template\r\n    #groupTemplate\r\n    ngFor let-group\r\n    [ngForOf]="results$ | async">\r\n\r\n    <igo-collapsible\r\n      *ngIf="mode === searchResultMode.Grouped; else flatTemplate"\r\n      [title]="computeGroupTitle(group)"\r\n      [collapsed]="collapsed[group.source.title]"\r\n      (toggle)="collapsed[group.source.title] = $event">\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </igo-collapsible>\r\n\r\n    <ng-template #flatTemplate>\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </ng-template>\r\n\r\n    <ng-template #storeItemTemplate let-results="results">\r\n      <ng-template ngFor let-result [ngForOf]="results">\r\n        <igo-search-results-item\r\n          igoListItem\r\n          color="accent"\r\n          [map]="map"\r\n          [result]="result"\r\n          [showIcons]="showIcons"\r\n          [withZoomButton]="withZoomButton"\r\n          [focused]="store.state.get(result).focused"\r\n          [selected]="store.state.get(result).selected"\r\n          (focus)="onResultFocus(result)"\r\n          (unfocus)="onResultUnfocus(result)"\r\n          (select)="onResultSelect(result)"\r\n          (mouseenter)="resultMouseenter.emit(result)"\r\n          (mouseleave)="resultMouseleave.emit(result)">\r\n\r\n          <ng-container igoSearchItemToolbar\r\n            [ngTemplateOutlet]="templateSearchToolbar"\r\n            [ngTemplateOutletContext]="{result: result}">\r\n          </ng-container>\r\n\r\n        </igo-search-results-item>\r\n      </ng-template>\r\n      <span class="moreResults mat-typography" *ngIf="isMoreResults(group)" (click)="displayMoreResults(group)">\r\n        <u>{{ \'igo.geo.search.displayMoreResults\' | translate }}</u>\r\n      </span>\r\n    </ng-template>\r\n\r\n  </ng-template>\r\n\r\n</igo-list>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".moreResults{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}"]}]}],op.ctorParameters=function(){return[{type:Le.ChangeDetectorRef},{type:Ku}]},op.propDecorators={map:[{type:Le.Input}],store:[{type:Le.Input}],showIcons:[{type:Le.Input}],mode:[{type:Le.Input}],withZoomButton:[{type:Le.Input}],term:[{type:Le.Input}],settingsChange$:[{type:Le.Input}],resultFocus:[{type:Le.Output}],resultUnfocus:[{type:Le.Output}],resultSelect:[{type:Le.Output}],moreResults:[{type:Le.Output}],resultMouseenter:[{type:Le.Output}],resultMouseleave:[{type:Le.Output}],templateSearchToolbar:[{type:Le.ContentChild,args:["igoSearchItemToolbar"]}]},op);function op(e,t){this.cdRef=e,this.searchService=t,this.searchResultMode=tp,this.pageIterator=[],this.collapsed=[],this.mode=tp.Grouped,this.withZoomButton=!1,this.settingsChange$=new Ce.BehaviorSubject(undefined),this.resultFocus=new Le.EventEmitter,this.resultUnfocus=new Le.EventEmitter,this.resultSelect=new Le.EventEmitter,this.moreResults=new Le.EventEmitter,this.resultMouseenter=new Le.EventEmitter,this.resultMouseleave=new Le.EventEmitter}var np=(Object.defineProperty(ip.prototype,"title",{get:function(){return Te.getEntityTitle(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(ip.prototype,"titleHtml",{get:function(){return Te.getEntityTitleHtml(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(ip.prototype,"tooltipHtml",{get:function(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")},enumerable:!0,configurable:!0}),Object.defineProperty(ip.prototype,"icon",{get:function(){return Te.getEntityIcon(this.result)},enumerable:!0,configurable:!0}),ip.prototype.onZoomHandler=function(){var e=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});Lo(this.map,[e],or.Default)},ip.decorators=[{type:Le.Component,args:[{selector:"igo-search-results-item",template:'<mat-list-item>\r\n  <mat-icon *ngIf="icon" mat-list-avatar svgIcon="{{showIcons ? icon : \'blank\'}}"></mat-icon>\r\n\r\n  <h4 matLine *ngIf="titleHtml" [innerHtml]="titleHtml" matTooltipShowDelay="500" [matTooltip]="tooltipHtml" matTooltipClass="search-result-tooltip"></h4>\r\n  <h4 matLine *ngIf="!titleHtml" matTooltipShowDelay="500" [matTooltip]="title">{{title}}</h4>\r\n\r\n  <button *ngIf="withZoomButton"\r\n    igoStopPropagation\r\n    mat-icon-button\r\n    (click)="onZoomHandler()">\r\n    <mat-icon svgIcon="magnify"></mat-icon>\r\n  </button>\r\n\r\n  <ng-content\r\n    select=[igoSearchItemToolbar]>\r\n  </ng-content>\r\n\r\n</mat-list-item>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep small{color:#8c8c8c}::ng-deep .search-result-tooltip{white-space:pre-line}"]}]}],ip.ctorParameters=function(){return[]},ip.propDecorators={result:[{type:Le.Input}],map:[{type:Le.Input}],showIcons:[{type:Le.Input}],withZoomButton:[{type:Le.Input}],zoomEvent:[{type:Le.Output}]},ip);function ip(){this.withZoomButton=!1,this.zoomEvent=new Le.EventEmitter,this.format=new Ie}var ap=(Object.defineProperty(sp.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),sp.prototype.ngOnInit=function(){var t=this;"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(function(e){return e.id===t.layer.data.sourceOptions.id})),this.resolution$$=this.map.viewController.resolution$.subscribe(function(e){t.isInResolutionsRange(e),t.tooltip$.next(t.computeTooltip())})},sp.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},sp.prototype.onMouseEvent=function(e){this.onToggleClick(e)},sp.prototype.onToggleClick=function(e){var t=this;switch("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),e.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add()),this.isPreview$.next(!1);break;case"mouseenter":this.isPreview$.value||this.added||(this.lastTimeoutRequest=setTimeout(function(){t.add(),t.isPreview$.next(!0)},500));break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1))}},sp.prototype.add=function(){this.added||(this.added=!0,this.addLayerToMap())},sp.prototype.remove=function(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(function(e){return e.unsubscribe()}),this.layersSubcriptions=[])},sp.prototype.addLayerToMap=function(){var t=this;if(this.map!==undefined){if(this.layer.meta.dataType!==nr)return undefined;var e=this.layer.data;this.layersSubcriptions.push(this.layerService.createAsyncLayer(e).subscribe(function(e){return t.map.addLayer(e)}))}},sp.prototype.removeLayerFromMap=function(){if(this.map!==undefined){if(this.layer.meta.dataType!==nr)return undefined;var e=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(e)}},sp.prototype.isInResolutionsRange=function(e){var t=this.layer.data.minResolution,r=this.layer.data.maxResolution;this.inRange$.next(t<=e&&e<=r)},sp.prototype.computeTooltip=function(){return this.added?this.inRange$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"},sp.decorators=[{type:Le.Component,args:[{selector:"igo-search-add-button",template:'<button\r\n(mouseenter)="onMouseEvent($event)" (mouseleave)="onMouseEvent($event)"\r\n*ngIf="layer.meta.dataType === \'Layer\'"\r\nmat-icon-button\r\ntooltip-position="below"\r\nmatTooltipShowDelay="500"\r\n[matTooltip]="(tooltip$ | async) | translate"\r\n[color]="(isPreview$ | async) ? \'\' : added ? \'warn\' : \'\'"\r\n(click)="onToggleClick($event)">\r\n<mat-icon \r\n  matBadge\r\n  igoMatBadgeIcon="eye-off"\r\n  [matBadgeHidden]="(inRange$ | async)"\r\n  matBadgeColor="primary" \r\n  matBadgeSize="small" \r\n  matBadgePosition="after"\r\n  [svgIcon]="(isPreview$ | async) ? \'plus\' : added ? \'delete\' : \'plus\'">\r\n</mat-icon>\r\n</button>',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[".mat-badge-small .mat-badge-content{color:rgba(0,0,0,.38)}"]}]}],sp.ctorParameters=function(){return[{type:An}]},sp.propDecorators={layer:[{type:Le.Input}],added:[{type:Le.Input}],map:[{type:Le.Input}],color:[{type:Le.Input}]},sp);function sp(e){this.layerService=e,this.tooltip$=new Ce.BehaviorSubject("igo.geo.catalog.layer.addToMap"),this.inRange$=new Ce.BehaviorSubject(!0),this.isPreview$=new Ce.BehaviorSubject(!1),this.layersSubcriptions=[],this._color="primary"}var lp=(up.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatBadgeModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatButtonModule,Te.IgoCollapsibleModule,Te.IgoListModule,Te.IgoStopPropagationModule,je.IgoLanguageModule,Te.IgoMatBadgeIconModule,Ge],exports:[rp,ap],declarations:[rp,np,ap]}]}],up);function up(){}var cp=(pp.prototype.mouseout=function(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()},Object.defineProperty(pp.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Object.defineProperty(pp.prototype,"mapProjection",{get:function(){return this.component.map.projection},enumerable:!0,configurable:!0}),pp.prototype.ngOnInit=function(){var e=this;this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.map.status$.pipe(De.take(1)).subscribe(function(){e.store=new ho([],{map:e.map}),e.initStore()})},pp.prototype.initStore=function(){Po(this.store,new Tr({title:"searchPointerSummary",zIndex:900,source:new nt,showInLayerList:!1,exportable:!1,browsable:!1,style:dp}))},pp.prototype.ngAfterContentChecked=function(){this.searchSourceService.getEnabledSources().filter(zu).length?this.hasPointerReverseSearchSource=!0:this.hasPointerReverseSearchSource=!1},pp.prototype.ngOnDestroy=function(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch()},pp.prototype.subscribeToPointerStore=function(){var t=this;this.store$$=this.pointerSearchStore.entities$.subscribe(function(e){t.entitiesToPointerOverlay(e)})},pp.prototype.computeSummaryClosestFeature=function(e){var r={};return e.map(function(e){if(e.data.properties.type&&0<=e.data.properties.distance)if(r.hasOwnProperty(e.data.properties.type)){var t=r[e.data.properties.type].distance;e.data.properties.distance<t&&(r[e.data.properties.type]={distance:e.data.properties.distance,title:e.meta.title})}else r[e.data.properties.type]={distance:e.data.properties.distance,title:e.meta.title}}),r},pp.prototype.entitiesToPointerOverlay=function(e){var r=this.computeSummaryClosestFeature(e),o=Object.keys(r),n=[],i=[];e.map(function(e){var t=o.indexOf(e.data.properties.type);-1!==t?(i.push(r[e.data.properties.type].title),o.splice(t,1),n.push(e.data.properties.type)):-1===n.indexOf(e.data.properties.type)&&i.push(e.meta.title)}),i.length&&this.addPointerOverlay(i.join("\n"))},pp.prototype.listenToMapPointerMove=function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(e){return t.onMapEvent(e)})},pp.prototype.unsubscribeToPointerStore=function(){this.store$$.unsubscribe()},pp.prototype.unsubscribeReverseSearch=function(){this.reverseSearch$$.map(function(e){return e.unsubscribe()}),this.reverseSearch$$=[]},pp.prototype.unlistenToMapPointerMove=function(){this.map.ol.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.pointerMoveListener=undefined},pp.prototype.onMapEvent=function(e){var t=this;!e.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?("undefined"!=typeof this.lastTimeoutRequest&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=be.transform(e.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(function(){t.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()},pp.prototype.onSearchCoordinate=function(){var r=this;this.pointerSearchStore.clear();var o=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0),e=function(t){0<o.length&&n.reverseSearch$$.push(o[t].request.subscribe(function(e){r.onSearch({research:o[t],results:e})}))},n=this;for(var t in o)e(t)},pp.prototype.onSearch=function(t){var e=t.results,r=this.pointerSearchStore.all().filter(function(e){return e.source!==t.research.source}).concat(e);this.pointerSearchStore.load(r)},pp.prototype.addPointerOverlay=function(e){this.clearLayer();var t=new we.Point(be.transform(this.lonLat,"EPSG:4326",this.mapProjection)),r=new ve({geometry:t}),o=(new Ie).writeGeometryObject(t,{featureProjection:this.mapProjection,dataProjection:this.mapProjection}),n={type:rr,geometry:o,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:e},meta:{id:this.searchPointerSummaryFeatureId},ol:r};this.store.setLayerFeatures([n],or.None)},pp.prototype.clearLayer=function(){this.store&&this.store.clearLayer()},pp.decorators=[{type:Le.Directive,args:[{selector:"[igoSearchPointerSummary]"}]}],pp.ctorParameters=function(){return[{type:Pr,decorators:[{type:Le.Self}]},{type:Ku},{type:Nu},{type:je.MediaService}]},pp.propDecorators={igoSearchPointerSummaryDelay:[{type:Le.Input}],igoSearchPointerSummaryEnabled:[{type:Le.Input}],mouseout:[{type:Le.HostListener,args:["mouseout"]}]},pp);function pp(e,t,r,o){this.component=e,this.searchService=t,this.searchSourceService=r,this.mediaService=o,this.pointerSearchStore=new Te.EntityStore([]),this.reverseSearch$$=[],this.hasPointerReverseSearchSource=!1,this.searchPointerSummaryFeatureId="searchPointerSummaryFeatureId",this.igoSearchPointerSummaryDelay=1e3,this.igoSearchPointerSummaryEnabled=!1}function dp(e,t){return new Se.Style({image:new Se.Icon({src:"./assets/igo2/geo/icons/cross_black_18px.svg",imgSize:[18,18]}),text:new Se.Text({text:e.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new Se.Fill({color:"#000"}),backgroundFill:new Se.Fill({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new Se.Stroke({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new Se.Stroke({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}var hp=(gp.forRoot=function(){return{ngModule:gp,providers:[pc(),wc(),Pc(),Gc()]}},gp.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Xc,Vc,lp,Kc],exports:[Xc,Vc,lp,Kc,cp],declarations:[cp]}]}],gp);function gp(){}var fp=(Object.defineProperty(mp.prototype,"expanded",{get:function(){return this._expanded},set:function(e){this.state=e?"expanded":"collapsed",this._expanded=e},enumerable:!0,configurable:!0}),Object.defineProperty(mp.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(mp.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e},enumerable:!0,configurable:!0}),Object.defineProperty(mp.prototype,"title",{get:function(){return Te.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),mp.prototype.toggle=function(){this.expanded=!this.expanded,this.opened.emit(this.expanded)},mp.prototype.zoomToFeatureExtent=function(){if(this.feature.geometry){var e=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projection});Lo(this.map,[e],or.Zoom)}},mp.prototype.swipe=function(e){e===mp.SWIPE_ACTION.UP?this.expanded||this.toggle():e===mp.SWIPE_ACTION.DOWN&&this.expanded&&this.toggle()},mp.SWIPE_ACTION={UP:"swipeup",DOWN:"swipedown"},mp.decorators=[{type:Le.Component,args:[{selector:"igo-toast",template:'<igo-flexible #flex\r\n  collapsedMobile="51px"\r\n  expandedMobile="300px"\r\n  [state]="state"\r\n  (swipeup)="swipe($event.type)"\r\n  (swipedown)="swipe($event.type)">\r\n\r\n  <igo-panel [title]="title">\r\n    <button\r\n      mat-icon-button\r\n      panelLeftButton\r\n      (click)="toggle()">\r\n      <mat-icon [svgIcon]="[\'collapsed\', \'initial\'].indexOf(flex.state) >= 0 ? \'arrow_upward\' : \'arrow_downward\'"></mat-icon>\r\n    </button>\r\n\r\n    <button mat-icon-button panelRightButton class="igo-icon-button" (click)="zoomToFeatureExtent()" *ngIf="feature.geometry">\r\n      <mat-icon svgIcon="zoom-in"></mat-icon>\r\n    </button>\r\n\r\n    <igo-feature-details [feature]="feature"></igo-feature-details>\r\n  </igo-panel>\r\n\r\n</igo-flexible>\r\n',styles:[":host{position:absolute;bottom:0;width:100%;max-height:calc(100% - 50px);background-color:#fff}igo-feature-details ::ng-deep table{width:100%}"]}]}],mp.ctorParameters=function(){return[]},mp.propDecorators={expanded:[{type:Le.Input}],map:[{type:Le.Input}],feature:[{type:Le.Input}],opened:[{type:Le.Output}]},mp);function mp(){this.format=new Ie,this.opened=new Le.EventEmitter}var yp=(vp.forRoot=function(){return{ngModule:vp}},vp.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatIconModule,Fe.MatButtonModule,Te.IgoPanelModule,Te.IgoFlexibleModule,aa],exports:[fp],declarations:[fp]}]}],vp);function vp(){}var bp=(Sp.prototype.onUpdateInputs=function(){this.cdRef.detectChanges()},Sp.prototype.onClose=function(){this.cancel.emit()},Sp.decorators=[{type:Le.Component,args:[{selector:"igo-ogc-filter",template:'<igo-ogc-filterable-item\r\n  [layer]="layer" \r\n  [map]="map" >\r\n</igo-ogc-filterable-item>\r\n\r\n<div>\r\n  <button\r\n    mat-button\r\n    type="button"\r\n    (click)="onClose()">\r\n    {{ \'igo.geo.workspace.ogcFilter.close\' | translate }}\r\n  </button>\r\n</div>\r\n',changeDetection:Le.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Sp.ctorParameters=function(){return[{type:Le.ChangeDetectorRef}]},Sp.propDecorators={layer:[{type:Le.Input}],map:[{type:Le.Input}],complete:[{type:Le.Output}],cancel:[{type:Le.Output}]},Sp);function Sp(e){this.cdRef=e,this.complete=new Le.EventEmitter,this.cancel=new Le.EventEmitter}var wp=new Le.InjectionToken("OgcFilterWidget");function Ip(e){return e.create(bp)}function Fp(){return{provide:wp,useFactory:Ip,deps:[Te.WidgetService]}}var Op=(Tp.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Fe.MatButtonModule,je.IgoLanguageModule,al],exports:[bp],declarations:[bp],entryComponents:[bp]}]}],Tp);function Tp(){}var xp,Cp=(qe(Mp,xp=Te.Workspace),Object.defineProperty(Mp.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(Mp.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),Mp);function Mp(e){var t=xp.call(this,e)||this;return t.options=e,t}var Lp=(Pp.prototype.createWorkspace=function(e,t){return new Cp({id:e.id,title:e.title,layer:e,map:t,entityStore:this.createFeatureStore(e,t),actionStore:new Te.ActionStore([]),meta:{tableTemplate:this.createTableTemplate(e)}})},Pp.prototype.createFeatureStore=function(e,t){var r=new ho([],{map:t});r.bindLayer(e);var o=new uo({}),n=new bo({map:t,hitTolerance:5});return r.addStrategy(o,!0),r.addStrategy(n,!0),r},Pp.prototype.createTableTemplate=function(e){return{selection:!0,sort:!0,columns:(e.dataSource.options.sourceFields||[]).map(function(e){return{name:"properties."+e.name,title:e.alias?e.alias:e.name}})}},Pp.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Pp.ctorParameters=function(){return[]},Pp.ngInjectableDef=Le.defineInjectable({factory:function(){return new Pp},token:Pp,providedIn:"root"}),Pp);function Pp(){}var Dp,kp=(qe(jp,Dp=Te.Workspace),Object.defineProperty(jp.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(jp.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),jp);function jp(e){var t=Dp.call(this,e)||this;return t.options=e,t}var Ep=(Rp.prototype.createWorkspace=function(e,t){return new kp({id:e.id,title:e.title,layer:e,map:t,actionStore:new Te.ActionStore([])})},Rp.decorators=[{type:Le.Injectable,args:[{providedIn:"root"}]}],Rp.ctorParameters=function(){return[]},Rp.ngInjectableDef=Le.defineInjectable({factory:function(){return new Rp},token:Rp,providedIn:"root"}),Rp);function Rp(){}var $p=(Object.defineProperty(Ap.prototype,"workspaceStore",{get:function(){return this.component.store},enumerable:!0,configurable:!0}),Ap.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.pipe(De.debounceTime(50)).subscribe(function(e){return t.onLayersChange(e)})},Ap.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Ap.prototype.onLayersChange=function(e){var t=this,r=e.filter(function(e){return t.layerIsEditable(e)}),o=r.map(function(e){return e.id}),n=r.map(function(e){return t.getOrCreateWorkspace(e)}).filter(function(e){return e!==undefined}),i=this.workspaceStore.all().filter(function(e){return o.indexOf(e.id)<0});0<i.length&&(i.forEach(function(e){e.deactivate()}),this.workspaceStore.state.updateMany(i,{active:!1,selected:!1}),this.workspaceStore.deleteMany(i)),0<n.length&&this.workspaceStore.insertMany(n)},Ap.prototype.getOrCreateWorkspace=function(e){if(this.workspaceStore.get(e.id)===undefined)return e.dataSource instanceof Ot?this.wfsWorkspaceService.createWorkspace(e,this.map):e.dataSource instanceof kt?this.wmsWorkspaceService.createWorkspace(e,this.map):void 0},Ap.prototype.layerIsEditable=function(e){var t=e.dataSource;if(t instanceof Ot)return!0;if(t instanceof kt){var r=t.options||{};return r.ogcFilters&&r.ogcFilters.enabled}return!1},Ap.decorators=[{type:Le.Directive,args:[{selector:"[igoWorkspaceSelector]"}]}],Ap.ctorParameters=function(){return[{type:Te.WorkspaceSelectorComponent},{type:Lp},{type:Ep}]},Ap.propDecorators={map:[{type:Le.Input}]},Ap);function Ap(e,t,r){this.component=e,this.wfsWorkspaceService=t,this.wmsWorkspaceService=r}var Gp=(Bp.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule],exports:[$p],declarations:[$p]}]}],Bp);function Bp(){}var _p=(qp.decorators=[{type:Le.NgModule,args:[{imports:[Oe.CommonModule,Te.IgoWidgetModule,Gp,Op],exports:[Gp,Op],declarations:[],providers:[Fp()]}]}],qp);function qp(){}var Np=(Vp.forRoot=function(){return{ngModule:Vp,providers:[]}},Vp.decorators=[{type:Le.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],Vp);function Vp(){}var Up=(Wp.forRoot=function(){return{ngModule:Wp,providers:[]}},Wp.decorators=[{type:Le.NgModule,args:[{imports:[],declarations:[],exports:[ji,Ri,Ji,aa,al,xs,du,Fi,gu,Su,Ge,Iu,$u,_u,lc,hp,yp,_p,Np]}]}],Wp);function Wp(){}var zp,Kp=(qe(Hp,zp=ai),Hp.prototype.getId=function(){return Hp.id},Hp.prototype.getType=function(){return Hp.type},Hp.prototype.getDefaultOptions=function(){return{title:"Cadastre (Qubec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}},Hp.prototype.search=function(e,t){var r=this;e=(e=(e=e.endsWith(",")?e.slice(0,-1):e).startsWith(",")?e.substr(1):e).replace(/ /g,"");var o=this.computeSearchRequestParams(e,t||{});return o.get("numero")&&o.get("numero").match(/^[0-9,]+$/g)?this.http.get(this.searchUrl,{params:o,responseType:"text"}).pipe(De.map(function(e){return r.extractResults(e)})):Ce.of([])},Hp.prototype.computeSearchRequestParams=function(e,t){return new Pe.HttpParams({fromObject:Object.assign({numero:e,epsg:"4326"},this.params,t.params||{})})},Hp.prototype.extractResults=function(e){var t=this;return e.split("<br />").filter(function(e){return 0<e.length}).map(function(e){return t.dataToResult(e)})},Hp.prototype.dataToResult=function(e){var t=e.split(";"),r=t[0],o=t[7],n=this.computeGeometry(o),i={NoLot:r},a=[this.getId(),"cadastre",r].join(".");return{source:this,meta:{dataType:rr,id:a,title:r,icon:"map-marker"},data:{type:rr,projection:"EPSG:4326",geometry:n,properties:i,meta:{id:a,title:r}}}},Hp.prototype.computeGeometry=function(e){var t=(new xe).readFeature(e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}},Hp.id="cadastre",Hp.type=rr,Hp.decorators=[{type:Le.Injectable}],Hp.ctorParameters=function(){return[{type:Pe.HttpClient},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]}]},Hp);function Hp(e,t){var r=zp.call(this,t)||this;return r.http=e,r}function Yp(e,t){return new Kp(e,t.getConfig("searchSources."+Kp.id))}var Zp,Qp=(qe(Jp,Zp=ai),Jp.prototype.getId=function(){return Jp.id},Jp.prototype.getType=function(){return Jp.type},Jp.prototype.getDefaultOptions=function(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}},Jp.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return o.get("q")?this.http.get(this.searchUrl,{params:o}).pipe(De.map(function(e){return r.extractResults(e)})):Ce.of([])},Jp.prototype.computeSearchRequestParams=function(e,t){return new Pe.HttpParams({fromObject:Object.assign({q:this.computeTerm(e),format:"json"},this.params,t.params||{})})},Jp.prototype.extractResults=function(e){var t=this;return e.map(function(e){return t.dataToResult(e)})},Jp.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeGeometry(e),o=this.computeExtent(e),n=[this.getId(),"place",e.place_id].join(".");return{source:this,meta:{dataType:rr,id:n,title:e.display_name,icon:"map-marker"},data:{type:rr,projection:"EPSG:4326",geometry:r,extent:o,properties:t,meta:{id:n,title:e.display_name}}}},Jp.prototype.computeProperties=function(e){return{display_name:e.display_name,place_id:e.place_id,osm_type:e.osm_type,"class":e["class"],type:e.type}},Jp.prototype.computeGeometry=function(e){return{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}},Jp.prototype.computeExtent=function(e){return[parseFloat(e.boundingbox[2]),parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[3]),parseFloat(e.boundingbox[1])]},Jp.prototype.computeTerm=function(e){return this.computeTermTags(e)},Jp.prototype.computeTermTags=function(t){var e=Zp.prototype.getHashtagsValid.call(this,t,"amenity");return e?e.length?(t=t.replace(/(#[^\s]*)/g,""),e.forEach(function(e){t+="+["+e+"]"}),t):null:this.computeTermSettings(t)},Jp.prototype.computeTermSettings=function(t){return this.options.settings.forEach(function(e){"amenity"===e.name&&e.values.forEach(function(e){e.enabled&&"string"==typeof e.value&&e.value.split(",").forEach(function(e){t+="+["+e+"]"})})}),t},Jp.id="nominatim",Jp.type=rr,Jp.decorators=[{type:Le.Injectable}],Jp.ctorParameters=function(){return[{type:Pe.HttpClient},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]}]},Jp);function Jp(e,t){var r=Zp.call(this,t)||this;return r.http=e,r}function Xp(e,t){return new Qp(e,t.getConfig("searchSources."+Qp.id))}var ed,td=(qe(rd,ed=ai),rd.prototype.getId=function(){return rd.id},rd.prototype.getType=function(){return rd.type},rd.prototype.getDefaultOptions=function(){return{title:"Stored Queries",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/ws/swtq"}},rd.prototype.search=function(e,t){var r=this,o=this.termSplitter(e,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},o);return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:n,responseType:"text"}).pipe(De.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:n}).pipe(De.map(function(e){return r.extractResults(r.extractWFSData(e))}))},rd.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=Me.GeoJSON),r.test(t)&&(e=Me.WFS),new e},rd.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=Me.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},rd.prototype.termSplitter=function(e,t){var o={},n=e,r=0;return t.forEach(function(e){o[e.name]=e.defaultValue;var t=new RegExp(e.splitPrefix+"(.+)","i");t.test(n)&&(r=e.splitPrefix?r+=1:r,n=n.split(t)[1])}),0===r?o[t[0].name]=e:(n=e,Ke(t).reverse().forEach(function(e){var t=new RegExp(e.splitPrefix||"(.+)","i");if(n||""!==n){var r=n.split(t);n=r[0],r[1]&&(o[e.name]=r[1].trim())}})),o},rd.prototype.computeRequestParams=function(e,t){var r=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new Pe.HttpParams({fromObject:Object.assign({service:"wfs",version:r,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,e.params||{})})},rd.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},rd.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:rr,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:rr,id:r,title:e.properties.title,titleHtml:e.properties[o],icon:"map-marker"}}},rd.prototype.computeProperties=function(e){return ke.ObjectUtils.removeKeys(e.properties,rd.propertiesBlacklist)},rd.id="storedqueries",rd.type=rr,rd.propertiesBlacklist=["boundedBy","id","coord_x","coord_y"],rd.decorators=[{type:Le.Injectable}],rd.ctorParameters=function(){return[{type:Pe.HttpClient},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]}]},rd);function rd(e,t){var r=ed.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,r.storedQueriesOptions&&!r.storedQueriesOptions.available)return r;if(r.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),r.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:"title"},r.resultTitle="title",console.log("Default values",r.storedQueriesOptions)),!r.storedQueriesOptions.storedquery_id){var o='Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"';throw new Error(o)}if(!r.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&r.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){o="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw o+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(o)}return r.storedQueriesOptions.fields instanceof Array||(r.storedQueriesOptions.fields=[r.storedQueriesOptions.fields]),r.multipleFieldsQuery=1<r.storedQueriesOptions.fields.length,r.storedQueriesOptions.fields.forEach(function(e,t){if(r.multipleFieldsQuery&&!e.splitPrefix&&0!==t)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!e.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}var od,nd=(qe(id,od=ai),id.prototype.getId=function(){return id.id},id.prototype.getType=function(){return id.type},id.prototype.getDefaultOptions=function(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}},id.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:o,responseType:"text"}).pipe(De.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:o}).pipe(De.map(function(e){return r.extractResults(r.extractWFSData(e))}))},id.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=Me.GeoJSON),r.test(t)&&(e=Me.WFS),new e},id.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=Me.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},id.prototype.computeRequestParams=function(e,t){var r={};return r[this.storedQueriesOptions.longField]=e[0],r[this.storedQueriesOptions.latField]=e[1],new Pe.HttpParams({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},r,this.params,t.params||{})})},id.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},id.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:rr,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:rr,id:r,title:e.properties[o],icon:"map-marker"}}},id.prototype.computeProperties=function(e){var t=ke.ObjectUtils.removeKeys(e.properties,id.propertiesBlacklist);return Object.assign(t,{type:e.properties.doc_type})},id.id="storedqueriesreverse",id.type=rr,id.propertiesBlacklist=[],id.decorators=[{type:Le.Injectable}],id.ctorParameters=function(){return[{type:Pe.HttpClient},{type:undefined,decorators:[{type:Le.Inject,args:["options"]}]}]},id);function id(e,t){var r=od.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,!r.storedQueriesOptions.storedquery_id){throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"')}if(!r.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!r.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');return r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}function ad(e,t){return new td(e,t.getConfig("searchSources."+td.id))}function sd(e,t){return new nd(e,t.getConfig("searchSources."+nd.id))}var ld={GeoJSON:0,JSON:1};ld[ld.GeoJSON]="GeoJSON",ld[ld.JSON]="JSON";var ud,cd={Route:"Route",Trip:"Trip"},pd=(qe(dd,ud=Yu),Object.defineProperty(dd.prototype,"enabled",{get:function(){return!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),dd.prototype.getName=function(){return dd._name},dd.prototype.route=function(e,t){var r=this;void 0===t&&(t={});var o=this.getRouteParams(t);return this.http.get(this.directionsUrl+e.join(";"),{params:o}).pipe(De.map(function(e){return r.extractRoutesData(e)}))},dd.prototype.extractRoutesData=function(t){var r=this,o=[];return t.routes.forEach(function(e){o.push(r.formatRoute(e,t.waypoints))}),o},dd.prototype.getRouteParams=function(e){return void 0===e&&(e={}),e.alternatives=e.alternatives===undefined||e.alternatives,e.steps=e.steps===undefined||e.steps,e.geometries=e.geometries!==undefined?e.geometries:"geojson",e.overview=e.overview!==undefined&&e.overview,new Pe.HttpParams({fromObject:{alternatives:e.alternatives?"true":"false",overview:e.overview?"simplified":"full",steps:e.steps?"true":"false",geometries:e.geometries?e.geometries:"geojson"}})},dd.prototype.formatRoute=function(e,t){var r=[];return e.legs.forEach(function(e){e.steps.forEach(function(e){r.push(e)})}),{id:ke.uuid(),title:e.legs[0].summary,source:dd._name,sourceType:cd.Route,order:1,format:ld.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:e.distance,duration:e.duration,geometry:e.geometry,legs:e.legs,steps:r,weight:e.weight,weight_name:e.weight_name}},dd._name="OSRM Qubec",dd.decorators=[{type:Le.Injectable}],dd.ctorParameters=function(){return[{type:Pe.HttpClient},{type:je.ConfigService}]},dd);function dd(e,t){var r=ud.call(this)||this;return r.http=e,r.config=t,r.directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/",r.options=r.config.getConfig("directionsSources.osrm")||{},r.directionsUrl=r.options.url||r.directionsUrl,r}function hd(e,t){return new pd(e,t)}e.IgoGeoModule=Up,e.IgoCatalogModule=ji,e.IgoCatalogBrowserModule=Ti,e.IgoCatalogLibraryModule=Di,e.IgoDataSourceModule=Ri,e.IgoDirectionsModule=lc,e.IgoDownloadModule=Ji,e.IgoGeoWorkspaceModule=_p,e.IgoWorkspaceSelectorModule=Gp,e.IgoOgcFilterModule=Op,e.IgoFeatureModule=aa,e.IgoFeatureFormModule=na,e.IgoFeatureDetailsModule=ra,e.IgoFilterModule=al,e.IgoGeometryModule=xs,e.IgoGeometryFormFieldModule=Os,e.IgoImportExportModule=du,e.IgoLayerModule=Fi,e.IgoMapModule=gu,e.IgoMeasureModule=Su,e.IgoMeasurerModule=vu,e.IgoMetadataModule=Ge,e.IgoOverlayModule=Iu,e.IgoPrintModule=$u,e.IgoQueryModule=_u,e.IgoSearchModule=hp,e.IgoSearchBarModule=Xc,e.SearchBarComponent=Yc,e.IgoSearchResultsModule=lp,e.IgoToastModule=yp,e.IgoWktModule=Np,e.querySearchSourceFactory=Gu,e.provideQuerySearchSource=Bu,e.cadastreSearchSourceFactory=Yp,e.provideCadastreSearchSource=function vd(){return{provide:ai,useFactory:Yp,multi:!0,deps:[Pe.HttpClient,je.ConfigService]}},e.defaultIChercheSearchResultFormatterFactory=Sc,e.provideDefaultIChercheSearchResultFormatter=wc,e.ichercheSearchSourceFactory=Ic,e.provideIChercheSearchSource=function bd(){return{provide:ai,useFactory:Ic,multi:!0,deps:[Pe.HttpClient,je.LanguageService,je.ConfigService,dc,Le.Injector]}},e.ichercheReverseSearchSourceFactory=Fc,e.provideIChercheReverseSearchSource=function Sd(){return{provide:ai,useFactory:Fc,multi:!0,deps:[Pe.HttpClient,je.LanguageService,je.ConfigService,Le.Injector]}},e.defaultCoordinatesSearchResultFormatterFactory=Lc,e.provideDefaultCoordinatesSearchResultFormatter=Pc,e.CoordinatesReverseSearchSourceFactory=Dc,e.provideCoordinatesReverseSearchSource=function wd(){return{provide:ai,useFactory:Dc,multi:!0,deps:[je.ConfigService,je.LanguageService]}},e.ilayerSearchResultFormatterFactory=Ac,e.provideILayerSearchResultFormatter=Gc,e.ilayerSearchSourceFactory=Bc,e.provideILayerSearchSource=function Id(){return{provide:ai,useFactory:Bc,multi:!0,deps:[Pe.HttpClient,je.LanguageService,je.ConfigService,kc]}},e.nominatimSearchSourceFactory=Xp,e.provideNominatimSearchSource=function Fd(){return{provide:ai,useFactory:Xp,multi:!0,deps:[Pe.HttpClient,je.ConfigService]}},e.storedqueriesSearchSourceFactory=ad,e.provideStoredQueriesSearchSource=function Od(){return{provide:ai,useFactory:ad,multi:!0,deps:[Pe.HttpClient,je.ConfigService]}},e.storedqueriesReverseSearchSourceFactory=sd,e.provideStoredQueriesReverseSearchSource=function Td(){return{provide:ai,useFactory:sd,multi:!0,deps:[Pe.HttpClient,je.ConfigService]}},e.osrmDirectionsSourcesFactory=hd,e.provideOsrmDirectionsSource=function xd(){return{provide:Yu,useFactory:hd,multi:!0,deps:[Pe.HttpClient,je.ConfigService]}},e.directionsSourceServiceFactory=Qu,e.provideDirectionsSourceService=Ju,e.DirectionsSourceService=Zu,e.provideStyleListOptions=su,e.styleListFactory=lu,e.provideStyleListLoader=uu,e.STYLELIST_OPTIONS=au,e.CatalogService=fi,e.CatalogItemType=Bn,e.TypeCatalog=_n,e.Catalog=Nn,e.CompositeCatalog=Jn,e.CatalogFactory=ei,e.CatalogBrowserComponent=yi,e.CatalogLibaryComponent=Ci,e.DataService=He,e.DataSource=tt,e.FeatureDataSource=nt,e.OSMDataSource=st,e.XYZDataSource=ct,e.WFSDataSource=Ot,e.WFSService=Ct,e.WMSDataSource=kt,e.formatWFSQueryString=St,e.checkWfsParams=wt,e.getFormatFromOptions=It,e.defaultEpsg=gt,e.defaultMaxFeatures=ft,e.defaultWfsVersion=mt,e.defaultFieldNameGeometry=yt,e.gmlRegex=vt,e.jsonRegex=bt,e.WMTSDataSource=$t,e.CartoDataSource=Bt,e.ArcGISRestDataSource=Nt,e.TileArcGISRestDataSource=Wt,e.WebSocketDataSource=Ht,e.MVTDataSource=Qt,e.ClusterDataSource=er,e.DataSourceService=Rn,e.TypeCapabilities=kn,e.CapabilitiesService=jn,e.EsriStyleGenerator=Mn,e.createDefaultTileGrid=Et,e.DownloadService=Hi,e.DownloadButtonComponent=Zi,e.FEATURE=rr,e.FeatureMotion=or,e.featureToOl=wo,e.renderFeatureFromOl=Io,e.featureFromOl=Fo,e.computeOlFeatureExtent=Oo,e.computeOlFeaturesExtent=To,e.scaleExtent=xo,e.featuresAreOutOfView=Co,e.featuresAreTooDeepInView=Mo,e.moveToOlFeatures=Lo,e.hideOlFeature=function Cd(e){e.setStyle(new Se.Style({}))},e.tryBindStoreLayer=Po,e.tryAddLoadingStrategy=Do,e.tryAddSelectionStrategy=ko,e.computeOlFeaturesDiff=jo,e.FeatureStore=ho,e.FeatureStoreLoadingStrategy=ao,e.FeatureStoreLoadingLayerStrategy=uo,e.FeatureStoreSelectionStrategy=bo,e.FeatureFormComponent=Eo,e.FilterableDataSourcePipe=Ai,e.TimeFilterType=Pn,e.TimeFilterStyle=Dn,e.TimeFilterService=Bi,e.OgcFilterOperatorType=qi,e.OGCFilterService=Ni,e.OgcFilterWriter=dt,e.SpatialFilterQueryType={AdmRegion:"AdmRegion",Mun:"Mun",Arrond:"Arrond",CircFed:"CircFed",CircProv:"CircProv",DirReg:"DirReg",MRC:"MRC",RegTour:"RegTour"},e.SpatialFilterType=Ui,e.SpatialFilterItemType=Wi,e.SpatialFilterService=zi,e.TimeFilterFormComponent=Ps,e.TimeFilterItemComponent=ks,e.TimeFilterListComponent=Es,e.TimeFilterListBindingDirective=$s,e.OgcFilterableFormComponent=Ns,e.OgcFilterableItemComponent=Us,e.OgcFilterableListComponent=zs,e.OgcFilterableListBindingDirective=Hs,e.OgcFilterFormComponent=_s,e.OgcFilterToggleButtonComponent=Js,e.OgcFilterButtonComponent=Zs,e.TimeFilterButtonComponent=Ms,e.SpatialFilterTypeComponent=el,e.SpatialFilterListComponent=rl,e.SpatialFilterItemComponent=nl,e.GeometrySliceError=za,e.GeometrySliceMultiPolygonError=Ya,e.GeometrySliceLineStringError=Ja,e.GeometrySliceTooManyIntersectionError=ts,e.createDrawInteractionStyle=os,e.createDrawHoleInteractionStyle=ns,e.sliceOlGeometry=is,e.sliceOlLineString=as,e.sliceOlPolygon=ss,e.addLinearRingToOlPolygon=ls,e.getMousePositionFromOlGeometryEvent=us,e.DrawControl=cs,e.ModifyControl=ds,e.SliceControl=gs,e.DropGeoFileDirective=nu,e.ExportError=ul,e.ExportInvalidFileError=dl,e.ExportNothingToExportError=fl,e.ExportService=Sl,e.ExportFormat=bl,e.handleFileExportError=yl,e.handleNothingToExportError=vl,e.exportToCSV=function Md(e,t,r){void 0===r&&(r=";");var o=e.map(function(e,t){return e.join(r)}).join("\n");ke.downloadContent(o,"text/csv;charset=utf-8",t)},e.entitiesToRowData=function Ld(e,t){return e.map(function(r){return t.map(function(e){var t;return e.renderer!==undefined&&e.renderer!==Te.EntityTableColumnRenderer.Default||(t=e.valueAccessor),(t=t||Te.getEntityProperty)(r,e.name)})})},e.ImportError=Fl,e.ImportInvalidFileError=xl,e.ImportUnreadableFileError=Ll,e.ImportNothingToImportError=kl,e.ImportSizeError=Rl,e.ImportSRSError=Gl,e.ImportService=Ql,e.addLayerAndFeaturesToMap=_l,e.addLayerAndFeaturesStyledToMap=ql,e.handleFileImportSuccess=Nl,e.handleFileImportError=Vl,e.handleInvalidFileImportError=Ul,e.handleUnreadbleFileImportError=Wl,e.handleSizeFileImportError=zl,e.handleNothingToImportError=Kl,e.handleSRSImportError=Hl,e.getFileExtension=Yl,e.computeLayerTitleFromFile=Zl,e.ImportExportComponent=tu,e.LayerService=An,e.LAYER=nr,e.Layer=ir,e.TooltipType=lr,e.ImageLayer=br,e.TileLayer=Ir,e.VectorLayer=Tr,e.VectorTileLayer=Mr,e.StyleService=_r,e.LayerItemComponent=Ur,e.LayerLegendComponent=zr,e.LayerListComponent=Qr,e.LayerListBindingDirective=to,e.LayerListControlsEnum=Hr,e.LayerListService=Yr,e.TrackFeatureButtonComponent=oo,e.ImageWatcher=ur,e.TileWatcher=dr,e.getLayersLegends=gr,e.VectorWatcher=mr,e.IgoMap=nn,e.MapViewAction=qo,e.MapService=Xr,e.stringToLonLat=No,e.viewStatesAreEqual=Uo,e.formatScale=Wo,e.getResolutionFromScale=zo,e.getScaleFromResolution=Ko,e.ctrlKeyDown=Ho,e.roundCoordTo=Yo,e.lonLatConversion=Zo,e.utmZoneFromLonLat=Qo,e.mtmZoneFromLonLat=Jo,e.MapOfflineDirective=sn,e.PointerPositionDirective=un,e.PointerPositionByKeyDirective=pn,e.ProjectionService=hn,e.MapController=Xo,e.MapViewController=rn,e.MapBrowserComponent=Pr,e.ZoomButtonComponent=fn,e.GeolocateButtonComponent=yn,e.OfflineButtonComponent=bn,e.BaseLayersSwitcherComponent=In,e.MiniBaseMapComponent=On,e.RotationButtonComponent=xn,e.MEASURE_UNIT_AUTO="auto",e.MeasureType=da,e.MeasureLengthUnit=ha,e.MeasureLengthUnitAbbreviation=ga,e.MeasureAreaUnit=fa,e.MeasureAreaUnitAbbreviation=ma,e.metersToKilometers=ya,e.metersToFeet=va,e.metersToMiles=ba,e.squareMetersToSquareKilometers=Sa,e.squareMetersToSquareMiles=wa,e.squareMetersToSquareFeet=Ia,e.squareMetersToHectares=Fa,e.squareMetersToAcres=Oa,e.metersToUnit=Ta,e.squareMetersToUnit=xa,e.formatMeasure=Ca,e.computeBestLengthUnit=Ma,e.computeBestAreaUnit=La,e.createMeasureInteractionStyle=Pa,e.createMeasureLayerStyle=Da,e.measureOlGeometryLength=ka,e.measureOlGeometryArea=ja,e.measureOlGeometry=Ea,e.updateOlGeometryMidpoints=Ra,e.clearOlGeometryMidpoints=function Pd(e){for(var t=e.get("_midpoints")||[],r=t.length,o=0;o<r;o++){var n=t[o];n!==undefined&&n!==undefined&&Aa(n)}return e.set("_midpoints",undefined,!0),t},e.updateOlTooltipsAtMidpoints=Ga,e.getOlTooltipsAtMidpoints=Ba,e.updateOlGeometryCenter=_a,e.updateOlTooltipAtCenter=qa,e.getOlTooltipAtCenter=Na,e.getTooltipsOfOlGeometry=Va,e.createOlTooltipAtPoint=Ua,e.MeasurerComponent=vs,e.MeasureFormatPipe=Ss,e.MetadataService=Ee,e.MetadataButtonComponent=$e,e.Overlay=$o,e.OverlayDirective=Rr,e.OverlayService=jr,e.OverlayAction=kr,e.createOverlayLayer=Ar,e.createOverlayDefaultStyle=Gr,e.createOverlayMarkerStyle=Br,e.PrintService=Tu,e.PrintOutputFormat=Lu,e.PrintPaperFormat=Pu,e.PrintOrientation=Du,e.PrintResolution=ku,e.PrintSaveImageFormat=ju,e.PrintComponent=Cu,e.PrintFormComponent=Eu,e.QueryService=ri,e.QueryDirective=ni,e.QueryFormat=Pt,e.QueryHtmlTarget=Dt,e.layerIsQueryable=Nr,e.olLayerIsQueryable=Vr,e.QuerySearchSource=ui,e.DirectionsService=Xu,e.DirectionsFormat=ld,e.SourceDirectionsType=cd,e.DirectionsSource=Yu,e.OsrmDirectionsSource=pd,e.stopMarker=ic,e.DirectionsFormComponent=oc,e.DirectionsFormBindingDirective=ac,e.DirectionsFormService=tc,e.SEARCH_TYPES=_c,e.pointerPositionSummaryMarker=dp,e.SearchPointerSummaryDirective=cp,e.SearchService=Ku,e.SearchSourceService=Nu,e.sourceCanSearch=Uu,e.sourceCanReverseSearch=Wu,e.sourceCanReverseSearchAsSummary=zu,e.featureToSearchResult=function Dd(e,t){return{source:t,data:e,meta:{dataType:rr,id:e.meta.id,title:e.meta.title,icon:e.meta.icon||"map-marker"}}},e.CadastreSearchSource=Kp,e.SearchSource=ai,e.IChercheSearchResultFormatter=dc,e.IChercheSearchSource=fc,e.IChercheReverseSearchSource=vc,e.ILayerSearchResultFormatter=kc,e.ILayerSearchSource=Rc,e.NominatimSearchSource=Qp,e.StoredQueriesSearchSource=td,e.StoredQueriesReverseSearchSource=nd,e.CoordinatesSearchResultFormatter=Oc,e.CoordinatesReverseSearchSource=Cc,e.ToastComponent=fp,e.GoogleLinks=pi,e.generateIdFromSourceOptions=Ye,e.generateWMSIdFromSourceOptions=Ze,e.generateWMTSIdFromSourceOptions=Qe,e.generateXYZIdFromSourceOptions=Je,e.generateFeatureIdFromSourceOptions=Xe,e.generateId=et,e.OsmLinks=hi,e.WktService=Gs,e.q=wi,e.r=bi,e.p=yi,e.t=Li,e.s=Ci,e.e=jn,e.m=Rn,e.o=He,e.n=Ct,e.dg=ac,e.da=oc,e.df=tc,e.dc=Yu,e.en=pd,e.db=Xu,e.u=Zi,e.v=Hi,e.w=ea,e.x=Eo,e.bj=Zs,e.bh=_s,e.bk=Js,e.bm=Ns,e.bn=Us,e.bp=Hs,e.bo=zs,e.ba=Ai,e.bl=Ni,e.bs=zi,e.be=Bi,e.bt=nl,e.br=rl,e.bq=el,e.bb=Ms,e.bc=Ps,e.bd=ks,e.bg=$s,e.bf=Es,e.z=Is,e.y=ca,e.bw=tu,e.bz=nu,e.by=Sl,e.bx=Ql,e.bu=cu,e.bv=Xl,e.c=Ur,e.d=zr,e.h=to,e.f=Qr,e.g=Yr,e.k=An,e.l=_r,e.j=oo,e.cf=wn,e.ce=In,e.cg=On,e.cc=yn,e.ca=Pr,e.ci=bn,e.cd=xn,e.ck=pn,e.cj=un,e.i=Xr,e.ch=sn,e.cb=fn,e.cl=Ss,e.co=ms,e.cm=mu,e.cn=vs,e.a=$e,e.b=Ee,e.cq=Rr,e.cr=jr,e.cu=Eu,e.cs=Cu,e.ct=Tu,e.cz=ui,e.cv=ni,e.cw=ri,e.dl=Qc,e.dn=ap,e.do=np,e.dm=rp,e.di=qc,e.dh=Vc,e.dk=Wc,e.dj=Kc,e.dp=cp,e.dr=pc,e.dq=cc,e.de=Nu,e.dd=Ku,e.eh=Kp,e.dw=Cc,e.dv=Oc,e.du=vc,e.ds=dc,e.dt=fc,e.dx=kc,e.dy=Rc,e.ek=Qp,e.cx=ai,e.em=nd,e.el=td,e.dz=fp,e.bi=Gs,e.eb=Lp,e.ec=Ep,e.ed=bp,e.ee=wp,e.ef=Ip,e.eg=Fp,e.ea=$p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-geo.umd.min.js.map