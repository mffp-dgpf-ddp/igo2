!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ol-mapbox-style/stylefunction"),require("ol/source/OSM"),require("ol/source/XYZ"),require("ol/format/filter"),require("ol/format/WFS"),require("ol/format/GML32"),require("ol/format/OSMXML"),require("ol/source/ImageWMS"),require("ol/source/WMTS"),require("ol/tilegrid/WMTS"),require("ol/extent.js"),require("ol/source/CartoDB"),require("ol/loadingstrategy"),require("ol/source/TileArcGISRest"),require("ts-md5"),require("ol/source/VectorTile"),require("ol/format/MVT"),require("ol/source/Cluster"),require("ngx-cacheable"),require("ol/source/WMTS.js"),require("ol/Map"),require("ol/View"),require("ol/Geolocation"),require("ol/control/Attribution"),require("ol/control/ScaleLine"),require("ol/geom/Circle"),require("ol/geom/GeometryLayout"),require("ol/has"),require("ol/layer/Image"),require("ol/layer/Tile"),require("ol/color"),require("ol/layer/VectorTile"),require("ol/easing"),require("proj4"),require("ol/proj/proj4"),require("@angular/animations"),require("ol/format/GML2"),require("ol/format/GML3"),require("ol/format/EsriJSON"),require("ol/render/Feature"),require("ol/proj/Projection"),require("@angular/platform-browser"),require("@mat-datetimepicker/core"),require("ol/geom/Point"),require("ol/Overlay"),require("ol/extent"),require("ol/sphere"),require("ol/style/Style"),require("ol/geom/LineString"),require("@turf/line-intersect"),require("@turf/helpers"),require("ol/interaction/Modify"),require("ol/interaction/Translate"),require("ol/interaction/Draw"),require("ol/geom/Polygon"),require("ol/geom/LinearRing"),require("ol/interaction/DragBox"),require("ol/source/Vector"),require("ol/layer/Vector"),require("moment"),require("@angular/cdk/collections"),require("@angular/cdk/tree"),require("file-saver"),require("jspdf"),require("html2canvas"),require("jszip"),require("ol/events/condition"),require("ol/interaction"),require("ol/Observable"),require("@igo2/auth"),require("@turf/point-on-feature"),require("@angular/forms"),require("ol/Feature"),require("ol/proj"),require("ol/style"),require("ol/geom"),require("ol/format/GeoJSON"),require("@angular/material"),require("@angular/common"),require("@igo2/common"),require("ol/format/WKT"),require("rxjs"),require("@angular/common/http"),require("rxjs/operators"),require("@igo2/utils"),require("ol/format"),require("@angular/core"),require("@ionic/angular"),require("@ionic-native/file/ngx"),require("@ionic-native/file-opener/ngx"),require("@igo2/core"),require("@ionic-native/file-opener/ngx/index"),require("@ionic-native/file/ngx/index")):"function"==typeof define&&define.amd?define("@igo2/geo",["exports","ol-mapbox-style/stylefunction","ol/source/OSM","ol/source/XYZ","ol/format/filter","ol/format/WFS","ol/format/GML32","ol/format/OSMXML","ol/source/ImageWMS","ol/source/WMTS","ol/tilegrid/WMTS","ol/extent.js","ol/source/CartoDB","ol/loadingstrategy","ol/source/TileArcGISRest","ts-md5","ol/source/VectorTile","ol/format/MVT","ol/source/Cluster","ngx-cacheable","ol/source/WMTS.js","ol/Map","ol/View","ol/Geolocation","ol/control/Attribution","ol/control/ScaleLine","ol/geom/Circle","ol/geom/GeometryLayout","ol/has","ol/layer/Image","ol/layer/Tile","ol/color","ol/layer/VectorTile","ol/easing","proj4","ol/proj/proj4","@angular/animations","ol/format/GML2","ol/format/GML3","ol/format/EsriJSON","ol/render/Feature","ol/proj/Projection","@angular/platform-browser","@mat-datetimepicker/core","ol/geom/Point","ol/Overlay","ol/extent","ol/sphere","ol/style/Style","ol/geom/LineString","@turf/line-intersect","@turf/helpers","ol/interaction/Modify","ol/interaction/Translate","ol/interaction/Draw","ol/geom/Polygon","ol/geom/LinearRing","ol/interaction/DragBox","ol/source/Vector","ol/layer/Vector","moment","@angular/cdk/collections","@angular/cdk/tree","file-saver","jspdf","html2canvas","jszip","ol/events/condition","ol/interaction","ol/Observable","@igo2/auth","@turf/point-on-feature","@angular/forms","ol/Feature","ol/proj","ol/style","ol/geom","ol/format/GeoJSON","@angular/material","@angular/common","@igo2/common","ol/format/WKT","rxjs","@angular/common/http","rxjs/operators","@igo2/utils","ol/format","@angular/core","@ionic/angular","@ionic-native/file/ngx","@ionic-native/file-opener/ngx","@igo2/core","@ionic-native/file-opener/ngx/index","@ionic-native/file/ngx/index"],t):t((e.igo2=e.igo2||{},e.igo2.geo={}),e.stylefunction,e.olSourceOSM,e.olSourceXYZ,e.olfilter,e.olFormatWFS,e.olFormatGML32,e.olFormatOSMXML,e.olSourceImageWMS,e.olSourceWMTS,e.olTileGridWMTS,e.extent_js,e.olSourceCarto,e.OlLoadingStrategy,e.olSourceTileArcGISRest,e.tsMd5,e.olSourceVectorTile,e.olFormatMVT,e.olSourceCluster,e.ngxCacheable,e.WMTS_js,e.olMap,e.olView,e.olGeolocation,e.olAttribution,e.olControlScaleLine,e.olCircle,e.olGeometryLayout,e.has,e.olLayerImage,e.olLayerTile,e.color,e.olLayerVectorTile,e.oleasing,e.proj4,e.olproj4,e.ng.animations,e.olFormatGML2,e.olFormatGML3,e.olFormatEsriJSON,e.OlRenderFeature,e.olProjection,e.ng.platformBrowser,e.datepickercore,e.OlPoint,e.OlOverlay,e.olextent,e.sphere,e.OlStyle,e.OlLineString,e.lineIntersect,e.helpers,e.OlModify,e.OlTranslate,e.OlDraw,e.OlPolygon,e.OlLinearRing,e.OlDragBoxInteraction,e.OlVectorSource,e.OlVectorLayer,e.moment,e.ng.cdk.collections,e.ng.cdk.tree,e.fileSaver,e.jsPDF,e._html2canvas,e.JSZip,e.olcondition,e.olinteraction,e.olobservable,e.auth,e.pointOnFeature,e.ng.forms,e.olFeature,e.olproj,e.olstyle,e.olgeom,e.OlGeoJSON,e.ng.material,e.ng.common,e.common,e.olWKT,e.rxjs,e.ng.common.http,e.rxjs.operators,e.utils,e.olformat,e.ng.core,e.i2,e.ngx,e.ngx$1,e.core,e.i3,e.i4$1)}(this,function(e,o,t,r,b,l,n,i,a,s,u,c,p,d,h,g,f,m,y,v,S,w,I,O,F,x,C,T,L,M,P,k,D,j,E,$,R,A,B,G,_,q,N,V,U,W,z,K,H,Y,Z,Q,J,X,ee,te,re,oe,ne,ie,ae,se,le,ue,ce,pe,de,he,ge,fe,me,ye,ve,be,Se,we,Ie,Oe,Fe,xe,Ce,Te,Le,Me,Pe,ke,De,je,Ee,$e,Re,Ae,Be,Ge){"use strict";o=o&&o.hasOwnProperty("default")?o["default"]:o,t=t&&t.hasOwnProperty("default")?t["default"]:t,r=r&&r.hasOwnProperty("default")?r["default"]:r,l=l&&l.hasOwnProperty("default")?l["default"]:l,n=n&&n.hasOwnProperty("default")?n["default"]:n,i=i&&i.hasOwnProperty("default")?i["default"]:i,a=a&&a.hasOwnProperty("default")?a["default"]:a,s=s&&s.hasOwnProperty("default")?s["default"]:s,u=u&&u.hasOwnProperty("default")?u["default"]:u,p=p&&p.hasOwnProperty("default")?p["default"]:p,h=h&&h.hasOwnProperty("default")?h["default"]:h,f=f&&f.hasOwnProperty("default")?f["default"]:f,m=m&&m.hasOwnProperty("default")?m["default"]:m,y=y&&y.hasOwnProperty("default")?y["default"]:y,w=w&&w.hasOwnProperty("default")?w["default"]:w,I=I&&I.hasOwnProperty("default")?I["default"]:I,O=O&&O.hasOwnProperty("default")?O["default"]:O,F=F&&F.hasOwnProperty("default")?F["default"]:F,x=x&&x.hasOwnProperty("default")?x["default"]:x,C=C&&C.hasOwnProperty("default")?C["default"]:C,T=T&&T.hasOwnProperty("default")?T["default"]:T,M=M&&M.hasOwnProperty("default")?M["default"]:M,P=P&&P.hasOwnProperty("default")?P["default"]:P,D=D&&D.hasOwnProperty("default")?D["default"]:D,E=E&&E.hasOwnProperty("default")?E["default"]:E,A=A&&A.hasOwnProperty("default")?A["default"]:A,B=B&&B.hasOwnProperty("default")?B["default"]:B,G=G&&G.hasOwnProperty("default")?G["default"]:G,_=_&&_.hasOwnProperty("default")?_["default"]:_,q=q&&q.hasOwnProperty("default")?q["default"]:q,U=U&&U.hasOwnProperty("default")?U["default"]:U,W=W&&W.hasOwnProperty("default")?W["default"]:W,H=H&&H.hasOwnProperty("default")?H["default"]:H,Y=Y&&Y.hasOwnProperty("default")?Y["default"]:Y,Z=Z&&Z.hasOwnProperty("default")?Z["default"]:Z,J=J&&J.hasOwnProperty("default")?J["default"]:J,X=X&&X.hasOwnProperty("default")?X["default"]:X,ee=ee&&ee.hasOwnProperty("default")?ee["default"]:ee,te=te&&te.hasOwnProperty("default")?te["default"]:te,re=re&&re.hasOwnProperty("default")?re["default"]:re,oe=oe&&oe.hasOwnProperty("default")?oe["default"]:oe,ne=ne&&ne.hasOwnProperty("default")?ne["default"]:ne,ie=ie&&ie.hasOwnProperty("default")?ie["default"]:ie,ye=ye&&ye.hasOwnProperty("default")?ye["default"]:ye,be=be&&be.hasOwnProperty("default")?be["default"]:be,Oe=Oe&&Oe.hasOwnProperty("default")?Oe["default"]:Oe,Te=Te&&Te.hasOwnProperty("default")?Te["default"]:Te;var _e=(qe.prototype.open=function(e){e.extern&&window.open(e.url,"_blank")},qe.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],qe.ctorParameters=function(){return[]},qe.ngInjectableDef=je.defineInjectable({factory:function(){return new qe},token:qe,providedIn:"root"}),qe);function qe(){}var Ne=(Object.defineProperty(Ve.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ve.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Ve.prototype.openMetadata=function(e){this.metadataService.open(e)},Object.defineProperty(Ve.prototype,"options",{get:function(){if(this.layer)return this.layer.options},enumerable:!0,configurable:!0}),Ve.decorators=[{type:je.Component,args:[{selector:"igo-metadata-button",template:'<button\r\n  *ngIf="options && options.metadata && options.metadata.url"\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.metadata.show\' | translate"\r\n  [color]="color"\r\n  (click)="openMetadata(options.metadata)">\r\n  <mat-icon svgIcon="information-outline"></mat-icon>\r\n</button>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Ve.ctorParameters=function(){return[{type:_e}]},Ve.propDecorators={layer:[{type:je.Input}],color:[{type:je.Input}]},Ve);function Ve(e){this.metadataService=e,this._color="primary"}var Ue=(We.forRoot=function(){return{ngModule:We,providers:[]}},We.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTooltipModule,Ae.IgoLanguageModule],exports:[Ne],declarations:[Ne]}]}],We);function We(){}var ze=function(e,t){return(ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function Ke(e,t){function r(){this.constructor=e}ze(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var He=function(){return(He=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function Ye(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(n=e[s])&&(a=(i<3?n(a):3<i?n(t,r,a):n(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a}function Ze(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Qe(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function Je(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)a.push(o.value)}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i["return"])&&r.call(i)}finally{if(n)throw n.error}}return a}function Xe(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Je(arguments[t]));return e}var et=function Nd(){};function tt(e){return({wms:rt,wmts:ot,xyz:nt,feature:it,osm:function(e){return"OSM"}}[e.type]||at)(e)}function rt(e){var t=e.params.LAYERS,r="wms"+("/"===e.url.charAt(0)?window.location.origin+e.url:e.url)+t;return g.Md5.hashStr(r)}function ot(e){var t=e.layer,r="wmts"+e.url+t;return g.Md5.hashStr(r)}function nt(e){var t="xyz"+e.url;return g.Md5.hashStr(t)}function it(e){if(!e.url)return at(e);var t="feature"+e.url;return g.Md5.hashStr(t)}function at(e){return ke.uuid()}var st=(lt.prototype.generateId=function(){return tt(this.options)},lt.prototype.getLegend=function(e,t){return this.legend?this.legend:[]},lt.prototype.setLegend=function(e){return e.url?this.legend=[{url:e.url}]:e.html?this.legend=[{html:e.html}]:this.legend=[],this.legend},lt);function lt(e,t){void 0===e&&(e={}),this.options=e,this.dataService=t,this.options=e,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}var ut,ct=(Ke(pt,ut=st),pt.prototype.createOlSource=function(){var e={format:this.getSourceFormatFromOptions(this.options)};return new ne(Object.assign(e,this.options))},pt.prototype.getSourceFormatFromOptions=function(e){if(e.format)return e.format;var t,r=e.formatType;if(r){if((t=De[r])===undefined)throw new Error("Invalid vector source format ${formatType}.")}else t=De.GeoJSON;var o=e.formatOptions;return o?new t(o):new t},pt.prototype.onUnwatch=function(){},Object.defineProperty(pt.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),pt);function pt(){return null!==ut&&ut.apply(this,arguments)||this}var dt,ht=(Ke(gt,dt=st),gt.prototype.createOlSource=function(){return this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png",new t(this.options)},gt.prototype.onUnwatch=function(){},gt);function gt(){return null!==dt&&dt.apply(this,arguments)||this}var ft,mt=(Ke(yt,ft=st),yt.prototype.createOlSource=function(){return new r(this.options)},yt.prototype.onUnwatch=function(){},yt);function yt(){return null!==ft&&ft.apply(this,arguments)||this}var vt=(bt.prototype.defineOgcFiltersDefaultOptions=function(e,t,r){var o=!0;return r&&"wms"===r&&(o=!1),(e=e||{}).enabled=e.enabled===undefined?o:e.enabled,e.editable=e.editable===undefined?o:e.editable,e.geometryName=t,e.advancedOgcFilters=!0,e.enabled&&e.pushButtons&&(e.advancedOgcFilters=!1),e},bt.prototype.buildFilter=function(e,t,r,o){var n,i;if(i=!/intersects|contains|within/gi.test(JSON.stringify(e)),e&&(o=e.geometryName!==undefined?e.geometryName:o),t&&e&&(n=b.bbox(o,t,r.getCode())),!e)return"bbox="+t.join(",")+","+r.getCode();e=this.checkIgoFiltersProperties(e,o,r);var a={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:t&&i?b.and(n,this.bundleFilter(e)):this.bundleFilter(e),outputFormat:"",geometryName:o},s=(new l).writeGetFeature(a);return"filter="+(new XMLSerializer).serializeToString(s).split(/typenames *=|typename *=\"featureTypes\" *>/gi)[1].split(/<\/Query><\/GetFeature>/gi)[0]},bt.prototype.bundleFilter=function(e){var t=this;if(e instanceof Array){var r=[];return e.forEach(function(e){r.push(t.bundleFilter(e))}),r}return e.hasOwnProperty("logical")?this.createFilter({operator:e.logical,logicalArray:this.bundleFilter(e.filters)}):e.hasOwnProperty("operator")?this.createFilter(e):void 0},bt.prototype.createFilter=function(e){var t,r=e.operator,o=e.logicalArray,n=e.propertyName,i=e.pattern,a=!e.matchCase||e.matchCase,s=e.wildCard?e.wildCard:"*",l=e.singleChar?e.singleChar:".",u=e.escapeChar?e.escapeChar:"!",c=e.lowerBoundary,p=e.upperBoundary,d=e.geometryName,h=e.extent,g=e.wkt_geometry,f=e.srsName?e.srsName:"EPSG:3857",m=e.begin,y=e.end,v=e.expression;switch(g&&(t=(new Te).readGeometry(g,{dataProjection:f,featureProjection:f||"EPSG:3857"})),r){case"BBOX":return b.bbox(d,h,f);case"PropertyIsBetween":return b.between(n,c,p);case"Contains":return b.contains(d,t,f);case"During":return b.during(n,m,y);case"PropertyIsEqualTo":return b.equalTo(n,v,a);case"PropertyIsGreaterThan":return b.greaterThan(n,v);case"PropertyIsGreaterThanOrEqualTo":return b.greaterThanOrEqualTo(n,v);case"Intersects":return b.intersects(d,t,f);case"PropertyIsNull":return b.isNull(n);case"PropertyIsLessThan":return b.lessThan(n,v);case"PropertyIsLessThanOrEqualTo":return b.lessThanOrEqualTo(n,v);case"PropertyIsLike":return b.like(n,i.replace(/[()_]/gi,l),s,l,u,a);case"PropertyIsNotEqualTo":return b.notEqualTo(n,v,a);case"Within":return b.within(d,t,f);case"And":return b.and.apply(null,o);case"Or":return b.or.apply(null,o);case"Not":return b.not.apply(null,o);default:return undefined}},bt.prototype.defineInterfaceFilterSequence=function(e,t,r,o){var n=this;return void 0===r&&(r=""),void 0===o&&(o=-1),e instanceof Array?e.forEach(function(e){n.filterSequence.concat(n.defineInterfaceFilterSequence(e,t,r,o))}):e.hasOwnProperty("logical")?(o+=1,this.filterSequence.concat(this.defineInterfaceFilterSequence(e.filters,t,e.logical,o))):e.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(e,t,o,r)),this.filterSequence},bt.prototype.computeAllowedOperators=function(e,t,r){var o,n={};if(e&&t){var i=e.find(function(e){return e.name===t});o=i&&i.allowedOperatorsType?i.allowedOperatorsType:r}switch((o=o||"basicandspatial").toLowerCase()){case"all":n=this.operators;break;case"spatial":n={Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}};break;case"basicandspatial":n={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}};break;case"basic":n={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]}};break;case"time":n={During:{spatial:!1,fieldRestrict:[]}};break;case"basicnumeric":n={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]}};break;default:n={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]}}}return n},bt.prototype.addInterfaceFilter=function(e,t,r,o){void 0===r&&(r=0),void 0===o&&(o="Or"),e=e||{operator:"PropertyIsEqualTo"};var n={propertyName:"",operator:"",active:"",filterid:ke.uuid(),begin:"",end:"",lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(n,{parentLogical:o,level:r,geometryName:t},e)},bt.prototype.checkIgoFiltersProperties=function(e,t,r,o){var n=this;void 0===o&&(o=!1);var i=[];return e instanceof Array?(e.forEach(function(e){i.push(n.checkIgoFiltersProperties(e,t,r,o))}),i):e.hasOwnProperty("logical")?Object.assign({},{logical:e.logical,filters:this.checkIgoFiltersProperties(e.filters,t,r,o)}):e.hasOwnProperty("operator")?this.addFilterProperties(e,t,r,o):void 0},bt.prototype.addFilterProperties=function(e,t,r,o){void 0===o&&(o=!1);var n=e.hasOwnProperty("filterid")?e.filterid:ke.uuid(),i=e.hasOwnProperty("active")?e.active:o,a=e.hasOwnProperty("srsName")?e.srsName:r?r.getCode():"EPSG:3857";return Object.assign({},{filterid:n,active:i,igoSpatialSelector:"fixedExtent",srsName:a},e,{geometryName:t})},bt.prototype.rebuiltIgoOgcFilterObjectFromSequence=function(o){if(o instanceof Array){if(1<=o.length){var n,i,a=o[0].parentLogical,s=[];return o.forEach(function(e){var t=Object.assign({},e),r=o.indexOf(e);n=0<=r&&r<o.length-1?o[r+1]:t,delete t.active,delete t.filterid,delete t.parentLogical,s.push(t),1===o.length?i=t:a!==n.parentLogical&&(1===s.length?console.log("You must set at least two operator in a logical ("+a+")"):(i=Object.assign({},{logical:a,filters:s}),s=[i],a=n.parentLogical))}),i}return undefined}return undefined},bt.prototype.computeIgoPushButton=function(e){if(e.groups.every(function(e){return e.computedButtons!==undefined}))return e;var r;if(e.groups&&e.bundles){if(!e.bundles.every(function(e){return e.id!==undefined}))throw new Error("You must set an id for each of your pushButtons bundles");(r=ke.ObjectUtils.copyDeep(e)).groups.forEach(function(t){t.title=t.title?t.title:t.name,t.enabled=!!t.enabled&&t.enabled,t.computedButtons=ke.ObjectUtils.copyDeep(r.bundles.filter(function(e){return t.ids.includes(e.id)}))})}else!e.groups&&e.bundles?(r=ke.ObjectUtils.copyDeep(e)).groups=[{title:"group1",name:"group1",computedButtons:ke.ObjectUtils.copyDeep(r.bundles)}]:r={bundles:e,groups:[{title:"group1",name:"group1",computedButtons:ke.ObjectUtils.copyDeep(e)}]};return r.groups.find(function(e){return e.enabled})||(r.groups[0].enabled=!0),r},bt.prototype.handleOgcFiltersAppliedValue=function(e,t,r,o){var n=e.ogcFilters;if(n){var i="",a="";if(n.enabled&&n.pushButtons){n.pushButtons=this.computeIgoPushButton(n.pushButtons);var s=n.pushButtons.groups.find(function(e){return e.enabled}).computedButtons,l=[];s.map(function(e){var t=[];e.buttons.filter(function(e){return!0===e.enabled}).forEach(function(e){return t.push(e.filters)}),1===t.length?l.push(t[0]):1<t.length&&l.push({logical:e.logical,filters:t})}),1<=l.length&&(i=this.buildFilter(1===l.length?l[0]:{logical:"And",filters:l},r,o,n.geometryName))}if(n.enabled&&n.filters){n.geometryName=n.geometryName||t;var u=n.filters;a=this.buildFilter(u,r,o,n.geometryName)}var c=n.advancedOgcFilters?a:i;return"wms"===e.type&&(c=this.formatProcessedOgcFilter(c,e.params.LAYERS)),"wfs"===e.type&&(c=this.formatProcessedOgcFilter(c,e.params.featureTypes)),c}},bt.prototype.formatProcessedOgcFilter=function(t,e){var r="";return 0===t.length&&-1===e.indexOf(",")?r=t:e.split(",").forEach(function(e){r=r+"("+t.replace("filter=","")+")"}),0<(r=r.replace(/\(\)/g,"")).length?r.replace("filter=",""):undefined},bt);function bt(){this.filterSequence=[],this.operators={PropertyIsEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsNotEqualTo:{spatial:!1,fieldRestrict:[]},PropertyIsLike:{spatial:!1,fieldRestrict:["string"]},PropertyIsGreaterThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsGreaterThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThan:{spatial:!1,fieldRestrict:["number"]},PropertyIsLessThanOrEqualTo:{spatial:!1,fieldRestrict:["number"]},PropertyIsBetween:{spatial:!1,fieldRestrict:["number"]},During:{spatial:!1,fieldRestrict:[]},PropertyIsNull:{spatial:!1,fieldRestrict:[]},Intersects:{spatial:!0,fieldRestrict:[]},Within:{spatial:!0,fieldRestrict:[]},Contains:{spatial:!0,fieldRestrict:[]}}}var St="EPSG:3857",wt=5e3,It="2.0.0",Ot="geometry",Ft=new RegExp(/(.*)?gml(.*)?/gi),xt=new RegExp(/(.*)?json(.*)?/gi);function Ct(e,t,r,o){var n="2.0.0",i=e.urlWfs,a=e.paramsWFS,s=t||wt,l=r||St,u=a.outputFormat?"outputFormat="+a.outputFormat:"",c=a.version?"version="+a.version:"version="+It,p=(a.version===n?"typenames":"typename")+"="+a.featureTypes,d=a.version===n?"count":"maxFeatures",h=t?d+"="+s:a.maxFeatures?d+"="+a.maxFeatures:d+"="+s,g=r?"srsname="+l:a.srsName?"srsname="+a.srsName:"srsname="+l,f="",m="";o&&(f="propertyName="+o,m="valueReference="+o);var y=e.sourceFields;if(!f&&y&&0<y.length){var v=[];e.sourceFields.forEach(function(e){v.push(e.name)}),f="propertyName="+v.join(",")+","+a.fieldNameGeometry}var b=i+"?service=WFS&request=GetFeature&"+c+"&"+p+"&";b+=u+"&"+g+"&"+h+"&"+f;var S=i+"?service=WFS&request=GetPropertyValue&version="+n+"&"+p+"&";return S+="&"+h+"&"+m,[{name:"outputformat",value:u},{name:"version",value:c},{name:"typename",value:p},{name:"count",value:h},{name:"srsname",value:g},{name:"propertyname",value:f},{name:"valuereference",value:m},{name:"getcapabilities",value:(i+"?service=WFS&request=GetCapabilities&"+c).replace(/&&/g,"&")},{name:"getfeature",value:b.replace(/&&/g,"&")},{name:"getpropertyvalue",value:S.replace(/&&/g,"&")}]}function Tt(e,t){t&&"wfs"===t&&(e.paramsWFS=e.params);var r,o=e.paramsWFS;return e.urlWfs=e.urlWfs||e.url,o.version=o.version||It,o.fieldNameGeometry=o.fieldNameGeometry||Ot,o.maxFeatures=o.maxFeatures||wt,o.outputFormat&&(r=o.outputFormat),!Ft.test(r)&&r||(o.version="1.1.0"),Object.assign({},e)}function Lt(e){var t=e,r=De.WFS,o=t.paramsWFS.outputFormat?t.paramsWFS.outputFormat:undefined;return o?De[o]?new(r=De[o])(t.formatOptions):o.toLowerCase().match("gml2")?new(r=De.WFS)(He({},t.formatOptions,{gmlFormat:A})):o.toLowerCase().match("gml32")?new(r=De.WFS)(He({},t.formatOptions,{gmlFormat:n})):o.toLowerCase().match("gml3")?new(r=De.WFS)(He({},t.formatOptions,{gmlFormat:B})):o.toLowerCase().match("topojson")?new(r=De.TopoJSON)(t.formatOptions):o.toLowerCase().match("geojson")?new(r=De.GeoJSON)(t.formatOptions):o.toLowerCase().match("esrijson")?new(r=De.EsriJSON)(t.formatOptions):o.toLowerCase().match("json")?new(r=De.GeoJSON)(t.formatOptions):o.toLowerCase().match("gpx")?new(r=De.GPX)(t.formatOptions):o.toLowerCase().match("WKT")?new(r=De.WKT)(t.formatOptions):o.toLowerCase().match("osmxml")?new(r=i)(t.formatOptions):o.toLowerCase().match("kml")?new(r=De.KML)(t.formatOptions):new r:new r(t.formatOptions)}var Mt,Pt=(Ke(kt,Mt=st),kt.prototype.createOlSource=function(){var o=this;return new ne({format:Lt(this.options),overlaps:!1,url:function(e,t,r){return o.options.paramsWFS.srsName=o.options.paramsWFS.srsName||r.getCode(),o.buildUrl(e,r,o.options.ogcFilters)},strategy:d.bbox})},kt.prototype.buildUrl=function(e,t,r){var o,n=this.options.paramsWFS,i=Ct(this.options,undefined,this.options.paramsWFS.srsName);r&&r.enabled&&(o=r.filters);var a=new vt,s=a.buildFilter(o,e,t,r.geometryName),l=a.handleOgcFiltersAppliedValue(this.options,r.geometryName),u="filter";l||(u="bbox",l=e.join(",")+","+t.getCode()),n.xmlFilter=r.advancedOgcFilters?s:u+"="+l;var c=i.find(function(e){return"getfeature"===e.name}).value;return c=/(filter|bbox)=.*/gi.test(n.xmlFilter)?c+"&"+n.xmlFilter:c,this.options.download=Object.assign({},this.options.download,{dynamicUrl:c}),c.replace(/&&/g,"&")},kt.prototype.onUnwatch=function(){},kt);function kt(e,t){var r=Mt.call(this,Tt(e,"wfs"))||this;r.options=e,r.wfsService=t;var o=r.options.ogcFilters,n=r.options.paramsWFS.fieldNameGeometry||Ot,i=new vt;return r.options.ogcFilters=i.defineOgcFiltersDefaultOptions(o,n),r.options.ogcFilters.enabled&&r.options.ogcFilters.editable&&r.wfsService.getSourceFieldsFromWFS(r.options),r}var Dt,jt=(Ke(Et,Dt=et),Et.prototype.getData=function(){return console.log("This is defining a data service."),"This is defining a data service."},Et.prototype.getSourceFieldsFromWFS=function(t){t.sourceFields&&0!==t.sourceFields.length?this.defineFieldAndValuefromWFS(t).subscribe(function(e){t.sourceFields.forEach(function(t){t.alias===undefined&&(t.alias=t.name),t.values!==undefined&&0!==t.values.length||(t.values=e.find(function(e){return e.name===t.name}).values)})}):(t.sourceFields=[],this.defineFieldAndValuefromWFS(t).subscribe(function(e){t.sourceFields=e}))},Et.prototype.wfsGetFeature=function(e,t,r,o){void 0===t&&(t=wt),void 0===r&&(r=St);var n=Ct(e,t,r,o).find(function(e){return"getfeature"===e.name}).value,i=e.paramsWFS.outputFormat;return Ft.test(i)||!i?this.http.get(n,{responseType:"text"}):this.http.get(n)},Et.prototype.defineFieldAndValuefromWFS=function(l){var u=this;return new Le.Observable(function(r){var o,n,i,a,s=[];a=Lt(l),u.wfsGetFeature(l,1).subscribe(function(e){var t=a.readFeatures(e);o=t[0].getKeys(),n=o.filter(function(e){return e!==t[0].getGeometryName()&&!e.match(/boundedby/gi)}),i=n.join(","),u.wfsGetFeature(l,l.paramsWFS.maxFeatures||wt,l.paramsWFS.srsName,i).subscribe(function(e){var t=a.readFeatures(e);u.built_properties_value(t).forEach(function(e){s.push(e)}),r.next(s),r.complete()})})})},Et.prototype.built_properties_value=function(e){var n=Object.assign({},e[0].getProperties());delete n[e[0].getGeometryName()],delete n.boundedBy;var i=[];for(var t in n)if(n.hasOwnProperty(t)){var r="object"==typeof e[0].get(t)?undefined:typeof e[0].get(t);i.push({name:t,alias:t,type:r,values:[n[t]]})}return e.every(function(e){var r=e.getProperties(),t=function(t){r.hasOwnProperty(t)&&t in n&&i.filter(function(e){return e.name===t}).forEach(function(e){-1===e.values.indexOf(r[t])&&e.values.push(r[t])})};for(var o in r)t(o);return!0}),i},Et.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Et.ctorParameters=function(){return[{type:Me.HttpClient}]},Et.ngInjectableDef=je.defineInjectable({factory:function(){return new Et(je.inject(Me.HttpClient))},token:Et,providedIn:"root"}),Et);function Et(e){var t=Dt.call(this)||this;return t.http=e,t}var $t,Rt={GML2:"gml2",GML3:"gml3",JSON:"json",GEOJSON:"geojson",GEOJSON2:"geojson2",ESRIJSON:"esrijson",TEXT:"text",HTML:"html",HTMLGML2:"htmlgml2"},At={GML2:"application/vnd.ogc.gml",GML3:"application/vnd.ogc.gml/3.1.1",JSON:"application/json",GEOJSON:"application/geojson",GEOJSON2:"geojson",ESRIJSON:"application/json",TEXT:"text/plain",HTML:"text/html",HTMLGML2:"text/html"},Bt={IFRAME:"iframe",BLANK:"_blank"},Gt=(Ke(_t,$t=st),Object.defineProperty(_t.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"mapLabel",{get:function(){return this.options.mapLabel},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Bt.BLANK},enumerable:!0,configurable:!0}),_t.prototype.refresh=function(){this.ol.updateParams({igoRefresh:Math.random()})},_t.prototype.buildDynamicDownloadUrlFromParamsWFS=function(e){return Ct(e).find(function(e){return"getfeature"===e.name}).value},_t.prototype.createOlSource=function(){return new a(this.options)},_t.prototype.getLegend=function(r,e){var t=$t.prototype.getLegend.call(this);if(0<t.length&&r===undefined&&!e)return t;var o=this.params,n=[];o.LAYERS!==undefined&&(n=o.LAYERS.split(","));var i=this.options.url.replace(/\?$/,""),a=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0","VERSION="+(o.VERSION||"1.3.0")];return r!==undefined&&a.push("STYLE="+r),e!==undefined&&a.push("SCALE="+e),t=n.map(function(e){var t=i.match(/\?/)?"&":"?";return{url:i+t+a.join("&")+"&LAYER="+e,title:1<n.length?e:undefined,currentStyle:r===undefined?undefined:r}})},_t.prototype.onUnwatch=function(){},_t);function _t(e,t){var r=$t.call(this,e)||this;r.options=e,r.wfsService=t;var o=e.params,n=o.DPI||96;o.DPI=n,o.MAP_RESOLUTION=n,o.FORMAT_OPTIONS="dpi:"+n,e.refreshIntervalSec&&0<e.refreshIntervalSec&&setInterval(function(){r.refresh()},1e3*e.refreshIntervalSec);var i=Ot;if(e.paramsWFS){var a=Tt(e,"wms");ke.ObjectUtils.mergeDeep(e.paramsWFS,a.paramsWFS),i=e.paramsWFS.fieldNameGeometry||i,e.download=Object.assign({},e.download,{dynamicUrl:r.buildDynamicDownloadUrlFromParamsWFS(e)})}e.sourceFields&&0!==e.sourceFields.length?e.sourceFields.forEach(function(e){e.alias=e.alias?e.alias:e.name}):e.sourceFields=[];var s=e.ogcFilters,l=new vt;s?s.advancedOgcFilters=!s.pushButtons:e.ogcFilters=l.defineOgcFiltersDefaultOptions(s,i,"wms"),1<o.LAYERS.split(",").length&&s&&s.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+o.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),e.paramsWFS&&s&&s.enabled&&s.editable&&r.wfsService.getSourceFieldsFromWFS(e);var u=l.handleOgcFiltersAppliedValue(e,i);return o.FILTER=u,r}function qt(e){for(var t=(e?Se.get(e):Se.get("EPSG:3857")).getExtent(),r=c.getWidth(t)/256,o=new Array(20),n=new Array(20),i=0;i<20;++i)o[i]=r/Math.pow(2,i),n[i]=i;return new u({origin:c.getTopLeft(t),resolutions:o,matrixIds:n})}var Nt,Vt=(Ke(Ut,Nt=st),Ut.prototype.createOlSource=function(){var e=Object.assign({tileGrid:qt(this.options.projection)},this.options);return new s(e)},Ut.prototype.onUnwatch=function(){},Ut);function Ut(e){return Nt.call(this,e)||this}var Wt,zt=(Ke(Kt,Wt=st),Object.defineProperty(Kt.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(Kt.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(Kt.prototype,"mapLabel",{get:function(){return this.options.mapLabel},enumerable:!0,configurable:!0}),Object.defineProperty(Kt.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Bt.BLANK},enumerable:!0,configurable:!0}),Kt.prototype.createOlSource=function(){var e=this.options.crossOrigin?this.options.crossOrigin:"anonymous",t=Object.assign({crossOrigin:e},this.options);return new p(t)},Kt.prototype.getLegend=function(){var e,t,r=Wt.prototype.getLegend.call(this);if(0<r.length)return r;var o="<table>";if(null!=this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(function(e){!0===e.visible&&(o+='<tr><td><p><font size="5" color="'+e.value+'"> &#9679</font></p></td><td>'+e.name+"</td></tr>")}),[{html:o+="</table>"}];var n=this.options.config.layers[0].options;try{for(var i=Qe(["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"]),a=i.next();!a.done;a=i.next()){var s=a.value;if(n.cartocss.includes(s)){var l=n.cartocss.split(s).pop(),u=l.substr(0,l.indexOf(";"));if(u.includes("ramp")){for(var c=u.split(", (")[1].split(","),p=u.split(", (")[2].split(","),d=0;d<c.length;d++)c[d]=c[d].replace(/("|\))/g,""),p[d]=p[d].replace(/("|\))/g,""),"="===p[d].replace(/\s+/g,"")&&(p[d]="Autres"),o+='<tr><td><p><font size="5" color="'+c[d]+'"> &#9679</font></p></td><td>'+p[d]+"</td></tr>";break}var h=n.layer_name?n.layer_name:"";o+='<tr><td><p><font size="5" color="'+u+'"> &#9679</font></p></td><td>'+h+"</td></tr>";break}}}catch(g){e={error:g}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}return[{html:o+="</table>"}]},Kt.prototype.onUnwatch=function(){},Kt);function Kt(){return null!==Wt&&Wt.apply(this,arguments)||this}var Ht,Yt=(Ke(Zt,Ht=st),Zt.prototype.createOlSource=function(){var e=new G;return new ne({attributions:this.options.params.attributions,overlaps:!1,format:e,url:function(e,t,r){var o=this.options.url+"/"+this.options.layer+"/query/",n=["f=json","geometry="+encodeURIComponent('{"xmin":'+e[0]+',"ymin":'+e[1]+',"xmax":'+e[2]+',"ymax":'+e[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];if(this.options.params.timeFilter){var i="time="+this.options.params.timeExtent;n.push(i)}return this.options.params.customParams&&this.options.params.customParams.forEach(function(e){n.push(e)}),o+"?"+n.join("&")}.bind(this),strategy:d.bbox})},Zt.prototype.getLegend=function(){var e,t,r=this.options.params.legendInfo,o=Ht.prototype.getLegend.call(this);if(r===undefined||0<o.length)return o;var n=parseInt(this.options.layer,10),i=r.layers[n],a="<table><tr><td>"+i.layerName+"</td></tr>";try{for(var s=Qe(i.legend),l=s.next();!l.done;l=s.next()){var u=l.value;a+="<tr><td align='left'><img src=\""+this.options.url.replace("FeatureServer","MapServer")+"/"+i.layerId+"/images/"+u.url+"\" alt ='' /></td><td>"+u.label.replace("<Null>","Null")+"</td></tr>"}}catch(c){e={error:c}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}return[{html:a+="</table>"}]},Zt.prototype.onUnwatch=function(){},Zt);function Zt(){return null!==Ht&&Ht.apply(this,arguments)||this}var Qt,Jt=(Ke(Xt,Qt=st),Object.defineProperty(Xt.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(Xt.prototype,"queryTitle",{get:function(){return this.options.queryTitle?this.options.queryTitle:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(Xt.prototype,"mapLabel",{get:function(){return this.options.mapLabel},enumerable:!0,configurable:!0}),Object.defineProperty(Xt.prototype,"queryHtmlTarget",{get:function(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:Bt.BLANK},enumerable:!0,configurable:!0}),Xt.prototype.createOlSource=function(){return new h(this.options)},Xt.prototype.getLegend=function(){var e,t,r=Qt.prototype.getLegend.call(this);if(this.options.legendInfo===undefined||0<r.length)return r;var o=parseInt(this.options.layer,10),n=this.options.legendInfo.layers[o],i="<table><tr><td>"+n.layerName+"</td></tr>";try{for(var a=Qe(n.legend),s=a.next();!s.done;s=a.next()){var l=s.value;i+="<tr><td align='left'><img src=\""+this.options.url+"/"+n.layerId+"/images/"+l.url+"\" alt ='' /></td><td>"+l.label.replace("<Null>","Null")+"</td></tr>"}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}return[{html:i+="</table>"}]},Xt.prototype.onUnwatch=function(){},Xt);function Xt(){return null!==Qt&&Qt.apply(this,arguments)||this}var er,tr=(Ke(rr,er=ct),rr.prototype.createOlSource=function(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),er.prototype.createOlSource.call(this)},rr.prototype.createWebSocket=function(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))},rr.prototype.onMessage=function(e){var t=this.options.format.readFeature(e.data);switch(this.options.onmessage){case"update":var r=this.ol.getFeatureById(t.getId());r&&this.ol.removeFeature(r),this.ol.addFeature(t);break;case"delete":this.ol.clear(!0),this.ol.addFeature(t);break;case"add":default:this.ol.addFeature(t)}},rr.prototype.onClose=function(e){},rr.prototype.onError=function(e){},rr.prototype.onOpen=function(e){},rr.prototype.onUnwatch=function(){this.ws.close()},rr);function rr(){return null!==er&&er.apply(this,arguments)||this}var or,nr=(Ke(ir,or=st),ir.prototype.createOlSource=function(){var e;return"feature"===this.options.featureClass?e=new m({featureClass:be}):this.options.featureClass===undefined&&(e=new m),this.options.format=e,new f(this.options)},ir.prototype.generateId=function(){if(!this.options.url)return ke.uuid();var e="mvt"+this.options.url;return g.Md5.hashStr(e)},ir.prototype.onUnwatch=function(){},ir);function ir(){return null!==or&&or.apply(this,arguments)||this}var ar,sr=(Ke(lr,ar=ct),lr.prototype.createOlSource=function(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=ar.prototype.createOlSource.call(this),new y(this.options)},lr.prototype.generateId=function(){return ke.uuid()},lr.prototype.onUnwatch=function(){},lr);function lr(){return null!==ar&&ar.apply(this,arguments)||this}var ur="Feature",cr={None:0,Move:1,Zoom:2,Default:3};cr[cr.None]="None",cr[cr.Move]="Move",cr[cr.Zoom]="Zoom",cr[cr.Default]="Default";var pr="Layer";function dr(e,t,r){var o,n,i,a,s,l,u,c,p,d,h,g,f,m,y,v,b,S,w,I,O,F,x,C,T,L,M,P,k,D;void 0===r&&(r={});var j,E=new RegExp("(\\s*;\\s*[\\d]{4,6})","g"),$="([-+])?([\\d]{1,3})([,.](\\d+))?",R=$+"[\\s,]+"+$,A=new RegExp("^"+R+"$","g"),B="([0-9]{1,2})[:|°]?\\s*([0-9]{1,2})?[:|'|′|’]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*[\"|″|”]?\\s*",G=B+"([N|S|E|W|O]),?\\s*"+B+"([N|S|E|W|O])",_=new RegExp("^"+G,"gi"),q="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",N=new RegExp("^"+q,"gi"),V="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",U=new RegExp("^"+V,"gi"),W="([-+])?(\\d{1,3})[,.](\\d+)",z=W+"\\s*[,]?\\s*"+W,K=new RegExp("^"+z,"g"),H="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Y=H+"\\s*[,.]?\\s*"+H,Z=new RegExp("^"+Y,"g"),Q="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",J=new RegExp("^"+Q+"?","gi"),X="([-+]?\\d+)[,.]?(\\d+)?",ee=X+"[\\s,]+"+X,te=new RegExp("^"+ee+"$","g"),re=!1;if(e=e.toLocaleUpperCase().trim(),E.test(e)?(f=(o=Je(e.split(";").map(function(e){return e.trim()}),2))[0],j=o[1]):f=e,A.test(f))m=(n=Je(f.match(R),9))[1],k=n[2],w=n[4],I=n[5],D=n[6],T=n[8],k=parseFloat((m||"")+k+"."+w),D=parseFloat((I||"")+D+"."+T);else if(_.test(f))y=(i=Je(f.match(G),9))[1],v=i[2],b=i[3],S=i[4],O=i[5],F=i[6],x=i[7],C=i[8],"S"!==S&&"N"!==S||(y=[O,O=y][0],v=[F,F=v][0],b=[x,x=b][0],S=[C,C=S][0]),k=hr(parseFloat(y),parseFloat(v),parseFloat(b),S),D=hr(parseFloat(O),parseFloat(F),parseFloat(x),C);else if(N.test(f)){re=!0,L=(a=Je(f.match(q),5))[2],k=a[3],D=a[4];var oe=Number(L)<10?"EPSG:3260"+L:"EPSG:326"+L;k=(s=Je(Se.transform([parseFloat(k),parseFloat(D)],oe,"EPSG:4326"),2))[0],D=s[1]}else if(U.test(f)){re=!0,L=(l=Je(f.match(V),5))[2],k=l[3],D=l[4];var ne=Number(L)<10?"EPSG:3218"+L:"EPSG:321"+(80+Number(L));k=(u=Je(Se.transform([parseFloat(k),parseFloat(D)],ne,"EPSG:4326"),2))[0],D=u[1]}else if(Z.test(f))m=(c=Je(f.match(Y),11))[1],y=c[2],v=c[3],b=c[4],w=c[5],I=c[6],O=c[7],F=c[8],x=c[9],T=c[10],k=hr(parseFloat((m||"")+y),parseFloat(v),parseFloat(b),S),D=hr(parseFloat((I||"")+O),parseFloat(F),parseFloat(x),C);else if(K.test(f))m=(p=Je(f.match(z),7))[1],y=p[2],w=p[3],I=p[4],O=p[5],T=p[6],k=hr(parseFloat((m||"")+y),parseFloat(v),parseFloat(b),S),D=hr(parseFloat((I||"")+O),parseFloat(F),parseFloat(x),C);else if(J.test(f))I=(d=Je(f.match(Q),15))[1],O=d[2],F=d[3],x=d[4],C=d[6],m=d[7],y=d[8],v=d[9],b=d[10],S=d[12],M=d[13],P=d[14],S=S||"W",k=v&&2<v.length?parseFloat((m||"")+y+"."+v):hr(parseFloat(y),parseFloat(v),parseFloat(b),S),D=F&&2<F.length?parseFloat((I||"")+O+"."+F):hr(parseFloat(O),parseFloat(F),parseFloat(x),C);else{if(!te.test(f))return{lonLat:undefined,message:"",radius:undefined,conf:undefined};re=!0,k=(h=Je(f.match(ee),5))[1],w=h[2],D=h[3],T=h[4],w&&(k=parseFloat(k+"."+w)),T&&(D=parseFloat(D+"."+T))}if(r.forceNA&&!re&&(0<k&&0<D&&(D<k?k=-k:D=-D),D<k&&(k=[D,D=k][0])),g=[Number(k),Number(D)],j!==undefined&&"4326"!==j||180<g[0]||g[0]<-180||90<g[1]||g[1]<-90){var ie=j?"EPSG:"+j:t;try{g=Se.transform(g,ie,"EPSG:4326")}catch(ae){return{lonLat:undefined,message:"Projection "+ie+" not supported",radius:undefined,conf:undefined}}}return{lonLat:g,message:"",radius:M?parseInt(M,10):undefined,conf:P?parseInt(P,10):undefined}}function hr(e,t,r,o){var n=e+(t=t||0)/60+(r=r||0)/3600;return"S"!==o&&"W"!==o||(n=-n),n}function gr(e,t){if(e===undefined||t===undefined)return!1;return e.zoom===t.zoom&&Math.trunc(e.center[0]/1e-4)===Math.trunc(t.center[0]/1e-4)&&Math.trunc(e.center[1]/1e-4)===Math.trunc(t.center[1]/1e-4)}function fr(e){return(e=Math.round(e))<1e4?e+"":(e=Math.round(e/1e3))<1e3?e+"K":(e=Math.round(e/1e3))+"M"}function mr(e,t){void 0===t&&(t=96);return e/(39.3701*t)}function yr(e,t,r){void 0===t&&(t="m"),void 0===r&&(r=96);return e*Se.METERS_PER_UNIT[t]*39.3701*r}function vr(e){var t=e.originalEvent;return!t.altKey&&(L.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey}function br(e,t){return void 0===t&&(t=3),[e[0].toFixed(t),e[1].toFixed(t)]}function Sr(o,e){var t=Se.transform(o,"EPSG:4326","EPSG:3857"),n=[{code:"EPSG:3857",alias:"Web mercator",coord:t,igo2CoordFormat:br(t).join(", ")+" ; 3857"}],r=wr(o),i=r<10?"EPSG:3260"+r:"EPSG:326"+r,a="UTM-"+r,s=Se.transform(o,"EPSG:4326",i);n.push({code:i,alias:"UTM",coord:s,igo2CoordFormat:a+" "+br(s).join(", ")});var l=Ir(o);if(l){var u=l<10?"EPSG:3218"+l:"EPSG:321"+(80+l),c="MTM-"+l,p=Se.transform(o,"EPSG:4326",u);n.push({code:u,alias:"MTM",coord:p,igo2CoordFormat:c+" "+br(p).join(", ")})}return e.forEach(function(e){var t=Se.transform(o,"EPSG:4326",e.code),r=e.code.split(":")[1];n.push({code:e.code,alias:e.alias||e.code,coord:t,igo2CoordFormat:br(t).join(", ")+" ; "+r})}),n}function wr(e){return Math.ceil((e[0]+180)/6)}function Ir(e){var t,r=e[0];return r<-51&&-54<r&&(t=1),r<-54&&-57<r&&(t=2),r<-57&&-60<r&&(t=3),r<-60&&-63<r&&(t=4),r<-63&&-66<r&&(t=5),r<-66&&-69<r&&(t=6),r<-69&&-72<r&&(t=7),r<-72&&-75<r&&(t=8),r<-75&&-78<r&&(t=9),r<-78&&-81<r&&(t=10),t}var Or=(Object.defineProperty(Fr.prototype,"id",{get:function(){return this.options.id||this.dataSource.id},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"title",{get:function(){return this.options.title},set:function(e){this.options.title=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"zIndex",{get:function(){return this.ol.getZIndex()},set:function(e){this.ol.setZIndex(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"baseLayer",{get:function(){return this.options.baseLayer},set:function(e){this.options.baseLayer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"opacity",{get:function(){return this.ol.get("opacity")},set:function(e){this.ol.setOpacity(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"isInResolutionsRange",{get:function(){return this.isInResolutionsRange$.value},set:function(e){this.isInResolutionsRange$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"maxResolution",{get:function(){return this.ol.getMaxResolution()},set:function(e){this.ol.setMaxResolution(e||Infinity),this.updateInResolutionsRange()},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"minResolution",{get:function(){return this.ol.getMinResolution()},set:function(e){this.ol.setMinResolution(e||0),this.updateInResolutionsRange()},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"visible",{get:function(){return this.visible$.value},set:function(e){this.ol.setVisible(e),this.visible$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"displayed",{get:function(){return this.visible&&this.isInResolutionsRange},enumerable:!0,configurable:!0}),Object.defineProperty(Fr.prototype,"showInLayerList",{get:function(){return!1!==this.options.showInLayerList},enumerable:!0,configurable:!0}),Fr.prototype.setMap=function(e){this.map=e,this.unobserveResolution(),e!==undefined&&this.observeResolution()},Fr.prototype.observeResolution=function(){var e=this;this.resolution$$=this.map.viewController.resolution$.subscribe(function(){return e.updateInResolutionsRange()})},Fr.prototype.unobserveResolution=function(){this.resolution$$!==undefined&&(this.resolution$$.unsubscribe(),this.resolution$$=undefined)},Fr.prototype.updateInResolutionsRange=function(){if(this.map!==undefined){var e=this.map.viewController.getResolution(),t=this.minResolution,r=this.maxResolution===undefined?Infinity:this.maxResolution;this.isInResolutionsRange=t<=e&&e<=r}else this.isInResolutionsRange=!1},Fr);function Fr(e,t){this.options=e,this.authInterceptor=t,this.legendCollapsed=!0,this.firstLoadComponent=!0,this.isInResolutionsRange$=new Le.BehaviorSubject(!1),this.visible$=new Le.BehaviorSubject(undefined),this.displayed$=Le.combineLatest([this.isInResolutionsRange$,this.visible$]).pipe(Pe.map(function(e){return e[0]&&e[1]})),this.dataSource=e.source,this.ol=this.createOlLayer(),e.zIndex!==undefined&&(this.zIndex=e.zIndex),e.baseLayer&&e.visible===undefined&&(e.visible=!1),this.maxResolution=e.maxResolution||mr(Number(e.maxScaleDenom)),this.minResolution=e.minResolution||mr(Number(e.minScaleDenom)),this.visible=e.visible===undefined||e.visible,this.opacity=e.opacity===undefined?1:e.opacity,e.legendOptions&&(e.legendOptions.url||e.legendOptions.html)&&(this.legend=this.dataSource.setLegend(e.legendOptions)),this.legendCollapsed=!e.legendOptions||(!e.legendOptions.collapsed||e.legendOptions.collapsed),this.ol.set("_layer",this,!0)}var xr,Cr={TITLE:"title",ABSTRACT:"abstract",CUSTOM:"custom"},Tr=(Ke(Lr,xr=ke.Watcher),Lr.prototype.watch=function(){var t=this;this.source.on("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("imageloaderror",function(e){return t.handleLoadEnd(e)})},Lr.prototype.unwatch=function(){var t=this;this.source.un("imageloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("imageloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("imageloaderror",function(e){return t.handleLoadEnd(e)})},Lr.prototype.handleLoadStart=function(e){e.image.__watchers__||(e.image.__watchers__=[]),e.image.__watchers__.push(this.id),this.loading+=1,this.status=ke.SubjectStatus.Working},Lr.prototype.handleLoadEnd=function(e){if(e.image.__watchers__){var t=e.image.__watchers__.indexOf(this.id);if(!(t<0)){e.image.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=ke.SubjectStatus.Done,this.loaded=this.loading=0)}}},Lr);function Lr(e){var t=xr.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=ke.uuid(),t}var Mr,Pr=(Ke(kr,Mr=ke.Watcher),kr.prototype.watch=function(){var t=this;this.source.on("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.on("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.on("tileloaderror",function(e){return t.handleLoadEnd(e)})},kr.prototype.unwatch=function(){var t=this;this.source.un("tileloadstart",function(e){return t.handleLoadStart(e)}),this.source.un("tileloadend",function(e){return t.handleLoadEnd(e)}),this.source.un("tileloaderror",function(e){return t.handleLoadEnd(e)})},kr.prototype.handleLoadStart=function(e){e.tile.__watchers__||(e.tile.__watchers__=[]),e.tile.__watchers__.push(this.id),this.loading+=1,this.status=ke.SubjectStatus.Working},kr.prototype.handleLoadEnd=function(e){if(e.tile.__watchers__){var t=e.tile.__watchers__.indexOf(this.id);if(!(t<0)){e.tile.__watchers__.splice(t,1),this.loaded+=1;var r=this.loading;this.loaded>=r&&r===this.loading&&(this.status=ke.SubjectStatus.Done,this.loaded=this.loading=0)}}},kr);function kr(e){var t=Mr.call(this)||this;return t.loaded=0,t.loading=0,t.source=e.options.source.ol,t.id=ke.uuid(),t}function Dr(e,t){var r,o,n,i,a=[],s=document.createElement("canvas").getContext("2d");s.font="20px Calibri";var l=0;try{for(var u=Qe(e),c=u.next();!c.done;c=u.next()){var p=c.value;if(!1!==p.visible){var d=p.dataSource.getLegend(undefined,t)||[],h=function(e){if(e.url===undefined)return"continue";var t=p.title,r=new Image;r.crossOrigin="anonymous",r.src=e.url,r.onload=function(){s.fillText(t,0,l),s.drawImage(r,0,l+20),l+=r.height+5},a.push({title:t,url:e.url,image:r})};try{for(var g=Qe(d),f=g.next();!f.done;f=g.next()){h(f.value)}}catch(m){n={error:m}}finally{try{f&&!f.done&&(i=g["return"])&&i.call(g)}finally{if(n)throw n.error}}}}}catch(y){r={error:y}}finally{try{c&&!c.done&&(o=u["return"])&&o.call(u)}finally{if(r)throw r.error}}return a}var jr,Er=(Ke($r,jr=ke.Watcher),$r.prototype.watch=function(){},$r.prototype.unwatch=function(){this.layer.onUnwatch()},$r);function $r(e){var t=jr.call(this)||this;return t.loaded=0,t.loading=0,t.layer=e,t.id=ke.uuid(),t}var Rr,Ar=(Ke(Br,Rr=Or),Br.prototype.createOlLayer=function(){var r=this,e=Object.assign({},this.options,{source:this.options.source.ol}),t=new M(e);return this.authInterceptor&&t.getSource().setImageLoadFunction(function(e,t){r.customLoader(e,t)}),t},Br.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),Rr.prototype.setMap.call(this,e)},Br.prototype.customLoader=function(o,e){var t=new XMLHttpRequest;if(t.open("GET",e),!this.authInterceptor.interceptXhr(t,e))return t.abort(),void(o.getImage().src=e);t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(this.response),t=new Blob([e],{type:"image/png"}),r=window.URL.createObjectURL(t);o.getImage().src=r},t.send()},Br);function Br(e,t){var r=Rr.call(this,e,t)||this;return r.authInterceptor=t,r.watcher=new Tr(r),r.status$=r.watcher.status$,r}var Gr,_r=(Ke(qr,Gr=Or),qr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new P(e)},qr.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),Gr.prototype.setMap.call(this,e)},qr);function qr(e){var t=Gr.call(this,e)||this;return t.watcher=new Pr(t),t.status$=t.watcher.status$,t}var Nr,Vr=(Ke(Ur,Nr=Or),Object.defineProperty(Ur.prototype,"browsable",{get:function(){return!1!==this.options.browsable},enumerable:!0,configurable:!0}),Object.defineProperty(Ur.prototype,"exportable",{get:function(){return!1!==this.options.exportable},enumerable:!0,configurable:!0}),Ur.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return this.options.animation&&this.dataSource.ol.on("addfeature",function(e){this.flash(e.feature)}.bind(this)),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature),new ie(e)},Ur.prototype.flash=function(p){var d=(new Date).getTime(),h=this.map.ol.on("postcompose",function g(e){var t=e.vectorContext,r=e.frameState,o=p.getGeometry().clone(),n=r.time-d,i=n/this.options.animation.duration,a=j.easeOut(1-i),s=k.asArray(this.options.animation.color||"red");s[3]=a;var l=this.ol.getStyleFunction().call(this,p).find(function(e){return e.getImage()}),u=(l=l||this.ol.getStyleFunction().call(this,p)[0]).clone();switch(p.getGeometry().getType()){case"Point":var c=j.easeOut(i)*(3*u.getImage().getRadius());u.getImage().setRadius(c),u.getImage().setOpacity(a);break;case"LineString":u.getImage()&&(u.getImage().getStroke().setColor(s),u.getImage().getStroke().setWidth(j.easeOut(i)*(3*u.getImage().getStroke().getWidth()))),u.getStroke()&&(u.getStroke().setColor(s),u.getStroke().setWidth(j.easeOut(i)*(3*u.getStroke().getWidth())));break;case"Polygon":u.getImage()&&u.getImage().getFill().setColor(s),u.getFill()&&u.getFill().setColor(s)}if(u.setText(""),t.setStyle(u),t.drawGeometry(o),n>this.options.animation.duration)return fe.unByKey(h),void this.map.ol.render();this.map.ol.render()}.bind(this))},Ur.prototype.setMap=function(e){e===undefined?this.watcher.unsubscribe():this.watcher.subscribe(function(){}),Nr.prototype.setMap.call(this,e)},Ur.prototype.onUnwatch=function(){this.dataSource.onUnwatch(),this.stopAnimation()},Ur.prototype.stopAnimation=function(){this.dataSource.ol.un("addfeature",function(e){this.visible&&this.flash(e.feature)}.bind(this))},Ur.prototype.enableTrackFeature=function(e){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,e))},Ur.prototype.centerMapOnFeature=function(e){var t=this.dataSource.ol.getFeatureById(e);t&&this.map.ol.getView().setCenter(t.getGeometry().getCoordinates())},Ur.prototype.trackFeature=function(e,t){t.feature.getId()===e&&this.visible&&this.centerMapOnFeature(e)},Ur.prototype.disableTrackFeature=function(e){fe.unByKey(this.trackFeatureListenerId)},Ur);function Ur(e){var t=Nr.call(this,e)||this;return t.watcher=new Er(t),t.status$=t.watcher.status$,t}var Wr,zr=(Ke(Kr,Wr=Or),Kr.prototype.createOlLayer=function(){var e=Object.assign({},this.options,{source:this.options.source.ol});return new D(e)},Kr);function Kr(e){var t=Wr.call(this,e)||this;return t.watcher=new Pr(t),t.status$=t.watcher.status$,t}var Hr=(Object.defineProperty(Yr.prototype,"view",{get:function(){return this._view},set:function(e){this._view=e,this.map!==undefined&&this.map.updateView(e)},enumerable:!0,configurable:!0}),Yr.prototype.ngOnInit=function(){var t=this;this.status$$=this.map.status$.subscribe(function(e){return t.handleStatusChange(e)})},Yr.prototype.ngAfterViewInit=function(){this.map.setTarget(this.id)},Yr.prototype.ngOnDestroy=function(){this.map.setTarget(undefined),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()},Yr.prototype.handleStatusChange=function(e){e===ke.SubjectStatus.Working&&this.activityId===undefined?this.activityId=this.activityService.register():e===ke.SubjectStatus.Done&&this.activityId!==undefined&&(this.activityService.unregister(this.activityId),this.activityId=undefined)},Yr.decorators=[{type:je.Component,args:[{selector:"igo-map-browser",template:'<div [id]="id" class="igo-map-browser-target"></div>\r\n<ng-content></ng-content>\r\n',styles:[":host{position:relative;display:block}.igo-map-browser-target,:host{width:100%;height:100%}:host>>>igo-zoom-button{position:absolute;bottom:5px;right:5px}:host>>>igo-offline-button{position:absolute;bottom:15px;right:5px}:host>>>igo-geolocate-button{position:absolute;bottom:5px;right:5px}:host>>>igo-rotation-button{position:absolute;top:calc(40px + 5px + 5px);right:5px}:host>>>igo-user-button{position:absolute;bottom:5px;right:calc(5px + 50px)}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){:host>>>igo-zoom-button{display:none}:host>>>igo-offline-button{bottom:5px}:host>>>igo-geolocate-button{bottom:5px}:host>>>igo-rotation-button{top:calc(40px + 5px + 5px)}:host>>>igo-user-button{right:calc(5px + 90px)}}:host>>>igo-baselayers-switcher{position:absolute;bottom:5px;left:5px}:host>>>.ol-attribution{left:5px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:rgba(255,255,255,0);width:calc(100% - 100px)}:host>>>.ol-attribution.ol-logo-only{height:inherit}:host>>>.ol-attribution.ol-collapsed{background:0 0}:host>>>.ol-attribution.ol-collapsed button{-webkit-transform:none;transform:none}:host>>>.ol-attribution button{-webkit-transform:rotate(180deg);transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:0}:host>>>.ol-scale-line-inner{color:#000;border-color:#000;text-shadow:#fff -1px -1px 3px,#fff 1px -1px 3px,#fff -1px 1px 3px,#fff 1px 1px 4px;box-shadow:0 1px 0 1px rgba(255,255,255,.6)}:host>>>.ol-scale-line{background-color:rgba(255,255,255,0);bottom:4px;-webkit-transform:translate(-50%);transform:translate(-50%);left:50%}:host>>>canvas{display:block}"]}]}],Yr.ctorParameters=function(){return[{type:Ae.ActivityService}]},Yr.propDecorators={map:[{type:je.Input}],view:[{type:je.Input}]},Yr);function Yr(e){this.activityService=e,this.id="igo-map-target-"+(new Date).getTime()}var Zr={None:0,Move:1,Zoom:2,ZoomIfOutMapExtent:3};Zr[Zr.None]="None",Zr[Zr.Move]="Move",Zr[Zr.Zoom]="Zoom",Zr[Zr.ZoomIfOutMapExtent]="ZoomIfOutMapExtent";var Qr=(Jr.prototype.setFeatures=function(e,t){void 0===t&&(t=Zr.None),this.features$.next([e,t])},Jr.prototype.clear=function(){this.features$.next([[],Zr.None])},Jr.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Jr.ctorParameters=function(){return[]},Jr.ngInjectableDef=je.defineInjectable({factory:function(){return new Jr},token:Jr,providedIn:"root"}),Jr);function Jr(){this.features$=new Le.BehaviorSubject([[],undefined])}var Xr=(Object.defineProperty(eo.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),eo.prototype.ngOnInit=function(){var t=this;this.features$$=this.overlayService.features$.subscribe(function(e){return t.handleFeatures(e[0],e[1])})},eo.prototype.ngOnDestroy=function(){this.features$$.unsubscribe()},eo.prototype.handleFeatures=function(e,t){},eo.decorators=[{type:je.Directive,args:[{selector:"[igoOverlay]"}]}],eo.ctorParameters=function(){return[{type:Hr,decorators:[{type:je.Self}]},{type:Qr}]},eo);function eo(e,t){this.component=e,this.overlayService=t,this.format=new Oe}function to(){var e=new ct;return new Vr({title:"Overlay",zIndex:300,source:e,style:function t(){var o,n=ro(),i=oo();return function(e){if("bufferFeature"===e.getId())return o=function a(e,t,r,o){void 0===e&&(e=[0,161,222,1]);void 0===t&&(t=2);void 0===r&&(r=[0,161,222,.15]);var n=new we.Stroke({width:t,color:e}),i=new we.Stroke({color:r});return new we.Style({stroke:n,fill:i,image:new we.Circle({radius:5,stroke:n,fill:i}),text:new we.Text({font:"12px Calibri,sans-serif",text:o,fill:new we.Fill({color:"#000"}),stroke:new we.Stroke({color:"#fff",width:3}),overflow:!0})})}(e.get("bufferStroke"),2,e.get("bufferFill"),e.get("bufferText"));var t=e.get("_style");if(t)return(new no).createStyle(t);var r=e.getGeometry().getType();return(o="Point"===r?i:n).getText().setText(e.get("_mapTitle")),o}}()})}function ro(e){var t=void 0===e?{}:e,r=t.text,o=t.fillOpacity,n=t.strokeWidth,i=void 0===n?2:n,a=t.strokeOpacity,s=t.color,l=void 0===s?[0,161,222,.3]:s,u=t.strokeColor,c=l.slice(0),p=l.slice(0);p[3]=1,o&&(c[3]=o),a&&(p[3]=a),u&&(p[0]=u[0],p[1]=u[1],p[2]=u[2]);var d=new we.Stroke({width:i,color:p}),h=new we.Fill({color:c});return new we.Style({stroke:d,fill:h,image:new we.Circle({radius:5,stroke:d,fill:h}),text:new we.Text({text:r,font:"12px Calibri,sans-serif",fill:new we.Fill({color:"#000"}),stroke:new we.Stroke({color:"#fff",width:3}),overflow:!0})})}function oo(e){var t,r,o,n,i=void 0===e?{}:e,a=i.text,s=i.opacity,l=void 0===s?1:s,u=i.color,c=void 0===u?"blue":u,p=i.outlineColor,d=/msie\s|trident\/|edge\//i.test(window.navigator.userAgent);switch(c){case"blue":r='"rgb(0,161,222)"',t=c;break;case"red":r='"rgb(246,65,57)"',t=c;break;case"yellow":r='"rgb(255,215,0)"',t=c;break;case"green":r='"rgb(0,128,0)"',t=c;break;default:r='"rgb(0,161,222)"',t="blue"}if(p){switch(p instanceof Array&&(o="rgb("+p[0]+","+p[1]+","+p[2]+")"),p){case"blue":o="rgb(0,161,222)";break;case"red":o="rgb(246,65,57)";break;case"yellow":o="rgb(255,215,0)";break;case"green":o="rgb(0,128,0)"}n='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+r+' stroke="'+o+'" stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>'}return d?new we.Style({image:new we.Icon({src:"./assets/igo2/geo/icons/place_"+t+"_36px.svg",opacity:l,imgSize:[36,36],anchor:[.5,.92]}),text:new we.Text({text:a,font:"12px Calibri,sans-serif",fill:new we.Fill({color:"#000"}),stroke:new we.Stroke({color:"#fff",width:3}),overflow:!0})}):new we.Style({image:new we.Icon({src:n?"data:image/svg+xml;utf8,"+n:"./assets/igo2/geo/icons/place_"+t+"_36px.svg",opacity:l,imgSize:[36,36],anchor:[.5,.92]}),text:new we.Text({text:a,font:"12px Calibri,sans-serif",fill:new we.Fill({color:"#000"}),stroke:new we.Stroke({color:"#fff",width:3}),overflow:!0})})}var no=(io.prototype.createStyle=function(e){return e?"function"==typeof e||e instanceof we.Style?e:this.parseStyle("style",e):oo()},io.prototype.parseStyle=function(e,r){var o=this,n={},t=this.getOlCls(e);return t&&r instanceof Object?(Object.keys(r).forEach(function(e){var t=o.getOlKey(e);n[t]=o.parseStyle(e,r[e])}),new t(n)):r},io.prototype.getOlKey=function(e){var t;switch(e.toLowerCase()){case"circle":case"regularshape":case"icon":t="image"}return t||e},io.prototype.getOlCls=function(e){var t=we[e.charAt(0).toUpperCase()+e.slice(1)];return"regularshape"===e&&(t=we.RegularShape),"backgroundFill"===e&&(t=we.Fill),"backgroundStroke"===e&&(t=we.Stroke),t},io.prototype.createStyleByAttribute=function(e,t){var r=t.type,o=t.attribute,n=t.data,i=t.stroke,a=t.width,s=t.fill,l=t.radius,u=t.icon,c=t.scale,p=n.length,d=t.label.attribute||t.label,h=this.parseStyle("text",t.label.style)||new we.Text;h.setText(this.getLabel(e,d));var g=t.baseStyle;if("circle"===r){for(var f=0;f<p;f++)if((m=void 0!==e.get(o)?e.get(o):"")===n[f]||m.toString().match(n[f]))return u?[new we.Style({image:new we.Icon({src:u[f],scale:c?c[f]:1})})]:[new we.Style({image:new we.Circle({radius:l?l[f]:4,stroke:new we.Stroke({color:i?i[f]:"black",width:a?a[f]:1}),fill:new we.Fill({color:s?s[f]:"black"})}),text:h})];if(!e.getStyle())return[new we.Style({image:new we.Circle({radius:4,stroke:new we.Stroke({color:"black"}),fill:new we.Fill({color:"#bbbbf2"})})})]}else if("regular"===r){for(f=0;f<p;f++){var m;if((m=void 0!==e.get(o)?e.get(o):"")===n[f]||m.toString().match(n[f]))return[new we.Style({stroke:new we.Stroke({color:i?i[f]:"black",width:a?a[f]:1}),fill:new we.Fill({color:s?s[f]:"rgba(255,255,255,0.4)"}),text:h})]}if(e instanceof be&&!e.getStyle())return g?this.createStyle(g):[new we.Style({stroke:new we.Stroke({color:"black"}),fill:new we.Fill({color:"#bbbbf2"})})]}},io.prototype.createClusterStyle=function(e,t,r){var o,n,i;void 0===t&&(t={});var a=e.get("features").length;if(1!==a){if(t.clusterRanges)try{for(var s=Qe(t.clusterRanges),l=s.next();!l.done;l=s.next()){var u=l.value;if((!u.minRadius||u.minRadius<=a)&&(!u.maxRadius||u.maxRadius>=a)){if(i=this.createStyle(u.style),u.showRange){var c=new we.Text({text:a.toString(),fill:new we.Fill({color:"#fff"})});i.setText(c)}if(u.dynamicRadius){var p=void 0,d=i.image_.getRadius();(p=5*Math.log(a))<d&&(p=d),i.image_.setRadius(p)}break}}}catch(h){o={error:h}}finally{try{l&&!l.done&&(n=s["return"])&&n.call(s)}finally{if(o)throw o.error}}i||(p=void 0,t.radiusCalc?p=t.radiusCalc(a):(d=6,(p=5*Math.log(a))<d&&(p=d)),i=[new we.Style({image:new we.Circle({radius:p,opacity:.4,stroke:new we.Stroke({color:"black"}),fill:new we.Fill({color:"rgba(24, 134, 45, 0.5)"})}),text:new we.Text({text:a.toString(),fill:new we.Fill({color:"#fff"})})})])}else i=this.createStyle(r);return i},io.prototype.getLabel=function(t,e){var r=e,o=Array.from(e.matchAll(/\$\{([^\{\}]+)\}/g));return o.forEach(function(e){r=r.replace(e[0],t.get(e[1]))}),0===o.length&&r===e&&(r=t.get(e)||e),r},io.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],io.ngInjectableDef=je.defineInjectable({factory:function(){return new io},token:io,providedIn:"root"}),io);function io(){}function ao(e){return!0===e.dataSource.options.queryable}function so(e){var t=e.get("_layer");return t!==undefined&&ao(t)}var lo=(Object.defineProperty(uo.prototype,"activeLayer",{get:function(){return this._activeLayer},set:function(e){e&&this.layer&&e.id===this.layer.id&&!this.selectionMode?(this.layerTool$.next(!0),this.renderer.addClass(this.elRef.nativeElement,this.focusedCls)):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls)},enumerable:!0,configurable:!0}),Object.defineProperty(uo.prototype,"selectAll",{get:function(){return this._selectAll},set:function(e){!0===(this._selectAll=e)&&(this.layerCheck=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(uo.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e,this.layers$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(uo.prototype,"removable",{get:function(){return!1!==this.layer.options.removable},enumerable:!0,configurable:!0}),Object.defineProperty(uo.prototype,"opacity",{get:function(){return 100*this.layer.opacity},set:function(e){this.layer.opacity=e/100},enumerable:!0,configurable:!0}),uo.prototype.ngOnInit=function(){var t=this;this.layer.visible&&this.expandLegendIfVisible&&!0===this.layer.firstLoadComponent&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge();var e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(function(){t.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.networkService.currentState().subscribe(function(e){t.state=e,t.onResolutionChange()}),this.layers$.subscribe(function(){t.layer&&t.layer.options.active&&(t.layerTool$.next(!0),t.renderer.addClass(t.elRef.nativeElement,t.focusedCls))})},uo.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},uo.prototype.toggleLegend=function(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)},uo.prototype.toggleLegendOnClick=function(){this.toggleLegend(this.showLegend$.value)},uo.prototype.toggleVisibility=function(){this.layer.visible=!this.layer.visible,this.toggleLegendOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge()},uo.prototype.computeTooltip=function(){var e=this.layer.options;if(!e.tooltip)return this.layer.title;var t=e.tooltip,r=e.metadata;switch(e.tooltip.type){case Cr.TITLE:return this.layer.title;case Cr.ABSTRACT:return r&&r["abstract"]?r["abstract"]:this.layer.title;case Cr.CUSTOM:return t&&t.text?t.text:this.layer.title;default:return this.layer.title}},uo.prototype.onResolutionChange=function(){var e=this.layer.isInResolutionsRange;!1===e&&!0===this.updateLegendOnResolutionChange&&this.toggleLegend(!0),this.inResolutionRange$.next(e)},uo.prototype.updateQueryBadge=function(){var e=!1===this.queryBadge||!1===this.layer.visible||!ao(this.layer);this.queryBadgeHidden$.next(e)},uo.prototype.toggleLayerTool=function(){this.layerTool$.next(!this.layerTool$.getValue()),!0===this.layerTool$.getValue()?this.renderer.addClass(this.elRef.nativeElement,this.focusedCls):this.renderer.removeClass(this.elRef.nativeElement,this.focusedCls),this.action.emit(this.layer)},uo.prototype.check=function(){this.layerCheck=!this.layerCheck,this.checkbox.emit({layer:this.layer,check:this.layerCheck})},uo.decorators=[{type:je.Component,args:[{selector:"igo-layer-item",template:'<mat-list-item class= "igo-layer-list-item">\r\n  <mat-checkbox *ngIf="selectionMode"\r\n    class="layerCheck"\r\n    mat-list-icon\r\n    (change)="check()"\r\n    [checked]="layerCheck">\r\n  </mat-checkbox>\r\n  <h4 (click)="toggleLegendOnClick()" matLine class="igo-layer-title" [matTooltip]="tooltipText" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n\r\n  <button *ngIf="!selectionMode"\r\n    mat-icon-button\r\n    [color]="layer.visible ? \'primary\' : \'default\'"\r\n    collapsibleButton\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="layer.visible ?\r\n                  (\'igo.geo.layer.hideLayer\' | translate) :\r\n                  (\'igo.geo.layer.showLayer\' | translate)"\r\n    (click)="toggleVisibility()">\r\n    <mat-icon\r\n      matBadge="?"\r\n      matBadgeColor="accent"\r\n      matBadgeSize="small"\r\n      matBadgePosition="after"\r\n      [matBadgeHidden]="queryBadgeHidden$ | async"\r\n      [ngClass]="{disabled: !(inResolutionRange$ | async)}"\r\n      [svgIcon]="layer.visible ? \'eye\' : \'eye-off\'">\r\n    </mat-icon>\r\n  </button>\r\n\r\n  <button *ngIf="selectionMode" class="selection-eye"\r\n  mat-icon-button\r\n  [color]="layer.visible ? \'primary\' : \'default\'"\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="layer.visible ?\r\n                (\'igo.geo.layer.hideLayer\' | translate) :\r\n                (\'igo.geo.layer.showLayer\' | translate)"\r\n  (click)="toggleVisibility()">\r\n  <mat-icon\r\n    matBadge="?"\r\n    matBadgeColor="accent"\r\n    matBadgeSize="small"\r\n    matBadgePosition="after"\r\n    [matBadgeHidden]="queryBadgeHidden$ | async"\r\n    [ngClass]="{disabled: !(inResolutionRange$ | async)}"\r\n    [svgIcon]="layer.visible ? \'eye\' : \'eye-off\'">\r\n  </mat-icon>\r\n</button>\r\n\r\n  <button *ngIf="!selectionMode"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]= "\'igo.geo.layer.moreOptions\' | translate"\r\n    mat-icon-button\r\n    color="primary"\r\n    (click)="toggleLayerTool()">\r\n    <mat-icon svgIcon="dots-horizontal"></mat-icon>\r\n  </button>\r\n</mat-list-item>\r\n\r\n<div #legend class="igo-layer-legend-container">\r\n  <igo-layer-legend\r\n    *ngIf="showLegend$ | async"\r\n    [layer]="layer"\r\n    [updateLegendOnResolutionChange]="updateLegendOnResolutionChange">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host{overflow:hidden}mat-list-item ::ng-deep .mat-list-item-content .layerCheck{align-self:baseline;width:16px;padding-right:0}.igo-layer-list-item{height:46px;clear:both}.igo-layer-title{cursor:pointer}.igo-layer-legend-container{padding-left:18px;width:calc(100% - 18px)}mat-icon.disabled{color:rgba(0,0,0,.38)}.mat-badge-small .mat-badge-content{font-size:12px}.selection-eye{padding-right:45px}"]}]}],uo.ctorParameters=function(){return[{type:Ae.NetworkService},{type:je.Renderer2},{type:je.ElementRef}]},uo.propDecorators={activeLayer:[{type:je.Input}],selectAll:[{type:je.Input}],layerCheck:[{type:je.Input}],layer:[{type:je.Input}],toggleLegendOnVisibilityChange:[{type:je.Input}],expandLegendIfVisible:[{type:je.Input}],updateLegendOnResolutionChange:[{type:je.Input}],orderable:[{type:je.Input}],lowerDisabled:[{type:je.Input}],raiseDisabled:[{type:je.Input}],queryBadge:[{type:je.Input}],selectionMode:[{type:je.Input}],action:[{type:je.Output}],checkbox:[{type:je.Output}]},uo);function uo(e,t,r){this.networkService=e,this.renderer=t,this.elRef=r,this.focusedCls="igo-layer-item-focused",this.layerTool$=new Le.BehaviorSubject(!1),this.showLegend$=new Le.BehaviorSubject(!0),this.inResolutionRange$=new Le.BehaviorSubject(!0),this.queryBadgeHidden$=new Le.BehaviorSubject(!0),this._selectAll=!1,this.layers$=new Le.BehaviorSubject(undefined),this.toggleLegendOnVisibilityChange=!1,this.expandLegendIfVisible=!1,this.updateLegendOnResolutionChange=!1,this.orderable=!0,this.lowerDisabled=!1,this.raiseDisabled=!1,this.queryBadge=!1,this.action=new je.EventEmitter(undefined),this.checkbox=new je.EventEmitter}var co=(po.prototype.ngOnInit=function(){var t=this,e=this.layer.legend;this.styles=this.listStyles();var r=this.layer.options.source.options;if(r&&r.params&&r.params.STYLES?this.currentStyle=this.styles.find(function(e){return e.name===r.params.STYLES}).name:this.layer.legend?this.styles&&1<this.styles.length&&(this.currentStyle=e[0].currentStyle):this.styles&&1<this.styles.length&&(this.currentStyle=this.styles[0].name),e=this.layer.dataSource.getLegend(this.currentStyle,this.scale),!0===this.updateLegendOnResolutionChange){var o=this.layer.map.viewController.resolution$;this.resolution$$=o.subscribe(function(e){return t.onResolutionChange(e)})}else 0!==e.length&&this.legendItems$.next(e)},po.prototype.ngOnDestroy=function(){this.resolution$$!==undefined&&this.resolution$$.unsubscribe()},po.prototype.toggleLegendItem=function(e,t){t.collapsed=e},po.prototype.transfertToggleLegendItem=function(e){for(var t=e,r=this.layer.legend,o=0;o<r.length;o++)t[o].collapsed=r[o].collapsed;return t},po.prototype.computeItemTitle=function(t){var e=this.layer.dataSource.options;if("wms"!==e.type)return Le.of(t.title);var r=e.params.LAYERS.split(","),o=JSON.parse(JSON.stringify(e));return o.params.LAYERS=r.find(function(e){return e===t.title}),this.capabilitiesService.getWMSOptions(o).pipe(Pe.map(function(e){return e._layerOptionsFromSource.title}))},po.prototype.onResolutionChange=function(e){this.scale=this.layer.map.viewController.getScale(),this.updateLegend()},po.prototype.updateLegend=function(){var e=this.layer.dataSource.getLegend(this.currentStyle,this.scale);this.layer.legend&&1<this.layer.legend.length&&(e=this.transfertToggleLegendItem(e)),0===(this.layer.legend=e).length&&0===this.legendItems$.value.length||this.legendItems$.next(e)},po.prototype.listStyles=function(){var e=this.layer.options;if(e&&e.legendOptions){var t=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}].concat(e.legendOptions.stylesAvailable.filter(function(e){return"default"!==e.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")&&"defaut"!==e.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")}));return t.map(function(e){return e.title=e.title.charAt(0).toUpperCase()+e.title.slice(1).replace(/_/g," ")}),t}},po.prototype.onChangeStyle=function(){var t=this;this.updateLegend();var r="";this.layer.dataSource.ol.getParams().LAYERS.split(",").map(function(e){return r+=t.currentStyle+","}),r=r.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:r})},po.prototype.onLoadImage=function(t){var e;e=1===this.renderedLegends.length?this.renderedLegends.first.nativeElement:this.renderedLegends.find(function(e){return e.nativeElement.id===t}).nativeElement,this.imagesHeight[t]=e.height},po.decorators=[{type:je.Component,args:[{selector:"igo-layer-legend",template:'<ng-container *ngIf="legendItems$ | async as items">\r\n  <ng-container *ngIf="items.length; else noItems">\r\n    <ng-container *ngFor="let item of items.slice().reverse()" #renderedLegends >\r\n      <mat-list-item *ngIf="item.title">\r\n        <mat-icon\r\n          id="legend-toggle"\r\n          class="igo-chevron"\r\n          mat-list-avatar\r\n          igoCollapse\r\n          [target]="legend"\r\n          [collapsed]="(item.collapsed)"\r\n          (toggle)="toggleLegendItem($event, item)"\r\n          svgIcon="chevron-up">\r\n        </mat-icon>\r\n        <h4 matLine>{{computeItemTitle(item) | async}} </h4>\r\n      </mat-list-item>  \r\n      <div #legend class="igo-layer-legend" [ngClass]="{\'with-title\': item.title}">\r\n        <div *ngIf="currentStyle !== undefined">\r\n            <mat-form-field>\r\n              <mat-select tooltip-position="below" matTooltipShowDelay="500"\r\n                [matTooltip]="\'igo.geo.layer.legend.selectStyle\' | translate" [(ngModel)]="currentStyle"\r\n                (selectionChange)="onChangeStyle()">\r\n                <mat-option *ngFor="let style of styles" [value]="style.name">{{style.title}}</mat-option>\r\n              </mat-select>\r\n          </mat-form-field>\r\n        </div>\r\n        <div *ngIf="!(item.collapsed)">\r\n          <div *ngIf="item.url">\r\n            <img #renderedLegend id="{{item.title}}" (load)="onLoadImage(item.title)"\r\n              src="{{(item.url | secureImage) | async}}"\r\n              alt="{{\'igo.geo.layer.legend.loadingLegendText\' | translate}}"\r\n            >\r\n            <small *ngIf="imagesHeight[item.title]<16">\r\n                {{\'igo.geo.layer.legend.noLegendScale\' | translate}}\r\n            </small>\r\n          </div>\r\n          <div\r\n            [ngStyle]="item.style"\r\n            [innerHTML]="item.html"\r\n            *ngIf="item.html">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ng-container>\r\n  </ng-container>\r\n\r\n  <ng-template #noItems>\r\n    <small>\r\n      {{\'igo.geo.layer.legend.noLegendText\' | translate}}\r\n    </small>\r\n  </ng-template>\r\n\r\n</ng-container>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".igo-layer-legend.with-title{padding-left:18px}img:after{content:' ';position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;-webkit-animation:2s linear infinite spin;animation:2s linear infinite spin}@-moz-document url-prefix(){img:after{margin-left:19px}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}"]}]}],po.ctorParameters=function(){return[{type:zn},{type:Ae.LanguageService}]},po.propDecorators={updateLegendOnResolutionChange:[{type:je.Input}],renderedLegends:[{type:je.ViewChildren,args:["renderedLegend"]}],layer:[{type:je.Input}]},po);function po(e,t){this.capabilitiesService=e,this.languageService=t,this.updateLegendOnResolutionChange=!1,this.legendItems$=new Le.BehaviorSubject([]),this.scale=undefined,this.imagesHeight={}}var ho=(go.prototype.ngOnInit=function(){var t=this;this.layer.legendCollapsed=!0;var e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(function(){t.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.networkService.currentState().subscribe(function(e){t.state=e,t.onResolutionChange()})},go.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},go.prototype.computeTooltip=function(){var e=this.layer.options;if(!e.tooltip)return this.layer.title;var t=e.tooltip,r=e.metadata;switch(e.tooltip.type){case Cr.TITLE:return this.layer.title;case Cr.ABSTRACT:return r&&r["abstract"]?r["abstract"]:this.layer.title;case Cr.CUSTOM:return t&&t.text?t.text:this.layer.title;default:return this.layer.title}},go.prototype.onResolutionChange=function(){var e=this.layer.isInResolutionsRange;this.inResolutionRange$.next(e)},go.decorators=[{type:je.Component,args:[{selector:"igo-layer-legend-item",template:'<mat-list-item class= "igo-layer-list-item">\r\n  <h4 matLine class="igo-layer-title" [matTooltip]="tooltipText" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n</mat-list-item>\r\n\r\n<div #legend class="igo-layer-legend-container">\r\n  <igo-layer-legend\r\n    [layer]="layer"\r\n    [updateLegendOnResolutionChange]="updateLegendOnResolutionChange">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host{overflow:hidden}.igo-layer-list-item{height:46px;clear:both}.igo-layer-actions-container{width:100%;display:inline-block;padding-left:10px}.igo-layer-actions-container>div{text-align:center}.igo-layer-legend-container{padding-left:18px;width:calc(100% - 18px)}#opacity-slider{float:left}.igo-layer-button-group{text-align:right;padding:0 10px 0 0;width:100%}mat-icon.disabled{color:rgba(0,0,0,.38)}.mat-badge-small .mat-badge-content{font-size:12px}"]}]}],go.ctorParameters=function(){return[{type:Ae.NetworkService}]},go.propDecorators={layer:[{type:je.Input}],updateLegendOnResolutionChange:[{type:je.Input}]},go);function go(e){this.networkService=e,this.inResolutionRange$=new Le.BehaviorSubject(!0),this.updateLegendOnResolutionChange=!1}var fo=(Object.defineProperty(mo.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.next()},enumerable:!0,configurable:!0}),mo.prototype.ngOnInit=function(){var t=this;this.change$$=this.change$.pipe(Pe.debounce(function(){return 0===t.layers.length?Le.EMPTY:Le.timer(50)})).subscribe(function(){var e=t.computeShownLayers(t.layers.slice(0));t.layers$.next(e),t.hasVisibleOrInRangeLayers$.next(0<t.layers.slice(0).filter(function(e){return!0!==e.baseLayer}).filter(function(e){return e.visible$.value&&e.isInResolutionsRange$.value}).length),t.hasVisibleAndNotInRangeLayers$.next(0<t.layers.slice(0).filter(function(e){return!0!==e.baseLayer}).filter(function(e){return e.visible$.value&&!e.isInResolutionsRange$.value}).length),t.layersInUi$.next(t.layers.slice(0).filter(function(e){return!(!1===e.showInLayerList||t.excludeBaseLayers&&e.baseLayer)}))})},mo.prototype.ngOnDestroy=function(){this.change$$.unsubscribe()},mo.prototype.next=function(){this.change$.next()},mo.prototype.computeShownLayers=function(e){var t=e.filter(function(e){return e.visible&&e.isInResolutionsRange});return this.showAllLegendsValue&&(t=e),this.sortLayersByZindex(t)},mo.prototype.sortLayersByZindex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},mo.prototype.toggleShowAllLegends=function(e){this.showAllLegendsValue=e,this.next(),this.allLegendsShown.emit(e)},mo.decorators=[{type:je.Component,args:[{selector:"igo-layer-legend-list",template:'\r\n<mat-slide-toggle \r\ntooltip-position="above"\r\nmatTooltipShowDelay="500"\r\n[matTooltip]="\'igo.geo.layer.legend.showAll\' | translate"\r\n[checked]="showAllLegendsValue" class="mat-typography" \r\n*ngIf="(layersInUi$ | async).length && allowShowAllLegends" [labelPosition]="\'before\'" (change)="toggleShowAllLegends($event.checked)">\r\n  {{\'igo.geo.layer.legend.showAll\' | translate}}\r\n</mat-slide-toggle>\r\n<mat-divider *ngIf="(layersInUi$ | async).length && allowShowAllLegends"></mat-divider>\r\n<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer let-i="index" [ngForOf]="layers$ | async">\r\n    <igo-layer-legend-item *ngIf="!(excludeBaseLayers && layer.baseLayer)"\r\n        igoListItem [layer]="layer"\r\n        [updateLegendOnResolutionChange]="updateLegendOnResolutionChange">\r\n    </igo-layer-legend-item>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<p class="layers-empty mat-typography" \r\n  *ngIf="(layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && !(hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends">\r\n  {{\'igo.geo.layer.legend.noLayersVisibleWithShowAllButton\' | translate}} \r\n</p>\r\n<p class="layers-empty mat-typography" \r\n  *ngIf="(layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends">\r\n  {{\'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom\' | translate}} \r\n</p>\r\n<p class="layers-empty mat-typography"\r\n  *ngIf="(layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && !(hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends">\r\n  {{\'igo.geo.layer.legend.noLayersVisible\' | translate}} \r\n</p>\r\n<p class="layers-empty mat-typography"\r\n  *ngIf="(layersInUi$ | async).length && !(hasVisibleOrInRangeLayers$ | async) && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends">\r\n  {{\'igo.geo.layer.legend.noLayersVisibleButZoom\' | translate}} \r\n</p>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:["mat-slide-toggle{width:100%;margin:10px}mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px)}igo-list{display:contents}.layers-empty{text-align:justify;margin:10px}"]}]}],mo.ctorParameters=function(){return[]},mo.propDecorators={layers:[{type:je.Input}],excludeBaseLayers:[{type:je.Input}],updateLegendOnResolutionChange:[{type:je.Input}],allowShowAllLegends:[{type:je.Input}],showAllLegendsValue:[{type:je.Input}],allLegendsShown:[{type:je.Output}]},mo);function mo(){this.orderable=!0,this.hasVisibleOrInRangeLayers$=new Le.BehaviorSubject(!0),this.hasVisibleAndNotInRangeLayers$=new Le.BehaviorSubject(!0),this.layersInUi$=new Le.BehaviorSubject([]),this.layers$=new Le.BehaviorSubject([]),this.showAllLegend=!1,this.change$=new Le.ReplaySubject(1),this.excludeBaseLayers=!1,this.updateLegendOnResolutionChange=!1,this.allowShowAllLegends=!1,this.showAllLegendsValue=!1,this.allLegendsShown=new je.EventEmitter(!1)}var yo={always:"always",never:"never","default":"default"},vo=(Object.defineProperty(bo.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"activeLayer",{get:function(){return this._activeLayer},set:function(e){this._activeLayer=e,this.activeLayer$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"keyword",{get:function(){return this._keyword},set:function(e){this._keyword=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"onlyVisible",{get:function(){return this._onlyVisible},set:function(e){this._onlyVisible=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"sortAlpha",{get:function(){return this._sortedAlpha},set:function(e){this._sortedAlpha=e,this.next()},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"opacity",{get:function(){return Math.round(100*this.activeLayer$.getValue().opacity)},set:function(e){this.activeLayer$.getValue().opacity=e/100},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"badgeOpacity",{get:function(){if(100!==this.opacity)return this.opacity},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"raiseDisabled",{get:function(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getUpperLayer().id!==this.activeLayer.id&&!this.isUpperBaselayer(this.activeLayer))},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"lowerDisabled",{get:function(){return!(this.orderable&&!this.activeLayer.baseLayer&&this.getLowerLayer().id!==this.activeLayer.id&&!this.isLowerBaselayer(this.activeLayer))},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"raiseDisabledSelection",{get:function(){return 0===this.layersChecked.length||!this.orderable||!this.raisableLayers(this.layersChecked)||!0===this.selectAllCheck},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"lowerDisabledSelection",{get:function(){return 0===this.layersChecked.length||!this.orderable||!this.lowerableLayers(this.layersChecked)||!0===this.selectAllCheck},enumerable:!0,configurable:!0}),Object.defineProperty(bo.prototype,"checkOpacity",{get:function(){return 100*this.layersCheckedOpacity()},set:function(e){var t,r;try{for(var o=Qe(this.layersChecked),n=o.next();!n.done;n=o.next())n.value.opacity=e/100}catch(i){t={error:i}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}},enumerable:!0,configurable:!0}),bo.prototype.ngOnInit=function(){var s=this;this.change$$=this.change$.pipe(Pe.debounce(function(){return 0===s.layers.length?Le.EMPTY:Le.timer(50)})).subscribe(function(){s.showToolbar$.next(s.computeShowToolbar()),s.layers$.next(s.computeLayers(s.layers.slice(0))),s.appliedFilterAndSort.emit({keyword:s.keyword,sortAlpha:s.sortAlpha,onlyVisible:s.onlyVisible})}),this.selectAllCheck$$=this.selectAllCheck$.subscribe(function(e){s.selectAllCheck=e}),this.layers$.subscribe(function(){var e,t;if(s.layers){var r=0;try{for(var o=Qe(s.layers),n=o.next();!n.done;n=o.next()){var i=n.value;i.options.active&&(s.activeLayer=i,s.layerTool=!0),i.options.check&&(r+=1)}}catch(a){e={error:a}}finally{try{n&&!n.done&&(t=o["return"])&&t.call(o)}finally{if(e)throw e.error}}s.excludeBaseLayers?s.selectAllCheck=r===s.layers.filter(function(e){return!0!==e.baseLayer&&e.showInLayerList}).length:s.selectAllCheck=r===s.layers.filter(function(e){return e.showInLayerList}).length}})},bo.prototype.ngOnDestroy=function(){this.change$$.unsubscribe()},bo.prototype.clearKeyword=function(){this.keyword=undefined},bo.prototype.getLowerLayer=function(){return this.layers.filter(function(e){return!e.baseLayer}).reduce(function(e,t){return e.zIndex<t.zIndex?e:t},{zIndex:undefined,id:undefined})},bo.prototype.isLowerBaselayer=function(t){var e=this.layers.findIndex(function(e){return t.id===e.id});return!(!this.layers||!this.layers[e+1]||!0!==this.layers[e+1].baseLayer)},bo.prototype.getUpperLayer=function(){return this.layers.filter(function(e){return!e.baseLayer}).reduce(function(e,t){return e.zIndex>t.zIndex?e:t},{zIndex:undefined,id:undefined})},bo.prototype.isUpperBaselayer=function(t){var e=this.layers.findIndex(function(e){return t.id===e.id});return!(!this.layers||!this.layers[e-1]||!0!==this.layers[e-1].baseLayer)},bo.prototype.raisableLayers=function(n){var e,t,i=!1,a=0,r=function(t){var e=s.layers.findIndex(function(e){return t.id===e.id}),r=s.layers[e];r.baseLayer&&(a+=1);var o=s.layers[e-1];o&&!0!==o.baseLayer&&!n.find(function(e){return o.id===e.id})&&!0!==r.baseLayer&&(i=!0)},s=this;try{for(var o=Qe(n),l=o.next();!l.done;l=o.next())r(l.value)}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=o["return"])&&t.call(o)}finally{if(e)throw e.error}}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||a===this.layersChecked.length)&&(i=!1),i},bo.prototype.raisableLayer=function(e){return!(e<1)&&(!this.layers[e-1].options.check||this.raisableLayer(e-1))},bo.prototype.raiseLayers=function(e){var t,r,o=this,n=[],i=function(t){var e=a.layers.findIndex(function(e){return e.id===t.id});a.raisableLayer(e)&&n.push(t)},a=this;try{for(var s=Qe(e),l=s.next();!l.done;l=s.next())i(l.value)}catch(u){t={error:u}}finally{try{l&&!l.done&&(r=s["return"])&&r.call(s)}finally{if(t)throw t.error}}this.map.raiseLayers(n),setTimeout(function(){var e=o.computeElementRef();o.isScrolledIntoView(e[0],e[1].offsetParent)||(e[0].scrollTop=e[1].offsetParent.offsetTop)},100)},bo.prototype.lowerableLayers=function(o){var e,t,n=!1,i=0,r=function(t){var e=a.layers.findIndex(function(e){return t.id===e.id});a.layers[e].baseLayer&&(i+=1);var r=a.layers[e+1];r&&!0!==r.baseLayer&&!o.find(function(e){return r.id===e.id})&&(n=!0)},a=this;try{for(var s=Qe(o),l=s.next();!l.done;l=s.next())r(l.value)}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}return(1===this.layersChecked.length&&this.layersChecked[0].baseLayer||i===this.layersChecked.length)&&(n=!1),n},bo.prototype.lowerableLayer=function(e){return!(e>this.layers.filter(function(e){return!0!==e.baseLayer}).length-2)&&(!this.layers[e+1].options.check||this.lowerableLayer(e+1))},bo.prototype.lowerLayers=function(e){var t,r,o=this,n=[],i=function(t){var e=a.layers.findIndex(function(e){return e.id===t.id});a.lowerableLayer(e)&&n.push(t)},a=this;try{for(var s=Qe(e),l=s.next();!l.done;l=s.next())i(l.value)}catch(u){t={error:u}}finally{try{l&&!l.done&&(r=s["return"])&&r.call(s)}finally{if(t)throw t.error}}this.map.lowerLayers(n),setTimeout(function(){var e=o.computeElementRef("lower");o.isScrolledIntoView(e[0],e[1].offsetParent)||(e[0].scrollTop=e[1].offsetParent.offsetTop+e[1].offsetParent.offsetHeight-e[0].clientHeight)},100)},bo.prototype.next=function(){this.change$.next()},bo.prototype.computeLayers=function(e){var t=this.filterLayers(e);return t=this.sortAlpha?this.sortLayersByTitle(t):this.sortLayersByZindex(t)},bo.prototype.onKeywordChange=function(e){this.keyword=e},bo.prototype.onAppliedFilterAndSortChange=function(e){this.keyword=e.keyword,this.onlyVisible=e.onlyVisible,this.sortAlpha=e.sortAlpha},bo.prototype.filterLayers=function(e){var c=this;if(this.layerFilterAndSortOptions.showToolbar===yo.never)return e;if(!this.keyword&&!this.onlyVisible)return e;var p=e.map(function(e){return e.id});return e.forEach(function(e){var t=e.options||{},r=e.dataSource.options||{},o=((t.metadata||{}).keywordList||[]).map(function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")});if(c.keyword&&e.title){var n,i=c.keyword.normalize("NFD").replace(/[\u0300-\u036f]/g,""),a=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=r.type||"",l=new RegExp(i,"gi"),u=o.find(function(e){return l.test(e)})!==undefined;l.test(a)||c.keyword.toLowerCase()===s.toLowerCase()||u||-1<(n=p.indexOf(e.id))&&p.splice(n,1)}c.onlyVisible&&!1===e.visible&&-1<(n=p.indexOf(e.id))&&p.splice(n,1)}),e.filter(function(e){return-1!==p.indexOf(e.id)})},bo.prototype.sortLayersByZindex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},bo.prototype.sortLayersByTitle=function(e){var r=this;return e.sort(function(e,t){return r.normalize(e.title)<r.normalize(t.title)?-1:r.normalize(e.title)>r.normalize(t.title)?1:0})},bo.prototype.normalize=function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()},bo.prototype.computeShowToolbar=function(){switch(this.layerFilterAndSortOptions.showToolbar){case yo.always:return!0;case yo.never:return!1;default:return!!(this.layers.length>=this.thresholdToFilterAndSort||this.keyword||this.onlyVisible)}},bo.prototype.toggleLayerTool=function(e){var t,r;this.toggleOpacity=!1,this.layerTool&&e===this.activeLayer?this.layerTool=!1:this.layerTool=!0;try{for(var o=Qe(this.layers),n=o.next();!n.done;n=o.next())n.value.options.active=!1}catch(i){t={error:i}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}e.options.active=!0,this.activeLayer=e},bo.prototype.removeLayers=function(e){var t,r;if(e&&0<e.length){try{for(var o=Qe(e),n=o.next();!n.done;n=o.next()){var i=n.value;i.map.removeLayer(i)}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}this.layersChecked=[]}else e||(this.activeLayer.map.removeLayer(this.activeLayer),this.layerTool=!1)},bo.prototype.layersCheck=function(r){var e,t;if(r.layer.options.check=r.check,!0===r.check){var o=this.layers.findIndex(function(e){return r.layer.id===e.id}),n=function(t){var e=i.layers.findIndex(function(e){return t.id===e.id});if(o<e)return i.layersChecked.splice(i.layersChecked.findIndex(function(e){return t.id===e.id}),0,r.layer),i.excludeBaseLayers?i.layersChecked.length===i.layers.filter(function(e){return!0!==e.baseLayer&&e.showInLayerList}).length?i.selectAllCheck=!0:i.selectAllCheck=!1:i.excludeBaseLayers||(i.layersChecked.length===i.layers.filter(function(e){return e.showInLayerList}).length?i.selectAllCheck=!0:i.selectAllCheck=!1),{value:void 0}},i=this;try{for(var a=Qe(this.layersChecked),s=a.next();!s.done;s=a.next()){var l=n(s.value);if("object"==typeof l)return l.value}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}this.layersChecked.push(r.layer)}else{var u=this.layersChecked.findIndex(function(e){return r.layer.id===e.id});this.layersChecked.splice(u,1)}this.excludeBaseLayers?this.layersChecked.length===this.layers.filter(function(e){return!0!==e.baseLayer&&e.showInLayerList}).length?this.selectAllCheck=!0:this.selectAllCheck=!1:this.excludeBaseLayers||(this.layersChecked.length===this.layers.filter(function(e){return e.showInLayerList}).length?this.selectAllCheck=!0:this.selectAllCheck=!1)},bo.prototype.toggleSelectionMode=function(e){var t,r;if(this.selection=e,this.activeLayer=undefined,!0===e){this.layerTool=!1;try{for(var o=Qe(this.layers),n=o.next();!n.done;n=o.next()){var i=n.value;i.options.check&&this.layersChecked.push(i)}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}}},bo.prototype.layersCheckedOpacity=function(){var e,t;if(1<this.layersChecked.length)return 1;var r=[];try{for(var o=Qe(this.layersChecked),n=o.next();!n.done;n=o.next()){var i=n.value;r.push(i.opacity)}}catch(a){e={error:a}}finally{try{n&&!n.done&&(t=o["return"])&&t.call(o)}finally{if(e)throw e.error}}return r},bo.prototype.selectAll=function(){var e,t,r,o;if(this.selectAllCheck){try{for(var n=Qe(this.layers),i=n.next();!i.done;i=n.next())(l=i.value).options.check=!1}catch(u){r={error:u}}finally{try{i&&!i.done&&(o=n["return"])&&o.call(n)}finally{if(r)throw r.error}}this.layersChecked=[],this.selectAllCheck$.next(!1)}else{try{for(var a=Qe(this.layers),s=a.next();!s.done;s=a.next()){var l=s.value;this.excludeBaseLayers&&!0!==l.baseLayer&&l.showInLayerList?(l.options.check=!0,this.layersChecked.push(l)):!this.excludeBaseLayers&&l.showInLayerList&&(l.options.check=!0,this.layersChecked.push(l))}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=a["return"])&&t.call(a)}finally{if(e)throw e.error}}this.selectAllCheck$.next(!0)}},bo.prototype.isScrolledIntoView=function(e,t){var r=e.scrollTop,o=r+e.clientHeight,n=t.offsetTop;return n+t.clientHeight<=o&&r<=n},bo.prototype.computeElementRef=function(e){var t=this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked"),r="lower"===e?this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked")[t.length-1]:this.elRef.nativeElement.getElementsByClassName("mat-checkbox-checked")[0];return[this.elRef.nativeElement.getElementsByTagName("igo-list")[0],r]},bo.decorators=[{type:je.Component,args:[{selector:"igo-layer-list",template:'<igo-list #igoList [ngClass]="(layerTool || selection) ? \'igo-list-min-height\': \'igo-list-max-height\'" [navigation]="false" [selection]="false">\r\n  <igo-layer-list-tool *ngIf="showToolbar$ | async"\r\n      floatLabel="auto"\r\n      [layersAreAllVisible]="layersAreAllVisible"\r\n      [term]="layerFilterAndSortOptions.keyword"\r\n      [onlyVisible]="layerFilterAndSortOptions.onlyVisible"\r\n      [sortAlpha]="layerFilterAndSortOptions.sortAlpha"\r\n      (appliedFilterAndSort)="onAppliedFilterAndSortChange($event)"\r\n      (selection)="toggleSelectionMode($event)">\r\n    </igo-layer-list-tool>\r\n\r\n  <ng-template ngFor let-layer let-i="index" [ngForOf]="layers$ | async">\r\n    <igo-layer-item *ngIf="!(excludeBaseLayers && layer.baseLayer)"\r\n        igoListItem\r\n        [layer]="layer"\r\n        [activeLayer]="activeLayer"\r\n        [orderable]="orderable && !layer.baseLayer"\r\n        [lowerDisabled]="getLowerLayer().id === layer.id"\r\n        [raiseDisabled]="getUpperLayer().id === layer.id"\r\n        [queryBadge]="queryBadge"\r\n        [expandLegendIfVisible]="expandLegendOfVisibleLayers"\r\n        [updateLegendOnResolutionChange]="updateLegendOnResolutionChange"\r\n        [toggleLegendOnVisibilityChange]="toggleLegendOnVisibilityChange"\r\n        [selectionMode]="selection"\r\n        [selectAll]="selectAllCheck"\r\n        [layerCheck]="layer.options.check"\r\n        (action)="toggleLayerTool($event)"\r\n        (checkbox)="layersCheck($event)">\r\n    </igo-layer-item>\r\n  </ng-template>\r\n</igo-list>\r\n\r\n<igo-panel *ngIf="!selection && layerTool && activeLayer" class="igo-layer-actions-container" [title]="activeLayer.title">\r\n  <div class="igo-layer-button-group">\r\n  <ng-container igoLayerItemToolbar\r\n    [ngTemplateOutlet]="templateLayerToolbar"\r\n    [ngTemplateOutletContext]="{layer: activeLayer}">\r\n  </ng-container>\r\n\r\n  <ng-content select="[igoLayerItemToolbar]"></ng-content>\r\n    \x3c!-- <label>{{ \'igo.geo.layer.opacity\' | translate }} </label> --\x3e\r\n    <button\r\n      color="primary"\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matMenuTriggerFor]="opacityMenu"\r\n      [matTooltip]="\'igo.geo.layer.opacity\' | translate">\r\n      <mat-icon [matBadge]="badgeOpacity" matBadgeColor="primary" matBadgeSize="medium" svgIcon="opacity"></mat-icon>\r\n    </button>\r\n\r\n    <mat-menu #opacityMenu="matMenu" class="mat-menu-opacity-slider">\r\n      <div id="opacity-menu">\r\n        <mat-slider\r\n          id="opacity-slider"\r\n          color="primary"\r\n          thumbLabel\r\n          tickInterval="5"\r\n          step="5"\r\n          [min]="0"\r\n          [max]="100"\r\n          [(ngModel)]="opacity"\r\n          [matTooltip]="\'igo.geo.layer.opacity\' | translate"\r\n          (click) = "$event.stopPropagation()"\r\n          matTooltipShowDelay="500"\r\n          tooltip-position="below">\r\n        </mat-slider>\r\n      </div>\r\n    </mat-menu>\r\n\r\n    <button\r\n      color="primary"\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="(sortAlpha || onlyVisible || keyword) ? (\'igo.geo.layer.filterRaiseLayer\' | translate) : (\'igo.geo.layer.raiseLayer\' | translate)"\r\n      [disabled]="raiseDisabled"\r\n      (click)="activeLayer.map.raiseLayer(activeLayer)">\r\n      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? \'!\' : \'\'" matBadgeColor="warn" matBadgeSize="medium" [matBadgeHidden]="raiseDisabled"\r\n                svgIcon="arrow-up"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      color="primary"\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="(sortAlpha || onlyVisible || keyword) ? (\'igo.geo.layer.filterLowerLayer\' | translate) : (\'igo.geo.layer.lowerLayer\' | translate)"\r\n      [disabled]="lowerDisabled"\r\n      (click)="activeLayer.map.lowerLayer(activeLayer)">\r\n      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? \'!\' : \'\'" matBadgeColor="warn" matBadgeSize="medium" [matBadgeHidden]="lowerDisabled"\r\n                svgIcon="arrow-down"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      color="warn"\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.layer.removeLayer\' | translate"\r\n      (click)="removeLayers()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n  </div>\r\n</igo-panel>\r\n\r\n<igo-panel *ngIf="selection && layers.length > 0" class="igo-layer-actions-container" [title]="\'igo.geo.layer.tools\' | translate">\r\n  <div class="igo-layer-button-group">\r\n\r\n    <button\r\n      mat-stroked-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [disabled]="layers.length === 0"\r\n      [matTooltip]="selectAllCheck ?\r\n                    (\'igo.geo.layer.deselectAll\' | translate) :\r\n                    (\'igo.geo.layer.selectAll\' | translate)"\r\n      (click)="selectAll()">\r\n      {{selectAllCheck ? (\'igo.geo.layer.deselectAll\' | translate) :\r\n                    (\'igo.geo.layer.selectAll\' | translate)}}\r\n    </button>\r\n\r\n    \x3c!-- <label>{{ \'igo.geo.layer.opacity\' | translate }} </label> --\x3e\r\n    <button\r\n      color="primary"\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [disabled]="layersChecked.length === 0"\r\n      [matMenuTriggerFor]="opacityMenu"\r\n      [matTooltip]="\'igo.geo.layer.opacity\' | translate">\r\n      <mat-icon svgIcon="opacity"></mat-icon>\r\n    </button>\r\n\r\n    <mat-menu #opacityMenu="matMenu"  class="mat-menu-opacity-slider">\r\n      <div id="opacity-menu">\r\n        <mat-slider *ngIf="layersChecked.length"\r\n          id="opacity-slider"\r\n          color="primary"\r\n          thumbLabel\r\n          tickInterval="5"\r\n          step="5"\r\n          [min]="0"\r\n          [max]="100"\r\n          [(ngModel)]="checkOpacity"\r\n          [matTooltip]="\'igo.geo.layer.opacity\' | translate"\r\n          matTooltipShowDelay="500"\r\n          tooltip-position="below"\r\n          (click) = "$event.stopPropagation()">\r\n        </mat-slider>\r\n      </div>\r\n    </mat-menu>\r\n\r\n    <button\r\n      color="primary"\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="(sortAlpha || onlyVisible || keyword) ? (\'igo.geo.layer.filterRaiseLayer\' | translate) : (\'igo.geo.layer.raiseLayer\' | translate)"\r\n      [disabled]="raiseDisabledSelection"\r\n      (click)="raiseLayers(layersChecked)">\r\n      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? \'!\' : \'\'" matBadgeColor="warn" matBadgeSize="medium" [matBadgeHidden]="raiseDisabledSelection"\r\n                svgIcon="arrow-up"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      color="primary"\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="(sortAlpha || onlyVisible || keyword) ? (\'igo.geo.layer.filterLowerLayer\' | translate) : (\'igo.geo.layer.lowerLayer\' | translate)"\r\n      [disabled]="lowerDisabledSelection"\r\n      (click)="lowerLayers(layersChecked)">\r\n      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? \'!\' : \'\'" matBadgeColor="warn" matBadgeSize="medium" [matBadgeHidden]="lowerDisabledSelection"\r\n                svgIcon="arrow-down"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      color="warn"\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [disabled]="layersChecked.length === 0"\r\n      [matTooltip]="\'igo.geo.layer.removeLayer\' | translate"\r\n      (click)="removeLayers(layersChecked)">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n  </div>\r\n</igo-panel>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host .igo-list-min-height{height:calc(100% - 91px);padding-top:8px}:host .igo-list-max-height{padding-top:8px}mat-form-field.inputFilter{width:calc(100% - 100px);max-width:200px}.igo-layer-actions-container{width:calc(100% - 5px);padding-left:5px}.igo-layer-actions-container>div{text-align:center}#opacity-slider{float:left;min-width:unset;width:110px;left:10px;top:10px}.igo-layer-button-group{display:-webkit-box;display:flex;float:right;padding-top:5px}:host igo-panel{height:unset}#opacity-menu{max-width:unset;width:132px;height:50px}#opacity-menu .mat-menu-content:not(:empty){padding-top:20px}"]}]}],bo.ctorParameters=function(){return[{type:je.ElementRef}]},bo.propDecorators={templateLayerToolbar:[{type:je.ContentChild,args:["igoLayerItemToolbar"]}],layersAreAllVisible:[{type:je.Input}],ogcButton:[{type:je.Input}],timeButton:[{type:je.Input}],map:[{type:je.Input}],layers:[{type:je.Input}],floatLabel:[{type:je.Input}],layerFilterAndSortOptions:[{type:je.Input}],excludeBaseLayers:[{type:je.Input}],toggleLegendOnVisibilityChange:[{type:je.Input}],expandLegendOfVisibleLayers:[{type:je.Input}],updateLegendOnResolutionChange:[{type:je.Input}],queryBadge:[{type:je.Input}],appliedFilterAndSort:[{type:je.Output}]},bo);function bo(e){this.elRef=e,this.orderable=!0,this.thresholdToFilterAndSort=5,this.layers$=new Le.BehaviorSubject([]),this.change$=new Le.ReplaySubject(1),this.showToolbar$=new Le.BehaviorSubject(!1),this.activeLayer$=new Le.BehaviorSubject(undefined),this.layersChecked=[],this.layersAreAllVisible=!0,this.ogcButton=!0,this.timeButton=!0,this.floatLabel="auto",this.layerFilterAndSortOptions={},this.excludeBaseLayers=!1,this.toggleLegendOnVisibilityChange=!1,this.expandLegendOfVisibleLayers=!1,this.updateLegendOnResolutionChange=!1,this.queryBadge=!1,this.appliedFilterAndSort=new je.EventEmitter,this._keyword=undefined,this._onlyVisible=!1,this._sortedAlpha=!1,this.toggleOpacity=!1,this.selectAllCheck$=new Le.BehaviorSubject(undefined)}var So=(wo.prototype.getMap=function(){return this.map},wo.prototype.setMap=function(e){this.map=e},wo.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],wo.ctorParameters=function(){return[]},wo.ngInjectableDef=je.defineInjectable({factory:function(){return new wo},token:wo,providedIn:"root"}),wo);function wo(){}var Io=(Oo.prototype.ngOnInit=function(){var r=this;this.component.layers=[],this.layersOrResolutionChange$$=Le.combineLatest([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe(Pe.debounceTime(10)).subscribe(function(e){var t=e[0].filter(function(e){return!0===e.showInLayerList});r.component.layers=t,r.setLayersVisibilityStatus(t,r.component.excludeBaseLayers)})},Oo.prototype.setLayersVisibilityStatus=function(e,t){var r=this;this.layersVisibility$$!==undefined&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=undefined),this.layersVisibility$$=Le.combineLatest(e.filter(function(e){return e.baseLayer!==t}).map(function(e){return e.visible$})).pipe(Pe.map(function(e){return e.every(Boolean)})).subscribe(function(e){return r.component.layersAreAllVisible=e})},Oo.prototype.ngOnDestroy=function(){this.layersOrResolutionChange$$.unsubscribe(),this.layersVisibility$$!==undefined&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=undefined)},Oo.decorators=[{type:je.Directive,args:[{selector:"[igoLayerListBinding]"}]}],Oo.ctorParameters=function(){return[{type:vo,decorators:[{type:je.Self}]},{type:So},{type:Ae.RouteService,decorators:[{type:je.Optional}]}]},Oo);function Oo(e,t,r){this.mapService=t,this.route=r,this.component=e}var Fo=(Object.defineProperty(xo.prototype,"onlyVisible",{get:function(){return this.onlyVisible$.value},set:function(e){this.onlyVisible$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(xo.prototype,"sortAlpha",{get:function(){return this.sortAlpha$.value},set:function(e){this.sortAlpha$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(xo.prototype,"term",{get:function(){return this.term$.value},set:function(e){this.term$.next(e)},enumerable:!0,configurable:!0}),xo.prototype.ngOnInit=function(){var t=this;this.term$$=this.term$.subscribe(function(e){t.appliedFilterAndSort.emit({keyword:e,onlyVisible:t.onlyVisible,sortAlpha:t.sortAlpha})}),this.onlyVisible$$=this.onlyVisible$.subscribe(function(e){t.appliedFilterAndSort.emit({keyword:t.term,onlyVisible:e,sortAlpha:t.sortAlpha})}),this.sortAlpha$$=this.sortAlpha$.subscribe(function(e){t.appliedFilterAndSort.emit({keyword:t.term,onlyVisible:t.onlyVisible,sortAlpha:e})})},xo.prototype.ngOnDestroy=function(){this.onlyVisible$$.unsubscribe(),this.sortAlpha$$.unsubscribe(),this.term$$.unsubscribe()},xo.prototype.clearTerm=function(){this.term=undefined},xo.prototype.toggleSortAlpha=function(){this.sortAlpha=!this.sortAlpha},xo.prototype.toggleOnlyVisible=function(){this.onlyVisible=!this.onlyVisible},xo.prototype.toggleSelectionMode=function(){this.selectionMode=!this.selectionMode,this.selection.emit(this.selectionMode)},xo.decorators=[{type:je.Component,args:[{selector:"igo-layer-list-tool",template:'\r\n\r\n  <mat-list-item>\r\n      <mat-form-field class="inputFilter" [floatLabel]="floatLabel">\r\n        <input\r\n          matInput\r\n          [placeholder]="\'igo.geo.layer.filterPlaceholder\' | translate"\r\n          [matTooltip]="\'igo.geo.layer.subsetLayersListKeyword\' | translate"\r\n          matTooltipShowDelay="500"\r\n          type="text" [(ngModel)]="term">\r\n        <button\r\n          mat-button\r\n          *ngIf="term"\r\n          matSuffix\r\n          mat-icon-button\r\n          aria-label="Clear"\r\n          color="warn"\r\n          (click)="clearTerm()">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n      <div [matTooltip]="sortAlpha ?\r\n      (\'igo.geo.layer.sortAlphabetically\' | translate) :\r\n      (\'igo.geo.layer.sortMapOrder\' | translate)" matTooltipShowDelay="500">\r\n        <button [color]="sortAlpha ? \'warn\' : \'primary\'" mat-icon-button (click)="toggleSortAlpha()">\r\n          <mat-icon [svgIcon]="sortAlpha ? \'sort-variant-remove\' : \'sort-alphabetical\'"></mat-icon>\r\n        </button>\r\n      </div>\r\n\r\n\r\n       <div [matTooltip]="onlyVisible ?\r\n        (\'igo.geo.layer.resetLayersList\' | translate) :\r\n        (\'igo.geo.layer.subsetLayersListOnlyVisible\' | translate)" matTooltipShowDelay="500">\r\n         <button mat-icon-button [disabled]="layersAreAllVisible && !onlyVisible"\r\n           [color]="onlyVisible ? \'warn\' : \'primary\'" (click)="toggleOnlyVisible()">\r\n           <mat-icon [svgIcon]="onlyVisible ? \'sort-variant-remove\' : \'eye\'"></mat-icon>\r\n         </button>\r\n       </div>\r\n\r\n       <div [matTooltip]="selectionMode ?\r\n        (\'igo.geo.layer.deactivateSelectionMode\' | translate) :\r\n        (\'igo.geo.layer.activateSelectionMode\' | translate)" matTooltipShowDelay="500">\r\n         <button mat-icon-button\r\n           color="primary" (click)="toggleSelectionMode()">\r\n           <mat-icon [svgIcon]="selectionMode ? \'checkbox-multiple-marked-outline\' : \'checkbox-multiple-blank-outline\'"></mat-icon>\r\n         </button>\r\n       </div>\r\n\r\n</mat-list-item>',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:["mat-form-field.inputFilter{width:calc(100% - 100px);max-width:200px}"]}]}],xo.propDecorators={layersAreAllVisible:[{type:je.Input}],floatLabel:[{type:je.Input}],onlyVisible:[{type:je.Input}],sortAlpha:[{type:je.Input}],term:[{type:je.Input}],appliedFilterAndSort:[{type:je.Output}],selection:[{type:je.Output}]},xo);function xo(){this.onlyVisible$=new Le.BehaviorSubject(!1),this.sortAlpha$=new Le.BehaviorSubject(!1),this.term$=new Le.BehaviorSubject(undefined),this.layersAreAllVisible=!0,this.floatLabel="auto",this.selectionMode=!1,this.appliedFilterAndSort=new je.EventEmitter,this.selection=new je.EventEmitter}var Co=(To.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],To.ctorParameters=function(){return[]},To.ngInjectableDef=je.defineInjectable({factory:function(){return new To},token:To,providedIn:"root"}),To);function To(){this.sortAlpha=!1,this.onlyVisible=!1,this.onlyInRange=!1,this.keywordInitialized=!1,this.sortedAlphaInitialized=!1,this.onlyVisibleInitialized=!1,this.onlyInRangeInitialized=!1}var Lo=(Object.defineProperty(Mo.prototype,"options",{get:function(){if(this.layer)return this.layer.options},enumerable:!0,configurable:!0}),Mo.prototype.ngOnInit=function(){this.color=this.trackFeature?"primary":"basic"},Mo.prototype.toggleTrackFeature=function(){this.trackFeature?(this.layer.disableTrackFeature(this.layer.options.trackFeature),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature},Mo.decorators=[{type:je.Component,args:[{selector:"igo-track-feature-button",template:'<button *ngIf="options.trackFeature"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.layer.trackFeature\' | translate"\r\n  [color]="color"\r\n  (click)="toggleTrackFeature()">\r\n  <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n</button>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Mo.ctorParameters=function(){return[]},Mo.propDecorators={layer:[{type:je.Input}],trackFeature:[{type:je.Input}]},Mo);function Mo(){this.trackFeature=!1,this.color="primary"}var Po,ko=(Ke(Do,Po=Ce.EntityStoreStrategy),Do.prototype.bindStore=function(e){Po.prototype.bindStore.call(this,e),!0===this.active&&this.watchStore(e)},Do.prototype.unbindStore=function(e){Po.prototype.unbindStore.call(this,e),!0===this.active&&this.unwatchStore(e)},Do.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},Do.prototype.doDeactivate=function(){this.unwatchAll()},Do.prototype.watchStore=function(t){var r=this;if(!this.stores$$.has(t)){var e=t.view.all$().subscribe(function(e){return r.onFeaturesChange(e,t)});this.stores$$.set(t,e)}},Do.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(t.unsubscribe(),this.stores$$["delete"](e))},Do.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){e[1].unsubscribe()}),this.stores$$.clear()},Do.prototype.onFeaturesChange=function(e,t){0===e.length?t.clearLayer():t.setLayerFeatures(e,this.selectMotion(t),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},Do.prototype.selectMotion=function(e){return this.options.motion!==undefined?this.options.motion:!0===e.pristine?cr.Default:e.count>e.view.count?cr.Default:cr.None},Do);function Do(e){var t=Po.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}var jo,Eo=(Ke($o,jo=Ce.EntityStoreStrategy),$o.prototype.bindStore=function(e){jo.prototype.bindStore.call(this,e),!0===this.active&&this.watchStore(e)},$o.prototype.unbindStore=function(e){jo.prototype.unbindStore.call(this,e),!0===this.active&&this.unwatchStore(e)},$o.prototype.doActivate=function(){var t=this;this.stores.forEach(function(e){return t.watchStore(e)})},$o.prototype.doDeactivate=function(){this.unwatchAll()},$o.prototype.watchStore=function(t){var r=this;this.stores$$.has(t)||(this.onSourceChanges(t),t.layer.ol.getSource().on("change",function(e){r.onSourceChanges(t)}))},$o.prototype.unwatchStore=function(e){var t=this.stores$$.get(e);t!==undefined&&(fe.unByKey(t),this.stores$$["delete"](e))},$o.prototype.unwatchAll=function(){Array.from(this.stores$$.entries()).forEach(function(e){fe.unByKey(e[1])}),this.stores$$.clear()},$o.prototype.onSourceChanges=function(e){var t=e.layer.ol.getSource().getFeatures();0===t.length?e.clear():e.setStoreOlFeatures(t)},$o);function $o(e){var t=jo.call(this,e)||this;return t.options=e,t.stores$$=new Map,t}var Ro,Ao=(Ke(Bo,Ro=Ce.EntityStore),Object.defineProperty(Bo.prototype,"source",{get:function(){return this.layer?this.layer.dataSource:undefined},enumerable:!0,configurable:!0}),Bo.prototype.bindLayer=function(e){return this.layer=e,this},Bo.prototype.setLayerFeatures=function(e,t,r,o,n){var i=this;void 0===t&&(t=cr.Default),n=n||Ce.getEntityId,this.checkLayer();var a=e.map(function(e){return Wo(e,i.map.projection,n)});this.setLayerOlFeatures(a,t,r,o)},Bo.prototype.setStoreOlFeatures=function(e){var t=this;this.checkLayer();var r=e.map(function(e){return e.set("_featureStore",t,!0),Ko(e,t.layer.map.projection)});this.load(r)},Bo.prototype.clearLayer=function(){this.checkLayer(),this.source.ol.clear()},Bo.prototype.checkLayer=function(){if(this.layer===undefined)throw new Error("This FeatureStore is not bound to a layer.")},Bo.prototype.setLayerOlFeatures=function(e,t,r,o){void 0===t&&(t=cr.Default);var n=on(this.layer.ol.getSource().getFeatures(),e);0<n.remove.length&&this.removeOlFeaturesFromLayer(n.remove),0<n.add.length&&this.addOlFeaturesToLayer(n.add),0<n.add.length?Xo(this.map,n.add,t,r,o):0<n.remove.length&&Xo(this.map,e,t,r,o)},Bo.prototype.addOlFeaturesToLayer=function(e){var t=this;e.forEach(function(e){e.set("_featureStore",t,!0)}),this.source.ol.addFeatures(e)},Bo.prototype.removeOlFeaturesFromLayer=function(e){var t=this;e.forEach(function(e){t.source.ol.removeFeature(e)})},Bo);function Bo(e,t){var r=Ro.call(this,e,t)||this;return r.map=t.map,r}var Go,_o=(Ke(qo,Go=oe),qo);function qo(e){return Go.call(this,e)||this}var No,Vo=(Ke(Uo,No=Ce.EntityStoreStrategy),Object.defineProperty(Uo.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),Object.defineProperty(Uo.prototype,"overlayStore",{get:function(){return this._overlayStore},enumerable:!0,configurable:!0}),Uo.prototype.bindStore=function(e){No.prototype.bindStore.call(this,e),!0===this.active&&this.activate()},Uo.prototype.unbindStore=function(e){No.prototype.unbindStore.call(this,e),!0===this.active&&this.activate()},Uo.prototype.unselectAll=function(){this.stores.forEach(function(e){e.state.updateAll({selected:!1})})},Uo.prototype.clear=function(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()},Uo.prototype.doActivate=function(){this.addOverlayLayer(),this.listenToMapClick(),!0===this.options.dragBox&&this.addDragBoxInteraction(),this.watchAll()},Uo.prototype.doDeactivate=function(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll(),this.removeOverlayLayer()},Uo.prototype.watchAll=function(){var t=this;this.unwatchAll();var e=this.stores.map(function(e){return e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(Pe.map(function(e){return e.map(function(e){return e.entity})}))});this.stores$$=Le.combineLatest(e).pipe(Pe.debounceTime(5),Pe.skip(1),Pe.map(function(e){return e.reduce(function(e,t){return e.concat(t)})})).subscribe(function(e){return t.onSelectFromStore(e)})},Uo.prototype.unwatchAll=function(){this.stores$$!==undefined&&this.stores$$.unsubscribe()},Uo.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){t.onMapClick(e)})},Uo.prototype.unlistenToMapClick=function(){this.mapClickListener!==undefined&&this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener)},Uo.prototype.onMapClick=function(e){var r=this,t=!vr(e),o=!t,n=e.map.getFeaturesAtPixel(e.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:function(t){return r.stores.find(function(e){return e.layer.ol===t})!==undefined}});this.onSelectFromMap(n,t,o)},Uo.prototype.addDragBoxInteraction=function(){var e,t,r,o=this,n=this.map.ol.getInteractions().getArray();try{for(var i=Qe(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(s instanceof _o){r=s;break}}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=i["return"])&&t.call(i)}finally{if(e)throw e.error}}r===undefined&&(r=new _o({condition:vr}),this.map.ol.addInteraction(r),this.olDragSelectInteraction=r),this.olDragSelectInteractionEndKey=r.on("boxend",function(e){return o.onDragBoxEnd(e)})},Uo.prototype.removeDragBoxInteraction=function(){this.olDragSelectInteractionEndKey!==undefined&&fe.unByKey(this.olDragSelectInteractionEndKey),this.olDragSelectInteraction!==undefined&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=undefined},Uo.prototype.onDragBoxEnd=function(e){var t=!vr(e.mapBrowserEvent),o=e.target.getGeometry().getExtent(),r=this.stores.reduce(function(e,t){var r=t.layer.ol.getSource();return e.push.apply(e,Xe(r.getFeaturesInExtent(o))),e},[]);this.onSelectFromMap(r,t,!1)},Uo.prototype.onSelectFromStore=function(e){var t,r=this.options?this.options.motion:undefined,o=this.overlayStore.layer.ol.getSource().getFeatures().map(function(e){return e.getId()}),n=e.map(this.overlayStore.getKey);t=0!==e.length&&(o.length!==n.length||!o.every(function(e){return 0<=n.indexOf(e)})),this.overlayStore.setLayerFeatures(e,t?r:cr.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)},Uo.prototype.onSelectFromMap=function(e,r,o){var n=this,i=this.groupFeaturesByStore(e);this.stores.forEach(function(e){var t=i.get(e);t===undefined&&!0===r?n.unselectAllFeaturesFromStore(e):t===undefined&&!1===r||n.selectFeaturesFromStore(e,t,r,o)})},Uo.prototype.selectFeaturesFromStore=function(e,t,r,o){!0===o?e.state.reverseMany(t,["selected"]):e.state.updateMany(t,{selected:!0},r)},Uo.prototype.unselectAllFeaturesFromStore=function(e){e.state.updateAll({selected:!1})},Uo.prototype.groupFeaturesByStore=function(e){var n=new Map;return null===e||e===undefined||e.forEach(function(e){var t=e.get("_featureStore");if(t!==undefined){var r=n.get(t);r===undefined&&(r=[],n.set(t,r));var o=t.get(e.getId());o!==undefined&&r.push(o)}}),n},Uo.prototype.createOverlayStore=function(){var e=this.options.layer?this.options.layer:this.createOverlayLayer();return new Ao([],{map:this.map}).bindLayer(e)},Uo.prototype.createOverlayLayer=function(){return new Vr({zIndex:300,source:new ct,style:undefined,showInLayerList:!1,exportable:!1,browsable:!1})},Uo.prototype.addOverlayLayer=function(){this.overlayStore.layer.map===undefined&&this.map.addLayer(this.overlayStore.layer)},Uo.prototype.removeOverlayLayer=function(){this.overlayStore.source.ol.clear(),this.map.removeLayer(this.overlayStore.layer)},Uo);function Uo(e){var t=No.call(this,e)||this;return t.options=e,t._overlayStore=t.createOverlayStore(),t}function Wo(e,t,r){r=r||Ce.getEntityId;var o=(new Oe).readFeature(e,{dataProjection:e.projection,featureProjection:t});o.setId(r(e));var n=Ce.getEntityTitle(e);n!==undefined&&o.set("_title",n,!0),e.extent!==undefined&&o.set("_extent",e.extent,!0),e.projection!==undefined&&o.set("_projection",e.projection,!0);var i=Ce.getEntityProperty(e,"meta.mapTitle");i!==undefined&&o.set("_mapTitle",i,!0),o.set("_entityRevision",Ce.getEntityRevision(e),!0);var a=Ce.getEntityIcon(e);return a!==undefined&&o.set("_icon",a,!0),e.meta&&e.meta.style&&o.set("_style",e.meta.style,!0),e.sourceId&&o.set("_sourceId",e.sourceId,!0),o}function zo(e,t,r,o){var n,i,a,s;void 0===o&&(o="EPSG:4326"),r?(i=r.get("title"),r.get("sourceOptions")&&(a=r.get("sourceOptions").excludeAttribute,s=r.get("sourceOptions").excludeAttributeOffline)):i=e.get("_title");var l=new Oe,u=e.getProperties(),c=e.getType();if("Polygon"===c){var p=e.ends_;n=new te(e.flatCoordinates_,T.XY,p)}else"Point"===c?n=new U(e.flatCoordinates_,T.XY):"LineString"===c&&(n=new Y(e.flatCoordinates_,T.XY));var d=l.writeGeometryObject(n,{dataProjection:o,featureProjection:t}),h=e.getId()?e.getId():ke.uuid(),g=e.get("_mapTitle");return{type:ur,projection:o,extent:e.getExtent(),meta:{id:h,title:i||(g||h),mapTitle:g,excludeAttribute:a,excludeAttributeOffline:s},properties:u,geometry:d,ol:e}}function Ko(r,e,t,o){var n,i,a;void 0===o&&(o="EPSG:4326");var s=new Oe,l=r.getKeys().filter(function(e){return!e.startsWith("_")&&"geometry"!==e}).reduce(function(e,t){return e[t]=r.get(t),e},{}),u=s.writeGeometryObject(r.getGeometry(),{dataProjection:o,featureProjection:e});t?(n=t.get("title"),t.get("sourceOptions")&&(i=t.get("sourceOptions").excludeAttribute,a=t.get("sourceOptions").excludeAttributeOffline)):n=r.get("_title");var c=r.get("_mapTitle"),p=r.getId()?r.getId():ke.uuid();return{type:ur,projection:o,extent:r.get("_extent"),meta:{id:p,title:n||(c||p),mapTitle:c,revision:r.getRevision(),style:r.get("_style"),excludeAttribute:i,excludeAttributeOffline:a},properties:l,geometry:u,ol:r}}function Ho(e,t){var r=z.createEmpty(),o=t.get("_extent"),n=t.get("_projection");if(o!==undefined&&n!==undefined)r=Se.transformExtent(o,n,e.projection);else{var i=t.getGeometry();null!==i&&(r=i.getExtent())}return r}function Yo(r,e){var o=z.createEmpty();return e.forEach(function(e){var t=Ho(r,e);z.extend(o,t)}),o}function Zo(e,t){var r=Je(z.getSize(e),2),o=r[0],n=r[1];return[t[3]?e[0]-o*t[3]:e[0],t[2]?e[1]-n*t[2]:e[1],t[1]?e[2]+o*t[1]:e[2],t[0]?e[3]+n*t[0]:e[3]]}function Qo(e,t){var r=e.viewController.getExtent(),o=Zo(r,[-1,-1,-1,-1].map(function(e){return.05*e}));return!z.containsExtent(o,t)}function Jo(e,t,r){r=r||.004;var o=e.viewController.getExtent(),n=z.getArea(o),i=z.getArea(t);return!(0===i&&13<e.viewController.getZoom())&&i/n<r}function Xo(e,t,r,o,n){void 0===r&&(r=cr.Default);var i=Yo(e,t),a=i;o!==undefined&&(a=Zo(a,o)),r===cr.Zoom?e.viewController.zoomToExtent(a):r===cr.Move?e.viewController.moveToExtent(a):r===cr.Default&&(Qo(e,i)||Jo(e,i,n))&&e.viewController.zoomToExtent(a)}function en(e,t){e.layer===undefined&&(t=t||new Vr({source:new ct}),e.bindLayer(t)),e.layer.map===undefined&&e.map.addLayer(e.layer)}function tn(e,t){e.getStrategyOfType(ko)===undefined?(t=t||new ko({}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(ko)}function rn(e,t){e.getStrategyOfType(Vo)===undefined?(t=t||new Vo({map:e.map}),e.addStrategy(t),t.activate()):e.activateStrategyOfType(Vo)}function on(e,t){var r=new Map;t.forEach(function(e){r.set(e.getId(),e)});var o=[];e.forEach(function(e){var t=r.get(e.getId());t===undefined?o.push(e):t.get("_entityRevision")!==e.get("_entityRevision")?o.push(e):r["delete"](t.getId())});var n=Array.from(r.keys());return{add:t.filter(function(e){return 0<=n.indexOf(e.getId())}),remove:o}}var nn=(Object.defineProperty(an.prototype,"feature",{get:function(){return this.feature$.value},set:function(e){this.feature$.next(e)},enumerable:!0,configurable:!0}),an.prototype.onSubmit=function(e){var t=this.formDataToFeature(e);this.submitForm.emit(t)},an.prototype.getData=function(){return this.formDataToFeature(this.igoForm.getData())},an.prototype.formDataToFeature=function(e){var i={},t={};this.feature===undefined?t.id=ke.uuid():(Object.assign(i,this.feature.properties),Object.assign(t,this.feature.meta,{revision:Ce.getEntityRevision(this.feature)+1}));var a="properties.";Object.entries(e).forEach(function(e){var t=Je(e,2),r=t[0],o=t[1];if(r.startsWith(a)){var n=r.substr(a.length);i[n]=o}});var r=e.geometry;return r===undefined&&this.feature!==undefined&&(r=this.feature.geometry),{meta:t,type:ur,geometry:r,projection:"EPSG:4326",properties:i}},an.decorators=[{type:je.Component,args:[{selector:"igo-feature-form",template:'\r\n<igo-form\r\n  #igoForm\r\n  [form]="form"\r\n  [formData]="feature$ | async"\r\n  (submitForm)="onSubmit($event)">\r\n\r\n  <ng-content></ng-content>\r\n  \r\n  <ng-content select="[formButtons]" formButtons></ng-content>\r\n  \r\n</igo-form>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}igo-form{height:100%}"]}]}],an.ctorParameters=function(){return[]},an.propDecorators={form:[{type:je.Input}],feature:[{type:je.Input}],submitForm:[{type:je.Output}],igoForm:[{type:je.ViewChild,args:["igoForm"]}]},an);function an(){this.feature$=new Le.BehaviorSubject(undefined),this.submitForm=new je.EventEmitter}var sn=(Object.defineProperty(ln.prototype,"dataSource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),ln.prototype.setMap=function(e){e===undefined?this.map!==undefined&&this.map.ol.removeLayer(this.layer.ol):e.ol.addLayer(this.layer.ol),this.map=e},ln.prototype.setFeatures=function(e,t,r){var o,n;if(void 0===t&&(t=cr.Default),r)try{for(var i=Qe(this.dataSource.ol.getFeatures()),a=i.next();!a.done;a=i.next()){var s=a.value;s.get("_sourceId")===r&&this.removeOlFeature(s)}}catch(l){o={error:l}}finally{try{a&&!a.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}else this.clear();this.addFeatures(e,t)},ln.prototype.addFeature=function(e,t){void 0===t&&(t=cr.Default),this.addFeatures([e],t)},ln.prototype.addFeatures=function(e,t){var r=this;void 0===t&&(t=cr.Default);var o=[];e.forEach(function(e){var t=Wo(e,r.map.projection);null!==t.getGeometry()&&o.push(t)}),this.addOlFeatures(o,t)},ln.prototype.addOlFeature=function(e,t){void 0===t&&(t=cr.Default),this.addOlFeatures([e],t)},ln.prototype.addOlFeatures=function(e,t){void 0===t&&(t=cr.Default),this.dataSource.ol.addFeatures(e),Xo(this.map,e,t)},ln.prototype.removeFeature=function(e){this.removeFeatures([e])},ln.prototype.removeFeatures=function(e){var t=this;e.forEach(function(e){e.meta&&t.dataSource.ol.getFeatureById(e.meta.id)&&t.removeOlFeature(t.dataSource.ol.getFeatureById(e.meta.id))})},ln.prototype.removeOlFeature=function(e){this.dataSource.ol.removeFeature(e)},ln.prototype.clear=function(){this.dataSource.ol.clear()},ln);function ln(e){this.layer=to(),this.setMap(e)}var un,cn=(Ke(pn,un=ke.Watcher),pn.prototype.watch=function(){},pn.prototype.unwatch=function(){var t=this;this.layers.forEach(function(e){return t.unwatchLayer(e)},this)},pn.prototype.watchLayer=function(e){var t=this;if(e.status$!==undefined){this.layers.push(e);var r=e.status$.pipe(Pe.distinctUntilChanged()).subscribe(function(e){e===ke.SubjectStatus.Working?t.loading+=1:e===ke.SubjectStatus.Done&&(t.loaded+=1),t.loaded>=t.loading?(t.loading=t.loaded=0,t.status=ke.SubjectStatus.Done):0<t.loading&&(t.status=ke.SubjectStatus.Working)});this.subscriptions.push(r)}},pn.prototype.unwatchLayer=function(e){e.status$.next(ke.SubjectStatus.Done);var t=this.layers.indexOf(e);if(0<=t){var r=e.watcher.status;-1!==[ke.SubjectStatus.Working,ke.SubjectStatus.Waiting].indexOf(r)&&(this.loaded+=1),this.subscriptions[t].unsubscribe(),this.subscriptions.splice(t,1),this.layers.splice(t,1),e.watcher.unwatch()}},pn);function pn(){var e=un.call(this)||this;return e.loaded=0,e.loading=0,e.layers=[],e.subscriptions=[],e}var dn={Move:0,Zoom:1};dn[dn.Move]="Move",dn[dn.Zoom]="Zoom";var hn=(gn.prototype.getOlMap=function(){return this.olMap},gn.prototype.setOlMap=function(e){if(e!==undefined&&this.getOlMap()!==undefined)throw new Error("This controller is already bound to a map.");if(e===undefined)return this.teardownObservers(),void(this.olMap=e);this.olMap=e},gn.prototype.teardownObservers=function(){this.observerKeys.forEach(function(e){return fe.unByKey(e)}),this.observerKeys=[]},gn);function gn(){this.observerKeys=[]}var fn,mn=(Ke(yn,fn=hn),Object.defineProperty(yn.prototype,"stateHistory",{get:function(){return!!this.options&&!0===this.options.stateHistory},enumerable:!0,configurable:!0}),Object.defineProperty(yn.prototype,"olView",{get:function(){return this.olMap.getView()},enumerable:!0,configurable:!0}),yn.prototype.setOlMap=function(e){fn.prototype.setOlMap.call(this,e),this.setupObservers()},yn.prototype.setupObservers=function(){var t=this;!0===this.stateHistory&&this.observerKeys.push(this.olMap.on("moveend",function(e){return t.onMoveEnd(e)})),this.extent$$=this.extent$.pipe(Pe.debounceTime(25)).subscribe(function(e){t.setExtent(e.extent,e.action)})},yn.prototype.teardownObservers=function(){fn.prototype.teardownObservers.call(this),this.extent$$!==undefined&&(this.extent$$.unsubscribe(),this.extent$$=undefined)},yn.prototype.getOlProjection=function(){return this.olView.getProjection()},yn.prototype.getCenter=function(e){var t=this.olView.getCenter();return e&&t&&(t=Se.transform(t,this.getOlProjection(),e)),t},yn.prototype.getExtent=function(e){var t=this.olView.calculateExtent(this.olMap.getSize());return e&&t&&(t=Se.transformExtent(t,this.getOlProjection(),e)),t},yn.prototype.getScale=function(e){return void 0===e&&(e=96),yr(this.getResolution(),this.getOlProjection().getUnits(),e)},yn.prototype.getResolution=function(){return this.olView.getResolution()},yn.prototype.getZoom=function(){return Math.round(this.olView.getZoom())},yn.prototype.zoomIn=function(){this.zoomTo(this.olView.getZoom()+1)},yn.prototype.zoomOut=function(){this.zoomTo(this.olView.getZoom()-1)},yn.prototype.zoomTo=function(e){this.olView.cancelAnimations(),this.olView.animate({zoom:e,duration:250,easing:j.easeOut})},yn.prototype.moveToExtent=function(e){this.extent$.next({extent:e,action:dn.Move})},yn.prototype.zoomToExtent=function(e){this.extent$.next({extent:e,action:dn.Zoom})},yn.prototype.getRotation=function(){return this.olView.getRotation()},yn.prototype.resetRotation=function(){this.olView.animate({rotation:0})},yn.prototype.hasPreviousState=function(){return 1<this.states.length&&0<this.stateIndex},yn.prototype.hasNextState=function(){return 1<this.states.length&&this.stateIndex<this.states.length-1},yn.prototype.previousState=function(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)},yn.prototype.nextState=function(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)},yn.prototype.clearStateHistory=function(){this.states=[],this.stateIndex=0},yn.prototype.setInitialState=function(){0<this.states.length&&this.setStateIndex(0)},yn.prototype.setExtent=function(e,t,r){void 0===r&&(r=!0);var o=this.olView;o.cancelAnimations();var n=r?500:0,i=o.getZoom(),a=o.getCenter(),s=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2],l=Math.sqrt(Math.pow(a[0]-s[0],2)+Math.pow(a[1]-s[1],2)),u=o.calculateExtent(),c=Math.sqrt(Math.pow(u[2]-u[0],2)+Math.pow(u[3]-u[1],2)),p=l/((Math.sqrt(Math.pow(e[2]-e[0],2)+Math.pow(e[3]-e[1],2))+c)/2),d=t===dn.Move||i>this.maxZoomOnExtent?i:this.maxZoomOnExtent;o.fit(e,{maxZoom:d,padding:this.padding,duration:4<p?0:n})},yn.prototype.setStateIndex=function(e){this.stateIndex=e,this.setState(this.states[e])},yn.prototype.setState=function(e){this.olView.animate({resolution:e.resolution,center:e.center,duration:0})},yn.prototype.onMoveEnd=function(e){var t=this.getResolution();this.resolution$.value!==t&&this.resolution$.next(t);var r={resolution:t,center:this.getCenter(),zoom:this.getZoom()};if(!0===this.stateHistory){var o=this.stateIndex;gr(r,0===this.states.length?undefined:this.states[o])||(this.states=this.states.slice(0,o+1).concat([r]),this.stateIndex=this.states.length-1)}this.state$.next(r)},yn);function yn(e){var t=fn.call(this)||this;return t.options=e,t.resolution$=new Le.BehaviorSubject(undefined),t.state$=new Le.BehaviorSubject(undefined),t.padding=[0,0,0,0],t.maxZoomOnExtent=19,t.extent$=new Le.Subject,t.states=[],t.stateIndex=0,t}var vn=(Object.defineProperty(bn.prototype,"layers",{get:function(){return this.layers$.value},enumerable:!0,configurable:!0}),Object.defineProperty(bn.prototype,"projection",{get:function(){return this.viewController.getOlProjection().getCode()},enumerable:!0,configurable:!0}),bn.prototype.init=function(){var e=[];if(this.options.controls){if(this.options.controls.attribution){var t=!0===this.options.controls.attribution?{}:this.options.controls.attribution;e.push(new F(t))}if(this.options.controls.scaleLine){var r=!0===this.options.controls.scaleLine?{}:this.options.controls.scaleLine;e.push(new x(r))}}var o={};!1===this.options.interactions&&(o={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new w({interactions:ge.defaults(o),controls:e}),this.setView(this.options.view||{}),this.viewController=new mn({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new sn(this),this.buffer=new sn(this)},bn.prototype.setTarget=function(e){this.ol.setTarget(e),e!==undefined?this.layerWatcher.subscribe(function(){},null):this.layerWatcher.unsubscribe()},bn.prototype.updateView=function(e){var t=this.ol.getView(),r=Object.assign({zoom:t.getZoom()},t.getProperties());this.setView(Object.assign(r,e)),e.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=e.maxZoomOnExtent)},bn.prototype.setView=function(e){this.viewController!==undefined&&this.viewController.clearStateHistory();var t=new I(e);if(this.ol.setView(t),this.unsubscribeGeolocate(),e){if(e.center){var r=t.getProjection().getCode(),o=Se.fromLonLat(e.center,r);t.setCenter(o)}e.geolocate&&this.geolocate(!0),e.alwaysTracking&&(this.alwaysTracking=!0)}},bn.prototype.getCenter=function(e){return this.viewController.getCenter(e)},bn.prototype.getExtent=function(e){return this.viewController.getExtent(e)},bn.prototype.getZoom=function(){return this.viewController.getZoom()},bn.prototype.changeBaseLayer=function(e){var t,r;if(e){try{for(var o=Qe(this.getBaseLayers()),n=o.next();!n.done;n=o.next())n.value.visible=!1}catch(i){t={error:i}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}e.visible=!0,this.viewController.olView.setMinZoom(e.dataSource.options.minZoom||(this.options.view||{}).minZoom),this.viewController.olView.setMaxZoom(e.dataSource.options.maxZoom||(this.options.view||{}).maxZoom)}},bn.prototype.getBaseLayers=function(){return this.layers.filter(function(e){return!0===e.baseLayer})},bn.prototype.getLayerById=function(t){return this.layers.find(function(e){return e.id&&e.id===t})},bn.prototype.addLayer=function(e,t){void 0===t&&(t=!0),this.addLayers([e])},bn.prototype.addLayers=function(e,t){var r=this;void 0===t&&(t=!0);var o=0,n=0,i=e.map(function(e){var t=e.zIndex?0:e.baseLayer?n++:o++;return r.doAddLayer(e,t)}).filter(function(e){return e!==undefined});this.setLayers([].concat(this.layers,i))},bn.prototype.removeLayer=function(e){this.removeLayers([e])},bn.prototype.removeLayers=function(e){var r=this,o=this.layers$.value.slice(0),n=[];e.forEach(function(e){var t=r.getLayerIndex(e);0<=t&&(n.push(e),o.splice(t,1))}),n.forEach(function(e){return r.doRemoveLayer(e)}),this.setLayers(o)},bn.prototype.removeAllLayers=function(){var t=this;this.layers.forEach(function(e){return t.doRemoveLayer(e)}),this.layers$.next([])},bn.prototype.raiseLayer=function(e){var t=this.getLayerIndex(e);1<t&&this.moveLayer(e,t,t-1)},bn.prototype.raiseLayers=function(e){var t,r;try{for(var o=Qe(e),n=o.next();!n.done;n=o.next()){var i=n.value;this.raiseLayer(i)}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}},bn.prototype.lowerLayer=function(e){var t=this.getLayerIndex(e);t<this.layers.length-1&&this.moveLayer(e,t,t+1)},bn.prototype.lowerLayers=function(e){var t,r,o=e.reverse();try{for(var n=Qe(o),i=n.next();!i.done;i=n.next()){var a=i.value;this.lowerLayer(a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}},bn.prototype.moveLayer=function(e,t,r){var o=this.layers[r],n=o.zIndex,i=e.zIndex;o.baseLayer||e.baseLayer||(e.zIndex=n,o.zIndex=i,this.layers[r]=e,this.layers[t]=o,this.layers$.next(this.layers.slice(0)))},bn.prototype.doAddLayer=function(t,e){t.baseLayer&&t.visible&&this.changeBaseLayer(t);var r=this.getLayerById(t.id);if(r===undefined){if(!t.baseLayer&&t.zIndex&&(t.zIndex+=10),t.zIndex===undefined||0===t.zIndex){var o=Math.max.apply(Math,Xe([t.baseLayer?0:10],this.layers.filter(function(e){return e.baseLayer===t.baseLayer&&e.zIndex<200}).map(function(e){return e.zIndex})));t.zIndex=o+1+e}return t.baseLayer&&9<t.zIndex&&(t.zIndex=10),t.setMap(this),this.layerWatcher.watchLayer(t),this.ol.addLayer(t.ol),t}r.visible=!0},bn.prototype.doRemoveLayer=function(e){this.layerWatcher.unwatchLayer(e),this.ol.removeLayer(e.ol),e.setMap(undefined)},bn.prototype.setLayers=function(e){this.layers$.next(this.sortLayersByZIndex(e).slice(0))},bn.prototype.sortLayersByZIndex=function(e){return e.sort(function(e,t){return t.zIndex-e.zIndex})},bn.prototype.getLayerIndex=function(t){return this.layers.findIndex(function(e){return e===t})},bn.prototype.geolocate=function(u){var c=this;void 0===u&&(u=!1);var p=!0;this.geolocation$$&&(u=this.geolocation.getTracking(),this.unsubscribeGeolocate()),this.startGeolocation(),this.geolocation$$=this.geolocation$.subscribe(function(e){if(e){if(e.getAccuracy()<1e4){var t=e.getAccuracyGeometry(),r=t.getExtent();if(c.geolocationFeature&&c.overlay.dataSource.ol.getFeatureById(c.geolocationFeature.getId())&&c.overlay.dataSource.ol.removeFeature(c.geolocationFeature),c.bufferFeature&&c.buffer.dataSource.ol.removeFeature(c.bufferFeature),c.geolocationFeature=new be({geometry:t}),c.geolocationFeature.setId("geolocationFeature"),!c.positionFollower&&c.alwaysTracking?c.overlay.addOlFeature(c.geolocationFeature,cr.None):c.positionFollower&&c.alwaysTracking?c.overlay.addOlFeature(c.geolocationFeature,cr.Move):c.overlay.addOlFeature(c.geolocationFeature),c.ol.getView().options_.buffer){var o=c.ol.getView().options_.buffer.bufferRadius,n=e.getPosition();c.bufferGeom=new C(n,o);var i=c.ol.getView().options_.buffer.bufferStroke,a=c.ol.getView().options_.buffer.bufferFill,s=void 0;s=c.ol.getView().options_.buffer.showBufferRadius?o.toString()+"m":"",c.bufferFeature=new be(c.bufferGeom),c.bufferFeature.setId("bufferFeature"),c.bufferFeature.set("bufferStroke",i),c.bufferFeature.set("bufferFill",a),c.bufferFeature.set("bufferText",s),c.buffer.addOlFeature(c.bufferFeature,cr.None)}p&&(c.viewController.zoomToExtent(r),c.positionFollower=!c.positionFollower)}else if(p){var l=c.ol.getView();n=e.getPosition(),l.setCenter(n),l.setZoom(14)}u&&!c.alwaysTracking&&c.unsubscribeGeolocate(),p=!1}})},bn.prototype.unsubscribeGeolocate=function(){this.stopGeolocation(),this.geolocation$$&&(this.geolocation$$.unsubscribe(),this.geolocation$$=undefined)},bn.prototype.startGeolocation=function(){var t=this;this.geolocation?this.geolocation.setTracking(!0):(this.geolocation=new O({trackingOptions:{enableHighAccuracy:!0},projection:this.projection,tracking:!0}),this.geolocation.on("change",function(e){t.geolocation$.next(t.geolocation)}))},bn.prototype.stopGeolocation=function(){this.geolocation&&this.geolocation.setTracking(!1)},bn.prototype.onOfflineToggle=function(e){this.offlineButtonToggle$.next(e)},bn);function bn(e){this.offlineButtonToggle$=new Le.BehaviorSubject(!1),this.layers$=new Le.BehaviorSubject([]),this.positionFollower=!0,this.geolocation$=new Le.BehaviorSubject(undefined),this.defaultOptions={controls:{attribution:!1}},this.options=Object.assign({},this.defaultOptions,e),this.layerWatcher=new cn,this.status$=this.layerWatcher.status$,$.register(E),this.init()}var Sn=(Object.defineProperty(wn.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),wn.prototype.ngAfterViewInit=function(){var l=this;this.map.offlineButtonToggle$.subscribe(function(e){l.offlineButtonStatus=e;var t=l.languageService.translate;if(l.offlineButtonStatus&&l.networkState.connection){var r=t.instant("igo.geo.network.offline.message"),o=t.instant("igo.geo.network.offline.title");l.messageService.info(r,o),l.offlineButtonState.connection=!1,l.changeLayer()}else if(l.offlineButtonStatus||l.networkState.connection){if(!l.offlineButtonStatus&&l.networkState.connection){var n,i,a=t.get("igo.geo.network.online.message"),s=t.get("igo.geo.network.online.title");a.subscribe(function(e){n=e}),s.subscribe(function(e){i=e}),l.messageService.info(n,i),l.offlineButtonState.connection=!0,l.changeLayer()}}else r=t.instant("igo.geo.network.offline.message"),o=t.instant("igo.geo.network.offline.title"),l.messageService.info(r,o),l.offlineButtonState.connection=!1,l.changeLayer()}),this.networkService.currentState().subscribe(function(e){l.networkState=e,l.offlineButtonStatus||l.changeLayer()}),this.map.layers$.subscribe(function(e){l.changeLayer()})},wn.prototype.changeLayer=function(){var t,r=this;this.map.layers$.value.forEach(function(e){if(e.options.source instanceof nr)t=e.options.sourceOptions,e.ol.getSource().clear();else if(e.options.source instanceof mt)t=e.options.sourceOptions;else if(e.options.source instanceof sr)t=e.options.sourceOptions;else if(e.options.source instanceof ct)t=e.options.sourceOptions;else{if(!1===r.networkState.connection||!1===r.offlineButtonState.connection)return void e.ol.setMaxResolution(0);if(!0===r.networkState.connection||!0===r.offlineButtonState.connection)return void e.ol.setMaxResolution(Infinity)}if(t)if(t.pathOffline&&!1===r.networkState.connection||t.pathOffline&&!1===r.offlineButtonState.connection){if("vector"===t.type||"cluster"===t.type)return;e.ol.getSource().setUrl(t.pathOffline)}else if(t.pathOffline&&!1===r.networkState.connection||t.pathOffline&&!0===r.offlineButtonState.connection){if("vector"===t.type||"cluster"===t.type)return;e.ol.getSource().setUrl(t.url)}else!1===r.networkState.connection||!1===r.offlineButtonState.connection?e.ol.setMaxResolution(0):!0!==r.networkState.connection&&!0!==r.offlineButtonState.connection||e.ol.setMaxResolution(Infinity);else!1===r.networkState.connection||!1===r.offlineButtonState.connection?e.ol.setMaxResolution(0):!0!==r.networkState.connection&&!0!==r.offlineButtonState.connection||e.ol.setMaxResolution(Infinity)})},wn.decorators=[{type:je.Directive,args:[{selector:"[igoMapOffline]"}]}],wn.ctorParameters=function(){return[{type:Hr},{type:Ae.NetworkService},{type:Ae.MessageService},{type:Ae.LanguageService}]},wn);function wn(e,t,r,o){this.networkService=t,this.messageService=r,this.languageService=o,this.offlineButtonStatus=!1,this.networkState={connection:!0},this.offlineButtonState={connection:!0},this.component=e}var In=(Object.defineProperty(On.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Object.defineProperty(On.prototype,"mapProjection",{get:function(){return this.component.map.projection},enumerable:!0,configurable:!0}),On.prototype.ngOnInit=function(){this.listenToMapPointerMove(),this.listenToMapClick()},On.prototype.ngOnDestroy=function(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()},On.prototype.listenToMapPointerMove=function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(e){return t.onPointerEvent(e,t.pointerPositionDelay)})},On.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onPointerEvent(e,0)})},On.prototype.unlistenToMapPointerMove=function(){this.map.ol.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.pointerMoveListener=undefined},On.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},On.prototype.onPointerEvent=function(e,t){var r=this;if(!e.dragging&&!this.mediaService.isTouchScreen()){"undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest);var o=Se.transform(e.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(function(){r.pointerPositionCoord.emit(o)},t)}},On.decorators=[{type:je.Directive,args:[{selector:"[igoPointerPosition]"}]}],On.ctorParameters=function(){return[{type:Hr,decorators:[{type:je.Self}]},{type:Ae.MediaService}]},On.propDecorators={pointerPositionDelay:[{type:je.Input}],pointerPositionCoord:[{type:je.Output}]},On);function On(e,t){this.component=e,this.mediaService=t,this.pointerPositionDelay=1e3,this.pointerPositionCoord=new je.EventEmitter}var Fn=(Object.defineProperty(xn.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Object.defineProperty(xn.prototype,"mapProjection",{get:function(){return this.component.map.projection},enumerable:!0,configurable:!0}),xn.prototype.ngOnInit=function(){this.listenToMapPointerMove(),this.listenToMapClick(),this.subscribeToKeyDown(),this.subscribeToKeyUp()},xn.prototype.ngOnDestroy=function(){this.unlistenToMapPointerMove(),this.unlistenToMapClick(),this.unsubscribeToKeyDown(),this.unsubscribeToKeyUp()},xn.prototype.listenToMapPointerMove=function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(e){return t.onPointerEvent(e,t.pointerPositionByKeyDelay)})},xn.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onPointerEvent(e,0)})},xn.prototype.subscribeToKeyDown=function(){var t=this;this.unsubscribeToKeyDown(),this.keyDown$$=Le.fromEvent(document,"keydown").subscribe(function(e){e.keyCode!==t.pointerPositionByKeyCode||t.definedKeyIsDown$.next(!0)})},xn.prototype.subscribeToKeyUp=function(){var t=this;this.unsubscribeToKeyUp(),this.keyUp$$=Le.fromEvent(document,"keyup").subscribe(function(e){e.keyCode!==t.pointerPositionByKeyCode||t.definedKeyIsDown$.next(!1)})},xn.prototype.unlistenToMapPointerMove=function(){this.map.ol.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.pointerMoveListener=undefined},xn.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},xn.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&(this.keyDown$$.unsubscribe(),this.keyDown$$=undefined)},xn.prototype.unsubscribeToKeyUp=function(){this.keyUp$$!==undefined&&(this.keyUp$$.unsubscribe(),this.keyUp$$=undefined)},xn.prototype.onPointerEvent=function(e,t){var r=this;if(!e.dragging&&!this.mediaService.isTouchScreen()&&("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.definedKeyIsDown$.value)){var o=Se.transform(e.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(function(){r.pointerPositionByKeyCoord.emit(o)},t)}},xn.decorators=[{type:je.Directive,args:[{selector:"[igoPointerPositionByKey]"}]}],xn.ctorParameters=function(){return[{type:Hr,decorators:[{type:je.Self}]},{type:Ae.MediaService}]},xn.propDecorators={pointerPositionByKeyDelay:[{type:je.Input}],pointerPositionByKeyCode:[{type:je.Input}],pointerPositionByKeyCoord:[{type:je.Output}]},xn);function xn(e,t){this.component=e,this.mediaService=t,this.definedKeyIsDown$=new Le.BehaviorSubject(!1),this.pointerPositionByKeyDelay=1e3,this.pointerPositionByKeyCode=17,this.pointerPositionByKeyCoord=new je.EventEmitter}var Cn=(Tn.prototype.registerProjection=function(e){E.defs(e.code,e.def),$.register(E),e.extent&&Se.get(e.code).setExtent(e.extent)},Tn.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Tn.ctorParameters=function(){return[{type:Ae.ConfigService}]},Tn.ngInjectableDef=je.defineInjectable({factory:function(){return new Tn(je.inject(Ae.ConfigService))},token:Tn,providedIn:"root"}),Tn);function Tn(e){var t=this;this.config=e,(this.config.getConfig("projections")||[]).forEach(function(e){e.alias=e.alias?e.alias:e.code,t.registerProjection(e)});for(var r=1;r<61;r++){var o={code:r<10?"EPSG:3260"+r:"EPSG:326"+r,def:"+proj=utm +zone="+r+" +datum=WGS84 +units=m +no_defs",extent:undefined};this.registerProjection(o)}for(var n=1;n<11;n++){o={code:n<10?"EPSG:3218"+n:"EPSG:321"+(80+n),def:"+proj=tmerc +lat_0=0 +lon_0="+(Number(n)<=2?-50-3*Number(n):12<=Number(n)?-81-3*(Number(n)-12):-49.5-3*Number(n))+' +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"',extent:undefined};this.registerProjection(o)}}var Ln=(Object.defineProperty(Mn.prototype,"zoom",{get:function(){return this.map.viewController.getZoom()},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"minZoom",{get:function(){return this.map.viewController.olView.getMinZoom()||1},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"maxZoom",{get:function(){return this.map.viewController.olView.getMaxZoom()},enumerable:!0,configurable:!0}),Mn.decorators=[{type:je.Component,args:[{selector:"igo-zoom-button",template:'<div class="igo-zoom-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomIn\' | translate: {zoom: zoom + 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    [disabled]="zoom >= maxZoom"\r\n    (click)="map.viewController.zoomIn()">\r\n    <mat-icon svgIcon="plus"></mat-icon>\r\n  </button>\r\n\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.zoomOut\' | translate: {zoom: zoom - 1}"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    [disabled]="zoom <= minZoom"\r\n    (click)="map.viewController.zoomOut()">\r\n    <mat-icon svgIcon="minus"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-zoom-button-container{width:40px}.igo-zoom-button-container button{background-color:#fff}.igo-zoom-button-container button:hover{background-color:#efefef}.igo-zoom-button-container button:first-child{margin-bottom:2px}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],Mn.ctorParameters=function(){return[]},Mn.propDecorators={map:[{type:je.Input}],color:[{type:je.Input}]},Mn);function Mn(){}var Pn=(Object.defineProperty(kn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(kn.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),kn.decorators=[{type:je.Component,args:[{selector:"igo-geolocate-button",template:'<div class="igo-geolocate-button-container">\r\n  <button\r\n    mat-icon-button\r\n    [matTooltip]="\'igo.geo.mapButtons.geolocate\' | translate"\r\n    matTooltipPosition="left"\r\n    [color]="color"\r\n    (click)="map.geolocate()">\r\n    <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-geolocate-button-container{width:40px;background-color:#fff}.igo-geolocate-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],kn.ctorParameters=function(){return[]},kn.propDecorators={map:[{type:je.Input}],color:[{type:je.Input}]},kn);function kn(){}var Dn=(Object.defineProperty(jn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(jn.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(jn.prototype,"checked",{get:function(){return this.check},enumerable:!0,configurable:!0}),jn.prototype.onToggle=function(){this.check=!this.check,this.check?this.btnStyle="toggleStyle":this.btnStyle="baseStyle"},jn.decorators=[{type:je.Component,args:[{selector:"igo-offline-button",template:'<div *ngIf="visible" class="igo-user-button-container">\r\n  <div>\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="checked ? (\'igo.geo.mapButtons.online\' | translate): (\'igo.geo.mapButtons.offline\' | translate)"\r\n      matTooltipPosition="left"\r\n      [ngClass]="[btnStyle]"\r\n      [color]="checked ? color : [colorOff]"\r\n      (click)="onToggle()"\r\n      (click)="map.onOfflineToggle(check)">\r\n      <mat-icon svgIcon="wifi-strength-off"></mat-icon>\r\n    </button>\r\n  </div>\r\n</div>',styles:[".baseStyle{width:40px;background-color:#fff}.baseStyle:hover{background-color:#efefef}.toggleStyle{width:40px;background-color:#b9b9b9}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],jn.ctorParameters=function(){return[{type:Ae.ConfigService}]},jn.propDecorators={change:[{type:je.Output}],map:[{type:je.Input}],color:[{type:je.Input}],check:[{type:je.Input}]},jn);function jn(e){this.config=e,this.btnStyle="baseStyle",this.colorOff="rgb(255,255,255)",this.change=new je.EventEmitter,this.check=!1,this.visible=!1,this.visible=!!this.config.getConfig("offlineButton")}function En(){return R.trigger("baseLayerSwitcherState",[R.state("collapseIcon",R.style({height:"40px",width:"40px",overflow:"hidden"})),R.state("collapseMap",R.style({height:"85px",overflow:"hidden"})),R.state("expand",R.style({overflow:"hidden"})),R.transition("collapse => expand",R.animate("200ms")),R.transition("expand => collapse",R.animate("200ms"))])}var $n=(Object.defineProperty(Rn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Rn.prototype,"useStaticIcon",{get:function(){return this._useStaticIcon},set:function(e){this._useStaticIcon=e},enumerable:!0,configurable:!0}),Rn.prototype.ngAfterViewInit=function(){var t=this;this.layers$$=this.map.layers$.subscribe(function(e){t._baseLayers=e.filter(function(e){return e.baseLayer})})},Rn.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},Rn.prototype.collapseOrExpand=function(){1<this.baseLayers.length||this.useStaticIcon?this.expand=!this.expand:this.expand=!1},Object.defineProperty(Rn.prototype,"baseLayers",{get:function(){var t=this.map.viewController.getResolution(),r=this.map.viewController.getZoom(),e=this._baseLayers.filter(function(e){return(!e.options.maxResolution||t<=e.options.maxResolution)&&(!e.options.minResolution||t>=e.options.minResolution)&&(!e.options.source.options.maxZoom||r<=e.options.source.options.maxZoom)&&(!e.options.source.options.minZoom||r>=e.options.source.options.minZoom)}),o=e.filter(function(e){return!e.visible});return o.length+1===e.length?o:e},enumerable:!0,configurable:!0}),Rn.decorators=[{type:je.Component,args:[{selector:"igo-baselayers-switcher",template:'<div *ngIf="baseLayers.length > 0"\r\n     class="igo-baselayers-switcher-container"\r\n     [ngClass]="{\'container-expand\': expand}"\r\n     [@baseLayerSwitcherState]="expand ? \'expand\' : useStaticIcon ? \'collapseIcon\' : \'collapseMap\'"\r\n     (@baseLayerSwitcherState.start)="showButton=false"\r\n     (@baseLayerSwitcherState.done)="showButton=true"\r\n     (click)="collapseOrExpand()">\r\n\r\n     <div *ngIf="useStaticIcon && !expand && showButton" class="igo-baselayers-switcher-button-container">\r\n       <button\r\n         mat-icon-button\r\n         [matTooltip]="\'igo.geo.mapButtons.baselayerSwitcher\' | translate"\r\n         matTooltipPosition="right"\r\n         color="primary">\r\n         <mat-icon svgIcon="image-multiple"></mat-icon>\r\n       </button>\r\n     </div>\r\n\r\n     <igo-mini-basemap *ngFor="let baseLayer of baseLayers; let i = index"\r\n       [map]="map"\r\n       [baseLayer]="baseLayer"\r\n       [title]="(baseLayers.length > 2 && !expand) ? (\'igo.geo.baselayersSwitcher.title\' | translate) : baseLayer.title"\r\n       [display]="expand || (i === 0 && !useStaticIcon)"\r\n       [disabled]="!expand && baseLayers.length > 1">\r\n     </igo-mini-basemap>\r\n\r\n    <div class="more-baselayers">\r\n      <mat-icon class="material-icons mat-icon mat-list-avatar" color="primary" svgIcon="menu-down"></mat-icon>\r\n    </div>\r\n\r\n</div>\r\n',animations:[En()],styles:[".igo-baselayers-switcher-container{height:auto;position:relative}.container-expand{overflow:hidden;border-width:0}.more-baselayers{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers:hover{background-color:#efefef}.igo-baselayers-switcher-button-container{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}"]}]}],Rn.ctorParameters=function(){return[{type:Ae.MediaService}]},Rn.propDecorators={map:[{type:je.Input}],useStaticIcon:[{type:je.Input}]},Rn);function Rn(e){this.mediaService=e,this._baseLayers=[],this.expand=!1,this.showButton=!0,this.mediaService.media$.value===Ae.Media.Mobile&&this.useStaticIcon===undefined&&(this.useStaticIcon=!0)}var An=(Object.defineProperty(Bn.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e,this.handleMoveEnd()},enumerable:!0,configurable:!0}),Object.defineProperty(Bn.prototype,"baseLayer",{get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this.handleBaseLayerChanged(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Bn.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Bn.prototype,"display",{get:function(){return this._display},set:function(e){this._display=e},enumerable:!0,configurable:!0}),Bn.prototype.ngAfterViewInit=function(){var e=this;this.map.ol.on("moveend",function(){return e.handleMoveEnd()}),this.handleMoveEnd()},Bn.prototype.ngOnDestroy=function(){var e=this;this.map.ol.un("moveend",function(){return e.handleMoveEnd()})},Bn.prototype.changeBaseLayer=function(e){this.disabled||(this.map.changeBaseLayer(e),this.appRef.tick())},Bn.prototype.handleMoveEnd=function(){this.basemap.ol.setView(this.map.ol.getView())},Bn.prototype.handleBaseLayerChanged=function(e){this.basemap.removeAllLayers();var t=Object.assign(Object.create(e.options),e.options,{visible:!0,baseLayer:!1}),r=this.layerService.createLayer(t);this.basemap.addLayer(r)},Bn.decorators=[{type:je.Component,args:[{selector:"igo-mini-basemap",template:'<div class="igo-mini-basemap-container">\r\n\r\n  <div *ngIf="display" (click)="changeBaseLayer(baseLayer)">\r\n    <igo-map-browser [map]="basemap"></igo-map-browser>\r\n    <div *ngIf=\'title\' class=\'igo-mini-basemap-title\'> {{title}} </div>\r\n  </div>\r\n\r\n</div>\r\n',styles:[".igo-mini-basemap-container{width:calc(40px * 2);height:calc(40px * 2);background-color:rgba(255,255,255,.01);border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.3);cursor:pointer;margin-top:5px}.igo-mini-basemap-container:hover .igo-mini-basemap-title{color:#000;text-shadow:0 0 5px #fff}.igo-mini-basemap-container>div{width:100%;height:100%}.igo-mini-basemap-title{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px #000;white-space:normal;display:-webkit-box;display:flex;-webkit-box-align:end;align-items:flex-end;-webkit-box-pack:center;justify-content:center}"]}]}],Bn.ctorParameters=function(){return[{type:ei},{type:je.ApplicationRef}]},Bn.propDecorators={map:[{type:je.Input}],baseLayer:[{type:je.Input}],disabled:[{type:je.Input}],display:[{type:je.Input}],title:[{type:je.Input}]},Bn);function Bn(e,t){this.layerService=e,this.appRef=t,this.basemap=new vn({controls:{},interactions:!1})}var Gn=(Object.defineProperty(_n.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(_n.prototype,"showIfNoRotation",{get:function(){return this._showIfNoRotation},set:function(e){this._showIfNoRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(_n.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(_n.prototype,"rotated",{get:function(){return 0!==this.map.viewController.getRotation()},enumerable:!0,configurable:!0}),_n.prototype.rotationStyle=function(e){return{transform:"rotate("+e+"rad)"}},_n.decorators=[{type:je.Component,args:[{selector:"igo-rotation-button",template:'<div *ngIf="rotated && !showIfNoRotation" class="igo-rotation-button-container"\r\n  [matTooltip]="rotated ? (\'igo.geo.mapButtons.resetRotation\' | translate): (\'igo.geo.mapButtons.tipRotation\' | translate)"\r\n  matTooltipPosition="left">\r\n  <button mat-icon-button matTooltipPosition="left" [color]="color" [disabled]="!rotated"\r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>\r\n\r\n<div *ngIf="showIfNoRotation" class="igo-rotation-button-container"\r\n  [matTooltip]="rotated ? (\'igo.geo.mapButtons.resetRotation\' | translate): (\'igo.geo.mapButtons.tipRotation\' | translate)"\r\n  matTooltipPosition="left">\r\n  <button mat-icon-button matTooltipPosition="left" [color]="color" [disabled]="!rotated"\r\n    (click)="map.viewController.resetRotation()">\r\n    <mat-icon [ngStyle]="rotationStyle(map.viewController.getRotation())" svgIcon="navigation">\r\n    </mat-icon>\r\n  </button>\r\n</div>',styles:[".igo-rotation-button-container{width:40px;background-color:#fff}.igo-rotation-button-container:hover{background-color:#efefef}:host>>>button .mat-button-ripple-round,button{border-radius:0}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){:host>>>button .mat-button-ripple-round:disabled,button:disabled{display:none}}"]}]}],_n.ctorParameters=function(){return[]},_n.propDecorators={map:[{type:je.Input}],showIfNoRotation:[{type:je.Input}],color:[{type:je.Input}]},_n);function _n(){}var qn=(Nn._convertPointToPixel=function(e){return e/.75},Nn._transformColor=function(e){return[e[0],e[1],e[2],e[3]/255]},Nn._getResolutionForScale=function(e,t){var r=Se.METERS_PER_UNIT[t];return parseFloat(e)/(39.3701*r*96)},Nn._convertEsriTS=function(e){var t=Nn._transformAngle(e.angle),r=e.text!==undefined?e.text:undefined;return new we.Style({text:new we.Text({fill:new we.Fill({color:Nn._transformColor(e.color)}),font:e.font.style+" "+e.font.weight+" "+e.font.size+" px "+e.font.family,textBaseline:e.verticalAlignment,textAlign:e.horizontalAlignment,offsetX:Nn._convertPointToPixel(e.xoffset),offsetY:Nn._convertPointToPixel(e.yoffset),rotation:t,text:r})})},Nn._convertEsriPMS=function(e){var t="data:"+e.contentType+";base64, "+e.imageData,r=Nn._transformAngle(e.angle);return new we.Style({image:new we.Icon({src:t,rotation:r})})},Nn._convertEsriSFS=function(e){var t=new we.Fill({color:Nn._transformColor(e.color)}),r=e.outline?Nn._convertOutline(e.outline):undefined;return new we.Style({fill:t,stroke:r})},Nn._convertOutline=function(e){var t,r=Nn._transformColor(e.color);return"esriSLSDash"===e.style?t=[5]:"esriSLSDashDot"===e.style?t=[5,5,1,2]:"esriSLSDashDotDot"===e.style?t=[5,5,1,2,1,2]:"esriSLSDot"===e.style?t=[1,2]:"esriSLSNull"===e.style&&(r[3]=0),new we.Stroke({color:r,lineDash:t,width:Nn._convertPointToPixel(e.width)})},Nn._convertEsriSLS=function(e){return new we.Style({stroke:Nn._convertOutline(e)})},Nn._transformAngle=function(e){if(0===e||e===undefined)return undefined;var t=-e*Math.PI/180+Math.PI/2;return t<0?2*Math.PI+t:t},Nn._convertEsriSMS=function(e){var t=new we.Fill({color:Nn._transformColor(e.color)}),r=e.outline?Nn._convertOutline(e.outline):undefined,o=Nn._convertPointToPixel(e.size)/2,n=Nn._transformAngle(e.angle);return"esriSMSCircle"===e.style?new we.Style({image:new we.Circle({radius:o,fill:t,stroke:r})}):"esriSMSCross"===e.style?new we.Style({image:new we.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:0,rotation:n})}):"esriSMSDiamond"===e.style?new we.Style({image:new we.RegularShape({fill:t,stroke:r,points:4,radius:o,rotation:n})}):"esriSMSSquare"===e.style?new we.Style({image:new we.RegularShape({fill:t,stroke:r,points:4,radius:o,angle:Math.PI/4,rotation:n})}):"esriSMSX"===e.style?new we.Style({image:new we.RegularShape({fill:t,stroke:r,points:4,radius:o,radius2:0,angle:Math.PI/4,rotation:n})}):"esriSMSTriangle"===e.style?new we.Style({image:new we.RegularShape({fill:t,stroke:r,points:3,radius:o,angle:0,rotation:n})}):void 0},Nn.prototype._convertLabelingInfo=function(e,t){for(var r=[],o=0,n=e.length;o<n;++o){var i=e[o].labelExpression,a=i.substr(i.indexOf("[")+1,i.indexOf("]")-1),s=e[o].symbol,l=e[o].maxScale,u=e[o].minScale,c=null;0!==l&&(c=Nn._getResolutionForScale(l,t));var p=null;0!==u&&(p=Nn._getResolutionForScale(u,t));var d=this._converters[s.type].call(this,s);r.push(function(e,t){var r=!0;if(null!==this.minResolution&&null!==this.maxResolution?r=t<this.maxResolution&&t>=this.minResolution:null!==this.minResolution?r=t>=this.minResolution:null!==this.maxResolution&&(r=t<this.maxResolution),r){var o=e.get(this.field);return this.style.getText().setText(o),[this.style]}}.bind({minResolution:c,maxResolution:p,field:a,style:d}))}return r},Nn.prototype._renderSimple=function(e){var t=this._converters[e.symbol.type].call(this,e.symbol);return function(){return[t]}},Nn.prototype._renderClassBreaks=function(e){for(var t=e.defaultSymbol,n=this._converters[t.type].call(this,t),i=e.field,a=[],r=0,o=e.classBreakInfos.length;r<o;++r){var s=e.classBreakInfos[r],l=void 0;l=null===s.classMinValue||s.classMinValue===undefined?0===r?e.minValue:e.classBreakInfos[r-1].classMaxValue:s.classMinValue;var u=s.classMaxValue,c=s.symbol,p=this._converters[c.type].call(this,c);a.push({min:l,max:u,style:p})}return function(e){for(var t=e.get(i),r=0,o=a.length;r<o;++r)if(0===r?t>=a[r].min&&t<=a[r].max:t>a[r].min&&t<=a[r].max)return[a[r].style];return[n]}},Nn.prototype._renderUniqueValue=function(e){var t=e.defaultSymbol,i=[];t&&(i=[this._converters[t.type].call(this,t)]);var a=e.field1,s=e.uniqueValueInfos,l=this;return function(){for(var r={},e=0,t=s.length;e<t;++e){var o=s[e],n=o.symbol;r[o.value]=[l._converters[n.type].call(l,n)]}return function(e){var t=r[e.get(a)];return t||i}}()},Nn.prototype.generateStyle=function(e,t){var r=e.drawingInfo,a=[],o=this._renderers[r.renderer.type].call(this,r.renderer);if(o!==undefined&&a.push(o),e.labelingInfo){var n=this._convertLabelingInfo(e.labelingInfo,t);a=a.concat(n)}return 1===a.length?a[0]:function(e,t){for(var r=[],o=0,n=a.length;o<n;++o){var i=a[o].call(null,e,t);i&&(r=r.concat(i))}return r}},Nn);function Nn(){this._converters={},this._converters.esriPMS=Nn._convertEsriPMS,this._converters.esriSFS=Nn._convertEsriSFS,this._converters.esriSLS=Nn._convertEsriSLS,this._converters.esriSMS=Nn._convertEsriSMS,this._converters.esriTS=Nn._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}var Vn={DATE:"date",TIME:"time",DATETIME:"datetime",YEAR:"year"},Un={CALENDAR:"calendar",SLIDER:"slider"},Wn={wms:"wms",wmts:"wmts"},zn=(Kn.prototype.getWMSOptions=function(t){var r=this,e=t.url,o=t.params.VERSION;return this.getCapabilities("wms",e,o).pipe(Pe.map(function(e){return e?r.parseWMSOptions(t,e):undefined}))},Kn.prototype.getWMTSOptions=function(t){var r=this,e=t.url,o=t.version;return this.getCapabilities("wmts",e,o).pipe(Pe.map(function(e){return e?r.parseWMTSOptions(t,e):undefined}))},Kn.prototype.getCartoOptions=function(t){var r=this,e="https://"+t.account+".carto.com/api/v2/viz/"+t.mapId+"/viz.json";return this.http.jsonp(e,"callback").pipe(Pe.map(function(e){return r.parseCartoOptions(t,e)}))},Kn.prototype.getArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url.replace("FeatureServer","MapServer")+"/legend?f=json",n=this.http.get(e),i=this.http.get(o).pipe(Pe.map(function(e){return e}),Pe.catchError(function(e){return console.log("No legend associated with this Feature Service"),Le.of(e)}));return Le.forkJoin([n,i]).pipe(Pe.map(function(e){return r.parseArcgisOptions(t,e[0],e[1])}))},Kn.prototype.getTileArcgisOptions=function(t){var r=this,e=t.url+"/"+t.layer+"?f=json",o=t.url+"/legend?f=json",n=this.http.get(e),i=this.http.get(o);return Le.forkJoin([n,i]).pipe(Pe.map(function(e){return r.parseTileArcgisOptions(t,e[0],e[1])}))},Kn.prototype.getCapabilities=function(r,e,t){var o=this,n=new Me.HttpParams({fromObject:{request:"GetCapabilities",service:r.toUpperCase(),version:t||"1.3.0",_i:"true"}});return this.http.get(e,{params:n,responseType:"text"}).pipe(Pe.map(function(e){try{return o.parsers[r].read(e)}catch(t){return undefined}}),Pe.catchError(function(e){throw e.error.caught=!0,e}))},Kn.prototype.parseWMSOptions=function(e,r){var t,o,n=e.params.LAYERS,i=this.findDataSourceInCapabilities(r.Capability.Layer,n);if(!i)throw{error:{message:"Layer not found"}};var a,s=i.DataURL?i.DataURL[0]:undefined,l=i.Abstract?i.Abstract:undefined,u=i.KeywordList?i.KeywordList:undefined,c=i.queryable,p=this.getTimeFilter(i),d=p&&0<Object.keys(p).length,h=i.Style?this.getStyle(i.Style):undefined,g=[At.GEOJSON,At.GEOJSON2,At.GML3,At.GML2,At.JSON,At.HTML],f=function(t){if(-1!==r.Capability.Request.GetFeatureInfo.Format.indexOf(t)){var e=Object.keys(At).find(function(e){return At[e]===t});return a=Rt[e],"break"}};try{for(var m=Qe(g),y=m.next();!y.done&&"break"!==f(y.value);y=m.next());}catch(b){t={error:b}}finally{try{y&&!y.done&&(o=m["return"])&&o.call(m)}finally{if(t)throw t.error}}a||(c=!1);var v=ke.ObjectUtils.removeUndefined({_layerOptionsFromSource:{title:i.Title,maxResolution:mr(i.MaxScaleDenominator),minResolution:mr(i.MinScaleDenominator),metadata:{url:s?s.OnlineResource:undefined,extern:!!s||undefined,"abstract":l,keywordList:u},legendOptions:h},queryable:c,queryFormat:a,timeFilter:d?p:undefined,timeFilterable:!!d||undefined});return ke.ObjectUtils.mergeDeep(v,e)},Kn.prototype.parseWMTSOptions=function(t,e){var r=e.Contents.Layer.find(function(e){return e.Identifier===t.layer}),o=S.optionsFromCapabilities(e,t),n=Object.assign(o,t),i=ke.ObjectUtils.removeUndefined({_layerOptionsFromSource:{title:r.Title}});return ke.ObjectUtils.mergeDeep(i,n)},Kn.prototype.parseCartoOptions=function(e,t){var r=[],o=t.layers[1].options.layer_definition;o.layers.forEach(function(e){r.push({type:e.type.toLowerCase(),options:e.options,legend:e.legend})});var n=ke.ObjectUtils.removeUndefined({config:{version:o.version,layers:r}});return ke.ObjectUtils.mergeDeep(n,e)},Kn.prototype.parseArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new qn,s="esriMeters"===t.units?"m":"degrees",l=a.generateStyle(t,s),u=new F({html:t.copyrightText});if(t.timeInfo){var c=t.timeInfo.timeExtent;o=c[0]+","+c[1];var p=new Date;p.setTime(c[0]);var d=new Date;d.setTime(c[1]),n={min:p.toUTCString(),max:d.toUTCString(),range:!0,type:Vn.DATETIME,style:Un.CALENDAR}}var h=Object.assign({},{legendInfo:i,style:l,timeFilter:n,timeExtent:o,attributions:u}),g=ke.ObjectUtils.removeUndefined({params:h});return ke.ObjectUtils.mergeDeep(g,e)},Kn.prototype.parseTileArcgisOptions=function(e,t,r){var o,n,i=r.layers?r:undefined,a=new F({html:t.copyrightText});if(t.timeInfo){var s=t.timeInfo.timeExtent;o=s[0]+","+s[1];var l=new Date;l.setTime(s[0]);var u=new Date;u.setTime(s[1]),n={min:l.toUTCString(),max:u.toUTCString(),range:!0,type:Vn.DATETIME,style:Un.CALENDAR}}var c=Object.assign({},{layers:"show:"+e.layer,time:o}),p=ke.ObjectUtils.removeUndefined({params:c,legendInfo:i,timeFilter:n,attributions:a});return ke.ObjectUtils.mergeDeep(p,e)},Kn.prototype.findDataSourceInCapabilities=function(e,t){var r,o=this;return Array.isArray(e)?(e.find(function(e){return(r=o.findDataSourceInCapabilities(e,t))!==undefined},this),r):e.Layer?this.findDataSourceInCapabilities(e.Layer,t):e.Name&&e.Name===t?e:undefined},Kn.prototype.getTimeFilter=function(e){var t;if(e.Dimension){var r={};if((t=e.Dimension[0]).values){var o=t.values.split("/");r.min=o[0]!==undefined?o[0]:undefined,r.max=o[1]!==undefined?o[1]:undefined,r.step=o[2]!==undefined?o[2]:undefined}return t["default"]&&(r.value=t["default"]),r}},Kn.prototype.getStyle=function(e){return{stylesAvailable:e.map(function(e){return{name:e.Name,title:e.Title}}).filter(function(t,e,r){return r.findIndex(function(e){return e.name===t.name})===e})}},Kn.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Kn.ctorParameters=function(){return[{type:Me.HttpClient}]},Kn.ngInjectableDef=je.defineInjectable({factory:function(){return new Kn(je.inject(Me.HttpClient))},token:Kn,providedIn:"root"}),Ye([v.Cacheable({maxCacheCount:20}),Ze("design:type",Function),Ze("design:paramtypes",[String,String,String]),Ze("design:returntype",Le.Observable)],Kn.prototype,"getCapabilities",null),Kn);function Kn(e){this.http=e,this.parsers={wms:new De.WMSCapabilities,wmts:new De.WMTSCapabilities}}var Hn=function Vd(){},Yn=(Zn.prototype.createAsyncDataSource=function(e){if(!e.type)throw console.error(e),new Error("Datasource needs a type");var t;switch(e.type.toLowerCase()){case"osm":t=this.createOSMDataSource(e);break;case"vector":t=this.createFeatureDataSource(e);break;case"wfs":t=this.createWFSDataSource(e);break;case"wms":var r=e;ke.ObjectUtils.removeDuplicateCaseInsensitive(r.params),t=this.createWMSDataSource(r);break;case"wmts":t=this.createWMTSDataSource(e);break;case"xyz":t=this.createXYZDataSource(e);break;case"carto":t=this.createCartoDataSource(e);break;case"arcgisrest":t=this.createArcGISRestDataSource(e);break;case"websocket":t=this.createWebSocketDataSource(e);break;case"mvt":t=this.createMVTDataSource(e);break;case"tilearcgisrest":t=this.createTileArcGISRestDataSource(e);break;case"cluster":t=this.createClusterDataSource(e);break;default:throw console.error(e),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([t])),t},Zn.prototype.createOSMDataSource=function(t){return new Le.Observable(function(e){return e.next(new ht(t))})},Zn.prototype.createFeatureDataSource=function(t){return new Le.Observable(function(e){return e.next(new ct(t))})},Zn.prototype.createWebSocketDataSource=function(t){return new Le.Observable(function(e){return e.next(new tr(t))})},Zn.prototype.createWFSDataSource=function(t){var r=this;return new Le.Observable(function(e){return e.next(new Pt(t,r.wfsDataSourceService))})},Zn.prototype.createWMSDataSource=function(o){var n=this,e=[];return o.optionsFromCapabilities&&e.push(this.capabilitiesService.getWMSOptions(o).pipe(Pe.catchError(function(e){var t=n.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),r=n.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:o.params.LAYERS});throw n.messageService.error(r,t),e}))),this.optionsService&&!0===o.optionsFromApi&&e.push(this.optionsService.getWMSOptions(o).pipe(Pe.catchError(function(e){return e.error.toDisplay=!0,e.error.title=n.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),e.error.message=n.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),Le.of({})}))),e.push(Le.of(o)),Le.forkJoin(e).pipe(Pe.map(function(e){var t=e.reduce(function(e,t){return ke.ObjectUtils.mergeDeep(e,t)});return new Gt(t,n.wfsDataSourceService)}),Pe.catchError(function(){return Le.of(undefined)}))},Zn.prototype.createWMTSDataSource=function(r){var o=this;return r.optionsFromCapabilities?this.capabilitiesService.getWMTSOptions(r).pipe(Pe.map(function(e){return e?new Vt(e):undefined}),Pe.catchError(function(){var e=o.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),t=o.languageService.translate.instant("igo.geo.dataSource.unavailable",{value:r.layer});return o.messageService.error(t,e),Le.of(undefined)})):new Le.Observable(function(e){return e.next(new Vt(r))})},Zn.prototype.createXYZDataSource=function(t){return new Le.Observable(function(e){return e.next(new mt(t))})},Zn.prototype.createCartoDataSource=function(t){return t.mapId?this.capabilitiesService.getCartoOptions(t).pipe(Pe.map(function(e){return new zt(e)})):new Le.Observable(function(e){return e.next(new zt(t))})},Zn.prototype.createArcGISRestDataSource=function(e){return this.capabilitiesService.getArcgisOptions(e).pipe(Pe.map(function(e){return new Yt(e)}))},Zn.prototype.createTileArcGISRestDataSource=function(e){return this.capabilitiesService.getTileArcgisOptions(e).pipe(Pe.map(function(e){return new Jt(e)}))},Zn.prototype.createMVTDataSource=function(t){return new Le.Observable(function(e){return e.next(new nr(t))})},Zn.prototype.createClusterDataSource=function(t){return new Le.Observable(function(e){return e.next(new sr(t))})},Zn.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Zn.ctorParameters=function(){return[{type:zn},{type:Hn,decorators:[{type:je.Optional}]},{type:jt},{type:Ae.LanguageService},{type:Ae.MessageService},{type:Cn}]},Zn.ngInjectableDef=je.defineInjectable({factory:function(){return new Zn(je.inject(zn),je.inject(Hn,8),je.inject(jt),je.inject(Ae.LanguageService),je.inject(Ae.MessageService),je.inject(Cn))},token:Zn,providedIn:"root"}),Zn);function Zn(e,t,r,o,n,i){this.capabilitiesService=e,this.optionsService=t,this.wfsDataSourceService=r,this.languageService=o,this.messageService=n,this.projectionService=i,this.datasources$=new Le.BehaviorSubject([])}var Qn,Jn=(Ke(Xn,Qn=Hn),Xn.prototype.getWMSOptions=function(e){if(!this.urlApi)return Le.of({});var t=new Me.HttpParams({fromObject:{type:e.type,url:e.url,layers:e.params.LAYERS}});return this.http.get(this.urlApi,{params:t}).pipe(Pe.map(function(e){return e&&e.sourceOptions?(e.sourceOptions._layerOptionsFromSource=e.layerOptions,e.sourceOptions):{}}))},Xn.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Xn.ctorParameters=function(){return[{type:Me.HttpClient},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]}]},Xn.ngInjectableDef=je.defineInjectable({factory:function(){return new Xn(je.inject(Me.HttpClient),je.inject("options"))},token:Xn,providedIn:"root"}),Xn);function Xn(e,t){void 0===t&&(t={});var r=Qn.call(this)||this;return r.http=e,r.urlApi=t.url||r.urlApi,r}var ei=(ti.prototype.createLayer=function(e){if(e.source){var t;switch(e.source.options&&e.source.options._layerOptionsFromSource&&(e=ke.ObjectUtils.mergeDeep(e.source.options._layerOptionsFromSource,e||{})),e.source.constructor){case ht:case Vt:case mt:case zt:case Jt:t=this.createTileLayer(e);break;case ct:case Pt:case Yt:case tr:case sr:t=this.createVectorLayer(e);break;case Gt:t=this.createImageLayer(e);break;case nr:t=this.createVectorTileLayer(e)}return t}},ti.prototype.createAsyncLayer=function(t){var r=this;return t.source?new Le.Observable(function(e){return e.next(r.createLayer(t))}):this.dataSourceService.createAsyncDataSource(t.sourceOptions).pipe(Pe.map(function(e){return e===undefined?undefined:r.createLayer(Object.assign(t,{source:e}))}))},ti.prototype.createImageLayer=function(e){return new Ar(e,this.authInterceptor)},ti.prototype.createTileLayer=function(e){return new _r(e)},ti.prototype.createVectorLayer=function(t){var e,r;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.source instanceof Yt)e=t.source.options.params.style;else if(t.styleByAttribute){var o=this.styleService;t.style=function(e){return o.createStyleByAttribute(e,t.styleByAttribute)},r=new Vr(t)}if(t.source instanceof sr){var n=this.styleService,i=t.clusterBaseStyle;t.style=function(e){return n.createClusterStyle(e,t.clusterParam,i)},r=new Vr(t)}var a=Object.assign({},t,{style:e});return r=r||new Vr(a),this.applyMapboxStyle(r,a),r},ti.prototype.createVectorTileLayer=function(t){var e,r;if(t.style!==undefined&&(e=this.styleService.createStyle(t.style)),t.styleByAttribute){var o=this.styleService;t.style=function(e){return o.createStyleByAttribute(e,t.styleByAttribute)},r=new zr(t)}var n=Object.assign({},t,{style:e});return r=r||new zr(n),this.applyMapboxStyle(r,n),r},ti.prototype.applyMapboxStyle=function(t,r){r.mapboxStyle&&this.getMapboxGlStyle(r.mapboxStyle.url).subscribe(function(e){o(t.ol,e,r.mapboxStyle.source)})},ti.prototype.getMapboxGlStyle=function(e){return this.http.get(e).pipe(Pe.map(function(e){return e}),Pe.catchError(function(e){return console.log("No style was found"),Le.of(e)}))},ti.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],ti.ctorParameters=function(){return[{type:Me.HttpClient},{type:no},{type:Yn},{type:me.AuthInterceptor,decorators:[{type:je.Optional}]}]},ti.ngInjectableDef=je.defineInjectable({factory:function(){return new ti(je.inject(Me.HttpClient),je.inject(no),je.inject(Yn),je.inject(me.AuthInterceptor,8))},token:ti,providedIn:"root"}),ti);function ti(e,t,r,o){this.http=e,this.styleService=t,this.dataSourceService=r,this.authInterceptor=o}var ri={Layer:"layer",Group:"group"},oi={wms:0,wmts:1,baselayers:2,composite:3};oi[oi.wms]="wms",oi[oi.wmts]="wmts",oi[oi.baselayers]="baselayers",oi[oi.composite]="composite";var ni,ii=function Ud(e,t){Object.assign(this,e),this.catalogService=t},ai=(Ke(si,ni=ii),si.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogWMSLayerItems(this)},si);function si(e,t){var r=ni.call(this,e,t)||this,o=oi[oi.wms];return r.type=oi[o],r}var li,ui=(Ke(ci,li=ii),ci.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogWMTSLayerItems(this)},ci);function ci(e,t){var r=li.call(this,e,t)||this,o=oi[oi.wmts];return r.type=oi[o],r}var pi,di=(Ke(hi,pi=ii),hi.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogBaseLayerItems(this)},hi);function hi(e,t){var r=pi.call(this,e,t)||this,o=oi[oi.baselayers];return r.type=oi[o],r}var gi,fi=(Ke(mi,gi=ii),mi.prototype.collectCatalogItems=function(){return this.catalogService.loadCatalogCompositeLayerItems(this)},mi);function mi(e,t){var r=gi.call(this,e,t)||this,o=oi[oi.composite];return r.type=oi[o],r.url=null,r}var yi=(vi.createInstanceCatalog=function(e,t){return e.hasOwnProperty("composite")?new fi(e,t):e.type===oi[oi.baselayers]?new di(e,t):e.type===oi[oi.wmts]?new ui(e,t):new ai(e,t)},vi);function vi(){}var bi=(Si.prototype.query=function(e,t){var r=this;return e.filter(function(e){return e.visible&&e.isInResolutionsRange}).map(function(e){return r.queryLayer(e,t)})},Si.prototype.queryLayer=function(r,o){var n=this,i=this.getQueryUrl(r.dataSource,o);if(!i)return Le.of([]);if(r.dataSource.options.queryFormat!==Rt.HTMLGML2)return this.http.get(i,{responseType:"text"}).pipe(Pe.map(function(e){return n.extractData(e,r,o,i)}));var e=this.getQueryUrl(r.dataSource,o,!0);return this.http.get(e,{responseType:"text"}).pipe(Pe.mergeMap(function(e){var t=n.mergeGML(e,i);return n.http.get(i,{responseType:"text"}).pipe(Pe.map(function(e){return n.extractData(e,r,o,i,t)}))}))},Si.prototype.mergeGML=function(e,t){var r=new A,o=r.readFeatures(e);0===o.length&&(o=(r=new De.WMSGetFeatureInfo).readFeatures(e));var n,i,a,s=new Ie.MultiLineString([]),l=[],u=new Ie.MultiPolygon([]),c=o.length,p=this.getQueryParams(t.toLowerCase()).bbox.split(","),d=z.createEmpty();switch(z.extend(d,p),o.map(function(e){var t=e.getGeometry().getCoordinates(),r=e.getGeometry().getType();switch(i=i||r,r){case"Point":1===c?n=new Ie.Point(t,"XY"):l.push(t);break;case"LineString":s.appendLineString(new Ie.LineString(t,"XY"));break;case"Polygon":u.appendPolygon(new Ie.Polygon(t,"XY"));break;case"MultiPolygon":u=new Ie.MultiPolygon(t,"XY");break;default:return}}),a=0===l.length&&n?{type:n.getType(),coordinates:n.getCoordinates()}:{type:"Polygon",coordinates:[this.convexHull(l)]},i){case"LineString":return{type:s.getType(),coordinates:s.getCoordinates()};case"Point":return a;case"Polygon":case"MultiPolygon":return{type:u.getType(),coordinates:u.getCoordinates()};default:return}},Si.prototype.cross=function(e,t,r){return(e[0]-r[0])*(t[1]-r[1])-(e[1]-r[1])*(t[0]-r[0])},Si.prototype.convexHull=function(e){var t,r;e.sort(function(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]});var o=[];try{for(var n=Qe(e),i=n.next();!i.done;i=n.next()){for(var a=i.value;2<=o.length&&this.cross(o[o.length-2],o[o.length-1],a)<=0;)o.pop();o.push(a)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}for(var s=[],l=e.length-1;0<=l;l--){for(;2<=s.length&&this.cross(s[s.length-2],s[s.length-1],e[l])<=0;)s.pop();s.push(e[l])}return s.pop(),o.pop(),o.concat(s)},Si.prototype.extractData=function(e,s,l,t,r){var o,n,u=this,c=s.dataSource,i=this.getAllowedFieldsAndAlias(s),p=[];switch(c.options.queryFormat){case Rt.GML3:p=this.extractGML3Data(e,s.zIndex,i);break;case Rt.JSON:case Rt.GEOJSON:case Rt.GEOJSON2:p=this.extractGeoJSONData(e);break;case Rt.ESRIJSON:p=this.extractEsriJSONData(e,s.zIndex);break;case Rt.TEXT:p=this.extractTextData(e);break;case Rt.HTML:p=this.extractHtmlData(e,c.queryHtmlTarget,t);break;case Rt.HTMLGML2:p=this.extractHtmlData(e,c.queryHtmlTarget,t,r);break;case Rt.GML2:default:p=this.extractGML2Data(e,s,i)}if(0<p.length&&null==p[0].geometry){var a=this.createGeometryFromUrlClick(t);try{for(var d=Qe(p),h=d.next();!h.done;h=d.next())h.value.geometry=a}catch(g){o={error:g}}finally{try{h&&!h.done&&(n=d["return"])&&n.call(d)}finally{if(o)throw o.error}}}return p.map(function(e,t){var r,o=e.properties[c.mapLabel];if("wms"===s.options.sourceOptions.type){var n=s.options.sourceOptions;r=n?n.excludeAttribute:undefined}var i=u.getQueryTitle(e,s);i=!i&&1<p.length?s.title+" ("+(t+1)+")":i||s.title;var a=Object.assign({},e.meta||{},{id:ke.uuid(),title:i,mapTitle:o,sourceTitle:s.title,order:1e3-s.zIndex,excludeAttribute:r});return Object.assign(e,{meta:a,projection:"carto"===c.options.type?"EPSG:4326":l.projection})})},Si.prototype.createGeometryFromUrlClick=function(e){var t=this.getQueryParams(e.toLowerCase()),r=t.bbox,o=parseInt(t.width,10),n=parseInt(t.height,10),i=parseInt(t.i||t.x,10),a=parseInt(t.j||t.y,10),s=(t.crs||t.srs,r.split(",")),l=.05*(Math.abs(parseFloat(s[0]))-Math.abs(parseFloat(s[2])));Math.abs(parseFloat(s[0]))<180&&(l=.045);var u=parseFloat(s[0])+Math.abs(parseFloat(s[0])-parseFloat(s[2]))*i/o-l,c=parseFloat(s[1])+Math.abs(parseFloat(s[1])-parseFloat(s[3]))*a/n-l,p=u+2*l,d=c+2*l,h="POLYGON(("+u+" "+c+", "+u+" "+d+", "+p+" "+d+", "+p+" "+c+", "+u+" "+c+"))",g=(new De.WKT).readFeature(h).getGeometry();return{type:g.getType(),coordinates:g.getCoordinates()}},Si.prototype.extractGML2Data=function(e,t,r){var o=this,n=new A,i=n.readFeatures(e);if(0===i.length){n=new De.WMSGetFeatureInfo;try{i=n.readFeatures(e)}catch(a){console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return i.map(function(e){return o.featureToResult(e,t,r)})},Si.prototype.extractGML3Data=function(e,t,r){var o=this,n=new B,i=[];try{i=n.readFeatures(e)}catch(a){console.warn("query.service: GML3 is not well supported")}return i.map(function(e){return o.featureToResult(e,t,r)})},Si.prototype.extractGeoJSONData=function(e){var t=[];try{t=JSON.parse(e).features}catch(r){console.warn("query.service: Unable to parse geojson","\n",e)}return t},Si.prototype.extractEsriJSONData=function(e,t){var r=this;return(new G).readFeatures(e).map(function(e){return r.featureToResult(e,t)})},Si.prototype.extractTextData=function(e){return[]},Si.prototype.extractHtmlData=function(e,t,r,o){var n=this.getQueryParams(r.toLowerCase()),i=n.crs||n.srs||"EPSG:3857",a=this.createGeometryFromUrlClick(r);t!==Bt.BLANK&&t!==Bt.IFRAME&&(t=Bt.IFRAME);var s=e.toLowerCase().indexOf("<body>"),l=e.toLowerCase().lastIndexOf("</body>")+7;return"<body></body>"===e.slice(s,l).replace(/(\r|\n|\s)/g,"")||""===e?[]:[{type:ur,projection:i,properties:{target:t,body:e,url:r},geometry:o||a}]},Si.prototype.getQueryParams=function(e){var t=e.split("?");if(t[1]){var r=t[1].split("&"),o={};return r.forEach(function(e){e=e.split("="),o[e[0]]=decodeURIComponent(e[1]||"")}),o}},Si.prototype.featureToResult=function(e,t,r){var o,n=e.getGeometry(),i=Object.assign({},e.getProperties());return delete i.geometry,delete i.boundedBy,delete i.shape,delete i.SHAPE,delete i.the_geom,n!==undefined&&(o={type:n.getType(),coordinates:n.getCoordinates()}),{type:ur,projection:undefined,properties:i,geometry:o,meta:{id:ke.uuid(),order:1e3-t,alias:r}}},Si.prototype.getQueryUrl=function(e,t,r){var o;switch(void 0===r&&(r=!1),e.constructor){case Gt:var n=e,i={INFO_FORMAT:n.params.INFO_FORMAT||this.getMimeInfoFormat(e.options.queryFormat),QUERY_LAYERS:n.params.LAYERS,FEATURE_COUNT:n.params.FEATURE_COUNT||"5"};r&&(i.INFO_FORMAT=this.getMimeInfoFormat(Rt.GML2)),o=n.ol.getGetFeatureInfoUrl(t.coordinates,t.resolution,t.projection,i);break;case zt:var a=e,s="https://"+a.options.account+".carto.com/api/v2/sql?",l="&q="+a.options.config.layers[0].options.sql,u=a.options.queryPrecision?a.options.queryPrecision:"1000";o=s+"format=GeoJSON"+l+" WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT("+t.coordinates[0]+","+t.coordinates[1]+"),3857),"+u+"))";break;case Jt:var c=e,p=z.boundingExtent([t.coordinates]);c.options.queryPrecision&&(p=z.buffer(p,c.options.queryPrecision)),o=c.options.url+"/"+c.options.layer+"/query/?"+["f=json","geometry="+encodeURIComponent('{"xmin":'+p[0]+',"ymin":'+p[1]+',"xmax":'+p[2]+',"ymax":'+p[3]+',"spatialReference":{"wkid":102100}}'),"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"].join("&")}return o},Si.prototype.getMimeInfoFormat=function(t){var e="application/vnd.ogc.gml",r=Object.keys(Rt).find(function(e){return Rt[e]===t});return r&&(e=At[r]),e},Si.prototype.getAllowedFieldsAndAlias=function(e){var r;return e.options&&e.options.source&&e.options.source.options&&e.options.source.options.sourceFields&&1<=e.options.source.options.sourceFields.length&&(r={},e.options.source.options.sourceFields.forEach(function(e){var t=e.alias?e.alias:e.name;r[e.name]=t})),r},Si.prototype.getQueryTitle=function(e,t){var r;if(t.options&&t.options.source&&t.options.source.options){var o=t.options.source.options;o.queryTitle&&(r=this.getLabelMatch(e,o.queryTitle))}return r},Si.prototype.getLabelMatch=function(t,e){var r=e,o=Array.from(e.matchAll(/\$\{([^\{\}]+)\}/g));return o.forEach(function(e){r=r.replace(e[0],t.properties[e[1]])}),0===o.length&&r===e&&(r=t.properties[e]||e),r},Si.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Si.ctorParameters=function(){return[{type:Me.HttpClient}]},Si.ngInjectableDef=je.defineInjectable({factory:function(){return new Si(je.inject(Me.HttpClient))},token:Si,providedIn:"root"}),Si);function Si(e){this.http=e,this.queryEnabled=!0}var wi=(Object.defineProperty(Ii.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Ii.prototype.ngAfterViewInit=function(){this.listenToMapClick()},Ii.prototype.ngOnDestroy=function(){this.cancelOngoingQueries(),this.unlistenToMapClick()},Ii.prototype.listenToMapClick=function(){var t=this;this.mapClickListener=this.map.ol.on("singleclick",function(e){return t.onMapEvent(e)})},Ii.prototype.unlistenToMapClick=function(){this.map.ol.un(this.mapClickListener.type,this.mapClickListener.listener),this.mapClickListener=undefined},Ii.prototype.onMapEvent=function(r){var o=this;if(this.cancelOngoingQueries(),this.queryService.queryEnabled){var e=[];this.queryFeatures&&e.push(this.doQueryFeatures(r));var t=this.map.ol.getView().getResolution(),n=this.map.layers.filter(ao);e.push.apply(e,Xe(this.queryService.query(n,{coordinates:r.coordinate,projection:this.map.projection,resolution:t}))),0!==e.length&&(this.waitForAllQueries?this.queries$$.push(Le.zip.apply(void 0,Xe(e)).subscribe(function(e){var t=[].concat.apply([],Xe(e));o.query.emit({features:t,event:r})})):this.queries$$=e.map(function(e){return e.subscribe(function(e){o.query.emit({features:e,event:r})})}))}},Ii.prototype.doQueryFeatures=function(e){var u=this,c=[];this.map.ol.forEachFeatureAtPixel(e.pixel,function(e,t){var r,o;if(e)if(e.get("features"))try{for(var n=Qe(e.get("features")),i=n.next();!i.done;i=n.next()){var a=Ko(s=i.value,u.map.projection);a.meta={title:s.values_.nom,id:s.id_,icon:s.values_._icon,sourceTitle:t.values_.title},c.push(a)}}catch(l){r={error:l}}finally{try{i&&!i.done&&(o=n["return"])&&o.call(n)}finally{if(r)throw r.error}}else if(e instanceof _){var s=zo(e,u.map.projection,t);c.push(s)}else s=Ko(e,u.map.projection,t),c.push(s)},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:so});var r=this.map.layers.filter(ao);return c.forEach(function(t){r.forEach(function(e){"undefined"!=typeof e.ol.getSource().hasFeature&&e.ol.getSource().hasFeature(t.ol)&&(t.meta.alias=u.queryService.getAllowedFieldsAndAlias(e),t.meta.title=t.meta.title||u.queryService.getQueryTitle(t,e),t.meta.sourceTitle=e.title)})}),Le.of(c)},Ii.prototype.cancelOngoingQueries=function(){this.queries$$.forEach(function(e){return e.unsubscribe()}),this.queries$$=[]},Ii.decorators=[{type:je.Directive,args:[{selector:"[igoQuery]"}]}],Ii.ctorParameters=function(){return[{type:Hr,decorators:[{type:je.Self}]},{type:bi}]},Ii.propDecorators={queryFeatures:[{type:je.Input}],queryFeaturesHitTolerance:[{type:je.Input}],queryFeaturesCondition:[{type:je.Input}],waitForAllQueries:[{type:je.Input}],query:[{type:je.Output}]},Ii);function Ii(e,t){this.component=e,this.queryService=t,this.queries$$=[],this.queryFeatures=!1,this.queryFeaturesHitTolerance=0,this.waitForAllQueries=!0,this.query=new je.EventEmitter}var Oi=(Fi.prototype.getId=function(){throw new Error('You have to implement the method "getId".')},Fi.prototype.getType=function(){throw new Error('You have to implement the method "getType".')},Fi.prototype.getDefaultOptions=function(){throw new Error('You have to implement the method "getDefaultOptions".')},Object.defineProperty(Fi.prototype,"title",{get:function(){return this.options.title},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"available",{get:function(){return!1!==this.options.available},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"enabled",{get:function(){return this.available&&!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"showInPointerSummary",{get:function(){var e=this.options.showInPointerSummary;return e||!1},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"showInSettings",{get:function(){var e=this.options.showInSettings;return e===undefined||e},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"searchUrl",{get:function(){return this.options.searchUrl},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"params",{get:function(){return this.options.params===undefined?{}:this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(Fi.prototype,"settings",{get:function(){return this.options.settings===undefined?[]:this.options.settings},enumerable:!0,configurable:!0}),Fi.prototype.setParamFromSetting=function(r){var e,o=this;switch(r.type){case"radiobutton":r.values.forEach(function(e){var t;e.enabled&&(o.options.params=Object.assign(o.options.params||{},((t={})[r.name]=e.value,t)))});break;case"checkbox":var t="";r.values.filter(function(e){return!1!==e.available}).forEach(function(e){e.enabled&&(t+=e.value+",")}),t=t.slice(0,-1),this.options.params=Object.assign(this.options.params||{},((e={})[r.name]=t,e))}},Object.defineProperty(Fi.prototype,"displayOrder",{get:function(){return this.options.order===undefined?99:this.options.order},enumerable:!0,configurable:!0}),Fi.prototype.getHashtagsValid=function(e,t){var r=e.match(/(#[^\s]+)/g);if(!r)return undefined;var o=this.getSettingsValues(t),i=[];return r.forEach(function(n){o.values.forEach(function(e){var t=n.substring(1);if("string"==typeof e.value){var r=e.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),o=r.indexOf(t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));-1!==o&&i.push(r[o])}e.hashtags&&-1!==e.hashtags.indexOf(t)&&i.push(e.value)})}),i.filter(function(e,t){return i.indexOf(e)===t})},Fi.prototype.getSettingsValues=function(t){return this.getDefaultOptions().settings.find(function(e){return e.name===t})},Fi.id="",Fi.type="",Fi);function Fi(e){var t=this;this.options=e,this.options=Object.assign({},this.getDefaultOptions(),e),this.settings.forEach(function(e){t.setParamFromSetting(e)})}var xi,Ci=(Ke(Ti,xi=Oi),Ti.prototype.getId=function(){return Ti.id},Ti.prototype.getType=function(){return Ti.type},Ti.prototype.getDefaultOptions=function(){return{title:"Carte"}},Ti.id="map",Ti.type=ur,Ti.decorators=[{type:je.Injectable}],Ti.ctorParameters=function(){return[{type:undefined,decorators:[{type:je.Inject,args:["options"]}]}]},Ti);function Ti(e){return xi.call(this,e)||this}var Li=(Mi.getGoogleMapsCoordLink=function(e,t){return"https://www.google.com/maps?q="+t+","+e},Mi.getGoogleStreetViewLink=function(e,t){return"https://www.google.com/maps?q=&layer=c&cbll="+t+","+e},Mi.getGoogleMapsNameLink=function(e){return"https://www.google.com/maps?q="+encodeURI(e)},Mi);function Mi(){}var Pi=(ki.getOpenStreetMapLink=function(e,t,r){return void 0===r&&(r=17),"https://www.openstreetmap.org/?mlat="+t+"&mlon="+e+"#map="+r+"/"+t+"/"+e},ki.getOpenStreetCamLink=function(e,t,r){return void 0===r&&(r=17),"https://openstreetcam.org/map/@"+t+","+e+","+r+"z"},ki);function ki(){}var Di=(ji.prototype.loadCatalogs=function(){var e=this.config.getConfig("context")||{},t=this.config.getConfig("catalog")||{},r=t.url||e.url,o=t.sources||[],n=[];if(r){if(t.baseLayers){var i=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:r+"/baselayers",type:"baselayers"}];n.push(Le.of(i))}var a=this.http.get(r+"/catalogs").pipe(Pe.map(function(e){return e.map(function(e){return Object.assign(e,e.options)})}),Pe.catchError(function(e){return Le.EMPTY}));n.push(a)}return 0<o.length&&n.push(Le.of(o).pipe(Pe.map(function(e){return e.map(function(e){return e.id||(e.id=ke.uuid()),e})}))),Le.zip.apply(void 0,Xe(n)).pipe(Pe.map(function(e){return[].concat.apply([],e)}))},ji.prototype.loadCatalogItems=function(e){return yi.createInstanceCatalog(e,this).collectCatalogItems()},ji.prototype.loadCatalogBaseLayerItems=function(r){return this.getCatalogBaseLayersOptions(r).pipe(Pe.map(function(e){var t=e.map(function(e){return{id:tt(e.sourceOptions),title:e.title,type:ri.Layer,options:e}});return[{id:"catalog.group.baselayers",type:ri.Group,title:r.title,items:t}]}))},ji.prototype.getCatalogBaseLayersOptions=function(e){return this.http.get(e.url)},ji.prototype.loadCatalogWMSLayerItems=function(r){var o=this;return this.getCatalogCapabilities(r).pipe(Pe.map(function(e){var t=[];return o.includeRecursiveItems(r,e.Capability.Layer,t),t}))},ji.prototype.loadCatalogWMTSLayerItems=function(t){var r=this;return this.getCatalogCapabilities(t).pipe(Pe.map(function(e){return r.getWMTSItems(t,e)}))},ji.prototype.loadCatalogCompositeLayerItems=function(e){var t=this,r=e.composite,a=[];r.map(function(e){return a.push(yi.createInstanceCatalog(e,t))});var o=[];a.map(function(e){return o.push(e.collectCatalogItems())});var n=[];if(Object.keys(r).find(function(e){return r[e].groupImpose})){var i=function(e,t){var r=a[t],o=Object.assign({},r.groupImpose);o.address=r.id,o.type=ri.Group,o.items=[];var n=function i(e){return e.reduce(function(e,t){return e.concat(t.type===ri.Group?i(t.items):t)},[])}(e);return n.map(function(e){return e.address=o.address+"."+o.id}),o.items=n,o};n=o.map(function(e,t){return e.pipe(Pe.map(function(e){return r[t].groupImpose?i(e,t):e}))})}else n=o;var s=Le.zip.apply(void 0,Xe(n)).pipe(Pe.map(function(e){return[].concat.apply([],Xe(e))})),u=function(e,l){return e.reduce(function(e,o,n,t){var i=l(o),r=Object.assign({},o);if(o.type===ri.Layer){var a=[];if(0<t.filter(function(e,t){var r=!1;return e.title===i&&e.type===ri.Layer&&(t!==n&&e.address!==o.address&&(r=!0),a.push(t)),r}).length){var s=a.findIndex(function(e){return e===n})+1;r.title=o.title+" ("+s+")"}e.find(function(e){return e.title===r.title&&e.type===ri.Layer})||(e[e.length]=r)}else o.type===ri.Group&&(r.items=u(o.items,function(e){return e.title}),e[e.length]=r);return e},[])};return s.pipe(Pe.map(function(e){return function(e,a){return e.reduce(function(e,t){var r,o=a(t),n=e.find(function(e){return e.id===o});if(n){var i=e.indexOf(n);-1===e[i].address.split("|").indexOf(t.address)&&(e[i].address=e[i].address+"|"+t.address),(r=e[i].items).push.apply(r,Xe(t.items))}else e[e.length]=t;return e},[])}(e,function(e){return e.id})}),Pe.map(function(e){return[].concat.apply([],Xe(e))}),Pe.map(function(e){return u(e,function(e){return e.title})}))},ji.prototype.getCatalogCapabilities=function(e){var t=oi[e.type];return this.capabilitiesService.getCapabilities(Wn[t],e.url,e.version)},ji.prototype.prepareCatalogItemLayer=function(e,t,r,o){var n=this.retriveLayerInfoFormat(e.Name,r),i=e.DataURL?e.DataURL[0]:undefined,a=o.showLegend&&e.Style?this.capabilitiesService.getStyle(e.Style):undefined,s=Object.assign({},o.queryParams,{LAYERS:e.Name,VERSION:o.version}),l={type:"wms",url:o.url,crossOrigin:o.setCrossOriginAnonymous?"anonymous":undefined,queryFormat:n,queryHtmlTarget:n===Rt.HTML||n===Rt.HTMLGML2?"iframe":undefined,optionsFromCapabilities:!0},u=Object.assign({},l,o.sourceOptions,{params:s}),c={id:tt(u),type:ri.Layer,title:e.Title,address:t,options:{maxResolution:mr(e.MaxScaleDenominator),minResolution:mr(e.MinScaleDenominator),metadata:{url:i?i.OnlineResource:undefined,extern:!!i||undefined},legendOptions:a,tooltip:{type:o.tooltipType},sourceOptions:u}};return ke.ObjectUtils.removeUndefined(c)},ji.prototype.prepareCatalogItemGroup=function(e,i,a,s,l){var u=this;return{id:a,type:ri.Group,title:e.Title,address:l.id,items:e.Layer.reduce(function(e,t){if(t.Layer!==undefined){var r=a+".group."+(t.Name||t.Layer[0].Name),o=u.prepareCatalogItemGroup(t,i,r,s,l);e.push(o)}else{if(!1===u.testLayerRegexes(t.Name,i))return e;var n=u.prepareCatalogItemLayer(t,a,s,l);e.push(n)}return e},[])}},ji.prototype.includeRecursiveItems=function(e,t,r,o){var n,i;void 0===o&&(o=0);var a=(e.regFilters||[]).map(function(e){return new RegExp(e)});if(t.Layer)try{for(var s=Qe(t.Layer),l=s.next();!l.done;l=s.next()){var u=l.value;if(u.Layer===undefined){var c=this.findCatalogInfoFormat(e);if(0!==o){var p="catalog.group."+(t.Name||u.Name),d=this.prepareCatalogItemGroup(t,a,p,c,e);0!==d.items.length&&r.push(d);break}if(!1!==this.testLayerRegexes(u.Name,a)){var h=this.prepareCatalogItemLayer(u,e.id,c,e);r.push(h)}}else this.includeRecursiveItems(e,u,r,o+1)}}catch(g){n={error:g}}finally{try{l&&!l.done&&(i=s["return"])&&i.call(s)}finally{if(n)throw n.error}}},ji.prototype.getWMTSItems=function(n,e){var i=this,t=e.Contents.Layer,a=(n.regFilters||[]).map(function(e){return new RegExp(e)});return t.map(function(e){if(!1===i.testLayerRegexes(e.Identifier,a))return undefined;var t=Object.assign({},n.queryParams,{version:"1.0.0"}),r={type:"wmts",url:n.url,crossOrigin:n.setCrossOriginAnonymous?"anonymous":undefined,layer:e.Identifier,matrixSet:n.matrixSet,optionsFromCapabilities:!0,requestEncoding:n.requestEncoding||"KVP",style:"default"},o=Object.assign({},r,n.sourceOptions,{params:t});return ke.ObjectUtils.removeUndefined({id:tt(o),type:ri.Layer,title:e.Title,address:n.id,options:{sourceOptions:o}})}).filter(function(e){return e!==undefined})},ji.prototype.testLayerRegexes=function(t,e){return 0===e.length||e.find(function(e){return e.test(t)})!==undefined},ji.prototype.retriveLayerInfoFormat=function(t,e){var r,o=e.find(function(e){return e.layer===t}),n=e.find(function(e){return"*"===e.layer});return o?r=o.queryFormat:n&&(r=n.queryFormat),r},ji.prototype.findCatalogInfoFormat=function(t){var e=[];return t.queryFormat&&Object.keys(t.queryFormat).forEach(function(r){t.queryFormat[r]instanceof Array?t.queryFormat[r].forEach(function(t){e.find(function(e){return e.layer===t})||e.push({layer:t,queryFormat:r})}):e.find(function(e){return e.layer===t.queryFormat[r]})||e.push({layer:t.queryFormat[r],queryFormat:r})}),e},ji.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],ji.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.ConfigService},{type:Ae.LanguageService},{type:zn}]},ji.ngInjectableDef=je.defineInjectable({factory:function(){return new ji(je.inject(Me.HttpClient),je.inject(Ae.ConfigService),je.inject(Ae.LanguageService),je.inject(zn))},token:ji,providedIn:"root"}),ji);function ji(e,t,r,o){this.http=e,this.config=t,this.languageService=r,this.capabilitiesService=o}var Ei=(Object.defineProperty($i.prototype,"resolution$",{get:function(){return this.map.viewController.resolution$},enumerable:!0,configurable:!0}),$i.prototype.ngOnInit=function(){var e=this.map.layers.map(function(e){return{id:e.options.source.id,title:e.title,type:ri.Layer}});this.store.state.updateMany(e,{added:!0},!0),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}});var t=!!this.catalog&&this.catalog.showLegend;this.catalogAllowLegend=t||this.catalogAllowLegend,this.watcher=new Ce.EntityStoreWatcher(this.store,this.cdRef)},$i.prototype.ngOnDestroy=function(){this.watcher.destroy()},$i.prototype.isGroup=function(e){return e.type===ri.Group},$i.prototype.isLayer=function(e){return e.type===ri.Layer},$i.prototype.onLayerAddedChange=function(e){var t=e.layer;this.store.state.update(t,{added:e.added},!1),e.added?this.addLayerToMap(t):this.removeLayerFromMap(t)},$i.prototype.onGroupAddedChange=function(e){var t=e.group;this.store.state.update(t,{added:e.added},!1),e.added?this.addGroupToMap(t):this.removeGroupFromMap(t)},$i.prototype.addLayerToMap=function(e){this.addLayersToMap([e])},$i.prototype.removeLayerFromMap=function(e){this.removeLayersFromMap([e])},$i.prototype.addLayersToMap=function(t){var r=this,e=t.map(function(e){return e.options.sourceOptions.optionsFromApi===undefined&&(e.options.sourceOptions.optionsFromApi=!0),r.layerService.createAsyncLayer(e.options)});Le.zip.apply(void 0,Xe(e)).subscribe(function(e){r.store.state.updateMany(t,{added:!0}),r.map.addLayers(e)})},$i.prototype.removeLayersFromMap=function(e){var r=this;e.forEach(function(e){var t;r.store.state.update(e,{added:!1}),!0===e.options.baseLayer?(t=r.map.getLayerById(e.options.id))!==undefined&&r.map.removeLayer(t):(t=r.map.getLayerById(e.id))!==undefined&&r.map.removeLayer(t)})},$i.prototype.sortCatalogItemsByTitle=function(e,t){var r=e.sort(function(e,t){var r=e.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),o=t.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return r<o?-1:o<r?1:0});switch(t){case"asc":return r;case"desc":return r.reverse();default:return e}},$i.prototype.addGroupToMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!1===t});this.catalog&&this.catalog.sortDirection!==undefined&&(t=this.sortCatalogItemsByTitle(t,this.catalog.sortDirection)),this.addLayersToMap(t.reverse())},$i.prototype.removeGroupFromMap=function(e){var r=this,t=e.items.filter(function(e){var t=r.store.state.get(e).added||!1;return r.isLayer(e)&&!0===t});this.removeLayersFromMap(t)},$i.decorators=[{type:je.Component,args:[{selector:"igo-catalog-browser",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)">\r\n      <igo-catalog-browser-group\r\n        [catalog]="catalog"\r\n        [group]="item"\r\n        [state]="store.state"\r\n        [resolution]="resolution$ | async"\r\n        [catalogAllowLegend]="catalogAllowLegend"\r\n        [toggleCollapsed]="toggleCollapsedGroup"\r\n        (addedChange)="onGroupAddedChange($event)"\r\n        (layerAddedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-group>\r\n    </ng-container>\r\n\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [resolution]="resolution$ | async"\r\n        [catalogAllowLegend]="catalogAllowLegend"\r\n        [added]="store.state.get(item).added"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush}]}],$i.ctorParameters=function(){return[{type:ei},{type:je.ChangeDetectorRef}]},$i.propDecorators={catalogAllowLegend:[{type:je.Input}],catalog:[{type:je.Input}],store:[{type:je.Input}],map:[{type:je.Input}],toggleCollapsedGroup:[{type:je.Input}]},$i);function $i(e,t){this.layerService=e,this.cdRef=t,this.catalogAllowLegend=!1,this.toggleCollapsedGroup=!0}var Ri=(Object.defineProperty(Ai.prototype,"title",{get:function(){return Ce.getEntityTitle(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(Ai.prototype,"icon",{get:function(){return Ce.getEntityIcon(this.layer)||"layers"},enumerable:!0,configurable:!0}),Ai.prototype.ngOnInit=function(){var t=this;this.isInResolutionsRange(),this.isPreview$.subscribe(function(e){return t.addedLayerIsPreview.emit(e)})},Ai.prototype.onMouseEvent=function(e){this.onToggleClick(e)},Ai.prototype.askForLegend=function(e){var t=this;this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe(Pe.first()).subscribe(function(e){return t.igoLayer$.next(e)})},Ai.prototype.onToggleClick=function(e){var t=this;switch("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),e.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add()),this.isPreview$.next(!1);break;case"mouseenter":this.isPreview$.value||this.added||(this.lastTimeoutRequest=setTimeout(function(){t.add(),t.isPreview$.next(!0)},500));break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1))}},Ai.prototype.add=function(){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer}))},Ai.prototype.remove=function(){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer}))},Ai.prototype.haveGroup=function(){return!(!this.layer.address||1===this.layer.address.split(".").length)},Ai.prototype.isInResolutionsRange=function(){var e=this.layer.options.minResolution||0,t=this.layer.options.maxResolution||Infinity;return this.inRange$.next(this.resolution>=e&&this.resolution<=t),this.inRange$.value},Ai.prototype.computeTooltip=function(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"},Ai.decorators=[{type:je.Component,args:[{selector:"igo-catalog-browser-layer",template:'<mat-list-item>\r\n  <mat-icon *ngIf="haveGroup()" mat-list-avatar svgIcon="blank"></mat-icon>\r\n  <h4 mat-line matTooltipShowDelay="500" [ngClass]="(catalogAllowLegend)?\'igo-cataloglayer-title\':\'\'" (click)="askForLegend($event)" [matTooltip]="title">{{title}}</h4>\r\n\r\n  <igo-metadata-button [layer]="layer"></igo-metadata-button>\r\n\r\n  <button\r\n    (mouseenter)="onMouseEvent($event)" (mouseleave)="onMouseEvent($event)"\r\n    mat-icon-button\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="computeTooltip() | translate"\r\n    [color]="(isPreview$ | async) ? \'\' : added ? \'warn\' : \'\'"\r\n    (click)="onToggleClick($event)">\r\n    <mat-icon\r\n       matBadge\r\n       igoMatBadgeIcon="eye-off"\r\n       [matBadgeHidden]="isInResolutionsRange()"\r\n       matBadgeColor="accent"\r\n       matBadgeSize="small"\r\n       matBadgePosition="after"\r\n       [svgIcon]="(isPreview$ | async) ? \'plus\' : added ? \'delete\' : \'plus\'">\r\n    </mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n\r\n<div #legend class="igo-cataloglayer-legend-container">\r\n  <igo-layer-legend\r\n    *ngIf="(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend"\r\n    [layer]="igoLayer$ | async">\r\n  </igo-layer-legend>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".mat-badge-small .mat-badge-content{color:rgba(0,0,0,.38)}.igo-cataloglayer-title{cursor:pointer}.igo-cataloglayer-legend-container{padding-left:18px;width:calc(100% - 18px);margin-left:40px}"]}]}],Ai.ctorParameters=function(){return[{type:ei}]},Ai.propDecorators={resolution:[{type:je.Input}],catalogAllowLegend:[{type:je.Input}],layer:[{type:je.Input}],added:[{type:je.Input}],addedChange:[{type:je.Output}],addedLayerIsPreview:[{type:je.Output}]},Ai);function Ai(e){this.layerService=e,this.inRange$=new Le.BehaviorSubject(!0),this.isPreview$=new Le.BehaviorSubject(!1),this.layerLegendShown$=new Le.BehaviorSubject(!1),this.igoLayer$=new Le.BehaviorSubject(undefined),this.catalogAllowLegend=!1,this.added=!1,this.addedChange=new je.EventEmitter,this.addedLayerIsPreview=new je.EventEmitter}var Bi=(Object.defineProperty(Gi.prototype,"title",{get:function(){return this.group.title},enumerable:!0,configurable:!0}),Gi.prototype.ngOnInit=function(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),this.catalog&&this.catalog.sortDirection!==undefined&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:function(e){return e.title}})},Gi.prototype.ngOnDestroy=function(){this.store.destroy()},Gi.prototype.isGroup=function(e){return e.type===ri.Group},Gi.prototype.isLayer=function(e){return e.type===ri.Layer},Gi.prototype.onToggleClick=function(){this.added$.value?this.remove():this.add()},Gi.prototype.onToggleCollapsed=function(e){this.evaluateDisabled(e)},Gi.prototype.onLayerAddedChange=function(e){this.layerAddedChange.emit(e),this.tryToggleGroup(e)},Gi.prototype.add=function(){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group})},Gi.prototype.remove=function(){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group})},Gi.prototype.onLayerPreview=function(e){this.preview$.next(e)},Gi.prototype.tryToggleGroup=function(e){var t=this,r=e.added,o=e.layer;this.store.view.all().filter(function(e){return e.id!==o.id}).map(function(e){return t.state.get(e).added||!1}).every(function(e){return e===r})?r?this.add():this.remove():!0===this.added$.value&&this.added$.next(!1)},Gi.prototype.evaluateAdded=function(){var t=this,e=this.store.all().every(function(e){return!0===(t.state.get(e).added||!1)});this.added$.next(e)},Gi.prototype.evaluateDisabled=function(e){var t=!1;!1===this.toggleCollapsed&&(t=e),this.disabled$.next(t)},Gi.prototype.onTitleClick=function(){this.collapsed=!this.collapsed},Gi.decorators=[{type:je.Component,args:[{selector:"igo-catalog-browser-group",template:'<mat-list-item>\r\n  <mat-icon\r\n    mat-list-avatar\r\n    svgIcon="chevron-up"\r\n    igoCollapse\r\n    class="igo-chevron"\r\n    [target]="items"\r\n    [collapsed]="collapsed"\r\n    (toggle)="onToggleCollapsed($event)">\r\n  </mat-icon>\r\n\r\n  <h4 class="igo-catalog-group-title" id="catalog-group-title" mat-line matTooltipShowDelay="500" [matTooltip]="title" (click)="onTitleClick()">{{title}}</h4>\r\n  <ng-container *ngIf="(added$ | async) && !(preview$ | async); else notadded">\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.removeFromMap\' | translate"\r\n      color="warn"\r\n      [disabled]="disabled$ | async"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n  </ng-container>\r\n\r\n  <ng-template #notadded>\r\n    <button\r\n      mat-icon-button\r\n      tooltip-position="below"\r\n      matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.catalog.group.addToMap\' | translate"\r\n      [disabled]="disabled$ | async"\r\n      (click)="onToggleClick()">\r\n      <mat-icon svgIcon="plus"></mat-icon>\r\n    </button>\r\n  </ng-template>\r\n</mat-list-item>\r\n\r\n<div #items>\r\n  <ng-template ngFor let-item [ngForOf]="store.view.all$() | async">\r\n    <ng-container *ngIf="isGroup(item)">\r\n      \x3c!-- todo: add display ans manage CatalogItemGroup --\x3e\r\n    </ng-container>\r\n    <ng-container *ngIf="isLayer(item)">\r\n      <igo-catalog-browser-layer\r\n        igoListItem\r\n        [layer]="item"\r\n        [resolution]="resolution"\r\n        [catalogAllowLegend]="catalogAllowLegend"\r\n        [added]="state.get(item).added"\r\n        (addedLayerIsPreview)="onLayerPreview($event)"\r\n        (addedChange)="onLayerAddedChange($event)">\r\n      </igo-catalog-browser-layer>\r\n    </ng-container>\r\n  </ng-template>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".igo-catalog-group-title{cursor:pointer;opacity:.9}#catalog-group-title{font-weight:700}"]}]}],Gi.propDecorators={catalog:[{type:je.Input}],group:[{type:je.Input}],collapsed:[{type:je.Input}],resolution:[{type:je.Input}],catalogAllowLegend:[{type:je.Input}],toggleCollapsed:[{type:je.Input}],state:[{type:je.Input}],addedChange:[{type:je.Output}],layerAddedChange:[{type:je.Output}]},Gi);function Gi(){this.store=new Ce.EntityStore([]),this.added$=new Le.BehaviorSubject(!1),this.preview$=new Le.BehaviorSubject(!1),this.disabled$=new Le.BehaviorSubject(!1),this.collapsed=!0,this.catalogAllowLegend=!1,this.toggleCollapsed=!0,this.addedChange=new je.EventEmitter,this.layerAddedChange=new je.EventEmitter}var _i=(qi.prototype.ngOnInit=function(){var r=this;this.component.layers=[],this.layersOrResolutionChange$$=Le.combineLatest([this.mapService.getMap().layers$,this.mapService.getMap().viewController.resolution$]).pipe(Pe.debounceTime(10)).subscribe(function(e){var t=e[0].filter(function(e){return!0===e.showInLayerList});r.component.layers=t,r.layersVisibility$$=Le.combineLatest(t.map(function(e){return e.visible$})).subscribe(function(e){r.component.change$.next()})})},qi.prototype.ngOnDestroy=function(){this.layersOrResolutionChange$$.unsubscribe(),this.layersVisibility$$!==undefined&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=undefined)},qi.decorators=[{type:je.Directive,args:[{selector:"[igoLayerLegendListBinding]"}]}],qi.ctorParameters=function(){return[{type:fo,decorators:[{type:je.Self}]},{type:So}]},qi);function qi(e,t){this.mapService=t,this.component=e}var Ni=(Vi.forRoot=function(){return{ngModule:Vi,providers:[ei,no,Co]}},Vi.decorators=[{type:je.NgModule,args:[{imports:[Fe.MatInputModule,Fe.MatFormFieldModule,xe.CommonModule,ve.FormsModule,Fe.MatDividerModule,Fe.MatMenuModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatSlideToggleModule,Fe.MatSelectModule,Fe.MatTooltipModule,Fe.MatListModule,Fe.MatSliderModule,Fe.MatBadgeModule,Fe.MatCheckboxModule,Ae.IgoLanguageModule,Ce.IgoListModule,Ce.IgoCollapsibleModule,Ce.IgoImageModule,Ce.IgoPanelModule],exports:[lo,ho,co,vo,Fo,fo,Io,_i,Lo],declarations:[lo,ho,co,vo,Fo,fo,Io,_i,Lo]}]}],Vi);function Vi(){}var Ui=(Wi.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatBadgeModule,Fe.MatButtonModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatTooltipModule,Ce.IgoMatBadgeIconModule,Ae.IgoLanguageModule,Ce.IgoListModule,Ce.IgoCollapsibleModule,Ue,Ni],exports:[Ei],declarations:[Ei,Bi,Ri]}]}],Wi);function Wi(){}var zi=(Ki.prototype.ngOnInit=function(){this.store.state.clear()},Ki.prototype.onCatalogSelect=function(e){this.store.state.update(e,{selected:!0,focused:!0},!0),this.catalogSelectChange.emit({selected:!0,catalog:e})},Ki.decorators=[{type:je.Component,args:[{selector:"igo-catalog-library",template:'<igo-list [navigation]="false">\r\n  <ng-template ngFor let-catalog [ngForOf]="store.view.all$() | async">\r\n    <igo-catalog-library-item\r\n      igoListItem\r\n      color="accent"\r\n      [map]="map"\r\n      [catalog]="catalog"\r\n      (select)="onCatalogSelect(catalog)">\r\n    </igo-catalog-library-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush}]}],Ki.propDecorators={store:[{type:je.Input}],map:[{type:je.Input}],catalogSelectChange:[{type:je.Output}]},Ki);function Ki(){this.catalogSelectChange=new je.EventEmitter}var Hi=(Object.defineProperty(Yi.prototype,"title",{get:function(){return Ce.getEntityTitle(this.catalog)},enumerable:!0,configurable:!0}),Yi.decorators=[{type:je.Component,args:[{selector:"igo-catalog-library-item",template:"<mat-list-item>\r\n  <h4 mat-line>{{title}}</h4>\r\n</mat-list-item>\r\n",changeDetection:je.ChangeDetectionStrategy.OnPush}]}],Yi.propDecorators={catalog:[{type:je.Input}],map:[{type:je.Input}]},Yi);function Yi(){}var Zi=(Qi.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatTooltipModule,Ce.IgoListModule],exports:[zi],declarations:[zi,Hi]}]}],Qi);function Qi(){}var Ji=(Xi.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatBadgeModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatTooltipModule,Ce.IgoMatBadgeIconModule,Ce.IgoListModule,Ce.IgoCollapsibleModule],exports:[Ui,Zi],declarations:[]}]}],Xi);function Xi(){}var ea=(ta.forRoot=function(){return{ngModule:ta,providers:[]}},ta.decorators=[{type:je.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],ta);function ta(){}var ra=(oa.prototype.transform=function(e,t){var r,o=this;return"time"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isTimeFilterable(t)&&t.options.timeFilter!==undefined&&Object.keys(t.options.timeFilter).length})),"ogc"===t&&(r=e.filter(function(e){var t=e.dataSource;return o.isOgcFilterable(t)})),r},oa.prototype.isTimeFilterable=function(e){return"wms"===e.options.type&&e.options.timeFilterable},oa.prototype.isOgcFilterable=function(e){var t=!1;return e.options.ogcFilters&&e.options.ogcFilters.enabled&&e.options.ogcFilters.editable&&(t=!0),e.options.ogcFilters&&e.options.ogcFilters.enabled&&e.options.ogcFilters.pushButtons&&(t=!0),t},oa.decorators=[{type:je.Pipe,args:[{name:"filterableDataSource"}]}],oa);function oa(){}var na=(ia.prototype.filterByDate=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=this.reformatDateTime(t[0]),i.push(t[0])),t[1]&&(n=this.reformatDateTime(t[1]),i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof Jt?o+","+n:o+"/"+n),o===n&&(r=o)}else t&&(r=this.reformatDateTime(t));var a={TIME:r};e.ol.updateParams(a)},ia.prototype.filterByYear=function(e,t){var r,o,n;if(Array.isArray(t)){var i=[];t[0]&&(o=t[0],i.push(t[0])),t[1]&&(n=t[1],i.push(t[1])),2===i.length&&o!==n&&(r=e instanceof Jt?o+","+n:o+"/"+n),o===n&&(r=o)}else r=t;var a={TIME:r};e.ol.updateParams(a)},ia.prototype.reformatDateTime=function(e){var t=e.getFullYear(),r=e.getMonth()+1,o=e.getUTCDate(),n=e.getUTCHours(),i=e.getUTCMinutes();return Number(r)<10&&(r="0"+r),Number(o)<10&&(o="0"+o),Number(n)<10&&(n="0"+n),Number(i)<10&&(i="0"+i),t+"-"+r+"-"+o+"T"+n+":"+i+":00Z"},ia.decorators=[{type:je.Injectable}],ia.ctorParameters=function(){return[]},ia);function ia(){}var aa=(sa.prototype.filterByOgc=function(e,t){var r=(new vt).formatProcessedOgcFilter(t,e.options.params.LAYERS);e.ol.updateParams({FILTER:r})},sa.prototype.setOgcWFSFiltersOptions=function(e){var t=e.options,r=new vt;t.ogcFilters.enabled&&t.ogcFilters.filters&&(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry,new q({code:t.paramsWFS.srsName}),!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.paramsWFS.fieldNameGeometry)))},sa.prototype.setOgcWMSFiltersOptions=function(e){var t=e.options,r=new vt;t.ogcFilters.enabled&&t.ogcFilters.filters?(t.ogcFilters.filters=r.checkIgoFiltersProperties(t.ogcFilters.filters,t.fieldNameGeometry,undefined,!0),t.ogcFilters.interfaceOgcFilters||(t.ogcFilters.interfaceOgcFilters=r.defineInterfaceFilterSequence(t.ogcFilters.filters,t.fieldNameGeometry)),this.filterByOgc(e,r.buildFilter(t.ogcFilters.filters)),t.filtered=!0):(t.ogcFilters.filters=undefined,t.ogcFilters.interfaceOgcFilters=[],t.filtered=!1)},sa.decorators=[{type:je.Injectable}],sa.ctorParameters=function(){return[]},sa);function sa(){}var la={Predefined:"Predefined",Polygon:"Polygon",Point:"Point"},ua={Address:"Address",Thematics:"Thematics"},ca=(pa.prototype.getKeyByValue=function(t,r){return Object.keys(t).find(function(e){return t[e]===r})},pa.prototype.loadFilterList=function(e){var t=e;if(t)return this.http.get(this.baseUrl+this.urlFilterList[t]).pipe(Pe.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code},e})}))},pa.prototype.loadThematicsList=function(){var s=this,l=[];return this.http.get(this.baseUrl+"types").pipe(Pe.map(function(e){return e.forEach(function(e){if(e.startsWith("lieux")){var t={name:undefined,source:e},r=e.substring(6,e.length),o=r;if(r.includes(".")){var n=r.indexOf(".");o=r.substring(n+1,r.length),r=r.substring(0,n)}try{t.name=s.languageService.translate.instant("igo.geo.terrapi."+o)}catch(a){t.name=o.substring(0,1).toUpperCase()+o.substring(1,o.length-1)}try{t.group=s.languageService.translate.instant("igo.geo.spatialFilter.group."+r)}catch(a){t.group=r.substring(0,1).toUpperCase()+r.substring(1,o.length-1)}l.push(t)}else if(s.getKeyByValue(s.urlFilterList,e)){t={name:undefined,source:e};var i=s.getKeyByValue(s.urlFilterList,e);try{t.name=s.languageService.translate.instant("igo.geo.terrapi."+i)}catch(a){t.name=i.substring(0,1).toUpperCase()+i.substring(1,i.length-1)}t.source=e,l.push(t)}}),l}))},pa.prototype.loadFilterItem=function(e,t,r,o,n){var i=this;if(r){var a=r,s=this.baseUrl+this.urlFilterList[a],l="";return t===ua.Address?(l="adresses",this.http.get(s+"/"+e.properties.code+"/"+l,{params:{geometry:"true",icon:"true"}}).pipe(Pe.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:i.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:e.icon},e})}))):(l=o.source,this.http.get(s+"/"+e.properties.code+"/"+l,{params:{geometry:"true",icon:"true"}}).pipe(Pe.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:o.name,icon:e.icon},e})})))}return s=this.baseUrl+"locate",t===ua.Address?(l="?type=adresses",this.http.post(s+l,{geometry:"true",icon:"true",buffer:n,loc:JSON.stringify(e)}).pipe(Pe.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:i.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:e.icon},e})}))):(l="?type="+o.source,this.http.post(s+l,{geometry:"true",icon:"true",buffer:n,loc:JSON.stringify(e)}).pipe(Pe.map(function(e){return e.features.map(function(e){return e.meta={id:e.properties.code,title:o.name,icon:e.icon},e})})))},pa.prototype.loadItemById=function(e,t){var r=this.urlFilterList[t],o="/"+e.properties.code;if(r&&o)return this.http.get(this.baseUrl+r+o,{params:{geometry:"true"}}).pipe(Pe.map(function(e){return e.meta={id:e.properties.code,alias:e.properties.nom,title:e.properties.nom},e}))},pa.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],pa.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.LanguageService},{type:Ae.ConfigService}]},pa.ngInjectableDef=je.defineInjectable({factory:function(){return new pa(je.inject(Me.HttpClient),je.inject(Ae.LanguageService),je.inject(Ae.ConfigService))},token:pa,providedIn:"root"}),pa);function pa(e,t,r){this.http=e,this.languageService=t,this.configService=r,this.baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/",this.urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"},this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}var da=(ha.prototype.open=function(e){var t=this.languageService.translate,r=t.instant("igo.geo.download.title");this.messageService.success(t.instant("igo.geo.download.start"),r);var o=e.dataSource.options;if(0<Object.keys(o.download).length)if(o.download.dynamicUrl&&o.download.url===undefined){var n=void 0,i=(n=e.dataSource.options.paramsWFS&&0<Object.keys(e.dataSource.options.paramsWFS).length?e.dataSource.options.paramsWFS:e.dataSource.options.params).outputFormatDownload===undefined?"outputformat="+n.outputFormat:"outputformat="+n.outputFormatDownload,a=o.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),s=e.dataSource.options.ogcFilters,l=void 0;l=(l=(new vt).handleOgcFiltersAppliedValue(e.dataSource.options,s.geometryName,e.map.viewController.getExtent(),new q({code:e.map.projection})))?"filter="+encodeURIComponent(l):(new vt).buildFilter(undefined,e.map.viewController.getExtent(),new q({code:e.map.projection}),s.geometryName),window.open(a+"&"+l+"&"+i,"_blank")}else o.download&&window.open(o.download.url,"_blank")},ha.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],ha.ctorParameters=function(){return[{type:Ae.MessageService},{type:Ae.LanguageService}]},ha.ngInjectableDef=je.defineInjectable({factory:function(){return new ha(je.inject(Ae.MessageService),je.inject(Ae.LanguageService))},token:ha,providedIn:"root"}),ha);function ha(e,t){this.messageService=e,this.languageService=t}var ga=(Object.defineProperty(fa.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(fa.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),fa.prototype.openDownload=function(e){this.downloadService.open(e)},Object.defineProperty(fa.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),fa.decorators=[{type:je.Component,args:[{selector:"igo-download-button",template:'<button\r\n  *ngIf="options && options.download && (options.download[\'dynamicUrl\'] || options.download[\'url\']) "\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.download.action\' | translate"\r\n  [color]="color"\r\n  (click)="openDownload(layer)">\r\n  <mat-icon svgIcon="download"></mat-icon>\r\n</button>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],fa.ctorParameters=function(){return[{type:da}]},fa.propDecorators={layer:[{type:je.Input}],color:[{type:je.Input}]},fa);function fa(e){this.downloadService=e,this._color="primary"}var ma=(ya.forRoot=function(){return{ngModule:ya}},ya.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTooltipModule,Ae.IgoLanguageModule],exports:[ga],declarations:[ga]}]}],ya);function ya(){}var va=(Object.defineProperty(ba.prototype,"source",{get:function(){return this._source},set:function(e){this._source=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(ba.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(ba.prototype,"title",{get:function(){return Ce.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),Object.defineProperty(ba.prototype,"icon",{get:function(){return Ce.getEntityIcon(this.feature)||"link"},enumerable:!0,configurable:!0}),ba.prototype.htmlSanitizer=function(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)},ba.prototype.isObject=function(e){return"object"==typeof e},ba.prototype.isUrl=function(e){return"string"==typeof e&&("https://"===e.slice(0,8)||"http://"===e.slice(0,7))},ba.prototype.filterFeatureProperties=function(t){var r,o=t.meta?t.meta.alias:undefined,n={};return this.map&&this.map.offlineButtonToggle$.subscribe(function(e){r=e}),o?(Object.keys(o).forEach(function(e){n[o[e]]=t.properties[e]}),n):(r!==undefined?r?t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(function(e){delete t.properties[e]}):this.state.connection&&t.meta&&t.meta.excludeAttribute?t.meta.excludeAttribute.forEach(function(e){delete t.properties[e]}):!this.state.connection&&t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(function(e){delete t.properties[e]}):this.state.connection&&t.meta&&t.meta.excludeAttribute?t.meta.excludeAttribute.forEach(function(e){delete t.properties[e]}):!this.state.connection&&t.meta&&t.meta.excludeAttributeOffline&&t.meta.excludeAttributeOffline.forEach(function(e){delete t.properties[e]}),t.properties)},ba.decorators=[{type:je.Component,args:[{selector:"igo-feature-details",template:'<table class="igo-striped mat-typography" *ngIf="feature && isObject(feature.properties) && feature.properties.target !== \'iframe\'">\r\n  <tbody>\r\n    <tr *ngFor="let property of filterFeatureProperties(feature) | keyvalue">\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <mat-icon mat-list-avatar svgIcon="{{icon}}"></mat-icon>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === \'_blank\' && property.key === \'url\'">\r\n        <a href="{{property.value}}" target=\'_blank\'> {{ \'igo.geo.targetHtmlUrl\' | translate }} {{title}}</a>\r\n      </td>\r\n\r\n      <td id="keyValue" *ngIf="feature.properties.target === undefined">\r\n        {{property.key }}\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)" [innerHTML]=property.value>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)">\r\n        <a href="{{property.value}}" target=\'_blank\'>{{ \'igo.geo.targetHtmlUrl\' | translate }} </a>\r\n      </td>\r\n\r\n      <td *ngIf="feature.properties.target === undefined && isObject(property.value)" [innerHTML]="property.value | json">\r\n      </td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<iframe *ngIf="feature && isObject(feature.properties) && feature.properties.target === \'iframe\'" [src]="htmlSanitizer(feature.properties.url)"></iframe>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:["table{width:100%}table td{padding:5px}#keyValue{width:30%}iframe{height:calc(100% - 4px);width:100%;border:0}"]}]}],ba.ctorParameters=function(){return[{type:je.ChangeDetectorRef},{type:N.DomSanitizer},{type:Ae.NetworkService}]},ba.propDecorators={source:[{type:je.Input}],map:[{type:je.Input}],feature:[{type:je.Input}]},ba);function ba(e,t,r){var o=this;this.cdRef=e,this.sanitizer=t,this.networkService=r,this.networkService.currentState().subscribe(function(e){o.state=e})}var Sa=(wa.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatIconModule,Ae.IgoLanguageModule,Ce.IgoKeyValueModule],exports:[va],declarations:[va]}]}],wa);function wa(){}var Ia=(Oa.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Ce.IgoFormModule],exports:[Ce.IgoFormModule,nn],declarations:[nn]}]}],Oa);function Oa(){}var Fa=(xa.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule],exports:[Sa,Ia],declarations:[],providers:[]}]}],xa);function xa(){}var Ca,Ta,La=(Object.defineProperty(Ma.prototype,"geometryType",{get:function(){return this.geometryType$.value},set:function(e){this.geometryType$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"drawGuide",{get:function(){return this.drawGuide$.value},set:function(e){this.drawGuide$.next(e)},enumerable:!0,configurable:!0}),Ma.prototype.ngOnInit=function(){var t=this;this.value$.next(this.formControl.value?this.formControl.value:undefined),this.value$$=this.formControl.valueChanges.subscribe(function(e){t.value$.next(e||undefined)})},Ma.prototype.ngOnDestroy=function(){this.value$$.unsubscribe()},Ma.decorators=[{type:je.Component,args:[{selector:"igo-geometry-form-field",template:'<igo-geometry-form-field-input\r\n  [formControl]="formControl"\r\n  [map]="map"\r\n  [geometryType]="geometryType$ | async"\r\n  [drawGuide]="drawGuide$ | async"\r\n  [measure]="measure"\r\n  [drawControlIsActive]="drawControlIsActive"\r\n  [freehandDrawIsActive]="freehandDrawIsActive"\r\n  [drawStyle]="drawStyle"\r\n  [overlayStyle]="overlayStyle">\r\n</igo-geometry-form-field-input>\r\n\r\n<div *ngIf="geometryTypeField" class="geometry-type-toggle">\r\n  <mat-button-toggle-group\r\n    [disabled]="(value$ | async) !== undefined"\r\n    [(ngModel)]="geometryType">\r\n    <mat-button-toggle\r\n      value="Point"\r\n      [disabled]="geometryTypes.indexOf(\'Point\') < 0">\r\n      {{\'igo.geo.geometry.point\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="LineString"\r\n      [disabled]="geometryTypes.indexOf(\'LineString\') < 0">\r\n      {{\'igo.geo.geometry.line\' | translate}}\r\n    </mat-button-toggle>\r\n    <mat-button-toggle\r\n      value="Polygon"\r\n      [disabled]="geometryTypes.indexOf(\'Polygon\') < 0">\r\n      {{\'igo.geo.geometry.polygon\' | translate}}\r\n    </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<mat-form-field *ngIf="drawGuideField" class="draw-guide-field">\r\n  <input\r\n    matInput\r\n    type="number"\r\n    [placeholder]="drawGuidePlaceholder"\r\n    [(ngModel)]="drawGuide">\r\n  <mat-icon\r\n    matPrefix\r\n    [color]="\'primary\'"\r\n    svgIcon="adjust">    \r\n  </mat-icon>\r\n  <span matSuffix class="draw-guide-units">{{\'igo.geo.measure.meters\' | translate}}</span>\r\n</mat-form-field>',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;width:100%}.draw-guide-field,.geometry-type-toggle{width:100%}.geometry-type-toggle{padding:10px;text-align:center}.draw-guide-field mat-icon{margin:0 10px}.draw-guide-units{padding:10px}"]}]}],Ma.ctorParameters=function(){return[{type:je.ChangeDetectorRef}]},Ma.propDecorators={formControl:[{type:je.Input}],map:[{type:je.Input}],geometryType:[{type:je.Input}],geometryTypeField:[{type:je.Input}],geometryTypes:[{type:je.Input}],drawGuideField:[{type:je.Input}],drawGuide:[{type:je.Input}],drawGuidePlaceholder:[{type:je.Input}],measure:[{type:je.Input}],drawStyle:[{type:je.Input}],overlayStyle:[{type:je.Input}]},Ma=Ye([Ce.FormFieldComponent("geometry"),Ze("design:paramtypes",[je.ChangeDetectorRef])],Ma));function Ma(e){this.cdRef=e,this.value$=new Le.BehaviorSubject(undefined),this.drawControlIsActive=!0,this.freehandDrawIsActive=!1,this.geometryType$=new Le.BehaviorSubject(undefined),this.geometryTypeField=!1,this.geometryTypes=["Point","LineString","Polygon"],this.drawGuideField=!1,this.drawGuide$=new Le.BehaviorSubject(0),this.drawGuidePlaceholder="",this.measure=!1}var Pa={Length:"length",Area:"area"},ka={Meters:"meters",Kilometers:"kilometers",Miles:"miles",Feet:"feet"},Da=((Ca={})[ka.Meters]="m",Ca[ka.Kilometers]="km",Ca[ka.Miles]="mi",Ca[ka.Feet]="ft",Ca),ja={SquareMeters:"squareMeters",SquareKilometers:"squareKilometers",SquareMiles:"squareMiles",SquareFeet:"squareFeet",Hectares:"hectares",Acres:"acres"},Ea=((Ta={})[ja.SquareMeters]="m²",Ta[ja.SquareKilometers]="km²",Ta[ja.SquareMiles]="mi²",Ta[ja.SquareFeet]="ft²",Ta[ja.Hectares]="ha",Ta[ja.Acres]="ac",Ta);function $a(e){return.001*e}function Ra(e){return 3.2808*e}function Aa(e){return 621e-6*e}function Ba(e){return 1e-6*e}function Ga(e){return 3.861e-7*e}function _a(e){return 10.764*e}function qa(e){return 1e-4*e}function Na(e){return 24711e-8*e}function Va(e,t){var r=new Map([[ka.Meters,function(e){return e}],[ka.Kilometers,$a],[ka.Miles,Aa],[ka.Feet,Ra]]).get(t);return r?r(e):undefined}function Ua(e,t){var r=new Map([[ja.SquareMeters,function(e){return e}],[ja.SquareKilometers,Ba],[ja.SquareMiles,Ga],[ja.SquareFeet,_a],[ja.Hectares,qa],[ja.Acres,Na]]).get(t);return r?r(e):undefined}function Wa(e,t,r){var o=t.decimal;(o===undefined||o<0)&&(o=1);var n=[];return t.locale!==undefined?n.push(e.toLocaleString(t.locale,{minimumFractionDigits:o,maximumFractionDigits:o})):n.push(e.toFixed(o).toString()),t.unit!==undefined&&!0===t.unitAbbr&&(r?n.push(Da[t.unit]?r.translate.instant("igo.geo.measure."+Da[t.unit]):r.translate.instant("igo.geo.measure."+Ea[t.unit])):n.push(Da[t.unit]||Ea[t.unit])),n.filter(function(e){return e!==undefined}).join(" ")}function za(e){for(var t=ka.Meters,r=e,o=[ka.Kilometers];1e3<r&&0<o.length;)r=Va(e,t=o.pop());return t}function Ka(e){for(var t=ja.SquareMeters,r=e,o=[ja.SquareKilometers];1e6<r&&0<o.length;)r=Ua(e,t=o.pop());return t}function Ha(){return new we.Style({stroke:new we.Stroke({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new we.Fill({color:"rgba(255, 255, 255, 0.2)"}),image:new we.Circle({radius:5,stroke:new we.Stroke({color:"#ffcc33"}),fill:new we.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}function Ya(){return new we.Style({stroke:new we.Stroke({color:"#ffcc33",width:2}),fill:new we.Fill({color:"rgba(255, 255, 255, 0.2)"})})}function Za(e,t){return e instanceof U?undefined:0===e.getFlatCoordinates().length?undefined:K.getLength(e,{projection:t})}function Qa(e,t){return e instanceof U||e instanceof Y?undefined:0===e.getFlatCoordinates().length?undefined:K.getArea(e,{projection:t})}function Ja(e,t){for(var r=Za(e,t),o=Qa(e,t),n=[],i=e.flatCoordinates,a=i.length,s=0;s<=a-4;s+=2){var l=new Y([[i[s],i[s+1]],[i[s+2],i[s+3]]]);n.push(Za(l,t))}return{area:o,length:r,lengths:n}}function Xa(e){for(var t=es(e),r=e.flatCoordinates,o=t.length,n=0;n<o;n++){var i=2*n,a=new Y([[r[i],r[1+i]],[r[2+i],r[3+i]]]).getCoordinateAt(.5),s=t[n];s!==undefined?s.setCoordinates(a):t[n]=new U(a)}return t}function es(e){var t=Math.max(e.flatCoordinates.length/2-1,0),r=e.get("_midpoints");if(r===undefined)return r=new Array(t),e.set("_midpoints",r,!0),r;if(t===r.length)return r;if(t>r.length)return r.push.apply(r,Xe(new Array(t-r.length))),r;for(var o=t;o<r.length;o++){var n=r[t];n!==undefined&&ts(n)}return r.splice(t),r}function ts(e){var t=e.get("_tooltip");if(t!==undefined){var r=t.getMap();r!==undefined&&r.removeOverlay(t)}}function rs(e){return Xa(e).map(function(e){var t=e.get("_tooltip");return t===undefined?t=ls(e):t.setPosition(e.flatCoordinates),t})}function os(e){return es(e).map(function(e){return e?e.get("_tooltip"):undefined})}function ns(e){var t=e.get("_center"),r=z.getCenter(e.getExtent());return t!==undefined?t.setCoordinates(r):(t=new U(r),e.set("_center",t)),t}function is(e){var t=ns(e),r=t.get("_tooltip");return r===undefined?r=ls(t):r.setPosition(t.flatCoordinates),r}function as(e){var t=e.get("_center");return t?t.get("_tooltip"):undefined}function ss(e){var t=[].concat(os(e)||[]),r=as(e);return r!==undefined&&t.push(r),t}function ls(e){var t=new W({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1});return t.setPosition(e.flatCoordinates),e.set("_tooltip",t),t}var us,cs=(Ke(ps,us=Error),ps);function ps(){return null!==us&&us.apply(this,arguments)||this}var ds,hs=(Ke(gs,ds=cs),gs);function gs(){var e=ds.call(this,"Can't slice a MultiPolygon.")||this;return Object.setPrototypeOf(e,gs.prototype),e}var fs,ms=(Ke(ys,fs=cs),ys);function ys(){var e=fs.call(this,"Can't slice with a line that has more than 2 points.")||this;return Object.setPrototypeOf(e,ys.prototype),e}var vs,bs=(Ke(Ss,vs=cs),Ss);function Ss(){var e=vs.call(this,"More than 2 intersections found between the target polygon and the slicing line.")||this;return Object.setPrototypeOf(e,Ss.prototype),e}function ws(e){return e=e||[0,153,255],new we.Style({stroke:new we.Stroke({color:e.concat([1]),width:2}),fill:new we.Fill({color:e.concat([.2])}),image:new we.Circle({radius:8,stroke:new we.Stroke({color:e.concat([1])}),fill:new we.Fill({color:e.concat([.2])})})})}function Is(){return new we.Style({stroke:new we.Stroke({color:[0,153,255,1],width:2})})}function Os(e,t){return e instanceof te?xs(e,t):[]}function Fs(e,t){return[]}function xs(e,t){if(1<e.getLinearRingCount())throw new hs;if(2<t.getCoordinates().length)throw new ms;for(var r=(new Oe).writeGeometryObject(t),o=e.getLinearRing(0).getCoordinates(),n=[[],[]],i=0,a=0,s=o.length-1;a<s;a++){var l=[o[a],o[a+1]],u=Q.lineString(l),c=Z(u,r).features,p=c.length;if(i+=p,1<p||2<i)throw new bs;if(n[0].push(l[0]),1===p){var d=c[0].geometry.coordinates;n[0].push(d),n[1].push(d),n.reverse()}}return i<=1?[]:(n[0].push(n[0][0]),n[1].push(n[1][0]),[new te([n[0]]),new te([n[1]])])}function Cs(e,t){e.appendLinearRing(t)}function Ts(e){var t=e.target;return t instanceof te?t.flatCoordinates.slice(-4,-2):t.flatCoordinates.slice(-2)}var Ls=(Object.defineProperty(Ms.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Ms.prototype,"geometryType",{get:function(){return this.options.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(Ms.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Ms.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction()},Ms.prototype.getSource=function(){return this.olOverlaySource},Ms.prototype.createOlInnerOverlayLayer=function(){return new ie({source:this.options.source?this.options.source:new ne,style:this.options.layerStyle,zIndex:500})},Ms.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},Ms.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},Ms.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},Ms.prototype.addOlDrawInteraction=function(){var e,t=this;e=!1===this.freehand$.getValue()?new ee({type:this.geometryType,source:this.getSource(),stopClick:!0,style:this.options.drawStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:function(){return!1}}):"Point"===this.geometryType?new ee({type:"Circle",source:this.getSource(),maxPoints:this.options.maxPoints,freehand:!0}):new ee({type:this.geometryType,source:this.getSource(),maxPoints:this.options.maxPoints,freehand:!0}),this.onDrawStartKey=e.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=e.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(e),this.olDrawInteraction=e},Ms.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),fe.unByKey(this.onDrawStartKey),fe.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction),this.olDrawInteraction=undefined)},Ms.prototype.onDrawStart=function(e){var t=this,r=e.feature.getGeometry();this.start$.next(r),this.clearOlInnerOverlaySource(),this.onChangesKey=r.on("change",function(e){t.mousePosition=Ts(e),t.changes$.next(e.target)}),this.subscribeToKeyDown()},Ms.prototype.onDrawEnd=function(e){this.unsubscribeToKeyDown(),this.onChangesKey!==undefined&&fe.unByKey(this.onChangesKey),this.end$.next(e.feature.getGeometry())},Ms.prototype.subscribeToKeyDown=function(){var t=this;this.unsubscribeToKeyDown(),this.keyDown$$=Le.fromEvent(document,"keydown").subscribe(function(e){27!==e.keyCode?32!==e.keyCode||t.olMap.getView().animate({center:t.mousePosition,duration:0}):t.olDrawInteraction.removeLastPoint()})},Ms.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&(this.keyDown$$.unsubscribe(),this.keyDown$$=undefined)},Ms);function Ms(e){this.options=e,this.start$=new Le.Subject,this.end$=new Le.Subject,this.changes$=new Le.Subject,this.freehand$=new Le.BehaviorSubject(!1),e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}var Ps=(Object.defineProperty(ks.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(ks.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Object.defineProperty(ks.prototype,"olLinearRingsSource",{get:function(){return this.olLinearRingsLayer.getSource()},enumerable:!0,configurable:!0}),ks.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addOlDrawInteraction(),this.addOlTranslateInteraction(),this.activateTranslateInteraction(),this.addOlModifyInteraction(),this.activateModifyInteraction()},ks.prototype.getSource=function(){return this.olOverlaySource},ks.prototype.setOlGeometry=function(e){var t=new be({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},ks.prototype.createOlInnerOverlayLayer=function(){return new ie({source:this.options.source?this.options.source:new ne,style:this.options.layerStyle,zIndex:500})},ks.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},ks.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},ks.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},ks.prototype.createOlLinearRingsLayer=function(){return new ie({source:new ne,style:Is(),zIndex:500})},ks.prototype.addOlLinearRingsLayer=function(){this.olMap.addLayer(this.olLinearRingsLayer)},ks.prototype.removeOlLinearRingsLayer=function(){this.olMap.removeLayer(this.olLinearRingsLayer)},ks.prototype.clearOlLinearRingsSource=function(){this.olLinearRingsSource.clear(!0)},ks.prototype.addOlModifyInteraction=function(){var e=new J({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=e},ks.prototype.removeOlModifyInteraction=function(){this.olModifyInteraction!==undefined&&(this.deactivateModifyInteraction(),this.olModifyInteraction=undefined)},ks.prototype.activateModifyInteraction=function(){var t=this;!0!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",function(e){return t.onModifyStart(e)}),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",function(e){return t.onModifyEnd(e)}),this.olMap.addInteraction(this.olModifyInteraction))},ks.prototype.deactivateModifyInteraction=function(){!1!==this.olModifyInteractionIsActive&&(this.olModifyInteractionIsActive=!1,fe.unByKey(this.onModifyStartKey),fe.unByKey(this.onModifyEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olModifyInteraction))},ks.prototype.onModifyStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onModifyKey=r.on("change",function(e){t.mousePosition=Ts(e),t.changes$.next(e.target)}),this.subscribeToKeyDown()},ks.prototype.onModifyEnd=function(e){this.onModifyKey!==undefined&&fe.unByKey(this.onModifyKey),this.end$.next(e.features.item(0).getGeometry()),this.unsubscribeToKeyDown()},ks.prototype.subscribeToKeyDown=function(){var t=this;this.keyDown$$=Le.fromEvent(document,"keydown").subscribe(function(e){32!==e.keyCode||t.olMap.getView().animate({center:t.mousePosition,duration:0})})},ks.prototype.unsubscribeToKeyDown=function(){this.keyDown$$!==undefined&&this.keyDown$$.unsubscribe()},ks.prototype.addOlTranslateInteraction=function(){var e=new X({layers:[this.olOverlayLayer]});this.olTranslateInteraction=e},ks.prototype.removeOlTranslateInteraction=function(){this.olTranslateInteraction!==undefined&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=undefined)},ks.prototype.activateTranslateInteraction=function(){var t=this;!0!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",function(e){return t.onTranslateStart(e)}),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",function(e){return t.onTranslateEnd(e)}),this.olMap.addInteraction(this.olTranslateInteraction))},ks.prototype.deactivateTranslateInteraction=function(){!1!==this.olTranslateInteractionIsActive&&(this.olTranslateInteractionIsActive=!1,fe.unByKey(this.onTranslateStartKey),fe.unByKey(this.onTranslateEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olTranslateInteraction))},ks.prototype.onTranslateStart=function(e){var t=this,r=e.features.item(0).getGeometry();this.start$.next(r),this.onTranslateKey=r.on("change",function(e){t.changes$.next(e.target)})},ks.prototype.onTranslateEnd=function(e){this.onTranslateKey!==undefined&&fe.unByKey(this.onTranslateKey),this.end$.next(e.features.item(0).getGeometry())},ks.prototype.addOlDrawInteraction=function(){var t=this,e=new ee({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:Is(),condition:function(e){return(t.olOuterGeometry||t.getOlGeometry()).intersectsCoordinate(e.coordinate)}});this.olDrawInteraction=e,this.subscribeToDrawKeyDown()},ks.prototype.subscribeToDrawKeyDown=function(){var r=this;this.drawKeyDown$$=Le.fromEvent(document,"keydown").subscribe(function(e){if(17===e.keyCode){r.unsubscribeToDrawKeyDown();var t=r.getOlGeometry();t&&t instanceof te&&(r.subscribeToDrawKeyUp(),r.deactivateModifyInteraction(),r.deactivateTranslateInteraction(),r.activateDrawInteraction())}})},ks.prototype.subscribeToDrawKeyUp=function(){var t=this;this.drawKeyUp$$=Le.fromEvent(document,"keyup").subscribe(function(e){17===e.keyCode&&(t.unsubscribeToDrawKeyUp(),t.unsubscribeToKeyDown(),t.deactivateDrawInteraction(),t.activateModifyInteraction(),t.activateTranslateInteraction(),t.subscribeToDrawKeyDown(),t.end$.next(t.getOlGeometry()))})},ks.prototype.unsubscribeToDrawKeyDown=function(){this.drawKeyDown$$!==undefined&&this.drawKeyDown$$.unsubscribe()},ks.prototype.unsubscribeToDrawKeyUp=function(){this.drawKeyUp$$!==undefined&&this.drawKeyUp$$.unsubscribe()},ks.prototype.removeOlDrawInteraction=function(){this.olDrawInteraction!==undefined&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.olDrawInteraction=undefined)},ks.prototype.activateDrawInteraction=function(){var t=this;!0!==this.olDrawInteractionIsActive&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(function(e){e instanceof oe&&(t.olMap.removeInteraction(e),t.removedOlInteractions.push(e))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",function(e){return t.onDrawStart(e)}),this.onDrawEndKey=this.olDrawInteraction.on("drawend",function(e){return t.onDrawEnd(e)}),this.olMap.addInteraction(this.olDrawInteraction))},ks.prototype.deactivateDrawInteraction=function(){var t=this;!1!==this.olDrawInteractionIsActive&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(function(e){t.olMap.addInteraction(e)}),this.olDrawInteractionIsActive=!1,fe.unByKey(this.onDrawStartKey),fe.unByKey(this.onDrawEndKey),this.olMap!==undefined&&this.olMap.removeInteraction(this.olDrawInteraction))},ks.prototype.onDrawStart=function(e){var r=this,t=e.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();var o=t.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(o),this.start$.next(this.getOlGeometry()),this.onDrawKey=t.on("change",function(e){var t=e.target.getLinearRing().getCoordinates();r.updateLinearRingOfOlGeometry(t),r.changes$.next(r.getOlGeometry())}),this.subscribeToKeyDown()},ks.prototype.onDrawEnd=function(e){this.onDrawKey!==undefined&&fe.unByKey(this.onDrawKey),this.olOuterGeometry=undefined;var t=e.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(t),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()},ks.prototype.addLinearRingToOlGeometry=function(e){Cs(this.getOlGeometry(),new re(e))},ks.prototype.updateLinearRingOfOlGeometry=function(e){var t=this.getOlGeometry(),r=t.getLinearRings().slice(0,-1).map(function(e){return e.getCoordinates()});r.push(e),t.setCoordinates(r)},ks.prototype.getOlGeometry=function(){var e=this.olOverlaySource.getFeatures();return 0<e.length?e[0].getGeometry():undefined},ks);function ks(e){this.options=e,this.start$=new Le.Subject,this.end$=new Le.Subject,this.changes$=new Le.Subject,this.olModifyInteractionIsActive=!1,this.olTranslateInteractionIsActive=!1,this.olDrawInteractionIsActive=!1,this.removedOlInteractions=[],e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}var Ds=(Object.defineProperty(js.prototype,"active",{get:function(){return this.olMap!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(js.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),js.prototype.setOlMap=function(e){if(e===undefined)return this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeDrawLineControl(),void(this.olMap=e);this.olMap=e,this.addOlInnerOverlayLayer(),this.addDrawLineControl()},js.prototype.getSource=function(){return this.olOverlaySource},js.prototype.setOlGeometry=function(e){var t=new be({geometry:e});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(t)},js.prototype.createOlInnerOverlayLayer=function(){return new ie({source:this.options.source?this.options.source:new ne,style:this.options.layerStyle,zIndex:500})},js.prototype.removeOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap!==undefined&&this.olMap.removeLayer(this.olOverlayLayer)},js.prototype.addOlInnerOverlayLayer=function(){this.options.layer===undefined&&this.olMap.addLayer(this.olOverlayLayer)},js.prototype.clearOlInnerOverlaySource=function(){this.options.layer===undefined&&this.options.source===undefined&&this.olOverlaySource.clear()},js.prototype.addDrawLineControl=function(){var t=this;this.drawLineControl=new Ls({geometryType:"LineString",drawStyle:this.options.drawStyle,maxPoints:2}),this.drawLineStart$$=this.drawLineControl.start$.subscribe(function(e){return t.onDrawLineStart(e)}),this.drawLineEnd$$=this.drawLineControl.end$.subscribe(function(e){return t.onDrawLineEnd(e)}),this.drawLineControl.setOlMap(this.olMap)},js.prototype.removeDrawLineControl=function(){this.drawLineControl!==undefined&&(this.drawLineStart$$.unsubscribe(),this.drawLineEnd$$.unsubscribe(),this.drawLineControl.getSource().clear(),this.drawLineControl.setOlMap(undefined))},js.prototype.onDrawLineStart=function(e){this.drawLineControl.getSource().clear()},js.prototype.onDrawLineEnd=function(r){var t=this,o=[],e=r.getExtent(),n=[];try{this.olOverlaySource.forEachFeatureInExtent(e,function(e){var t=Os(e.getGeometry(),r);0<t.length&&(o.push.apply(o,Xe(t)),n.push(e))})}catch(i){if(i instanceof cs)return void this.error$.next(i);throw i}this.drawLineControl.getSource().clear(),this.olOverlaySource.addFeatures(o.map(function(e){return new be(e)})),n.forEach(function(e){t.olOverlaySource.removeFeature(e)}),this.error$.next(undefined),this.end$.next(o)},js);function js(e){this.options=e,this.end$=new Le.Subject,this.error$=new Le.Subject,e.layer!==undefined?this.olOverlayLayer=e.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer()}var Es=($s.prototype.onNoClick=function(){this.dialogRef.close()},$s.decorators=[{type:je.Component,args:[{selector:"igo-measurer-dialog",template:"<div mat-dialog-content>\r\n  <h3>{{'igo.geo.measure.dialog.title' | translate}}</h3>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\r\n        <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\r\n        <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\r\n        <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\r\n        <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n",styles:[':host{font-family:Roboto,"Helvetica Neue",sans-serif}h3{text-align:center;margin:0}table{width:100%;padding:10px}table tbody tr td:last-child{padding-left:10px}']}]}],$s.ctorParameters=function(){return[{type:Fe.MatDialogRef},{type:undefined,decorators:[{type:je.Inject,args:[Fe.MAT_DIALOG_DATA]}]}]},$s);function $s(e,t){this.dialogRef=e,this.data=t,this.measureAreaUnit=ja,this.measureLengthUnit=ka}var Rs=(Object.defineProperty(As.prototype,"activeMeasureType",{get:function(){return this._activeMeasureType},set:function(e){this.setActiveMeasureType(e)},enumerable:!0,configurable:!0}),Object.defineProperty(As.prototype,"drawControlIsActive",{get:function(){return this.activeDrawControl!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(As.prototype,"projection",{get:function(){return this.map.ol.getView().getProjection()},enumerable:!0,configurable:!0}),As.prototype.ngOnInit=function(){this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.onToggleTooltips(this.showTooltips),this.updateTooltipsOfOlSource(this.store.source.ol)},As.prototype.ngOnDestroy=function(){this.setActiveMeasureType(undefined),this.deactivateModifyControl(),this.freezeStore()},As.prototype.onMeasureTypeChange=function(e){this.activeMeasureType=e},As.prototype.onToggleDrawControl=function(e){!0===e?this.toggleDrawControl():this.deactivateDrawControl()},As.prototype.onToggleTooltips=function(e){!0===(this.showTooltips=e)?this.showTooltipsOfOlSource(this.store.source.ol):this.clearTooltipsOfOlSource(this.store.source.ol)},As.prototype.onToggleMeasureUnitsAuto=function(e){this.measureUnitsAuto=e},As.prototype.onLengthUnitChange=function(e){this.activeLengthUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},As.prototype.onAreaUnitChange=function(e){this.activeAreaUnit=e,this.table.refresh(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==undefined&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)},As.prototype.onCalculateClick=function(){var e=this.selectedFeatures$.value,t=e.reduce(function(e,t){return e+t.properties.measure.area||0},0),r=e.reduce(function(e,t){return"Polygon"===t.geometry.type?e:e+t.properties.measure.length||0},0),o=e.reduce(function(e,t){return"LineString"===t.geometry.type?e:e+t.properties.measure.length||0},0);this.openDialog({area:t,length:r,perimeter:o})},As.prototype.onDeleteClick=function(){this.store.deleteMany(this.selectedFeatures$.value)},As.prototype.onModifyClick=function(){if(1===this.selectedFeatures$.value.length)if(!0===this.modifyControl.active)this.deactivateModifyControl(),this.toggleDrawControl();else{var t=this.selectedFeatures$.value[0],e=this.store.layer.ol.getSource().getFeatures().find(function(e){return e.get("id")===t.properties.id});if(e!==undefined){this.deactivateDrawControl(),this.activateModifyControl();var r=e.getGeometry();this.clearTooltipsOfOlGeometry(r),this.modifyControl.setOlGeometry(r)}}},As.prototype.openDialog=function(e){this.dialog.open(Es,{data:e})},As.prototype.initStore=function(){var o=this,e=this.store;en(e,new Vr({title:"Measures",zIndex:200,source:new ct,style:Ya(),showInLayerList:!1,exportable:!1,browsable:!1})),tn(e),rn(e,new Vo({map:this.map,many:!0})),this.onFeatureAddedKey=e.source.ol.on("addfeature",function(e){var t=e.feature,r=t.getGeometry();o.updateMeasureOfOlGeometry(r,t.get("measure"))}),this.onFeatureRemovedKey=e.source.ol.on("removefeature",function(e){var t=e.feature.getGeometry();o.clearTooltipsOfOlGeometry(t)}),this.selectedFeatures$$=e.stateView.manyBy$(function(e){return!0===e.state.selected}).pipe(Pe.skip(1)).subscribe(function(e){!0===o.modifyControl.active&&o.deactivateModifyControl(),o.selectedFeatures$.next(e.map(function(e){return e.entity}))})},As.prototype.freezeStore=function(){var e=this.store;this.selectedFeatures$$.unsubscribe(),fe.unByKey(this.onFeatureAddedKey),fe.unByKey(this.onFeatureRemovedKey),this.clearTooltipsOfOlSource(e.source.ol),this.map.removeLayer(e.layer),e.deactivateStrategyOfType(ko),e.deactivateStrategyOfType(Vo)},As.prototype.createDrawLineControl=function(){this.drawLineControl=new Ls({geometryType:"LineString",source:this.olDrawSource,drawStyle:Ha(),layerStyle:new H({})})},As.prototype.createDrawPolygonControl=function(){this.drawPolygonControl=new Ls({geometryType:"Polygon",source:this.olDrawSource,drawStyle:Ha(),layerStyle:new H({})})},As.prototype.createModifyControl=function(){this.modifyControl=new Ps({source:this.olDrawSource,drawStyle:Ha(),layerStyle:new H({})})},As.prototype.toggleDrawControl=function(){this.deactivateDrawControl(),this.activeMeasureType===Pa.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===Pa.Area&&this.activateDrawControl(this.drawPolygonControl)},As.prototype.activateDrawControl=function(e){var t=this;this.activeDrawControl=e,this.drawStart$$=e.start$.subscribe(function(e){return t.onDrawStart(e)}),this.drawEnd$$=e.end$.subscribe(function(e){return t.onDrawEnd(e)}),this.drawChanges$$=e.changes$.subscribe(function(e){return t.onDrawChanges(e)}),e.setOlMap(this.map.ol)},As.prototype.deactivateDrawControl=function(){this.activeDrawControl!==undefined&&(this.olDrawSource.clear(),this.drawStart$$!==undefined&&this.drawStart$$.unsubscribe(),this.drawEnd$$!==undefined&&this.drawEnd$$.unsubscribe(),this.drawChanges$$!==undefined&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),this.activeOlGeometry!==undefined&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(undefined),this.activeDrawControl=undefined,this.activeOlGeometry=undefined)},As.prototype.setActiveMeasureType=function(e){this._activeMeasureType=e,this.clearMeasures(),this.toggleDrawControl()},As.prototype.onDrawStart=function(e){this.activeOlGeometry=e},As.prototype.onDrawEnd=function(e){this.activeOlGeometry=undefined,this.finalizeMeasureOfOlGeometry(e),this.addFeatureToStore(e),this.clearTooltipsOfOlGeometry(e),this.olDrawSource.clear(!0)},As.prototype.onDrawChanges=function(e){var t=Ja(e,this.projection);this.updateMeasureOfOlGeometry(e,Object.assign({},t,{area:undefined})),this.measure$.next(t)},As.prototype.activateModifyControl=function(){var t=this,e=this.store.getStrategyOfType(Vo);e.deactivate(),e.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(function(e){return t.onModifyStart(e)}),this.modifyEnd$$=this.modifyControl.end$.subscribe(function(e){return t.onModifyEnd(e)}),this.modifyChanges$$=this.modifyControl.changes$.subscribe(function(e){return t.onModifyChanges(e)}),this.modifyControl.setOlMap(this.map.ol)},As.prototype.deactivateModifyControl=function(){if(this.modifyStart$$!==undefined&&this.modifyStart$$.unsubscribe(),this.modifyEnd$$!==undefined&&this.modifyEnd$$.unsubscribe(),this.modifyChanges$$!==undefined&&this.modifyChanges$$.unsubscribe(),this.activeOlGeometry!==undefined){if(1===this.selectedFeatures$.value.length){var e=this.selectedFeatures$.value[0];this.addFeatureToStore(this.activeOlGeometry,e)}this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)}this.olDrawSource.clear(),this.store.activateStrategyOfType(Vo),this.activeOlGeometry=undefined,this.modifyControl.setOlMap(undefined)},As.prototype.onModifyStart=function(e){this.onDrawStart(e)},As.prototype.onModifyChanges=function(e){this.onDrawChanges(e)},As.prototype.onModifyEnd=function(e){this.finalizeMeasureOfOlGeometry(e)},As.prototype.finalizeMeasureOfOlGeometry=function(e){var t=Ja(e,this.projection);e instanceof te&&(t=Object.assign({},t,{lengths:[]})),this.updateMeasureOfOlGeometry(e,t)},As.prototype.updateMeasureOfOlGeometry=function(e,t){e.setProperties({_measure:t},!0),this.updateTooltipsOfOlGeometry(e)},As.prototype.clearMeasures=function(){this.measure$.next({})},As.prototype.addFeatureToStore=function(e,t){var r=t?t.properties.id:ke.uuid(),o=this.map.ol.getView().getProjection(),n=(new Oe).writeGeometryObject(e,{featureProjection:o,dataProjection:o});this.store.update({type:ur,geometry:n,projection:o.getCode(),properties:{id:r,measure:e.get("_measure")},meta:{id:r}})},As.prototype.updateTooltipsOfOlGeometry=function(e){var t=e.get("_measure"),r=t.lengths,o=t.area,n=rs(e);if(r.length===n.length)for(var i=0;i<n.length;i++){var a=r[i];a!==undefined&&this.updateOlTooltip(n[i],Va(a,this.activeLengthUnit),this.activeLengthUnit,Pa.Length)}o!==undefined&&this.updateOlTooltip(is(e),Ua(o,this.activeAreaUnit),this.activeAreaUnit,Pa.Area)},As.prototype.showTooltipsOfOlGeometry=function(e){var t=this;ss(e).forEach(function(e){t.shouldShowTooltip(e)&&t.map.ol.addOverlay(e)})},As.prototype.clearTooltipsOfOlGeometry=function(e){var t=this;ss(e).forEach(function(e){e!==undefined&&e.getMap()!==undefined&&t.map.ol.removeOverlay(e)})},As.prototype.updateTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.updateTooltipsOfOlGeometry(e.getGeometry())})},As.prototype.showTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){t.showTooltipsOfOlGeometry(e.getGeometry())})},As.prototype.clearTooltipsOfOlSource=function(e){var t=this;e.forEachFeature(function(e){e.getGeometry()!==undefined&&t.clearTooltipsOfOlGeometry(e.getGeometry())})},As.prototype.updateOlTooltip=function(e,t,r,o){e.setProperties({_measure:t,_unit:r,_type:o},!0),e.getElement().innerHTML=this.computeTooltipInnerHTML(e),this.shouldShowTooltip(e)&&this.map.ol.addOverlay(e)},As.prototype.computeTooltipInnerHTML=function(e){var t=e.getProperties();return Wa(t._measure,{decimal:1,unit:t._unit,unitAbbr:!0,locale:"fr"},this.languageService)},As.prototype.shouldShowTooltip=function(e){if(!1===this.showTooltips)return!1;var t=e.getProperties(),r=t._measure;if(r===undefined)return!1;if(t._unit!==Pa.Length)return!0;var o=Va(this.minSegmentLength,t._unit)||0;return r>Math.max(o,0)},As.decorators=[{type:je.Component,args:[{selector:"igo-measurer",template:'<div>\r\n  <div class="measure-type-toggle mat-typography">\r\n    <mat-button-toggle-group\r\n      [value]="activeMeasureType"\r\n      (change)="onMeasureTypeChange($event.value)">\r\n      <mat-button-toggle [value]="measureType.Length">\r\n        {{(\'igo.geo.measure.\' + measureType.Length) | translate}}\r\n      </mat-button-toggle>\r\n      <mat-button-toggle [value]="measureType.Area">\r\n        {{(\'igo.geo.measure.\' + measureType.Area) | translate}}\r\n      </mat-button-toggle>\r\n    </mat-button-toggle-group>\r\n  </div>\r\n\r\n  <div class="measure-options mat-typography">\r\n    <mat-slide-toggle\r\n      [checked]="drawControlIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleDrawControl($event.checked)">\r\n      {{\'igo.geo.measure.toggleActive\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="showTooltips"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleTooltips($event.checked)">\r\n      {{\'igo.geo.measure.toggleMapTooltips\' | translate}}\r\n    </mat-slide-toggle>\r\n\r\n    <mat-slide-toggle\r\n      [checked]="measureUnitsAuto"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onToggleMeasureUnitsAuto($event.checked)">\r\n      {{\'igo.geo.measure.toggleAutoUnits\' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <ng-container *ngIf="measure$ | async as measure">\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Length"\r\n      [measureUnit]="measureLengthUnit.Meters"\r\n      [measure]="measure.length"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="(activeMeasureType === measureType.Area ? \'igo.geo.measure.perimeter\' : \'igo.geo.measure.length\') | translate"\r\n      (measureUnitChange)="onLengthUnitChange($event)">\r\n    </igo-measurer-item>\r\n\r\n    <igo-measurer-item\r\n      [measureType]="measureType.Area"\r\n      [measureUnit]="measureAreaUnit.SquareMeters"\r\n      [measure]="measure.area"\r\n      [auto]="measureUnitsAuto"\r\n      [placeholder]="\'igo.geo.measure.area\' | translate"\r\n      (measureUnitChange)="onAreaUnitChange($event)">\r\n    </igo-measurer-item>\r\n  </ng-container>\r\n\r\n  <div class="measure-store-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.calculate.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onCalculateClick()">\r\n      <mat-icon svgIcon="calculator"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.delete.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length === 0"\r\n      (click)="onDeleteClick()">\r\n      <mat-icon svgIcon="delete"></mat-icon>\r\n    </button>\r\n\r\n    \x3c!--button\r\n      mat-icon-button\r\n      [matTooltip]="\'igo.geo.measure.actionbar.modify.tooltip\' | translate"\r\n      [disabled]="(selectedFeatures$ | async).length !== 1"\r\n      (click)="onModifyClick()">\r\n      <mat-icon svgIcon="edit"></mat-icon>\r\n    </button--\x3e\r\n  </div>\r\n\r\n  <igo-entity-table\r\n    #table\r\n    class="table-compact"\r\n    [store]="store"\r\n    [template]="tableTemplate">\r\n  </igo-entity-table>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".measure-type-toggle{padding:10px;text-align:center}.measure-type-toggle mat-button-toggle-group{width:100%}.measure-type-toggle mat-button-toggle-group mat-button-toggle{width:50%}.measure-options{overflow-x:hidden}.measure-options mat-slide-toggle{width:100%;margin:10px}.measure-options mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px)}.measure-store-buttons{width:100%;border-top:1px solid #ddd;border-bottom:1px solid #ddd}.measure-store-buttons button:first-of-type{margin-left:14px}.table-compact ::ng-deep .mat-header-cell.mat-column-selectionCheckbox{width:52px}"]}]}],As.ctorParameters=function(){return[{type:Ae.LanguageService},{type:Fe.MatDialog}]},As.propDecorators={map:[{type:je.Input}],store:[{type:je.Input}],activeMeasureType:[{type:je.Input}],minSegmentLength:[{type:je.Input}],table:[{type:je.ViewChild,args:["table"]}]},As);function As(e,t){var o=this;this.languageService=e,this.dialog=t,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:function(e){var t=o.activeLengthUnit;return Wa(Va(e.properties.measure.length,t),{decimal:1,unit:t,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:function(e){var t=o.activeAreaUnit,r=Ua(e.properties.measure.area,t);return r?Wa(r,{decimal:1,unit:t,unitAbbr:!1,locale:"fr"}):""}}]},this.measureType=Pa,this.measureAreaUnit=ja,this.measureLengthUnit=ka,this.measureUnitsAuto=!1,this.measure$=new Le.BehaviorSubject({}),this.selectedFeatures$=new Le.BehaviorSubject([]),this.showTooltips=!0,this.activeLengthUnit=ka.Meters,this.activeAreaUnit=ja.SquareMeters,this.olDrawSource=new ne,this._activeMeasureType=Pa.Length,this.minSegmentLength=10}var Bs=(Gs.prototype.transform=function(e,t,r,o){var n;return void 0===r&&(r=!1),void 0===o&&(o=1),0<=Object.values(ja).indexOf(t)?n=Ua(e,t):0<=Object.values(ka).indexOf(t)&&(n=Va(e,t)),n?Wa(n,{decimal:1,unit:t,unitAbbr:r,locale:"fr"}):n},Gs.decorators=[{type:je.Pipe,args:[{name:"measureFormat"}]}],Gs);function Gs(){}var _s=(Object.defineProperty(qs.prototype,"geometryType",{get:function(){return this._geometryType},set:function(e){this._geometryType=e,!1!==this.ready&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"drawControlIsActive",{get:function(){return this._drawControlIsActive},set:function(e){this._drawControlIsActive=e,!1!==this.ready&&(this.deactivateControl(),this._drawControlIsActive&&this.toggleControl())},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"freehandDrawIsActive",{get:function(){return this._freehandDrawIsActive},set:function(e){this._freehandDrawIsActive=e,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),!1!==this.ready&&this.drawControlIsActive&&this.toggleControl()},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"drawStyle",{get:function(){return this._drawStyle},set:function(e){e===undefined&&(e=ws()),(this._drawStyle=e)&&this.isStyleWithRadius(e)?this.defaultDrawStyleRadius=e.getImage().getRadius():this.defaultDrawStyleRadius=null,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl()},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"overlayStyle",{get:function(){return this._overlayStyle},set:function(e){this._overlayStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,!1!==this.ready&&(e?this.addGeoJSONToOverlay(e):this.olOverlaySource.clear(),this.onChange(e),this.toggleControl(),this.cdRef.detectChanges())},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"olOverlaySource",{get:function(){return this.olOverlayLayer.getSource()},enumerable:!0,configurable:!0}),Object.defineProperty(qs.prototype,"radius",{set:function(e){var t,r=this;!1!==this.ready&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive&&setTimeout(function(){(t=r.modifyControl.olModifyInteraction)&&t.features_&&t.features_.clear()},0))},enumerable:!0,configurable:!0}),qs.prototype.ngOnInit=function(){this.drawStyle===undefined&&(this.drawStyle=ws()),this.overlayStyle===undefined&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createMeasureTooltip(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0},qs.prototype.ngOnDestroy=function(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)},qs.prototype.registerOnChange=function(e){this.onChange=e},qs.prototype.registerOnTouched=function(e){this.onTouched=e},qs.prototype.writeValue=function(e){this.value=e},qs.prototype.addOlOverlayLayer=function(){this.olOverlayLayer=new ie({source:new ne,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)},qs.prototype.createDrawControl=function(){var o=this;this.drawControl=new Ls({geometryType:this.geometryType||"Point",layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:function(e,t){var r=o.drawStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},qs.prototype.createModifyControl=function(){var o=this;this.modifyControl=new Ps({layer:this.olOverlayLayer,drawStyle:"function"==typeof this.drawStyle?this.drawStyle:function(e,t){var r=o.drawStyle;return o.updateDrawStyleWithDrawGuide(r,t),r}})},qs.prototype.toggleControl=function(){this.deactivateControl(),this.drawControlIsActive&&(!this.value&&this.geometryType?this.activateControl(this.drawControl):this.activateControl(this.modifyControl))},qs.prototype.activateControl=function(e){var t=this;this.activeControl=e,this.olGeometryEnds$$=e.end$.subscribe(function(e){return t.onOlGeometryEnds(e)}),!0===this.measure&&e===this.drawControl&&(this.olGeometryChanges$$=e.changes$.subscribe(function(e){return t.onOlGeometryChanges(e)})),e.setOlMap(this.map.ol)},qs.prototype.deactivateControl=function(){this.removeMeasureTooltip(),this.activeControl!==undefined&&this.activeControl.setOlMap(undefined),this.olGeometryEnds$$!==undefined&&this.olGeometryEnds$$.unsubscribe(),this.olGeometryChanges$$!==undefined&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=undefined},qs.prototype.onOlGeometryEnds=function(e){this.removeMeasureTooltip(),this.setOlGeometry(e)},qs.prototype.onOlGeometryChanges=function(e){"Point"!==e.getType()&&this.updateMeasureTooltip(e)},qs.prototype.setOlGeometry=function(e){var t;e!==undefined&&("Circle"===e.getType()&&(e=this.circleToPoint(e)),t=this.olGeoJSON.writeGeometryObject(e,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"}),e.get("radius")&&(t.radius=e.get("radius"),e._radius=t.radius),this.writeValue(t))},qs.prototype.circleToPoint=function(e){var t=e.getCenter(),r=Se.transform(t,this.map.projection,"EPSG:4326"),o=Math.round(e.getRadius()*Math.cos(Math.PI/180*r[1]));return(e=new U(t)).set("radius",o,!0),e},qs.prototype.addGeoJSONToOverlay=function(e){var t=this.olGeoJSON.readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),r=new be({geometry:t});r.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(r)},qs.prototype.createMeasureTooltip=function(){this.olTooltip=new W({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})},qs.prototype.updateMeasureTooltip=function(e){var t=Ja(e,this.map.projection).lengths,r="Polygon"===e.getType()?t.length-2:t.length-1,o=t[r],n=Xa(e),i=n[r];if(0!==n.length&&i!==undefined){this.olTooltip.setPosition(i.flatCoordinates);var a=Wa(o,{decimal:1,unit:ka.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=a,this.olTooltip.getMap()===undefined&&this.map.ol.addOverlay(this.olTooltip)}else this.removeMeasureTooltip()},qs.prototype.removeMeasureTooltip=function(){this.olTooltip.getMap&&this.olTooltip.getMap()!==undefined&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(undefined))},qs.prototype.updateDrawStyleWithDrawGuide=function(e,t){if(this.isStyleWithRadius(e)){var r=this.drawGuide,o=void 0;o=!r||r<0?this.defaultDrawStyleRadius:0<r?r/t:r,e.getImage().setRadius(o)}},qs.prototype.isStyleWithRadius=function(e){return"function"!=typeof e&&e.getImage&&e.getImage().setRadius},qs.decorators=[{type:je.Component,args:[{selector:"igo-geometry-form-field-input",template:"<ng-template></ng-template>",changeDetection:je.ChangeDetectionStrategy.OnPush}]}],qs.ctorParameters=function(){return[{type:je.ChangeDetectorRef},{type:ve.NgControl,decorators:[{type:je.Optional},{type:je.Self}]}]},qs.propDecorators={map:[{type:je.Input}],geometryType:[{type:je.Input}],drawGuide:[{type:je.Input}],measure:[{type:je.Input}],drawControlIsActive:[{type:je.Input}],freehandDrawIsActive:[{type:je.Input}],drawStyle:[{type:je.Input}],overlayStyle:[{type:je.Input}],value:[{type:je.Input}],radius:[{type:je.Input}]},qs);function qs(e,t){this.cdRef=e,this.ngControl=t,this.olGeoJSON=new Oe,this.ready=!1,this.olTooltip=W,this.drawGuide=null,this.measure=!1,this._drawControlIsActive=!0,this.onChange=function(){},this.onTouched=function(){},this.ngControl!==undefined&&(this.ngControl.valueAccessor=this)}var Ns=(Vs.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,ve.FormsModule,ve.ReactiveFormsModule,Fe.MatIconModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatButtonModule,Fe.MatButtonToggleModule,Ae.IgoLanguageModule],exports:[La,_s],declarations:[La,_s]}]}],Vs);function Vs(){}var Us=(Ws.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Ns],exports:[Ns],declarations:[],providers:[],entryComponents:[La]}]}],Ws);function Ws(){}var zs=(Object.defineProperty(Ks.prototype,"badge",{get:function(){var e=this.options.timeFilter;return e&&e.enabled?1:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Ks.prototype,"layer",{get:function(){return this._layer},set:function(e){(this._layer=e)&&(this.options=this.layer.dataSource.options)},enumerable:!0,configurable:!0}),Ks.prototype.ngOnInit=function(){this.options=this.layer.dataSource.options},Ks.decorators=[{type:je.Component,args:[{selector:"igo-time-filter-button",template:'<button *ngIf="header && options.timeFilterable && options.timeFilter"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.filterBy\' | translate"\r\n  [color]="color">\r\n  <mat-icon [matBadge]="badge" matBadgeColor="warn" matBadgeSize="medium" svgIcon="history"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class="igo-layer-actions-container"\r\n*ngIf="header && options.timeFilterable && options.timeFilter">\r\n  <igo-time-filter-item\r\n    *ngIf="timeFilterCollapse && options.timeFilter"\r\n    igoListItem\r\n    [header]="false"\r\n    [layer]="layer">\r\n  </igo-time-filter-item>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Ks.ctorParameters=function(){return[]},Ks.propDecorators={layer:[{type:je.Input}],map:[{type:je.Input}],color:[{type:je.Input}],header:[{type:je.Input}]},Ks);function Ks(){this.color="primary",this.header=!0,this.timeFilterCollapse=!1}var Hs=(Object.defineProperty(Ys.prototype,"currentValue",{set:function(e){if(e&&this.type!==Vn.YEAR){var t=e.split("/");if(0<t.length){var r=new Date(t[0]),o=new Date(t[1]);isNaN(r.valueOf())||(this.startDate=r),isNaN(o.valueOf())||(this.endDate=o)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"type",{get:function(){return this.options.type===undefined?Vn.DATE:this.options.type},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"isRange",{get:function(){return this.options.range!==undefined&&this.options.style!==Un.SLIDER&&this.options.range},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"style",{get:function(){return this.options.style===undefined?Un.SLIDER:this.options.style},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"step",{get:function(){var e=108e5;if(this.options.step===undefined)switch(this.type){case Vn.DATE:case Vn.DATETIME:e=108e5;break;case Vn.TIME:e=36e5;break;case Vn.YEAR:e=31536e6;break;default:e=108e5}else e=this.getStepDefinition(this.options.step);return e},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"timeInterval",{get:function(){return this.options.timeInterval===undefined?2e3:this.options.timeInterval},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"min",{get:function(){if(this.options.min){var e=new Date(this.options.min);return new Date(e.getTime()+6e4*e.getTimezoneOffset())}return undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"max",{get:function(){if(this.options.max){var e=new Date(this.options.max);return new Date(e.getTime()+6e4*e.getTimezoneOffset())}return undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Ys.prototype,"is",{get:function(){return this.options.range!==undefined&&this.options.range},enumerable:!0,configurable:!0}),Ys.prototype.ngOnInit=function(){if(this.startDate===undefined&&(this.startDate=new Date(this.min)),this.endDate===undefined&&(this.endDate=new Date(this.max)),this.startYear===undefined&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),this.endYear===undefined&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(e=this.startYear;e<this.endYear;e++)this.startListYears.push(e);for(e=this.startYear+1;e<=this.endYear;e++)this.endListYears.push(e)}else for(var e=this.startYear;e<=this.endYear+1;e++)this.listYears.push(e);this.options.enabled=this.options.enabled===undefined||this.options.enabled,this.checkFilterValue(),this.options.enabled?this.isRange||"slider"!==this.style||"year"!==this.type||this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(undefined))},Ys.prototype.storeCurrentFilterValue=function(){this.isRange||this.style!==Un.SLIDER||this.type!==Vn.YEAR||(this.options.value=this.year.toString())},Ys.prototype.checkFilterValue=function(){var e=this.layer.dataSource.ol.getParams().TIME;if(this.isRange||this.style!==Un.SLIDER||this.type!==Vn.YEAR){if(this.isRange&&this.style===Un.CALENDAR&&this.type===Vn.YEAR&&e){this.startYear=parseInt(e.substr(0,4),10),this.endYear=parseInt(e.substr(5,4),10);for(var t=[],r=[],o=this.initStartYear;o<this.endYear;o++)t.push(o);for(o=this.startYear+1;o<=this.initEndYear;o++)r.push(o);this.startListYears=t,this.endListYears=r}}else e?this.year=new Date(e.toString()).getFullYear()+1:this.options.value?this.year=new Date(this.options.value.toString()).getFullYear()+1:this.year=new Date(this.min).getFullYear()+1},Ys.prototype.handleDateChange=function(e){this.setupDateOutput(),this.applyTypeChange(),this.isRange?this.change.emit([this.startDate,this.endDate]):this.change.emit(this.startDate)},Ys.prototype.handleYearChange=function(e){if(this.isRange){this.endListYears=[];for(var t=this.startYear+1;t<=this.initEndYear;t++)this.endListYears.push(t);for(this.startListYears=[],t=this.initStartYear+1;t<this.endYear;t++)this.startListYears.push(t);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)},Ys.prototype.handleListYearChange=function(e){this.handleYearChange([this.startYear,this.endYear])},Ys.prototype.handleListYearStartChange=function(e){this.change.emit([this.startDate,this.endDate])},Ys.prototype.dateToNumber=function(e){return(e?new Date(e):new Date(this.min)).getTime()},Ys.prototype.setSliderThumbLabel=function(e){var t=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);t&&(t.textContent=e)},Ys.prototype.findThumbLabel=function(e){var t,r=this;return e.forEach(function(e){"mat-slider-thumb-label-text"===e.className&&(t=e),0<e.children.length&&!t&&(t=r.findThumbLabel(e.childNodes))},this),t},Ys.prototype.toggleFilterState=function(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Un.SLIDER&&this.type===Vn.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(undefined))},Ys.prototype.resetFilter=function(e){this.date=new Date(this.min),this.year=this.date.getFullYear()+1,!this.isRange&&Un.SLIDER&&this.type===Vn.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(undefined))},Ys.prototype.playFilter=function(e){this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(e){var t,r=new Date(e.max);t=e.date===undefined?e.min.getTime():e.date.getTime(),t+=e.mySlider.step,e.date=new Date(t),t>r.getTime()&&e.stopFilter(),e.handleDateChange({value:e.date,date:e.date})},this.timeInterval,this))},Ys.prototype.playYear=function(e){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter(e)),this.interval?this.stopFilter():(this.playIcon="pause-circle",this.interval=setInterval(function(e){e.year=e.year+e.mySlider.step,e.year>e.max.getFullYear()&&e.stopFilter(),e.yearChange.emit(e.year)},this.timeInterval,this))},Ys.prototype.stopFilter=function(){this.interval&&clearInterval(this.interval),this.interval=undefined,this.playIcon="play-circle"},Ys.prototype.handleSliderDateChange=function(e){this.date=new Date(e.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange(e)},Ys.prototype.handleSliderYearChange=function(e){this.year=e.value,this.yearChange.emit(this.year)},Ys.prototype.handleSliderValue=function(){if(!0===this.options.current||!this.min){var e=new Date;this.date=this.getRoundedDate(e)}return this.type===Vn.YEAR?this.year:this.date===undefined?this.min.getTime():this.date.getTime()},Ys.prototype.handleSliderTooltip=function(){var e;switch(this.type){case Vn.DATE:e=this.date===undefined?this.min.toDateString():this.date.toDateString();break;case Vn.TIME:e=this.date===undefined?this.min.toTimeString():this.date.toTimeString();break;default:e=this.date===undefined?this.min.toUTCString():this.date.toUTCString()}return e},Ys.prototype.setupDateOutput=function(){this.style===Un.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-this.step/1e3),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):(!this.isRange||!this.date&&this.date)&&this.date||(this.startDate=this.startDate===undefined?new Date(this.min):this.startDate,this.endDate=this.endDate===undefined?new Date(this.max):this.endDate)},Ys.prototype.applyTypeChange=function(){switch(this.type){case Vn.DATE:this.startDate===undefined&&this.endDate===undefined||(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case Vn.TIME:if(this.style===Un.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){var e=this.startDate.getHours(),t=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(e),this.startDate.setMinutes(t)}this.endDate.getDay()!==this.min.getDay()&&(e=this.endDate.getHours(),t=this.endDate.getMinutes(),this.endDate=this.min,this.endDate.setHours(e),this.endDate.setMinutes(t))}!this.isRange&&36e5<this.step&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59))}},Ys.prototype.getRangeMinDate=function(){return this.startDate===undefined?this.min:this.startDate},Ys.prototype.getRangeMaxDate=function(){return this.endDate===undefined?this.max:this.endDate},Ys.prototype.getRoundedDate=function(e,t){void 0===t&&(t=10);var r=6e4*t;return new Date(Math.round(e.getTime()/r)*r)},Ys.prototype.getStepDefinition=function(e){return ae.duration(e).asMilliseconds()},Ys.decorators=[{type:je.Component,args:[{selector:"igo-time-filter-form",template:'<div *ngIf="style === \'calendar\' && type !==\'year\'">\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n    <mat-form-field>\r\n      <mat-datetimepicker-toggle [for]="datetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n      <mat-datetimepicker #datetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n      <input matInput autocomplete="false"\r\n        placeholder="{{\'igo.geo.timeFilter.date\' | translate}}"\r\n        [matDatetimepicker]="datetimePicker"\r\n        [(ngModel)]="date"\r\n        [min]="min"\r\n        [max]="max"\r\n        readonly="readonly"\r\n        (dateChange)="handleDateChange($event)">\r\n    </mat-form-field>\r\n\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="minDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #minDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}"\r\n          [matDatetimepicker]="minDatetimePicker"\r\n          [(ngModel)]="startDate"\r\n          [min]="min"\r\n          [max]="getRangeMaxDate()"\r\n          readonly="readonly"\r\n          (input)="startDate"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n      <mat-form-field>\r\n        <mat-datetimepicker-toggle [for]="maxDatetimePicker" matSuffix></mat-datetimepicker-toggle>\r\n        <mat-datetimepicker #maxDatetimePicker type="{{type}}" openOnFocus="true" timeInterval="5"></mat-datetimepicker>\r\n        <input matInput autocomplete="false"\r\n          placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}"\r\n          [matDatetimepicker]="maxDatetimePicker"\r\n          [(ngModel)]="endDate"\r\n          [min]="getRangeMinDate()"\r\n          [max]="max"\r\n          readonly="readonly"\r\n          (dateChange)="handleDateChange($event)">\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div *ngIf="style === \'calendar\' && type ===\'year\'">\r\n\r\n  <div *ngIf="!isRange" class="igo-col igo-col-100 igo-col-100-m">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.date\' | translate}}" [(ngModel)]="year" (selectionChange)="handleYearChange($event)">\r\n                  <mat-option [value]="year" *ngFor="let year of listYears">{{year}}</mat-option>\r\n            </mat-select>\r\n        </mat-form-field>\r\n  </div>\r\n\r\n  <div *ngIf="isRange">\r\n    <div class="igo-col igo-col-100">\r\n        <mat-form-field>\r\n            <mat-select placeholder="{{\'igo.geo.timeFilter.startDate\' | translate}}" [(ngModel)]="startYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="startYear" *ngFor="let startYear of startListYears">{{startYear}}</mat-option>\r\n            </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n\r\n    <div class="igo-col igo-col-100">\r\n    <mat-form-field>\r\n        <mat-select placeholder="{{\'igo.geo.timeFilter.endDate\' | translate}}" [(ngModel)]="endYear" (selectionChange)="handleYearChange($event)">\r\n              <mat-option [value]="endYear" *ngFor="let endYear of endListYears">{{endYear}}</mat-option>\r\n        </mat-select>\r\n      </mat-form-field>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n  <br>\r\n  <div *ngIf="!isRange && style === \'slider\' && type === \'year\'" class="igo-col igo-col-100 igo-col-100-m mat-typography">\r\n    <span>{{startYear}}</span>\r\n    <mat-slider\r\n        id="time-slider"\r\n        tickInterval="auto"\r\n        step="{{step}}"\r\n        [min]="startYear"\r\n        [max]="endYear"\r\n        [value]="handleSliderValue()"\r\n        [color]="color"\r\n        thumbLabel\r\n        (input)="handleSliderYearChange($event)"\r\n        (change)="handleSliderYearChange($event)"\r\n        [disabled]= "!options.enabled || !layer.visible">\r\n    </mat-slider>\r\n    <span>{{endYear}}</span>\r\n    <p *ngIf= "options.enabled" class="date-below">{{year}}</p>\r\n    <div #actions class="igo-layer-actions-container">\r\n      <mat-slide-toggle (change)="toggleFilterState()" tooltip-position="below" matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.filter.toggleFilterState\' | translate" [color]="color" [checked]="options.enabled"\r\n        [disabled]="!layer.visible">\r\n      </mat-slide-toggle>\r\n      <button [disabled]= "!options.enabled  || !layer.visible" mat-icon-button color="primary" (click)="playYear($event)">\r\n        <mat-icon svgIcon="{{playIcon}}"></mat-icon>\r\n       </button>\r\n      <button [disabled]="!options.enabled  || !layer.visible" mat-icon-button color="primary" (click)="resetFilter($event)">\r\n        <mat-icon svgIcon="{{resetIcon}}"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n<div *ngIf="style === \'slider\' && type !== \'year\'" class="igo-col igo-col-100 igo-col-100-m">\r\n  <mat-slider\r\n      id="time-slider"\r\n      tickInterval="auto"\r\n      step="{{step}}"\r\n      [min]="dateToNumber(min)"\r\n      [max]="dateToNumber(max)"\r\n      [value]="handleSliderValue()"\r\n      thumbLabel\r\n      (input)="handleSliderDateChange($event)"\r\n      (selectionChange)="handleSliderDateChange($event)">\r\n  </mat-slider>\r\n  <p class="date-below">{{handleSliderTooltip()}}</p>\r\n  <button mat-icon-button color="primary" (click)="playFilter($event)">\r\n   <mat-icon svgIcon="{{playIcon}}"></mat-icon>\r\n  </button>\r\n</div>\r\n',styles:[".igo-layer-filters-container{padding-left:5px}mat-slider>>>div.mat-slider-thumb-label{width:32px;height:32px;margin:0 auto}mat-slider>>>span.mat-slider-thumb-label-text{font-size:10px}#time-slider{width:70%;margin:0 auto}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){#time-slider{width:60%;margin:0 auto}}.date-below{margin:0}mat-form-field{text-align:center}mat-datetimepicker-toggle ::ng-deep .mat-icon{padding-bottom:30px}.igo-layer-actions-container>.mat-slide-toggle{vertical-align:middle}"]}]}],Ys.ctorParameters=function(){return[{type:Fe.DateAdapter}]},Ys.propDecorators={layer:[{type:je.Input}],options:[{type:je.Input}],currentValue:[{type:je.Input}],change:[{type:je.Output}],yearChange:[{type:je.Output}],mySlider:[{type:je.ViewChild,args:[Fe.MatSlider]}]},Ys);function Ys(e){this.dateAdapter=e,this.color="primary",this.listYears=[],this.startListYears=[],this.endListYears=[],this.playIcon="play-circle",this.resetIcon="replay",this.change=new je.EventEmitter,this.yearChange=new je.EventEmitter,this.dateAdapter.setLocale("fr")}var Zs=(Object.defineProperty(Qs.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),Qs.prototype.handleYearChange=function(e){this.timeFilterService.filterByYear(this.datasource,e)},Qs.prototype.handleDateChange=function(e){this.timeFilterService.filterByDate(this.datasource,e)},Qs.prototype.toggleLegend=function(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)},Qs.prototype.toggleLegendOnClick=function(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)},Qs.prototype.setVisible=function(){this.layer.visible=!0},Qs.prototype.toggleFiltersCollapsed=function(){this.filtersCollapsed=!this.filtersCollapsed},Qs.decorators=[{type:je.Component,args:[{selector:"igo-time-filter-item",template:'<mat-list-item *ngIf="header">\r\n  <mat-icon\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse\r\n    [target]="filters"\r\n    [collapsed]="filtersCollapsed"\r\n    (click)="toggleFiltersCollapsed()"\r\n    svgIcon="chevron-up" >\r\n  </mat-icon>\r\n  <h4 (click)="toggleLegendOnClick()" [ngStyle]="{\'cursor\': filtersCollapsed ? \'default\' : \'pointer\'}"  matLine>{{layer.title}}</h4>\r\n  \r\n  <button *ngIf="!layer.visible" mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.layer.showLayer\' | translate" color="color" (click)="setVisible()">\r\n    <mat-icon svgIcon="eye-off"></mat-icon>\r\n  </button>\r\n\r\n</mat-list-item>\r\n\r\n<div #filters class="igo-datasource-filters-container">\r\n  <div #legend class="igo-layer-legend-container">\r\n    <igo-layer-legend *ngIf="showLegend$ | async" [layer]="layer">\r\n    </igo-layer-legend>\r\n  </div>\r\n  <igo-time-filter-form\r\n    [layer]= "layer"\r\n    [options]="datasource.options.timeFilter"\r\n    [currentValue]="datasource.options.params.TIME"\r\n    (change)="handleDateChange($event)"\r\n    (yearChange)="handleYearChange($event)">\r\n  </igo-time-filter-form>\r\n</div>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block;padding-top:5px}.igo-layer-legend-container{padding-left:1.125em;width:calc(100% - 18px)}"]}]}],Qs.ctorParameters=function(){return[{type:na}]},Qs.propDecorators={header:[{type:je.Input}],layer:[{type:je.Input}]},Qs);function Qs(e){this.timeFilterService=e,this.color="primary",this.showLegend$=new Le.BehaviorSubject(!1),this.filtersCollapsed=!1,this.header=!0}var Js=(Object.defineProperty(Xs.prototype,"layers",{get:function(){return this._layers},set:function(e){this._layers=e,this.cdRef.detectChanges()},enumerable:!0,configurable:!0}),Xs.decorators=[{type:je.Component,args:[{selector:"igo-time-filter-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'time\'">\r\n    <igo-time-filter-item [header]="true" igoListItem [layer]="layer"></igo-time-filter-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush}]}],Xs.ctorParameters=function(){return[{type:je.ChangeDetectorRef}]},Xs.propDecorators={layers:[{type:je.Input}]},Xs);function Xs(e){this.cdRef=e,this._layers=[]}var el=(tl.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},tl.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},tl.decorators=[{type:je.Directive,args:[{selector:"[igoTimeFilterListBinding]"}]}],tl.ctorParameters=function(){return[{type:Js,decorators:[{type:je.Self}]},{type:So}]},tl);function tl(e,t){this.mapService=t,this.component=e}var rl=(ol.prototype.wktToFeature=function(e,t,r){return(new Te).readFeature(e,{dataProjection:t,featureProjection:r})},ol.prototype.extentToWkt=function(e,t,r){var o=Se.transformExtent(t,r,e);return o=this.roundCoordinateArray(o,e,0),{wktPoly:"POLYGON((\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+"))",wktLine:"LINESTRING(\n      "+t[0]+" "+t[1]+",\n      "+t[0]+" "+t[3]+",\n      "+t[2]+" "+t[3]+",\n      "+t[2]+" "+t[1]+",\n      "+t[0]+" "+t[1]+")",wktMultiPoints:"MULTIPOINT(\n        "+t[0]+" "+t[1]+",\n        "+t[0]+" "+t[3]+",\n        "+t[2]+" "+t[3]+",\n        "+t[2]+" "+t[1]+")"}},ol.prototype.roundCoordinateArray=function(e,t,r){void 0===r&&(r=0);var o=Se.get(t).getUnits();return-1!==["ft","m","us-ft"].indexOf(o)&&(e=this.roundArray(e,r)),e},ol.prototype.roundArray=function(e,t){void 0===t&&(t=0);for(var r=0;r<e.length;)e[r]=e[r].toFixed(t),r++;return e},ol.prototype.snrcToWkt=function(e,t){e=e.toLowerCase();var r=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],o=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]],n=!1,i=!1,a=!1;if(/\d{2,3}[a-p][0,1][0-9]/gi.test(e)?a=!0:/\d{2,3}[a-p]/gi.test(e)?i=!0:/\d{2,3}/gi.test(e)&&(n=!0),n?e+="a01":i&&(e+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(e)){var s=e.split(/(?=[a-p])/gi),l=s[0],u=s[1][0],c=s[1].split(u)[1],p=1;3===l.length&&(p=2);var d=l.substring(0,p),h=l.substring(p),g=0,f=0,m=0,y=0;r.forEach(function(e){-1!==e.indexOf(u)&&(f=r.indexOf(e),g=e.indexOf(u))}),o.forEach(function(e){-1!==e.indexOf(c)&&(y=o.indexOf(e),m=e.indexOf(c))});var v=0,b=0,S=0,w=0,I=8,O=4;i?(v=2*g,b=1*f,w=S=0,I=2,O=1):a&&(v=2*g,b=1*f,S=.5*m,w=.25*y,I=.5,O=.25);var F={ul:[{1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}}[d].to+v+S,{1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}}[h].to-b-w]};return F.lr=[F.ul[0]+I,F.ul[1]-O],F.ur=[F.ul[0],F.ul[1]-O],F.ll=[F.ul[0]+I,F.ul[1]],F.ul=Se.transform([F.ul[0],F.ul[1]],"EPSG:4326",t),F.lr=Se.transform([F.lr[0],F.lr[1]],"EPSG:4326",t),F.ur=Se.transform([F.ur[0],F.ur[1]],"EPSG:4326",t),F.ll=Se.transform([F.ll[0],F.ll[1]],"EPSG:4326",t),F.ul=this.roundCoordinateArray(F.ul,t,0),F.lr=this.roundCoordinateArray(F.lr,t,0),F.ur=this.roundCoordinateArray(F.ur,t,0),F.ll=this.roundCoordinateArray(F.ll,t,0),{wktPoly:"POLYGON(("+[F.ul.join(" "),F.ur.join(" "),F.lr.join(" "),F.ll.join(" "),F.ul.join(" ")].join(",")+"))",wktLine:"LINESTRING("+[F.ul.join(" "),F.ur.join(" "),F.lr.join(" "),F.ll.join(" "),F.ul.join(" ")].join(",")+")",wktMultiPoints:"MULTIPOINT("+[F.ul.join(" "),F.ur.join(" "),F.lr.join(" "),F.ll.join(" ")].join(",")+")"}}},ol.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],ol.ctorParameters=function(){return[]},ol.ngInjectableDef=je.defineInjectable({factory:function(){return new ol},token:ol,providedIn:"root"}),ol);function ol(){}var nl=(Object.defineProperty(il.prototype,"currentFilter",{get:function(){return this.currentFilter$.value},set:function(e){this.currentFilter$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(il.prototype,"activeFilters",{get:function(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return!0===e.active})},enumerable:!0,configurable:!0}),il.prototype.ngOnInit=function(){this.updateField()},il.prototype.updateField=function(){var t=this;if(this.datasource.options.sourceFields){var e=this.datasource.options.sourceFields.filter(function(e){return e.excludeFromOgcFilters===undefined||!e.excludeFromOgcFilters});e.filter(function(e){return e.name===t.currentFilter.propertyName}).forEach(function(e){t.values=e.values!==undefined?e.values.sort():[]}),this.fields$.next(e);var r=(new vt).computeAllowedOperators(e,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType);this.ogcFilterOperators$.next(r),-1===Object.keys(r).indexOf(this.currentFilter$.value.operator)&&(this.currentFilter$.value.operator=Object.keys(r)[0]),this.refreshFilters()}},il.prototype.toggleFilterState=function(e,t,r){this.updateField(),e.checked?this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!0}):(this.removeOverlayByID(t.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=!1})),this.refreshFilters()},il.prototype.deleteFilter=function(t){var e=this.datasource.options.ogcFilters;e.interfaceOgcFilters=e.interfaceOgcFilters.filter(function(e){return e.filterid!==t.filterid}),this.removeOverlayByID(t.filterid),this.refreshFilters()},il.prototype.changeNumericProperty=function(e,t,r){this.changeProperty(e,t,parseFloat(r)),this.refreshFilters()},il.prototype.removeOverlayByID=function(e){var t=this.baseOverlayName+e;this.map.overlay.dataSource.ol.getFeatureById(t)&&this.map.overlay.dataSource.ol.removeFeature(this.map.overlay.dataSource.ol.getFeatureById(t))},il.prototype.changeOperator=function(e){!1===this.ogcFilterOperators$.value[e.operator].spatial&&this.removeOverlayByID(e.filterid),this.refreshFilters()},il.prototype.changeCaseSensitive=function(e){this.currentFilter.matchCase=e.checked,this.refreshFilters()},il.prototype.changeProperty=function(t,r,o){this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===t.filterid}).forEach(function(e){e[r]=o}),this.refreshFilters()},il.prototype.changeGeometry=function(r,o){var n=this,i=/\d{2,3}[a-l][0,1][0-9]/gi,a=/\d{2,3}[a-p]/gi,s=/\d{2,3}/gi,l=this.map.projection;this.removeOverlayByID(r.filterid),this.datasource.options.ogcFilters.interfaceOgcFilters.filter(function(e){return e.filterid===r.filterid}).forEach(function(e){var t;"snrc"===r.igoSpatialSelector?""===o&&""!==n.snrc?(t=n.wktService.snrcToWkt(n.snrc,n.map.projection).wktPoly,e.wkt_geometry=t):""!==o&&(s.test(o)||a.test(o)||i.test(o))&&(t=n.wktService.snrcToWkt(o,n.map.projection).wktPoly,e.wkt_geometry=t):"fixedExtent"===r.igoSpatialSelector&&(t=n.wktService.extentToWkt(l,n.map.viewController.getExtent(),l).wktPoly,e.wkt_geometry=t)}),this.refreshFilters()},il.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filter-form",template:'<mat-list-item class="mat-typography">\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m">\r\n    <mat-select class="logical" [disabled]="!currentFilter.active" (selectionChange)="refreshFilters()" [(ngModel)]="currentFilter.parentLogical"\r\n      *ngIf="activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true">\r\n      <mat-option tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.operators.tooltip.And\' | translate" value="And">{{\'igo.geo.operators.And\' | translate}}</mat-option>\r\n      <mat-option tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.operators.tooltip.Or\' | translate" value="Or">{{\'igo.geo.operators.Or\' | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <span *ngIf="(fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== \'\'">\r\n      <mat-select [disabled]="!currentFilter.active" *ngIf="[\'Contains\',\'Intersects\',\'Within\'].indexOf(currentFilter.operator) === -1"\r\n        [(ngModel)]="currentFilter.propertyName" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.sourceFields.selectField\' | translate"\r\n        (selectionChange)="updateField()">\r\n        <mat-option *ngFor="let field of  (fields$| async)" [value]="field.name">{{field.alias}}</mat-option>\r\n      </mat-select>\r\n    </span>\r\n    <span *ngIf=" (fields$| async) &&  (fields$| async).length === 1 &&  (fields$| async)[0].name === \'\'">\r\n      <mat-form-field>\r\n        <input [disabled]="!currentFilter.active" matInput #fieldPerUser (keyup)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)"\r\n          (blur)="changeProperty(currentFilter,\'propertyName\',fieldPerUser.value)" [(ngModel)]="currentFilter.propertyName">\r\n\r\n        <button mat-button *ngIf="currentFilter.propertyName" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.propertyName=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n    <mat-select \r\n    tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.selectOperator\' | translate"\r\n    [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of (ogcFilterOperators$ | async) | keyvalue" [value]="operator.key" tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="(\'igo.geo.operators.tooltip.\'+ operator.key) | translate" >{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== \'Intersects\' && currentFilter.operator !== \'Contains\' && currentFilter.operator !== \'Within\')">\r\n\r\n    \x3c!-- PropertyIsEqualTo --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsEqualTo\' || currentFilter.operator === \'PropertyIsNotEqualTo\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionequalto (keyup)="changeProperty(currentFilter,\'expression\',expressionequalto.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'expression\',expressionequalto.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsEqualTo  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsLike\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #pattern (keyup)="changeProperty(currentFilter,\'pattern\',pattern.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'pattern\',pattern.value)" [ngModel]="currentFilter.pattern">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.pattern" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.pattern=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsLike  --\x3e\r\n\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsNull\'"></span>\r\n    \x3c!-- PropertyIsNull  --\x3e\r\n\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsGreaterThan\' || currentFilter.operator === \'PropertyIsGreaterThanOrEqualTo\' || currentFilter.operator === \'PropertyIsLessThan\' || currentFilter.operator === \'PropertyIsLessThanOrEqualTo\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionthan type="number" (keyup)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'expression\',expressionthan.value)" [ngModel]="currentFilter.expression">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n    </span>\r\n    \x3c!-- PropertyIs_Than  --\x3e\r\n\r\n\r\n    \x3c!-- PropertyIsBetween --\x3e\r\n    <span *ngIf="currentFilter.operator === \'PropertyIsBetween\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #lowerBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'lowerBoundary\',lowerBoundary.value)" [ngModel]="currentFilter.lowerBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.lowerBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.lowerBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #upperBoundary type="number" (keyup)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)"\r\n          (ngModelChange)="changeNumericProperty(currentFilter,\'upperBoundary\',upperBoundary.value)" [ngModel]="currentFilter.upperBoundary">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.upperBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.upperBoundary=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n    </span>\r\n    \x3c!-- PropertyIsBetween  --\x3e\r\n\r\n\r\n    \x3c!-- During --\x3e\r\n    <span *ngIf="currentFilter.operator === \'During\'">\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #begin (keyup)="changeProperty(currentFilter,\'begin\',begin.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'begin\',begin.value)" [ngModel]="currentFilter.begin">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values " [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.begin" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.begin=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n      <mat-form-field [floatLabel]="floatLabel">\r\n        <input [placeholder]="\'igo.geo.filter.placeholder\' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #end (keyup)="changeProperty(currentFilter,\'end\',end.value)"\r\n          (ngModelChange)="changeProperty(currentFilter,\'end\',end.value)" [ngModel]="currentFilter.end">\r\n        <mat-autocomplete #auto="matAutocomplete">\r\n          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">\r\n            <span>{{ value }}</span>\r\n          </mat-option>\r\n        </mat-autocomplete>\r\n        <button mat-button *ngIf="currentFilter.end" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.end=\'\'">\r\n          <mat-icon svgIcon="close"></mat-icon>\r\n        </button>\r\n      </mat-form-field>\r\n\r\n\r\n    </span>\r\n    \x3c!-- During  --\x3e\r\n  </div>\r\n  \x3c!-- NON SPATIAL --\x3e\r\n\r\n\r\n  \x3c!-- PropertySpatial  --\x3e\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select  \r\n      matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.selectOperator\' | translate" tooltip-position="below"\r\n      [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">\r\n      <mat-option *ngFor="let operator of (ogcFilterOperators$ | async) | keyvalue" [value]="operator.key"  tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="(\'igo.geo.operators.tooltip.\'+ operator.key) | translate" >{{(\'igo.geo.operators.\'+ operator.key) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.igoSpatialSelector" (selectionChange)="changeGeometry(currentFilter,value)">\r\n      <mat-option *ngFor="let igoSpatialSelector of igoSpatialSelectors" [value]="igoSpatialSelector.type">{{(\'igo.geo.spatialSelector.\'+ igoSpatialSelector.type) | translate}}</mat-option>\r\n    </mat-select>\r\n  </div>\r\n\r\n  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === \'Intersects\' || currentFilter.operator === \'Contains\' || currentFilter.operator === \'Within\')">\r\n    <button mat-button [disabled]="!currentFilter.active" *ngIf="currentFilter.igoSpatialSelector === \'fixedExtent\'"\r\n      matSuffix mat-icon-button aria-label="Clear" (click)="changeGeometry(currentFilter,value)" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.spatialSelector.btnSetExtent\' | translate">\r\n      <mat-icon svgIcon="arrow-expand-all"></mat-icon>\r\n    </button>\r\n\r\n\r\n    <mat-form-field *ngIf="currentFilter.igoSpatialSelector === \'snrc\'" [floatLabel]="floatLabel">\r\n      <input [placeholder]="\'igo.geo.filter.placeholderSnrc\' | translate" matInput #htmlSnrc (keyup)="changeGeometry(currentFilter,htmlSnrc.value)" (blur)="changeGeometry(currentFilter,htmlSnrc.value)"\r\n        [(ngModel)]="snrc">\r\n      <button mat-button *ngIf="snrc" matSuffix mat-icon-button aria-label="Clear" (click)="snrc=\'\'">\r\n        <mat-icon svgIcon="close"></mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n  </div>\r\n  \x3c!-- PropertySpatial  --\x3e\r\n\r\n  \x3c!-- <mat-checkbox labelPosition=\'before\' (change)="changeCaseSensitive($event)" [(ngModel)]="currentFilter.matchCase">\r\n    {{(\'igo.geo.operators.caseSensitive\') | translate}}\r\n  </mat-checkbox> --\x3e\r\n\r\n  <div class="igo-col igo-col-100 igo-col-100-m">\r\n    <div class="igo-layer-button-group">\r\n      <mat-slide-toggle class="example-margin" (change)="toggleFilterState($event,currentFilter,\'active\')" tooltip-position="below"\r\n        matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.toggleFilterState\' | translate" [color]="color" [checked]="currentFilter.active"\r\n        [disabled]="disabled">\r\n      </mat-slide-toggle>\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.filter.removeFilter\' | translate"\r\n        color="warn" (click)="deleteFilter(currentFilter)">\r\n        <mat-icon svgIcon="delete"></mat-icon>\r\n      </button>\r\n    </div>\r\n  </div>\r\n  <mat-divider></mat-divider>\r\n</mat-list-item>\r\n',styles:[":host{overflow:hidden}.mat-list-item{height:auto}.mat-form-field{width:100%}.mat-list-item>>>div.mat-list-item-content{display:inline-table;width:100%}.logical{font-weight:700}input,mat-select{margin-top:10px;text-align:center}.igo-layer-actions-container{width:100%;display:inline-block}.igo-layer-actions-container>div{text-align:center}.igo-layer-button-group{float:center;padding:0 3px}@media only screen and (orientation:portrait) and (max-width:599px),only screen and (orientation:landscape) and (max-width:959px){.igo-layer-button-group{float:none}}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],il.ctorParameters=function(){return[{type:rl}]},il.propDecorators={refreshFilters:[{type:je.Input}],datasource:[{type:je.Input}],map:[{type:je.Input}],currentFilter:[{type:je.Input}],floatLabel:[{type:je.Input}]},il);function il(e){this.wktService=e,this.ogcFilterOperators$=new Le.BehaviorSubject(undefined),this.value="",this.fields$=new Le.BehaviorSubject([]),this.color="primary",this.snrc="",this.baseOverlayName="ogcFilterOverlay_",this.currentFilter$=new Le.BehaviorSubject(undefined),this.floatLabel="never",this.allOgcFilterOperators=(new vt).operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}var al=(Object.defineProperty(sl.prototype,"refreshFunc",{get:function(){return this.refreshFilters},enumerable:!0,configurable:!0}),Object.defineProperty(sl.prototype,"advancedOgcFilters",{get:function(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters},enumerable:!0,configurable:!0}),sl.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filterable-form",template:'<igo-list *ngIf="!advancedOgcFilters" [navigation]="false" [selection]="true">\r\n  <igo-ogc-filter-toggle-button igoListItem [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc">\r\n  </igo-ogc-filter-toggle-button>\r\n</igo-list>\r\n\r\n<igo-list *ngIf="advancedOgcFilters && datasource.options.ogcFilters.editable " [navigation]="false" [selection]="true">\r\n  <ng-template ngFor let-currentFilter [ngForOf]="datasource.options.ogcFilters.interfaceOgcFilters">\r\n    <igo-ogc-filter-form igoListItem [color]="color" [currentFilter]="currentFilter" [datasource]="datasource"\r\n      [map]="map" [refreshFilters]="refreshFunc">\r\n    </igo-ogc-filter-form>\r\n  </ng-template>\r\n</igo-list>\r\n'}]}],sl.ctorParameters=function(){return[]},sl.propDecorators={datasource:[{type:je.Input}],map:[{type:je.Input}],refreshFilters:[{type:je.Input}]},sl);function sl(){this.color="primary"}var ll=(Object.defineProperty(ul.prototype,"refreshFunc",{get:function(){return this.refreshFilters.bind(this)},enumerable:!0,configurable:!0}),Object.defineProperty(ul.prototype,"datasource",{get:function(){return this.layer.dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(ul.prototype,"downloadable",{get:function(){return this.datasource.options.download},enumerable:!0,configurable:!0}),ul.prototype.ngOnInit=function(){var e=this.datasource.options.ogcFilters;switch(e.pushButtons&&0<e.pushButtons.bundles.length&&(e.advancedOgcFilters===undefined&&(e.advancedOgcFilters=!1),this.hasPushButton=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource)}e&&(e.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(e.interfaceOgcFilters)),1<=e.interfaceOgcFilters.filter(function(e){return e.wkt_geometry}).length&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=!!e.editable&&e.editable)},ul.prototype.addFilterToSequence=function(){this.filtersCollapsed=!1;var e,t=this.datasource.options.ogcFilters.interfaceOgcFilters||[],r=0===t.length?0:t[t.length-1].level,o="",n=this.datasource.options.sourceFields.filter(function(e){return!e.excludeFromOgcFilters});0<n.length&&(o=n[0].name===undefined?"":n[0].name);var i=this.datasource.options;i.fieldNameGeometry?e=i.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(e=this.datasource.options.paramsWFS.fieldNameGeometry);var a=0===t.length,s=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,o,this.datasource.options.ogcFilters.allowedOperatorsType),l=Object.keys(s)[0];t.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:o,operator:l,active:a,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},e,r,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=t},ul.prototype.openDownload=function(){this.downloadService.open(this.layer)},ul.prototype.refreshFilters=function(e){!0===e&&(this.lastRunOgcFilter=undefined);var t=this.datasource.options.ogcFilters,r=t.interfaceOgcFilters.filter(function(e){return!0===e.active});if(0===r.length&&(t.filters=undefined,t.filtered=!1),1<r.length&&(r[0].parentLogical=r[1].parentLogical),0===r.filter(function(e){return-1!==["Contains","Intersects","Within"].indexOf(e.operator)}).length?this.hasActiveSpatialFilter=!1:this.hasActiveSpatialFilter=!0,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(r)){if("wfs"===this.layer.dataSource.options.type)(o=this.layer.dataSource.options.ogcFilters).filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(r),this.layer.dataSource.ol.clear();else if("wms"===this.layer.dataSource.options.type&&t.enabled){var o,n="";1<=r.length&&((o=this.layer.dataSource.options.ogcFilters).filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(r),n=this.ogcFilterWriter.buildFilter(o.filters,undefined,undefined,this.layer.dataSource.options.fieldNameGeometry)),this.ogcFilterService.filterByOgc(this.datasource,n),this.datasource.options.ogcFilters.filtered=0!==r.length}this.lastRunOgcFilter=JSON.parse(JSON.stringify(r))}},ul.prototype.setVisible=function(){this.layer.visible=!0},ul.prototype.isAdvancedOgcFilters=function(){return this.datasource.options.ogcFilters.advancedOgcFilters},ul.prototype.addFilterDisabled=function(){return!this.datasource.options.sourceFields||0===this.datasource.options.sourceFields.length},ul.prototype.changeOgcFiltersAdvancedOgcFilters=function(e){this.datasource.options.ogcFilters.advancedOgcFilters=e},ul.prototype.changeOgcFilterType=function(e){this.changeOgcFiltersAdvancedOgcFilters(e.checked),e.checked&&this.refreshFilters(!0)},ul.prototype.toggleLegend=function(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)},ul.prototype.toggleLegendOnClick=function(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)},ul.prototype.toggleFiltersCollapsed=function(){this.filtersCollapsed=!this.filtersCollapsed},ul.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filterable-item",template:'<mat-list-item>\r\n\r\n  <mat-icon\r\n    *ngIf="header"\r\n    class="igo-chevron"\r\n    mat-list-avatar\r\n    igoCollapse [target]="ogcFilters"\r\n    [collapsed]="filtersCollapsed"\r\n    (click)="toggleFiltersCollapsed()"\r\n    svgIcon="chevron-up">\r\n  </mat-icon>\r\n  <h4 (click)="toggleLegendOnClick()" *ngIf="header" [ngStyle]="{\'cursor\': filtersCollapsed ? \'default\' : \'pointer\'}" matLine [matTooltip]="layer.title" matTooltipShowDelay="500">{{layer.title}}</h4>\r\n\r\n    <span *ngIf="downloadable && header">\r\n      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.download.action\' | translate"\r\n        [color]="color" (click)="openDownload()">\r\n        <mat-icon svgIcon="download"></mat-icon>\r\n      </button>\r\n    </span>\r\n    <button *ngIf="isAdvancedOgcFilters() && filtersAreEditable" [disabled]="addFilterDisabled()" mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.filter.addFilter\' | translate" [color]="color" (click)="addFilterToSequence()">\r\n      <mat-icon svgIcon="plus"></mat-icon>\r\n    </button>\r\n    <button *ngIf="!layer.visible && header" mat-icon-button tooltip-position="below"\r\n      matTooltipShowDelay="500" [matTooltip]="\'igo.geo.layer.showLayer\' | translate" color="color" (click)="setVisible()">\r\n      <mat-icon svgIcon="eye-off"></mat-icon>\r\n    </button>\r\n</mat-list-item>\r\n\r\n<div #ogcFilters class="igo-datasource-filters-container">\r\n    <div *ngIf="header" #legend class="igo-layer-legend-container">\r\n      <igo-layer-legend *ngIf="showLegend$ | async" [layer]="layer">\r\n      </igo-layer-legend>\r\n    </div>\r\n  <igo-ogc-filterable-form [datasource]="datasource" [map]="map" [refreshFilters]="refreshFunc">\r\n  </igo-ogc-filterable-form>\r\n\r\n  <section class="mat-typography">\r\n  <mat-checkbox labelPosition=\'before\' *ngIf="hasPushButton && filtersAreEditable" (change)="changeOgcFilterType($event)"\r\n    [(ngModel)]="datasource.options.ogcFilters.advancedOgcFilters">\r\n    {{\'igo.geo.filter.advancedOgcFilters\' | translate}}\r\n  </mat-checkbox>\r\n</section>\r\n</div>\r\n',styles:[":host{overflow:hidden}.igo-datasource-filters-container{text-align:center;width:100%;display:inline-block}.mat-list-item{height:auto}.igo-layer-legend-container{padding-left:1.125em;width:calc(100% - 18px)}mat-icon.disabled{color:rgba(0,0,0,.38)}"]}]}],ul.ctorParameters=function(){return[{type:aa},{type:da}]},ul.propDecorators={layer:[{type:je.Input}],map:[{type:je.Input}],header:[{type:je.Input}]},ul);function ul(e,t){this.ogcFilterService=e,this.downloadService=t,this.color="primary",this.defaultLogicalParent="And",this.hasActiveSpatialFilter=!1,this.filtersAreEditable=!0,this.filtersCollapsed=!0,this.hasPushButton=!1,this.showLegend$=new Le.BehaviorSubject(!1),this.header=!0,this.ogcFilterWriter=new vt}var cl=(pl.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filterable-list",template:'<igo-list [navigation]="false" [selection]="false">\r\n  <ng-template ngFor let-layer [ngForOf]="layers | filterableDataSource: \'ogc\'">\r\n    <igo-ogc-filterable-item igoListItem [header]="true" [layer]="layer" \r\n    [map]="layer.map" ></igo-ogc-filterable-item>\r\n  </ng-template>\r\n</igo-list>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush}]}],pl.ctorParameters=function(){return[]},pl.propDecorators={layers:[{type:je.Input}],map:[{type:je.Input}]},pl);function pl(){}var dl=(hl.prototype.ngOnInit=function(){var t=this;this.component.layers=[],this.layers$$=this.mapService.getMap().layers$.subscribe(function(e){t.component.layers=e})},hl.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},hl.decorators=[{type:je.Directive,args:[{selector:"[igoOgcFilterableListBinding]"}]}],hl.ctorParameters=function(){return[{type:cl,decorators:[{type:je.Self}]},{type:So}]},hl);function hl(e,t){this.mapService=t,this.component=e}var gl=(Object.defineProperty(fl.prototype,"badge",{get:function(){var e=this.options.ogcFilters;if(!e||e.advancedOgcFilters)return e&&e.filters&&!e.filters.filters?1:e&&e.filters&&e.filters.filters?e.filters.filters.length:void 0;if(e.pushButtons){var t=e.pushButtons.groups.find(function(e){return e.enabled}),r=0;return t&&t.computedButtons.map(function(e){return r+=e.buttons.filter(function(e){return e.enabled}).length}),0<r?r:undefined}},enumerable:!0,configurable:!0}),Object.defineProperty(fl.prototype,"layer",{get:function(){return this._layer},set:function(e){(this._layer=e)&&(this.options=this.layer.dataSource.options)},enumerable:!0,configurable:!0}),fl.prototype.ngOnInit=function(){this.options=this.layer.dataSource.options},fl.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filter-button",template:'<button \r\n  *ngIf="header && options.ogcFilters && options.ogcFilters.enabled &&\r\n  (options.ogcFilters.pushButtons || options.ogcFilters.editable)"\r\n  mat-icon-button\r\n  collapsibleButton\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.filter.filterBy\' | translate"\r\n  [color]="color">\r\n  <mat-icon [matBadge]="badge" matBadgeColor="warn" matBadgeSize="medium" svgIcon="filter"></mat-icon>\r\n</button>\r\n\r\n<div #ogcFilter class="igo-layer-actions-container"\r\n*ngIf="options.ogcFilters && options.ogcFilters.enabled &&\r\n(options.ogcFilters.pushButtons || options.ogcFilters.editable)">\r\n  <igo-ogc-filterable-item\r\n    *ngIf="ogcFilterCollapse && options.ogcFilters.enabled"\r\n    igoListItem\r\n    [header]="false"\r\n    [map]="layer.map"\r\n    [layer]="layer">\r\n  </igo-ogc-filterable-item>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],fl.ctorParameters=function(){return[]},fl.propDecorators={layer:[{type:je.Input}],map:[{type:je.Input}],color:[{type:je.Input}],header:[{type:je.Input}]},fl);function fl(){this.color="primary",this.ogcFilterCollapse=!1}var ml=(yl.prototype.getPushButtonsGroups=function(){return this.datasource.options.ogcFilters.pushButtons.groups},yl.prototype.ngOnInit=function(){this.datasource.options.ogcFilters&&this.datasource.options.ogcFilters.pushButtons&&(this.currentPushButtonGroup=this.datasource.options.ogcFilters.pushButtons.groups.find(function(e){return e.enabled})||this.datasource.options.ogcFilters.pushButtons.groups[0]),this.applyFilters()},yl.prototype.getToolTip=function(e){var t;return e.tooltip&&(t=Array.isArray(e.tooltip)?e.tooltip.join("\n"):e.tooltip),t||""},yl.prototype.getButtonColor=function(e){var t;return e.color&&(t={"background-color":e.enabled?"rgba("+e.color+")":"rgba(255,255,255,0)"}),t},yl.prototype.bundleIsVertical=function(e){return!!e.vertical&&e.vertical},yl.prototype.onChangeGroup=function(){var t=this;this.getPushButtonsGroups().map(function(e){return e.enabled=!1}),this.getPushButtonsGroups().find(function(e){return e===t.currentPushButtonGroup}).enabled=!0,this.applyFilters()},yl.prototype.applyFilters=function(e){e&&(e.enabled=!e.enabled);var t="",r=[];this.currentPushButtonGroup.computedButtons.map(function(e){var t=[];e.buttons.filter(function(e){return!0===e.enabled}).forEach(function(e){return t.push(e.filters)}),1<=t.length&&(1===t.length?r.push(t[0]):r.push({logical:e.logical,filters:t}))}),1<=r.length&&(t=this.ogcFilterWriter.buildFilter(1===r.length?r[0]:{logical:"And",filters:r})),"wms"===this.datasource.options.type&&this.ogcFilterService.filterByOgc(this.datasource,t),"wfs"===this.datasource.options.type&&this.datasource.ol.clear()},yl.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filter-toggle-button",template:'<div *ngIf="getPushButtonsGroups().length > 1">\r\n    <mat-form-field>\r\n      <mat-select tooltip-position="below" matTooltipShowDelay="500"\r\n        [matTooltip]="\'igo.geo.layer.legend.selectStyle\' | translate" [(ngModel)]="currentPushButtonGroup"\r\n        (selectionChange)="onChangeGroup()">\r\n        <mat-option *ngFor="let pbg of getPushButtonsGroups()" [value]="pbg">{{pbg.title}}</mat-option>\r\n      </mat-select>\r\n  </mat-form-field>\r\n</div>\r\n<ng-container *ngFor="let bundle of currentPushButtonGroup.computedButtons">\r\n        <mat-button-toggle-group \r\n        class="mat-typography"\r\n        appearance="legacy" vertical={{bundleIsVertical(bundle)}} multiple="true">\r\n            <mat-button-toggle [ngStyle]="getButtonColor(ogcPushButton)" [checked]="ogcPushButton.enabled"\r\n                (change)="applyFilters(ogcPushButton)" tooltip-position="below" matTooltipShowDelay="500"\r\n                [matTooltip]="getToolTip(ogcPushButton)" matTooltipClass="material-tooltip" \r\n                *ngFor="let ogcPushButton of bundle.buttons" [value]="ogcPushButton">{{ogcPushButton.title}}\r\n            </mat-button-toggle>\r\n        </mat-button-toggle-group>\r\n</ng-container>\r\n',styles:[".mat-button-toggle-group{margin:5px;flex-wrap:wrap}.mat-button-toggle{display:-webkit-inline-box;display:inline-flex}::ng-deep .material-tooltip{white-space:pre-line}"]}]}],yl.ctorParameters=function(){return[{type:aa}]},yl.propDecorators={refreshFilters:[{type:je.Input}],datasource:[{type:je.Input}],map:[{type:je.Input}]},yl);function yl(e){this.ogcFilterService=e,this.color="primary",this.ogcFilterWriter=new vt}var vl=(Object.defineProperty(bl.prototype,"store",{get:function(){return this._store},set:function(e){this._store=e},enumerable:!0,configurable:!0}),bl.prototype.ngOnInit=function(){0===this.selectedTypeIndex.value&&(this.type=this.spatialType.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)},bl.prototype.onTypeChange=function(e){0===this.selectedTypeIndex.value&&(this.type=la.Predefined),1===this.selectedTypeIndex.value&&(this.type=this.activeDrawType),this.eventType.emit(this.type)},bl.prototype.onQueryTypeChange=function(e){this.eventQueryType.emit(this.selectedQueryType)},bl.prototype.onZoneChange=function(e){this.zoneChange.emit(e)},bl.prototype.onDrawTypeChange=function(e){this.activeDrawType=e,this.eventType.emit(this.activeDrawType)},bl.decorators=[{type:je.Component,args:[{selector:"igo-spatial-filter-type",template:'<mat-tab-group\r\n  [selectedIndex]="selectedTypeIndex.value"\r\n  (selectedIndexChange)="selectedTypeIndex.setValue($event)"\r\n  (selectedTabChange)="onTypeChange($event)">\r\n\r\n  <mat-tab [label]="\'igo.geo.spatialFilter.predefined\' | translate">\r\n    <mat-form-field>\r\n      <mat-label>{{\'igo.geo.spatialFilter.searchLabel\' | translate}}</mat-label>\r\n      <mat-select (selectionChange)="onQueryTypeChange($event)" [(value)]="selectedQueryType">\r\n        <mat-option *ngFor="let queryType of queryType" [value]="queryType">\r\n          {{(\'igo.geo.terrapi.\' + queryType) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n    <igo-spatial-filter-list\r\n      [store]="store"\r\n      [queryType]="selectedQueryType"\r\n      [selectedZone]="zone"\r\n      (zoneChange)="onZoneChange($event)">\r\n    </igo-spatial-filter-list>\r\n  </mat-tab>\r\n\r\n  <mat-tab [label]="\'igo.geo.spatialFilter.draw\' | translate">\r\n    <div class="spatial-type-toggle">\r\n      <mat-button-toggle-group\r\n        [value]="activeDrawType"\r\n        (change)="onDrawTypeChange($event.value)">\r\n        <mat-button-toggle [value]="spatialType.Polygon" [matTooltip]="\'igo.geo.spatialFilter.drawPolygon\' | translate">\r\n            <mat-icon svgIcon="pentagon-outline"></mat-icon>\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]="spatialType.Point" [matTooltip]="\'igo.geo.spatialFilter.drawCircle\' | translate">\r\n            <mat-icon svgIcon="record-circle-outline"></mat-icon>\r\n        </mat-button-toggle>\r\n      </mat-button-toggle-group>\r\n    </div>\r\n  </mat-tab>\r\n\r\n</mat-tab-group>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".mat-form-field{padding:5px;width:95%;margin-left:2px}.mat-tab-group ::ng-deep .mat-tab-body-content{overflow:hidden}.mat-tab-group ::ng-deep .mat-tab-label{padding:10px}.mat-tab-group ::ng-deep .mat-tab-body-wrapper{margin-top:5px}.spatial-type-toggle{padding:10px;text-align:center}.spatial-type-toggle mat-button-toggle-group,.spatial-type-toggle mat-button-toggle-group mat-button-toggle{width:50%}"]}]}],bl.ctorParameters=function(){return[]},bl.propDecorators={store:[{type:je.Input}],selectedQueryType:[{type:je.Input}],zone:[{type:je.Input}],eventType:[{type:je.Output}],eventQueryType:[{type:je.Output}],zoneChange:[{type:je.Output}]},bl);function bl(){this.queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"],this.selectedTypeIndex=new ve.FormControl(0),this.spatialType=la,this.activeDrawType=this.spatialType.Polygon,this.eventType=new je.EventEmitter,this.eventQueryType=new je.EventEmitter,this.zoneChange=new je.EventEmitter}var Sl=(Object.defineProperty(wl.prototype,"store",{get:function(){return this._store},set:function(e){this._store=e},enumerable:!0,configurable:!0}),Object.defineProperty(wl.prototype,"queryType",{get:function(){return this._queryType},set:function(e){this.formControl.setValue(""),this._queryType=e},enumerable:!0,configurable:!0}),wl.prototype.ngOnInit=function(){var e=this;this.formValueChanges$$=this.formControl.valueChanges.subscribe(function(r){r.length&&e.store.view.filter(function(e){var t=r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(t)})})},wl.prototype.ngOnDestroy=function(){this.formValueChanges$$.unsubscribe()},wl.prototype.displayFn=function(e){return e?e.properties.nom:undefined},wl.prototype.onZoneChange=function(e){var t=this;e&&this.queryType&&this.spatialFilterService.loadItemById(e,this.queryType).subscribe(function(e){t.selectedZone=e,t.zoneChange.emit(e)})},wl.decorators=[{type:je.Component,args:[{selector:"igo-spatial-filter-list",template:'<form class="form-list">\r\n    <mat-form-field>\r\n        <input #input type="text" placeholder="{{\'igo.geo.spatialFilter.listLabel\' | translate}}" matInput\r\n        [formControl]="formControl" [matAutocomplete]="auto">\r\n        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onZoneChange($event.option.value)"\r\n        [displayWith]="displayFn">\r\n            <mat-option *ngFor="let entities of this.store.view.all$() | async" [value]="entities">\r\n                {{entities.properties.nom}}\r\n            </mat-option>\r\n        </mat-autocomplete>\r\n    </mat-form-field>\r\n<form>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".mat-form-field{padding:5px;width:95%;margin-left:2px}"]}]}],wl.ctorParameters=function(){return[{type:ca}]},wl.propDecorators={store:[{type:je.Input}],queryType:[{type:je.Input}],selectedZone:[{type:je.Input}],zoneChange:[{type:je.Output}]},wl);function wl(e){this.spatialFilterService=e,this.formControl=new ve.FormControl,this.zoneChange=new je.EventEmitter}var Il=(Object.defineProperty(Ol.prototype,"type",{get:function(){return this._type},set:function(e){var o=this;this._type=e;var t=this.geometryTypes.findIndex(function(e){return e===o.type});this.geometryType=this.geometryTypes[t],this.formControl.reset(),this.radius=undefined,this.drawGuide$.next(null),this.drawStyle$.next(undefined),this.type===la.Predefined&&this.formControl.setValue({type:"Point",coordinates:""}),this.type===la.Point?(this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=function(e,t){var r=Se.transform(e.getGeometry().getCoordinates(),o.map.projection,"EPSG:4326");return new we.Style({image:new we.Circle({radius:o.radius/Math.cos(Math.PI/180*r[1])/t,stroke:new we.Stroke({width:2,color:"rgba(0, 153, 255)"}),fill:new we.Fill({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle)):(this.radius=undefined,this.PolyStyle=function(e,t){return new we.Style({stroke:new we.Stroke({width:2,color:"rgba(0, 153, 255)"}),fill:new we.Fill({color:"rgba(0, 153, 255, 0.2)"})})},this.overlayStyle=this.PolyStyle),this.overlayStyle$.next(this.overlayStyle)},enumerable:!0,configurable:!0}),Object.defineProperty(Ol.prototype,"store",{get:function(){return this._store},set:function(e){var t=this;this._store=e,this._store.entities$.subscribe(function(){t.cdRef.detectChanges()})},enumerable:!0,configurable:!0}),Object.defineProperty(Ol.prototype,"measureUnits",{get:function(){return[ka.Meters]},enumerable:!0,configurable:!0}),Ol.prototype.ngOnInit=function(){var s=this;this.spatialFilterService.loadThematicsList().subscribe(function(e){var t,r;try{for(var o=Qe(e),n=o.next();!n.done;n=o.next()){var i=n.value;s.childrens.push(i),s.childrens.sort(function(e,t){return e.name.localeCompare(t.name)})}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}s.childrens.forEach(function(e){if(e.group&&-1===s.groups.indexOf(e.group)){s.groups.push(e.group);var t={name:e.group,children:[]};s.thematics.push(t)}e.group||(t={name:e.name,children:[],source:e.source},s.thematics.push(t)),s.thematics.sort(function(e,t){return e.name.localeCompare(t.name)})}),s.thematics.forEach(function(e){var t,r;try{for(var o=Qe(s.childrens),n=o.next();!n.done;n=o.next()){var i=n.value;i.group===e.name&&e.children.push(i)}}catch(a){t={error:a}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:undefined),this.value$$=this.formControl.valueChanges.subscribe(function(e){s.value$.next(e||undefined)}),this.value$.subscribe(function(){s.getRadius(),s.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(function(){s.getRadius(),s.cdRef.detectChanges()})},Ol.prototype.ngOnDestroy=function(){this.value$$.unsubscribe(),this.cdRef.detach()},Ol.prototype.onItemTypeChange=function(e){this.selectedItemType=e.value,this.itemTypeChange.emit(this.selectedItemType)},Ol.prototype.onMeasureUnitChange=function(e){this.measureUnit=e},Ol.prototype.isPredefined=function(){return this.type===la.Predefined},Ol.prototype.isPolygon=function(){return this.type===la.Polygon},Ol.prototype.isPoint=function(){return this.type===la.Point},Ol.prototype.hasChild=function(e,t){return!!t.children&&t.children.length},Ol.prototype.onToggleClick=function(e){this.treeControl.isExpanded(e)?this.treeControl.collapse(e):this.treeControl.expand(e)},Ol.prototype.isAllSelected=function(e){var t,r=this,o=0;return e?(t=e.children.length,e.children.forEach(function(t){r.selectedThematics.selected.find(function(e){return e===t})&&o++})):(t=this.selectedThematics.selected.length,this.thematics.forEach(function(e){-1===r.groups.indexOf(e.name)&&o++}),this.childrens.forEach(function(t){r.thematics.find(function(e){return e.source===t.source})||o++})),1<=o&&t===o},Ol.prototype.hasChildrenSelected=function(e){var r=this,o=!1;return e.children.forEach(function(t){r.selectedThematics.selected.find(function(e){return e.source===t.source})&&(o=!0)}),o},Ol.prototype.masterToggle=function(){var e,t,r=this;this.isAllSelected()?this.selectedThematics.clear():this.selectAll();var o=[];try{for(var n=Qe(this.selectedThematics.selected),i=n.next();!i.done;i=n.next()){var a=i.value;o.push(a)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}this.isAllSelected()?this.thematics.forEach(function(e){r.hasChild(0,e)&&r.treeControl.expand(e)}):this.thematics.forEach(function(e){r.hasChild(0,e)&&r.treeControl.collapse(e)}),this.thematicChange.emit(o)},Ol.prototype.selectAll=function(e){var r=this;e?this.hasChild(0,e)&&e.children.forEach(function(e){return r.selectedThematics.select(e)}):(this.thematics.forEach(function(e){-1===r.groups.indexOf(e.name)&&r.selectedThematics.select(e)}),this.childrens.forEach(function(t){r.selectedThematics.selected.find(function(e){return e.source===t.source})||r.selectedThematics.select(t)}))},Ol.prototype.childrensToggle=function(e){var t,r,o=this;this.isAllSelected(e)?e.children.forEach(function(e){return o.selectedThematics.deselect(e)}):this.selectAll(e);var n=[];try{for(var i=Qe(this.selectedThematics.selected),a=i.next();!a.done;a=i.next()){var s=a.value;n.push(s)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(r=i["return"])&&r.call(i)}finally{if(t)throw t.error}}this.treeControl.expand(e),this.thematicChange.emit(n)},Ol.prototype.onToggleChange=function(t){var e,r,o=this,n=!1;this.selectedThematics.selected.find(function(e){return e.source===t.source})!==undefined&&(n=!0),this.childrens.forEach(function(e){e===t&&!1===n&&o.selectedThematics.select(e),e===t&&!0===n&&o.selectedThematics.deselect(e)}),this.thematics.forEach(function(e){e===t&&!1===n&&o.selectedThematics.select(e),e===t&&!0===n&&o.selectedThematics.deselect(e)});var i=[];try{for(var a=Qe(this.selectedThematics.selected),s=a.next();!s.done;s=a.next()){var l=s.value;i.push(l)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(e)throw e.error}}this.thematicChange.emit(i)},Ol.prototype.onDrawControlChange=function(){this.drawControlIsActive=!this.drawControlIsActive},Ol.prototype.onfreehandControlChange=function(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive)},Ol.prototype.toggleSearchButton=function(){(this.isPolygon()||this.isPoint())&&(this.drawZone=this.formControl.value,this.drawZone.meta={id:undefined,title:"Zone"},this.drawZone.properties={nom:"Zone"},this.drawZoneEvent.emit(this.drawZone)),this.radiusEvent.emit(this.radius),this.toggleSearch.emit()},Ol.prototype.clearButton=function(){this.loading=!0,this.map.removeLayers(this.layers),this.loading=!1,this.store&&this.store.clear(),this.clearButtonEvent.emit([])},Ol.prototype.clearSearch=function(){this.selectedThematics.clear(),this.thematicChange.emit([]),this.clearSearchEvent.emit()},Ol.prototype.disableSearchButton=function(){if(this.type===la.Predefined){if(this.selectedItemType===ua.Address&&this.queryType!==undefined&&this.zone!==undefined)return this.loading;if(this.selectedItemType===ua.Thematics&&this.queryType!==undefined&&this.zone!==undefined&&0<this.selectedThematics.selected.length)return this.loading}if(this.type===la.Polygon||this.type===la.Point){if(this.selectedItemType===ua.Address&&null!==this.formControl.value)return this.loading;if(this.selectedItemType===ua.Thematics&&0<this.selectedThematics.selected.length&&null!==this.formControl.value)return this.loading}return!0},Ol.prototype.getRadius=function(){var e;if(e=null!==this.formControl.value?this.formControl.value.radius:undefined,this.type===la.Point){if(this.freehandDrawIsActive){if(1e4<=this.radiusFormControl.value||this.radiusFormControl.value<0)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),this.radius=1e3,this.radiusFormControl.setValue(this.radius),void this.drawGuide$.next(this.radius);if(1e4<=e)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),void this.formControl.reset();e&&(e!==this.radiusFormControl.value&&this.radiusFormControl.setValue(e),this.formControl.value.radius=undefined)}else if(1e4<=this.radiusFormControl.value||this.radiusFormControl.value<0)return this.messageService.alert(this.languageService.translate.instant("igo.geo.spatialFilter.radiusAlert"),this.languageService.translate.instant("igo.geo.spatialFilter.warning")),this.radius=1e3,this.radiusFormControl.setValue(this.radius),void this.drawGuide$.next(this.radius);this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}},Ol.decorators=[{type:je.Component,args:[{selector:"igo-spatial-filter-item",template:'<igo-geometry-form-field-input\r\n  [formControl]="formControl"\r\n  [map]="map"\r\n  [geometryType]="geometryType"\r\n  [drawGuide]="drawGuide$ | async"\r\n  [measure]="measure"\r\n  [drawControlIsActive]="drawControlIsActive"\r\n  [freehandDrawIsActive]="freehandDrawIsActive"\r\n  [drawStyle]="drawStyle$ | async"\r\n  [overlayStyle]="overlayStyle$ | async"\r\n  [radius]="radius">\r\n</igo-geometry-form-field-input>\r\n\r\n<div class="header">\r\n    <mat-slide-toggle *ngIf="!isPredefined()"\r\n      [checked]="drawControlIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onDrawControlChange()">\r\n      {{\'igo.geo.spatialFilter.drawControl\' | translate}}\r\n    </mat-slide-toggle>\r\n    <mat-slide-toggle *ngIf="!isPredefined()"\r\n      [checked]="freehandDrawIsActive"\r\n      [labelPosition]="\'before\'"\r\n      (change)="onfreehandControlChange()">\r\n      {{\'igo.geo.spatialFilter.freehandControl\' | translate}}\r\n    </mat-slide-toggle>\r\n</div>\r\n\r\n  <div class="radius-unit" *ngIf="isPoint()">\r\n    <form class="radius-form">\r\n      <mat-form-field class="radius">\r\n        <input type="number" matInput placeholder="{{\'igo.geo.spatialFilter.radius\' | translate}}" [formControl]="radiusFormControl"\r\n        [value]="1000" (input)="getRadius()" [readonly]="this.freehandDrawIsActive && this.formControl.value === null">\r\n        <label class="unit-field">\r\n          {{(\'igo.geo.measure.\' + measureUnit) | translate}}\r\n        </label>\r\n      </mat-form-field>\r\n    </form>\r\n  </div>\r\n\r\n  <mat-label class="title mat-typography">{{\'igo.geo.spatialFilter.search\' | translate}} : </mat-label>\r\n  <mat-radio-group [value]="selectedItemType">\r\n      <mat-radio-button *ngFor="let item of itemType"\r\n        [value]="item"\r\n        (change)="onItemTypeChange($event)">\r\n        {{\'igo.geo.spatialFilter.\' + item | translate}}\r\n      </mat-radio-button>\r\n  </mat-radio-group>\r\n\r\n<div class="thematics" *ngIf="selectedItemType===\'Thematics\'">\r\n  <mat-table>\r\n      \x3c!-- Name Column --\x3e\r\n      <ng-container matColumnDef="name">\r\n        <mat-header-cell *matHeaderCellDef class="thematics-header">{{\'igo.geo.spatialFilter.Thematics\' | translate}}</mat-header-cell>\r\n      </ng-container>\r\n\r\n      \x3c!-- Select Column --\x3e\r\n      <ng-container matColumnDef="select">\r\n        <mat-header-cell *matHeaderCellDef class="checks-header">\r\n          <mat-checkbox (change)="$event ? masterToggle() : null"\r\n                        [checked]="isAllSelected()"\r\n                        [indeterminate]="selectedThematics.hasValue() && !isAllSelected()">\r\n          </mat-checkbox>\r\n        </mat-header-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>\r\n    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>\r\n\r\n  </mat-table>\r\n\r\n  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">\r\n    \x3c!-- This is the tree node template for leaf nodes --\x3e\r\n    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>\r\n      <li class="mat-tree-node">\r\n        \x3c!-- use a disabled button to provide padding for tree leaf --\x3e\r\n        <button mat-icon-button disabled></button>\r\n        {{node.name}}\r\n        <mat-checkbox class="tree-check" (click)="$event.stopPropagation()"\r\n                      (change)="$event ? onToggleChange(node) : null"\r\n                      [checked]="selectedThematics.isSelected(node)">\r\n        </mat-checkbox>\r\n      </li>\r\n    </mat-tree-node>\r\n\r\n    \x3c!-- This is the tree node template for expandable nodes --\x3e\r\n    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">\r\n        <div class="mat-tree-node">\r\n          <button mat-icon-button\r\n            (click)="onToggleClick(node)">\r\n            <mat-icon [svgIcon]="treeControl.isExpanded(node) ? \'chevron-down\' : \'chevron-right\'"></mat-icon>\r\n          </button>\r\n          {{node.name}}\r\n          <mat-checkbox class="tree-check-2" (change)="$event ? childrensToggle(node) : null"\r\n                        [checked]="isAllSelected(node)"\r\n                        [indeterminate]="hasChildrenSelected(node) && !isAllSelected(node)">\r\n          </mat-checkbox>\r\n        </div>\r\n        <ul class="tree-ul" [class.example-tree-invisible]="!treeControl.isExpanded(node)">\r\n          <ng-container matTreeNodeOutlet></ng-container>\r\n        </ul>\r\n    </mat-nested-tree-node>\r\n\r\n  </mat-tree>\r\n</div>\r\n\r\n<div class="buttons">\r\n\r\n    <button *ngIf="isPredefined()" mat-raised-button class="clear-search-button" [disabled]="!queryType && !zone"\r\n      (click)="clearSearch()">\r\n        {{\'igo.geo.spatialFilter.clearSearch\' | translate}}\r\n    </button>\r\n\r\n  <button *ngIf="isPolygon() || isPoint()" mat-raised-button class="clear-form-button" [disabled]="this.formControl.value === null"\r\n    (click)="this.formControl.reset()">\r\n    {{\'igo.geo.spatialFilter.clearForm\' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class="search-button" [disabled]="disableSearchButton()" color="primary"\r\n    (click)="toggleSearchButton()">\r\n    {{\'igo.geo.spatialFilter.goSearch\' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class="remove-button" [disabled]="!store.entities$.getValue().length" (click)="clearButton()">\r\n    {{\'igo.geo.spatialFilter.removeLayer\' | translate}}\r\n  </button>\r\n\r\n  <button mat-raised-button class="export-button" [disabled]="!store.entities$.getValue().length" (click)="export.emit()">\r\n    {{\'igo.geo.spatialFilter.exportLayer\' | translate}}\r\n  </button>\r\n\r\n</div>\r\n\r\n<div class="results" *ngIf="store">\r\n  <mat-table class="results-list" [dataSource]="store.entities$.value">\r\n\r\n    \x3c!-- Type Column --\x3e\r\n    <ng-container matColumnDef="typeResults">\r\n        <mat-header-cell *matHeaderCellDef>{{\'igo.geo.spatialFilter.type\' | translate}}</mat-header-cell>\r\n        <mat-cell *matCellDef="let result"> {{result.meta.title}} </mat-cell>\r\n      </ng-container>\r\n\r\n    \x3c!-- Name Column --\x3e\r\n    <ng-container matColumnDef="nameResults">\r\n      <mat-header-cell *matHeaderCellDef>{{\'igo.geo.spatialFilter.searchResults\' | translate}}</mat-header-cell>\r\n      <mat-cell *matCellDef="let result"> {{result.properties.nom}} </mat-cell>\r\n    </ng-container>\r\n\r\n    <mat-header-row *matHeaderRowDef="displayedColumnsResults"></mat-header-row>\r\n    <mat-row *matRowDef="let row; columns: displayedColumnsResults;"></mat-row>\r\n  </mat-table>\r\n</div>',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".header{margin-top:5px;width:100%}.mat-slide-toggle{padding:5px;margin-bottom:15px;width:98%}.mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 20px)}.radius-form,.title{margin-left:5px}.title{font-size:initial}.mat-radio-group{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;padding-top:10px}.mat-radio-button{display:-webkit-inline-box;display:inline-flex;position:relative;margin-left:16px;margin-top:10px}.mat-form-field{margin-top:5px}.mat-column-select{overflow:auto}.buttons{margin-top:10px}.search-button{left:25px;width:150px}.remove-button{margin:12px;width:150px}.clear-form-button,.clear-search-button{left:10px;width:150px}.thematics{max-height:150px;overflow:auto;margin-top:5px;width:98%}.results{overflow:auto;max-height:250px;width:98%}.mat-column-typeResults{max-width:100px;margin-right:5px}.radius{width:90%}.radius ::ng-deep .mat-form-field-infix{display:-webkit-inline-box;display:inline-flex}.unit-field{padding-left:5px;padding-right:5px}.example-tree-invisible{display:none}.tree-ul{margin:0;padding:0 0 0 20px;list-style-type:none}.tree-check,.tree-check-2{position:relative;margin-left:auto;margin-right:5px}.thematics-header{max-width:250px}.checks-header{padding:none;max-width:calc(100% - 316px);overflow:hidden}.mat-checkbox{padding:5px}.mat-tree-node{position:relative;min-height:42px;width:280px}.mat-header-cell{height:56px}"]}]}],Ol.ctorParameters=function(){return[{type:je.ChangeDetectorRef},{type:ca},{type:Ae.MessageService},{type:Ae.LanguageService}]},Ol.propDecorators={map:[{type:je.Input}],type:[{type:je.Input}],queryType:[{type:je.Input}],zone:[{type:je.Input}],loading:[{type:je.Input}],store:[{type:je.Input}],layers:[{type:je.Input}],toggleSearch:[{type:je.Output}],itemTypeChange:[{type:je.Output}],thematicChange:[{type:je.Output}],drawZoneEvent:[{type:je.Output}],radiusEvent:[{type:je.Output}],freehandControl:[{type:je.Output}],clearButtonEvent:[{type:je.Output}],clearSearchEvent:[{type:je.Output}],"export":[{type:je.Output}]},Ol);function Ol(e,t,r,o){this.cdRef=e,this.spatialFilterService=t,this.messageService=r,this.languageService=o,this.layers=[],this.toggleSearch=new je.EventEmitter,this.itemTypeChange=new je.EventEmitter,this.thematicChange=new je.EventEmitter,this.drawZoneEvent=new je.EventEmitter,this.radiusEvent=new je.EventEmitter,this.freehandControl=new je.EventEmitter,this.clearButtonEvent=new je.EventEmitter,this.clearSearchEvent=new je.EventEmitter,this["export"]=new je.EventEmitter,this.itemType=[ua.Address,ua.Thematics],this.selectedItemType=ua.Address,this.treeControl=new le.NestedTreeControl(function(e){return e.children}),this.displayedColumns=["name","select"],this.childrens=[],this.groups=[],this.thematics=[],this.dataSource=new Fe.MatTreeNestedDataSource,this.selectedThematics=new se.SelectionModel(!0,[]),this.displayedColumnsResults=["typeResults","nameResults"],this.value$=new Le.BehaviorSubject(undefined),this.drawGuide$=new Le.BehaviorSubject(null),this.overlayStyle$=new Le.BehaviorSubject(undefined),this.drawStyle$=new Le.BehaviorSubject(undefined),this.formControl=new ve.FormControl,this.geometryTypeField=!1,this.geometryTypes=["Point","Polygon"],this.drawGuideField=!1,this.drawGuide=null,this.drawGuidePlaceholder="",this.measure=!1,this.drawControlIsActive=!0,this.freehandDrawIsActive=!1,this.radiusFormControl=new ve.FormControl,this.measureUnit=ka.Meters}var Fl=(xl.forRoot=function(){return{ngModule:xl,providers:[{provide:Fe.MAT_DATE_LOCALE,useValue:"fr-FR"}]}},xl.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,ve.FormsModule,ve.ReactiveFormsModule,Fe.MatAutocompleteModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTabsModule,Fe.MatRadioModule,Fe.MatMenuModule,Fe.MatTableModule,Fe.MatTreeModule,Fe.MatButtonToggleModule,Fe.MatCheckboxModule,Fe.MatSliderModule,Fe.MatSlideToggleModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatOptionModule,Fe.MatSelectModule,Fe.MatListModule,Fe.MatTooltipModule,Fe.MatDatepickerModule,Fe.MatNativeDateModule,V.MatDatetimepickerModule,V.MatNativeDatetimeModule,Ae.IgoLanguageModule,Ni,Ce.IgoCollapsibleModule,Ce.IgoListModule,Ce.IgoKeyValueModule,Us,Fe.MatBadgeModule],exports:[ra,zs,Hs,Zs,Js,el,nl,gl,ml,al,ll,cl,dl,vl,Sl,Il],declarations:[ra,zs,Hs,Zs,Js,el,nl,gl,ml,al,ll,cl,dl,vl,Sl,Il],providers:[na,aa,ca]}]}],xl);function xl(){}var Cl=(Object.defineProperty(Tl.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),Object.defineProperty(Tl.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Object.defineProperty(Tl.prototype,"options",{get:function(){if(this.layer)return this.layer.dataSource.options},enumerable:!0,configurable:!0}),Tl.prototype.layerIsExportable=function(){return!!(this.layer instanceof Vr&&!0===this.layer.exportable||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url)},Tl.decorators=[{type:je.Component,args:[{selector:"igo-export-button",template:'<button\r\n  *ngIf="layerIsExportable()"\r\n  mat-icon-button\r\n  tooltip-position="below"\r\n  matTooltipShowDelay="500"\r\n  [matTooltip]="\'igo.geo.download.action\' | translate"\r\n  [color]="color">\r\n  \x3c!-- (click)="openDownload(layer)"> --\x3e\r\n  <mat-icon svgIcon="file-export"></mat-icon>\r\n</button>\r\n\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],Tl.ctorParameters=function(){return[]},Tl.propDecorators={layer:[{type:je.Input}],color:[{type:je.Input}]},Tl);function Tl(){this._color="primary"}var Ll,Ml=(Ke(Pl,Ll=Error),Pl);function Pl(){return null!==Ll&&Ll.apply(this,arguments)||this}var kl,Dl=(Ke(jl,kl=Ml),jl);function jl(){var e=kl.call(this,"Invalid file")||this;return Object.setPrototypeOf(e,jl.prototype),e}var El,$l=(Ke(Rl,El=Ml),Rl);function Rl(){var e=El.call(this,"Nothing to export")||this;return Object.setPrototypeOf(e,Rl.prototype),e}function Al(e,t,r){if(e instanceof $l)Gl(t,r);else{var o=r.translate,n=o.instant("igo.geo.export.failed.title"),i=o.instant("igo.geo.export.failed.text");t.error(i,n)}}function Bl(e,t){var r=t.translate,o=r.instant("igo.geo.export.success.title"),n=r.instant("igo.geo.export.success.text");e.success(n,o)}function Gl(e,t){var r=t.translate,o=r.instant("igo.geo.export.nothing.title"),n=r.instant("igo.geo.export.nothing.text");e.error(n,o)}var _l=ke.strEnum(["GeoJSON","GML","GPX","KML","Shapefile","CSVcomma","CSVsemicolon","URL"]),ql=(Nl.prototype["export"]=function(e,t,r,o,n){void 0===o&&(o="EPSG:4326"),void 0===n&&(n="EPSG:4326");var i=this.generateFeature(e,t);return this.exportAsync(i,t,r,o,n)},Nl.prototype.generateFeature=function(e,t){return t===_l.GPX&&this.aggregateInComment?this.generateAggratedFeature(e):e.map(function(r){var e=r.getKeys().filter(function(e){return!e.startsWith("_")}).reduce(function(e,t){return e[t]=r.get(t),e},{geometry:r.getGeometry()});return new be(e)})},Nl.prototype.generateAggratedFeature=function(e){return e.map(function(r){var e=r.getKeys().filter(function(e){return!e.startsWith("_")}),o="",t=e.reduce(function(e,t){return t!==undefined&&"geometry"!==t&&(o+=t+":"+r.get(t)+"   \r\n"),e[t]=r.get(t),e},{geometry:r.getGeometry()}),n=new be(t);return n.set("name",r.getId()),n.set("cmt",o),n})},Nl.prototype.exportAsync=function(t,r,o,n,i){var a=this;return new Le.Observable(function(e){if(!0!==a.nothingToExport(t,r))if(0<=Object.keys(Nl.ogreFormats).indexOf(r)){if(a.ogreUrl===undefined)return void(0<=Nl.noOgreFallbacks.indexOf(r)?a.exportToFile(t,e,r,o,n,i):e.error(new Dl));a.exportWithOgre(t,e,r,o,n,i)}else a.exportToFile(t,e,r,o,n,i);else e.error(new $l)})},Nl.prototype.exportToFile=function(e,t,r,o,n,i){var a=(new De[r]).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),s=o+"."+r.toLowerCase();ke.downloadContent(a,"text/plain;charset=utf-8",s),t.complete()},Nl.prototype.exportWithOgre=function(e,t,r,o,n,i){var a=(new De.GeoJSON).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),s=this.ogreUrl+"/convertJson",l=document.createElement("form");if(l.style.display="none",document.body.appendChild(l),l.setAttribute("method","post"),l.setAttribute("target","_blank"),l.setAttribute("action",s),l.acceptCharset="UTF-8",l.enctype="application/x-www-form-urlencoded; charset=utf-8;","CSVsemicolon"===r){var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","lco"),u.setAttribute("value","SEPARATOR=SEMICOLON"),l.appendChild(u)}var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","json"),c.setAttribute("value",a),l.appendChild(c);var p=document.createElement("input"),d="Shapefile"===r?o+".zip":o+"."+r.toLowerCase();"CSVcomma"!==r&&"CSVsemicolon"!==r||(d=o+".csv"),d=(d=d.replace(" ","_")).normalize("NFD").replace(/[\u0300-\u036f]/g,""),p.setAttribute("type","hidden"),p.setAttribute("name","outputName"),p.setAttribute("value",d),l.appendChild(p);var h=Nl.ogreFormats[r];"CSVcomma"!==r&&"CSVsemicolon"!==r||(h="CSV");var g=document.createElement("input");g.setAttribute("type","hidden"),g.setAttribute("name","format"),g.setAttribute("value",h),l.appendChild(g),l.submit(),document.body.removeChild(l),t.complete()},Nl.prototype.nothingToExport=function(e,t){return 0===e.length||"GPX"===t&&e.find(function(e){return 0<=["Point","LineString","MultiLineString"].indexOf(e.getGeometry().getType())})===undefined},Nl.ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"},Nl.noOgreFallbacks=["GML","GPX","KML"],Nl.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Nl.ctorParameters=function(){return[{type:Ae.ConfigService}]},Nl.ngInjectableDef=je.defineInjectable({factory:function(){return new Nl(je.inject(Ae.ConfigService))},token:Nl,providedIn:"root"}),Nl);function Nl(e){this.config=e,this.aggregateInComment=!0,this.ogreUrl=this.config.getConfig("importExport.url");var t=this.config.getConfig("importExport.gpxAggregateInComment");t!==undefined&&(this.aggregateInComment=t)}var Vl,Ul=(Ke(Wl,Vl=Error),Wl);function Wl(){return null!==Vl&&Vl.apply(this,arguments)||this}var zl,Kl=(Ke(Hl,zl=Ul),Hl);function Hl(){var e=zl.call(this,"Invalid file")||this;return Object.setPrototypeOf(e,Hl.prototype),e}var Yl,Zl=(Ke(Ql,Yl=Ul),Ql);function Ql(){var e=Yl.call(this,"Failed to read file")||this;return Object.setPrototypeOf(e,Ql.prototype),e}var Jl,Xl=(Ke(eu,Jl=Ul),eu);function eu(){var e=Jl.call(this,"Nothing to import")||this;return Object.setPrototypeOf(e,eu.prototype),e}var tu,ru=(Ke(ou,tu=Ul),ou);function ou(){var e=tu.call(this,"File is too large")||this;return Object.setPrototypeOf(e,Xl.prototype),e}var nu,iu=(Ke(au,nu=Ul),au);function au(){var e=nu.call(this,"Invalid SRS definition")||this;return Object.setPrototypeOf(e,Xl.prototype),e}function su(e,t,r){var o=e.map(function(e){return Wo(e,t.projection)}),n=Math.floor(255*Math.random()),i=Math.floor(255*Math.random()),a=Math.floor(255*Math.random()),s=new we.Stroke({color:[n,i,a,1],width:2}),l=new we.Fill({color:[n,i,a,.4]}),u=new ct({type:"vector",queryable:!0});u.ol.addFeatures(o);var c=new Vr({title:r,source:u,style:new we.Style({stroke:s,fill:l,image:new we.Circle({radius:5,stroke:s,fill:l})})});return t.addLayer(c),Xo(t,o),c}function lu(e,t,r,o,n){var i,a,s,l=e.map(function(e){return Wo(e,t.projection)});if(o.getStyleList(r.toString()+".styleByAttribute")){var u=o.getStyleList(r.toString()+".styleByAttribute");i=function(e){return n.createStyleByAttribute(e,u)}}else if(o.getStyleList(r.toString()+".clusterStyle")){var c=o.getStyleList(r.toString()+".clusterParam");a=o.getStyleList(r.toString()+".distance");var p=n.createStyle(o.getStyleList(r.toString()+".clusterStyle"));i=function(e){return n.createClusterStyle(e,c,p)}}else if(o.getStyleList(r.toString()+".style"))i=n.createStyle(o.getStyleList(r.toString()+".style"));else if(o.getStyleList("default.clusterStyle")&&"Point"===e[0].geometry.type){var d=o.getStyleList("default.clusterParam");a=o.getStyleList("default.distance");var h=n.createStyle(o.getStyleList("default.clusterStyle"));i=function(e){return n.createClusterStyle(e,d,h)}}else i=n.createStyle(o.getStyleList("default.style"));if(o.getStyleList(r.toString()+".clusterStyle"))(s=new sr({distance:a,type:"cluster",queryable:!0})).ol.source.addFeatures(l);else if(o.getStyleList(r.toString())){(s=new ct({type:"vector",queryable:!0})).ol.addFeatures(l)}else if(o.getStyleList("default.clusterStyle")&&"Point"===e[0].geometry.type){(s=new sr({distance:a,type:"cluster",queryable:!0})).ol.source.addFeatures(l)}else{(s=new ct({type:"vector",queryable:!0})).ol.addFeatures(l)}var g=new Vr({title:r,source:s,style:i});return t.addLayer(g),Xo(t,l),g}function uu(e,t,r,o,n,i,a){if(0!==t.length){var s=yu(e);i?lu(t,r,s,i,a):su(t,r,s);var l=n.translate,u=l.instant("igo.geo.dropGeoFile.success.title"),c=l.instant("igo.geo.dropGeoFile.success.text",{value:s});o.success(c,u)}else gu(e,o,n)}function cu(e,t,r,o,n){n=n||30,{"Invalid file":pu,"File is too large":hu,"Failed to read file":du,"Invalid SRS definition":fu}[t.message](e,t,r,o,n)}function pu(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.invalid.title"),a=n.instant("igo.geo.dropGeoFile.invalid.text",{value:e.name,mimeType:e.type});r.error(a,i)}function du(e,t,r,o){var n=o.translate,i=n.instant("igo.geo.dropGeoFile.unreadable.title"),a=n.instant("igo.geo.dropGeoFile.unreadable.text",{value:e.name});r.error(a,i)}function hu(e,t,r,o,n){var i=o.translate,a=i.instant("igo.geo.dropGeoFile.tooLarge.title"),s=i.instant("igo.geo.dropGeoFile.tooLarge.text",{value:e.name,size:n});r.error(s,a)}function gu(e,t,r){var o=r.translate,n=o.instant("igo.geo.dropGeoFile.empty.title"),i=o.instant("igo.geo.dropGeoFile.empty.text",{value:e.name,mimeType:e.type});t.error(i,n)}function fu(e,t,r){var o=r.translate,n=o.instant("igo.geo.dropGeoFile.invalidSRS.title"),i=o.instant("igo.geo.dropGeoFile.invalidSRS.text",{value:e.name,mimeType:e.type});t.error(i,n)}function mu(e){return e.name.split(".").pop().toLowerCase()}function yu(e){return e.name.substr(0,e.name.lastIndexOf("."))}var vu=(bu.prototype["import"]=function(e,t,r){return void 0===t&&(t="EPSG:4326"),void 0===r&&(r="EPSG:4326"),this.importAsync(e,t,r)},bu.prototype.getFileImporter=function(e){var t=mu(e),r=e.type,o=Xe(bu.allowedMimeTypes,bu.allowedZipMimeTypes),n=bu.allowedExtensions;return o.indexOf(r)<0&&n.indexOf(t)<0?undefined:"application/json"===r||0<=["json","geojson","kml","gpx"].indexOf(t)?this.importFile:this.ogreUrl!==undefined?this.importFileWithOgre:undefined},bu.prototype.importAsync=function(r,o,n){var i=this;return new Le.Observable(function(e){if(r.size>=i.clientSideFileSizeMax)e.error(new ru);else{var t=i.getFileImporter(r);t!==undefined?t.call(i,r,e,o,n):e.error(new Kl)}})},bu.prototype.importFile=function(o,n,i,a){var s=this,e=new FileReader;e.onload=function(e){try{var t=s.parseFeaturesFromFile(o,e.target.result,i,a);n.next(t)}catch(r){n.error(new Zl)}n.complete()},e.onerror=function(e){n.error(new Zl)},e.readAsText(o,"UTF-8")},bu.prototype.importFileWithOgre=function(r,o,e,n){var i=this,t=this.ogreUrl+"/convert",a=new FormData;a.append("upload",r),a.append("sourceSrs",e),a.append("targetSrs",n),a.append("formatOutput","GEOJSON"),a.append("skipFailures",""),this.http.post(t,a,{headers:new Me.HttpHeaders}).subscribe(function(e){if(null!==e)if(0<(e.errors||[]).length)o.error(new Zl);else{var t=i.parseFeaturesFromGeoJSON(r,e,n);o.next(t),o.complete()}else o.error(new Zl)},function(e){e.error.caught=!0;var t=e.error.msg||"";"No valid files found"===t?o.error(new Kl):t.startWith("ERROR 1: Failed to process SRS definition")?o.error(new iu):o.error(new Zl)})},bu.prototype.parseFeaturesFromFile=function(t,e,r,o){var n,i=mu(t),a=t.type,s=new De.GeoJSON;if("application/vnd.google-earth.kml+xml"===a)n=new De.KML;else if("application/gml+xml"===a)n=new De.GML;else if("application/gpx+xml"===a)n=new De.GPX;else switch(i){case"kml":n=new De.KML;break;case"gpx":n=new De.GPX;break;case"gml":n=new De.GML;break;default:n=s}return n.readFeatures(e,{dataProjection:r,featureProjection:o}).map(function(e){return Object.assign(s.writeFeatureObject(e),{projection:o,meta:{id:ke.uuid(),title:yu(t)}})})},bu.prototype.parseFeaturesFromGeoJSON=function(t,e,r){var o=new De.GeoJSON;return o.readFeatures(e).map(function(e){return Object.assign(o.writeFeatureObject(e),{projection:r,meta:{id:ke.uuid(),title:yu(t)}})})},bu.allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"],bu.allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"],bu.allowedExtensions=["geojson","kml","gpx","json","gml"],bu.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],bu.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.ConfigService}]},bu.ngInjectableDef=je.defineInjectable({factory:function(){return new bu(je.inject(Me.HttpClient),je.inject(Ae.ConfigService))},token:bu,providedIn:"root"}),bu);function bu(e,t){this.http=e,this.config=t,this.ogreUrl=this.config.getConfig("importExport.url");var r=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(r||30)*Math.pow(1024,2)}var Su=(wu.prototype.getStyleList=function(e){return ke.ObjectUtils.resolve(this.styleList,e)},wu.prototype.load=function(r){var o=this,n=r["default"]||{};if(!r.path)return this.styleList=n,!0;var i=this.injector.get(Me.HttpClient);return new Promise(function(t,e){i.get(r.path).pipe(Pe.catchError(function(e){return console.log("StyleList file "+r.path+" could not be read"),t(!0),Le.throwError(e.error||"Server error")})).subscribe(function(e){o.styleList=ke.ObjectUtils.mergeDeep(n,e),t(!0)})})},wu.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],wu.ctorParameters=function(){return[{type:je.Injector}]},wu.ngInjectableDef=je.defineInjectable({factory:function(){return new wu(je.inject(je.INJECTOR))},token:wu,providedIn:"root"}),wu);function wu(e){this.injector=e,this.styleList={}}var Iu=(Ou.prototype.ngOnInit=function(){var o=this;this.layers$$=this.map.layers$.subscribe(function(e){o.exportableLayers$.next(e.filter(function(e){return e instanceof Vr&&!0===e.exportable||e.dataSource.options.download&&e.dataSource.options.download.url}))});var e=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(e||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe(Pe.skipWhile(function(e){return!e})).subscribe(function(e){o.form.patchValue(e,{emitEvent:!0}),e.layer&&o.computeFormats(e.layer.map(function(e){return o.map.getLayerById(e)}))}),this.formLayer$$=this.form.get("layer").valueChanges.subscribe(function(e){o.handlePreviousLayerSpecs();var t=e.map(function(e){return o.map.getLayerById(e)});o.computeFormats(t),-1===Object.keys(o.formats$.value).indexOf(o.form.value.format)&&o.form.patchValue({format:undefined}),o.loading$.next(!0);var r=[];t.forEach(function(e){e instanceof Vr&&0===e.dataSource.ol.getFeatures().length&&(r.push({id:e.id,visible:e.visible,opacity:e.opacity,queryable:e.queryable}),e.opacity=0,e.visible=!0)}),o.previousLayerSpecs$.next(r),setTimeout(function(){o.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe(Pe.skipWhile(function(e){return!e})).subscribe(function(e){1===Object.keys(e).length&&o.form.patchValue({format:e[Object.keys(e)[0]]})}),this.exportableLayers$$=this.exportableLayers$.pipe(Pe.skipWhile(function(e){return!e})).subscribe(function(e){1===e.length&&o.form.patchValue({layer:e[0].id})})},Ou.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()},Ou.prototype.handlePreviousLayerSpecs=function(){var r=this,e=this.previousLayerSpecs$.value;e&&e.length&&e.forEach(function(e){var t=r.map.getLayerById(e.id);t.visible=e.visible,t.opacity=e.opacity,t.queryable=e.queryable}),this.previousLayerSpecs$.next(undefined)},Ou.prototype.importFiles=function(e){var t,r,o=this,n=this.inputProj;this.espgCodeRegex.test(n)&&(n="EPSG:"+n),this.loading$.next(!0);var i=function(t){a.importService["import"](t,n).subscribe(function(e){return o.onFileImportSuccess(t,e)},function(e){return o.onFileImportError(t,e)},function(){o.loading$.next(!1)})},a=this;try{for(var s=Qe(e),l=s.next();!l.done;l=s.next())i(l.value)}catch(u){t={error:u}}finally{try{l&&!l.done&&(r=s["return"])&&r.call(s)}finally{if(t)throw t.error}}},Ou.prototype.handleExportFormSubmit=function(i){var a=this;this.loading$.next(!0),i.layer.forEach(function(e){var t=a.map.getLayerById(e),r=t.title;i.name!==undefined&&(r=i.name);var o,n=t.dataSource.options;i.format===_l.URL&&n.download&&n.download.url?setTimeout(function(){window.open(n.download.url,"_blank"),a.loading$.next(!1)},500):(o=i.featureInMapExtent?t.dataSource.ol.getFeaturesInExtent(t.map.viewController.getExtent()):t.dataSource.ol.getFeatures(),t.dataSource instanceof sr&&(o=o.flatMap(function(e){return e.get("features")})),a.exportService["export"](o,i.format,r,a.map.projection).subscribe(function(){},function(e){return a.onFileExportError(e)},function(){a.onFileExportSuccess(),a.loading$.next(!1)}))})},Ou.prototype.buildForm=function(){this.forceNaming?this.form=this.formBuilder.group({format:["",[ve.Validators.required]],layer:["",[ve.Validators.required]],featureInMapExtent:[!1,[ve.Validators.required]],name:["",[ve.Validators.required]]}):this.form=this.formBuilder.group({format:["",[ve.Validators.required]],layer:["",[ve.Validators.required]],featureInMapExtent:[!1,[ve.Validators.required]]})},Ou.prototype.onFileImportSuccess=function(e,t){this.config.getConfig("importWithStyle")?uu(e,t,this.map,this.messageService,this.languageService,this.styleListService,this.styleService):uu(e,t,this.map,this.messageService,this.languageService)},Ou.prototype.onFileImportError=function(e,t){this.loading$.next(!1),cu(e,t,this.messageService,this.languageService,this.fileSizeMb)},Ou.prototype.onFileExportError=function(e){this.loading$.next(!1),Al(e,this.messageService,this.languageService)},Ou.prototype.loadConfig=function(){this.config.getConfig("importExport.forceNaming")!==undefined&&(this.forceNaming=this.config.getConfig("importExport.forceNaming")),this.computeFormats()},Ou.prototype.computeFormats=function(e){if(e&&e.length){var t={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1};if(e.forEach(function(e){e&&(e instanceof Vr||!e.dataSource.options.download||!e.dataSource.options.download.url?e.dataSource.options.download&&e.dataSource.options.download.url?t.vectorAndUrl=!0:e instanceof Vr&&(t.onlyVector=!0):t.onlyUrl=!0)}),!0===t.onlyUrl&&!1===t.onlyVector)this.formats$.next(ke.strEnum(["URL"]));else if(!0===t.onlyVector&&!1===t.onlyUrl){if(this.computeFormats(),_l.URL in this.formats$.value){var r=Object.keys(this.formats$.value).filter(function(e){return"URL"!==e});this.formats$.next(ke.strEnum(r))}}else!0===t.vectorAndUrl&&!1===t.onlyUrl&&!1===t.onlyVector?(this.computeFormats(),_l.URL in this.formats$.value||((r=Object.keys(this.formats$.value)).push("URL"),this.formats$.next(ke.strEnum(r)))):(this.formats$.next([]),this.messageService.alert(this.languageService.translate.instant("igo.geo.export.noFormat.text"),this.languageService.translate.instant("igo.geo.export.noFormat.title")))}else if(this.config.getConfig("importExport.formats")!==undefined){var o=this.validateListFormat(this.config.getConfig("importExport.formats"));this.formats$.next(ke.strEnum(o))}else this.formats$.next(_l)},Ou.prototype.validateListFormat=function(e){return e.filter(function(e){if(e.toUpperCase()===_l.CSVcomma.toUpperCase()||e.toUpperCase()===_l.CSVsemicolon.toUpperCase()||e.toUpperCase()===_l.GML.toUpperCase()||e.toUpperCase()===_l.GPX.toUpperCase()||e.toUpperCase()===_l.GeoJSON.toUpperCase()||e.toUpperCase()===_l.KML.toUpperCase()||e.toUpperCase()===_l.Shapefile.toUpperCase()||e.toUpperCase()===_l.URL.toUpperCase())return e}).map(function(e){return e.toUpperCase()===_l.CSVcomma.toUpperCase()?e=_l.CSVcomma:e.toUpperCase()===_l.CSVsemicolon.toUpperCase()?e=_l.CSVsemicolon:e.toUpperCase()===_l.GML.toUpperCase()?e=_l.GML:e.toUpperCase()===_l.GPX.toUpperCase()?e=_l.GPX:e.toUpperCase()===_l.GeoJSON.toUpperCase()?e=_l.GeoJSON:e.toUpperCase()===_l.KML.toUpperCase()?e=_l.KML:e.toUpperCase()===_l.Shapefile.toUpperCase()?e=_l.Shapefile:e.toUpperCase()===_l.URL.toUpperCase()?e=_l.URL:void 0})},Ou.prototype.tabChanged=function(e){this.selectedTabIndex.emit(e.index)},Ou.prototype.onFileExportSuccess=function(){Bl(this.messageService,this.languageService)},Ou.prototype.onImportExportChange=function(e){this.activeImportExport=e.value},Ou.decorators=[{type:je.Component,args:[{selector:"igo-import-export",template:'<div class="import-export-toggle mat-typography">\r\n  <mat-button-toggle-group\r\n        [value]="activeImportExport"\r\n        (change)="onImportExportChange($event)">\r\n        <mat-button-toggle [value]="\'import\'">\r\n          {{\'igo.geo.importExportForm.importTabTitle\' | translate}}\r\n        </mat-button-toggle>\r\n        <mat-button-toggle [value]="\'export\'">\r\n          {{\'igo.geo.importExportForm.exportTabTitle\' | translate}}\r\n        </mat-button-toggle>\r\n  </mat-button-toggle-group>\r\n</div>\r\n\r\n<form class="igo-form" *ngIf="activeImportExport === \'import\'">\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        placeholder="{{\'igo.geo.importExportForm.importProjPlaceholder\' | translate}}"\r\n        name="inputProj"\r\n        [(ngModel)]="inputProj">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-form-button-group">\r\n    <button mat-raised-button type="button" (click)="fileInput.click()" [disabled]="loading$ | async">\r\n      {{\'igo.geo.importExportForm.importButton\' | translate}}\r\n    </button>\r\n    <igo-spinner [shown]="loading$ | async"></igo-spinner>\r\n    <input\r\n      hidden\r\n      #fileInput\r\n      type="file"\r\n      [style.display]="\'none\'"\r\n      (click)="fileInput.value = null"\r\n      (change)="importFiles($event.target.files)">\r\n  </div>\r\n</form>\r\n<section class="mat-typography" *ngIf="activeImportExport === \'import\'">\r\n  <h4>{{\'igo.geo.importExportForm.importClarifications\' | translate}}</h4>\r\n  <ul>\r\n    <li>{{\'igo.geo.importExportForm.importSizeMax\' | translate: {size: fileSizeMb} }}</li>\r\n    <li>{{\'igo.geo.importExportForm.importFormatAuthorized\' | translate}}</li>\r\n    <li>{{\'igo.geo.importExportForm.importShpZip\' | translate}}</li>\r\n  </ul>\r\n</section>\r\n\r\n<section class="mat-typography" *ngIf="(exportableLayers$ | async).length === 0 && activeImportExport === \'export\'">\r\n  <h4>{{\'igo.geo.importExportForm.exportNoLayersExportable\' | translate}}</h4>\r\n</section>\r\n\r\n<form class="igo-form" [formGroup]="form" *ngIf="(exportableLayers$ | async).length > 0 && activeImportExport === \'export\'">\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <mat-label>{{\'igo.geo.importExportForm.exportLayerPlaceholder\' | translate}}</mat-label>\r\n      <mat-select\r\n        [formControl]="form.controls.layer" multiple>\r\n        <mat-option *ngFor="let layer of (exportableLayers$ | async)" [value]="layer.id">\r\n          {{layer.title}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <mat-label>{{\'igo.geo.importExportForm.exportFormatPlaceholder\' | translate}}</mat-label>\r\n      <mat-select\r\n        formControlName="format">\r\n        <ng-container *ngIf="(formats$ | async).length !== 0">\r\n          <mat-option *ngFor="let format of (formats$ | async) | keyvalue" [value]="format.key">\r\n            {{\'igo.geo.export.format.\' + format.value | translate}}\r\n          </mat-option>\r\n        </ng-container>\r\n        <mat-option *ngIf="(formats$ | async).length === 0" disabled="true">\r\n          {{\'igo.geo.export.noFormat.title\' | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" *ngIf="forceNaming && form.value.format !== \'URL\'">\r\n    <mat-form-field>\r\n        <input matInput formControlName="name" placeholder="{{\'igo.geo.importExportForm.exportFileNamePlaceholder\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="export-options mat-typography" *ngIf="form.value.format !== \'URL\'">\r\n    <mat-slide-toggle\r\n        formControlName="featureInMapExtent"\r\n        [labelPosition]="\'before\'">\r\n          {{\'igo.geo.importExportForm.exportFeatureInExtent\' | translate}}\r\n    </mat-slide-toggle>\r\n  </div>\r\n\r\n  <div class="igo-form-button-group">\r\n    <button\r\n      mat-raised-button\r\n      type="button"\r\n      [disabled]="!form.valid || (loading$ | async)"\r\n      (click)="handleExportFormSubmit(form.value)">\r\n      {{form.value.format !== \'URL\'  ? (\'igo.geo.importExportForm.exportButton\' | translate): (\'igo.geo.importExportForm.exportButtonLink\' | translate)}}\r\n    </button>\r\n    <igo-spinner [shown]="loading$ | async"></igo-spinner>\r\n  </div>\r\n\r\n</form>\r\n',styles:[".import-export-toggle{padding:10px;text-align:center}.import-export-toggle mat-button-toggle-group{width:100%}.import-export-toggle mat-button-toggle-group mat-button-toggle{width:50%}h4{padding:0 5px}.igo-form{padding:15px 5px}.igo-input-container mat-form-field{width:100%}.igo-form-button-group{text-align:center;padding-top:10px}igo-spinner{position:absolute;padding-left:10px}.export-options{overflow-x:hidden}.export-options mat-slide-toggle{width:100%;margin:10px}.export-options mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px)}"]}]}],Ou.ctorParameters=function(){return[{type:vu},{type:ql},{type:Ae.LanguageService},{type:Ae.MessageService},{type:Su},{type:no},{type:ve.FormBuilder},{type:Ae.ConfigService}]},Ou.propDecorators={map:[{type:je.Input}],selectedIndex:[{type:je.Input}],selectedTabIndex:[{type:je.Output}],exportOptions$:[{type:je.Input}],exportOptionsChange:[{type:je.Output}]},Ou);function Ou(e,t,r,o,n,i,a,s){this.importService=e,this.exportService=t,this.languageService=r,this.messageService=o,this.styleListService=n,this.styleService=i,this.formBuilder=a,this.config=s,this.formats$=new Le.BehaviorSubject(undefined),this.exportableLayers$=new Le.BehaviorSubject([]),this.inputProj="EPSG:4326",this.loading$=new Le.BehaviorSubject(!1),this.forceNaming=!1,this.espgCodeRegex=new RegExp("^\\d{4,6}"),this.activeImportExport="import",this.previousLayerSpecs$=new Le.BehaviorSubject(undefined),this.selectedIndex=0,this.selectedTabIndex=new je.EventEmitter,this.exportOptions$=new Le.BehaviorSubject(undefined),this.exportOptionsChange=new je.EventEmitter,this.loadConfig(),this.buildForm(),console.log(this),console.log(this.form),console.log(this.form)}var Fu,xu=(Ke(Cu,Fu=Ce.DragAndDropDirective),Object.defineProperty(Cu.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Cu.prototype.ngOnInit=function(){var t=this;this.filesDropped$$=this.filesDropped.subscribe(function(e){t.onFilesDropped(e)})},Cu.prototype.ngOnDestroy=function(){this.filesDropped$$.unsubscribe()},Cu.prototype.onDragOver=function(e){Fu.prototype.onDragOver.call(this,e)},Cu.prototype.onDragLeave=function(e){Fu.prototype.onDragLeave.call(this,e)},Cu.prototype.onDrop=function(e){Fu.prototype.onDrop.call(this,e)},Cu.prototype.onFilesDropped=function(e){var t,r,o=this,n=function(t){i.importService["import"](t).subscribe(function(e){return o.onFileImportSuccess(t,e)},function(e){return o.onFileImportError(t,e)})},i=this;try{for(var a=Qe(e),s=a.next();!s.done;s=a.next())n(s.value)}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=a["return"])&&r.call(a)}finally{if(t)throw t.error}}},Cu.prototype.onFileImportSuccess=function(e,t){this.config.getConfig("importWithStyle")?uu(e,t,this.map,this.messageService,this.languageService,this.styleListService,this.styleService):uu(e,t,this.map,this.messageService,this.languageService)},Cu.prototype.onFileImportError=function(e,t){cu(e,t,this.messageService,this.languageService,this.config.getConfig("importExport.clientSideFileSizeMaxMb"))},Cu.decorators=[{type:je.Directive,args:[{selector:"[igoDropGeoFile]"}]}],Cu.ctorParameters=function(){return[{type:Hr},{type:vu},{type:Ae.LanguageService},{type:Su},{type:no},{type:Ae.ConfigService},{type:Ae.MessageService}]},Cu.propDecorators={onDragOver:[{type:je.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:je.HostListener,args:["dragleave",["$event"]]}],onDrop:[{type:je.HostListener,args:["drop",["$event"]]}]},Cu);function Cu(e,t,r,o,n,i,a){var s=Fu.call(this)||this;return s.component=e,s.importService=t,s.languageService=r,s.styleListService=o,s.styleService=n,s.config=i,s.messageService=a,s.filesDropped=new je.EventEmitter,s.filesInvalid=new je.EventEmitter,s}var Tu=new je.InjectionToken("styleListOptions");function Lu(e){return{provide:Tu,useValue:e}}function Mu(e,t){return function(){return e.load(t)}}function Pu(){return{provide:je.APP_INITIALIZER,useFactory:Mu,multi:!0,deps:[Su,Tu]}}var ku=(Du.forRoot=function(){return{ngModule:Du,providers:[Lu({}),Pu()]}},Du.decorators=[{type:je.NgModule,args:[{imports:[],declarations:[],exports:[]}]}],Du);function Du(){}var ju=(Eu.forRoot=function(){return{ngModule:Eu}},Eu.decorators=[{type:je.NgModule,args:[{imports:[Fe.MatIconModule,Fe.MatTooltipModule,ve.FormsModule,ve.ReactiveFormsModule,xe.CommonModule,Fe.MatButtonModule,Fe.MatButtonToggleModule,Fe.MatTabsModule,Fe.MatSelectModule,Fe.MatOptionModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatSlideToggleModule,Ae.IgoLanguageModule,Ce.IgoSpinnerModule,Ce.IgoKeyValueModule,Ce.IgoDrapDropModule,ku.forRoot()],exports:[Iu,xu,ku,Cl],declarations:[Iu,xu,Cl]}]}],Eu);function Eu(){}var $u=(Ru.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Ae.IgoLanguageModule,Ce.IgoConfirmDialogModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatTooltipModule],exports:[Hr,Ln,Pn,Gn,$n,An,Sn,Dn,In,Fn],declarations:[Hr,Ln,Pn,Gn,$n,An,Sn,Dn,In,Fn]}]}],Ru);function Ru(){}var Au=(Object.defineProperty(Bu.prototype,"measure",{get:function(){return this.measure$.value},set:function(e){this.measure$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"auto",{get:function(){return this._auto},set:function(e){this.toggleAutoUnit(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Bu.prototype,"measureUnits",{get:function(){return this.measureType===Pa.Area?Object.values(ja):Object.values(ka)},enumerable:!0,configurable:!0}),Bu.prototype.ngOnDestroy=function(){this.toggleAutoUnit(!1)},Bu.prototype.onMeasureUnitChange=function(e){this.measureUnit=e,this.measureUnitChange.emit(e)},Bu.prototype.toggleAutoUnit=function(e){var t=this;this.measure$$!==undefined&&this.measure$$.unsubscribe(),!0===e&&(this.measure$$=this.measure$.subscribe(function(e){t.computeBestMeasureUnit(e)})),this._auto=e},Bu.prototype.computeBestMeasureUnit=function(e){var t=this.measureUnit;this.measureType===Pa.Area?t=Ka(e):this.measureType===Pa.Length&&(t=za(e)),t!==this.measureUnit&&this.onMeasureUnitChange(t)},Bu.decorators=[{type:je.Component,args:[{selector:"igo-measurer-item",template:'<mat-form-field class="measure-field">\r\n  <input\r\n    matInput\r\n    [readonly]="true"\r\n    [placeholder]="placeholder"\r\n    [value]="((measure$ | async) || 0) | measureFormat: measureUnit">\r\n</mat-form-field>\r\n<mat-form-field class="unit-field">\r\n  <mat-select\r\n    [value]="measureUnit"\r\n    [disabled]="auto"\r\n    (selectionChange)="onMeasureUnitChange($event.value)">\r\n    <mat-option *ngFor="let measureUnit of measureUnits" [value]="measureUnit">\r\n      {{(\'igo.geo.measure.\' + measureUnit) | translate}}\r\n    </mat-option>\r\n  </mat-select>\r\n</mat-form-field>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host{display:-webkit-box;display:flex;width:100%;padding:5px 10px}.measure-field{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-flow:column nowrap;width:100%}.unit-field{width:110px;margin-left:10px}"]}]}],Bu.ctorParameters=function(){return[]},Bu.propDecorators={measureType:[{type:je.Input}],measureUnit:[{type:je.Input}],measure:[{type:je.Input}],auto:[{type:je.Input}],placeholder:[{type:je.Input}],measureUnitChange:[{type:je.Output}]},Bu);function Bu(){this.measure$=new Le.BehaviorSubject(undefined),this._auto=!1,this.measureUnitChange=new je.EventEmitter}var Gu=(_u.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatButtonModule,Fe.MatButtonToggleModule,Fe.MatIconModule,Fe.MatTooltipModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatSelectModule,Fe.MatSlideToggleModule,Ae.IgoLanguageModule,Ce.IgoEntityTableModule],declarations:[Bs,Au,Rs,Es],exports:[Bs,Rs],entryComponents:[Es]}]}],_u);function _u(){}var qu=(Nu.decorators=[{type:je.NgModule,args:[{imports:[],declarations:[],exports:[Gu]}]}],Nu);function Nu(){}var Vu=(Uu.forRoot=function(){return{ngModule:Uu}},Uu.decorators=[{type:je.NgModule,args:[{imports:[],exports:[Xr],declarations:[Xr]}]}],Uu);function Uu(){}var Wu=pe,zu=(Ku.prototype.print=function(t,r){var o=this,n=new Le.Subject,e=r.paperFormat,i=+r.resolution,a=r.orientation;this.activityId=this.activityService.register();var s=new ce({orientation:a,format:e.toLowerCase()}),l=[s.internal.pageSize.width,s.internal.pageSize.height],u=[20,10,20,10],c=[l[0]-u[3]-u[1],l[1]-u[0]-u[2]];return r.title!==undefined&&this.addTitle(s,r.title,l[0]),!0!==r.showProjection&&!0!==r.showScale||this.addProjScale(s,t,i,r.showProjection,r.showScale),""!==r.comment&&this.addComment(s,r.comment),this.addMap(s,t,i,c,u).subscribe(function(e){e===ke.SubjectStatus.Done&&(!0===r.showLegend?o.addLegend(s,t,u,i):o.saveDoc(s)),e!==ke.SubjectStatus.Done&&e!==ke.SubjectStatus.Error||(o.activityService.unregister(o.activityId),n.next(ke.SubjectStatus.Done))}),n},Ku.prototype.getLayersLegendHtml=function(e,t,r){var o="",n=Dr(e.layers,e.viewController.getScale(r));return 0===n.length?o:(o+='<style media="screen" type="text/css">',o+=".html2canvas-container { width: "+t,o+="mm !important; height: 2000px !important; }",o+="</style>",o+='<font size="2" face="Courier New" >',o+='<div style="display:inline-block;max-width:'+t+'mm">',n.forEach(function(e){o+='<table border=1 style="display:inline-block;vertical-align:top">',o+='<tr><th width="170px">'+e.title+"</th>",o+='<td><img class="printImageLegend" src="'+e.url+'">',o+="</td></tr></table>"}),o+="</div>")},Ku.prototype.getLayersLegendImage=function(e,o,n,t){void 0===o&&(o="png");var i=new Le.Subject,r=this.getLayersLegendHtml(e,200,t),a=this;o=o.toLowerCase(),0===r.length&&(r='<font size="12" face="Courier New" >',r+='<div align="center"><b>NO LEGEND</b></div>');var s=window.document.createElement("div");window.document.body.appendChild(s),s.innerHTML=r,setTimeout(function(){Wu(s,{useCORS:!0}).then(function(e){var t=ke.SubjectStatus.Done;try{n?a.generateCanvaFileToZip(e,"legendImage."+o):a.saveCanvasImageAsFile(e,"legendImage",o),s.parentNode.removeChild(s)}catch(r){t=ke.SubjectStatus.Error}i.next(t)})["catch"](function(e){console.log(e)})},500)},Ku.prototype.addTitle=function(e,t,r){var o,n=812.8/96*t.length;o=r<n?0:(r-n)/2,e.setFont("courier"),e.setFontSize(32),e.text(t,o,15)},Ku.prototype.addComment=function(e,t){var r=e.internal.pageSize.height-5;e.setFont("courier"),e.setFontSize(16),e.text(t,20,r)},Ku.prototype.addProjScale=function(e,t,r,o,n){var i=this.languageService.translate,a=e.internal.pageSize.height-15,s="";!0===o&&(s+=i.instant("igo.geo.printForm.projection")+": "+t.projection),!0===n&&(!0===o&&(s+="   "),s+=i.instant("igo.geo.printForm.scale")+": ~ 1 / "+fr(t.viewController.getScale(r))),e.setFont("courier"),e.setFontSize(16),e.text(s,20,a)},Ku.prototype.addLegend=function(o,e,n,t){var i=this,a=this,r=o.internal.pageSize.width,s=this.getLayersLegendHtml(e,r,t);if(""===s)return this.saveDoc(o),!0;var l=window.document.createElement("div");Wu(l,{useCORS:!0}).then(function(e){var t;t=e.toDataURL("image/png"),o.addPage();var r=i.getImageSizeToFitPdf(o,e,n);o.addImage(t,"PNG",10,10,r[0],r[1]),a.saveDoc(o),l.parentNode.removeChild(l)})["catch"](function(e){console.log(e)}),window.document.body.appendChild(l),l.innerHTML=s},Ku.prototype.addCanvas=function(e,t,r){var o;if((o=t.toDataURL("image/jpeg"))!==undefined){var n=this.getImageSizeToFitPdf(e,t,r);e.addImage(o,"JPEG",r[3],r[0],n[0],n[1]),e.rect(r[3],r[0],n[0],n[1])}},Ku.prototype.addMap=function(i,a,e,t,s){var l,u=this,c=new Le.Subject,p=a.ol.getSize(),d=a.ol.getView().calculateExtent(p),r=Math.round(t[0]*e/25.4),o=Math.round(t[1]*e/25.4);return a.ol.once("postcompose",function(e){var o=e.context.canvas,n=a.status$.subscribe(function(e){if(clearTimeout(l),e===ke.SubjectStatus.Done){n.unsubscribe();var t=ke.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(r){t=ke.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(t)}});l=window.setTimeout(function(){n.unsubscribe();var e=ke.SubjectStatus.Done;try{u.addCanvas(i,o,s)}catch(t){e=ke.SubjectStatus.Error,u.messageService.error(u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),u.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}u.renderMap(a,p,d),c.next(e)},200)}),this.renderMap(a,[r,o],d),c},Ku.prototype.defineNbFileToProcess=function(e){this.nbFileToProcess=e},Ku.prototype.downloadMapImage=function(x,C,T,L,M,e,P,k,D){var j=this;void 0===T&&(T="png"),void 0===L&&(L=!1),void 0===M&&(M=!1),void 0===e&&(e=!1),void 0===P&&(P=""),void 0===k&&(k=""),void 0===D&&(D=!0);var E=new Le.Subject;this.activityId=this.activityService.register();var $=this.languageService.translate;x.ol.once("postcompose",function(e){T=T.toLowerCase();var t=e.context,r=document.createElement("canvas"),o=r.getContext("2d"),n=0,i=10,a=t.canvas.width,s=t.canvas.height;o.font="20px Calibri";var l=o.measureText(k).width;s=""!==P?s+30:s;var u=(s=!1!==L||!1!==M?s+30:s)-10,c=Math.ceil(l/a),p=(s=""!==k?s+30*c:s)-20*c+5;if(r.width=a,r.height=s,"jpeg"===T&&(o.fillStyle="#ffffff",o.fillRect(0,0,a,s),o.fillStyle="#000000"),""!==P&&(o.font="26px Calibri",n=30,o.textAlign="center",o.fillText(P,a/2,20)),!(o.font="20px Calibri")!==L){var d=$.instant("igo.geo.printForm.projection");o.textAlign="start",o.fillText(d+": "+x.projection,i,u),i+=200}if(!1!==M){var h=$.instant("igo.geo.printForm.scale"),g=x.viewController.getScale(C);o.textAlign="start",o.fillText(h+": ~ 1 / "+fr(g),i,u)}if(""!==k)if(o.textAlign="center",1===c)o.fillText(k,a/2,p);else for(var f=k.length,m=Math.floor(f/c),y="",v=0,b=void 0,S=0;S<c;S++)S<c-1?(b=(y=k.substr(v,m)).lastIndexOf(" "),o.fillText(y.substr(0,b),a/2,p),v+=b,p+=20):o.fillText(k.substr(v),a/2,p);o.drawImage(t.canvas,0,n);var w=ke.SubjectStatus.Done;try{D?"tiff"===T.toLowerCase()?j.generateCanvaFileToZip(r,"map"+x.projection.replace(":","_")+"."+T):j.generateCanvaFileToZip(r,"map."+T):j.saveCanvasImageAsFile(r,"map",T)}catch(F){w=ke.SubjectStatus.Error}if(E.next(w),"tiff"===T.toLowerCase()){var I=j.getWorldFileInformation(x),O=new Blob([I],{type:"text/plain;charset=utf-8"});D?j.addFileToZip("map"+x.projection.replace(":","_")+".tfw",O):(ue.saveAs(O,"map"+x.projection+".tfw"),j.saveFileProcessing())}}),x.ol.renderSync()},Ku.prototype.renderMap=function(e,t,r){e.ol.renderSync()},Ku.prototype.saveDoc=function(e){e.save("map.pdf")},Ku.prototype.getImageSizeToFitPdf=function(e,t,r){var o=e.internal.pageSize.getHeight()-(r[0]+r[2]),n=e.internal.pageSize.getWidth()-(r[1]+r[3]),i=t.height,a=t.width,s=i/o,l=a/n,u=l<s?s:l;return[1<u?a/u:a,1<u?i/u:i]},Ku.prototype.getWorldFileInformation=function(e){var t=e.viewController.getResolution(),r=e.viewController.getExtent();return[t,0,0,-t,r[0]+t/.5,r[3]-t/.5].join("\n")},Ku.prototype.saveCanvasImageAsFile=function(e,t,r){var o="image/"+r,n=this;try{e.toDataURL(),navigator.msSaveBlob?(navigator.msSaveBlob(e.msToBlob(),t+"."+r),this.saveFileProcessing()):e.toBlob(function(e){ue.saveAs(e,t+"."+r),n.saveFileProcessing()},o)}catch(i){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},Ku.prototype.generateCanvaFileToZip=function(e,t){var r=this;this.hasOwnProperty("zipFile")&&"undefined"!=typeof this.zipFile||(this.zipFile=new de);try{e.toDataURL(),navigator.msSaveBlob?this.addFileToZip(t,e.msToBlob()):e.toBlob(function(e){r.addFileToZip(t,e)},"image/jpeg")}catch(o){this.messageService.error(this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageBody"),this.languageService.translate.instant("igo.geo.printForm.corsErrorMessageHeader"),"print")}},Ku.prototype.addFileToZip=function(e,t){this.zipFile.file(e,t),this.nbFileToProcess--,0===this.nbFileToProcess&&(this.getZipFile(),this.activityService.unregister(this.activityId))},Ku.prototype.saveFileProcessing=function(){this.nbFileToProcess--,0===this.nbFileToProcess&&this.activityService.unregister(this.activityId)},Ku.prototype.getZipFile=function(){var t=this;this.zipFile.generateAsync({type:"blob"}).then(function(e){ue.saveAs(e,"map.zip"),delete t.zipFile})},Ku.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Ku.ctorParameters=function(){return[{type:Ae.MessageService},{type:Ae.ActivityService},{type:Ae.LanguageService}]},Ku.ngInjectableDef=je.defineInjectable({factory:function(){return new Ku(je.inject(Ae.MessageService),je.inject(Ae.ActivityService),je.inject(Ae.LanguageService))},token:Ku,providedIn:"root"}),Ku);function Ku(e,t,r){this.messageService=e,this.activityService=t,this.languageService=r}var Hu=(Object.defineProperty(Yu.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"outputFormat",{get:function(){return this._outputFormat},set:function(e){this._outputFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"paperFormat",{get:function(){return this._paperFormat},set:function(e){this._paperFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"orientation",{get:function(){return this._orientation},set:function(e){this._orientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"imageFormat",{get:function(){return this._imageFormat},set:function(e){this._imageFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(Yu.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._resolution=e},enumerable:!0,configurable:!0}),Yu.prototype.handleFormSubmit=function(e){if((this.disabled=!0)===e.isPrintService)this.printService.print(this.map,e).subscribe();else{var t=1;e.showLegend&&t++,"tiff"===e.imageFormat.toLowerCase()&&t++,this.printService.defineNbFileToProcess(t);var r=+e.resolution;this.printService.downloadMapImage(this.map,r,e.imageFormat,e.showProjection,e.showScale,e.showLegend,e.title,e.comment,e.doZipFile),e.showLegend&&this.printService.getLayersLegendImage(this.map,e.imageFormat,e.doZipFile,+r)}this.disabled=!1},Yu.decorators=[{type:je.Component,args:[{selector:"igo-print",template:'<igo-print-form\r\n  [outputFormat]="outputFormat"\r\n  [paperFormat]="paperFormat"\r\n  [orientation]="orientation"\r\n  [imageFormat]="imageFormat"\r\n  [resolution]="resolution"\r\n  [disabled]="disabled"\r\n  (submit)="handleFormSubmit($event)">\r\n</igo-print-form>\r\n'}]}],Yu.ctorParameters=function(){return[{type:zu}]},Yu.propDecorators={map:[{type:je.Input}],outputFormat:[{type:je.Input}],paperFormat:[{type:je.Input}],orientation:[{type:je.Input}],imageFormat:[{type:je.Input}],resolution:[{type:je.Input}]},Yu);function Yu(e){this.printService=e,this.disabled=!1}var Zu=ke.strEnum(["Pdf","Image"]),Qu=ke.strEnum(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),Ju=ke.strEnum(["landscape","portrait"]),Xu=ke.strEnum(["72","96","150","300"]),ec=ke.strEnum(["Bmp","Gif","Jpeg","Png","Tiff"]),tc=(Object.defineProperty(rc.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"imageFormat",{get:function(){return this.imageFormatField.value},set:function(e){this.imageFormatField.setValue(e||ec.Jpeg,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"outputFormat",{get:function(){return this.outputFormatField.value},set:function(e){this.outputFormatField.setValue(e||Zu.Pdf,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"paperFormat",{get:function(){return this.paperFormatField.value},set:function(e){this.paperFormatField.setValue(e||Qu.Letter,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"orientation",{get:function(){return this.orientationField.value},set:function(e){this.orientationField.setValue(e||Ju.landscape,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"resolution",{get:function(){return this.resolutionField.value},set:function(e){this.resolutionField.setValue(e||Xu[96],{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"title",{get:function(){return this.titleField.value},set:function(e){this.titleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"comment",{get:function(){return this.commentField.value},set:function(e){this.commentField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"showProjection",{get:function(){return this.showProjectionField.value},set:function(e){this.showProjectionField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"showScale",{get:function(){return this.showScaleField.value},set:function(e){this.showScaleField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"showLegend",{get:function(){return this.showLegendField.value},set:function(e){this.showLegendField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"doZipFile",{get:function(){return this.doZipFileField.value},set:function(e){this.doZipFileField.setValue(e,{onlySelf:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"outputFormatField",{get:function(){return this.form.controls.outputFormat},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"paperFormatField",{get:function(){return this.form.controls.paperFormat},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"imageFormatField",{get:function(){return this.form.controls.imageFormat},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"orientationField",{get:function(){return this.form.controls.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"resolutionField",{get:function(){return this.form.controls.resolution},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"commentField",{get:function(){return this.form.controls.comment},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"showProjectionField",{get:function(){return this.form.controls.showProjection},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"showScaleField",{get:function(){return this.form.controls.showScale},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"showLegendField",{get:function(){return this.form.controls.showLegend},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"doZipFileField",{get:function(){return this.form.controls.doZipFile},enumerable:!0,configurable:!0}),Object.defineProperty(rc.prototype,"titleField",{get:function(){return this.form.controls.title},enumerable:!0,configurable:!0}),rc.prototype.ngOnInit=function(){this.doZipFileField.setValue(!1)},rc.prototype.handleFormSubmit=function(e,t){this.submitted=!0,e.isPrintService=this.isPrintService,t&&this.submit.emit(e)},rc.prototype.toggleImageSaveProp=function(){"Image"===this.outputFormatField.value?this.isPrintService=!1:this.isPrintService=!0},rc.decorators=[{type:je.Component,args:[{selector:"igo-print-form",template:'<form class="igo-form" [formGroup]="form">\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="title"\r\n        placeholder="{{\'igo.geo.printForm.title\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <input\r\n        matInput\r\n        formControlName="comment"\r\n        placeholder="{{\'igo.geo.printForm.comment\' | translate}}">\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <div class="print-slide-toggle-container mat-typography">\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showProjection"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showProjection\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showScale"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showScale\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="showLegend"\r\n        [labelPosition]="\'before\'">\r\n        {{\'igo.geo.printForm.showLegend\' | translate}}\r\n      </mat-slide-toggle>\r\n      <mat-slide-toggle\r\n        class="print-option"\r\n        formControlName="doZipFile"\r\n        [labelPosition]="\'before\'"\r\n        [style.display]="isPrintService ? \'none\' : \'\'">\r\n        {{\'igo.geo.printForm.doZipFile\' | translate}}\r\n      </mat-slide-toggle>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="igo-input-container">\r\n    <mat-form-field>\r\n      <mat-select (selectionChange)="toggleImageSaveProp()"\r\n        formControlName="outputFormat"\r\n        placeholder="{{\'igo.geo.printForm.outputFormat\' | translate}}">\r\n        <mat-option *ngFor="let outputFormat of outputFormats | keyvalue " [value]="outputFormat.key">\r\n            {{outputFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="paperFormat"\r\n        placeholder="{{\'igo.geo.printForm.paperFormat\' | translate}}">\r\n        <mat-option *ngFor="let paperFormat of paperFormats | keyvalue " [value]="paperFormat.key">\r\n          {{(\'igo.geo.printForm.paperFormats.\' + paperFormat.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'none\' : \'block\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="imageFormat"\r\n        placeholder="{{\'igo.geo.printForm.imageFormat\' | translate}}">\r\n        <mat-option *ngFor="let imageFormat of imageFormats | keyvalue " [value]="imageFormat.key">\r\n          {{imageFormat.value}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" style="display: none;">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="resolution"\r\n        placeholder="{{\'igo.geo.printForm.resolution\' | translate}}">\r\n        <mat-option *ngFor="let resolution of resolutions | keyvalue " [value]="resolution.key">\r\n          {{resolution.value + \' PPI\'}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-input-container" [style.display]="isPrintService ? \'block\' : \'none\'">\r\n    <mat-form-field>\r\n      <mat-select\r\n        formControlName="orientation"\r\n        placeholder="{{\'igo.geo.printForm.orientation\' | translate}}">\r\n        <mat-option *ngFor="let orientation of orientations | keyvalue " [value]="orientation.key">\r\n          {{(\'igo.geo.printForm.\' + orientation.value) | translate}}\r\n        </mat-option>\r\n      </mat-select>\r\n    </mat-form-field>\r\n  </div>\r\n\r\n  <div class="igo-form-button-group print-button-top-padding">\r\n    <button\r\n      mat-raised-button\r\n      type="button"\r\n      [disabled]="!form.valid || disabled"\r\n      (click)="handleFormSubmit(form.value, form.valid)">\r\n      {{\'igo.geo.printForm.saveBtn\' | translate}}\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n',styles:["mat-form-field{width:100%}.print-slide-toggle-container{overflow-x:hidden}.print-slide-toggle-container mat-slide-toggle{width:100%;margin:10px}.print-slide-toggle-container mat-slide-toggle ::ng-deep .mat-slide-toggle-content{width:calc(100% - 60px)}.print-option{display:block;margin-right:10px;margin-bottom:15px}.print-button-top-padding{padding-top:25px}.igo-form{padding:10px 5px 5px}.igo-form-button-group{text-align:center}"]}]}],rc.ctorParameters=function(){return[{type:ve.FormBuilder}]},rc.propDecorators={disabled:[{type:je.Input}],imageFormat:[{type:je.Input}],outputFormat:[{type:je.Input}],paperFormat:[{type:je.Input}],orientation:[{type:je.Input}],resolution:[{type:je.Input}],title:[{type:je.Input}],comment:[{type:je.Input}],showProjection:[{type:je.Input}],showScale:[{type:je.Input}],showLegend:[{type:je.Input}],doZipFile:[{type:je.Input}],submit:[{type:je.Output}]},rc);function rc(e){this.formBuilder=e,this.outputFormats=Zu,this.paperFormats=Qu,this.orientations=Ju,this.resolutions=Xu,this.imageFormats=ec,this.isPrintService=!0,this._disabled=!1,this.submit=new je.EventEmitter,this.form=this.formBuilder.group({title:["",[]],comment:["",[]],outputFormat:["",[ve.Validators.required]],paperFormat:["",[ve.Validators.required]],imageFormat:["",[ve.Validators.required]],resolution:["",[ve.Validators.required]],orientation:["",[ve.Validators.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}]})}var oc=(nc.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,ve.FormsModule,ve.ReactiveFormsModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatSelectModule,Fe.MatOptionModule,Fe.MatInputModule,Fe.MatFormFieldModule,Fe.MatSlideToggleModule,Ae.IgoLanguageModule,Ce.IgoKeyValueModule],exports:[Hu,tc],declarations:[Hu,tc]}]}],nc);function nc(){}function ic(e){return new Ci(e.getConfig("searchSources."+Ci.id)||{})}function ac(){return{provide:Oi,useFactory:ic,multi:!0,deps:[Ae.ConfigService]}}var sc=(lc.forRoot=function(){return{ngModule:lc,providers:[ac()]}},lc.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule],exports:[wi],declarations:[wi],providers:[bi]}]}],lc);function lc(){}var uc=(cc.prototype.getSources=function(){return this.sources},cc.prototype.getEnabledSources=function(){return this.getSources().filter(function(e){return!0===e.enabled})},cc.prototype.enableSourcesByType=function(t){this.getSources().forEach(function(e){e.constructor.type===t?e.enabled=!0:e.enabled=!1})},cc.prototype.setParamFromSetting=function(e,t){e.setParamFromSetting(t)},cc);function cc(e){this.sources=e}function pc(e){return e.search!==undefined}function dc(e){return e.reverseSearch!==undefined}function hc(e){return e.reverseSearch!==undefined&&!0===e.showInPointerSummary}var gc=(fc.prototype.search=function(e,t){if(void 0===t&&(t={}),!this.termIsValid(e))return[];var r,o=dr(e,this.mapService.getMap().projection,{forceNA:t.forceNA});return o.lonLat?this.reverseSearch(o.lonLat,{distance:o.radius}):(o.message&&console.log(o.message),t.extent=this.mapService.getMap().viewController.getExtent("EPSG:4326"),r=t.getEnabledOnly||t.getEnabledOnly===undefined?this.searchSourceService.getEnabledSources():this.searchSourceService.getSources(),t.sourceId?r=r.filter(function(e){return e.getId()===t.sourceId}):t.searchType&&(r=r.filter(function(e){return e.getType()===t.searchType})),r=r.filter(pc),this.searchSources(r,e,t))},fc.prototype.reverseSearch=function(e,t,r){void 0===r&&(r=!1);var o=r?hc:dc,n=this.searchSourceService.getEnabledSources().filter(o);return this.reverseSearchSources(n,e,t||{})},fc.prototype.searchSources=function(e,t,r){return e.map(function(e){return{request:e.search(t,r),reverse:!1,source:e}})},fc.prototype.reverseSearchSources=function(e,t,r){return e.map(function(e){return{request:e.reverseSearch(t,r),reverse:!0,source:e}})},fc.prototype.termIsValid=function(e){return"string"==typeof e&&""!==e},fc.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],fc.ctorParameters=function(){return[{type:uc},{type:So}]},fc.ngInjectableDef=je.defineInjectable({factory:function(){return new fc(je.inject(uc),je.inject(So))},token:fc,providedIn:"root"}),fc);function fc(e,t){this.searchSourceService=e,this.mapService=t}var mc=function Wd(){},yc=function zd(e){this.sources=e};function vc(e){return new yc(e)}function bc(){return{provide:yc,useFactory:vc,deps:[mc]}}var Sc=(wc.prototype.route=function(t,r){var o=this;if(void 0===r&&(r={}),0!==t.length)return this.directionsSourceService.sources.filter(function(e){return e.enabled}).map(function(e){return o.routeSource(e,t,r)})},wc.prototype.routeSource=function(e,t,r){return void 0===r&&(r={}),e.route(t,r)},wc.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],wc.ctorParameters=function(){return[{type:yc}]},wc.ngInjectableDef=je.defineInjectable({factory:function(){return new wc(je.inject(yc))},token:wc,providedIn:"root"}),wc);function wc(e){this.directionsSourceService=e}var Ic=(Oc.prototype.getStopsCoordinates=function(){var t=[];return this.stops&&this.stops.forEach(function(e){t.push(e.stopCoordinates)}),t},Oc.prototype.setStops=function(e){this.stops=e},Oc.prototype.getStops=function(){return this.stops},Oc.decorators=[{type:je.Injectable}],Oc.ctorParameters=function(){return[]},Oc);function Oc(){}var Fc=(xc.prototype.changeRoute=function(){this.showRouteGeometry()},xc.prototype.prevent=function(e){e.preventDefault()},xc.prototype.ngOnInit=function(){var t=this;this.queryService.queryEnabled=!1,this.focusOnStop=!1,this.browserLanguage=this.languageService.getLanguage(),this.stopsForm=this.formBuilder.group({directionsType:"car",directionsMode:"driving",stopOrderPriority:!0,directionsFixedStartEnd:!1,stops:this.formBuilder.array([this.createStop("start"),this.createStop("end")])}),setTimeout(function(){t.initStores(),t.initOlInteraction()},1),this.subscribeToFormChange(),this.routesQueries$$.push(this.stream$.pipe(Pe.debounceTime(this.debounce),Pe.distinctUntilChanged()).subscribe(function(e){return t.handleTermChanged(e)}))},xc.prototype.ngOnDestroy=function(){this.unsubscribeRoutesQueries(),this.unlistenSingleClick(),this.queryService.queryEnabled=!0,this.freezeStores(),this.writeStopsToFormService()},xc.prototype.initStores=function(){var e=new ko({motion:cr.None}),t=this.stopsStore;en(t,new Vr({title:"Directions - stops",zIndex:911,source:new ct,showInLayerList:!1,exportable:!1,browsable:!1,style:Cc})),tn(t,e);var r=this.routeStore;en(r,new Vr({title:"Directions - route and vertex",zIndex:910,source:new ct,showInLayerList:!1,exportable:!1,browsable:!1,style:Cc})),tn(r,e)},xc.prototype.initOlInteraction=function(){var t,o=this,e=new ge.Select({layers:[this.stopsStore.layer.ol],condition:he.pointerMove,hitTolerance:7,filter:function(e){return"stop"===e.get("type")}});e.on("select",function(e){t=e.target.getFeatures()[0]});var r=new ge.Translate({layers:[this.stopsStore.layer.ol],features:t});r.on("translating",function(e){var t=e.features;0!==t.getLength()&&o.executeTranslation(t,!1,50,!0)}),r.on("translateend",function(e){var t=e.features;0!==t.getLength()&&o.executeTranslation(t,!0,0,!1)});var n=new ge.Select({layers:[this.routeStore.layer.ol],condition:he.click,hitTolerance:7,filter:function(e){return"route"===e.getId()}});n.on("select",function(e){if(!1===o.focusOnStop){var t=Se.transform(e.mapBrowserEvent.coordinate,o.map.projection,o.projection);o.addStop();var r=o.stops.length-2;o.stops.at(r).patchValue({stopCoordinates:t}),o.handleLocationProposals(t,r),o.addStopOverlay(t,r),n.getFeatures().clear()}n.getFeatures().clear()}),this.map.ol.addInteraction(e),this.map.ol.addInteraction(r),this.map.ol.addInteraction(n)},xc.prototype.subscribeToFormChange=function(){var t=this;this.routesQueries$$.push(this.stopsForm.valueChanges.pipe(Pe.debounceTime(this.debounce)).subscribe(function(e){t.writeStopsToFormService()}))},xc.prototype.freezeStores=function(){var e=this.stopsStore,t=this.routeStore;this.map.removeLayer(e.layer),this.map.removeLayer(t.layer),e.deactivateStrategyOfType(ko),t.deactivateStrategyOfType(ko)},xc.prototype.executeTranslation=function(e,t,r,o){var n=this;void 0===t&&(t=!1),void 0===r&&(r=0),void 0===o&&(o=!1),this.routeStore.clear();var i,a=e.getArray()[0],s=a.getId().split("_");switch(s[1]){case"start":i=0;break;case"end":i=this.stops.length-1;break;default:i=Number(s[1])}var l=Se.transform(a.getGeometry().getCoordinates(),this.map.projection,this.projection);this.stops.at(i).patchValue({stopCoordinates:l,stopProposals:[]}),t&&this.handleLocationProposals(l,i);var u={steps:!0,overview:!1,alternatives:!0};o&&(u.overview=!0,u.steps=!1,u.alternatives=!1),0<r?("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),this.lastTimeoutRequest=setTimeout(function(){n.getRoutes(undefined,u)},r)):(clearTimeout(this.lastTimeoutRequest),this.getRoutes(undefined,u))},xc.prototype.handleLocationProposals=function(e,o){var n=this,i=[],a=[e[0].toFixed(5),e[1].toFixed(5)];this.stops.at(o).patchValue({stopPoint:a.join(",")}),this.searchService.reverseSearch(e,{zoom:this.map.viewController.getZoom()}).map(function(e){return n.routesQueries$$.push(e.request.pipe(Pe.map(function(e){return e})).subscribe(function(e){if(e.forEach(function(t){0===i.filter(function(e){return e.source===t.source}).length&&i.push({source:t.source,results:e.map(function(e){return e.data})})}),n.stops.at(o).patchValue({stopProposals:i}),e[0])if("icherchereverse"===e[0].source.getId()){for(var t=0,r=0;r<e.length;r++)if("adresses"===e[r].data.properties.type){t=r;break}n.stops.at(o).patchValue({stopPoint:Ce.getEntityTitle(e[t])}),"Point"===e[t].data.geometry.type&&n.stops.at(o).patchValue({stopCoordinates:e[t].data.geometry.coordinates})}else"coordinatesreverse"===e[0].source.getId()&&(n.stops.at(o).patchValue({stopPoint:[e[0].data.geometry.coordinates[0].toFixed(5),e[0].data.geometry.coordinates[1].toFixed(5)].join(",")}),"Point"===e[0].data.geometry.type&&n.stops.at(o).patchValue({stopCoordinates:e[0].data.geometry.coordinates}));else n.stops.at(o).patchValue({stopPoint:a.join(","),stopProposals:[]});n.changeDetectorRefs.detectChanges()}))})},xc.prototype.directionsText=function(e,t){return void 0===t&&(t=this.stops.length),0===e?"start":e===t-1||1===t?"end":"intermediate"},xc.prototype.raiseStop=function(e){0<e&&this.moveStop(e,-1)},xc.prototype.lowerStop=function(e){e<this.stops.length-1&&this.moveStop(e,1)},xc.prototype.moveStop=function(e,t){var r=this.stops.at(e);this.removeStop(e),this.stops.insert(e+t,r),this.stops.at(e).patchValue({directionsText:this.directionsText(e)}),this.stops.at(e+t).patchValue({directionsText:this.directionsText(e+t)}),this.stops.at(e).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e).value.stopCoordinates,e),this.stops.at(e+t).value.stopCoordinates&&this.addStopOverlay(this.stops.at(e+t).value.stopCoordinates,e+t)},Object.defineProperty(xc.prototype,"stops",{get:function(){return this.stopsForm.get("stops")},enumerable:!0,configurable:!0}),xc.prototype.writeStopsToFormService=function(){var t=[];this.stops.value.forEach(function(e){e.stopCoordinates instanceof Array&&t.push(e)}),this.directionsFormService.setStops(t)},xc.prototype.addStop=function(){var e=this.stops.length-1;this.stops.insert(e,this.createStop())},xc.prototype.createStop=function(e){return void 0===e&&(e="intermediate"),this.formBuilder.group({stopPoint:[""],stopProposals:[[]],directionsText:e,stopCoordinates:["",[ve.Validators.required]]})},xc.prototype.removeStop=function(e){var t=this,r=this.getStopOverlayID(e);this.deleteStoreFeatureByID(this.stopsStore,r),this.stops.removeAt(e);var o=0;this.stops.value.forEach(function(e){t.stops.at(o).patchValue({directionsText:t.directionsText(o)}),t.addStopOverlay(t.stops.at(o).value.stopCoordinates,o),o++})},xc.prototype.resetForm=function(){this.routesResults=undefined;for(var e=this.stops.length,t=0;t<e;t++)this.stops.removeAt(0);this.stops.insert(0,this.createStop("start")),this.stops.insert(1,this.createStop("end")),this.stopsStore.clear(),this.routeStore.clear()},xc.prototype.formatStep=function(e,t){return this.formatInstruction(e.maneuver.type,e.maneuver.modifier,e.name,e.maneuver.bearing_after,t,e.maneuver.exit,t===this.activeRoute.steps.length-1)},xc.prototype.formatInstruction=function(e,t,r,o,n,i,a){var s,l;void 0===a&&(a=!1);var u,c="forward",p="rotate-270",d=this.translateBearing(o),h=this.translateModifier(t),g=("straight"===t?"":"à ")+h,f=("straight"===t?"":"on the ")+h;if(t&&0<=t.search("slight")&&(f=h),"uturn"===t?(c="forward",p="rotate-90"):"sharp right"===t?(c="subdirectory-arrow-right",p="icon-flipped"):"right"===t?(c="subdirectory-arrow-right",p="icon-flipped"):"slight right"===t?(c="forward",p="rotate-290"):"straight"===t?c="forward":"slight left"===t?(c="forward",p="rotate-250"):"left"===t?(c="subdirectory-arrow-left",p="icon-flipped"):"sharp left"===t&&(c="subdirectory-arrow-left",p="icon-flipped"),"turn"===e)l="straight"===t?(s="Continuer sur "+r,"Continue on "+r):"uturn"===t?(s="Faire demi-tour sur "+r,"Make u-turn on "+r):(s="Tourner "+g+" sur "+r,"Turn "+h+" onto "+r);else if("new name"===e)s="Continuer en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="compass",p="";else if("depart"===e)s="Aller en direction "+d+" sur "+r,l="Head "+d+" on "+r,c="compass",p="";else if("arrive"===e)if(a){var m=", ";h||(m=f=g=""),s="Vous êtes arrivé"+m+g,l="You have reached your destination"+m+f}else s="Vous atteignez le point intermédiare sur "+r,l="You have reached the intermediate stop onto "+r,c="map-marker",p="";else"merge"===e?(s="Continuer sur "+r,l="Continue on "+r,c="forward",p="rotate-270"):"on ramp"===e?(s="Prendre l'entrée d'autoroute "+g,l="Take the ramp "+f):"off ramp"===e?(s="Prendre la sortie d'autoroute "+g,l="Take exit "+f):"fork"===e?l=0<=t.search("left")?(s="Garder la gauche sur "+r,"Merge left onto "+r):0<=t.search("right")?(s="Garder la droite sur "+r,"Merge right onto "+r):(s="Continuer sur "+r,"Continue on "+r):"end of road"===e?(s="À la fin de la route, tourner "+h+" sur "+r,l="At the end of the road, turn "+h+" onto "+r):"use lane"===e?(s="Prendre la voie de ... ",l="Take the lane ..."):"continue"===e&&"uturn"!==t?(s="Continuer sur "+r,l="Continue on "+r,c="forward",p="rotate-270"):"roundabout"===e?(s="Au rond-point, prendre la "+i,s+=1===i?"re":"e",s+=" sortie vers "+r,l="At the roundabout, take the "+i,l+=1===i?"st":"rd",l+=" exit towards "+r,c="chart-donut",p=""):"rotary"===e?(s="Rond-point rotary....",l="Roundabout rotary....",c="chart-donut",p=""):"roundabout turn"===e?(s="Rond-point, prendre la ...",l="Roundabout, take the ...",c="chart-donut",p=""):"exit roundabout"===e?(s="Poursuivre vers "+r,l="Continue to "+r,c="forward",p="rotate-270"):l="notification"===e?s="notification ....":"uturn"===t?(s="Faire demi-tour et continuer en direction "+d+" sur "+r,"Make u-turn and head "+d+" on "+r):s="???";return a&&(c="flag-variant",p=""),0===n&&(c="compass",p=""),"fr"===this.browserLanguage?u=s:"en"===this.browserLanguage&&(u=l),{instruction:u,image:c,cssClass:p}},xc.prototype.translateModifier=function(e){return"uturn"===e?this.languageService.translate.instant("igo.geo.directions.uturn"):"sharp right"===e?this.languageService.translate.instant("igo.geo.directions.sharp right"):"right"===e?this.languageService.translate.instant("igo.geo.directions.right"):"slight right"===e?this.languageService.translate.instant("igo.geo.directions.slight right"):"sharp left"===e?this.languageService.translate.instant("igo.geo.directions.sharp left"):"left"===e?this.languageService.translate.instant("igo.geo.directions.left"):"slight left"===e?this.languageService.translate.instant("igo.geo.directions.slight left"):"straight"===e?this.languageService.translate.instant("igo.geo.directions.straight"):e},xc.prototype.translateBearing=function(e){return 337<=e||e<23?this.languageService.translate.instant("igo.geo.cardinalPoints.n"):e<67?this.languageService.translate.instant("igo.geo.cardinalPoints.ne"):e<113?this.languageService.translate.instant("igo.geo.cardinalPoints.e"):e<157?this.languageService.translate.instant("igo.geo.cardinalPoints.se"):e<203?this.languageService.translate.instant("igo.geo.cardinalPoints.s"):e<247?this.languageService.translate.instant("igo.geo.cardinalPoints.sw"):e<293?this.languageService.translate.instant("igo.geo.cardinalPoints.w"):e<337?this.languageService.translate.instant("igo.geo.cardinalPoints.nw"):void 0},xc.prototype.formatDistance=function(e){if(0!==e)return 1e5<=e?Math.round(e/1e3)+" km":1e4<=e?Math.round(e/100)/10+" km":100<=e?Math.round(e/100)/10+" km":e+" m"},xc.prototype.formatDuration=function(e,t){if(void 0===t&&(t=!1),3600<=e){var r=Math.floor(e/3600),o=Math.round(60*(e/3600-r));return 60===o?r+1+" h":r+" h "+o+" min"}return 60<=e?Math.round(e/60)+" min":e+" s"},xc.prototype.showSegment=function(e,t){void 0===t&&(t=!1),this.showRouteSegmentGeometry(e.geometry.coordinates,t)},xc.prototype.showRouteSegmentGeometry=function(e,t){void 0===t&&(t=!1);var r="vertex",o=new Ie.LineString(e).transform("EPSG:4326",this.map.projection).getCoordinates()[0],n=new Ie.Point(o),i=new be({geometry:n}),a=(new Oe).writeGeometryObject(n,{featureProjection:this.map.projection,dataProjection:this.map.projection}),s=this.routeStore.get(r),l=s?s.meta.revision:0,u={type:ur,geometry:a,projection:this.map.projection,properties:{id:r,type:"vertex"},meta:{id:r,revision:l+1},ol:i};this.routeStore.update(u),t&&this.map.viewController.zoomToExtent(i.getGeometry().getExtent())},xc.prototype.zoomRoute=function(e){if(e)this.map.viewController.zoomToExtent(e);else{var t=this.routeStore.layer.ol.getSource().getFeatures().find(function(e){return"route"===e.getId()});if(t){var r=t.getGeometry().getExtent();this.map.viewController.zoomToExtent(r)}}},xc.prototype.showRouteGeometry=function(e){void 0===e&&(e=!1);var t=this.activeRoute.geometry.coordinates,r=new Ie.LineString(t).transform("EPSG:4326",this.map.projection);e&&this.zoomRoute(r.getExtent());var o=(new Oe).writeGeometryObject(r,{featureProjection:this.map.projection,dataProjection:this.map.projection}),n=this.routeStore.get("route"),i=n?n.meta.revision:0,a={type:ur,geometry:o,projection:this.map.projection,properties:{id:"route",type:"route"},meta:{id:"route",revision:i+1},ol:new be({geometry:r})};this.routeStore.update(a)},xc.prototype.getRoutes=function(t,e){var r=this;void 0===t&&(t=!1),void 0===e&&(e={}),this.deleteStoreFeatureByID(this.routeStore,"vertex"),this.writeStopsToFormService();var o=this.directionsFormService.getStopsCoordinates();if(!(o.length<2)){var n=this.directionsService.route(o,e);n&&n.map(function(e){return r.routesQueries$$.push(e.subscribe(function(e){r.routesResults=e,r.activeRoute=r.routesResults[0],r.showRouteGeometry(t),r.changeDetectorRefs.detectChanges()}))})}},xc.prototype.unlistenSingleClick=function(){0!==this.focusKey.length&&this.focusKey.forEach(function(e){fe.unByKey(e)})},xc.prototype.unsubscribeRoutesQueries=function(){this.routesQueries$$.forEach(function(e){return e.unsubscribe()}),this.routesQueries$$=[]},xc.prototype.copyLinkToClipboard=function(){if(ke.Clipboard.copy(this.getUrl())){var e=this.languageService.translate,t=e.instant("igo.geo.directionsForm.dialog.copyTitle"),r=e.instant("igo.geo.directionsForm.dialog.copyMsgLink");this.messageService.success(r,t)}},xc.prototype.copyDirectionsToClipboard=function(){var o=this,n=this.languageService.translate.instant("igo.geo.directionsForm.instructions")+":\n",i="",e=this.languageService.translate.instant("igo.geo.directionsForm.summary")+": \n\t"+this.activeRoute.title+"\n\t"+this.formatDistance(this.activeRoute.distance)+"\n\t"+this.formatDuration(this.activeRoute.duration)+"\n\n"+this.languageService.translate.instant("igo.geo.directionsForm.stopsList")+":\n",t=this.languageService.translate.instant("igo.geo.directionsForm.link")+":\n\t"+this.getUrl(),a=1;this.stops.value.forEach(function(e){var t="",r="";e.stopPoint!==e.stopCoordinates?(r=e.stopPoint,t=" ("+[e.stopCoordinates[1],e.stopCoordinates[0]].join(",")+")"):r=[e.stopCoordinates[1],e.stopCoordinates[0]].join(","),i=i+"\t"+a.toLocaleString()+". "+r+t+"\n",a++});var s=0;this.activeRoute.steps.forEach(function(e){var t=o.formatStep(e,s).instruction,r=o.formatDistance(e.distance)===undefined?"":" ("+o.formatDistance(e.distance)+")";n=n+"\t"+(s+1).toLocaleString()+". "+t+r+"\n",s++});var r=e+i+"\n"+t+"\n\n"+n;if(ke.Clipboard.copy(r)){var l=this.languageService.translate,u=l.instant("igo.geo.directionsForm.dialog.copyTitle"),c=l.instant("igo.geo.directionsForm.dialog.copyMsg");this.messageService.success(c,u)}},xc.prototype.handleTermChanged=function(e){var t=this;if(e!==undefined||0!==e.length){var r=[];this.search$$&&this.search$$.unsubscribe(),this.searchService.search(e,{searchType:"Feature"}).map(function(e){return t.search$$=e.request.subscribe(function(e){e.filter(function(e){return e.data.geometry}).forEach(function(t){0===r.filter(function(e){return e.source===t.source}).length&&r.push({source:t.source,meta:t.meta,results:e.map(function(e){return e.data})})}),t.stops.at(t.currentStopIndex).patchValue({stopProposals:r}),t.changeDetectorRefs.detectChanges()})})}},xc.prototype.setTerm=function(e){this.term=e,this.keyIsValid(e)&&(e.length>=this.length||0===e.length)&&this.stream$.next(e)},xc.prototype.keyIsValid=function(t){return this.invalidKeys.find(function(e){return e===t})===undefined},xc.prototype.keyup=function(t,e){var r=this,o=e.target.value;this.setTerm(o),this.map.ol.un("singleclick",function(e){r.handleMapClick(e,t)})},xc.prototype.clearStop=function(e){var t=this.getStopOverlayID(e);this.deleteStoreFeatureByID(this.stopsStore,t),this.routeStore.clear();var r=this.stops.length;this.stops.removeAt(e),this.stops.insert(e,this.createStop(this.directionsText(e,r))),this.routesResults=undefined,this.getRoutes()},xc.prototype.chooseProposal=function(e,t){if(e!==undefined){var r=void 0,o=e.geometry;"Point"===o.type?r=o.coordinates:0<=o.type.search("Line")?r=[(r=(new Oe).readFeatures(o)[0].getGeometry().getFirstCoordinate())[0],r[1]]:0<=o.type.search("Polygon")&&(r=[(r=(new Oe).readFeatures(o)[0].getGeometry().getInteriorPoints().getFirstCoordinate())[0],r[1]]),r!==undefined&&(this.stops.at(t).patchValue({stopCoordinates:r}),this.addStopOverlay(r,t))}},xc.prototype.focus=function(t){var r=this;this.unlistenSingleClick(),this.currentStopIndex=t,this.focusOnStop=!0,this.focusKey.push(this.map.ol.once("singleclick",function(e){r.handleMapClick(e,t)}))},xc.prototype.handleMapClick=function(e,t){var r=this;this.currentStopIndex===undefined?(this.addStop(),t=this.stops.length-2,this.stops.at(t).value.stopProposals=[]):t=this.currentStopIndex;var o=Se.transform(e.coordinate,this.map.projection,this.projection);this.stops.at(t).patchValue({stopProposals:[],stopCoordinates:o}),this.handleLocationProposals(o,t),this.addStopOverlay(o,t),setTimeout(function(){r.focusOnStop=!1},500)},xc.prototype.geolocateStop=function(e){Xo(this.map,[this.map.geolocationFeature],cr.Move);var t=this.map.viewController.getCenter(this.projection);this.stops.at(e).patchValue({stopCoordinates:t}),this.addStopOverlay(t,e),this.handleLocationProposals(t,e)},xc.prototype.addStopOverlay=function(e,t){var r,o,n=this.directionsText(t);o="start"===n?(r="green",this.languageService.translate.instant("igo.geo.directionsForm.start")):"end"===n?(r="red",this.languageService.translate.instant("igo.geo.directionsForm.end")):(r="yellow",this.languageService.translate.instant("igo.geo.directionsForm.intermediate")+" #"+t);var i=new Ie.Point(Se.transform(e,this.projection,this.map.projection)),a=this.getStopOverlayID(t),s=(new Oe).writeGeometryObject(i,{featureProjection:this.map.projection,dataProjection:this.map.projection}),l=this.stopsStore.get(a),u=l?l.meta.revision:0,c={type:ur,geometry:s,projection:this.map.projection,properties:{id:a,type:"stop",stopText:o,stopColor:r,stopOpacity:1},meta:{id:a,revision:u+1},ol:new be({geometry:i})};this.stopsStore.update(c),this.getRoutes()},xc.prototype.getStopOverlayID=function(e){return"directionsStop_"+(0===e?"start":e===this.stops.length-1?"end":e)},xc.prototype.deleteStoreFeatureByID=function(e,t){var r=e.get(t);r&&e["delete"](r)},xc.prototype.getUrl=function(){if(this.route){var e=this.route.options.directionsCoordKey,t=[];this.directionsFormService&&this.directionsFormService.getStopsCoordinates()&&0!==this.directionsFormService.getStopsCoordinates().length&&this.directionsFormService.getStopsCoordinates().forEach(function(e){t.push(br(e,6))});var r="";return 2<=t.length&&(r=e+"="+t.join(";")),""+location.origin+location.pathname+"?tool=directions&"+r}},xc.decorators=[{type:je.Component,args:[{selector:"igo-directions-form",template:'<form class="igo-form" [formGroup]="stopsForm">\r\n  \x3c!-- <div class="igo-form-button-group">\r\n\r\n  </div> --\x3e\r\n  <div #inputs formArrayName="stops" *ngFor="let stop of stops.controls; let i = index;">\r\n    <mat-list-item [formGroupName]="i">\r\n\r\n      <div class="igo-input-container">\r\n        <button *ngIf="map.geolocationFeature" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.geolocate\' | translate" (click)="geolocateStop(i)">\r\n          <mat-icon svgIcon="crosshairs-gps"></mat-icon>\r\n        </button>\r\n        <mat-form-field>\r\n          <input matInput formControlName="stopPoint" [matAutocomplete]="auto"\r\n            placeholder="{{\'igo.geo.directionsForm.\'+stop.value.directionsText | translate}}" (focus)="focus(i)"\r\n            (keyup)="keyup(i,$event)" (keydown.enter)="prevent($event)">\r\n            <button \r\n              mat-button \r\n              *ngIf="stop.value && (stop.value.stopPoint.length > 0 || stop.value.stopProposals.length > 0)"\r\n              matSuffix mat-icon-button color="warn" aria-label="Clear" (click)="clearStop(i)">\r\n              <mat-icon svgIcon="close"></mat-icon>\r\n            </button>\r\n\r\n          <mat-autocomplete #auto="matAutocomplete">\r\n            <mat-optgroup *ngFor="let source of stop.value.stopProposals" [label]="source.source.title" [disabled]="source.source.enabled === false">\r\n              <mat-option *ngFor="let result of source.results" [value]="result.meta ? result.meta.title : \'\'" \r\n              (onSelectionChange)="chooseProposal(result,i)"\r\n              matTooltipShowDelay="500" [matTooltip]="result.meta ? result.meta.title : \'\'">\r\n                {{ result.meta ? result.meta.title : \'\' }}\r\n              </mat-option>\r\n            </mat-optgroup>\r\n          </mat-autocomplete>\r\n        </mat-form-field>\r\n\r\n        \x3c!-- <div class="igo-form-button-group"> --\x3e\r\n\r\n\r\n          \x3c!-- <button *ngIf="i !== 0" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.raiseStop\' | translate"\r\n            [color]="color" (click)="raiseStop(i)">\r\n            <mat-icon svgIcon="arrow-upward"></mat-icon>\r\n          </button>\r\n          <button *ngIf="i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.lowerStop\' | translate"\r\n            [color]="color" (click)="lowerStop(i)">\r\n            <mat-icon svgIcon="arrow-downward"></mat-icon>\r\n          </button> --\x3e\r\n\r\n          <button *ngIf="i !== 0 && i !== stops.length - 1" mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="\'igo.geo.directionsForm.removeStop\' | translate"\r\n            color="warn" (click)="removeStop(i)">\r\n            <mat-icon svgIcon="delete"></mat-icon>\r\n          </button>\r\n        \x3c!-- </div> --\x3e\r\n      </div>\r\n\r\n    </mat-list-item>\r\n  </div>\r\n  <div class="igo-form-button-group">\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.addStop\' | translate" color="primary" (click)="addStop()">\r\n      <mat-icon svgIcon="map-marker-plus"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.zoomRoute\' | translate" *ngIf="routesResults" color="primary"\r\n      (click)="zoomRoute()">\r\n      <mat-icon svgIcon="magnify-plus-outline"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.resetDirectionsBtn\' | translate" *ngIf="routesResults" color="warn"\r\n      (click)="resetForm()">\r\n      <mat-icon svgIcon="file-restore"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.copy\' | translate" color="primary" (click)="copyDirectionsToClipboard()">\r\n      <mat-icon svgIcon="content-copy"></mat-icon>\r\n    </button>\r\n    <button mat-icon-button *ngIf="routesResults" tooltip-position="below" matTooltipShowDelay="500"\r\n      [matTooltip]="\'igo.geo.directionsForm.link\' | translate" color="primary" (click)="copyLinkToClipboard()">\r\n      <mat-icon svgIcon="link"></mat-icon>\r\n    </button>\r\n  </div>\r\n\r\n</form>\r\n\r\n<div class="igo-input-container" *ngIf="routesResults">\r\n  <mat-form-field *ngIf="routesResults && routesResults.length > 1">\r\n    <mat-select placeholder="{{\'igo.geo.directionsForm.drivingOptions\' | translate}}" (selectionChange)="changeRoute()" [(ngModel)]="activeRoute">\r\n      <mat-option *ngFor="let pathDirections of routesResults; let cnt = index;" [value]="pathDirections">\r\n        Option {{cnt + 1}} : {{formatDistance(pathDirections.distance)}} ({{formatDuration(pathDirections.duration)}})\r\n      </mat-option>\r\n    </mat-select>\r\n  </mat-form-field>\r\n\r\n  <mat-divider *ngIf="routesResults && routesResults.length === 0"></mat-divider>\r\n\r\n  <mat-list>\r\n    <h2 mat-header class="igo-route-title mat-typography">{{activeRoute.title}}</h2>\r\n    <h2 mat-subheader>{{formatDistance(activeRoute.distance)}}, {{formatDuration(activeRoute.duration)}}</h2>\r\n\r\n    <mat-list-item \r\n    class="igo-steps"\r\n    (mouseenter)="showSegment(step)" \r\n    (click)="showSegment(step,true)" \r\n    *ngFor="let step of activeRoute.steps; let cnt = index;"\r\n      igoListItem>\r\n      <mat-icon [ngClass]="formatStep(step,cnt).cssClass" mat-list-icon svgIcon="{{formatStep(step,cnt).image}}"></mat-icon>\r\n\r\n      <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\r\n      <h4 mat-line class="right">{{formatDistance(step.distance)}}</h4>\r\n    </mat-list-item>\r\n\r\n    <mat-divider></mat-divider>\r\n\r\n  </mat-list>\r\n\r\n</div>\r\n',styles:["mat-form-field{width:85%}.igo-route-title{font-weight:700}.igo-steps{cursor:pointer}form{padding:10px}h3{padding-left:5px;padding-right:5px}.mat-line{word-wrap:break-word!important;white-space:pre-wrap!important}.mat-line.right{text-align:right}.rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.rotate-45{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.rotate-250{-webkit-transform:rotate(250deg);transform:rotate(250deg)}.rotate-290{-webkit-transform:rotate(290deg);transform:rotate(290deg)}.icon-flipped{-webkit-transform:scaleY(-1);transform:scaleY(-1)}"]}]}],xc.ctorParameters=function(){return[{type:ve.FormBuilder},{type:Sc},{type:Ae.LanguageService},{type:Ae.MessageService},{type:gc},{type:bi},{type:Ic},{type:je.ChangeDetectorRef},{type:Ae.RouteService,decorators:[{type:je.Optional}]}]},xc.propDecorators={term:[{type:je.Input}],debounce:[{type:je.Input}],length:[{type:je.Input}],map:[{type:je.Input}],stopsStore:[{type:je.Input}],routeStore:[{type:je.Input}],submit:[{type:je.Output}]},xc);function xc(e,t,r,o,n,i,a,s,l){this.formBuilder=e,this.directionsService=t,this.languageService=r,this.messageService=o,this.searchService=n,this.queryService=i,this.directionsFormService=a,this.changeDetectorRefs=s,this.route=l,this.invalidKeys=["Control","Shift","Alt"],this.projection="EPSG:4326",this.routesQueries$$=[],this.stream$=new Le.Subject,this.focusOnStop=!1,this.focusKey=[],this.debounce=200,this.length=2,this.submit=new je.EventEmitter}function Cc(e,t){var r=[new we.Style({geometry:e.getGeometry(),image:new we.Circle({radius:7,stroke:new we.Stroke({color:"#FF0000",width:3})})})],o=new we.Style({image:new we.Icon({src:"./assets/igo2/geo/icons/place_"+e.get("stopColor")+"_36px.svg",opacity:e.get("stopOpacity"),imgSize:[36,36],anchor:[.5,.92]}),text:new we.Text({text:e.get("stopText"),font:"12px Calibri,sans-serif",fill:new we.Fill({color:"#000"}),stroke:new we.Stroke({color:"#fff",width:3}),overflow:!0})}),n=[new we.Style({stroke:new we.Stroke({color:"#6a7982",width:10,opacity:.75})}),new we.Style({stroke:new we.Stroke({color:"#4fa9dd",width:6,opacity:.75})})];return"stop"===e.get("type")?o:"vertex"===e.get("type")?r:"route"===e.get("type")?n:void 0}var Tc=(Lc.prototype.ngAfterViewInit=function(){var n=this,e=this.directionsFormService.getStops();if(!e&&this.route&&this.route.options.directionsCoordKey)this.route.queryParams.subscribe(function(e){var t=e[n.route.options.directionsCoordKey];if(t){var r=t.split(";");if(2<=r.length){var o=0;r.forEach(function(e){0!==o&&o!==r.length-1&&n.component.stops.insert(o,n.component.createStop());var t=JSON.parse("["+e+"]");n.component.stops.at(o).patchValue({stopCoordinates:t}),n.component.stops.at(o).patchValue({stopPoint:t}),n.component.handleLocationProposals(t,o),n.component.addStopOverlay(t,o),o++}),n.component.getRoutes(!0)}}});else if(e){for(var t=0;t<e.length;t++)0!==t&&t!==e.length-1&&this.component.stops.insert(t,this.component.createStop()),e[t].stopCoordinates instanceof Array&&(this.component.addStopOverlay(e[t].stopCoordinates,t),this.component.stops.at(t).patchValue(e[t]));this.component.getRoutes()}this.component.writeStopsToFormService()},Lc.decorators=[{type:je.Directive,args:[{selector:"[igoDirectionsFormBinding]"}]}],Lc.ctorParameters=function(){return[{type:Fc,decorators:[{type:je.Self}]},{type:Ic},{type:Ae.RouteService,decorators:[{type:je.Optional}]}]},Lc);function Lc(e,t,r){this.component=e,this.directionsFormService=t,this.route=r}var Mc=(Pc.forRoot=function(){return{ngModule:Pc}},Pc.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,ve.FormsModule,ve.ReactiveFormsModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatListModule,Fe.MatDividerModule,Fe.MatFormFieldModule,Fe.MatInputModule,Fe.MatOptionModule,Fe.MatSelectModule,Fe.MatTooltipModule,Fe.MatAutocompleteModule,Ae.IgoLanguageModule],exports:[Fc,Tc],declarations:[Fc,Tc],providers:[Ic,bc()]}]}],Pc);function Pc(){}function kc(e){return new uc(e)}function Dc(){return{provide:uc,useFactory:kc,deps:[Oi]}}var jc=(Ec.prototype.formatResult=function(e){return e},Ec.decorators=[{type:je.Injectable}],Ec.ctorParameters=function(){return[{type:Ae.LanguageService}]},Ec);function Ec(e){this.languageService=e}var $c,Rc=(Ke(Ac,$c=Oi),Object.defineProperty(Ac.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),Ac.prototype.getId=function(){return Ac.id},Ac.prototype.getType=function(){return Ac.type},Ac.prototype.getDefaultOptions=function(){var e=this.options.params&&this.options.params.limit?Number(this.options.params.limit):undefined,t=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):undefined,r=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","municipalites","mrc","regadmin","lieux"];return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==r.indexOf("adresses"),hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:-1!==r.indexOf("anciennes-adresses"),hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:-1!==r.indexOf("codes-postaux"),hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==r.indexOf("routes"),hashtags:["route"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==r.indexOf("municipalites"),hashtags:["municipalité","mun"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:-1!==r.indexOf("anciennes-municipalites"),hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==r.indexOf("mrc"),hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==r.indexOf("regadmin"),hashtags:["région-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:-1!==r.indexOf("entreprises"),available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:-1!==r.indexOf("lieux"),hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:-1!==r.indexOf("bornes-sumi"),hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:!1,hashtags:["borne","bornes","repère","km"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===e},{title:"5",value:5,enabled:5===e||!e},{title:"10",value:10,enabled:10===e},{title:"25",value:25,enabled:25===e},{title:"50",value:50,enabled:50===e}]},{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:10===t},{title:"30 %",value:30,enabled:30===t||!t},{title:"50 %",value:50,enabled:50===t},{title:"75 %",value:75,enabled:75===t},{title:"100 %",value:100,enabled:100===t}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}]}},Ac.prototype.search=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return o.get("type").length?(this.options.params.page=o.get("page")||"1",this.http.get(this.searchUrl+"/geocode",{params:o}).pipe(Pe.map(function(e){return r.extractResults(e)}),Pe.catchError(function(e){throw e.error.toDisplay=!0,e.error.title=r.languageService.translate.instant(r.getDefaultOptions().title),e}))):Le.of([])},Ac.prototype.getAllowedTypes=function(){var n=this;return this.http.get(this.searchUrl+"/types").subscribe(function(o){n.settings.find(function(e){return"type"===e.name}).values.forEach(function(e){var t=new RegExp("^"+e.value+"(\\.|$)"),r=o.filter(function(e){return t.test(e)});e.available=0<r.length,"lieux"===e.value&&(n.hashtagsLieuxToKeep=Xe(new Set(r.map(function(e){return e.split(".")}).reduce(function(e,t){return e.concat(t)}).filter(function(e){return"lieux"!==e}))))})})},Ac.prototype.computeRequestParams=function(e,t){var r=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(e,t||{}).params,{q:this.computeTerm(e),page:t.page});if("true"===r.loc){var o=Je(t.extent,4),n=o[0],i=o[1],a=o[2],s=o[3];r.loc=n+","+i+";"+a+","+i+";"+a+","+s+";"+n+","+s+";"+n+","+i}else"false"===r.loc&&delete r.loc;return-1!==r.q.indexOf("#")&&(r.type="lieux"),new Me.HttpParams({fromObject:ke.ObjectUtils.removeUndefined(r)})},Ac.prototype.extractResults=function(t){var r=this;return t.features.map(function(e){return r.formatter.formatResult(r.dataToResult(e,t))})},Ac.prototype.dataToResult=function(e,t){var r=this.computeProperties(e),o=[this.getId(),r.type,r.code].join("."),n=e.highlight.title||e.properties.nom,i=e.highlight.title2?" <small> "+e.highlight.title2+"</small>":"",a=e.highlight.title3?"<br><small> "+e.highlight.title3+"</small>":"";return{source:this,data:{type:ur,projection:"EPSG:4326",geometry:e.geometry,extent:e.bbox,properties:r,meta:{id:o,title:e.properties.nom}},meta:{dataType:ur,id:o,title:e.properties.nom,titleHtml:n+i+a,icon:e.icon||"map-marker",nextPage:t.features.length%+this.options.params.limit==0&&+this.options.params.page<10}}},Ac.prototype.computeProperties=function(e){var t=ke.ObjectUtils.removeKeys(e.properties,Ac.propertiesBlacklist);if(e.geometry===undefined)return Object.assign({type:e.index},t);var r,o,n={GoogleMaps:""};if("Point"===e.geometry.type)r=Li.getGoogleMapsCoordLink(e.geometry.coordinates[0],e.geometry.coordinates[1]);else{var i=ye(e.geometry);r=Li.getGoogleMapsCoordLink(i.geometry.coordinates[0],i.geometry.coordinates[1])}return o="routes"===e.index?Li.getGoogleMapsNameLink(e.properties.nom+", "+e.properties.municipalite):"municipalites"===e.index?Li.getGoogleMapsNameLink(e.properties.nom+", "+e.properties.regAdmin):Li.getGoogleMapsNameLink(e.properties.nom||e.highlight.title),n.GoogleMaps="<a href="+r+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+o+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>","Point"===e.geometry.type&&(n.GoogleStreetView=Li.getGoogleStreetViewLink(e.geometry.coordinates[0],e.geometry.coordinates[1])),Object.assign({type:e.index},t,n)},Ac.prototype.computeTerm=function(e){var r=this;return(e.match(/(#[^\s]+)/g)||[]).some(function(e){var t=e.substring(1);return r.hashtagsLieuxToKeep.some(function(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})})||(e=e.replace(/(#[^\s]*)/g,"")),e.replace(/[^\wÀ-ÿ !\-\(\),'#]+/g,"")},Ac.prototype.computeOptionsParam=function(e,t){var r=$c.prototype.getHashtagsValid.call(this,e,"type");return r&&(t.params=Object.assign(t.params||{},{type:r.join(",")})),t},Ac.id="icherche",Ac.type=ur,Ac.propertiesBlacklist=[],Ac.decorators=[{type:je.Injectable}],Ac.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.LanguageService},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]},{type:jc,decorators:[{type:je.Inject,args:[jc]}]},{type:je.Injector}]},Ac);function Ac(e,t,r,o,n){var i=$c.call(this,r)||this;i.http=e,i.languageService=t,i.formatter=o,i.title$=new Le.BehaviorSubject(""),i.hashtagsLieuxToKeep=[],i.languageService.translate.get(i.options.title).subscribe(function(e){return i.title$.next(e)});var a=n.get(me.AuthService);return i.settings.length&&(a?a.authenticate$.subscribe(function(){i.getAllowedTypes()}):i.getAllowedTypes()),i}var Bc,Gc=(Ke(_c,Bc=Oi),Object.defineProperty(_c.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),_c.prototype.getId=function(){return _c.id},_c.prototype.getType=function(){return _c.type},_c.prototype.getDefaultOptions=function(){var e=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:-1!==e.indexOf("adresses")},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:-1!==e.indexOf("routes"),available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:-1!==e.indexOf("arrondissements")},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:-1!==e.indexOf("municipalites")},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:-1!==e.indexOf("mrc")},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:-1!==e.indexOf("regadmin")}]},{type:"radiobutton",title:"radius",name:"buffer",values:[{title:"100 m",value:100,enabled:!this.options.distance||100===this.options.distance},{title:"500 m",value:500,enabled:500===this.options.distance},{title:"1 km",value:1e3,enabled:1e3===this.options.distance},{title:"2 km",value:2e3,enabled:2e3===this.options.distance},{title:"5 km",value:5e3,enabled:5e3===this.options.distance}]}]}},_c.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return o.get("type").length?this.http.get(this.searchUrl+"/locate",{params:o}).pipe(Pe.map(function(e){return r.extractResults(e)})):Le.of([])},_c.prototype.getAllowedTypes=function(){var e=this;return this.http.get(this.searchUrl+"/types").subscribe(function(t){e.settings.find(function(e){return"type"===e.name}).values.forEach(function(e){e.available=-1<t.indexOf(e.value)})})},_c.prototype.computeRequestParams=function(e,t){return(t.distance||this.options.distance)&&(t.params=Object.assign(t.params||{},{buffer:t.distance||this.options.distance})),new Me.HttpParams({fromObject:Object.assign({loc:e.join(","),sort:"distance",geometry:!0,icon:!0},t.params||{},this.params)})},_c.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},_c.prototype.getSubtitle=function(t){if(!this.settings.length)return"";var e="";switch(t.properties.type){case"arrondissements":e=t.properties.municipalite+" (Arrondissement)";break;default:var r=this.settings.find(function(e){return"type"===e.name}).values.find(function(e){return e.value===t.properties.type});r&&(e=this.languageService.translate.instant(r.title))}return e},_c.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeExtent(e),o=[this.getId(),t.type,t.code].join("."),n=e.properties.nom,i=" <small> "+this.getSubtitle(e)+"</small>";return{source:this,data:{type:ur,projection:"EPSG:4326",geometry:e.geometry,extent:r,properties:t,meta:{id:o,title:e.properties.nom}},meta:{dataType:ur,id:o,title:e.properties.nom,titleHtml:n+i,icon:e.icon||"map-marker"}}},_c.prototype.computeProperties=function(e){return ke.ObjectUtils.removeKeys(e.properties,_c.propertiesBlacklist)},_c.prototype.computeExtent=function(e){return e.bbox?[e.bbox[0],e.bbox[2],e.bbox[1],e.bbox[3]]:undefined},_c.id="icherchereverse",_c.type=ur,_c.propertiesBlacklist=[],_c.decorators=[{type:je.Injectable}],_c.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.LanguageService},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]},{type:je.Injector}]},_c);function _c(e,t,r,o){var n=Bc.call(this,r)||this;n.http=e,n.languageService=t,n.title$=new Le.BehaviorSubject(""),n.languageService.translate.get(n.options.title).subscribe(function(e){return n.title$.next(e)});var i=o.get(me.AuthService);return n.settings.length&&(i?i.authenticate$.subscribe(function(){n.getAllowedTypes()}):n.getAllowedTypes()),n}function qc(e){return new jc(e)}function Nc(){return{provide:jc,useFactory:qc,deps:[Ae.LanguageService]}}function Vc(e,t,r,o,n){return new Rc(e,t,r.getConfig("searchSources."+Rc.id),o,n)}function Uc(e,t,r,o){return new Gc(e,t,r.getConfig("searchSources."+Gc.id),o)}var Wc=(zc.prototype.formatResult=function(e){return e},zc.decorators=[{type:je.Injectable}],zc.ctorParameters=function(){return[{type:Ae.LanguageService}]},zc);function zc(e){this.languageService=e}var Kc,Hc=(Ke(Yc,Kc=Oi),Object.defineProperty(Yc.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),Yc.prototype.getId=function(){return Yc.id},Yc.prototype.getType=function(){return Yc.type},Yc.prototype.getDefaultOptions=function(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}},Yc.prototype.reverseSearch=function(e,t){return Le.of([this.dataToResult(e)])},Yc.prototype.dataToResult=function(e){var t=Sr(e,this.projections).reduce(function(e,t){return e[t.alias]=t.igo2CoordFormat,e},{}),r=br(e,6).join(", "),o={};return o[this.languageService.translate.instant("igo.geo.search.coordinates.coord")]=r,{source:this,data:{type:ur,projection:"EPSG:4326",geometry:{type:"Point",coordinates:[e[0],e[1]]},extent:undefined,properties:Object.assign({},o,t,{GoogleMaps:Li.getGoogleMapsCoordLink(e[0],e[1]),GoogleStreetView:Li.getGoogleStreetViewLink(e[0],e[1]),OpenStreetMap:Pi.getOpenStreetMapLink(e[0],e[1],14)}),meta:{id:e[0].toString()+","+e[1].toString(),title:r}},meta:{dataType:ur,id:e[0].toString()+","+e[1].toString(),title:r,icon:"map-marker"}}},Yc.id="coordinatesreverse",Yc.type=ur,Yc.decorators=[{type:je.Injectable}],Yc.ctorParameters=function(){return[{type:undefined,decorators:[{type:je.Inject,args:["options"]}]},{type:Ae.LanguageService},{type:Array,decorators:[{type:je.Inject,args:["projections"]}]}]},Yc);function Yc(e,t,r){var o=Kc.call(this,e)||this;return o.languageService=t,o.title$=new Le.BehaviorSubject(""),o.projections=r,o.languageService.translate.get(o.options.title).subscribe(function(e){return o.title$.next(e)}),o}function Zc(e){return new Wc(e)}function Qc(){return{provide:Wc,useFactory:Zc,deps:[Ae.LanguageService]}}function Jc(e,t,r){return new Hc(e.getConfig("searchSources."+Hc.id),t,e.getConfig("projections")||[])}var Xc=(ep.prototype.formatResult=function(e){var s=this,r=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],t=Object.entries(e.properties).filter(function(e){var t=Je(e,1)[0];return-1!==r.indexOf(t)}).reduce(function(e,t){var r,o=Je(t,2),n=o[0],i=o[1];try{r=s.languageService.translate.instant("igo.geo.search.ilayer.properties."+n)}catch(a){r=n}return e[r]=i||"",e},{}),o=Object.assign({},e);return o.properties=t,o},ep.decorators=[{type:je.Injectable}],ep.ctorParameters=function(){return[{type:Ae.LanguageService}]},ep);function ep(e){this.languageService=e}var tp,rp=(Ke(op,tp=Oi),Object.defineProperty(op.prototype,"title",{get:function(){return this.title$.getValue()},enumerable:!0,configurable:!0}),op.prototype.getId=function(){return op.id},op.prototype.getType=function(){return op.type},op.prototype.getDefaultOptions=function(){var e=this.options.params&&this.options.params.limit?Number(this.options.params.limit):undefined;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:1===e},{title:"5",value:5,enabled:5===e||!e},{title:"10",value:10,enabled:10===e},{title:"25",value:25,enabled:25===e},{title:"50",value:50,enabled:50===e}]}]}},op.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return o.get("q")&&o.get("type")?(this.options.params.page=o.get("page")||"1",this.http.get(this.searchUrl,{params:o}).pipe(Pe.map(function(e){return r.extractResults(e)}))):Le.of([])},op.prototype.computeSearchRequestParams=function(e,t){return new Me.HttpParams({fromObject:ke.ObjectUtils.removeUndefined(Object.assign({q:this.computeTerm(e)},this.params,this.computeOptionsParam(e,t||{}).params,{page:t.page}))})},op.prototype.computeTerm=function(e){return e.replace(/(#[^\s]*)/g,"").replace(/[^\wÀ-ÿ !\-\(\),'#]+/g,"")},op.prototype.computeOptionsParam=function(e,t){var r=tp.prototype.getHashtagsValid.call(this,e,"type");return r&&(t.params=Object.assign(t.params||{},{type:r.join(",")})),t},op.prototype.extractResults=function(t){var r=this;return t.items.map(function(e){return r.dataToResult(e,t)})},op.prototype.dataToResult=function(e,t){var r=this.computeLayerOptions(e),o=e.highlight.title||e.properties.title,n=e.highlight.groupTitle||e.properties.groupTitle,i=n?' <small style="color: #6f6969"> '+n+"</small>":"";return{source:this,meta:{dataType:pr,id:[this.getId(),e.properties.id].join("."),title:e.properties.title,titleHtml:o+i,icon:"Layer"===e.properties.type?"layers":"map",nextPage:t.items.length%+this.options.params.limit==0&&+this.options.params.page<10},data:r}},op.prototype.computeLayerOptions=function(e){var t=e.properties.url,r=this.extractQueryParamsFromSourceUrl(t);return ke.ObjectUtils.removeUndefined({sourceOptions:{id:e.properties.id,type:e.properties.format,url:t,queryFormat:r.queryFormat,queryHtmlTarget:r.queryHtmlTarget,params:{LAYERS:e.properties.name},optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:e.properties.title,maxResolution:mr(Number(e.properties.maxScaleDenom)),minResolution:mr(Number(e.properties.minScaleDenom)),metadata:{url:e.properties.metadataUrl,extern:!0},properties:this.formatter.formatResult(e).properties})},op.prototype.extractQueryParamsFromSourceUrl=function(o){var e,t,n,r,i=this.options.queryFormat;if(i){var a=function(t){var e=i[t];if("*"===e)return n=Rt[t.toUpperCase()],"break";var r=e.urls;return Array.isArray(r)?(r.forEach(function(e){-1!==o.indexOf(e)&&(n=Rt[t.toUpperCase()])}),"break"):void 0};try{for(var s=Qe(Object.keys(i)),l=s.next();!l.done&&"break"!==a(l.value);l=s.next());}catch(u){e={error:u}}finally{try{l&&!l.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}n!==Rt.HTML&&n!==Rt.HTMLGML2||(r="iframe")}return{queryFormat:n,queryHtmlTarget:r}},op.id="ilayer",op.type=pr,op.decorators=[{type:je.Injectable}],op.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.LanguageService},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]},{type:Xc,decorators:[{type:je.Inject,args:[Xc]}]}]},op);function op(e,t,r,o){var n=tp.call(this,r)||this;return n.http=e,n.languageService=t,n.formatter=o,n.title$=new Le.BehaviorSubject(""),n.languageService.translate.get(n.options.title).subscribe(function(e){return n.title$.next(e)}),n}function np(e){return new Xc(e)}function ip(){return{provide:Xc,useFactory:np,deps:[Ae.LanguageService]}}function ap(e,t,r,o){return new rp(e,t,r.getConfig("searchSources."+rp.id),o)}var sp=[ur,pr],lp=(Object.defineProperty(up.prototype,"searchType",{get:function(){return this.searchType$.value},set:function(e){this.setSearchType(e)},enumerable:!0,configurable:!0}),up.prototype.ngOnInit=function(){var t=this;this.searchType$$=this.searchType$.pipe(Pe.distinctUntilChanged()).subscribe(function(e){return t.onSetSearchType(e)})},up.prototype.ngOnDestroy=function(){this.searchType$$.unsubscribe()},up.prototype.onSearchTypeChange=function(e){this.setSearchType(e)},up.prototype.getSearchTypeTitle=function(e){return"igo.geo.search."+e.toLowerCase()+".title"},up.prototype.setSearchType=function(e){this.searchType$.next(e)},up.prototype.onSetSearchType=function(e){e!==undefined&&null!==e&&(this.searchSourceService.enableSourcesByType(e),this.searchTypeChange.emit(e))},up.decorators=[{type:je.Component,args:[{selector:"igo-search-selector",template:'<div class="igo-search-selector">\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-selector-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSelectorMenu">\r\n    <mat-icon svgIcon="menu-down"></mat-icon>\r\n  </button>\r\n\r\n  <mat-menu\r\n    #searchSelectorMenu="matMenu"\r\n    class="no-border-radius"\r\n    xPosition="before"\r\n    yPosition="above">\r\n    <mat-radio-group\r\n      class="igo-search-selector-radio-group"\r\n      [value]="searchType$ | async"\r\n      (change)="onSearchTypeChange($event.value)">\r\n      <mat-radio-button *ngFor="let searchType of searchTypes" [value]="searchType">\r\n        {{getSearchTypeTitle(searchType) | translate}}\r\n      </mat-radio-button>\r\n    </mat-radio-group>\r\n  </mat-menu>\r\n\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".igo-search-selector-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-selector-radio-group{display:-webkit-inline-box;display:inline-flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.igo-search-selector-radio-group mat-radio-button{margin:5px}"]}]}],up.ctorParameters=function(){return[{type:uc}]},up.propDecorators={searchTypes:[{type:je.Input}],searchType:[{type:je.Input}],searchTypeChange:[{type:je.Output}]},up);function up(e){this.searchSourceService=e,this.searchType$=new Le.BehaviorSubject(undefined),this.searchTypes=sp,this.searchTypeChange=new je.EventEmitter}var cp=(pp.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatMenuModule,Fe.MatRadioModule,Fe.MatTabsModule,Fe.MatCheckboxModule,Ae.IgoLanguageModule],exports:[lp],declarations:[lp]}]}],pp);function pp(){}var dp=(Object.defineProperty(hp.prototype,"isTouchScreen",{get:function(){return this.mediaService.isTouchScreen()},enumerable:!0,configurable:!0}),hp.prototype.handleKeyboardEvent=function(e){113===e.keyCode&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))},hp.prototype.ngOnInit=function(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()},hp.prototype.getSearchSources=function(){var e=this.searchSourceService.getSources().filter(pc).filter(function(e){return e.available&&"map"!==e.getId()&&e.showInSettings}),t=this.searchSourceService.getSources().filter(dc).filter(function(e){return e.available&&"map"!==e.getId()&&e.showInSettings}),r=e.concat(t);return this.computeSourcesCheckAllBehavior(r),r},hp.prototype.hasReverseSearchSourcesForPointerSummary=function(){return!!this.searchSourceService.getEnabledSources().filter(hc).length},hp.prototype.settingsValueCheckedCheckbox=function(e,t,r,o){o.enabled=e.checked,t.setParamFromSetting(r),this.searchSourceChange.emit(t)},hp.prototype.computeSettingCheckAllBehavior=function(e){e.allEnabled===undefined?e.values.find(function(e){return e.enabled})?e.allEnabled=!1:e.allEnabled=!0:e.allEnabled=!e.allEnabled},hp.prototype.computeSourcesCheckAllBehavior=function(e){var t=e.filter(function(e){return e.enabled}).length,r=e.filter(function(e){return!e.enabled}).length;this.searchSourcesAllEnabled=!(r<=t)},hp.prototype.checkUncheckAll=function(e,t,r){e.stopPropagation(),this.computeSettingCheckAllBehavior(r),r.values.forEach(function(e){e.enabled=r.allEnabled}),t.setParamFromSetting(r),this.searchSourceChange.emit(t)},hp.prototype.checkUncheckAllSources=function(e){var t=this;e.stopPropagation(),this.getSearchSources().map(function(e){e.enabled=t.searchSourcesAllEnabled,t.searchSourceChange.emit(e)})},hp.prototype.settingsValueCheckedRadioButton=function(t,e,r,o){r.values.forEach(function(e){e.value!==o.value?e.enabled=!t.source.checked:e.enabled=t.source.checked}),e.setParamFromSetting(r),this.searchSourceChange.emit(e)},hp.prototype.onCheckSearchSource=function(e,t){t.enabled=e.checked,this.searchSourceChange.emit(t)},hp.prototype.getAvailableValues=function(e){return e.values.filter(function(e){return!1!==e.available})},hp.prototype.getAvailableHashtagsValues=function(e){var t,r;if(e.hashtags){var o=[];try{for(var n=Qe(e.hashtags),i=n.next();!i.done;i=n.next()){var a=i.value;a="#"+a,o.push(a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(t)throw t.error}}return o}},hp.prototype.stopPropagation=function(e){e.stopPropagation()},hp.prototype.changePointerReverseSearch=function(e,t){t?(e.stopPropagation(),this.pointerSummaryEnabled=!this.pointerSummaryEnabled):this.pointerSummaryEnabled=e.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)},hp.decorators=[{type:je.Component,args:[{selector:"igo-search-settings",template:'<div class="igo-search-settings">\r\n\r\n  <button\r\n    mat-icon-button\r\n    class="igo-search-settings-button"\r\n    color="primary"\r\n    tooltip-position="below"\r\n    matTooltipShowDelay="500"\r\n    [matTooltip]="\'igo.geo.search.menu.tooltip\' | translate"\r\n    [matMenuTriggerFor]="searchSettingsMenu">\r\n    <mat-icon svgIcon="chevron-down"></mat-icon>\r\n  </button>\r\n  <mat-menu\r\n    #searchSettingsMenu="matMenu"\r\n    class="no-border-radius">\r\n    <div class="checkAllButton" *ngIf="getSearchSources().length>4">\r\n      <button mat-raised-button\r\n        (click)="checkUncheckAllSources($event)">{{!searchSourcesAllEnabled  ? (\'igo.geo.search.searchSources.unselectAll\' | translate): (\'igo.geo.search.searchSources.selectAll\' | translate)}}</button>\r\n    </div>\r\n      <ng-container *ngFor="let source of getSearchSources()">\r\n        <span class="igo-search-settings-search-source">\r\n          <mat-checkbox\r\n            class="igo-search-settings-checkbox"\r\n            [checked]="source.enabled"\r\n            [value]="source"\r\n            (click)="$event.stopPropagation()"\r\n            (change)="onCheckSearchSource($event, source)">\r\n          </mat-checkbox>\r\n          <button *ngIf="source.settings.length > 0"\r\n            [matMenuTriggerFor]="sub_menu"\r\n            mat-menu-item>{{source.title}}\r\n          </button>\r\n          <button\r\n            mat-menu-item\r\n            *ngIf="source.settings.length === 0">\r\n            {{source.title}}\r\n          </button>\r\n        </span>\r\n          <mat-menu #sub_menu="matMenu">\r\n            <ng-container *ngFor="let setting of source.settings">\r\n              <button\r\n                  mat-menu-item\r\n                  [matMenuTriggerFor]="test_sub_menu">\r\n                {{\'igo.geo.search.searchSources.settings.\'+ setting.title | translate}}\r\n              </button>\r\n              <mat-menu #test_sub_menu="matMenu"\r\n                [ngSwitch]="setting.type"\r\n                yPosition="above">\r\n                <span *ngSwitchCase="\'radiobutton\'">\r\n                  <mat-radio-group\r\n                    class="igo-search-settings-radio-group"\r\n                    [value]="setting">\r\n                    <mat-radio-button *ngFor="let settingValue of setting.values"\r\n                      class="mat-typography"\r\n                      [value]="settingValue"\r\n                      [checked]="settingValue.enabled"\r\n                      (click)="$event.stopPropagation()"\r\n                      (change)="settingsValueCheckedRadioButton($event, source, setting, settingValue)">\r\n                      {{settingValue.title | translate}}\r\n                    </mat-radio-button>\r\n                  </mat-radio-group>\r\n                </span>\r\n                <span *ngSwitchCase="\'checkbox\'">\r\n                  <div class="checkAllButton" *ngIf="setting.values.length > 3">\r\n                    <button mat-raised-button\r\n                      (click)="checkUncheckAll($event, source, setting)">{{setting.allEnabled || setting.allEnabled === undefined  ? (\'igo.geo.search.searchSources.settings.unselectAll\' | translate): (\'igo.geo.search.searchSources.settings.selectAll\' | translate)}}</button>\r\n                  </div>\r\n                  <mat-checkbox *ngFor="let settingValue of getAvailableValues(setting)"\r\n                    class="mat-menu-item"\r\n                    [checked]="settingValue.enabled"\r\n                    [value]="setting"\r\n                    [matTooltip]="getAvailableHashtagsValues(settingValue)"\r\n                    (click)="$event.stopPropagation()"\r\n                    (change)="settingsValueCheckedCheckbox($event, source, setting, settingValue)">\r\n                    {{settingValue.title | translate}}\r\n                  </mat-checkbox>\r\n                </span>\r\n              </mat-menu>\r\n            </ng-container>\r\n          </mat-menu>\r\n      </ng-container>\r\n      <span *ngIf="hasPointerReverseSearchSource && !isTouchScreen">\r\n        <mat-divider></mat-divider>\r\n        <span class="pointer-summary-slide-toggle-container mat-typography">\r\n          <mat-slide-toggle class="pointer-summary-option" (change)="changePointerReverseSearch($event)" tooltip-position="below"\r\n            matTooltipShowDelay="500" [matTooltip]="\'igo.geo.search.pointerSearchSummary.tooltip\' | translate"\r\n            (click)="$event.stopPropagation()" [checked]="pointerSummaryEnabled" [labelPosition]="\'after\'">\r\n            {{\'igo.geo.search.pointerSearchSummary.title\' | translate}}\r\n          </mat-slide-toggle>\r\n        </span>\r\n      </span>\r\n  </mat-menu>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".checkAllButton{text-align:center;padding:0 5px}.igo-search-settings-button ::ng-deep div.mat-button-ripple-round{border-radius:0}.igo-search-settings-radio-group{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.igo-search-settings-radio-group mat-radio-button{margin:5px}.igo-search-settings-checkbox mat-radio-button{display:-webkit-box;display:flex}.igo-search-settings-search-source{display:-webkit-box;display:flex;width:100%}.igo-search-settings-search-source mat-checkbox{display:-webkit-box;display:flex;margin-left:5px;margin-right:5px}.pointer-summary-option{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container{overflow-x:hidden}.pointer-summary-slide-toggle-container mat-slide-toggle{margin:10px}"]}]}],hp.ctorParameters=function(){return[{type:uc},{type:Ae.MediaService}]},hp.propDecorators={pointerSummaryEnabled:[{type:je.Input}],searchSourceChange:[{type:je.Output}],pointerSummaryStatus:[{type:je.Output}],handleKeyboardEvent:[{type:je.HostListener,args:["document:keydown",["$event"]]}]},hp);function hp(e,t){this.searchSourceService=e,this.mediaService=t,this.hasPointerReverseSearchSource=!1,this.searchSourcesAllEnabled=!1,this.buffer=[],this.lastKeyTime=Date.now(),this.pointerSummaryEnabled=!1,this.searchSourceChange=new je.EventEmitter,this.pointerSummaryStatus=new je.EventEmitter}var gp=(fp.decorators=[{type:je.NgModule,args:[{declarations:[dp],imports:[xe.CommonModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatMenuModule,Fe.MatRadioModule,Fe.MatCheckboxModule,Fe.MatDividerModule,Fe.MatSlideToggleModule,Ae.IgoLanguageModule],exports:[dp]}]}],fp);function fp(){}var mp=(Object.defineProperty(yp.prototype,"searchType",{get:function(){return this.searchType$.value},set:function(e){this.setSearchType(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yp.prototype,"term",{get:function(){return this.term$.value},set:function(e){this.setTerm(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yp.prototype,"disabled",{get:function(){return this.disabled$.value},set:function(e){this.disabled$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(yp.prototype,"empty",{get:function(){return 0===this.term.length},enumerable:!0,configurable:!0}),yp.prototype.ngOnInit=function(){var t=this;this.term$$=this.term$.subscribe(function(e){t.empty$.next(e===undefined||0===e.length)}),this.stream$$=this.stream$.pipe(Pe.debounce(function(e){return""===e?Le.EMPTY:Le.timer(t.debounce)})).subscribe(function(e){return t.onSetTerm(e)}),this.searchType$$=this.searchType$.pipe(Pe.distinctUntilChanged()).subscribe(function(e){return t.onSetSearchType(e)})},yp.prototype.ngOnDestroy=function(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()},yp.prototype.onKeyup=function(e){var t=e.key;if(this.keyIsValid(t)){var r=e.target.value;this.setTerm(r)}},yp.prototype.onClearButtonClick=function(){this.clear(),this.clearFeature.emit()},yp.prototype.onSearchTypeChange=function(e){this.setSearchType(e)},yp.prototype.setSearchType=function(e){this.searchType$.next(e)},yp.prototype.onSearchSettingsChange=function(){this.doSearch(this.term),this.searchSettingsChange.emit()},yp.prototype.setTerm=function(e){if(!this.disabled){(e=e||"")!==this.term&&this.term$.next(e);var t=e.replace(/(#[^\s]*)/g,"").trim();(t.length>=this.minLength||0===t.length)&&this.stream$.next(e)}},yp.prototype.clear=function(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()},yp.prototype.keyIsValid=function(e){return-1===yp.invalidKeys.indexOf(e)},yp.prototype.onSetTerm=function(e){this.searchTermChange.emit(e),this.doSearch(e)},yp.prototype.onSetSearchType=function(e){if(e!==undefined&&null!==e){this.searchTypeChange.emit(e);var t="igo.geo.search."+e.toLowerCase()+".placeholder";this.placeholder$.next(t),this.setTerm(this.term)}},yp.prototype.doSearch=function(e){var r=this;if(this.researches$$&&(this.researches$$.map(function(e){return e.unsubscribe()}),this.researches$$=undefined),""!==(e?e.replace(/(#[^\s]*)/g,"").trim():"")){var t=this.searchService.search(e,{forceNA:this.forceNA});this.researches$$=t.map(function(t){return t.request.subscribe(function(e){r.onResearchCompleted(t,e)})})}else this.store!==undefined&&this.store.clear()},yp.prototype.onResearchCompleted=function(t,e){if(this.search.emit({research:t,results:e}),this.store!==undefined){var r=this.store.all().filter(function(e){return e.source!==t.source}).concat(e);this.store.load(r)}},yp.invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"],yp.decorators=[{type:je.Component,args:[{selector:"igo-search-bar",template:'<div class="igo-search-bar-container" [ngClass]="{empty: empty$ | async}">\r\n  <mat-form-field [floatLabel]="floatLabel">\r\n    <input\r\n      #input\r\n      matInput\r\n      autocomplete="off"\r\n      [ngClass]="{\'hasSearchIcon\': searchIcon}"\r\n      [disabled]="disabled$ | async"\r\n      [placeholder]="(placeholder$ | async) ? (placeholder$.value | translate) : undefined"\r\n      [value]="term$ | async"\r\n      (keyup)="onKeyup($event)"\r\n      (touchend)="onKeyup($event)">\r\n  </mat-form-field>\r\n\r\n  <div class="search-bar-buttons">\r\n    <button\r\n      mat-icon-button\r\n      [color]="color"\r\n      *ngIf="searchIcon !== undefined">\r\n      <mat-icon svgIcon="{{searchIcon}}"></mat-icon>\r\n    </button>\r\n\r\n    <button\r\n      *ngIf="!(empty$ | async)"\r\n      mat-icon-button\r\n      [color]="color"\r\n      (click)="onClearButtonClick()">\r\n      <mat-icon svgIcon="close"></mat-icon>\r\n    </button>\r\n\r\n    <igo-search-selector\r\n      *ngIf="searchSelector"\r\n      [searchTypes]="searchTypes"\r\n      [searchType]="searchType$ | async"\r\n      (searchTypeChange)="onSearchTypeChange($event)">\r\n    </igo-search-selector>\r\n\r\n    <igo-search-settings\r\n      *ngIf="searchSettings"\r\n      [pointerSummaryEnabled]="pointerSummaryEnabled"\r\n      (pointerSummaryStatus)="pointerSummaryStatus.emit($event)"\r\n      (searchSourceChange)="onSearchSettingsChange()">\r\n    </igo-search-settings>\r\n  </div>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep .mat-form-field{padding:0 5px}:host ::ng-deep .mat-form-field-wrapper{margin-bottom:-1.5em}:host ::ng-deep span.mat-form-field-label-wrapper{top:-20px}:host ::ng-deep div.mat-form-field-infix{left:5px;right:5px;padding:0 0 12px!important}:host ::ng-deep div.mat-form-field-underline{display:none}.igo-search-bar-container{position:relative;width:100%;display:-webkit-inline-box;display:inline-flex;overflow:hidden}.igo-search-bar-container>mat-form-field{width:calc(100% - (2 * 40px))}.igo-search-bar-container.empty>mat-form-field{width:calc(100% - 40px)}.search-bar-buttons{position:relative;right:0;display:-webkit-inline-box;display:inline-flex;top:0}.search-bar-buttons>button:nth-child(2)::before{content:'';left:0;top:5px;border-right:1px solid #ddd;height:28px}igo-search-selector,igo-search-settings{background-color:#fff;top:0;border-radius:0}"]}]}],yp.ctorParameters=function(){return[{type:Ae.LanguageService},{type:gc}]},yp.propDecorators={searchTypes:[{type:je.Input}],searchType:[{type:je.Input}],pointerSummaryStatus:[{type:je.Output}],term:[{type:je.Input}],disabled:[{type:je.Input}],pointerSummaryEnabled:[{type:je.Input}],floatLabel:[{type:je.Input}],color:[{type:je.Input}],debounce:[{type:je.Input}],minLength:[{type:je.Input}],searchIcon:[{type:je.Input}],searchSelector:[{type:je.Input}],searchSettings:[{type:je.Input}],forceNA:[{type:je.Input}],store:[{type:je.Input}],searchTermChange:[{type:je.Output}],search:[{type:je.Output}],searchTypeChange:[{type:je.Output}],clearFeature:[{type:je.Output}],searchSettingsChange:[{type:je.Output}],input:[{type:je.ViewChild,args:["input"]}]},yp);function yp(e,t){this.languageService=e,this.searchService=t,this.placeholder$=new Le.BehaviorSubject("igo.geo.search.placeholder"),this.empty$=new Le.BehaviorSubject(!0),this.stream$=new Le.BehaviorSubject(""),this.searchTypes=sp,this.searchType$=new Le.BehaviorSubject(undefined),this.pointerSummaryStatus=new je.EventEmitter,this.term$=new Le.BehaviorSubject(""),this.disabled$=new Le.BehaviorSubject(!1),this.pointerSummaryEnabled=!1,this.floatLabel="never",this.color="primary",this.debounce=200,this.minLength=2,this.searchSelector=!1,this.searchSettings=!1,this.forceNA=!1,this.searchTermChange=new je.EventEmitter,this.search=new je.EventEmitter,this.searchTypeChange=new je.EventEmitter,this.clearFeature=new je.EventEmitter,this.searchSettingsChange=new je.EventEmitter}var vp=(bp.prototype.ngOnInit=function(){var r=this;this.route&&this.route.options.searchKey&&this.route.queryParams.subscribe(function(e){var t=e[r.route.options.searchKey];t&&(r.component.setTerm(t),r.ref.detectChanges())})},bp.decorators=[{type:je.Directive,args:[{selector:"[igoSearchUrlParam]"}]}],bp.ctorParameters=function(){return[{type:mp,decorators:[{type:je.Self}]},{type:je.ChangeDetectorRef},{type:Ae.RouteService,decorators:[{type:je.Optional}]}]},bp);function bp(e,t,r){this.component=e,this.ref=t,this.route=r}var Sp=(wp.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,ve.FormsModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatButtonModule,Fe.MatMenuModule,Fe.MatRadioModule,Fe.MatFormFieldModule,Fe.MatInputModule,Ae.IgoLanguageModule,cp,gp],exports:[mp],declarations:[mp,vp]}]}],wp);function wp(){}var Ip={Grouped:"grouped",Flat:"flat"},Op=(Object.defineProperty(Fp.prototype,"term",{get:function(){return this._term},set:function(e){this._term=e,this.pageIterator=[]},enumerable:!0,configurable:!0}),Object.defineProperty(Fp.prototype,"results$",{get:function(){return this._results$===undefined&&(this._results$=this.liftResults()),this._results$},enumerable:!0,configurable:!0}),Fp.prototype.ngOnInit=function(){var e=this;this.watcher=new Ce.EntityStoreWatcher(this.store,this.cdRef),this.settingsChange$.subscribe(function(){e.pageIterator=[]})},Fp.prototype.ngOnDestroy=function(){this.watcher.destroy()},Fp.prototype.computeGroupTitle=function(e){var t=[e.source.title],r=e.results.length;return 1<r&&t.push("("+r+")"),t.join(" ")},Fp.prototype.onResultSelect=function(e){this.store.state.get(e)&&!0===this.store.state.get(e).selected||(this.store.state.update(e,{focused:!0,selected:!0},!0),this.resultSelect.emit(e))},Fp.prototype.liftResults=function(){var t=this;return this.store.view.all$().pipe(Pe.debounce(function(e){return 0===e.length?Le.EMPTY:Le.timer(200)}),Pe.map(function(e){return t.groupResults(e.sort(t.sortByOrder))}))},Fp.prototype.sortByOrder=function(e,t){return e.source.displayOrder-t.source.displayOrder},Fp.prototype.groupResults=function(e){var t=this,o=new Map;return e.forEach(function(e){var t=e.source,r=o.get(t);r===undefined&&(r=[],o.set(t,r)),r.push(e)}),Array.from(o.keys()).map(function(e){return t.pageIterator[e.getId()]===undefined&&(t.pageIterator[e.getId()]=1),{source:e,results:o.get(e)}})},Fp.prototype.isMoreResults=function(e){return e.results&&!0===e.results[e.results.length-1].meta.nextPage},Fp.prototype.displayMoreResults=function(o){var n=this,e={sourceId:o.source.getId(),page:++this.pageIterator[o.source.getId()]};this.searchService.search(this.term,e).map(function(r){r.request.subscribe(function(e){var t=o.results.concat(e);e.length||(t[t.length-1].meta.nextPage=!1),n.moreResults.emit({research:r,results:t})})})},Fp.decorators=[{type:je.Component,args:[{selector:"igo-search-results",template:'<igo-list [navigation]="true">\r\n  <ng-template\r\n    #groupTemplate\r\n    ngFor let-group\r\n    [ngForOf]="results$ | async">\r\n\r\n    <igo-collapsible [class]="group.source.getId()"\r\n      *ngIf="mode === searchResultMode.Grouped; else flatTemplate"\r\n      [title]="computeGroupTitle(group)"\r\n      [collapsed]="collapsed[group.source.title]"\r\n      (toggle)="collapsed[group.source.title] = $event">\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </igo-collapsible>\r\n\r\n    <ng-template #flatTemplate>\r\n      <ng-container *ngTemplateOutlet="storeItemTemplate; context: {results: group.results}"></ng-container>\r\n    </ng-template>\r\n\r\n    <ng-template #storeItemTemplate let-results="results">\r\n      <ng-template ngFor let-result [ngForOf]="results">\r\n        <igo-search-results-item\r\n          igoListItem\r\n          color="accent"\r\n          [map]="map"\r\n          [result]="result"\r\n          [showIcons]="showIcons"\r\n          [withZoomButton]="withZoomButton"\r\n          [focused]="store.state.get(result).focused"\r\n          [selected]="store.state.get(result).selected"\r\n          (focus)="resultFocus.emit(result)"\r\n          (unfocus)="resultUnfocus.emit(result)"\r\n          (select)="onResultSelect(result)"\r\n          (mouseenter)="resultFocus.emit(result)"\r\n          (mouseleave)="resultUnfocus.emit(result)">\r\n\r\n          <ng-container igoSearchItemToolbar\r\n            [ngTemplateOutlet]="templateSearchToolbar"\r\n            [ngTemplateOutletContext]="{result: result}">\r\n          </ng-container>\r\n\r\n        </igo-search-results-item>\r\n      </ng-template>\r\n      <span class="moreResults mat-typography" *ngIf="isMoreResults(group)" (click)="displayMoreResults(group)">\r\n        <u>{{ \'igo.geo.search.displayMoreResults\' | translate }}</u>\r\n      </span>\r\n    </ng-template>\r\n\r\n  </ng-template>\r\n\r\n</igo-list>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".moreResults{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}igo-list ::ng-deep mat-list{height:100%}"]}]}],Fp.ctorParameters=function(){return[{type:je.ChangeDetectorRef},{type:gc}]},Fp.propDecorators={map:[{type:je.Input}],store:[{type:je.Input}],showIcons:[{type:je.Input}],mode:[{type:je.Input}],withZoomButton:[{type:je.Input}],term:[{type:je.Input}],settingsChange$:[{type:je.Input}],resultFocus:[{type:je.Output}],resultUnfocus:[{type:je.Output}],resultSelect:[{type:je.Output}],moreResults:[{type:je.Output}],resultMouseenter:[{type:je.Output}],resultMouseleave:[{type:je.Output}],templateSearchToolbar:[{type:je.ContentChild,args:["igoSearchItemToolbar"]}]},Fp);function Fp(e,t){this.cdRef=e,this.searchService=t,this.searchResultMode=Ip,this.pageIterator=[],this.collapsed=[],this.mode=Ip.Grouped,this.withZoomButton=!1,this.settingsChange$=new Le.BehaviorSubject(undefined),this.resultFocus=new je.EventEmitter,this.resultUnfocus=new je.EventEmitter,this.resultSelect=new je.EventEmitter,this.moreResults=new je.EventEmitter,this.resultMouseenter=new je.EventEmitter,this.resultMouseleave=new je.EventEmitter}var xp=(Object.defineProperty(Cp.prototype,"title",{get:function(){return Ce.getEntityTitle(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(Cp.prototype,"titleHtml",{get:function(){return Ce.getEntityTitleHtml(this.result)},enumerable:!0,configurable:!0}),Object.defineProperty(Cp.prototype,"tooltipHtml",{get:function(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,"\n").replace(/<\/?[^>]+(>|$)/g,"")},enumerable:!0,configurable:!0}),Object.defineProperty(Cp.prototype,"icon",{get:function(){return Ce.getEntityIcon(this.result)},enumerable:!0,configurable:!0}),Cp.prototype.onZoomHandler=function(){var e=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});Xo(this.map,[e],cr.Default)},Cp.decorators=[{type:je.Component,args:[{selector:"igo-search-results-item",template:'<mat-list-item>\r\n  <mat-icon *ngIf="icon" mat-list-avatar svgIcon="{{showIcons ? icon : \'blank\'}}"></mat-icon>\r\n\r\n  <h4 matLine *ngIf="titleHtml" [innerHtml]="titleHtml" matTooltipShowDelay="500" [matTooltip]="tooltipHtml" matTooltipClass="search-result-tooltip"></h4>\r\n  <h4 matLine *ngIf="!titleHtml" matTooltipShowDelay="500" [matTooltip]="title">{{title}}</h4>\r\n\r\n  <button *ngIf="withZoomButton"\r\n    igoStopPropagation\r\n    mat-icon-button\r\n    (click)="onZoomHandler()">\r\n    <mat-icon svgIcon="magnify"></mat-icon>\r\n  </button>\r\n\r\n  <ng-content\r\n    select=[igoSearchItemToolbar]>\r\n  </ng-content>\r\n\r\n</mat-list-item>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep small{color:#8c8c8c}::ng-deep .search-result-tooltip{white-space:pre-line}"]}]}],Cp.ctorParameters=function(){return[]},Cp.propDecorators={result:[{type:je.Input}],map:[{type:je.Input}],showIcons:[{type:je.Input}],withZoomButton:[{type:je.Input}],zoomEvent:[{type:je.Output}]},Cp);function Cp(){this.withZoomButton=!1,this.zoomEvent=new je.EventEmitter,this.format=new Oe}var Tp=(Object.defineProperty(Lp.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!0,configurable:!0}),Lp.prototype.ngOnInit=function(){var t=this;"Layer"===this.layer.meta.dataType&&(this.added=-1!==this.map.layers.findIndex(function(e){return e.id===t.layer.data.sourceOptions.id})),this.resolution$$=this.map.viewController.resolution$.subscribe(function(e){t.isInResolutionsRange(e),t.tooltip$.next(t.computeTooltip())})},Lp.prototype.ngOnDestroy=function(){this.resolution$$.unsubscribe()},Lp.prototype.onMouseEvent=function(e){this.onToggleClick(e)},Lp.prototype.onToggleClick=function(e){var t=this;switch("undefined"!=typeof this.lastTimeoutRequest&&clearTimeout(this.lastTimeoutRequest),e.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add()),this.isPreview$.next(!1);break;case"mouseenter":this.isPreview$.value||this.added||(this.lastTimeoutRequest=setTimeout(function(){t.add(),t.isPreview$.next(!0)},500));break;case"mouseleave":this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1))}},Lp.prototype.add=function(){this.added||(this.added=!0,this.addLayerToMap())},Lp.prototype.remove=function(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(function(e){return e.unsubscribe()}),this.layersSubcriptions=[])},Lp.prototype.addLayerToMap=function(){var t=this;if(this.map!==undefined){if(this.layer.meta.dataType!==pr)return undefined;var e=this.layer.data;e.sourceOptions.optionsFromApi===undefined&&(e.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(e).subscribe(function(e){return t.map.addLayer(e)}))}},Lp.prototype.removeLayerFromMap=function(){if(this.map!==undefined){if(this.layer.meta.dataType!==pr)return undefined;var e=this.map.getLayerById(this.layer.data.sourceOptions.id);this.map.removeLayer(e)}},Lp.prototype.isInResolutionsRange=function(e){var t=this.layer.data.minResolution||0,r=this.layer.data.maxResolution||Infinity;this.inRange$.next(t<=e&&e<=r)},Lp.prototype.computeTooltip=function(){return this.added?this.inRange$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"},Lp.decorators=[{type:je.Component,args:[{selector:"igo-search-add-button",template:'<button\r\n(mouseenter)="onMouseEvent($event)" (mouseleave)="onMouseEvent($event)"\r\n*ngIf="layer.meta.dataType === \'Layer\'"\r\nmat-icon-button\r\ntooltip-position="below"\r\nmatTooltipShowDelay="500"\r\n[matTooltip]="(tooltip$ | async) | translate"\r\n[color]="(isPreview$ | async) ? \'\' : added ? \'warn\' : \'\'"\r\n(click)="onToggleClick($event)">\r\n<mat-icon \r\n  matBadge\r\n  igoMatBadgeIcon="eye-off"\r\n  [matBadgeHidden]="(inRange$ | async)"\r\n  matBadgeColor="primary" \r\n  matBadgeSize="small" \r\n  matBadgePosition="after"\r\n  [svgIcon]="(isPreview$ | async) ? \'plus\' : added ? \'delete\' : \'plus\'">\r\n</mat-icon>\r\n</button>',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[".mat-badge-small .mat-badge-content{color:rgba(0,0,0,.38)}"]}]}],Lp.ctorParameters=function(){return[{type:ei}]},Lp.propDecorators={layer:[{type:je.Input}],added:[{type:je.Input}],map:[{type:je.Input}],color:[{type:je.Input}]},Lp);function Lp(e){this.layerService=e,this.tooltip$=new Le.BehaviorSubject("igo.geo.catalog.layer.addToMap"),this.inRange$=new Le.BehaviorSubject(!0),this.isPreview$=new Le.BehaviorSubject(!1),this.layersSubcriptions=[],this._color="primary"}var Mp=(Pp.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatBadgeModule,Fe.MatTooltipModule,Fe.MatIconModule,Fe.MatListModule,Fe.MatButtonModule,Ce.IgoCollapsibleModule,Ce.IgoListModule,Ce.IgoStopPropagationModule,Ae.IgoLanguageModule,Ce.IgoMatBadgeIconModule,Ue],exports:[Op,Tp],declarations:[Op,xp,Tp]}]}],Pp);function Pp(){}var kp=(Dp.prototype.mouseout=function(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()},Object.defineProperty(Dp.prototype,"map",{get:function(){return this.component.map},enumerable:!0,configurable:!0}),Object.defineProperty(Dp.prototype,"mapProjection",{get:function(){return this.component.map.projection},enumerable:!0,configurable:!0}),Dp.prototype.ngOnInit=function(){var t=this;this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.map.status$.pipe(Pe.take(1)).subscribe(function(){t.store=new Ao([],{map:t.map}),t.initStore()}),this.layers$$=this.map.layers$.subscribe(function(e){t.store&&!e.find(function(e){return"searchPointerSummaryId"===e.id})&&t.initStore()})},Dp.prototype.initStore=function(){en(this.store,new Vr({id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new ct,showInLayerList:!1,exportable:!1,browsable:!1,style:jp}))},Dp.prototype.ngAfterContentChecked=function(){this.searchSourceService.getEnabledSources().filter(hc).length?this.hasPointerReverseSearchSource=!0:this.hasPointerReverseSearchSource=!1},Dp.prototype.ngOnDestroy=function(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch(),this.layers$$.unsubscribe()},Dp.prototype.subscribeToPointerStore=function(){var t=this;this.store$$=this.pointerSearchStore.entities$.subscribe(function(e){t.entitiesToPointerOverlay(e)})},Dp.prototype.computeSummaryClosestFeature=function(e){var r={};return e.map(function(e){if(e.data.properties.type&&0<=e.data.properties.distance)if(r.hasOwnProperty(e.data.properties.type)){var t=r[e.data.properties.type].distance;e.data.properties.distance<t&&(r[e.data.properties.type]={distance:e.data.properties.distance,title:e.meta.title})}else r[e.data.properties.type]={distance:e.data.properties.distance,title:e.meta.title}}),r},Dp.prototype.entitiesToPointerOverlay=function(e){var r=this.computeSummaryClosestFeature(e),o=Object.keys(r),n=[],i=[];e.map(function(e){var t=o.indexOf(e.data.properties.type);-1!==t?(i.push(r[e.data.properties.type].title),o.splice(t,1),n.push(e.data.properties.type)):-1===n.indexOf(e.data.properties.type)&&i.push(e.meta.title)}),i.length&&this.addPointerOverlay(i.join("\n"))},Dp.prototype.listenToMapPointerMove=function(){var t=this;this.pointerMoveListener=this.map.ol.on("pointermove",function(e){return t.onMapEvent(e)})},Dp.prototype.unsubscribeToPointerStore=function(){this.store$$.unsubscribe()},Dp.prototype.unsubscribeReverseSearch=function(){this.reverseSearch$$.map(function(e){return e.unsubscribe()}),this.reverseSearch$$=[]},Dp.prototype.unlistenToMapPointerMove=function(){this.map.ol.un(this.pointerMoveListener.type,this.pointerMoveListener.listener),this.pointerMoveListener=undefined},Dp.prototype.onMapEvent=function(e){var t=this;!e.dragging&&this.igoSearchPointerSummaryEnabled&&this.hasPointerReverseSearchSource&&!this.mediaService.isTouchScreen()?("undefined"!=typeof this.lastTimeoutRequest&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=Se.transform(e.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(function(){t.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)):this.clearLayer()},Dp.prototype.onSearchCoordinate=function(){var r=this;this.pointerSearchStore.clear();var o=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0),e=function(t){0<o.length&&n.reverseSearch$$.push(o[t].request.subscribe(function(e){r.onSearch({research:o[t],results:e})}))},n=this;for(var t in o)e(t)},Dp.prototype.onSearch=function(t){var e=t.results,r=this.pointerSearchStore.all().filter(function(e){return e.source!==t.research.source}).concat(e);this.pointerSearchStore.load(r)},Dp.prototype.addPointerOverlay=function(e){this.clearLayer();var t=new Ie.Point(Se.transform(this.lonLat,"EPSG:4326",this.mapProjection)),r=new be({geometry:t}),o=(new Oe).writeGeometryObject(t,{featureProjection:this.mapProjection,dataProjection:this.mapProjection}),n={type:ur,geometry:o,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:e},meta:{id:this.searchPointerSummaryFeatureId},ol:r};this.store.setLayerFeatures([n],cr.None)},Dp.prototype.clearLayer=function(){this.store&&this.store.clearLayer()},Dp.decorators=[{type:je.Directive,args:[{selector:"[igoSearchPointerSummary]"}]}],Dp.ctorParameters=function(){return[{type:Hr,decorators:[{type:je.Self}]},{type:gc},{type:uc},{type:Ae.MediaService}]},Dp.propDecorators={igoSearchPointerSummaryDelay:[{type:je.Input}],igoSearchPointerSummaryEnabled:[{type:je.Input}],mouseout:[{type:je.HostListener,args:["mouseout"]}]},Dp);function Dp(e,t,r,o){this.component=e,this.searchService=t,this.searchSourceService=r,this.mediaService=o,this.pointerSearchStore=new Ce.EntityStore([]),this.reverseSearch$$=[],this.hasPointerReverseSearchSource=!1,this.searchPointerSummaryFeatureId="searchPointerSummaryFeatureId",this.igoSearchPointerSummaryDelay=1e3,this.igoSearchPointerSummaryEnabled=!1}function jp(e,t){return new we.Style({image:new we.Icon({src:"./assets/igo2/geo/icons/cross_black_18px.svg",imgSize:[18,18]}),text:new we.Text({text:e.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new we.Fill({color:"#000"}),backgroundFill:new we.Fill({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new we.Stroke({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new we.Stroke({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}var Ep=($p.forRoot=function(){return{ngModule:$p,providers:[Dc(),Nc(),Qc(),ip()]}},$p.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Sp,cp,Mp,gp],exports:[Sp,cp,Mp,gp,kp],declarations:[kp]}]}],$p);function $p(){}var Rp=(Object.defineProperty(Ap.prototype,"expanded",{get:function(){return this._expanded},set:function(e){this.state=e?"expanded":"collapsed",this._expanded=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ap.prototype,"map",{get:function(){return this._map},set:function(e){this._map=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ap.prototype,"feature",{get:function(){return this._feature},set:function(e){this._feature=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ap.prototype,"title",{get:function(){return Ce.getEntityTitle(this.feature)},enumerable:!0,configurable:!0}),Ap.prototype.toggle=function(){this.expanded=!this.expanded,this.opened.emit(this.expanded)},Ap.prototype.zoomToFeatureExtent=function(){if(this.feature.geometry){var e=this.format.readFeature(this.feature,{dataProjection:this.feature.projection,featureProjection:this.map.projection});Xo(this.map,[e],cr.Zoom)}},Ap.prototype.swipe=function(e){e===Ap.SWIPE_ACTION.UP?this.expanded||this.toggle():e===Ap.SWIPE_ACTION.DOWN&&this.expanded&&this.toggle()},Ap.SWIPE_ACTION={UP:"swipeup",DOWN:"swipedown"},Ap.decorators=[{type:je.Component,args:[{selector:"igo-toast",template:'<igo-flexible #flex\r\n  collapsedMobile="51px"\r\n  expandedMobile="300px"\r\n  [state]="state"\r\n  (swipeup)="swipe($event.type)"\r\n  (swipedown)="swipe($event.type)">\r\n\r\n  <igo-panel [title]="title">\r\n    <button\r\n      mat-icon-button\r\n      panelLeftButton\r\n      (click)="toggle()">\r\n      <mat-icon [svgIcon]="[\'collapsed\', \'initial\'].indexOf(flex.state) >= 0 ? \'arrow_upward\' : \'arrow_downward\'"></mat-icon>\r\n    </button>\r\n\r\n    <button mat-icon-button panelRightButton class="igo-icon-button" (click)="zoomToFeatureExtent()" *ngIf="feature.geometry">\r\n      <mat-icon svgIcon="zoom-in"></mat-icon>\r\n    </button>\r\n\r\n    <igo-feature-details [feature]="feature"></igo-feature-details>\r\n  </igo-panel>\r\n\r\n</igo-flexible>\r\n',styles:[":host{position:absolute;bottom:0;width:100%;max-height:calc(100% - 50px);background-color:#fff}igo-feature-details ::ng-deep table{width:100%}"]}]}],Ap.ctorParameters=function(){return[]},Ap.propDecorators={expanded:[{type:je.Input}],map:[{type:je.Input}],feature:[{type:je.Input}],opened:[{type:je.Output}]},Ap);function Ap(){this.format=new Oe,this.opened=new je.EventEmitter}var Bp=(Gp.forRoot=function(){return{ngModule:Gp}},Gp.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatIconModule,Fe.MatButtonModule,Ce.IgoPanelModule,Ce.IgoFlexibleModule,Fa],exports:[Rp],declarations:[Rp]}]}],Gp);function Gp(){}var _p=(qp.prototype.onUpdateInputs=function(){this.cdRef.detectChanges()},qp.prototype.onClose=function(){this.cancel.emit()},qp.decorators=[{type:je.Component,args:[{selector:"igo-ogc-filter",template:'<igo-ogc-filterable-item\r\n  [layer]="layer" \r\n  [map]="map" >\r\n</igo-ogc-filterable-item>\r\n\r\n<div>\r\n  <button\r\n    mat-button\r\n    type="button"\r\n    (click)="onClose()">\r\n    {{ \'igo.geo.workspace.ogcFilter.close\' | translate }}\r\n  </button>\r\n</div>\r\n',changeDetection:je.ChangeDetectionStrategy.OnPush,styles:[""]}]}],qp.ctorParameters=function(){return[{type:je.ChangeDetectorRef}]},qp.propDecorators={layer:[{type:je.Input}],map:[{type:je.Input}],complete:[{type:je.Output}],cancel:[{type:je.Output}]},qp);function qp(e){this.cdRef=e,this.complete=new je.EventEmitter,this.cancel=new je.EventEmitter}var Np=new je.InjectionToken("OgcFilterWidget");function Vp(e){return e.create(_p)}function Up(){return{provide:Np,useFactory:Vp,deps:[Ce.WidgetService]}}var Wp=(zp.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Fe.MatButtonModule,Ae.IgoLanguageModule,Fl],exports:[_p],declarations:[_p],entryComponents:[_p]}]}],zp);function zp(){}var Kp,Hp=(Ke(Yp,Kp=Ce.Workspace),Object.defineProperty(Yp.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(Yp.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),Yp);function Yp(e){var t=Kp.call(this,e)||this;return t.options=e,t}var Zp=(Qp.prototype.createWorkspace=function(e,t){return new Hp({id:e.id,title:e.title,layer:e,map:t,entityStore:this.createFeatureStore(e,t),actionStore:new Ce.ActionStore([]),meta:{tableTemplate:this.createTableTemplate(e)}})},Qp.prototype.createFeatureStore=function(e,t){var r=new Ao([],{map:t});r.bindLayer(e);var o=new Eo({}),n=new Vo({map:t,hitTolerance:5});return r.addStrategy(o,!0),r.addStrategy(n,!0),r},Qp.prototype.createTableTemplate=function(e){return{selection:!0,sort:!0,columns:(e.dataSource.options.sourceFields||[]).map(function(e){return{name:"properties."+e.name,title:e.alias?e.alias:e.name}})}},Qp.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Qp.ctorParameters=function(){return[]},Qp.ngInjectableDef=je.defineInjectable({factory:function(){return new Qp},token:Qp,providedIn:"root"}),Qp);function Qp(){}var Jp,Xp=(Ke(ed,Jp=Ce.Workspace),Object.defineProperty(ed.prototype,"layer",{get:function(){return this.options.layer},enumerable:!0,configurable:!0}),Object.defineProperty(ed.prototype,"map",{get:function(){return this.options.map},enumerable:!0,configurable:!0}),ed);function ed(e){var t=Jp.call(this,e)||this;return t.options=e,t}var td=(rd.prototype.createWorkspace=function(e,t){return new Xp({id:e.id,title:e.title,layer:e,map:t,actionStore:new Ce.ActionStore([])})},rd.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],rd.ctorParameters=function(){return[]},rd.ngInjectableDef=je.defineInjectable({factory:function(){return new rd},token:rd,providedIn:"root"}),rd);function rd(){}var od=(Object.defineProperty(nd.prototype,"workspaceStore",{get:function(){return this.component.store},enumerable:!0,configurable:!0}),nd.prototype.ngOnInit=function(){var t=this;this.layers$$=this.map.layers$.pipe(Pe.debounceTime(50)).subscribe(function(e){return t.onLayersChange(e)})},nd.prototype.ngOnDestroy=function(){this.layers$$.unsubscribe()},nd.prototype.onLayersChange=function(e){var t=this,r=e.filter(function(e){return t.layerIsEditable(e)}),o=r.map(function(e){return e.id}),n=r.map(function(e){return t.getOrCreateWorkspace(e)}).filter(function(e){return e!==undefined}),i=this.workspaceStore.all().filter(function(e){return o.indexOf(e.id)<0});0<i.length&&(i.forEach(function(e){e.deactivate()}),this.workspaceStore.state.updateMany(i,{active:!1,selected:!1}),this.workspaceStore.deleteMany(i)),0<n.length&&this.workspaceStore.insertMany(n)},nd.prototype.getOrCreateWorkspace=function(e){if(this.workspaceStore.get(e.id)===undefined)return e.dataSource instanceof Pt?this.wfsWorkspaceService.createWorkspace(e,this.map):e.dataSource instanceof Gt?this.wmsWorkspaceService.createWorkspace(e,this.map):void 0},nd.prototype.layerIsEditable=function(e){var t=e.dataSource;if(t instanceof Pt)return!0;if(t instanceof Gt){var r=t.options||{};return r.ogcFilters&&r.ogcFilters.enabled}return!1},nd.decorators=[{type:je.Directive,args:[{selector:"[igoWorkspaceSelector]"}]}],nd.ctorParameters=function(){return[{type:Ce.WorkspaceSelectorComponent},{type:Zp},{type:td}]},nd.propDecorators={map:[{type:je.Input}]},nd);function nd(e,t,r){this.component=e,this.wfsWorkspaceService=t,this.wmsWorkspaceService=r}var id=(ad.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule],exports:[od],declarations:[od]}]}],ad);function ad(){}var sd=(ld.decorators=[{type:je.NgModule,args:[{imports:[xe.CommonModule,Ce.IgoWidgetModule,id,Wp],exports:[id,Wp],declarations:[],providers:[Up()]}]}],ld);function ld(){}var ud=(cd.forRoot=function(){return{ngModule:cd,providers:[]}},cd.decorators=[{type:je.NgModule,args:[{imports:[],exports:[],declarations:[]}]}],cd);function cd(){}var pd=(dd.forRoot=function(){return{ngModule:dd,providers:[]}},dd.decorators=[{type:je.NgModule,args:[{imports:[],declarations:[],exports:[Ji,ea,ma,Fa,Fl,Us,ju,Ni,$u,qu,Ue,Vu,oc,sc,Mc,Ep,Bp,sd,ud]}]}],dd);function dd(){}function hd(e,t){return new Jn(e,t.getConfig("optionsApi"))}var gd,fd=(Ke(md,gd=Oi),md.prototype.getId=function(){return md.id},md.prototype.getType=function(){return md.type},md.prototype.getDefaultOptions=function(){return{title:"Cadastre (Québec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}},md.prototype.search=function(e,t){var r=this;e=(e=(e=e.endsWith(",")?e.slice(0,-1):e).startsWith(",")?e.substr(1):e).replace(/ /g,"");var o=this.computeSearchRequestParams(e,t||{});return o.get("numero")&&o.get("numero").match(/^[0-9,]+$/g)?this.http.get(this.searchUrl,{params:o,responseType:"text"}).pipe(Pe.map(function(e){return r.extractResults(e)})):Le.of([])},md.prototype.computeSearchRequestParams=function(e,t){return new Me.HttpParams({fromObject:Object.assign({numero:e,epsg:"4326"},this.params,t.params||{})})},md.prototype.extractResults=function(e){var t=this;return e.split("<br />").filter(function(e){return 0<e.length}).map(function(e){return t.dataToResult(e)})},md.prototype.dataToResult=function(e){var t=e.split(";"),r=t[0],o=t[7],n=this.computeGeometry(o),i={NoLot:r},a=[this.getId(),"cadastre",r].join(".");return{source:this,meta:{dataType:ur,id:a,title:r,icon:"map-marker"},data:{type:ur,projection:"EPSG:4326",geometry:n,properties:i,meta:{id:a,title:r}}}},md.prototype.computeGeometry=function(e){var t=(new Te).readFeature(e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:t.getGeometry().getType(),coordinates:t.getGeometry().getCoordinates()}},md.id="cadastre",md.type=ur,md.decorators=[{type:je.Injectable}],md.ctorParameters=function(){return[{type:Me.HttpClient},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]}]},md);function md(e,t){var r=gd.call(this,t)||this;return r.http=e,r}function yd(e,t){return new fd(e,t.getConfig("searchSources."+fd.id))}var vd,bd=(Ke(Sd,vd=Oi),Sd.prototype.getId=function(){return Sd.id},Sd.prototype.getType=function(){return Sd.type},Sd.prototype.getDefaultOptions=function(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}},Sd.prototype.search=function(e,t){var r=this,o=this.computeSearchRequestParams(e,t||{});return o.get("q")?this.http.get(this.searchUrl,{params:o}).pipe(Pe.map(function(e){return r.extractResults(e)})):Le.of([])},Sd.prototype.computeSearchRequestParams=function(e,t){return new Me.HttpParams({fromObject:Object.assign({q:this.computeTerm(e),format:"json"},this.params,t.params||{})})},Sd.prototype.extractResults=function(e){var t=this;return e.map(function(e){return t.dataToResult(e)})},Sd.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=this.computeGeometry(e),o=this.computeExtent(e),n=[this.getId(),"place",e.place_id].join(".");return{source:this,meta:{dataType:ur,id:n,title:e.display_name,icon:"map-marker"},data:{type:ur,projection:"EPSG:4326",geometry:r,extent:o,properties:t,meta:{id:n,title:e.display_name}}}},Sd.prototype.computeProperties=function(e){return{display_name:e.display_name,place_id:e.place_id,osm_type:e.osm_type,"class":e["class"],type:e.type}},Sd.prototype.computeGeometry=function(e){return{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}},Sd.prototype.computeExtent=function(e){return[parseFloat(e.boundingbox[2]),parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[3]),parseFloat(e.boundingbox[1])]},Sd.prototype.computeTerm=function(e){return this.computeTermTags(e)},Sd.prototype.computeTermTags=function(t){var e=vd.prototype.getHashtagsValid.call(this,t,"amenity");return e?e.length?(t=t.replace(/(#[^\s]*)/g,""),e.forEach(function(e){t+="+["+e+"]"}),t):null:this.computeTermSettings(t)},Sd.prototype.computeTermSettings=function(t){return this.options.settings.forEach(function(e){"amenity"===e.name&&e.values.forEach(function(e){e.enabled&&"string"==typeof e.value&&e.value.split(",").forEach(function(e){t+="+["+e+"]"})})}),t},Sd.id="nominatim",Sd.type=ur,Sd.decorators=[{type:je.Injectable}],Sd.ctorParameters=function(){return[{type:Me.HttpClient},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]}]},Sd);function Sd(e,t){var r=vd.call(this,t)||this;return r.http=e,r}function wd(e,t){return new bd(e,t.getConfig("searchSources."+bd.id))}var Id,Od=(Ke(Fd,Id=Oi),Fd.prototype.getId=function(){return Fd.id},Fd.prototype.getType=function(){return Fd.type},Fd.prototype.getDefaultOptions=function(){return{title:"Stored Queries",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/ws/swtq"}},Fd.prototype.search=function(e,t){var r=this,o=this.termSplitter(e,this.storedQueriesOptions.fields),n=this.computeRequestParams(t||{},o);return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:n,responseType:"text"}).pipe(Pe.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:n}).pipe(Pe.map(function(e){return r.extractResults(r.extractWFSData(e))}))},Fd.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=De.GeoJSON),r.test(t)&&(e=De.WFS),new e},Fd.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=De.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},Fd.prototype.termSplitter=function(e,t){var o={},n=e,r=0;return t.forEach(function(e){o[e.name]=e.defaultValue;var t=new RegExp(e.splitPrefix+"(.+)","i");t.test(n)&&(r=e.splitPrefix?r+=1:r,n=n.split(t)[1])}),0===r?o[t[0].name]=e:(n=e,Xe(t).reverse().forEach(function(e){var t=new RegExp(e.splitPrefix||"(.+)","i");if(n||""!==n){var r=n.split(t);n=r[0],r[1]&&(o[e.name]=r[1].trim())}})),o},Fd.prototype.computeRequestParams=function(e,t){var r=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new Me.HttpParams({fromObject:Object.assign({service:"wfs",version:r,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},t,this.params,e.params||{})})},Fd.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},Fd.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:ur,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:ur,id:r,title:e.properties.title,titleHtml:e.properties[o],icon:"map-marker"}}},Fd.prototype.computeProperties=function(e){return ke.ObjectUtils.removeKeys(e.properties,Fd.propertiesBlacklist)},Fd.id="storedqueries",Fd.type=ur,Fd.propertiesBlacklist=["boundedBy","id","coord_x","coord_y"],Fd.decorators=[{type:je.Injectable}],Fd.ctorParameters=function(){return[{type:Me.HttpClient},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]}]},Fd);function Fd(e,t){var r=Id.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,r.storedQueriesOptions&&!r.storedQueriesOptions.available)return r;if(r.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),r.storedQueriesOptions={storedquery_id:"rtss",fields:[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],outputformat:"text/xml; subtype=gml/3.1.1",srsname:"EPSG:4326",resultTitle:"title"},r.resultTitle="title",console.log("Default values",r.storedQueriesOptions)),!r.storedQueriesOptions.storedquery_id){var o='Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"';throw new Error(o)}if(!r.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&r.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){o="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw o+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(o)}return r.storedQueriesOptions.fields instanceof Array||(r.storedQueriesOptions.fields=[r.storedQueriesOptions.fields]),r.multipleFieldsQuery=1<r.storedQueriesOptions.fields.length,r.storedQueriesOptions.fields.forEach(function(e,t){if(r.multipleFieldsQuery&&!e.splitPrefix&&0!==t)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!e.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}var xd,Cd=(Ke(Td,xd=Oi),Td.prototype.getId=function(){return Td.id},Td.prototype.getType=function(){return Td.type},Td.prototype.getDefaultOptions=function(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}},Td.prototype.reverseSearch=function(e,t){var r=this,o=this.computeRequestParams(e,t||{});return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:o,responseType:"text"}).pipe(Pe.map(function(e){return r.extractResults(r.extractWFSData(e))})):this.http.get(this.searchUrl,{params:o}).pipe(Pe.map(function(e){return r.extractResults(r.extractWFSData(e))}))},Td.prototype.getFormatFromOptions=function(){var e,t=this.storedQueriesOptions.outputformat,r=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(t)&&(e=De.GeoJSON),r.test(t)&&(e=De.WFS),new e},Td.prototype.extractWFSData=function(e){var t=this.getFormatFromOptions(),r=De.GeoJSON,o=t.readFeatures(e);return JSON.parse((new r).writeFeatures(o))},Td.prototype.computeRequestParams=function(e,t){var r={};return r[this.storedQueriesOptions.longField]=e[0],r[this.storedQueriesOptions.latField]=e[1],new Me.HttpParams({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},r,this.params,t.params||{})})},Td.prototype.extractResults=function(e){var t=this;return e.features.map(function(e){return t.dataToResult(e)})},Td.prototype.dataToResult=function(e){var t=this.computeProperties(e),r=[this.getId(),t.type,e.id].join("."),o=e.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:ur,projection:"EPSG:4326",geometry:e.geometry,properties:t,meta:{id:r,title:e.properties[o]}},meta:{dataType:ur,id:r,title:e.properties[o],icon:"map-marker"}}},Td.prototype.computeProperties=function(e){var t=ke.ObjectUtils.removeKeys(e.properties,Td.propertiesBlacklist);return Object.assign(t,{type:e.properties.doc_type})},Td.id="storedqueriesreverse",Td.type=ur,Td.propertiesBlacklist=[],Td.decorators=[{type:je.Injectable}],Td.ctorParameters=function(){return[{type:Me.HttpClient},{type:undefined,decorators:[{type:je.Inject,args:["options"]}]}]},Td);function Td(e,t){var r=xd.call(this,t)||this;if(r.http=e,r.storedQueriesOptions=t,!r.storedQueriesOptions.storedquery_id){throw new Error('Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"')}if(!r.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!r.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');return r.storedQueriesOptions.outputformat=r.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",r.storedQueriesOptions.srsname=r.storedQueriesOptions.srsname||"EPSG:4326",r.storedQueriesOptions.resultTitle=r.storedQueriesOptions.resultTitle||r.resultTitle,r}function Ld(e,t){return new Od(e,t.getConfig("searchSources."+Od.id))}function Md(e,t){return new Cd(e,t.getConfig("searchSources."+Cd.id))}var Pd={GeoJSON:0,JSON:1};Pd[Pd.GeoJSON]="GeoJSON",Pd[Pd.JSON]="JSON";var kd,Dd={Route:"Route",Trip:"Trip"},jd=(Ke(Ed,kd=mc),Object.defineProperty(Ed.prototype,"enabled",{get:function(){return!1!==this.options.enabled},set:function(e){this.options.enabled=e},enumerable:!0,configurable:!0}),Ed.prototype.getName=function(){return Ed._name},Ed.prototype.route=function(e,t){var r=this;void 0===t&&(t={});var o=this.getRouteParams(t);return this.http.get(this.directionsUrl+e.join(";"),{params:o}).pipe(Pe.map(function(e){return r.extractRoutesData(e)}))},Ed.prototype.extractRoutesData=function(t){var r=this,o=[];return t.routes.forEach(function(e){o.push(r.formatRoute(e,t.waypoints))}),o},Ed.prototype.getRouteParams=function(e){return void 0===e&&(e={}),e.alternatives=e.alternatives===undefined||e.alternatives,e.steps=e.steps===undefined||e.steps,e.geometries=e.geometries!==undefined?e.geometries:"geojson",e.overview=e.overview!==undefined&&e.overview,new Me.HttpParams({fromObject:{alternatives:e.alternatives?"true":"false",overview:e.overview?"simplified":"full",steps:e.steps?"true":"false",geometries:e.geometries?e.geometries:"geojson"}})},Ed.prototype.formatRoute=function(e,t){var r=[];return e.legs.forEach(function(e){e.steps.forEach(function(e){r.push(e)})}),{id:ke.uuid(),title:e.legs[0].summary,source:Ed._name,sourceType:Dd.Route,order:1,format:Pd.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:t,distance:e.distance,duration:e.duration,geometry:e.geometry,legs:e.legs,steps:r,weight:e.weight,weight_name:e.weight_name}},Ed._name="OSRM Québec",Ed.decorators=[{type:je.Injectable}],Ed.ctorParameters=function(){return[{type:Me.HttpClient},{type:Ae.ConfigService}]},Ed);function Ed(e,t){var r=kd.call(this)||this;return r.http=e,r.config=t,r.directionsUrl="https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/",r.options=r.config.getConfig("directionsSources.osrm")||{},r.directionsUrl=r.options.url||r.directionsUrl,r}function $d(e,t){return new jd(e,t)}var Rd,Ad=(Ke(Bd,Rd=ql),Bd.prototype.exportToFile=function(e,t,r,o,n,i){var a=this;if(this.platform.is("cordova")){var s=(new De[r]).writeFeatures(e,{dataProjection:i,featureProjection:n,featureType:"feature",featureNS:"http://example.com/feature"}),l=o+"."+r.toLowerCase(),u=this.file.externalRootDirectory+"Download";this.file.writeFile(u,l,s,{replace:!0}).then(function(e){return a.fileOpener.open(u+"/"+l,"text/plain")}),t.complete()}else Rd.prototype.exportToFile.call(this,e,t,r,o,n,i)},Bd.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],Bd.ctorParameters=function(){return[{type:Ae.ConfigService},{type:Ee.Platform},{type:Re.FileOpener},{type:$e.File}]},Bd.ngInjectableDef=je.defineInjectable({factory:function(){return new Bd(je.inject(Ae.ConfigService),je.inject(Ee.Platform),je.inject(Be.FileOpener),je.inject(Ge.File))},token:Bd,providedIn:"root"}),Bd);function Bd(e,t,r,o){var n=Rd.call(this,e)||this;return n.platform=t,n.fileOpener=r,n.file=o,n}var Gd,_d=(Ke(qd,Gd=zu),qd.prototype.saveDoc=function(e){var t=this;if(this.platform.is("cordova")){var r=e.output(),o=new ArrayBuffer(r.length),n=new Uint8Array(o);this.setDate();for(var i=0;i<r.length;i++)n[i]=r.charCodeAt(i);var a="map"+this.year+"-"+this.month+"-"+this.day+"-"+this.hour+"-"+this.minute+".pdf",s=this.file.externalRootDirectory+"Download";this.file.writeFile(s,a,o,{replace:!0}).then(function(e){return t.fileOpener.open(s+"/"+a,"application/pdf")})}else Gd.prototype.saveDoc.call(this,e)},qd.prototype.setDate=function(){this.date=new Date,this.day=this.date.getDate().toString(),this.month=this.date.getMonth()+1,this.month<10?this.month="0"+this.month.toString():this.month=this.month.toString(),this.year=this.date.getFullYear().toString(),this.hour=this.date.getHours().toString(),this.minute=this.date.getMinutes().toString()},qd.decorators=[{type:je.Injectable,args:[{providedIn:"root"}]}],qd.ctorParameters=function(){return[{type:Ae.MessageService},{type:Ae.ActivityService},{type:Ae.LanguageService},{type:Ee.Platform},{type:Re.FileOpener},{type:$e.File}]},qd.ngInjectableDef=je.defineInjectable({factory:function(){return new qd(je.inject(Ae.MessageService),je.inject(Ae.ActivityService),je.inject(Ae.LanguageService),je.inject(Ee.Platform),je.inject(Be.FileOpener),je.inject(Ge.File))},token:qd,providedIn:"root"}),qd);function qd(e,t,r,o,n,i){var a=Gd.call(this,e,t,r)||this;return a.platform=o,a.fileOpener=n,a.file=i,a}e.IgoGeoModule=pd,e.IgoCatalogModule=Ji,e.IgoCatalogBrowserModule=Ui,e.IgoCatalogLibraryModule=Zi,e.IgoDataSourceModule=ea,e.IgoDirectionsModule=Mc,e.IgoDownloadModule=ma,e.IgoGeoWorkspaceModule=sd,e.IgoWorkspaceSelectorModule=id,e.IgoOgcFilterModule=Wp,e.IgoFeatureModule=Fa,e.IgoFeatureFormModule=Ia,e.IgoFeatureDetailsModule=Sa,e.IgoFilterModule=Fl,e.IgoGeometryModule=Us,e.IgoGeometryFormFieldModule=Ns,e.IgoImportExportModule=ju,e.IgoLayerModule=Ni,e.IgoMapModule=$u,e.IgoMeasureModule=qu,e.IgoMeasurerModule=Gu,e.IgoMetadataModule=Ue,e.IgoOverlayModule=Vu,e.IgoPrintModule=oc,e.IgoQueryModule=sc,e.IgoSearchModule=Ep,e.IgoSearchBarModule=Sp,e.SearchBarComponent=mp,e.IgoSearchResultsModule=Mp,e.IgoToastModule=Bp,e.IgoWktModule=ud,e.optionsApiFactory=hd,e.provideOptionsApi=function Kd(){return{provide:Hn,useFactory:hd,deps:[Me.HttpClient,Ae.ConfigService]}},e.querySearchSourceFactory=ic,e.provideQuerySearchSource=ac,e.cadastreSearchSourceFactory=yd,e.provideCadastreSearchSource=function Hd(){return{provide:Oi,useFactory:yd,multi:!0,deps:[Me.HttpClient,Ae.ConfigService]}},e.defaultIChercheSearchResultFormatterFactory=qc,e.provideDefaultIChercheSearchResultFormatter=Nc,e.ichercheSearchSourceFactory=Vc,e.provideIChercheSearchSource=function Yd(){return{provide:Oi,useFactory:Vc,multi:!0,deps:[Me.HttpClient,Ae.LanguageService,Ae.ConfigService,jc,je.Injector]}},e.ichercheReverseSearchSourceFactory=Uc,e.provideIChercheReverseSearchSource=function Zd(){return{provide:Oi,useFactory:Uc,multi:!0,deps:[Me.HttpClient,Ae.LanguageService,Ae.ConfigService,je.Injector]}},e.defaultCoordinatesSearchResultFormatterFactory=Zc,e.provideDefaultCoordinatesSearchResultFormatter=Qc,e.CoordinatesReverseSearchSourceFactory=Jc,e.provideCoordinatesReverseSearchSource=function Qd(){return{provide:Oi,useFactory:Jc,multi:!0,deps:[Ae.ConfigService,Ae.LanguageService,Cn]}},e.ilayerSearchResultFormatterFactory=np,e.provideILayerSearchResultFormatter=ip,e.ilayerSearchSourceFactory=ap,e.provideILayerSearchSource=function Jd(){return{provide:Oi,useFactory:ap,multi:!0,deps:[Me.HttpClient,Ae.LanguageService,Ae.ConfigService,Xc]}},e.nominatimSearchSourceFactory=wd,e.provideNominatimSearchSource=function Xd(){return{provide:Oi,useFactory:wd,multi:!0,deps:[Me.HttpClient,Ae.ConfigService]}},e.storedqueriesSearchSourceFactory=Ld,e.provideStoredQueriesSearchSource=function eh(){return{provide:Oi,useFactory:Ld,multi:!0,deps:[Me.HttpClient,Ae.ConfigService]}},e.storedqueriesReverseSearchSourceFactory=Md,e.provideStoredQueriesReverseSearchSource=function th(){return{provide:Oi,useFactory:Md,multi:!0,deps:[Me.HttpClient,Ae.ConfigService]}},e.osrmDirectionsSourcesFactory=$d,e.provideOsrmDirectionsSource=function rh(){return{provide:mc,useFactory:$d,multi:!0,deps:[Me.HttpClient,Ae.ConfigService]}},e.directionsSourceServiceFactory=vc,e.provideDirectionsSourceService=bc,e.DirectionsSourceService=yc,e.provideStyleListOptions=Lu,e.styleListFactory=Mu,e.provideStyleListLoader=Pu,e.STYLELIST_OPTIONS=Tu,e.CatalogService=Di,e.CatalogItemType=ri,e.TypeCatalog=oi,e.Catalog=ii,e.CompositeCatalog=fi,e.CatalogFactory=yi,e.CatalogBrowserComponent=Ei,e.CatalogLibaryComponent=zi,e.DataService=et,e.DataSource=st,e.FeatureDataSource=ct,e.OSMDataSource=ht,e.XYZDataSource=mt,e.WFSDataSource=Pt,e.WFSService=jt,e.WMSDataSource=Gt,e.formatWFSQueryString=Ct,e.checkWfsParams=Tt,e.getFormatFromOptions=Lt,e.defaultEpsg=St,e.defaultMaxFeatures=wt,e.defaultWfsVersion=It,e.defaultFieldNameGeometry=Ot,e.gmlRegex=Ft,e.jsonRegex=xt,e.WMTSDataSource=Vt,e.CartoDataSource=zt,e.ArcGISRestDataSource=Yt,e.TileArcGISRestDataSource=Jt,e.WebSocketDataSource=tr,e.MVTDataSource=nr,e.ClusterDataSource=sr,e.DataSourceService=Yn,e.TypeCapabilities=Wn,e.CapabilitiesService=zn,e.OptionsService=Hn,e.OptionsApiService=Jn,e.EsriStyleGenerator=qn,e.createDefaultTileGrid=qt,e.DownloadService=da,e.DownloadButtonComponent=ga,e.FEATURE=ur,e.FeatureMotion=cr,e.featureToOl=Wo,e.renderFeatureFromOl=zo,e.featureFromOl=Ko,e.computeOlFeatureExtent=Ho,e.computeOlFeaturesExtent=Yo,e.scaleExtent=Zo,e.featuresAreOutOfView=Qo,e.featuresAreTooDeepInView=Jo,e.moveToOlFeatures=Xo,e.hideOlFeature=function oh(e){e.setStyle(new we.Style({}))},e.tryBindStoreLayer=en,e.tryAddLoadingStrategy=tn,e.tryAddSelectionStrategy=rn,e.computeOlFeaturesDiff=on,e.FeatureStore=Ao,e.FeatureStoreLoadingStrategy=ko,e.FeatureStoreLoadingLayerStrategy=Eo,e.FeatureStoreSelectionStrategy=Vo,e.FeatureFormComponent=nn,e.FilterableDataSourcePipe=ra,e.TimeFilterType=Vn,e.TimeFilterStyle=Un,e.TimeFilterService=na,e.OgcFilterOperatorType={BasicNumericOperator:"BasicNumericOperator",Basic:"Basic",BasicAndSpatial:"BasicAndSpatial",Spatial:"Spatial",All:"All",Time:"time"},e.OGCFilterService=aa,e.OgcFilterWriter=vt,e.SpatialFilterQueryType={AdmRegion:"AdmRegion",Mun:"Mun",Arrond:"Arrond",CircFed:"CircFed",CircProv:"CircProv",DirReg:"DirReg",MRC:"MRC",RegTour:"RegTour"},e.SpatialFilterType=la,e.SpatialFilterItemType=ua,e.SpatialFilterService=ca,e.TimeFilterFormComponent=Hs,e.TimeFilterItemComponent=Zs,e.TimeFilterListComponent=Js,e.TimeFilterListBindingDirective=el,e.OgcFilterableFormComponent=al,e.OgcFilterableItemComponent=ll,e.OgcFilterableListComponent=cl,e.OgcFilterableListBindingDirective=dl,e.OgcFilterFormComponent=nl,e.OgcFilterToggleButtonComponent=ml,e.OgcFilterButtonComponent=gl,e.TimeFilterButtonComponent=zs,e.SpatialFilterTypeComponent=vl,e.SpatialFilterListComponent=Sl,e.SpatialFilterItemComponent=Il,e.GeometrySliceError=cs,e.GeometrySliceMultiPolygonError=hs,e.GeometrySliceLineStringError=ms,e.GeometrySliceTooManyIntersectionError=bs,e.createDrawInteractionStyle=ws,e.createDrawHoleInteractionStyle=Is,e.sliceOlGeometry=Os,e.sliceOlLineString=Fs,e.sliceOlPolygon=xs,e.addLinearRingToOlPolygon=Cs,e.getMousePositionFromOlGeometryEvent=Ts,e.DrawControl=Ls,e.ModifyControl=Ps,e.SliceControl=Ds,e.DropGeoFileDirective=xu,e.ExportError=Ml,e.ExportInvalidFileError=Dl,e.ExportNothingToExportError=$l,e.ExportService=ql,e.ExportIonicService=Ad,e.ExportFormat=_l,e.handleFileExportError=Al,e.handleFileExportSuccess=Bl,e.handleNothingToExportError=Gl,e.exportToCSV=function nh(e,t,r){void 0===r&&(r=";");var o=e.map(function(e,t){return e.join(r)}).join("\n");ke.downloadContent(o,"text/csv;charset=utf-8",t)},e.entitiesToRowData=function ih(e,t){return e.map(function(r){return t.map(function(e){var t;return e.renderer!==undefined&&e.renderer!==Ce.EntityTableColumnRenderer.Default||(t=e.valueAccessor),(t=t||Ce.getEntityProperty)(r,e.name)})})},e.ImportError=Ul,e.ImportInvalidFileError=Kl,e.ImportUnreadableFileError=Zl,e.ImportNothingToImportError=Xl,e.ImportSizeError=ru,e.ImportSRSError=iu,e.ImportService=vu,e.addLayerAndFeaturesToMap=su,e.addLayerAndFeaturesStyledToMap=lu,e.handleFileImportSuccess=uu,e.handleFileImportError=cu,e.handleInvalidFileImportError=pu,e.handleUnreadbleFileImportError=du,e.handleSizeFileImportError=hu,e.handleNothingToImportError=gu,e.handleSRSImportError=fu,e.getFileExtension=mu,e.computeLayerTitleFromFile=yu,e.ImportExportComponent=Iu,e.StyleListService=Su,e.LayerService=ei,e.LAYER=pr,e.Layer=Or,e.TooltipType=Cr,e.ImageLayer=Ar,e.TileLayer=_r,e.VectorLayer=Vr,e.VectorTileLayer=zr,e.StyleService=no,e.LayerItemComponent=lo,e.LayerLegendComponent=co,e.LayerLegendItemComponent=ho,e.LayerLegendListComponent=fo,e.LayerListComponent=vo,e.LayerListBindingDirective=Io,e.LayerListControlsEnum=yo,e.LayerListToolComponent=Fo,e.LayerListToolControlsEnum={always:"always",never:"never","default":"default"},e.LayerListToolService=Co,e.TrackFeatureButtonComponent=Lo,e.ImageWatcher=Tr,e.TileWatcher=Pr,e.getLayersLegends=Dr,e.VectorWatcher=Er,e.IgoMap=vn,e.MapViewAction=dn,e.MapService=So,e.stringToLonLat=dr,e.viewStatesAreEqual=gr,e.formatScale=fr,e.getResolutionFromScale=mr,e.getScaleFromResolution=yr,e.ctrlKeyDown=vr,e.roundCoordTo=br,e.lonLatConversion=Sr,e.utmZoneFromLonLat=wr,e.mtmZoneFromLonLat=Ir,e.MapOfflineDirective=Sn,e.PointerPositionDirective=In,e.PointerPositionByKeyDirective=Fn,e.ProjectionService=Cn,e.MapController=hn,e.MapViewController=mn,e.MapBrowserComponent=Hr,e.ZoomButtonComponent=Ln,e.GeolocateButtonComponent=Pn,e.OfflineButtonComponent=Dn,e.BaseLayersSwitcherComponent=$n,e.MiniBaseMapComponent=An,e.RotationButtonComponent=Gn,e.MEASURE_UNIT_AUTO="auto",e.MeasureType=Pa,e.MeasureLengthUnit=ka,e.MeasureLengthUnitAbbreviation=Da,e.MeasureAreaUnit=ja,e.MeasureAreaUnitAbbreviation=Ea,e.metersToKilometers=$a,e.metersToFeet=Ra,e.metersToMiles=Aa,e.squareMetersToSquareKilometers=Ba,e.squareMetersToSquareMiles=Ga,e.squareMetersToSquareFeet=_a,e.squareMetersToHectares=qa,e.squareMetersToAcres=Na,e.metersToUnit=Va,e.squareMetersToUnit=Ua,e.formatMeasure=Wa,e.computeBestLengthUnit=za,e.computeBestAreaUnit=Ka,e.createMeasureInteractionStyle=Ha,e.createMeasureLayerStyle=Ya,e.measureOlGeometryLength=Za,e.measureOlGeometryArea=Qa,e.measureOlGeometry=Ja,e.updateOlGeometryMidpoints=Xa,e.clearOlGeometryMidpoints=function ah(e){for(var t=e.get("_midpoints")||[],r=t.length,o=0;o<r;o++){var n=t[o];n!==undefined&&n!==undefined&&ts(n)}return e.set("_midpoints",undefined,!0),t},e.updateOlTooltipsAtMidpoints=rs,e.getOlTooltipsAtMidpoints=os,e.updateOlGeometryCenter=ns,e.updateOlTooltipAtCenter=is,e.getOlTooltipAtCenter=as,e.getTooltipsOfOlGeometry=ss,e.createOlTooltipAtPoint=ls,e.MeasurerComponent=Rs,e.MeasureFormatPipe=Bs,e.MetadataService=_e,e.MetadataButtonComponent=Ne,e.Overlay=sn,e.OverlayDirective=Xr,e.OverlayService=Qr,e.OverlayAction=Zr,e.createOverlayLayer=to,e.createOverlayDefaultStyle=ro,e.createOverlayMarkerStyle=oo,e.PrintService=zu,e.PrintIonicService=_d,e.PrintOutputFormat=Zu,e.PrintPaperFormat=Qu,e.PrintOrientation=Ju,e.PrintResolution=Xu,e.PrintSaveImageFormat=ec,e.PrintComponent=Hu,e.PrintFormComponent=tc,e.QueryService=bi,e.QueryDirective=wi,e.QueryFormat=Rt,e.QueryFormatMimeType=At,e.QueryHtmlTarget=Bt,e.layerIsQueryable=ao,e.olLayerIsQueryable=so,e.QuerySearchSource=Ci,e.DirectionsService=Sc,e.DirectionsFormat=Pd,e.SourceDirectionsType=Dd,e.DirectionsSource=mc,e.OsrmDirectionsSource=jd,e.stopMarker=Cc,e.DirectionsFormComponent=Fc,e.DirectionsFormBindingDirective=Tc,e.DirectionsFormService=Ic,e.SEARCH_TYPES=sp,e.pointerPositionSummaryMarker=jp,e.SearchPointerSummaryDirective=kp,e.SearchService=gc,e.SearchSourceService=uc,e.sourceCanSearch=pc,e.sourceCanReverseSearch=dc,e.sourceCanReverseSearchAsSummary=hc,e.featureToSearchResult=function sh(e,t){return e.sourceId=t.getId(),{source:t,data:e,meta:{dataType:ur,id:e.meta.id,title:e.meta.title,icon:e.meta.icon||"map-marker"}}},e.CadastreSearchSource=fd,e.SearchSource=Oi,e.IChercheSearchResultFormatter=jc,e.IChercheSearchSource=Rc,e.IChercheReverseSearchSource=Gc,e.ILayerSearchResultFormatter=Xc,e.ILayerSearchSource=rp,e.NominatimSearchSource=bd,e.StoredQueriesSearchSource=Od,e.StoredQueriesReverseSearchSource=Cd,e.CoordinatesSearchResultFormatter=Wc,e.CoordinatesReverseSearchSource=Hc,e.ToastComponent=Rp,e.GoogleLinks=Li,e.generateIdFromSourceOptions=tt,e.generateWMSIdFromSourceOptions=rt,e.generateWMTSIdFromSourceOptions=ot,e.generateXYZIdFromSourceOptions=nt,e.generateFeatureIdFromSourceOptions=it,e.generateId=at,e.OsmLinks=Pi,e.WktService=rl,e.ɵw=Bi,e.ɵx=Ri,e.ɵv=Ei,e.ɵz=Hi,e.ɵy=zi,e.ɵf=zn,e.ɵp=Yn,e.ɵs=et,e.ɵr=jt,e.ɵeo=Jn,e.ɵq=Hn,e.ɵdn=Tc,e.ɵdh=Fc,e.ɵdm=Ic,e.ɵdj=mc,e.ɵew=jd,e.ɵdi=Sc,e.ɵba=ga,e.ɵbb=da,e.ɵbc=va,e.ɵbd=nn,e.ɵbp=gl,e.ɵbn=nl,e.ɵbq=ml,e.ɵbs=al,e.ɵbt=ll,e.ɵbv=dl,e.ɵbu=cl,e.ɵbg=ra,e.ɵbr=aa,e.ɵby=ca,e.ɵbk=na,e.ɵbz=Il,e.ɵbx=Sl,e.ɵbw=vl,e.ɵbh=zs,e.ɵbi=Hs,e.ɵbj=Zs,e.ɵbm=el,e.ɵbl=Js,e.ɵbf=_s,e.ɵbe=La,e.ɵch=Cl,e.ɵcc=Iu,e.ɵcf=xu,e.ɵce=ql,e.ɵcd=vu,e.ɵca=ku,e.ɵcb=Su,e.ɵc=lo,e.ɵd=ho,e.ɵl=_i,e.ɵi=fo,e.ɵe=co,e.ɵh=Fo,e.ɵu=Co,e.ɵj=Io,e.ɵg=vo,e.ɵn=ei,e.ɵo=no,e.ɵm=Lo,e.ɵcm=En,e.ɵcl=$n,e.ɵcn=An,e.ɵcj=Pn,e.ɵcg=Hr,e.ɵcp=Dn,e.ɵck=Gn,e.ɵcr=Fn,e.ɵcq=In,e.ɵk=So,e.ɵco=Sn,e.ɵt=Cn,e.ɵci=Ln,e.ɵcs=Bs,e.ɵcv=Es,e.ɵct=Au,e.ɵcu=Rs,e.ɵa=Ne,e.ɵb=_e,e.ɵcx=Xr,e.ɵcy=Qr,e.ɵdb=tc,e.ɵcz=Hu,e.ɵda=zu,e.ɵdg=Ci,e.ɵdc=wi,e.ɵdd=bi,e.ɵds=vp,e.ɵdu=Tp,e.ɵdv=xp,e.ɵdt=Op,e.ɵdp=lp,e.ɵdo=cp,e.ɵdr=dp,e.ɵdq=gp,e.ɵdw=kp,e.ɵdy=Dc,e.ɵdx=kc,e.ɵdl=uc,e.ɵdk=gc,e.ɵeq=fd,e.ɵed=Hc,e.ɵec=Wc,e.ɵeb=Gc,e.ɵdz=jc,e.ɵea=Rc,e.ɵee=Xc,e.ɵef=rp,e.ɵet=bd,e.ɵde=Oi,e.ɵev=Cd,e.ɵeu=Od,e.ɵeg=Rp,e.ɵbo=rl,e.ɵei=Zp,e.ɵej=td,e.ɵek=_p,e.ɵel=Np,e.ɵem=Vp,e.ɵen=Up,e.ɵeh=od,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=igo2-geo.umd.min.js.map