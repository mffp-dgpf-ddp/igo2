/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import * as olproj from 'ol/proj';
import olWKT from 'ol/format/WKT';
import * as i0 from "@angular/core";
export class WktService {
    constructor() { }
    /**
     * @param {?} wkt
     * @param {?} wktProj
     * @param {?} featureProj
     * @return {?}
     */
    wktToFeature(wkt, wktProj, featureProj) {
        return new olWKT().readFeature(wkt, {
            dataProjection: wktProj,
            featureProjection: featureProj
        });
    }
    /**
     * @param {?} epsgTO
     * @param {?} extent
     * @param {?} extentProj
     * @return {?}
     */
    extentToWkt(epsgTO, extent, extentProj) {
        /** @type {?} */
        let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);
        currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);
        /** @type {?} */
        const wktPoly = `POLYGON((
      ${extent[0]} ${extent[1]},
      ${extent[0]} ${extent[3]},
      ${extent[2]} ${extent[3]},
      ${extent[2]} ${extent[1]},
      ${extent[0]} ${extent[1]}))`;
        /** @type {?} */
        const wktLine = `LINESTRING(
      ${extent[0]} ${extent[1]},
      ${extent[0]} ${extent[3]},
      ${extent[2]} ${extent[3]},
      ${extent[2]} ${extent[1]},
      ${extent[0]} ${extent[1]})`;
        /** @type {?} */
        const wktMultiPoints = `MULTIPOINT(
        ${extent[0]} ${extent[1]},
        ${extent[0]} ${extent[3]},
        ${extent[2]} ${extent[3]},
        ${extent[2]} ${extent[1]})`;
        return {
            wktPoly,
            wktLine,
            wktMultiPoints
        };
    }
    /**
     * @private
     * @param {?} coordinateArray
     * @param {?} projection
     * @param {?=} decimal
     * @return {?}
     */
    roundCoordinateArray(coordinateArray, projection, decimal = 0) {
        /** @type {?} */
        const lproj = olproj.get(projection);
        /** @type {?} */
        const units = lproj.getUnits();
        /** @type {?} */
        const olUnits = ['ft', 'm', 'us-ft'];
        if (olUnits.indexOf(units) !== -1) {
            coordinateArray = this.roundArray(coordinateArray, decimal);
        }
        return coordinateArray;
    }
    /**
     * @private
     * @param {?} array
     * @param {?=} decimal
     * @return {?}
     */
    roundArray(array, decimal = 0) {
        /** @type {?} */
        let x = 0;
        while (x < array.length) {
            array[x] = array[x].toFixed(decimal);
            x++;
        }
        return array;
    }
    /**
     * @param {?} snrc
     * @param {?} epsgTO
     * @return {?}
     */
    snrcToWkt(snrc, epsgTO) {
        snrc = snrc.toLowerCase();
        /** @type {?} */
        let wktPoly;
        /** @type {?} */
        const ew = {
            1: { from: -56, to: -64 },
            2: { from: -64, to: -72 },
            3: { from: -72, to: -80 },
            4: { from: -80, to: -88 },
            5: { from: -88, to: -96 },
            6: { from: -96, to: -104 },
            7: { from: -104, to: -112 },
            8: { from: -112, to: -120 },
            9: { from: -120, to: -128 },
            10: { from: -128, to: -136 }
        };
        /** @type {?} */
        const sn = {
            1: { from: 44, to: 48 },
            2: { from: 48, to: 52 },
            3: { from: 52, to: 56 },
            4: { from: 56, to: 60 },
            5: { from: 60, to: 64 },
            6: { from: 64, to: 68 },
            7: { from: 68, to: 72 },
            8: { from: 72, to: 76 },
            9: { from: 76, to: -128 }
        };
        /** @type {?} */
        const snrc250kIndex = [
            ['m', 'n', 'o', 'p'],
            ['l', 'k', 'j', 'i'],
            ['e', 'f', 'g', 'h'],
            ['d', 'c', 'b', 'a']
        ];
        /** @type {?} */
        const snrc50kIndex = [
            ['13', '14', '15', '16'],
            ['12', '11', '10', '09'],
            ['05', '06', '07', '08'],
            ['04', '03', '02', '01']
        ];
        /** @type {?} */
        const checkSNRC50k = /\d{2,3}[a-p][0,1][0-9]/gi;
        /** @type {?} */
        const checkSNRC250k = /\d{2,3}[a-p]/gi;
        /** @type {?} */
        const checkSNRC1m = /\d{2,3}/gi;
        /** @type {?} */
        let snrc1m = false;
        /** @type {?} */
        let snrc250k = false;
        /** @type {?} */
        let snrc50k = false;
        if (checkSNRC50k.test(snrc)) {
            snrc50k = true;
        }
        else {
            if (checkSNRC250k.test(snrc)) {
                snrc250k = true;
            }
            else {
                if (checkSNRC1m.test(snrc)) {
                    snrc1m = true;
                }
            }
        }
        if (snrc1m) {
            snrc += 'a01';
        }
        else if (snrc250k) {
            snrc += '01';
        }
        if (/\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {
            /** @type {?} */
            const regex1m = /(?=[a-p])/gi;
            /** @type {?} */
            const ar1m = snrc.split(regex1m);
            /** @type {?} */
            const part1m = ar1m[0];
            /** @type {?} */
            const part250k = ar1m[1][0];
            /** @type {?} */
            const part50k = ar1m[1].split(part250k)[1];
            /** @type {?} */
            let separator = 1;
            if (part1m.length === 3) {
                separator = 2;
            }
            /** @type {?} */
            const partEW = part1m.substring(0, separator);
            /** @type {?} */
            const partSN = part1m.substring(separator);
            /** @type {?} */
            const unit1mEW = 8;
            /** @type {?} */
            const unit1mSN = 4;
            /** @type {?} */
            const unit250kEW = 2;
            /** @type {?} */
            const unit250kSN = 1;
            /** @type {?} */
            const unit50kEW = 0.5;
            /** @type {?} */
            const unit50kSN = 0.25;
            /** @type {?} */
            let index250kEW = 0;
            /** @type {?} */
            let index250kSN = 0;
            /** @type {?} */
            let index50kEW = 0;
            /** @type {?} */
            let index50kSN = 0;
            snrc250kIndex.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                if (element.indexOf(part250k) !== -1) {
                    index250kSN = snrc250kIndex.indexOf(element);
                    index250kEW = element.indexOf(part250k);
                }
            }));
            snrc50kIndex.forEach((/**
             * @param {?} element
             * @return {?}
             */
            element => {
                if (element.indexOf(part50k) !== -1) {
                    index50kSN = snrc50kIndex.indexOf(element);
                    index50kEW = element.indexOf(part50k);
                }
            }));
            /** @type {?} */
            let increment250kEW = 0;
            /** @type {?} */
            let increment250kSN = 0;
            /** @type {?} */
            let increment50kEW = 0;
            /** @type {?} */
            let increment50kSN = 0;
            /** @type {?} */
            let unitPerTypeEW = unit1mEW;
            /** @type {?} */
            let unitPerTypeSN = unit1mSN;
            if (snrc250k) {
                increment250kEW = index250kEW * unit250kEW;
                increment250kSN = index250kSN * unit250kSN;
                increment50kEW = 0;
                increment50kSN = 0;
                unitPerTypeEW = unit250kEW;
                unitPerTypeSN = unit250kSN;
            }
            else if (snrc50k) {
                increment250kEW = index250kEW * unit250kEW;
                increment250kSN = index250kSN * unit250kSN;
                increment50kEW = index50kEW * unit50kEW;
                increment50kSN = index50kSN * unit50kSN;
                unitPerTypeEW = unit50kEW;
                unitPerTypeSN = unit50kSN;
            }
            /** @type {?} */
            const coord = {
                ul: [
                    ew[partEW].to + increment250kEW + increment50kEW,
                    sn[partSN].to - increment250kSN - increment50kSN
                ]
            };
            coord.lr = [
                coord.ul[0] + unitPerTypeEW,
                coord.ul[1] - unitPerTypeSN
            ];
            coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];
            coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];
            coord.ul = olproj.transform([coord.ul[0], coord.ul[1]], 'EPSG:4326', epsgTO);
            coord.lr = olproj.transform([coord.lr[0], coord.lr[1]], 'EPSG:4326', epsgTO);
            coord.ur = olproj.transform([coord.ur[0], coord.ur[1]], 'EPSG:4326', epsgTO);
            coord.ll = olproj.transform([coord.ll[0], coord.ll[1]], 'EPSG:4326', epsgTO);
            // Rounded coordinate to shorten url in get
            coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);
            coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);
            coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);
            coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);
            wktPoly =
                'POLYGON((' +
                    [
                        coord.ul.join(' '),
                        coord.ur.join(' '),
                        coord.lr.join(' '),
                        coord.ll.join(' '),
                        coord.ul.join(' ')
                    ].join(',') +
                    '))';
            /** @type {?} */
            const wktLine = 'LINESTRING(' +
                [
                    coord.ul.join(' '),
                    coord.ur.join(' '),
                    coord.lr.join(' '),
                    coord.ll.join(' '),
                    coord.ul.join(' ')
                ].join(',') +
                ')';
            /** @type {?} */
            const wktMultiPoints = 'MULTIPOINT(' +
                [
                    coord.ul.join(' '),
                    coord.ur.join(' '),
                    coord.lr.join(' '),
                    coord.ll.join(' ')
                ].join(',') +
                ')';
            return {
                wktPoly,
                wktLine,
                wktMultiPoints
            };
        }
    }
}
WktService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
WktService.ctorParameters = () => [];
/** @nocollapse */ WktService.ngInjectableDef = i0.defineInjectable({ factory: function WktService_Factory() { return new WktService(); }, token: WktService, providedIn: "root" });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2t0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AaWdvMi9nZW8vIiwic291cmNlcyI6WyJsaWIvd2t0L3NoYXJlZC93a3Quc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEtBQUssTUFBTSxNQUFNLFNBQVMsQ0FBQztBQUNsQyxPQUFPLEtBQUssTUFBTSxlQUFlLENBQUM7O0FBS2xDLE1BQU0sT0FBTyxVQUFVO0lBQ3JCLGdCQUFlLENBQUM7Ozs7Ozs7SUFFVCxZQUFZLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxXQUFXO1FBQzNDLE9BQU8sSUFBSSxLQUFLLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFO1lBQ2xDLGNBQWMsRUFBRSxPQUFPO1lBQ3ZCLGlCQUFpQixFQUFFLFdBQVc7U0FDL0IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7OztJQUNNLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFVBQVU7O1lBQ3ZDLGFBQWEsR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxDQUFDO1FBQ3RFLGFBQWEsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsYUFBYSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQzs7Y0FDOUQsT0FBTyxHQUFHO1FBQ1osTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSTs7Y0FDeEIsT0FBTyxHQUFHO1FBQ1osTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRzs7Y0FDdkIsY0FBYyxHQUFHO1VBQ2pCLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO1VBQ3RCLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO1VBQ3RCLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO1VBQ3RCLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUc7UUFDL0IsT0FBTztZQUNMLE9BQU87WUFDUCxPQUFPO1lBQ1AsY0FBYztTQUNmLENBQUM7SUFDSixDQUFDOzs7Ozs7OztJQUVPLG9CQUFvQixDQUFDLGVBQWUsRUFBRSxVQUFVLEVBQUUsT0FBTyxHQUFHLENBQUM7O2NBQzdELEtBQUssR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQzs7Y0FDOUIsS0FBSyxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUU7O2NBQ3hCLE9BQU8sR0FBRyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDO1FBQ3BDLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNqQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDN0Q7UUFDRCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDOzs7Ozs7O0lBRU8sVUFBVSxDQUFDLEtBQUssRUFBRSxPQUFPLEdBQUcsQ0FBQzs7WUFDL0IsQ0FBQyxHQUFHLENBQUM7UUFDVCxPQUFPLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFO1lBQ3ZCLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JDLENBQUMsRUFBRSxDQUFDO1NBQ0w7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7Ozs7OztJQUVNLFNBQVMsQ0FBQyxJQUFJLEVBQUUsTUFBTTtRQUMzQixJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDOztZQUN0QixPQUFPOztjQUNMLEVBQUUsR0FBRztZQUNULENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDekIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN6QixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3pCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDekIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN6QixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFO1lBQzFCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUU7WUFDM0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRTtZQUMzQixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFO1lBQzNCLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUU7U0FDN0I7O2NBQ0ssRUFBRSxHQUFHO1lBQ1QsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQ3ZCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUN2QixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7WUFDdkIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQ3ZCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUN2QixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7WUFDdkIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQ3ZCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUN2QixDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRTtTQUMxQjs7Y0FDSyxhQUFhLEdBQUc7WUFDcEIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7WUFDcEIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7WUFDcEIsQ0FBQyxH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QUFDLEdBQUcsQ0FBQztvQkFDbEIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO29CQUNsQixLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7b0JBQ2xCLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztpQkFDbkIsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO2dCQUNYLEdBQUc7O2tCQUVDLGNBQWMsR0FDbEIsYUFBYTtnQkFDYjtvQkFDRSxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7b0JBQ2xCLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztvQkFDbEIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO29CQUNsQixLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7aUJBQ25CLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztnQkFDWCxHQUFHO1lBQ0wsT0FBTztnQkFDTCxPQUFPO2dCQUNQLE9BQU87Z0JBQ1AsY0FBYzthQUNmLENBQUM7U0FDSDtJQUNILENBQUM7OztZQWhRRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgKiBhcyBvbHByb2ogZnJvbSAnb2wvcHJvaic7XHJcbmltcG9ydCBvbFdLVCBmcm9tICdvbC9mb3JtYXQvV0tUJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCdcclxufSlcclxuZXhwb3J0IGNsYXNzIFdrdFNlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgcHVibGljIHdrdFRvRmVhdHVyZSh3a3QsIHdrdFByb2osIGZlYXR1cmVQcm9qKSB7XHJcbiAgICByZXR1cm4gbmV3IG9sV0tUKCkucmVhZEZlYXR1cmUod2t0LCB7XHJcbiAgICAgIGRhdGFQcm9qZWN0aW9uOiB3a3RQcm9qLFxyXG4gICAgICBmZWF0dXJlUHJvamVjdGlvbjogZmVhdHVyZVByb2pcclxuICAgIH0pO1xyXG4gIH1cclxuICBwdWJsaWMgZXh0ZW50VG9Xa3QoZXBzZ1RPLCBleHRlbnQsIGV4dGVudFByb2opIHtcclxuICAgIGxldCBjdXJyZW50RXh0ZW50ID0gb2xwcm9qLnRyYW5zZm9ybUV4dGVudChleHRlbnQsIGV4dGVudFByb2osIGVwc2dUTyk7XHJcbiAgICBjdXJyZW50RXh0ZW50ID0gdGhpcy5yb3VuZENvb3JkaW5hdGVBcnJheShjdXJyZW50RXh0ZW50LCBlcHNnVE8sIDApO1xyXG4gICAgY29uc3Qgd2t0UG9seSA9IGBQT0xZR09OKChcclxuICAgICAgJHtleHRlbnRbMF19ICR7ZXh0ZW50WzFdfSxcclxuICAgICAgJHtleHRlbnRbMF19ICR7ZXh0ZW50WzNdfSxcclxuICAgICAgJHtleHRlbnRbMl19ICR7ZXh0ZW50WzNdfSxcclxuICAgICAgJHtleHRlbnRbMl19ICR7ZXh0ZW50WzFdfSxcclxuICAgICAgJHtleHRlbnRbMF19ICR7ZXh0ZW50WzFdfSkpYDtcclxuICAgIGNvbnN0IHdrdExpbmUgPSBgTElORVNUUklORyhcclxuICAgICAgJHtleHRlbnRbMF19ICR7ZXh0ZW50WzFdfSxcclxuICAgICAgJHtleHRlbnRbMF19ICR7ZXh0ZW50WzNdfSxcclxuICAgICAgJHtleHRlbnRbMl19ICR7ZXh0ZW50WzNdfSxcclxuICAgICAgJHtleHRlbnRbMl19ICR7ZXh0ZW50WzFdfSxcclxuICAgICAgJHtleHRlbnRbMF19ICR7ZXh0ZW50WzFdfSlgO1xyXG4gICAgY29uc3Qgd2t0TXVsdGlQb2ludHMgPSBgTVVMVElQT0lOVChcclxuICAgICAgICAke2V4dGVudFswXX0gJHtleHRlbnRbMV19LFxyXG4gICAgICAgICR7ZXh0ZW50WzBdfSAke2V4dGVudFszXX0sXHJcbiAgICAgICAgJHtleHRlbnRbMl19ICR7ZXh0ZW50WzNdfSxcclxuICAgICAgICAke2V4dGVudFsyXX0gJHtleHRlbnRbMV19KWA7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB3a3RQb2x5LFxyXG4gICAgICB3a3RMaW5lLFxyXG4gICAgICB3a3RNdWx0aVBvaW50c1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcm91bmRDb29yZGluYXRlQXJyYXkoY29vcmRpbmF0ZUFycmF5LCBwcm9qZWN0aW9uLCBkZWNpbWFsID0gMCkge1xyXG4gICAgY29uc3QgbHByb2ogPSBvbHByb2ouZ2V0KHByb2plY3Rpb24pO1xyXG4gICAgY29uc3QgdW5pdHMgPSBscHJvai5nZXRVbml0cygpO1xyXG4gICAgY29uc3Qgb2xVbml0cyA9IFsnZnQnLCAnbScsICd1cy1mdCddO1xyXG4gICAgaWYgKG9sVW5pdHMuaW5kZXhPZih1bml0cykgIT09IC0xKSB7XHJcbiAgICAgIGNvb3JkaW5hdGVBcnJheSA9IHRoaXMucm91bmRBcnJheShjb29yZGluYXRlQXJyYXksIGRlY2ltYWwpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVBcnJheTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcm91bmRBcnJheShhcnJheSwgZGVjaW1hbCA9IDApIHtcclxuICAgIGxldCB4ID0gMDtcclxuICAgIHdoaWxlICh4IDwgYXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgIGFycmF5W3hdID0gYXJyYXlbeF0udG9GaXhlZChkZWNpbWFsKTtcclxuICAgICAgeCsrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNucmNUb1drdChzbnJjLCBlcHNnVE8pIHtcclxuICAgIHNucmMgPSBzbnJjLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBsZXQgd2t0UG9seTtcclxuICAgIGNvbnN0IGV3ID0ge1xyXG4gICAgICAxOiB7IGZyb206IC01NiwgdG86IC02NCB9LFxyXG4gICAgICAyOiB7IGZyb206IC02NCwgdG86IC03MiB9LFxyXG4gICAgICAzOiB7IGZyb206IC03MiwgdG86IC04MCB9LFxyXG4gICAgICA0OiB7IGZyb206IC04MCwgdG86IC04OCB9LFxyXG4gICAgICA1OiB7IGZyb206IC04OCwgdG86IC05NiB9LFxyXG4gICAgICA2OiB7IGZyb206IC05NiwgdG86IC0xMDQgfSxcclxuICAgICAgNzogeyBmcm9tOiAtMTA0LCB0bzogLTExMiB9LFxyXG4gICAgICA4OiB7IGZyb206IC0xMTIsIHRvOiAtMTIwIH0sXHJcbiAgICAgIDk6IHsgZnJvbTogLTEyMCwgdG86IC0xMjggfSxcclxuICAgICAgMTA6IHsgZnJvbTogLTEyOCwgdG86IC0xMzYgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHNuID0ge1xyXG4gICAgICAxOiB7IGZyb206IDQ0LCB0bzogNDggfSxcclxuICAgICAgMjogeyBmcm9tOiA0OCwgdG86IDUyIH0sXHJcbiAgICAgIDM6IHsgZnJvbTogNTIsIHRvOiA1NiB9LFxyXG4gICAgICA0OiB7IGZyb206IDU2LCB0bzogNjAgfSxcclxuICAgICAgNTogeyBmcm9tOiA2MCwgdG86IDY0IH0sXHJcbiAgICAgIDY6IHsgZnJvbTogNjQsIHRvOiA2OCB9LFxyXG4gICAgICA3OiB7IGZyb206IDY4LCB0bzogNzIgfSxcclxuICAgICAgODogeyBmcm9tOiA3MiwgdG86IDc2IH0sXHJcbiAgICAgIDk6IHsgZnJvbTogNzYsIHRvOiAtMTI4IH1cclxuICAgIH07XHJcbiAgICBjb25zdCBzbnJjMjUwa0luZGV4ID0gW1xyXG4gICAgICBbJ20nLCAnbicsICdvJywgJ3AnXSxcclxuICAgICAgWydsJywgJ2snLCAnaicsICdpJ10sXHJcbiAgICAgIFsnZScsICdmJywgJ2cnLCAnaCddLFxyXG4gICAgICBbJ2QnLCAnYycsICdiJywgJ2EnXVxyXG4gICAgXTtcclxuXHJcbiAgICBjb25zdCBzbnJjNTBrSW5kZXggPSBbXHJcbiAgICAgIFsnMTMnLCAnMTQnLCAnMTUnLCAnMTYnXSxcclxuICAgICAgWycxMicsICcxMScsICcxMCcsICcwOSddLFxyXG4gICAgICBbJzA1JywgJzA2JywgJzA3JywgJzA4J10sXHJcbiAgICAgIFsnMDQnLCAnMDMnLCAnMDInLCAnMDEnXVxyXG4gICAgXTtcclxuICAgIGNvbnN0IGNoZWNrU05SQzUwayA9IC9cXGR7MiwzfVthLXBdWzAsMV1bMC05XS9naTtcclxuICAgIGNvbnN0IGNoZWNrU05SQzI1MGsgPSAvXFxkezIsM31bYS1wXS9naTtcclxuICAgIGNvbnN0IGNoZWNrU05SQzFtID0gL1xcZHsyLDN9L2dpO1xyXG5cclxuICAgIGxldCBzbnJjMW0gPSBmYWxzZTtcclxuICAgIGxldCBzbnJjMjUwayA9IGZhbHNlO1xyXG4gICAgbGV0IHNucmM1MGsgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAoY2hlY2tTTlJDNTBrLnRlc3Qoc25yYykpIHtcclxuICAgICAgc25yYzUwayA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoY2hlY2tTTlJDMjUway50ZXN0KHNucmMpKSB7XHJcbiAgICAgICAgc25yYzI1MGsgPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChjaGVja1NOUkMxbS50ZXN0KHNucmMpKSB7XHJcbiAgICAgICAgICBzbnJjMW0gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChzbnJjMW0pIHtcclxuICAgICAgc25yYyArPSAnYTAxJztcclxuICAgIH0gZWxzZSBpZiAoc25yYzI1MGspIHtcclxuICAgICAgc25yYyArPSAnMDEnO1xyXG4gICAgfVxyXG4gICAgaWYgKC9cXGR7MiwzfVthLXBdWzAsMV1bMC05XS9naS50ZXN0KHNucmMpKSB7XHJcbiAgICAgIGNvbnN0IHJlZ2V4MW0gPSAvKD89W2EtcF0pL2dpO1xyXG4gICAgICBjb25zdCBhcjFtID0gc25yYy5zcGxpdChyZWdleDFtKTtcclxuICAgICAgY29uc3QgcGFydDFtID0gYXIxbVswXTtcclxuICAgICAgY29uc3QgcGFydDI1MGsgPSBhcjFtWzFdWzBdO1xyXG4gICAgICBjb25zdCBwYXJ0NTBrID0gYXIxbVsxXS5zcGxpdChwYXJ0MjUwaylbMV07XHJcbiAgICAgIGxldCBzZXBhcmF0b3IgPSAxO1xyXG4gICAgICBpZiAocGFydDFtLmxlbmd0aCA9PT0gMykge1xyXG4gICAgICAgIHNlcGFyYXRvciA9IDI7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcGFydEVXID0gcGFydDFtLnN1YnN0cmluZygwLCBzZXBhcmF0b3IpO1xyXG4gICAgICBjb25zdCBwYXJ0U04gPSBwYXJ0MW0uc3Vic3RyaW5nKHNlcGFyYXRvcik7XHJcbiAgICAgIGNvbnN0IHVuaXQxbUVXID0gODtcclxuICAgICAgY29uc3QgdW5pdDFtU04gPSA0O1xyXG4gICAgICBjb25zdCB1bml0MjUwa0VXID0gMjtcclxuICAgICAgY29uc3QgdW5pdDI1MGtTTiA9IDE7XHJcbiAgICAgIGNvbnN0IHVuaXQ1MGtFVyA9IDAuNTtcclxuICAgICAgY29uc3QgdW5pdDUwa1NOID0gMC4yNTtcclxuICAgICAgbGV0IGluZGV4MjUwa0VXID0gMDtcclxuICAgICAgbGV0IGluZGV4MjUwa1NOID0gMDtcclxuICAgICAgbGV0IGluZGV4NTBrRVcgPSAwO1xyXG4gICAgICBsZXQgaW5kZXg1MGtTTiA9IDA7XHJcbiAgICAgIHNucmMyNTBrSW5kZXguZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgICAgICBpZiAoZWxlbWVudC5pbmRleE9mKHBhcnQyNTBrKSAhPT0gLTEpIHtcclxuICAgICAgICAgIGluZGV4MjUwa1NOID0gc25yYzI1MGtJbmRleC5pbmRleE9mKGVsZW1lbnQpO1xyXG4gICAgICAgICAgaW5kZXgyNTBrRVcgPSBlbGVtZW50LmluZGV4T2YocGFydDI1MGspO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHNucmM1MGtJbmRleC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xyXG4gICAgICAgIGlmIChlbGVtZW50LmluZGV4T2YocGFydDUwaykgIT09IC0xKSB7XHJcbiAgICAgICAgICBpbmRleDUwa1NOID0gc25yYzUwa0luZGV4LmluZGV4T2YoZWxlbWVudCk7XHJcbiAgICAgICAgICBpbmRleDUwa0VXID0gZWxlbWVudC5pbmRleE9mKHBhcnQ1MGspO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBsZXQgaW5jcmVtZW50MjUwa0VXID0gMDtcclxuICAgICAgbGV0IGluY3JlbWVudDI1MGtTTiA9IDA7XHJcbiAgICAgIGxldCBpbmNyZW1lbnQ1MGtFVyA9IDA7XHJcbiAgICAgIGxldCBpbmNyZW1lbnQ1MGtTTiA9IDA7XHJcbiAgICAgIGxldCB1bml0UGVyVHlwZUVXID0gdW5pdDFtRVc7XHJcbiAgICAgIGxldCB1bml0UGVyVHlwZVNOID0gdW5pdDFtU047XHJcbiAgICAgIGlmIChzbnJjMjUwaykge1xyXG4gICAgICAgIGluY3JlbWVudDI1MGtFVyA9IGluZGV4MjUwa0VXICogdW5pdDI1MGtFVztcclxuICAgICAgICBpbmNyZW1lbnQyNTBrU04gPSBpbmRleDI1MGtTTiAqIHVuaXQyNTBrU047XHJcbiAgICAgICAgaW5jcmVtZW50NTBrRVcgPSAwO1xyXG4gICAgICAgIGluY3JlbWVudDUwa1NOID0gMDtcclxuICAgICAgICB1bml0UGVyVHlwZUVXID0gdW5pdDI1MGtFVztcclxuICAgICAgICB1bml0UGVyVHlwZVNOID0gdW5pdDI1MGtTTjtcclxuICAgICAgfSBlbHNlIGlmIChzbnJjNTBrKSB7XHJcbiAgICAgICAgaW5jcmVtZW50MjUwa0VXID0gaW5kZXgyNTBrRVcgKiB1bml0MjUwa0VXO1xyXG4gICAgICAgIGluY3JlbWVudDI1MGtTTiA9IGluZGV4MjUwa1NOICogdW5pdDI1MGtTTjtcclxuICAgICAgICBpbmNyZW1lbnQ1MGtFVyA9IGluZGV4NTBrRVcgKiB1bml0NTBrRVc7XHJcbiAgICAgICAgaW5jcmVtZW50NTBrU04gPSBpbmRleDUwa1NOICogdW5pdDUwa1NOO1xyXG4gICAgICAgIHVuaXRQZXJUeXBlRVcgPSB1bml0NTBrRVc7XHJcbiAgICAgICAgdW5pdFBlclR5cGVTTiA9IHVuaXQ1MGtTTjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgY29vcmQ6IHt1bD86IGFueSwgbHI/OiBhbnksIHVyPzogYW55LCBsbD86IGFueX0gPSB7XHJcbiAgICAgICAgdWw6IFtcclxuICAgICAgICAgIGV3W3BhcnRFV10udG8gKyBpbmNyZW1lbnQyNTBrRVcgKyBpbmNyZW1lbnQ1MGtFVyxcclxuICAgICAgICAgIHNuW3BhcnRTTl0udG8gLSBpbmNyZW1lbnQyNTBrU04gLSBpbmNyZW1lbnQ1MGtTTlxyXG4gICAgICAgIF1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvb3JkLmxyID0gW1xyXG4gICAgICAgIGNvb3JkLnVsWzBdICsgdW5pdFBlclR5cGVFVyxcclxuICAgICAgICBjb29yZC51bFsxXSAtIHVuaXRQZXJUeXBlU05cclxuICAgICAgXTtcclxuICAgICAgY29vcmQudXIgPSBbY29vcmQudWxbMF0sIGNvb3JkLnVsWzFdIC0gdW5pdFBlclR5cGVTTl07XHJcbiAgICAgIGNvb3JkLmxsID0gW2Nvb3JkLnVsWzBdICsgdW5pdFBlclR5cGVFVywgY29vcmQudWxbMV1dO1xyXG5cclxuICAgICAgY29vcmQudWwgPSBvbHByb2oudHJhbnNmb3JtKFxyXG4gICAgICAgIFtjb29yZC51bFswXSwgY29vcmQudWxbMV1dLFxyXG4gICAgICAgICdFUFNHOjQzMjYnLFxyXG4gICAgICAgIGVwc2dUT1xyXG4gICAgICApO1xyXG4gICAgICBjb29yZC5sciA9IG9scHJvai50cmFuc2Zvcm0oXHJcbiAgICAgICAgW2Nvb3JkLmxyWzBdLCBjb29yZC5sclsxXV0sXHJcbiAgICAgICAgJ0VQU0c6NDMyNicsXHJcbiAgICAgICAgZXBzZ1RPXHJcbiAgICAgICk7XHJcbiAgICAgIGNvb3JkLnVyID0gb2xwcm9qLnRyYW5zZm9ybShcclxuICAgICAgICBbY29vcmQudXJbMF0sIGNvb3JkLnVyWzFdXSxcclxuICAgICAgICAnRVBTRzo0MzI2JyxcclxuICAgICAgICBlcHNnVE9cclxuICAgICAgKTtcclxuICAgICAgY29vcmQubGwgPSBvbHByb2oudHJhbnNmb3JtKFxyXG4gICAgICAgIFtjb29yZC5sbFswXSwgY29vcmQubGxbMV1dLFxyXG4gICAgICAgICdFUFNHOjQzMjYnLFxyXG4gICAgICAgIGVwc2dUT1xyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gUm91bmRlZCBjb29yZGluYXRlIHRvIHNob3J0ZW4gdXJsIGluIGdldFxyXG4gICAgICBjb29yZC51bCA9IHRoaXMucm91bmRDb29yZGluYXRlQXJyYXkoY29vcmQudWwsIGVwc2dUTywgMCk7XHJcbiAgICAgIGNvb3JkLmxyID0gdGhpcy5yb3VuZENvb3JkaW5hdGVBcnJheShjb29yZC5sciwgZXBzZ1RPLCAwKTtcclxuICAgICAgY29vcmQudXIgPSB0aGlzLnJvdW5kQ29vcmRpbmF0ZUFycmF5KGNvb3JkLnVyLCBlcHNnVE8sIDApO1xyXG4gICAgICBjb29yZC5sbCA9IHRoaXMucm91bmRDb29yZGluYXRlQXJyYXkoY29vcmQubGwsIGVwc2dUTywgMCk7XHJcblxyXG4gICAgICB3a3RQb2x5ID1cclxuICAgICAgICAnUE9MWUdPTigoJyArXHJcbiAgICAgICAgW1xyXG4gICAgICAgICAgY29vcmQudWwuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQudXIuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQubHIuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQubGwuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQudWwuam9pbignICcpXHJcbiAgICAgICAgXS5qb2luKCcsJykgK1xyXG4gICAgICAgICcpKSc7XHJcbiAgICAgIGNvbnN0IHdrdExpbmUgPVxyXG4gICAgICAgICdMSU5FU1RSSU5HKCcgK1xyXG4gICAgICAgIFtcclxuICAgICAgICAgIGNvb3JkLnVsLmpvaW4oJyAnKSxcclxuICAgICAgICAgIGNvb3JkLnVyLmpvaW4oJyAnKSxcclxuICAgICAgICAgIGNvb3JkLmxyLmpvaW4oJyAnKSxcclxuICAgICAgICAgIGNvb3JkLmxsLmpvaW4oJyAnKSxcclxuICAgICAgICAgIGNvb3JkLnVsLmpvaW4oJyAnKVxyXG4gICAgICAgIF0uam9pbignLCcpICtcclxuICAgICAgICAnKSc7XHJcblxyXG4gICAgICBjb25zdCB3a3RNdWx0aVBvaW50cyA9XHJcbiAgICAgICAgJ01VTFRJUE9JTlQoJyArXHJcbiAgICAgICAgW1xyXG4gICAgICAgICAgY29vcmQudWwuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQudXIuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQubHIuam9pbignICcpLFxyXG4gICAgICAgICAgY29vcmQubGwuam9pbignICcpXHJcbiAgICAgICAgXS5qb2luKCcsJykgK1xyXG4gICAgICAgICcpJztcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB3a3RQb2x5LFxyXG4gICAgICAgIHdrdExpbmUsXHJcbiAgICAgICAgd2t0TXVsdGlQb2ludHNcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19