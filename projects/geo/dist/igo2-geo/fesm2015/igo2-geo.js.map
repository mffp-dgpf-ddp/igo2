{"version":3,"file":"igo2-geo.js.map","sources":["ng://@igo2/geo/lib/map/shared/map.utils.ts","ng://@igo2/geo/lib/layer/shared/layers/layer.ts","ng://@igo2/geo/lib/metadata/shared/metadata.service.ts","ng://@igo2/geo/lib/metadata/metadata-button/metadata-button.component.ts","ng://@igo2/geo/lib/metadata/metadata.module.ts","ng://@igo2/geo/lib/datasource/shared/datasources/data.service.ts","ng://@igo2/geo/lib/utils/id-generator.ts","ng://@igo2/geo/lib/datasource/shared/datasources/datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/feature-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/osm-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/xyz-datasource.ts","ng://@igo2/geo/lib/filter/shared/ogc-filter.ts","ng://@igo2/geo/lib/datasource/shared/datasources/wms-wfs.utils.ts","ng://@igo2/geo/lib/datasource/shared/datasources/wfs-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/wfs.service.ts","ng://@igo2/geo/lib/query/shared/query.enums.ts","ng://@igo2/geo/lib/datasource/shared/datasources/wms-datasource.ts","ng://@igo2/geo/lib/datasource/utils/tilegrid.ts","ng://@igo2/geo/lib/datasource/shared/datasources/wmts-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/carto-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/arcgisrest-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/websocket-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/mvt-datasource.ts","ng://@igo2/geo/lib/datasource/shared/datasources/cluster-datasource.ts","ng://@igo2/geo/lib/feature/shared/feature.enums.ts","ng://@igo2/geo/lib/layer/shared/layer.enums.ts","ng://@igo2/geo/lib/layer/shared/layers/layer.interface.ts","ng://@igo2/geo/lib/layer/utils/image-watcher.ts","ng://@igo2/geo/lib/layer/utils/tile-watcher.ts","ng://@igo2/geo/lib/layer/utils/outputLegend.ts","ng://@igo2/geo/lib/layer/utils/vector-watcher.ts","ng://@igo2/geo/lib/layer/shared/layers/image-layer.ts","ng://@igo2/geo/lib/layer/shared/layers/tile-layer.ts","ng://@igo2/geo/lib/layer/shared/layers/vector-layer.ts","ng://@igo2/geo/lib/layer/shared/layers/vectortile-layer.ts","ng://@igo2/geo/lib/map/map-browser/map-browser.component.ts","ng://@igo2/geo/lib/overlay/shared/overlay.enum.ts","ng://@igo2/geo/lib/overlay/shared/overlay.service.ts","ng://@igo2/geo/lib/overlay/shared/overlay.directive.ts","ng://@igo2/geo/lib/overlay/shared/overlay.utils.ts","ng://@igo2/geo/lib/layer/shared/style.service.ts","ng://@igo2/geo/lib/query/shared/query.utils.ts","ng://@igo2/geo/lib/layer/layer-item/layer-item.component.ts","ng://@igo2/geo/lib/layer/layer-legend/layer-legend.component.ts","ng://@igo2/geo/lib/layer/layer-legend-item/layer-legend-item.component.ts","ng://@igo2/geo/lib/layer/layer-legend-list/layer-legend-list.component.ts","ng://@igo2/geo/lib/layer/layer-list/layer-list.enum.ts","ng://@igo2/geo/lib/layer/layer-list/layer-list.component.ts","ng://@igo2/geo/lib/map/shared/map.service.ts","ng://@igo2/geo/lib/layer/layer-list/layer-list-binding.directive.ts","ng://@igo2/geo/lib/layer/layer-list-tool/layer-list-tool.component.ts","ng://@igo2/geo/lib/layer/layer-list-tool/layer-list-tool.enum.ts","ng://@igo2/geo/lib/layer/layer-list-tool/layer-list-tool.service.ts","ng://@igo2/geo/lib/layer/track-feature-button/track-feature-button.component.ts","ng://@igo2/geo/lib/feature/shared/strategies/loading.ts","ng://@igo2/geo/lib/feature/shared/strategies/loading-layer.ts","ng://@igo2/geo/lib/feature/shared/store.ts","ng://@igo2/geo/lib/feature/shared/strategies/selection.ts","ng://@igo2/geo/lib/feature/shared/feature.utils.ts","ng://@igo2/geo/lib/feature/feature-form/feature-form.component.ts","ng://@igo2/geo/lib/overlay/shared/overlay.ts","ng://@igo2/geo/lib/map/utils/layer-watcher.ts","ng://@igo2/geo/lib/map/shared/map.enums.ts","ng://@igo2/geo/lib/map/shared/controllers/controller.ts","ng://@igo2/geo/lib/map/shared/controllers/view.ts","ng://@igo2/geo/lib/map/shared/map.ts","ng://@igo2/geo/lib/map/shared/mapOffline.directive.ts","ng://@igo2/geo/lib/map/shared/map-pointer-position.directive.ts","ng://@igo2/geo/lib/map/shared/map-pointer-position-by-key.directive.ts","ng://@igo2/geo/lib/map/shared/projection.service.ts","ng://@igo2/geo/lib/map/zoom-button/zoom-button.component.ts","ng://@igo2/geo/lib/map/geolocate-button/geolocate-button.component.ts","ng://@igo2/geo/lib/map/offline-button/offline-button.component.ts","ng://@igo2/geo/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","ng://@igo2/geo/lib/map/baselayers-switcher/baselayers-switcher.component.ts","ng://@igo2/geo/lib/map/baselayers-switcher/mini-basemap.component.ts","ng://@igo2/geo/lib/map/rotation-button/rotation-button.component.ts","ng://@igo2/geo/lib/datasource/utils/esri-style-generator.ts","ng://@igo2/geo/lib/filter/shared/time-filter.enum.ts","ng://@igo2/geo/lib/datasource/shared/capabilities.service.ts","ng://@igo2/geo/lib/datasource/shared/options/options.service.ts","ng://@igo2/geo/lib/datasource/shared/datasource.service.ts","ng://@igo2/geo/lib/datasource/shared/options/options-api.service.ts","ng://@igo2/geo/lib/layer/shared/layer.service.ts","ng://@igo2/geo/lib/catalog/shared/catalog.enum.ts","ng://@igo2/geo/lib/catalog/shared/catalog.abstract.ts","ng://@igo2/geo/lib/query/shared/query.service.ts","ng://@igo2/geo/lib/query/shared/query.directive.ts","ng://@igo2/geo/lib/search/shared/sources/source.ts","ng://@igo2/geo/lib/query/shared/query-search-source.ts","ng://@igo2/geo/lib/utils/googleLinks.ts","ng://@igo2/geo/lib/utils/osmLinks.ts","ng://@igo2/geo/lib/catalog/shared/catalog.service.ts","ng://@igo2/geo/lib/catalog/catalog-browser/catalog-browser.component.ts","ng://@igo2/geo/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","ng://@igo2/geo/lib/catalog/catalog-browser/catalog-browser-group.component.ts","ng://@igo2/geo/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","ng://@igo2/geo/lib/layer/layer.module.ts","ng://@igo2/geo/lib/catalog/catalog-browser/catalog-browser.module.ts","ng://@igo2/geo/lib/catalog/catalog-library/catalog-library.component.ts","ng://@igo2/geo/lib/catalog/catalog-library/catalog-library-item.component.ts","ng://@igo2/geo/lib/catalog/catalog-library/catalog-library.module.ts","ng://@igo2/geo/lib/catalog/catalog.module.ts","ng://@igo2/geo/lib/datasource/datasource.module.ts","ng://@igo2/geo/lib/filter/shared/filterable-datasource.pipe.ts","ng://@igo2/geo/lib/filter/shared/time-filter.service.ts","ng://@igo2/geo/lib/filter/shared/ogc-filter.enum.ts","ng://@igo2/geo/lib/filter/shared/ogc-filter.service.ts","ng://@igo2/geo/lib/filter/shared/spatial-filter.enum.ts","ng://@igo2/geo/lib/filter/shared/spatial-filter.service.ts","ng://@igo2/geo/lib/download/shared/download.service.ts","ng://@igo2/geo/lib/download/download-button/download-button.component.ts","ng://@igo2/geo/lib/download/download.module.ts","ng://@igo2/geo/lib/feature/feature-details/feature-details.component.ts","ng://@igo2/geo/lib/feature/feature-details/feature-details.module.ts","ng://@igo2/geo/lib/feature/feature-form/feature-form.module.ts","ng://@igo2/geo/lib/feature/feature.module.ts","ng://@igo2/geo/lib/geometry/geometry-form-field/geometry-form-field.component.ts","ng://@igo2/geo/lib/measure/shared/measure.enum.ts","ng://@igo2/geo/lib/measure/shared/measure.utils.ts","ng://@igo2/geo/lib/geometry/shared/geometry.errors.ts","ng://@igo2/geo/lib/geometry/shared/geometry.utils.ts","ng://@igo2/geo/lib/geometry/shared/controls/draw.ts","ng://@igo2/geo/lib/geometry/shared/controls/modify.ts","ng://@igo2/geo/lib/geometry/shared/controls/slice.ts","ng://@igo2/geo/lib/measure/measurer/measurer-dialog.component.ts","ng://@igo2/geo/lib/measure/measurer/measurer.component.ts","ng://@igo2/geo/lib/measure/measurer/measure-format.pipe.ts","ng://@igo2/geo/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","ng://@igo2/geo/lib/geometry/geometry-form-field/geometry-form-field.module.ts","ng://@igo2/geo/lib/geometry/geometry.module.ts","ng://@igo2/geo/lib/filter/time-filter-button/time-filter-button.component.ts","ng://@igo2/geo/lib/filter/time-filter-form/time-filter-form.component.ts","ng://@igo2/geo/lib/filter/time-filter-item/time-filter-item.component.ts","ng://@igo2/geo/lib/filter/time-filter-list/time-filter-list.component.ts","ng://@igo2/geo/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","ng://@igo2/geo/lib/wkt/shared/wkt.service.ts","ng://@igo2/geo/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","ng://@igo2/geo/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","ng://@igo2/geo/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","ng://@igo2/geo/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","ng://@igo2/geo/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","ng://@igo2/geo/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","ng://@igo2/geo/lib/filter/ogc-filter-toggle-button/ogc-filter-toggle-button.component.ts","ng://@igo2/geo/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","ng://@igo2/geo/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","ng://@igo2/geo/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","ng://@igo2/geo/lib/filter/filter.module.ts","ng://@igo2/geo/lib/import-export/export-button/export-button.component.ts","ng://@igo2/geo/lib/import-export/shared/export.errors.ts","ng://@igo2/geo/lib/import-export/shared/export.utils.ts","ng://@igo2/geo/lib/import-export/shared/export.type.ts","ng://@igo2/geo/lib/import-export/shared/export.service.ts","ng://@igo2/geo/lib/import-export/shared/import.errors.ts","ng://@igo2/geo/lib/import-export/shared/import.utils.ts","ng://@igo2/geo/lib/import-export/shared/import.service.ts","ng://@igo2/geo/lib/import-export/style-list/style-list.service.ts","ng://@igo2/geo/lib/import-export/import-export/import-export.component.ts","ng://@igo2/geo/lib/import-export/shared/drop-geo-file.directive.ts","ng://@igo2/geo/lib/import-export/style-list/style-list.provider.ts","ng://@igo2/geo/lib/import-export/style-list/style-list.module.ts","ng://@igo2/geo/lib/import-export/import-export.module.ts","ng://@igo2/geo/lib/map/map.module.ts","ng://@igo2/geo/lib/measure/measurer/measurer-item.component.ts","ng://@igo2/geo/lib/measure/measurer/measurer.module.ts","ng://@igo2/geo/lib/measure/measure.module.ts","ng://@igo2/geo/lib/overlay/overlay.module.ts","ng://@igo2/geo/lib/print/shared/print.type.ts","ng://@igo2/geo/lib/print/shared/print.service.ts","ng://@igo2/geo/lib/print/print/print.component.ts","ng://@igo2/geo/lib/print/print-form/print-form.component.ts","ng://@igo2/geo/lib/print/print.module.ts","ng://@igo2/geo/lib/query/shared/query-search-source.providers.ts","ng://@igo2/geo/lib/query/query.module.ts","ng://@igo2/geo/lib/search/shared/search-source.service.ts","ng://@igo2/geo/lib/search/shared/search.utils.ts","ng://@igo2/geo/lib/search/shared/search.service.ts","ng://@igo2/geo/lib/directions/directions-sources/directions-source.ts","ng://@igo2/geo/lib/directions/shared/directions-source.service.ts","ng://@igo2/geo/lib/directions/shared/directions.service.ts","ng://@igo2/geo/lib/directions/directions-form/directions-form.service.ts","ng://@igo2/geo/lib/directions/directions-form/directions-form.component.ts","ng://@igo2/geo/lib/directions/directions-form/directions-form-binding.directive.ts","ng://@igo2/geo/lib/directions/directions.module.ts","ng://@igo2/geo/lib/search/shared/search-source-service.providers.ts","ng://@igo2/geo/lib/search/shared/sources/icherche.ts","ng://@igo2/geo/lib/search/shared/sources/icherche.providers.ts","ng://@igo2/geo/lib/search/shared/sources/coordinates.ts","ng://@igo2/geo/lib/search/shared/sources/coordinates.providers.ts","ng://@igo2/geo/lib/search/shared/sources/ilayer.ts","ng://@igo2/geo/lib/search/shared/sources/ilayer.providers.ts","ng://@igo2/geo/lib/search/shared/search.enums.ts","ng://@igo2/geo/lib/search/search-selector/search-selector.component.ts","ng://@igo2/geo/lib/search/search-selector/search-selector.module.ts","ng://@igo2/geo/lib/search/search-settings/search-settings.component.ts","ng://@igo2/geo/lib/search/search-settings/search-settings.module.ts","ng://@igo2/geo/lib/search/search-bar/search-bar.component.ts","ng://@igo2/geo/lib/search/search-bar/search-url-param.directive.ts","ng://@igo2/geo/lib/search/search-bar/search-bar.module.ts","ng://@igo2/geo/lib/search/search-results/search-results.component.ts","ng://@igo2/geo/lib/search/search-results/search-results-item.component.ts","ng://@igo2/geo/lib/search/search-results/search-results-add-button.component.ts","ng://@igo2/geo/lib/search/search-results/search-results.module.ts","ng://@igo2/geo/lib/search/shared/search-pointer-summary.directive.ts","ng://@igo2/geo/lib/search/search.module.ts","ng://@igo2/geo/lib/toast/toast.component.ts","ng://@igo2/geo/lib/toast/toast.module.ts","ng://@igo2/geo/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","ng://@igo2/geo/lib/workspace/widgets/widgets.ts","ng://@igo2/geo/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","ng://@igo2/geo/lib/workspace/shared/wfs-workspace.ts","ng://@igo2/geo/lib/workspace/shared/wfs-workspace.service.ts","ng://@igo2/geo/lib/workspace/shared/wms-workspace.ts","ng://@igo2/geo/lib/workspace/shared/wms-workspace.service.ts","ng://@igo2/geo/lib/workspace/workspace-selector/workspace-selector.directive.ts","ng://@igo2/geo/lib/workspace/workspace-selector/workspace-selector.module.ts","ng://@igo2/geo/lib/workspace/workspace.module.ts","ng://@igo2/geo/lib/wkt/wkt.module.ts","ng://@igo2/geo/lib/geo.module.ts","ng://@igo2/geo/lib/datasource/shared/options/options-api.providers.ts","ng://@igo2/geo/lib/search/shared/sources/cadastre.ts","ng://@igo2/geo/lib/search/shared/sources/cadastre.providers.ts","ng://@igo2/geo/lib/search/shared/sources/nominatim.ts","ng://@igo2/geo/lib/search/shared/sources/nominatim.providers.ts","ng://@igo2/geo/lib/search/shared/sources/storedqueries.ts","ng://@igo2/geo/lib/search/shared/sources/storedqueries.providers.ts","ng://@igo2/geo/lib/directions/shared/directions.enum.ts","ng://@igo2/geo/lib/directions/directions-sources/osrm-directions-source.ts","ng://@igo2/geo/lib/directions/directions-sources/directions-source.provider.ts","ng://@igo2/geo/lib/import-export/shared/export-ionic.service.ts","ng://@igo2/geo/lib/print/shared/print-ionic.service.ts"],"sourcesContent":["import * as olproj from 'ol/proj';\r\nimport { MapBrowserPointerEvent as OlMapBrowserPointerEvent } from 'ol/MapBrowserEvent';\r\nimport { MAC } from 'ol/has';\r\n\r\nimport { MapViewState } from './map.interface';\r\nimport proj4 from 'proj4';\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * This method extracts a coordinate tuple from a string.\r\n * @param str Any string\r\n * @param mapProjection string Map Projection\r\n * @param opts.forceNA boolean Force North America Zone\r\n * @returns object:\r\n *             lonLat: Coordinate,\r\n *             message: Message of error,\r\n *             radius: radius of the confience of coordinate,\r\n *             conf: confidence of the coordinate}\r\n */\r\nexport function stringToLonLat(\r\n  str: string,\r\n  mapProjection: string,\r\n  opts: { forceNA?: boolean } = {}\r\n): {\r\n  lonLat: [number, number] | undefined;\r\n  message: string;\r\n  radius: number | undefined;\r\n  conf: number | undefined;\r\n} {\r\n  let lonLat: [number, number];\r\n  let coordStr: string;\r\n  let negativeLon: string;\r\n  let degreesLon: string;\r\n  let minutesLon: string;\r\n  let secondsLon: string;\r\n  let directionLon: string;\r\n  let decimalLon: string;\r\n  let negativeLat: string;\r\n  let degreesLat: string;\r\n  let minutesLat: string;\r\n  let secondsLat: string;\r\n  let directionLat: string;\r\n  let decimalLat: string;\r\n  let zone: string;\r\n  let radius: string;\r\n  let conf: string;\r\n  let lon: any;\r\n  let lat: any;\r\n\r\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\r\n  const toProjection = '4326';\r\n  let projectionStr: string;\r\n  const projectionRegex = new RegExp(projectionPattern, 'g');\r\n\r\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\r\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\r\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\r\n\r\n  const dmsCoord =\r\n    '([0-9]{1,2})[:|Â°]?\\\\s*([0-9]{1,2})?[:|\\'|â²|â]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|â³|â]?\\\\s*';\r\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\r\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}`, 'gi');\r\n\r\n  const patternUtm =\r\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\r\n\r\n  const patternMtm =\r\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\r\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\r\n\r\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\r\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\r\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\r\n\r\n  const dmdCoord =\r\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\r\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\r\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\r\n\r\n  // tslint:disable:max-line-length\r\n  const patternBELL =\r\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\r\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\r\n\r\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\r\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\r\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\r\n\r\n  let isXYCoords = false;\r\n\r\n  str = str.toLocaleUpperCase().trim();\r\n\r\n  // Extract projection\r\n  if (projectionRegex.test(str)) {\r\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\r\n  } else {\r\n    coordStr = str;\r\n  }\r\n  if (lonLatRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      lon,\r\n      ,\r\n      decimalLon,\r\n      negativeLat,\r\n      lat,\r\n      ,\r\n      decimalLat\r\n    ] = coordStr.match(lonLatPattern);\r\n\r\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\r\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\r\n  } else if (dmsRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      directionLon,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      directionLat\r\n    ] = coordStr.match(dmsCoordPattern);\r\n\r\n    if (directionLon === 'S' || directionLon === 'N') {\r\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\r\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\r\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\r\n      directionLon = [directionLat, (directionLat = directionLon)][0];\r\n    }\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat(degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat(degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (utmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\r\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgUtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (mtmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\r\n    const epsgMtm =\r\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\r\n    [lon, lat] = olproj.transform(\r\n      [parseFloat(lon), parseFloat(lat)],\r\n      epsgMtm,\r\n      'EPSG:4326'\r\n    );\r\n  } else if (dmdRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDmd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (ddRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLon,\r\n      degreesLon,\r\n      decimalLon,\r\n      negativeLat,\r\n      degreesLat,\r\n      decimalLat\r\n    ] = coordStr.match(patternDd);\r\n\r\n    lon = convertDMSToDD(\r\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\r\n      parseFloat(minutesLon),\r\n      parseFloat(secondsLon),\r\n      directionLon\r\n    );\r\n    lat = convertDMSToDD(\r\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\r\n      parseFloat(minutesLat),\r\n      parseFloat(secondsLat),\r\n      directionLat\r\n    );\r\n  } else if (bellRegex.test(coordStr)) {\r\n    [\r\n      ,\r\n      negativeLat,\r\n      degreesLat,\r\n      minutesLat,\r\n      secondsLat,\r\n      ,\r\n      directionLat,\r\n      negativeLon,\r\n      degreesLon,\r\n      minutesLon,\r\n      secondsLon,\r\n      ,\r\n      directionLon,\r\n      radius,\r\n      conf\r\n    ] = coordStr.match(patternBELL);\r\n\r\n    // Set default value for North America\r\n    if (!directionLon) {\r\n      directionLon = 'W';\r\n    }\r\n\r\n    // Check if real minutes or decimals\r\n    if (minutesLon && minutesLon.length > 2) {\r\n      lon = parseFloat(\r\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\r\n      );\r\n    } else {\r\n      lon = convertDMSToDD(\r\n        parseFloat(degreesLon),\r\n        parseFloat(minutesLon),\r\n        parseFloat(secondsLon),\r\n        directionLon\r\n      );\r\n    }\r\n\r\n    if (minutesLat && minutesLat.length > 2) {\r\n      lat = parseFloat(\r\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\r\n      );\r\n    } else {\r\n      lat = convertDMSToDD(\r\n        parseFloat(degreesLat),\r\n        parseFloat(minutesLat),\r\n        parseFloat(secondsLat),\r\n        directionLat\r\n      );\r\n    }\r\n  } else if (mmRegex.test(coordStr)) {\r\n    isXYCoords = true;\r\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\r\n\r\n    if (decimalLon) {\r\n      lon = parseFloat(lon + '.' + decimalLon);\r\n    }\r\n\r\n    if (decimalLat) {\r\n      lat = parseFloat(lat + '.' + decimalLat);\r\n    }\r\n  } else {\r\n    return {\r\n      lonLat: undefined,\r\n      message: '',\r\n      radius: undefined,\r\n      conf: undefined\r\n    };\r\n  }\r\n\r\n  if (opts.forceNA && !isXYCoords) {\r\n    // Set a negative coordinate for North America zone\r\n    if (lon > 0 && lat > 0) {\r\n      if (lon > lat) {\r\n        lon = -lon;\r\n      } else {\r\n        lat = -lat;\r\n      }\r\n    }\r\n\r\n    // Reverse coordinate to respect lonLat convention\r\n    if (lon > lat) {\r\n      lon = [lat, (lat = lon)][0];\r\n    }\r\n  }\r\n\r\n  lonLat = [Number(lon), Number(lat)] as [number, number];\r\n\r\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\r\n  if (\r\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\r\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\r\n    (lonLat[1] > 90 || lonLat[1] < -90)\r\n  ) {\r\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\r\n    const dest = 'EPSG:' + toProjection;\r\n\r\n    try {\r\n      lonLat = olproj.transform(lonLat, source, dest);\r\n    } catch (e) {\r\n      return {\r\n        lonLat: undefined,\r\n        message: 'Projection ' + source + ' not supported',\r\n        radius: undefined,\r\n        conf: undefined\r\n      };\r\n    }\r\n  }\r\n\r\n  return {\r\n    lonLat,\r\n    message: '',\r\n    radius: radius ? parseInt(radius, 10) : undefined,\r\n    conf: conf ? parseInt(conf, 10) : undefined\r\n  };\r\n}\r\n\r\n/**\r\n * Convert degrees minutes seconds to dd\r\n * @param degrees Degrees\r\n * @param minutes Minutes\r\n * @param seconds Seconds\r\n * @param direction Direction\r\n */\r\nfunction convertDMSToDD(\r\n  degrees: number,\r\n  minutes: number,\r\n  seconds: number,\r\n  direction: string\r\n) {\r\n  minutes = minutes || 0;\r\n  seconds = seconds || 0;\r\n  let dd = degrees + minutes / 60 + seconds / 3600;\r\n\r\n  if (direction === 'S' || direction === 'W') {\r\n    dd = -dd;\r\n  } // Don't do anything for N or E\r\n  return dd;\r\n}\r\n\r\n/**\r\n * Return true of two view states are equal.\r\n * @param state1 View state\r\n * @param state2 View state\r\n * @returns True if the view states are equal\r\n */\r\nexport function viewStatesAreEqual(\r\n  state1: MapViewState,\r\n  state2: MapViewState\r\n): boolean {\r\n  if (state1 === undefined || state2 === undefined) {\r\n    return false;\r\n  }\r\n\r\n  const tolerance = 1 / 10000;\r\n  return (\r\n    state1.zoom === state2.zoom &&\r\n    Math.trunc(state1.center[0] / tolerance) ===\r\n      Math.trunc(state2.center[0] / tolerance) &&\r\n    Math.trunc(state1.center[1] / tolerance) ===\r\n      Math.trunc(state2.center[1] / tolerance)\r\n  );\r\n}\r\n\r\n/**\r\n * Format the scale to a human readable text\r\n * @param Scale of the map\r\n * @returns Human readable scale text\r\n */\r\nexport function formatScale(scale) {\r\n  scale = Math.round(scale);\r\n  if (scale < 10000) {\r\n    return scale + '';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  if (scale < 1000) {\r\n    return scale + 'K';\r\n  }\r\n\r\n  scale = Math.round(scale / 1000);\r\n  return scale + 'M';\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param scale Scale denom\r\n * @param dpi DPI\r\n * @returns Resolution\r\n */\r\nexport function getResolutionFromScale(\r\n  scale: number,\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return scale / (inchesPerMeter * dpi);\r\n}\r\n\r\n/**\r\n * Return the resolution from a scale denom\r\n * @param Scale denom\r\n * @returns Resolution\r\n */\r\nexport function getScaleFromResolution(\r\n  resolution: number,\r\n  unit: string = 'm',\r\n  dpi: number = 96\r\n): number {\r\n  const inchesPerMeter = 39.3701;\r\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\r\n}\r\n\r\n/**\r\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\r\n * @param event OL MapBrowserPointerEvent\r\n * @returns Whether the CTRL key is pushed\r\n */\r\nexport function ctrlKeyDown(event: OlMapBrowserPointerEvent): boolean {\r\n  const originalEvent = event.originalEvent;\r\n  return (\r\n    !originalEvent.altKey &&\r\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\r\n    !originalEvent.shiftKey\r\n  );\r\n}\r\n\r\nexport function roundCoordTo(coord: [number, number], decimal: number = 3) {\r\n  return [coord[0].toFixed(decimal), coord[1].toFixed(decimal)];\r\n}\r\n\r\n/**\r\n * Returns an array of converted coordinates.\r\n * Conversion is done for every configured projections\r\n * and for the current UTM zone and MTM zone.\r\n * @param lonLat [number, number] array of the coordinate to transform.\r\n * @param projections  Projection[] Array of destination projection.\r\n * @returns Returns an array of converted coordinates.\r\n */\r\nexport function lonLatConversion(\r\n  lonLat: [number, number],\r\n  projections: Projection[]\r\n): {\r\n  code: string;\r\n  alias: string;\r\n  coord: [number, number];\r\n  igo2CoordFormat: string;\r\n}[] {\r\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857');\r\n  const convertedLonLat = [\r\n    {\r\n      code: 'EPSG:3857',\r\n      alias: 'Web mercator',\r\n      coord: rawCoord3857,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\r\n    }\r\n  ];\r\n\r\n  // detect the current utm zone.\r\n  const utmZone = utmZoneFromLonLat(lonLat);\r\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n  const utmName = `UTM-${utmZone}`;\r\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm);\r\n  convertedLonLat.push({\r\n    code: epsgUtm,\r\n    alias: 'UTM',\r\n    coord: rawCoordUtm,\r\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\r\n  });\r\n\r\n  // detect the current mtm zone.\r\n  const mtmZone = mtmZoneFromLonLat(lonLat);\r\n  if (mtmZone) {\r\n    const epsgMtm =\r\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n    const mtmName = `MTM-${mtmZone}`;\r\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm);\r\n    convertedLonLat.push({\r\n      code: epsgMtm,\r\n      alias: 'MTM',\r\n      coord: rawCoordMtm,\r\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\r\n    });\r\n  }\r\n\r\n  projections.forEach(projection => {\r\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code);\r\n    const numericEpsgCode = projection.code.split(':')[1];\r\n    convertedLonLat.push({\r\n      code: projection.code,\r\n      alias: projection.alias || projection.code,\r\n      coord: rawCoord,\r\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\r\n        ', '\r\n      )} ; ${numericEpsgCode}`\r\n    });\r\n  });\r\n\r\n  return convertedLonLat;\r\n}\r\n\r\n/**\r\n * Detect the current utm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\r\n * @returns number The UTM zone.\r\n */\r\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\r\n  return Math.ceil((lonLat[0] + 180) / 6);\r\n}\r\n\r\n/**\r\n * Detect the current mtm zone of the lon/lat coordinate.\r\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\r\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\r\n */\r\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\r\n  const long = lonLat[0];\r\n  let mtmZone;\r\n  if (long < -51 && long > -54) {\r\n    mtmZone = 1;\r\n  }\r\n  if (long < -54 && long > -57) {\r\n    mtmZone = 2;\r\n  }\r\n  if (long < -57 && long > -60) {\r\n    mtmZone = 3;\r\n  }\r\n  if (long < -60 && long > -63) {\r\n    mtmZone = 4;\r\n  }\r\n  if (long < -63 && long > -66) {\r\n    mtmZone = 5;\r\n  }\r\n  if (long < -66 && long > -69) {\r\n    mtmZone = 6;\r\n  }\r\n  if (long < -69 && long > -72) {\r\n    mtmZone = 7;\r\n  }\r\n  if (long < -72 && long > -75) {\r\n    mtmZone = 8;\r\n  }\r\n  if (long < -75 && long > -78) {\r\n    mtmZone = 9;\r\n  }\r\n  if (long < -78 && long > -81) {\r\n    mtmZone = 10;\r\n  }\r\n  return mtmZone;\r\n}\r\n","import {\r\n  BehaviorSubject,\r\n  Observable,\r\n  Subject,\r\n  Subscription,\r\n  combineLatest\r\n} from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport olLayer from 'ol/layer/Layer';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { DataSource, Legend } from '../../../datasource';\r\nimport { IgoMap } from '../../../map/shared/map';\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\n\r\nimport { LayerOptions } from './layer.interface';\r\n\r\nexport abstract class Layer {\r\n  public collapsed: boolean;\r\n  public dataSource: DataSource;\r\n  public legend: Legend[];\r\n  public legendCollapsed: boolean = true;\r\n  public firstLoadComponent: boolean = true;\r\n  public map: IgoMap;\r\n  public ol: olLayer;\r\n  public status$: Subject<SubjectStatus>;\r\n\r\n  private resolution$$: Subscription;\r\n\r\n  get id(): string {\r\n    return this.options.id || this.dataSource.id;\r\n  }\r\n\r\n  get alias(): string {\r\n    return this.options.alias;\r\n  }\r\n\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  set title(title: string) {\r\n    this.options.title = title;\r\n  }\r\n\r\n  get zIndex(): number {\r\n    return this.ol.getZIndex();\r\n  }\r\n\r\n  set zIndex(zIndex: number) {\r\n    this.ol.setZIndex(zIndex);\r\n  }\r\n\r\n  get baseLayer(): boolean {\r\n    return this.options.baseLayer;\r\n  }\r\n\r\n  set baseLayer(baseLayer: boolean) {\r\n    this.options.baseLayer = baseLayer;\r\n  }\r\n\r\n  get opacity(): number {\r\n    return this.ol.get('opacity');\r\n  }\r\n\r\n  set opacity(opacity: number) {\r\n    this.ol.setOpacity(opacity);\r\n  }\r\n\r\n  set isInResolutionsRange(value: boolean) {\r\n    this.isInResolutionsRange$.next(value);\r\n  }\r\n  get isInResolutionsRange(): boolean {\r\n    return this.isInResolutionsRange$.value;\r\n  }\r\n  readonly isInResolutionsRange$: BehaviorSubject<\r\n    boolean\r\n  > = new BehaviorSubject(false);\r\n\r\n  set maxResolution(value: number) {\r\n    this.ol.setMaxResolution(value || Infinity);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get maxResolution(): number {\r\n    return this.ol.getMaxResolution();\r\n  }\r\n\r\n  set minResolution(value: number) {\r\n    this.ol.setMinResolution(value || 0);\r\n    this.updateInResolutionsRange();\r\n  }\r\n  get minResolution(): number {\r\n    return this.ol.getMinResolution();\r\n  }\r\n\r\n  set visible(value: boolean) {\r\n    this.ol.setVisible(value);\r\n    this.visible$.next(value);\r\n  }\r\n  get visible(): boolean {\r\n    return this.visible$.value;\r\n  }\r\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\r\n\r\n  get displayed(): boolean {\r\n    return this.visible && this.isInResolutionsRange;\r\n  }\r\n  readonly displayed$: Observable<boolean> = combineLatest([\r\n    this.isInResolutionsRange$,\r\n    this.visible$\r\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\r\n\r\n  get showInLayerList(): boolean {\r\n    return this.options.showInLayerList !== false;\r\n  }\r\n\r\n  constructor(\r\n    public options: LayerOptions,\r\n    protected authInterceptor?: AuthInterceptor\r\n  ) {\r\n    this.dataSource = options.source;\r\n\r\n    this.ol = this.createOlLayer();\r\n    if (options.zIndex !== undefined) {\r\n      this.zIndex = options.zIndex;\r\n    }\r\n\r\n    if (options.baseLayer && options.visible === undefined) {\r\n      options.visible = false;\r\n    }\r\n\r\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\r\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\r\n\r\n    this.visible = options.visible === undefined ? true : options.visible;\r\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\r\n\r\n    if (\r\n      options.legendOptions &&\r\n      (options.legendOptions.url || options.legendOptions.html)\r\n    ) {\r\n      this.legend = this.dataSource.setLegend(options.legendOptions);\r\n    }\r\n\r\n    this.legendCollapsed = options.legendOptions\r\n      ? options.legendOptions.collapsed\r\n        ? options.legendOptions.collapsed\r\n        : true\r\n      : true;\r\n\r\n    this.ol.set('_layer', this, true);\r\n  }\r\n\r\n  protected abstract createOlLayer(): olLayer;\r\n\r\n  setMap(igoMap: IgoMap | undefined) {\r\n    this.map = igoMap;\r\n\r\n    this.unobserveResolution();\r\n    if (igoMap !== undefined) {\r\n      this.observeResolution();\r\n    }\r\n  }\r\n\r\n  private observeResolution() {\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\r\n      this.updateInResolutionsRange()\r\n    );\r\n  }\r\n\r\n  private unobserveResolution() {\r\n    if (this.resolution$$ !== undefined) {\r\n      this.resolution$$.unsubscribe();\r\n      this.resolution$$ = undefined;\r\n    }\r\n  }\r\n\r\n  private updateInResolutionsRange() {\r\n    if (this.map !== undefined) {\r\n      const resolution = this.map.viewController.getResolution();\r\n      const minResolution = this.minResolution;\r\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\r\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\r\n    } else {\r\n      this.isInResolutionsRange = false;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { MetadataOptions } from './metadata.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MetadataService {\r\n  constructor() {}\r\n\r\n  open(metadata: MetadataOptions) {\r\n    if (metadata.extern) {\r\n      window.open(metadata.url, '_blank');\r\n    }\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport {\r\n  MetadataOptions,\r\n  MetadataLayerOptions\r\n} from '../shared/metadata.interface';\r\nimport { MetadataService } from '../shared/metadata.service';\r\n\r\n@Component({\r\n  selector: 'igo-metadata-button',\r\n  templateUrl: './metadata-button.component.html',\r\n  styleUrls: ['./metadata-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MetadataButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(private metadataService: MetadataService) {}\r\n\r\n  openMetadata(metadata: MetadataOptions) {\r\n    this.metadataService.open(metadata);\r\n  }\r\n\r\n  get options(): MetadataLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatTooltipModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { MetadataButtonComponent } from './metadata-button/metadata-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [MetadataButtonComponent],\r\n  declarations: [MetadataButtonComponent]\r\n})\r\nexport class IgoMetadataModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoMetadataModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","export abstract class DataService {\r\n    abstract getData(): string;\r\n}\r\n","import { Md5 } from 'ts-md5';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\r\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\r\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\r\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\r\n\r\n/**\r\n * Generate a id from it's datasource options.\r\n * @param options Data source options\r\n * @returns A id\r\n */\r\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\r\n  const generators = {\r\n    wms: generateWMSIdFromSourceOptions,\r\n    wmts: generateWMTSIdFromSourceOptions,\r\n    xyz: generateXYZIdFromSourceOptions,\r\n    feature: generateFeatureIdFromSourceOptions,\r\n    osm: (_options: AnyDataSourceOptions) => 'OSM'\r\n  };\r\n  const generator = generators[options.type] || generateId;\r\n  return generator(options);\r\n}\r\n\r\n/**\r\n * Generate a id from WMS data source options\r\n * @param options WMS data source options\r\n * @returns A md5 hash of the the url and layers\r\n */\r\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\r\n  const layers = options.params.LAYERS;\r\n  const url = options.url.charAt(0) === '/' ? window.location.origin + options.url : options.url;\r\n  const chain = 'wms' + url + layers;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from WMTS data source options\r\n * @param options WMTS data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  const layer = options.layer;\r\n  const chain = 'wmts' + options.url + layer;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from XYZ data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  const chain = 'xyz' + options.url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a id from feature data source options\r\n * @param options XYZ data source options\r\n * @returns A md5 hash of the the url and layer\r\n */\r\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\r\n  if (! options.url) { return generateId(options); }\r\n  const chain = 'feature' + options.url;\r\n  return Md5.hashStr(chain) as string;\r\n}\r\n\r\n/**\r\n * Generate a unique id\r\n * @returns A uuid\r\n */\r\nexport function generateId(options: AnyDataSourceOptions) {\r\n  return uuid();\r\n}\r\n","import olSource from 'ol/source/Source';\r\n\r\nimport {\r\n  DataSourceOptions,\r\n  Legend\r\n} from './datasource.interface';\r\n\r\nimport { DataService } from './data.service';\r\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\r\nimport { LegendOptions } from '../../../layer';\r\n\r\nexport abstract class DataSource {\r\n\r\n  public id: string;\r\n  public ol: olSource;\r\n  private legend: Legend[];\r\n\r\n  constructor(\r\n    public options: DataSourceOptions = {},\r\n    protected dataService?: DataService\r\n  ) {\r\n    this.options = options;\r\n    this.id = this.options.id ||Â this.generateId();\r\n    this.ol = this.createOlSource();\r\n  }\r\n\r\n  protected abstract createOlSource(): olSource;\r\n\r\n  protected generateId(): string {\r\n    return generateIdFromSourceOptions(this.options);\r\n  }\r\n\r\n  public getLegend(style?: string, scale?: number): Legend[] {\r\n    return this.legend ? this.legend : [];\r\n  }\r\n\r\n  public setLegend(options: LegendOptions): Legend[] {\r\n    if (options.url) {\r\n      this.legend = [{ url: options.url} ];\r\n    } else if (options.html) {\r\n      this.legend = [{ html: options.html} ];\r\n    } else {\r\n      this.legend = [];\r\n    }\r\n\r\n    return this.legend;\r\n  }\r\n\r\n  protected abstract onUnwatch();\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport * as olformat from 'ol/format';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\r\n\r\nexport class FeatureDataSource extends DataSource {\r\n  public options: FeatureDataSourceOptions;\r\n  public ol: olSourceVector;\r\n  protected createOlSource(): olSourceVector {\r\n    const sourceOptions = {\r\n      format: this.getSourceFormatFromOptions(this.options)\r\n    };\r\n\r\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\r\n  }\r\n\r\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\r\n    if (options.format) {\r\n      return options.format;\r\n    }\r\n    let olFormatCls;\r\n    const formatType = options.formatType;\r\n    if (!formatType) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    } else {\r\n      olFormatCls = olformat[formatType];\r\n      if (olFormatCls === undefined) {\r\n        throw new Error('Invalid vector source format ${formatType}.');\r\n      }\r\n    }\r\n\r\n    const formatOptions = options.formatOptions;\r\n    let format;\r\n    if (formatOptions) {\r\n      format = new olFormatCls(formatOptions);\r\n    } else {\r\n      format = new olFormatCls();\r\n    }\r\n\r\n    return format;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n}\r\n","import olSourceOSM from 'ol/source/OSM';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\r\n\r\nexport class OSMDataSource extends DataSource {\r\n  public options: OSMDataSourceOptions;\r\n  public ol: olSourceOSM;\r\n\r\n  protected createOlSource(): olSourceOSM {\r\n    this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\r\n    return new olSourceOSM(this.options);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceXYZ from 'ol/source/XYZ';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\r\n\r\nexport class XYZDataSource extends DataSource {\r\n  public options: XYZDataSourceOptions;\r\n  public ol: olSourceXYZ;\r\n\r\n  protected createOlSource(): olSourceXYZ {\r\n    return new olSourceXYZ(this.options);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n}\r\n","import * as olfilter from 'ol/format/filter';\r\nimport olFormatWKT from 'ol/format/WKT';\r\nimport olFormatWFS from 'ol/format/WFS';\r\nimport olGeometry from 'ol/geom/Geometry';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\n\r\nimport {\r\n  OgcFilter,\r\n  IgoOgcFilterObject,\r\n  WFSWriteGetFeatureOptions,\r\n  AnyBaseOgcFilterOptions,\r\n  OgcInterfaceFilterOptions,\r\n  OgcFilterableDataSourceOptions,\r\n  OgcFiltersOptions,\r\n  IgoPushButton,\r\n  PushButtonGroup,\r\n  OgcPushButtonBundle\r\n} from './ogc-filter.interface';\r\nimport { OgcFilterOperatorType } from './ogc-filter.enum';\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\n\r\nexport class OgcFilterWriter {\r\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\r\n  public operators = {\r\n    PropertyIsEqualTo: { spatial: false, fieldRestrict: [] },\r\n    PropertyIsNotEqualTo: { spatial: false, fieldRestrict: [] },\r\n    PropertyIsLike: { spatial: false, fieldRestrict: ['string'] },\r\n    PropertyIsGreaterThan: { spatial: false, fieldRestrict: ['number'] },\r\n    PropertyIsGreaterThanOrEqualTo: { spatial: false, fieldRestrict: ['number'] },\r\n    PropertyIsLessThan: { spatial: false, fieldRestrict: ['number'] },\r\n    PropertyIsLessThanOrEqualTo: { spatial: false, fieldRestrict: ['number'] },\r\n    PropertyIsBetween: { spatial: false, fieldRestrict: ['number'] },\r\n    During: { spatial: false, fieldRestrict: [] },\r\n    PropertyIsNull: { spatial: false, fieldRestrict: [] },\r\n    Intersects: { spatial: true, fieldRestrict: [] },\r\n    Within: { spatial: true, fieldRestrict: [] },\r\n    Contains: { spatial: true, fieldRestrict: [] }\r\n  };\r\n\r\n  defineOgcFiltersDefaultOptions(\r\n    ogcFiltersOptions: OgcFiltersOptions,\r\n    fieldNameGeometry: string,\r\n    srcType?: string): OgcFiltersOptions  {\r\n    let ogcFiltersDefaultValue = true; // default values for wfs.\r\n    if (srcType && srcType === 'wms') {\r\n      ogcFiltersDefaultValue = false;\r\n    }\r\n\r\n    ogcFiltersOptions = ogcFiltersOptions || {};\r\n    ogcFiltersOptions.enabled = ogcFiltersOptions.enabled === undefined ? ogcFiltersDefaultValue : ogcFiltersOptions.enabled;\r\n    ogcFiltersOptions.editable = ogcFiltersOptions.editable === undefined ? ogcFiltersDefaultValue : ogcFiltersOptions.editable;\r\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\r\n\r\n    ogcFiltersOptions.advancedOgcFilters = true;\r\n    if (ogcFiltersOptions.enabled && ogcFiltersOptions.pushButtons) {\r\n      ogcFiltersOptions.advancedOgcFilters = false;\r\n    }\r\n    return ogcFiltersOptions;\r\n  }\r\n\r\n  public buildFilter(\r\n    filters?: IgoOgcFilterObject,\r\n    extent?: [number, number, number, number],\r\n    proj?: olProjection,\r\n    fieldNameGeometry?: string\r\n  ): string {\r\n    let ourBboxFilter;\r\n    let enableBbox: boolean;\r\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\r\n      enableBbox = false;\r\n    } else {\r\n      enableBbox = true;\r\n    }\r\n    if (filters) {\r\n      fieldNameGeometry =\r\n        (filters as any).geometryName !== undefined\r\n          ? (filters as any).geometryName\r\n          : fieldNameGeometry;\r\n    }\r\n    if (extent && filters) {\r\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\r\n    }\r\n    let filterAssembly: OgcFilter;\r\n    if (filters) {\r\n      filters = this.checkIgoFiltersProperties(filters, fieldNameGeometry, proj);\r\n      if (extent && enableBbox) {\r\n        filterAssembly = olfilter.and(\r\n          ourBboxFilter,\r\n          this.bundleFilter(filters)\r\n        );\r\n      } else {\r\n        filterAssembly = this.bundleFilter(filters);\r\n      }\r\n    } else {\r\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\r\n    }\r\n\r\n    const wfsOptions: WFSWriteGetFeatureOptions = {\r\n      srsName: '',\r\n      featureNS: '',\r\n      featurePrefix: '',\r\n      featureTypes: ['featureTypes'],\r\n      filter: filterAssembly,\r\n      outputFormat: '',\r\n      geometryName: fieldNameGeometry\r\n    };\r\n\r\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\r\n    const str = new XMLSerializer().serializeToString(query);\r\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\r\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\r\n\r\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\r\n  }\r\n\r\n  private bundleFilter(filterObject: any) {\r\n    if (filterObject instanceof Array) {\r\n      const logicalArray = [];\r\n      filterObject.forEach(element => {\r\n        logicalArray.push(this.bundleFilter(element));\r\n      });\r\n      return logicalArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return this.createFilter({\r\n          operator: filterObject.logical,\r\n          logicalArray: this.bundleFilter(filterObject.filters)\r\n        });\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.createFilter(filterObject as AnyBaseOgcFilterOptions);\r\n      }\r\n    }\r\n  }\r\n\r\n  private createFilter(filterOptions): OgcFilter {\r\n    const operator = filterOptions.operator;\r\n    const logicalArray = filterOptions.logicalArray;\r\n\r\n    const wfsPropertyName = filterOptions.propertyName;\r\n    const wfsPattern = filterOptions.pattern;\r\n    const wfsMatchCase = filterOptions.matchCase\r\n      ? filterOptions.matchCase\r\n      : true;\r\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\r\n    const wfsSingleChar = filterOptions.singleChar\r\n      ? filterOptions.singleChar\r\n      : '.';\r\n    const wfsEscapeChar = filterOptions.escapeChar\r\n      ? filterOptions.escapeChar\r\n      : '!';\r\n\r\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\r\n    const wfsUpperBoundary = filterOptions.upperBoundary;\r\n\r\n    const wfsGeometryName = filterOptions.geometryName;\r\n    const wfsExtent = filterOptions.extent;\r\n    const wfsWktGeometry = filterOptions.wkt_geometry;\r\n    const wfsSrsName = filterOptions.srsName\r\n      ? filterOptions.srsName\r\n      : 'EPSG:3857';\r\n\r\n    const wfsBegin = filterOptions.begin;\r\n    const wfsEnd = filterOptions.end;\r\n\r\n    const wfsExpression = filterOptions.expression;\r\n\r\n    let geometry: olGeometry;\r\n    if (wfsWktGeometry) {\r\n      const wkt = new olFormatWKT();\r\n      geometry = wkt.readGeometry(wfsWktGeometry, {\r\n        dataProjection: wfsSrsName,\r\n        featureProjection: wfsSrsName || 'EPSG:3857'\r\n      });\r\n    }\r\n\r\n    switch (operator) {\r\n      case 'BBOX':\r\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\r\n      case 'PropertyIsBetween':\r\n        return olfilter.between(\r\n          wfsPropertyName,\r\n          wfsLowerBoundary,\r\n          wfsUpperBoundary\r\n        );\r\n      case 'Contains':\r\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\r\n      case 'During':\r\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\r\n      case 'PropertyIsEqualTo':\r\n        return olfilter.equalTo(\r\n          wfsPropertyName,\r\n          wfsExpression,\r\n          wfsMatchCase\r\n        );\r\n      case 'PropertyIsGreaterThan':\r\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\r\n      case 'PropertyIsGreaterThanOrEqualTo':\r\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case 'Intersects':\r\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\r\n      case 'PropertyIsNull':\r\n        return olfilter.isNull(wfsPropertyName);\r\n      case 'PropertyIsLessThan':\r\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\r\n      case 'PropertyIsLessThanOrEqualTo':\r\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\r\n      case 'PropertyIsLike':\r\n        return olfilter.like(\r\n          wfsPropertyName,\r\n          wfsPattern.replace(/[()_]/gi, wfsSingleChar),\r\n          wfsWildCard,\r\n          wfsSingleChar,\r\n          wfsEscapeChar,\r\n          wfsMatchCase\r\n        );\r\n      case 'PropertyIsNotEqualTo':\r\n        return olfilter.notEqualTo(\r\n          wfsPropertyName,\r\n          wfsExpression,\r\n          wfsMatchCase\r\n        );\r\n      case 'Within':\r\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\r\n      // LOGICAL\r\n      case 'And':\r\n        return olfilter.and.apply(null, logicalArray);\r\n      case 'Or':\r\n        return olfilter.or.apply(null, logicalArray);\r\n      case 'Not':\r\n        return olfilter.not.apply(null, logicalArray);\r\n\r\n      default:\r\n        return undefined;\r\n    }\r\n  }\r\n\r\n  public defineInterfaceFilterSequence(\r\n    filterObject: any,\r\n    geometryName,\r\n    logical = '',\r\n    level = -1\r\n  ): OgcInterfaceFilterOptions[] {\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach(element => {\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            element,\r\n            geometryName,\r\n            logical,\r\n            level\r\n          )\r\n        );\r\n      });\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        level = level + 1;\r\n        this.filterSequence.concat(\r\n          this.defineInterfaceFilterSequence(\r\n            filterObject.filters,\r\n            geometryName,\r\n            filterObject.logical,\r\n            level\r\n          )\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        this.filterSequence.push(\r\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\r\n        );\r\n      }\r\n    }\r\n    return this.filterSequence;\r\n  }\r\n\r\n  public computeAllowedOperators(\r\n    fields?: SourceFieldsOptionsParams[],\r\n    propertyName?: string,\r\n    defaultOperatorsType?: OgcFilterOperatorType ) {\r\n    let effectiveOperators: {} = {};\r\n    let allowedOperators;\r\n    if (fields && propertyName) {\r\n      const srcField = fields.find(field => field.name === propertyName);\r\n      allowedOperators = srcField && srcField.allowedOperatorsType ?\r\n        srcField.allowedOperatorsType : defaultOperatorsType;\r\n    }\r\n\r\n    allowedOperators = allowedOperators ? allowedOperators : 'basicandspatial';\r\n\r\n    switch (allowedOperators.toLowerCase()) {\r\n      case 'all':\r\n        effectiveOperators = this.operators;\r\n        break;\r\n      case 'spatial':\r\n        effectiveOperators = {\r\n          Intersects: { spatial: true, fieldRestrict: [] },\r\n          Within: { spatial: true, fieldRestrict: [] },\r\n        };\r\n        break;\r\n      case 'basicandspatial':\r\n        effectiveOperators = {\r\n          PropertyIsEqualTo: { spatial: false, fieldRestrict: [] },\r\n          PropertyIsNotEqualTo: { spatial: false, fieldRestrict: [] },\r\n          Intersects: { spatial: true, fieldRestrict: [] },\r\n          Within: { spatial: true, fieldRestrict: [] },\r\n        };\r\n        break;\r\n      case 'basic':\r\n        effectiveOperators = {\r\n          PropertyIsEqualTo: { spatial: false, fieldRestrict: [] },\r\n          PropertyIsNotEqualTo: { spatial: false, fieldRestrict: [] }\r\n        };\r\n        break;\r\n        case 'time':\r\n          effectiveOperators = {\r\n            During: { spatial: false, fieldRestrict: [] },\r\n          };\r\n          break;\r\n      case 'basicnumeric':\r\n        effectiveOperators = {\r\n          PropertyIsEqualTo: { spatial: false, fieldRestrict: [] },\r\n          PropertyIsNotEqualTo: { spatial: false, fieldRestrict: [] },\r\n          PropertyIsGreaterThan: { spatial: false, fieldRestrict: ['number'] },\r\n          PropertyIsGreaterThanOrEqualTo: { spatial: false, fieldRestrict: ['number'] },\r\n          PropertyIsLessThan: { spatial: false, fieldRestrict: ['number'] },\r\n          PropertyIsLessThanOrEqualTo: { spatial: false, fieldRestrict: ['number'] },\r\n        };\r\n        break;\r\n      default:\r\n        effectiveOperators = {\r\n          PropertyIsEqualTo: { spatial: false, fieldRestrict: [] },\r\n          PropertyIsNotEqualTo: { spatial: false, fieldRestrict: [] },\r\n          Intersects: { spatial: true, fieldRestrict: [] },\r\n          Within: { spatial: true, fieldRestrict: [] },\r\n        };\r\n    }\r\n\r\n    return effectiveOperators;\r\n  }\r\n\r\n  public addInterfaceFilter(\r\n    igoOgcFilterObject?,\r\n    geometryName?,\r\n    level = 0,\r\n    parentLogical = 'Or'\r\n  ): OgcInterfaceFilterOptions {\r\n    if (!igoOgcFilterObject) {\r\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\r\n    }\r\n    const f = {\r\n      propertyName: '',\r\n      operator: '',\r\n      active: '',\r\n      filterid: uuid(),\r\n      begin: '',\r\n      end: '',\r\n      lowerBoundary: '',\r\n      upperBoundary: '',\r\n      expression: '',\r\n      pattern: '',\r\n      wildCard: '*',\r\n      singleChar: '.',\r\n      escapeChar: '!',\r\n      matchCase: true,\r\n      igoSpatialSelector: '',\r\n      geometryName: '',\r\n      geometry: '',\r\n      wkt_geometry: '',\r\n      extent: '',\r\n      srsName: '',\r\n      parentLogical: '',\r\n      level: 0\r\n    };\r\n\r\n    return Object.assign(\r\n      f,\r\n      {\r\n        parentLogical,\r\n        level,\r\n        geometryName\r\n      },\r\n      igoOgcFilterObject\r\n    );\r\n  }\r\n\r\n  public checkIgoFiltersProperties(\r\n    filterObject: any,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterArray = [];\r\n    if (filterObject instanceof Array) {\r\n      filterObject.forEach(element => {\r\n        filterArray.push(\r\n          this.checkIgoFiltersProperties(element, fieldNameGeometry, proj, active)\r\n        );\r\n      });\r\n      return filterArray;\r\n    } else {\r\n      if (filterObject.hasOwnProperty('logical')) {\r\n        return Object.assign(\r\n          {},\r\n          {\r\n            logical: filterObject.logical,\r\n            filters: this.checkIgoFiltersProperties(\r\n              filterObject.filters,\r\n              fieldNameGeometry,\r\n              proj,\r\n              active\r\n            )\r\n          }\r\n        );\r\n      } else if (filterObject.hasOwnProperty('operator')) {\r\n        return this.addFilterProperties(\r\n          filterObject as OgcInterfaceFilterOptions,\r\n          fieldNameGeometry,\r\n          proj,\r\n          active\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private addFilterProperties(\r\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\r\n    fieldNameGeometry,\r\n    proj: olProjection,\r\n    active = false\r\n  ) {\r\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\r\n      ? igoOgcFilterObject.filterid\r\n      : uuid();\r\n    const status = igoOgcFilterObject.hasOwnProperty('active')\r\n      ? igoOgcFilterObject.active\r\n      : active;\r\n\r\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\r\n      ? igoOgcFilterObject.srsName\r\n      : proj ? proj.getCode() : 'EPSG:3857';\r\n\r\n    return Object.assign(\r\n      {},\r\n      {\r\n        filterid,\r\n        active: status,\r\n        igoSpatialSelector: 'fixedExtent',\r\n        srsName\r\n      },\r\n      igoOgcFilterObject,\r\n      { geometryName: fieldNameGeometry }\r\n    );\r\n  }\r\n\r\n  public rebuiltIgoOgcFilterObjectFromSequence(\r\n    sequence: OgcInterfaceFilterOptions[]\r\n  ): IgoOgcFilterObject {\r\n    if (sequence instanceof Array) {\r\n      if (sequence.length >= 1) {\r\n        let lastParentLogical = sequence[0].parentLogical;\r\n        let nextElement: any;\r\n        let logicalArray = [];\r\n        let lastProcessedFilter;\r\n        sequence.forEach(uiFilter => {\r\n          const element = Object.assign({}, uiFilter);\r\n          const index = sequence.indexOf(uiFilter);\r\n          if (index >= 0 && index < sequence.length - 1) {\r\n            nextElement = sequence[index + 1];\r\n          } else {\r\n            nextElement = element;\r\n          }\r\n          delete element.active;\r\n          delete element.filterid;\r\n          delete element.parentLogical;\r\n          logicalArray.push(element);\r\n\r\n          if (sequence.length === 1) {\r\n            lastProcessedFilter = element;\r\n          } else if (lastParentLogical !== nextElement.parentLogical) {\r\n            if (logicalArray.length === 1) {\r\n              console.log(\r\n                'You must set at ' +\r\n                  'least two operator in a logical (' +\r\n                  lastParentLogical +\r\n                  ')'\r\n              );\r\n            } else {\r\n              lastProcessedFilter = Object.assign(\r\n                {},\r\n                { logical: lastParentLogical, filters: logicalArray }\r\n              );\r\n              logicalArray = [lastProcessedFilter];\r\n              lastParentLogical = nextElement.parentLogical;\r\n            }\r\n          }\r\n        });\r\n        return lastProcessedFilter;\r\n      } else {\r\n        return undefined;\r\n      }\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private computeIgoPushButton(pushButtons: IgoPushButton): IgoPushButton {\r\n    if (pushButtons.groups.every(group => group.computedButtons !== undefined)) {\r\n      return pushButtons;\r\n    }\r\n    let pb: IgoPushButton;\r\n    if (pushButtons.groups && pushButtons.bundles) {\r\n      if (!pushButtons.bundles.every(bundle => bundle.id !== undefined)) {\r\n        throw new Error('You must set an id for each of your pushButtons bundles');\r\n      }\r\n      pb = ObjectUtils.copyDeep(pushButtons);\r\n      pb.groups.forEach(group => {\r\n        group.title = group.title ? group.title : group.name;\r\n        group.enabled = group.enabled ? group.enabled : false;\r\n        group.computedButtons = ObjectUtils.copyDeep(pb.bundles.filter(b => group.ids.includes(b.id)));\r\n      });\r\n    } else if (!pushButtons.groups && pushButtons.bundles) {\r\n      pb = ObjectUtils.copyDeep(pushButtons);\r\n      pb.groups = [{ title: 'group1', name: 'group1', computedButtons: ObjectUtils.copyDeep(pb.bundles) } as PushButtonGroup];\r\n    } else {\r\n      pb = {\r\n        bundles: pushButtons as OgcPushButtonBundle[],\r\n        groups: [\r\n          {\r\n            title: 'group1', name: 'group1',\r\n            computedButtons: ObjectUtils.copyDeep(pushButtons) as OgcPushButtonBundle[]\r\n          } as PushButtonGroup]\r\n      };\r\n    }\r\n    if (!pb.groups.find(pbGroup => pbGroup.enabled)) {\r\n      pb.groups[0].enabled = true;\r\n    }\r\n    return pb;\r\n  }\r\n\r\n  public handleOgcFiltersAppliedValue(\r\n    options: OgcFilterableDataSourceOptions,\r\n    fieldNameGeometry: string,\r\n    extent?: [number, number, number, number],\r\n    proj?: olProjection): string {\r\n    const ogcFilters = options.ogcFilters;\r\n    if (!ogcFilters) {\r\n      return;\r\n    }\r\n    let filterQueryStringPushButton = '';\r\n    let filterQueryStringAdvancedFilters = '';\r\n    if (ogcFilters.enabled && ogcFilters.pushButtons) {\r\n      ogcFilters.pushButtons = this.computeIgoPushButton(ogcFilters.pushButtons);\r\n      const pushButtonBundle = ogcFilters.pushButtons.groups.find(g => g.enabled).computedButtons;\r\n      const conditions = [];\r\n      pushButtonBundle.map(buttonBundle => {\r\n        const bundleCondition = [];\r\n        buttonBundle.buttons\r\n          .filter(ogcpb => ogcpb.enabled === true)\r\n          .forEach(enabledPb => bundleCondition.push(enabledPb.filters));\r\n        if (bundleCondition.length === 1) {\r\n          conditions.push(bundleCondition[0]);\r\n        } else if (bundleCondition.length > 1) {\r\n          conditions.push({ logical: buttonBundle.logical, filters: bundleCondition });\r\n        }\r\n      });\r\n      if (conditions.length >= 1) {\r\n        filterQueryStringPushButton = this.buildFilter(\r\n            conditions.length === 1 ? conditions[0] : { logical: 'And', filters: conditions },\r\n            extent,\r\n            proj,\r\n            ogcFilters.geometryName\r\n          );\r\n      }\r\n    }\r\n\r\n    if (ogcFilters.enabled && ogcFilters.filters) {\r\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\r\n      const igoFilters = ogcFilters.filters;\r\n      filterQueryStringAdvancedFilters = this.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName);\r\n    }\r\n\r\n    let filterQueryString = ogcFilters.advancedOgcFilters ? filterQueryStringAdvancedFilters : filterQueryStringPushButton;\r\n    if (options.type === 'wms') {\r\n      filterQueryString = this.formatProcessedOgcFilter(filterQueryString, (options as any).params.LAYERS);\r\n    }\r\n    if (options.type === 'wfs') {\r\n      filterQueryString = this.formatProcessedOgcFilter(filterQueryString, (options as any).params.featureTypes);\r\n    }\r\n\r\n    return filterQueryString;\r\n\r\n  }\r\n\r\n  public formatProcessedOgcFilter(\r\n    processedFilter: string,\r\n    layersOrTypenames: string): string {\r\n    let appliedFilter = '';\r\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\r\n      appliedFilter = processedFilter;\r\n    } else {\r\n      layersOrTypenames.split(',').forEach(layerOrTypenames => {\r\n        appliedFilter = `${appliedFilter}(${processedFilter.replace('filter=', '')})`;\r\n      });\r\n    }\r\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\r\n    const filterValue = appliedFilter.length > 0 ? appliedFilter.replace('filter=', '') : undefined;\r\n    return filterValue;\r\n  }\r\n}\r\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport * as OlFormat from 'ol/format';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatGML32 from 'ol/format/GML32';\r\nimport olFormatOSMXML from 'ol/format/OSMXML';\r\n\r\nexport const defaultEpsg = 'EPSG:3857';\r\nexport const defaultMaxFeatures = 5000;\r\nexport const defaultWfsVersion = '2.0.0';\r\nexport const defaultFieldNameGeometry = 'geometry';\r\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\r\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\r\n\r\n/**\r\n * This method build/standardize WFS call query params based on the layer property.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\r\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\r\n * @param properties  String: Used to control the queried fields  (WFS service).\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function formatWFSQueryString(\r\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n  count?: number,\r\n  epsg?: string,\r\n  properties?: string\r\n): { name: string; value: string }[] {\r\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\r\n  const url = dataSourceOptions.urlWfs;\r\n  const paramsWFS = dataSourceOptions.paramsWFS;\r\n  const effectiveCount = count || defaultMaxFeatures;\r\n  const epsgCode = epsg || defaultEpsg;\r\n  const outputFormat = paramsWFS.outputFormat\r\n    ? `outputFormat=${paramsWFS.outputFormat}`\r\n    : '';\r\n  const version = paramsWFS.version\r\n    ? `version=${paramsWFS.version}`\r\n    : `version=${defaultWfsVersion}`;\r\n  const paramTypename =\r\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\r\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\r\n  const paramMaxFeatures =\r\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\r\n  const cnt = count\r\n    ? `${paramMaxFeatures}=${effectiveCount}`\r\n    : paramsWFS.maxFeatures\r\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\r\n    : `${paramMaxFeatures}=${effectiveCount}`;\r\n  const srs = epsg\r\n    ? `srsname=${epsgCode}`\r\n    : paramsWFS.srsName\r\n    ? 'srsname=' + paramsWFS.srsName\r\n    : `srsname=${epsgCode}`;\r\n\r\n  let propertyName = '';\r\n  let valueReference = '';\r\n  if (properties) {\r\n    propertyName = `propertyName=${properties}`;\r\n    valueReference = `valueReference=${properties}`;\r\n  }\r\n  const sourceFields = dataSourceOptions.sourceFields;\r\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\r\n    const fieldsNames = [];\r\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\r\n      fieldsNames.push(sourcefield.name);\r\n    });\r\n    propertyName = `propertyName=${fieldsNames.join(',')},${\r\n      paramsWFS.fieldNameGeometry\r\n    }`;\r\n  }\r\n\r\n  const getCapabilities = `${url}?service=WFS&request=GetCapabilities&${version}`;\r\n  let getFeature = `${url}?service=WFS&request=GetFeature&${version}&${featureTypes}&`;\r\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}`;\r\n\r\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\r\n  getpropertyvalue += `&${cnt}&${valueReference}`;\r\n\r\n  return [\r\n    { name: 'outputformat', value: outputFormat },\r\n    { name: 'version', value: version },\r\n    { name: 'typename', value: featureTypes },\r\n    { name: 'count', value: cnt },\r\n    { name: 'srsname', value: srs },\r\n    { name: 'propertyname', value: propertyName },\r\n    { name: 'valuereference', value: valueReference },\r\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\r\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\r\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\r\n  ];\r\n}\r\n\r\n/**\r\n * Validate/Modify layer's wfs options based on :\r\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\r\n * https://github.com/openlayers/openlayers/pull/6400\r\n * 2- Set default values for optionals parameters.\r\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\r\n * @returns An array array of {name: '', value: ''} of predefined query params.\r\n */\r\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\r\n  if (srcType && srcType === 'wfs') {\r\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\r\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\r\n  }\r\n\r\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\r\n  wfsDataSourceOptions.urlWfs =\r\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\r\n\r\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\r\n  paramsWFS.fieldNameGeometry =\r\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\r\n\r\n  let outputFormat;\r\n  if (paramsWFS.outputFormat) {\r\n    outputFormat = paramsWFS.outputFormat;\r\n  }\r\n\r\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\r\n    paramsWFS.version = '1.1.0';\r\n  }\r\n  return Object.assign({}, wfsDataSourceOptions);\r\n}\r\n\r\nexport function getFormatFromOptions(\r\n  options: WFSDataSourceOptions | WMSDataSourceOptions\r\n) {\r\n  const wfsOptions = options as WFSDataSourceOptions;\r\n\r\n  let olFormatCls = OlFormat.WFS;\r\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\r\n    ? wfsOptions.paramsWFS.outputFormat\r\n    : undefined;\r\n\r\n  if (!outputFormat) {\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  if (OlFormat[outputFormat]) {\r\n    olFormatCls = OlFormat[outputFormat];\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gml2')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...Â { gmlFormat: olFormatGML2 }});\r\n  } else if (outputFormat.toLowerCase().match('gml32')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...Â { gmlFormat: olFormatGML32 }});\r\n  } else if (outputFormat.toLowerCase().match('gml3')) {\r\n    olFormatCls = OlFormat.WFS;\r\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...Â { gmlFormat: olFormatGML3 }});\r\n  } else if (outputFormat.toLowerCase().match('topojson')) {\r\n    olFormatCls = OlFormat.TopoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('geojson')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\r\n    olFormatCls = OlFormat.EsriJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('json')) {\r\n    olFormatCls = OlFormat.GeoJSON;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('gpx')) {\r\n    olFormatCls = OlFormat.GPX;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('WKT')) {\r\n    olFormatCls = OlFormat.WKT;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\r\n    olFormatCls = olFormatOSMXML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  } else if (outputFormat.toLowerCase().match('kml')) {\r\n    olFormatCls = OlFormat.KML;\r\n    return new olFormatCls(wfsOptions.formatOptions);\r\n  }\r\n\r\n  return new olFormatCls();\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport {\r\n  formatWFSQueryString,\r\n  defaultFieldNameGeometry,\r\n  checkWfsParams,\r\n  getFormatFromOptions\r\n} from './wms-wfs.utils';\r\n\r\nexport class WFSDataSource extends DataSource {\r\n  public ol: olSourceVector;\r\n\r\n  constructor(\r\n    public options: WFSDataSourceOptions,\r\n    protected wfsService: WFSService\r\n  ) {\r\n    super(checkWfsParams(options, 'wfs'));\r\n\r\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\r\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\r\n    if (\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\r\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable\r\n    ) {\r\n      this.wfsService.getSourceFieldsFromWFS(this.options);\r\n    }\r\n  }\r\n\r\n  protected createOlSource(): olSourceVector {\r\n\r\n    return new olSourceVector({\r\n      format: getFormatFromOptions(this.options),\r\n      overlaps: false,\r\n      url: (extent, resolution, proj: olProjection) => {\r\n        this.options.paramsWFS.srsName = this.options.paramsWFS.srsName || proj.getCode();\r\n        return this.buildUrl(\r\n          extent,\r\n          proj,\r\n          (this.options as OgcFilterableDataSourceOptions).ogcFilters);\r\n      },\r\n      strategy: OlLoadingStrategy.bbox\r\n    });\r\n  }\r\n\r\n  private buildUrl(extent, proj: olProjection, ogcFilters: OgcFiltersOptions): string {\r\n    const paramsWFS = this.options.paramsWFS;\r\n    const queryStringValues = formatWFSQueryString(this.options, undefined, this.options.paramsWFS.srsName);\r\n    let igoFilters;\r\n    if (ogcFilters && ogcFilters.enabled) {\r\n      igoFilters = ogcFilters.filters;\r\n    }\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n    const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName);\r\n    let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(this.options, ogcFilters.geometryName);\r\n\r\n    let prefix = 'filter';\r\n    if (!filterOrPush) {\r\n      prefix = 'bbox';\r\n      filterOrPush = extent.join(',') + ',' + proj.getCode();\r\n    }\r\n\r\n    paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\r\n    let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\r\n    const patternFilter = /(filter|bbox)=.*/gi;\r\n    baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\r\n    this.options.download = Object.assign({}, this.options.download, { dynamicUrl: baseUrl });\r\n    return baseUrl.replace(/&&/g, '&');\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport olFeature from 'ol/Feature';\r\nimport * as olformat from 'ol/format';\r\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { DataService } from './data.service';\r\nimport { formatWFSQueryString,\r\n          gmlRegex,\r\n          defaultEpsg,\r\n          defaultMaxFeatures,\r\n          getFormatFromOptions} from './wms-wfs.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WFSService extends DataService {\r\n  constructor(private http: HttpClient) {\r\n    super();\r\n  }\r\n\r\n  getData() {\r\n    console.log('This is defining a data service.');\r\n    return 'This is defining a data service.';\r\n  }\r\n\r\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\r\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\r\n      dataSourceOptions.sourceFields = [];\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\r\n        dataSourceOptions.sourceFields = getfeatureSourceField;\r\n      });\r\n\r\n    } else {\r\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\r\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\r\n          if (sourcefield.alias === undefined) {\r\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\r\n          }\r\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\r\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\r\n          }\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  private wfsGetFeature(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\r\n    nb: number = defaultMaxFeatures,\r\n    epsgCode: string = defaultEpsg,\r\n    propertyName?: string\r\n  ): Observable<any> {\r\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName);\r\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\r\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\r\n    if (gmlRegex.test(outputFormat) || !outputFormat) {\r\n      return this.http.get(baseUrl, { responseType: 'text' });\r\n    } else {\r\n      return this.http.get(baseUrl);\r\n    }\r\n  }\r\n\r\n  defineFieldAndValuefromWFS(\r\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\r\n  ): Observable<any> {\r\n    return new Observable(d => {\r\n      const sourceFields = [];\r\n      let fieldList;\r\n      let fieldListWoGeom;\r\n      let fieldListWoGeomStr;\r\n      let olFormats;\r\n\r\n      olFormats = getFormatFromOptions(dataSourceOptions);\r\n\r\n      this.wfsGetFeature(dataSourceOptions, 1).subscribe(oneFeature => {\r\n        const features = olFormats.readFeatures(oneFeature);\r\n        fieldList = features[0].getKeys();\r\n        fieldListWoGeom = fieldList.filter(\r\n          field =>\r\n            field !== features[0].getGeometryName() &&\r\n            !field.match(/boundedby/gi)\r\n        );\r\n        fieldListWoGeomStr = fieldListWoGeom.join(',');\r\n        this.wfsGetFeature(\r\n          dataSourceOptions,\r\n          dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\r\n          dataSourceOptions.paramsWFS.srsName,\r\n          fieldListWoGeomStr\r\n        ).subscribe(manyFeatures => {\r\n          const mfeatures = olFormats.readFeatures(manyFeatures);\r\n          this.built_properties_value(mfeatures).forEach(element => {\r\n            sourceFields.push(element);\r\n          });\r\n          d.next(sourceFields);\r\n          d.complete();\r\n        });\r\n      });\r\n\r\n    });\r\n  }\r\n\r\n  private built_properties_value(features: olFeature[]): string[] {\r\n    const kv = Object.assign({}, features[0].getProperties());\r\n    delete kv[features[0].getGeometryName()];\r\n    delete kv.boundedBy;\r\n    const sourceFields = [];\r\n    for (const property in kv) {\r\n      if (kv.hasOwnProperty(property)) {\r\n        const fieldType =\r\n          typeof features[0].get(property) === 'object'\r\n            ? undefined\r\n            : typeof features[0].get(property);\r\n        sourceFields.push({\r\n          name: property,\r\n          alias: property,\r\n          type: fieldType,\r\n          values: [kv[property]]\r\n        });\r\n      }\r\n    }\r\n    features.every((element) => {\r\n      const featureProperties = element.getProperties();\r\n      for (const key in featureProperties) {\r\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\r\n          sourceFields.filter(f => f.name === key).forEach(v => {\r\n            if (v.values.indexOf(featureProperties[key]) === -1) {\r\n              v.values.push(featureProperties[key]);\r\n            }\r\n          });\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n    return sourceFields;\r\n  }\r\n}\r\n","export enum QueryFormat {\r\n  GML2 = 'gml2',\r\n  GML3 = 'gml3',\r\n  JSON = 'json',\r\n  GEOJSON = 'geojson',\r\n  GEOJSON2 = 'geojson2',\r\n  ESRIJSON = 'esrijson',\r\n  TEXT = 'text',\r\n  HTML = 'html',\r\n  HTMLGML2 = 'htmlgml2'\r\n}\r\n\r\nexport enum QueryFormatMimeType {\r\n  GML2 = 'application/vnd.ogc.gml',\r\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\r\n  JSON = 'application/json',\r\n  GEOJSON = 'application/geojson',\r\n  GEOJSON2 = 'geojson',\r\n  ESRIJSON = 'application/json',\r\n  TEXT = 'text/plain',\r\n  HTML = 'text/html',\r\n  HTMLGML2 = 'text/html'\r\n}\r\n\r\nexport enum QueryHtmlTarget {\r\n  IFRAME = 'iframe',\r\n  BLANK = '_blank'\r\n}\r\n","import olSourceImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\r\nimport { WFSService } from './wfs.service';\r\n\r\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\r\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\nimport {\r\n  formatWFSQueryString,\r\n  checkWfsParams,\r\n  defaultFieldNameGeometry\r\n} from './wms-wfs.utils';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nexport class WMSDataSource extends DataSource {\r\n  public ol: olSourceImageWMS;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  constructor(\r\n    public options: WMSDataSourceOptions,\r\n    protected wfsService: WFSService\r\n  ) {\r\n    super(options);\r\n    const sourceParams: any = options.params;\r\n\r\n    const dpi = sourceParams.DPI || 96;\r\n    sourceParams.DPI = dpi;\r\n    sourceParams.MAP_RESOLUTION = dpi;\r\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\r\n\r\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\r\n      setInterval(() => {\r\n        this.refresh();\r\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\r\n    }\r\n\r\n    let fieldNameGeometry = defaultFieldNameGeometry;\r\n\r\n    // ####   START if paramsWFS\r\n    if (options.paramsWFS) {\r\n      const wfsCheckup = checkWfsParams(options, 'wms');\r\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\r\n\r\n      fieldNameGeometry =\r\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\r\n\r\n      options.download = Object.assign({}, options.download, {\r\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\r\n      });\r\n    } //  ####   END  if paramsWFS\r\n\r\n    if (!options.sourceFields || options.sourceFields.length === 0) {\r\n      options.sourceFields = [];\r\n    } else {\r\n      options.sourceFields.forEach(sourceField => {\r\n        sourceField.alias = sourceField.alias\r\n          ? sourceField.alias\r\n          : sourceField.name;\r\n        // to allow only a list of sourcefield with names\r\n      });\r\n    }\r\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\r\n      .ogcFilters;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (!initOgcFilters) {\r\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\r\n        initOgcFilters,\r\n        fieldNameGeometry,\r\n        'wms'\r\n      );\r\n    } else {\r\n      initOgcFilters.advancedOgcFilters = initOgcFilters.pushButtons\r\n        ? false\r\n        : true;\r\n    }\r\n\r\n    if (\r\n      sourceParams.LAYERS.split(',').length > 1 &&\r\n      initOgcFilters &&\r\n      initOgcFilters.enabled\r\n    ) {\r\n      console.log('*******************************');\r\n      console.log(\r\n        'BE CAREFULL, YOUR WMS LAYERS (' +\r\n          sourceParams.LAYERS +\r\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\r\n      );\r\n      console.log('*******************************');\r\n    }\r\n\r\n    if (options.paramsWFS && initOgcFilters && initOgcFilters.enabled && initOgcFilters.editable) {\r\n      this.wfsService.getSourceFieldsFromWFS(options);\r\n    }\r\n\r\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\r\n      options,\r\n      fieldNameGeometry\r\n    );\r\n    sourceParams.FILTER = filterQueryString;\r\n  }\r\n\r\n  refresh() {\r\n    this.ol.updateParams({ igoRefresh: Math.random() });\r\n  }\r\n\r\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\r\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\r\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\r\n      .value;\r\n    return downloadUrl;\r\n  }\r\n\r\n  protected createOlSource(): olSourceImageWMS {\r\n    return new olSourceImageWMS(this.options);\r\n  }\r\n\r\n  getLegend(style?: string, scale?: number): Legend[] {\r\n    let legend = super.getLegend();\r\n    if (legend.length > 0 && (style === undefined && !scale)) {\r\n      return legend;\r\n    }\r\n\r\n    const sourceParams = this.params;\r\n\r\n    let layers = [];\r\n    if (sourceParams.LAYERS !== undefined) {\r\n      layers = sourceParams.LAYERS.split(',');\r\n    }\r\n\r\n    const baseUrl = this.options.url.replace(/\\?$/, '');\r\n    const params = [\r\n      'REQUEST=GetLegendGraphic',\r\n      'SERVICE=WMS',\r\n      'FORMAT=image/png',\r\n      'SLD_VERSION=1.1.0',\r\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\r\n    ];\r\n    if (style !== undefined) {\r\n      params.push(`STYLE=${style}`);\r\n    }\r\n    if (scale !== undefined) {\r\n      params.push(`SCALE=${scale}`);\r\n    }\r\n\r\n    legend = layers.map((layer: string) => {\r\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\r\n      return {\r\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\r\n        title: layers.length > 1 ? layer : undefined,\r\n        currentStyle: style === undefined ? undefined : style as string\r\n      };\r\n    });\r\n\r\n    return legend;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\r\nimport * as olproj from 'ol/proj';\r\nimport {\r\n  getTopLeft as extentGetTopLeft,\r\n  getWidth as extentGetWidth\r\n} from 'ol/extent.js';\r\n\r\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\r\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\r\n  const projectionExtent = projection.getExtent();\r\n  const size = extentGetWidth(projectionExtent) / 256;\r\n  const resolutions = new Array(20);\r\n  const matrixIds = new Array(20);\r\n  for (let z = 0; z < 20; ++z) {\r\n    resolutions[z] = size / Math.pow(2, z);\r\n    matrixIds[z] = z;\r\n  }\r\n\r\n  return new olTileGridWMTS({\r\n    origin: extentGetTopLeft(projectionExtent),\r\n    resolutions,\r\n    matrixIds\r\n  });\r\n}\r\n","import olSourceWMTS from 'ol/source/WMTS';\r\n\r\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\r\nimport { DataSource } from './datasource';\r\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\r\n\r\nexport class WMTSDataSource extends DataSource {\r\n  public options: WMTSDataSourceOptions;\r\n  public ol: olSourceWMTS;\r\n\r\n  constructor(options: WMTSDataSourceOptions) {\r\n    super(options);\r\n  }\r\n\r\n  protected createOlSource(): olSourceWMTS {\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\r\n      },\r\n      this.options\r\n    );\r\n\r\n    return new olSourceWMTS(sourceOptions);\r\n  }\r\n\r\n  public onUnwatch() {}\r\n\r\n}\r\n","import olSourceCarto from 'ol/source/CartoDB';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\n\r\nexport class CartoDataSource extends DataSource {\r\n  public ol: olSourceCarto;\r\n  public options: CartoDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceCarto {\r\n    const crossOrigin = this.options.crossOrigin\r\n      ? this.options.crossOrigin\r\n      : 'anonymous';\r\n    const sourceOptions = Object.assign(\r\n      {\r\n        crossOrigin\r\n      },\r\n      this.options\r\n    );\r\n    return new olSourceCarto(sourceOptions);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legend = super.getLegend();\r\n    if (legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    let htmlString = '<table>';\r\n    if (this.options.config.layers[0].legend != null) {\r\n      this.options.config.layers[0].legend.items.forEach(f => {\r\n        if (f.visible === true) {\r\n          htmlString +=\r\n            '<tr><td>' +\r\n            '<p><font size=\"5\" color=\"' +\r\n            f.value +\r\n            '\"> &#9679</font></p></td>' +\r\n            '<td>' +\r\n            f.name +\r\n            '</td></tr>';\r\n        }\r\n      });\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    } else {\r\n      // Try to build the legend from the cartocss options\r\n      const layerOptions = this.options.config.layers[0].options;\r\n      // All available cartocss style options\r\n      const types = [\r\n        'polygon-fill:',\r\n        'marker-fill:',\r\n        'shield-fill:',\r\n        'building-fill:',\r\n        'line-color:'\r\n      ];\r\n      for (const oneType of types) {\r\n        if (layerOptions.cartocss.includes(oneType)) {\r\n          const type = layerOptions.cartocss.split(oneType).pop();\r\n          const color = type.substr(0, type.indexOf(';'));\r\n          if (color.includes('ramp')) {\r\n            const colors = color.split(', (')[1].split(',');\r\n            const data = color.split(', (')[2].split(',');\r\n            for (let j = 0; j < colors.length; j++) {\r\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\r\n              data[j] = data[j].replace(/(\"|\\))/g, '');\r\n              if (data[j].replace(/\\s+/g, '') === '=') {\r\n                data[j] = 'Autres';\r\n              }\r\n              htmlString +=\r\n                '<tr><td>' +\r\n                '<p><font size=\"5\" color=\"' +\r\n                colors[j] +\r\n                '\"> &#9679</font></p></td>' +\r\n                '<td>' +\r\n                data[j] +\r\n                '</td></tr>';\r\n            }\r\n            break;\r\n          } else {\r\n            const title = layerOptions.layer_name\r\n              ? layerOptions.layer_name\r\n              : '';\r\n            htmlString +=\r\n              '<tr><td>' +\r\n              '<p><font size=\"5\" color=\"' +\r\n              color +\r\n              '\"> &#9679</font></p>' +\r\n              '</td><td>' +\r\n              title +\r\n              '</td></tr>';\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      htmlString += '</table>';\r\n      return [{ html: htmlString }];\r\n    }\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport * as olloadingstrategy from 'ol/loadingstrategy';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\r\n\r\nexport class ArcGISRestDataSource extends DataSource {\r\n  public ol: olSourceVector;\r\n  public options: ArcGISRestDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector {\r\n    const esrijsonFormat = new olFormatEsriJSON();\r\n    return new olSourceVector({\r\n      attributions: this.options.params.attributions,\r\n      overlaps: false,\r\n      format: esrijsonFormat,\r\n      url: function(extent, resolution, proj) {\r\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        if (this.options.params.timeFilter) {\r\n          const time = `time=${this.options.params.timeExtent}`;\r\n          params.push(time);\r\n        }\r\n        if (this.options.params.customParams) {\r\n          this.options.params.customParams.forEach(element => {\r\n            params.push(element);\r\n          });\r\n        }\r\n        return `${baseUrl}?${params.join('&')}`;\r\n      }.bind(this),\r\n      strategy: olloadingstrategy.bbox\r\n    });\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legendInfo = this.options.params.legendInfo;\r\n    const legend = super.getLegend();\r\n    if (legendInfo === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    const id = parseInt(this.options.layer, 10);\r\n    const lyr = legendInfo.layers[id];\r\n    let htmlString = '<table><tr><td>' + lyr.layerName + '</td></tr>';\r\n\r\n    for (const lyrLegend of lyr.legend) {\r\n      const modifiedUrl = this.options.url.replace(\r\n        'FeatureServer',\r\n        'MapServer'\r\n      );\r\n      const src = `${modifiedUrl}/${lyr.layerId}/images/${lyrLegend.url}`;\r\n      const label = lyrLegend.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td>` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { Legend } from './datasource.interface';\r\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\r\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\r\n\r\nexport class TileArcGISRestDataSource extends DataSource {\r\n  public ol: olSourceTileArcGISRest;\r\n  public options: TileArcGISRestDataSourceOptions;\r\n\r\n  get params(): any {\r\n    return this.options.params as any;\r\n  }\r\n\r\n  get queryTitle(): string {\r\n    return (this.options as any).queryTitle\r\n      ? (this.options as any).queryTitle\r\n      : 'title';\r\n  }\r\n\r\n  get mapLabel(): string {\r\n    return (this.options as any).mapLabel;\r\n  }\r\n\r\n  get queryHtmlTarget(): string {\r\n    return (this.options as any).queryHtmlTarget\r\n      ? (this.options as any).queryHtmlTarget\r\n      : QueryHtmlTarget.BLANK;\r\n  }\r\n\r\n  protected createOlSource(): olSourceTileArcGISRest {\r\n    return new olSourceTileArcGISRest(this.options);\r\n  }\r\n\r\n  getLegend(): Legend[] {\r\n    const legend = super.getLegend();\r\n    if (this.options.legendInfo === undefined || legend.length > 0) {\r\n      return legend;\r\n    }\r\n\r\n    const id = parseInt(this.options.layer, 10);\r\n    const lyr = this.options.legendInfo.layers[id];\r\n    let htmlString = '<table><tr><td>' + lyr.layerName + '</td></tr>';\r\n\r\n    for (const lyrLegend of lyr.legend) {\r\n      const src = `${this.options.url}/${lyr.layerId}/images/${\r\n        lyrLegend.url\r\n      }`;\r\n      const label = lyrLegend.label.replace('<Null>', 'Null');\r\n      htmlString +=\r\n        `<tr><td align='left'><img src=\"` +\r\n        src +\r\n        `\" alt ='' /></td><td>` +\r\n        label +\r\n        '</td></tr>';\r\n    }\r\n    htmlString += '</table>';\r\n    return [{ html: htmlString }];\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport * as olformat from 'ol/format';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { easeOut } from 'ol/easing';\r\nimport { Circle as CircleStyle, Fill, Stroke, Style } from 'ol/style';\r\n\r\nimport { Md5 } from 'ts-md5';\r\n\r\nimport { uuid } from '@igo2/utils';\r\nimport { FeatureDataSource } from './feature-datasource';\r\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\r\n\r\nexport class WebSocketDataSource extends FeatureDataSource {\r\n  public ws: WebSocket;\r\n  public options: WebSocketDataSourceOptions;\r\n\r\n  protected createOlSource(): olSourceVector {\r\n    this.createWebSocket();\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    return super.createOlSource();\r\n  }\r\n\r\n  private createWebSocket() {\r\n    this.ws = new WebSocket(this.options.url);\r\n    this.ws.onmessage = this.onMessage.bind(this);\r\n\r\n    if (this.options.onclose) {\r\n      this.ws.onclose = this.onClose.bind(this);\r\n    }\r\n\r\n    if (this.options.onerror) {\r\n      this.ws.onerror = this.onError.bind(this);\r\n    }\r\n\r\n    if (this.options.onopen) {\r\n      this.ws.onopen = this.onOpen.bind(this);\r\n    }\r\n  }\r\n\r\n  onMessage(event) {\r\n    const featureAdded = this.options.format.readFeature(event.data);\r\n\r\n    switch (this.options.onmessage) {\r\n      case 'update':\r\n        // ol don't add if same ID\r\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\r\n        if (featureToRemove) {\r\n          this.ol.removeFeature(featureToRemove);\r\n        }\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'delete':\r\n        this.ol.clear(true);\r\n        this.ol.addFeature(featureAdded);\r\n        break;\r\n      case 'add':\r\n      default:\r\n        this.ol.addFeature(featureAdded);\r\n    }\r\n  }\r\n\r\n  onClose(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onError(event) {\r\n    // thrown message to user\r\n  }\r\n\r\n  onOpen(event) {\r\n    // thrown message to user ?\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.ws.close();\r\n  }\r\n}\r\n","import { Md5 } from 'ts-md5';\r\nimport feature from 'ol/Feature';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\nimport olFormatMVT from 'ol/format/MVT';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { DataSource } from './datasource';\r\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\r\n\r\nexport class MVTDataSource extends DataSource {\r\n  public options: MVTDataSourceOptions;\r\n  public ol: olSourceVectorTile;\r\n\r\n  protected createOlSource(): olSourceVectorTile {\r\n    let mvtFormat;\r\n    if (this.options.featureClass === 'feature') {\r\n      mvtFormat = new olFormatMVT({featureClass: feature});\r\n    } else if (this.options.featureClass === undefined) {\r\n      mvtFormat = new olFormatMVT();\r\n    }\r\n    this.options.format = mvtFormat;\r\n    return new olSourceVectorTile(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    if (!this.options.url) {\r\n        return uuid();\r\n    }\r\n    const chain = 'mvt' + this.options.url;\r\n    return Md5.hashStr(chain) as string;\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","import olSourceCluster from 'ol/source/Cluster';\r\n\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { FeatureDataSource } from './feature-datasource';\r\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\r\n\r\nexport class ClusterDataSource extends FeatureDataSource {\r\n  public options: ClusterDataSourceOptions;\r\n  public ol: olSourceCluster;\r\n\r\n  protected createOlSource(): olSourceCluster {\r\n    this.options.format = this.getSourceFormatFromOptions(this.options);\r\n    this.options.source = super.createOlSource();\r\n    return new olSourceCluster(this.options);\r\n  }\r\n\r\n  protected generateId() {\r\n    return uuid();\r\n  }\r\n\r\n  public onUnwatch() {}\r\n}\r\n","export const FEATURE = 'Feature';\r\n\r\nexport enum FeatureMotion {\r\n  None,\r\n  Move,\r\n  Zoom,\r\n  Default\r\n}\r\n","export const LAYER = 'Layer';\r\n","import olLayer from 'ol/layer/Layer';\r\n\r\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\r\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\r\n\r\nexport interface LayerOptions {\r\n  source?: DataSource;\r\n  sourceOptions?: AnyDataSourceOptions;\r\n  title?: string;\r\n  id?: string;\r\n  alias?: string;\r\n  baseLayer?: boolean;\r\n  opacity?: number;\r\n  visible?: boolean;\r\n  extent?: [number, number, number, number];\r\n  zIndex?: number;\r\n  minResolution?: number;\r\n  maxResolution?: number;\r\n  minScaleDenom?: number;\r\n  maxScaleDenom?: number;\r\n  showInLayerList?: boolean;\r\n  removable?: boolean;\r\n  legendOptions?: LegendOptions;\r\n  ol?: olLayer;\r\n  tooltip?: TooltipContent;\r\n  _internal?: { [key: string]: string };\r\n  active?: boolean;\r\n  check?: boolean;\r\n}\r\n\r\nexport interface GroupLayers {\r\n  title: string;\r\n  layers?: LayerOptions;\r\n  collapsed?: boolean;\r\n}\r\n\r\nexport interface TooltipContent {\r\n  type?: TooltipType;\r\n  text?: string;\r\n}\r\nexport enum TooltipType {\r\n  TITLE = 'title',\r\n  ABSTRACT = 'abstract',\r\n  CUSTOM = 'custom'\r\n}\r\n\r\nexport interface LegendOptions {\r\n  collapsed?: boolean;\r\n  display?: boolean;\r\n  url?: string;\r\n  html?: string;\r\n  stylesAvailable?: ItemStyleOptions[];\r\n}\r\n\r\nexport interface ItemStyleOptions {\r\n  name: string;\r\n  title?: string;\r\n}\r\n\r\nexport interface OutputLayerLegend {\r\n  title: string;\r\n  url: string;\r\n  image: string;\r\n}\r\n","import olSourceImage from 'ol/source/Image';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { ImageLayer } from '../shared/layers/image-layer';\r\n\r\nexport class ImageWatcher extends Watcher {\r\n  protected id: string;\r\n  protected loaded = 0;\r\n  protected loading = 0;\r\n\r\n  private source: olSourceImage;\r\n\r\n  constructor(layer: ImageLayer) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\r\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\r\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\r\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\r\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    if (!event.image.__watchers__) {\r\n      event.image.__watchers__ = [];\r\n    }\r\n    event.image.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.image.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.image.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import olSourceTile from 'ol/source/Tile';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { TileLayer } from '../shared/layers/tile-layer';\r\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\r\n\r\nexport class TileWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private source: olSourceTile;\r\n\r\n  constructor(layer: TileLayer | VectorTileLayer) {\r\n    super();\r\n    this.source = layer.options.source.ol;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\r\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\r\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\r\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\r\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\r\n  }\r\n\r\n  private handleLoadStart(event: any) {\r\n    // This is to avoid increasing\r\n    // the number of loaded tiles if a tile was loading\r\n    // before subscribing to this watcher\r\n    if (!event.tile.__watchers__) {\r\n      event.tile.__watchers__ = [];\r\n    }\r\n    event.tile.__watchers__.push(this.id);\r\n\r\n    this.loading += 1;\r\n    this.status = SubjectStatus.Working;\r\n  }\r\n\r\n  private handleLoadEnd(event) {\r\n    if (!event.tile.__watchers__) {\r\n      return;\r\n    }\r\n\r\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\r\n    if (watcherIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    event.tile.__watchers__.splice(watcherIndex, 1);\r\n\r\n    this.loaded += 1;\r\n\r\n    const loading = this.loading;\r\n    if (this.loaded >= loading) {\r\n      if (loading === this.loading) {\r\n        this.status = SubjectStatus.Done;\r\n        this.loaded = this.loading = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Layer } from '../shared/layers/layer';\r\nimport { OutputLayerLegend } from '../shared/layers/layer.interface';\r\n\r\n/**\r\n * Get all the layers legend\r\n * @return Array of legend\r\n */\r\nexport function getLayersLegends(layers: Layer[], scale?: number): OutputLayerLegend[] {\r\n  const legends = [];\r\n  const newCanvas = document.createElement('canvas');\r\n  const newContext = newCanvas.getContext('2d');\r\n  newContext.font = '20px Calibri';\r\n\r\n  let heightPos = 0;\r\n  for (const layer of layers) {\r\n    if (layer.visible === false) { continue; }\r\n\r\n    const legendUrls = layer.dataSource.getLegend(undefined, scale) || [];\r\n    for (const legendUrl of legendUrls) {\r\n      if (legendUrl.url === undefined) { continue; }\r\n\r\n      const title = layer.title;\r\n      // Create an image for the legend\r\n      const legendImage = new Image();\r\n      legendImage.crossOrigin = 'anonymous';\r\n      legendImage.src = legendUrl.url;\r\n      legendImage.onload = () => {\r\n        newContext.fillText(title, 0, heightPos);\r\n        newContext.drawImage(legendImage, 0, heightPos + 20);\r\n        heightPos += legendImage.height + 5;\r\n      };\r\n      // Add legend info to the list\r\n      legends.push({\r\n        title,\r\n        url: legendUrl.url,\r\n        image: legendImage\r\n      });\r\n    }\r\n  }\r\n\r\n  return legends;\r\n}\r\n","import olSourceVector from 'ol/source/Vector';\r\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\r\n\r\nimport { VectorLayer } from '../shared/layers/vector-layer';\r\n\r\nexport class VectorWatcher extends Watcher {\r\n  private id: string;\r\n  private loaded = 0;\r\n  private loading = 0;\r\n\r\n  private layer: VectorLayer;\r\n\r\n  constructor(layer: VectorLayer) {\r\n    super();\r\n    this.layer = layer;\r\n    this.id = uuid();\r\n  }\r\n\r\n  protected watch() {\r\n  }\r\n\r\n  protected unwatch() {\r\n    this.layer.onUnwatch();\r\n  }\r\n}\r\n","import olLayerImage from 'ol/layer/Image';\r\nimport olSourceImage from 'ol/source/Image';\r\n\r\nimport { AuthInterceptor } from '@igo2/auth';\r\n\r\nimport { ImageWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map';\r\n\r\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { ImageLayerOptions } from './image-layer.interface';\r\n\r\nexport class ImageLayer extends Layer {\r\n  public dataSource: WMSDataSource;\r\n  public options: ImageLayerOptions;\r\n  public ol: olLayerImage;\r\n\r\n  private watcher: ImageWatcher;\r\n\r\n  constructor(\r\n    options: ImageLayerOptions,\r\n    public authInterceptor?: AuthInterceptor\r\n  ) {\r\n    super(options, authInterceptor);\r\n    this.watcher = new ImageWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerImage {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceImage\r\n    });\r\n\r\n    const image = new olLayerImage(olOptions);\r\n    if (this.authInterceptor) {\r\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\r\n        this.customLoader(tile, src);\r\n      });\r\n    }\r\n\r\n    return image;\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  private customLoader(tile, src) {\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open('GET', src);\r\n\r\n    const intercepted = this.authInterceptor.interceptXhr(xhr, src);\r\n    if (!intercepted) {\r\n      xhr.abort();\r\n      tile.getImage().src = src;\r\n      return;\r\n    }\r\n\r\n    xhr.responseType = 'arraybuffer';\r\n\r\n    xhr.onload = function() {\r\n      const arrayBufferView = new Uint8Array((this as any).response);\r\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\r\n      const urlCreator = window.URL;\r\n      const imageUrl = urlCreator.createObjectURL(blob);\r\n      tile.getImage().src = imageUrl;\r\n    };\r\n    xhr.send();\r\n  }\r\n}\r\n","import olLayerTile from 'ol/layer/Tile';\r\nimport olSourceTile from 'ol/source/Tile';\r\n\r\nimport { TileWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map';\r\n\r\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\r\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\r\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\r\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\r\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { TileLayerOptions } from './tile-layer.interface';\r\n\r\nexport class TileLayer extends Layer {\r\n  public dataSource:\r\n    | OSMDataSource\r\n    | WMTSDataSource\r\n    | XYZDataSource\r\n    | CartoDataSource\r\n    | TileArcGISRestDataSource;\r\n  public options: TileLayerOptions;\r\n  public ol: olLayerTile;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(options: TileLayerOptions) {\r\n    super(options);\r\n\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerTile {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceTile\r\n    });\r\n\r\n    return new olLayerTile(olOptions);\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n}\r\n","import olLayerVector from 'ol/layer/Vector';\r\nimport olSourceVector from 'ol/source/Vector';\r\nimport { unByKey } from 'ol/Observable';\r\nimport { easeOut } from 'ol/easing';\r\nimport { asArray as ColorAsArray } from 'ol/color';\r\n\r\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\r\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\r\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\r\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\r\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\r\n\r\nimport { VectorWatcher } from '../../utils';\r\nimport { IgoMap } from '../../../map';\r\nimport { Layer } from './layer';\r\nimport { VectorLayerOptions } from './vector-layer.interface';\r\n\r\nexport class VectorLayer extends Layer {\r\n  public dataSource:\r\n    | FeatureDataSource\r\n    | WFSDataSource\r\n    | ArcGISRestDataSource\r\n    | WebSocketDataSource\r\n    | ClusterDataSource;\r\n  public options: VectorLayerOptions;\r\n  public ol: olLayerVector;\r\n  private watcher: VectorWatcher;\r\n  private trackFeatureListenerId;\r\n\r\n  get browsable(): boolean {\r\n    return this.options.browsable !== false;\r\n  }\r\n\r\n  get exportable(): boolean {\r\n    return this.options.exportable !== false;\r\n  }\r\n\r\n  constructor(options: VectorLayerOptions) {\r\n    super(options);\r\n    this.watcher = new VectorWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVector {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVector\r\n    });\r\n\r\n    if (this.options.animation) {\r\n      this.dataSource.ol.on(\r\n        'addfeature',\r\n        function(e) {\r\n          this.flash(e.feature);\r\n        }.bind(this)\r\n      );\r\n    }\r\n\r\n    if (this.options.trackFeature) {\r\n      this.enableTrackFeature(this.options.trackFeature);\r\n    }\r\n\r\n    return new olLayerVector(olOptions);\r\n  }\r\n\r\n  protected flash(feature) {\r\n    const start = new Date().getTime();\r\n    const listenerKey = this.map.ol.on('postcompose', animate.bind(this));\r\n\r\n    function animate(event) {\r\n      const vectorContext = event.vectorContext;\r\n      const frameState = event.frameState;\r\n      const flashGeom = feature.getGeometry().clone();\r\n      const elapsed = frameState.time - start;\r\n      const elapsedRatio = elapsed / this.options.animation.duration;\r\n      const opacity = easeOut(1 - elapsedRatio);\r\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\r\n      newColor[3] = opacity;\r\n      let style = this.ol\r\n        .getStyleFunction()\r\n        .call(this, feature)\r\n        .find(style2 => {\r\n          return style2.getImage();\r\n        });\r\n      if (!style) {\r\n        style = this.ol.getStyleFunction().call(this, feature)[0];\r\n      }\r\n      const styleClone = style.clone();\r\n\r\n      switch (feature.getGeometry().getType()) {\r\n        case 'Point':\r\n          const radius =\r\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\r\n          styleClone.getImage().setRadius(radius);\r\n          styleClone.getImage().setOpacity(opacity);\r\n          break;\r\n        case 'LineString':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone\r\n              .getImage()\r\n              .getStroke()\r\n              .setColor(newColor);\r\n            styleClone\r\n              .getImage()\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) *\r\n                  (styleClone\r\n                    .getImage()\r\n                    .getStroke()\r\n                    .getWidth() *\r\n                    3)\r\n              );\r\n          }\r\n          if (styleClone.getStroke()) {\r\n            styleClone.getStroke().setColor(newColor);\r\n            styleClone\r\n              .getStroke()\r\n              .setWidth(\r\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\r\n              );\r\n          }\r\n          break;\r\n        case 'Polygon':\r\n          // TODO\r\n          if (styleClone.getImage()) {\r\n            styleClone\r\n              .getImage()\r\n              .getFill()\r\n              .setColor(newColor);\r\n          }\r\n          if (styleClone.getFill()) {\r\n            styleClone.getFill().setColor(newColor);\r\n          }\r\n          break;\r\n      }\r\n\r\n      styleClone.setText('');\r\n      vectorContext.setStyle(styleClone);\r\n      vectorContext.drawGeometry(flashGeom);\r\n\r\n      if (elapsed > this.options.animation.duration) {\r\n        unByKey(listenerKey);\r\n        // remove last geometry\r\n        // there is a little flash before feature disappear, better solution ?\r\n        this.map.ol.render();\r\n        return;\r\n      }\r\n      // tell OpenLayers to continue postcompose animation\r\n      this.map.ol.render();\r\n    }\r\n  }\r\n\r\n  public setMap(map: IgoMap | undefined) {\r\n    if (map === undefined) {\r\n      this.watcher.unsubscribe();\r\n    } else {\r\n      this.watcher.subscribe(() => {});\r\n    }\r\n    super.setMap(map);\r\n  }\r\n\r\n  public onUnwatch() {\r\n    this.dataSource.onUnwatch();\r\n    this.stopAnimation();\r\n  }\r\n\r\n  public stopAnimation() {\r\n    this.dataSource.ol.un(\r\n      'addfeature',\r\n      function(e) {\r\n        if (this.visible) {\r\n          this.flash(e.feature);\r\n        }\r\n      }.bind(this)\r\n    );\r\n  }\r\n\r\n  public enableTrackFeature(id: string | number) {\r\n    this.trackFeatureListenerId = this.dataSource.ol.on(\r\n      'addfeature',\r\n      this.trackFeature.bind(this, id)\r\n    );\r\n  }\r\n  public centerMapOnFeature(id: string | number) {\r\n    const feat = this.dataSource.ol.getFeatureById(id);\r\n    if (feat) {\r\n      this.map.ol.getView().setCenter(feat.getGeometry().getCoordinates());\r\n    }\r\n  }\r\n\r\n  public trackFeature(id, feat) {\r\n    if (feat.feature.getId() === id && this.visible) {\r\n      this.centerMapOnFeature(id);\r\n    }\r\n  }\r\n\r\n  public disableTrackFeature(id?: string | number) {\r\n    unByKey(this.trackFeatureListenerId);\r\n  }\r\n}\r\n","import olLayerVectorTile from 'ol/layer/VectorTile';\r\nimport olSourceVectorTile from 'ol/source/VectorTile';\r\n\r\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\r\n\r\nimport { Layer } from './layer';\r\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\r\nimport { TileWatcher } from '../../utils';\r\n\r\nexport class VectorTileLayer extends Layer {\r\n  public dataSource: MVTDataSource;\r\n  public options: VectorTileLayerOptions;\r\n  public ol: olLayerVectorTile;\r\n\r\n  private watcher: TileWatcher;\r\n\r\n  constructor(options: VectorTileLayerOptions) {\r\n    super(options);\r\n    this.watcher = new TileWatcher(this);\r\n    this.status$ = this.watcher.status$;\r\n  }\r\n\r\n  protected createOlLayer(): olLayerVectorTile {\r\n    const olOptions = Object.assign({}, this.options, {\r\n      source: this.options.source.ol as olSourceVectorTile\r\n    });\r\n\r\n    return new olLayerVectorTile(olOptions);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  AfterViewInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport { ActivityService } from '@igo2/core';\r\n\r\nimport { IgoMap, MapViewOptions } from '../shared';\r\n\r\n@Component({\r\n  selector: 'igo-map-browser',\r\n  templateUrl: './map-browser.component.html',\r\n  styleUrls: ['./map-browser.component.scss']\r\n})\r\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\r\n\r\n  private activityId: string;\r\n  private status$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get view(): MapViewOptions { return this._view; }\r\n  set view(value: MapViewOptions) {\r\n    this._view = value;\r\n    if (this.map !== undefined) {\r\n      this.map.updateView(value);\r\n    }\r\n  }\r\n  private _view: MapViewOptions;\r\n\r\n  public id = `igo-map-target-${new Date().getTime()}`;\r\n\r\n  constructor(private activityService: ActivityService) {}\r\n\r\n  ngOnInit() {\r\n    this.status$$ = this.map.status$.subscribe(status =>\r\n      this.handleStatusChange(status)\r\n    );\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.map.setTarget(this.id);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.map.setTarget(undefined);\r\n    this.activityService.unregister(this.activityId);\r\n    this.status$$.unsubscribe();\r\n  }\r\n\r\n  private handleStatusChange(status: SubjectStatus) {\r\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\r\n      this.activityId = this.activityService.register();\r\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\r\n      this.activityService.unregister(this.activityId);\r\n      this.activityId = undefined;\r\n    }\r\n  }\r\n}\r\n","export enum OverlayAction {\r\n    None,\r\n    Move,\r\n    Zoom,\r\n    ZoomIfOutMapExtent\r\n  }\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport { OverlayAction } from './overlay.enum';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OverlayService {\r\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\r\n    [],\r\n    undefined\r\n  ]);\r\n\r\n  constructor() {}\r\n\r\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\r\n    this.features$.next([features, action]);\r\n  }\r\n\r\n  clear() {\r\n    this.features$.next([[], OverlayAction.None]);\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olextent from 'ol/extent';\r\nimport * as olproj from 'ol/proj';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\n\r\nimport { OverlayService } from '../shared/overlay.service';\r\nimport { OverlayAction } from '../shared/overlay.enum';\r\n\r\n@Directive({\r\n  selector: '[igoOverlay]'\r\n})\r\nexport class OverlayDirective implements OnInit, OnDestroy {\r\n  private features$$: Subscription;\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private overlayService: OverlayService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.features$$ = this.overlayService.features$.subscribe(res =>\r\n      this.handleFeatures(res[0], res[1])\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.features$$.unsubscribe();\r\n  }\r\n\r\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer, StyleService } from '../../layer';\r\n\r\n/**\r\n * Create an overlay layer and it's source\r\n * @returns Overlay layer\r\n */\r\nexport function createOverlayLayer(): VectorLayer {\r\n  const overlayDataSource = new FeatureDataSource();\r\n  return new VectorLayer({\r\n    title: 'Overlay',\r\n    zIndex: 300,\r\n    source: overlayDataSource,\r\n    style: createOverlayLayerStyle()\r\n  });\r\n}\r\n\r\n/**\r\n * Create an overlay style with markers for points and a basic stroke/fill\r\n * combination for lines and polygons\r\n * @returns Style function\r\n */\r\nfunction createOverlayLayerStyle(): (olFeature: OlFeature) => olstyle.Style {\r\n  const defaultStyle = createOverlayDefaultStyle();\r\n  const markerStyle = createOverlayMarkerStyle();\r\n\r\n  let style;\r\n\r\n  return (olFeature: OlFeature) => {\r\n    if (olFeature.getId() === 'bufferFeature') {\r\n      style = createBufferStyle(olFeature.get('bufferStroke'), 2, olFeature.get('bufferFill'), olFeature.get('bufferText'));\r\n      return style;\r\n    } else {\r\n      const customStyle = olFeature.get('_style');\r\n      if (customStyle) {\r\n        const styleService = new StyleService();\r\n        return styleService.createStyle(customStyle);\r\n      }\r\n      const geometryType = olFeature.getGeometry().getType();\r\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\r\n      style.getText().setText(olFeature.get('_mapTitle'));\r\n      return style;\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Create a basic style for lines and polygons\r\n * @returns Style\r\n */\r\nexport function createOverlayDefaultStyle(\r\n  {text, fillOpacity, strokeWidth = 2, strokeOpacity, color = [0, 161, 222, 0.3], strokeColor}:\r\n    {text?: string, fillOpacity?: number, strokeWidth?: number, strokeOpacity?: number, color?: number[], strokeColor?: number[]}  = {}\r\n  ): olstyle.Style {\r\n  const fillWithOpacity = color.slice(0);\r\n  const strokeWithOpacity = color.slice(0);\r\n  strokeWithOpacity[3] = 1;\r\n  if (fillOpacity) {\r\n    fillWithOpacity[3] = fillOpacity;\r\n  }\r\n  if (strokeOpacity) {\r\n    strokeWithOpacity[3] = strokeOpacity;\r\n  }\r\n  if (strokeColor) {\r\n    strokeWithOpacity[0] = strokeColor[0];\r\n    strokeWithOpacity[1] = strokeColor[1];\r\n    strokeWithOpacity[2] = strokeColor[2];\r\n  }\r\n\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeWithOpacity\r\n  });\r\n\r\n  const fill = new olstyle.Fill({\r\n    color: fillWithOpacity\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      text,\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Create a marker style for points\r\n * @returns Style\r\n */\r\nexport function createOverlayMarkerStyle(\r\n  {text, opacity = 1, color = 'blue', outlineColor}:\r\n    {text?: string, opacity?: number, color?: string, outlineColor?: string | number[]}  = {}\r\n  ): olstyle.Style {\r\n  let iconColor;\r\n  let svgIconColor;\r\n  let svgOutlineColor;\r\n  let svg;\r\n\r\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\r\n\r\n  switch (color) {\r\n    case 'blue':\r\n      svgIconColor = '\"rgb(0,161,222)\"';\r\n      iconColor = color;\r\n      break;\r\n    case 'red':\r\n      svgIconColor = '\"rgb(246,65,57)\"';\r\n      iconColor = color;\r\n      break;\r\n    case 'yellow':\r\n      svgIconColor = '\"rgb(255,215,0)\"';\r\n      iconColor = color;\r\n      break;\r\n    case 'green':\r\n      svgIconColor = '\"rgb(0,128,0)\"';\r\n      iconColor = color;\r\n      break;\r\n    default:\r\n      svgIconColor = '\"rgb(0,161,222)\"';\r\n      iconColor = 'blue';\r\n      break;\r\n  }\r\n\r\n  if (outlineColor) {\r\n    if (outlineColor instanceof Array) {\r\n      svgOutlineColor = 'rgb(' + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ')';\r\n    }\r\n    switch (outlineColor) {\r\n      case 'blue':\r\n        svgOutlineColor = 'rgb(0,161,222)';\r\n        break;\r\n      case 'red':\r\n        svgOutlineColor = 'rgb(246,65,57)';\r\n        break;\r\n      case 'yellow':\r\n        svgOutlineColor = 'rgb(255,215,0)';\r\n        break;\r\n      case 'green':\r\n        svgOutlineColor = 'rgb(0,128,0)';\r\n        break;\r\n    }\r\n    svg = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\r\n          '<path fill=' + svgIconColor + ' stroke=\"' + svgOutlineColor + '\" stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>'\r\n          + '</svg>';\r\n  }\r\n\r\n  if (!isIE) {\r\n    return new olstyle.Style({\r\n      image: new olstyle.Icon({\r\n        src: svg ? 'data:image/svg+xml;utf8,' + svg : './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg',\r\n        opacity,\r\n        imgSize: [36, 36], // for ie\r\n        anchor: [0.5, 0.92]\r\n      }),\r\n      text: new olstyle.Text({\r\n        text,\r\n        font: '12px Calibri,sans-serif',\r\n        fill: new olstyle.Fill({ color: '#000' }),\r\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n        overflow: true\r\n      })\r\n    });\r\n  } else {\r\n    return new olstyle.Style({\r\n      image: new olstyle.Icon({\r\n        src: './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg',\r\n        opacity,\r\n        imgSize: [36, 36], // for ie\r\n        anchor: [0.5, 0.92]\r\n      }),\r\n      text: new olstyle.Text({\r\n        text,\r\n        font: '12px Calibri,sans-serif',\r\n        fill: new olstyle.Fill({ color: '#000' }),\r\n        stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n        overflow: true\r\n      })\r\n    });\r\n  }\r\n}\r\n\r\nfunction createBufferStyle(\r\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\r\n  strokeWidth: number = 2,\r\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\r\n  bufferRadius?\r\n): olstyle.Style {\r\n  const stroke = new olstyle.Stroke({\r\n    width: strokeWidth,\r\n    color: strokeRGBA\r\n  });\r\n\r\n  const fill = new olstyle.Stroke({\r\n    color: fillRGBA\r\n  });\r\n\r\n  return new olstyle.Style({\r\n    stroke,\r\n    fill,\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke,\r\n      fill\r\n    }),\r\n    text: new olstyle.Text({\r\n      font: '12px Calibri,sans-serif',\r\n      text: bufferRadius,\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport { StyleByAttribute } from './vector-style.interface';\r\n\r\nimport { ClusterParam } from './clusterParam';\r\nimport { createOverlayMarkerStyle } from '../../overlay';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleService {\r\n  public style: olstyle.Style;\r\n\r\n  createStyle(options: { [key: string]: any }) {\r\n    if (!options) {\r\n      return createOverlayMarkerStyle();\r\n    }\r\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\r\n      return options;\r\n    }\r\n    return this.parseStyle('style', options);\r\n  }\r\n\r\n  private parseStyle(key: string, value: any): olstyle {\r\n    const styleOptions = {};\r\n    const olCls = this.getOlCls(key);\r\n\r\n    if (olCls && value instanceof Object) {\r\n      Object.keys(value).forEach(_key => {\r\n        const olKey = this.getOlKey(_key);\r\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\r\n      });\r\n      return new olCls(styleOptions);\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  private getOlKey(key: any) {\r\n    let olKey;\r\n    switch (key.toLowerCase()) {\r\n      case 'circle':\r\n      case 'regularshape':\r\n      case 'icon':\r\n        olKey = 'image';\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return olKey || key;\r\n  }\r\n\r\n  private getOlCls(key: any) {\r\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\r\n    if (key === 'regularshape') {\r\n      olCls = olstyle.RegularShape;\r\n    }\r\n    if (key === 'backgroundFill') {\r\n      olCls = olstyle.Fill;\r\n    }\r\n    if (key === 'backgroundStroke') {\r\n      olCls = olstyle.Stroke;\r\n    }\r\n\r\n    return olCls;\r\n  }\r\n\r\n  createStyleByAttribute(feature, styleByAttribute: StyleByAttribute) {\r\n    let style;\r\n    const type = styleByAttribute.type;\r\n    const attribute = styleByAttribute.attribute;\r\n    const data = styleByAttribute.data;\r\n    const stroke = styleByAttribute.stroke;\r\n    const width = styleByAttribute.width;\r\n    const fill = styleByAttribute.fill;\r\n    const radius = styleByAttribute.radius;\r\n    const icon = styleByAttribute.icon;\r\n    const scale = styleByAttribute.scale;\r\n    const size = data.length;\r\n    const label = styleByAttribute.label.attribute || styleByAttribute.label;\r\n    const labelStyle =\r\n      this.parseStyle('text', styleByAttribute.label.style) ||\r\n      new olstyle.Text();\r\n    labelStyle.setText(this.getLabel(feature, label));\r\n    const baseStyle = styleByAttribute.baseStyle;\r\n    if (type === 'circle') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined'\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (val === data[i] || val.toString().match(data[i])) {\r\n          if (icon) {\r\n            style = [\r\n              new olstyle.Style({\r\n                image: new olstyle.Icon({\r\n                  src: icon[i],\r\n                  scale: scale ? scale[i] : 1\r\n                })\r\n              })\r\n            ];\r\n            return style;\r\n          }\r\n          style = [\r\n            new olstyle.Style({\r\n              image: new olstyle.Circle({\r\n                radius: radius ? radius[i] : 4,\r\n                stroke: new olstyle.Stroke({\r\n                  color: stroke ? stroke[i] : 'black',\r\n                  width: width ? width[i] : 1\r\n                }),\r\n                fill: new olstyle.Fill({\r\n                  color: fill ? fill[i] : 'black'\r\n                })\r\n              }),\r\n              text: labelStyle\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (!feature.getStyle()) {\r\n        style = [\r\n          new olstyle.Style({\r\n            image: new olstyle.Circle({\r\n              radius: 4,\r\n              stroke: new olstyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n        return style;\r\n      }\r\n    } else if (type === 'regular') {\r\n      for (let i = 0; i < size; i++) {\r\n        const val =\r\n          typeof feature.get(attribute) !== 'undefined'\r\n            ? feature.get(attribute)\r\n            : '';\r\n        if (val === data[i] || val.toString().match(data[i])) {\r\n          style = [\r\n            new olstyle.Style({\r\n              stroke: new olstyle.Stroke({\r\n                color: stroke ? stroke[i] : 'black',\r\n                width: width ? width[i] : 1\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\r\n              }),\r\n              text: labelStyle\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n      if (feature instanceof OlFeature) {\r\n        if (!feature.getStyle()) {\r\n          if (baseStyle) {\r\n            style = this.createStyle(baseStyle);\r\n            return style;\r\n          }\r\n          style = [\r\n            new olstyle.Style({\r\n              stroke: new olstyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: '#bbbbf2'\r\n              })\r\n            })\r\n          ];\r\n          return style;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  createClusterStyle(feature, clusterParam: ClusterParam = {}, layerStyle) {\r\n    let style: olstyle.Style;\r\n    const size = feature.get('features').length;\r\n    if (size !== 1) {\r\n      if (clusterParam.clusterRanges) {\r\n        for (const r of clusterParam.clusterRanges) {\r\n          if (\r\n            (!r.minRadius || r.minRadius <= size) &&\r\n            (!r.maxRadius || r.maxRadius >= size)\r\n          ) {\r\n            style = this.createStyle(r.style);\r\n\r\n            if (r.showRange) {\r\n              const text = new olstyle.Text({\r\n                text: size.toString(),\r\n                fill: new olstyle.Fill({\r\n                  color: '#fff'\r\n                })\r\n              });\r\n              style.setText(text);\r\n            }\r\n\r\n            if (r.dynamicRadius) {\r\n              let clusterRadius: number;\r\n              const radiusMin = style.image_.getRadius();\r\n              clusterRadius = 5 * Math.log(size);\r\n              if (clusterRadius < radiusMin) {\r\n                clusterRadius = radiusMin;\r\n              }\r\n              style.image_.setRadius(clusterRadius);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!style) {\r\n        let clusterRadius: number;\r\n        if (clusterParam.radiusCalc) {\r\n          clusterRadius = clusterParam.radiusCalc(size);\r\n        } else {\r\n          const radiusMin = 6;\r\n          clusterRadius = 5 * Math.log(size);\r\n          if (clusterRadius < radiusMin) {\r\n            clusterRadius = radiusMin;\r\n          }\r\n        }\r\n\r\n        style = [\r\n          new olstyle.Style({\r\n            image: new olstyle.Circle({\r\n              radius: clusterRadius,\r\n              opacity: 0.4,\r\n              stroke: new olstyle.Stroke({\r\n                color: 'black'\r\n              }),\r\n              fill: new olstyle.Fill({\r\n                color: 'rgba(24, 134, 45, 0.5)'\r\n              })\r\n            }),\r\n            text: new olstyle.Text({\r\n              text: size.toString(),\r\n              fill: new olstyle.Fill({\r\n                color: '#fff'\r\n              })\r\n            })\r\n          })\r\n        ];\r\n      }\r\n    } else {\r\n      style = this.createStyle(layerStyle);\r\n    }\r\n    return style;\r\n  }\r\n\r\n  getLabel(feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach(v => {\r\n      label = label.replace(v[0], feature.get(v[1]));\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.get(labelMatch) || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n}\r\n","import OlLayer from 'ol/layer/Layer';\r\n\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { QueryableDataSource } from './query.interfaces';\r\n\r\n/**\r\n * Whether a layer is queryable\r\n * @param layer Layer\r\n * @returns True if the layer s squeryable\r\n */\r\nexport function layerIsQueryable(layer: AnyLayer): boolean {\r\n  const dataSource = layer.dataSource as QueryableDataSource;\r\n  return dataSource.options.queryable === true;\r\n}\r\n\r\n/**\r\n * Whether an OL layer is queryable\r\n * @param layer Layer\r\n * @returns True if the ol layer is queryable\r\n */\r\nexport function olLayerIsQueryable(olLayer: OlLayer): boolean {\r\n  const layer = olLayer.get('_layer');\r\n  return layer === undefined ? false : layerIsQueryable(layer);\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  Renderer2,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { layerIsQueryable } from '../../query/shared/query.utils';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-item',\r\n  templateUrl: './layer-item.component.html',\r\n  styleUrls: ['./layer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerItemComponent implements OnInit, OnDestroy {\r\n\r\n  public focusedCls = 'igo-layer-item-focused';\r\n\r\n  @Input()\r\n  get activeLayer() {\r\n    return this._activeLayer;\r\n  }\r\n  set activeLayer(value) {\r\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\r\n      this.layerTool$.next(true);\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n  }\r\n  private _activeLayer;\r\n\r\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  @Input()\r\n  get selectAll() {\r\n    return this._selectAll;\r\n  }\r\n  set selectAll(value: boolean) {\r\n    this._selectAll = value;\r\n    if (value === true) {\r\n      this.layerCheck = true;\r\n    }\r\n  }\r\n  private _selectAll = false;\r\n\r\n  @Input() layerCheck;\r\n\r\n  private resolution$$: Subscription;\r\n\r\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\r\n\r\n  @Input()\r\n  get layer() {\r\n    return this._layer;\r\n  }\r\n  set layer(value) {\r\n    this._layer = value;\r\n    this.layers$.next(value);\r\n  }\r\n  private _layer;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendIfVisible: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() orderable: boolean = true;\r\n\r\n  @Input() lowerDisabled: boolean = false;\r\n\r\n  @Input() raiseDisabled: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Input() selectionMode;\r\n\r\n  get removable(): boolean {\r\n    return this.layer.options.removable !== false;\r\n  }\r\n\r\n  get opacity() {\r\n    return this.layer.opacity * 100;\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.layer.opacity = opacity / 100;\r\n  }\r\n\r\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\r\n  @Output() checkbox = new EventEmitter<{\r\n    layer: Layer;\r\n    check: boolean;\r\n  }>();\r\n\r\n  constructor(\r\n    private networkService: NetworkService,\r\n    private renderer: Renderer2,\r\n    private elRef: ElementRef) {}\r\n\r\n  ngOnInit() {\r\n    if (\r\n      this.layer.visible &&\r\n      this.expandLegendIfVisible &&\r\n      this.layer.firstLoadComponent === true\r\n    ) {\r\n      this.layer.firstLoadComponent = false;\r\n      this.layer.legendCollapsed = false;\r\n    }\r\n    this.toggleLegend(this.layer.legendCollapsed);\r\n    this.updateQueryBadge();\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.state = state;\r\n      this.onResolutionChange();\r\n    });\r\n\r\n    this.layers$.subscribe(() => {\r\n      if (this.layer && this.layer.options.active) {\r\n        this.layerTool$.next(true);\r\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    this.toggleLegend(this.showLegend$.value);\r\n  }\r\n\r\n  toggleVisibility() {\r\n    this.layer.visible = !this.layer.visible;\r\n    if (this.toggleLegendOnVisibilityChange) {\r\n      this.toggleLegend(!this.layer.visible);\r\n    }\r\n    this.updateQueryBadge();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    if (\r\n      inResolutionRange === false &&\r\n      this.updateLegendOnResolutionChange === true\r\n    ) {\r\n      this.toggleLegend(true);\r\n    }\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n\r\n  private updateQueryBadge() {\r\n    const hidden =\r\n      this.queryBadge === false ||\r\n      this.layer.visible === false ||\r\n      !layerIsQueryable(this.layer);\r\n    this.queryBadgeHidden$.next(hidden);\r\n  }\r\n\r\n  toggleLayerTool() {\r\n    this.layerTool$.next(!this.layerTool$.getValue());\r\n    if (this.layerTool$.getValue() === true) {\r\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\r\n    } else {\r\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\r\n    }\r\n    this.action.emit(this.layer);\r\n  }\r\n\r\n  public check() {\r\n    this.layerCheck = !this.layerCheck;\r\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\r\n  }\r\n}\r\n","import { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, QueryList } from '@angular/core';\r\n\r\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\r\n\r\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\r\nimport { Layer, ItemStyleOptions } from '../shared/layers';\r\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\r\nimport { map } from 'rxjs/operators';\r\nimport { LanguageService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend',\r\n  templateUrl: './layer-legend.component.html',\r\n  styleUrls: ['./layer-legend.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendComponent implements OnInit, OnDestroy {\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  /**\r\n   * Observable of the legend items\r\n   */\r\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * Subscription to the map's resolution\r\n   */\r\n  private resolution$$: Subscription;\r\n\r\n  /**\r\n   * The available styles\r\n   */\r\n  public styles;\r\n\r\n  /**\r\n   * The style used to make the legend\r\n   */\r\n  public currentStyle;\r\n\r\n  /**\r\n   * The scale used to make the legend\r\n   */\r\n  private scale: number = undefined;\r\n\r\n  /**\r\n   * Get list of images display\r\n   */\r\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\r\n\r\n  /**\r\n   * List of size of images displayed\r\n   */\r\n  public imagesHeight: { [srcKey: string]: number } = {};\r\n\r\n  /**\r\n   * Layer\r\n   */\r\n  @Input() layer: Layer;\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    private languageService: LanguageService) {}\r\n\r\n  /**\r\n   * On init, subscribe to the map's resolution and update the legend accordingly\r\n   */\r\n  ngOnInit() {\r\n    let lastlLegend = this.layer.legend;\r\n    this.styles = this.listStyles();\r\n    const sourceOptions = this.layer.options.source.options as any;\r\n    if (\r\n      sourceOptions &&\r\n      sourceOptions.params &&\r\n      sourceOptions.params.STYLES) {\r\n      // if a styles is provided into the layers wms params\r\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\r\n    } else if (!this.layer.legend) {\r\n      // if no legend is manually provided\r\n      if (this.styles && this.styles.length > 1) {\r\n        this.currentStyle = this.styles[0].name;\r\n      }\r\n    } else if (this.styles && this.styles.length > 1) {\r\n      this.currentStyle = lastlLegend[0].currentStyle;\r\n    }\r\n\r\n    lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.scale);\r\n    if (this.updateLegendOnResolutionChange === true) {\r\n      const resolution$ = this.layer.map.viewController.resolution$;\r\n      this.resolution$$ = resolution$.subscribe((resolution: number) => this.onResolutionChange(resolution));\r\n    } else if (lastlLegend.length !== 0) {\r\n      this.legendItems$.next(lastlLegend);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On destroy, unsubscribe to the map,s resolution\r\n   */\r\n  ngOnDestroy() {\r\n    if (this.resolution$$ !== undefined) {\r\n      this.resolution$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  toggleLegendItem(collapsed: boolean, item: Legend) {\r\n    item.collapsed = collapsed;\r\n  }\r\n\r\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\r\n    const outLegends: Legend[] = newLegends;\r\n    const lastLegends = this.layer.legend;\r\n    for (let i = 0; i < lastLegends.length; i++) {\r\n      outLegends[i].collapsed = lastLegends[i].collapsed;\r\n   }\r\n    return outLegends;\r\n  }\r\n\r\n  computeItemTitle(layerLegend): Observable<string> {\r\n    const layerOptions = this.layer.dataSource.options as any;\r\n    if (layerOptions.type !== 'wms') {\r\n      return of(layerLegend.title);\r\n    }\r\n\r\n    const layers = layerOptions.params.LAYERS.split(',');\r\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\r\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\r\n    return this.capabilitiesService\r\n      .getWMSOptions(localLayerOptions)\r\n      .pipe(map(wmsDataSourceOptions => {\r\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * On resolution change, compute the effective scale level and update the\r\n   * legend accordingly.\r\n   * @param resolution Map resolution\r\n   */\r\n  private onResolutionChange(resolution: number) {\r\n    this.scale = this.layer.map.viewController.getScale();\r\n    this.updateLegend();\r\n  }\r\n\r\n  /**\r\n   * Update the legend with scale level and style define\r\n   */\r\n  private updateLegend() {\r\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.scale);\r\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\r\n    this.layer.legend = legendItems;\r\n\r\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\r\n      return;\r\n    }\r\n    this.legendItems$.next(legendItems);\r\n  }\r\n\r\n  private listStyles() {\r\n    const layerOptions = this.layer.options;\r\n    if (layerOptions && layerOptions.legendOptions) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant('igo.geo.layer.legend.default');\r\n      const stylesAvailable =  [{ name: '', title } as ItemStyleOptions]\r\n        .concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\r\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\r\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\r\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\r\n      return stylesAvailable;\r\n    }\r\n    return ;\r\n  }\r\n\r\n  onChangeStyle() {\r\n    this.updateLegend();\r\n    let STYLES = '';\r\n    this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\r\n      STYLES += this.currentStyle + ','\r\n    );\r\n    STYLES = STYLES.slice(0, -1);\r\n    this.layer.dataSource.ol.updateParams({STYLES});\r\n  }\r\n\r\n  onLoadImage(id: string) {\r\n    let elemRef: HTMLImageElement;\r\n    if (this.renderedLegends.length === 1) {\r\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\r\n    } else {\r\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\r\n    }\r\n    this.imagesHeight[id] = elemRef.height;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\r\nimport { Layer, TooltipType } from '../shared/layers';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-item',\r\n  templateUrl: './layer-legend-item.component.html',\r\n  styleUrls: ['./layer-legend-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\r\n\r\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  tooltipText: string;\r\n\r\n  state: ConnectionState;\r\n\r\n  private resolution$$: Subscription;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  constructor(private networkService: NetworkService) {}\r\n\r\n  ngOnInit() {\r\n    this.layer.legendCollapsed = true;\r\n\r\n    const resolution$ = this.layer.map.viewController.resolution$;\r\n    this.resolution$$ = resolution$.subscribe(() => {\r\n      this.onResolutionChange();\r\n    });\r\n    this.tooltipText = this.computeTooltip();\r\n\r\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.state = state;\r\n      this.onResolutionChange();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    const layerOptions = this.layer.options;\r\n    if (!layerOptions.tooltip) {\r\n      return this.layer.title;\r\n    }\r\n    const layerTooltip = layerOptions.tooltip;\r\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\r\n    switch (layerOptions.tooltip.type) {\r\n      case TooltipType.TITLE:\r\n        return this.layer.title;\r\n      case TooltipType.ABSTRACT:\r\n        if (layerMetadata && layerMetadata.abstract) {\r\n          return layerMetadata.abstract;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      case TooltipType.CUSTOM:\r\n        if (layerTooltip && layerTooltip.text) {\r\n          return layerTooltip.text;\r\n        } else {\r\n          return this.layer.title;\r\n        }\r\n      default:\r\n        return this.layer.title;\r\n    }\r\n  }\r\n\r\n  private onResolutionChange() {\r\n    const inResolutionRange = this.layer.isInResolutionsRange;\r\n    this.inResolutionRange$.next(inResolutionRange);\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\r\nimport { Layer } from '../shared';\r\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'igo-layer-legend-list',\r\n  templateUrl: './layer-legend-list.component.html',\r\n  styleUrls: ['./layer-legend-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n\r\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n  showAllLegend: boolean =  false;\r\n  public change$ = new ReplaySubject<void>(1);\r\n  private change$$: Subscription;\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() allowShowAllLegends: boolean = false;\r\n\r\n  @Input() showAllLegendsValue: boolean = false;\r\n\r\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\r\n\r\n  constructor() { }\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(debounce(() => {\r\n        return this.layers.length === 0 ? EMPTY : timer(50);\r\n      }))\r\n      .subscribe(() => {\r\n        const layers = this.computeShownLayers(this.layers.slice(0));\r\n        this.layers$.next(layers);\r\n        this.hasVisibleOrInRangeLayers$.next(\r\n          this.layers.slice(0)\r\n            .filter(layer => layer.baseLayer !== true)\r\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\r\n        );\r\n        this.hasVisibleAndNotInRangeLayers$.next(\r\n          this.layers.slice(0)\r\n            .filter(layer => layer.baseLayer !== true)\r\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\r\n        );\r\n\r\n        this.layersInUi$.next(\r\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\r\n        );\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n  private computeShownLayers(layers: Layer[]) {\r\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\r\n    if (this.showAllLegendsValue) {\r\n      shownLayers = layers;\r\n    }\r\n    return this.sortLayersByZindex(shownLayers);\r\n  }\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  toggleShowAllLegends(toggle: boolean) {\r\n      this.showAllLegendsValue = toggle;\r\n      this.next();\r\n      this.allLegendsShown.emit(toggle);\r\n  }\r\n}\r\n","export enum LayerListControlsEnum {\r\n  always = 'always',\r\n  never = 'never',\r\n  default = 'default'\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  TemplateRef,\r\n  ContentChild,\r\n  OnInit,\r\n  OnDestroy,\r\n  Output,\r\n  EventEmitter,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material';\r\n\r\nimport { Layer } from '../shared';\r\nimport { LayerListControlsEnum } from './layer-list.enum';\r\nimport {\r\n  BehaviorSubject,\r\n  ReplaySubject,\r\n  Subscription,\r\n  EMPTY,\r\n  timer\r\n} from 'rxjs';\r\nimport { debounce } from 'rxjs/operators';\r\nimport {\r\n  MetadataOptions,\r\n  MetadataLayerOptions\r\n} from '../../metadata/shared/metadata.interface';\r\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\r\nimport { IgoMap } from '../../map/shared/map';\r\n\r\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\r\n@Component({\r\n  selector: 'igo-layer-list',\r\n  templateUrl: './layer-list.component.html',\r\n  styleUrls: ['./layer-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListComponent implements OnInit, OnDestroy {\r\n  orderable = true;\r\n  thresholdToFilterAndSort = 5;\r\n\r\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\r\n\r\n  change$ = new ReplaySubject<void>(1);\r\n\r\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  public layerTool: boolean;\r\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\r\n\r\n  layersChecked: Layer[] = [];\r\n  public selection;\r\n\r\n  private change$$: Subscription;\r\n\r\n  @ContentChild('igoLayerItemToolbar') templateLayerToolbar: TemplateRef<any>;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() ogcButton: boolean = true;\r\n\r\n  @Input() timeButton: boolean = true;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.next();\r\n  }\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  private _layers: Layer[];\r\n\r\n  set activeLayer(value: Layer) {\r\n    this._activeLayer = value;\r\n    this.activeLayer$.next(value);\r\n  }\r\n  get activeLayer(): Layer {\r\n    return this._activeLayer;\r\n  }\r\n  private _activeLayer: Layer;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\r\n\r\n  @Input() excludeBaseLayers: boolean = false;\r\n\r\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\r\n\r\n  @Input() expandLegendOfVisibleLayers: boolean = false;\r\n\r\n  @Input() updateLegendOnResolutionChange: boolean = false;\r\n\r\n  @Input() queryBadge: boolean = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n\r\n  get keyword(): string {\r\n    return this._keyword;\r\n  }\r\n  set keyword(value: string) {\r\n    this._keyword = value;\r\n    this.next();\r\n  }\r\n  private _keyword = undefined;\r\n\r\n  get onlyVisible(): boolean {\r\n    return this._onlyVisible;\r\n  }\r\n  set onlyVisible(value: boolean) {\r\n    this._onlyVisible = value;\r\n    this.next();\r\n  }\r\n  private _onlyVisible = false;\r\n\r\n  get sortAlpha(): boolean {\r\n    return this._sortedAlpha;\r\n  }\r\n  set sortAlpha(value: boolean) {\r\n    this._sortedAlpha = value;\r\n    this.next();\r\n  }\r\n  private _sortedAlpha = false;\r\n\r\n  get opacity() {\r\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\r\n  }\r\n  set opacity(opacity: number) {\r\n    this.activeLayer$.getValue().opacity = opacity / 100;\r\n  }\r\n\r\n  get badgeOpacity() {\r\n    if (this.opacity === 100) {\r\n      return;\r\n    }\r\n    return this.opacity;\r\n  }\r\n\r\n  get raiseDisabled(): boolean {\r\n    if (!this.orderable || this.activeLayer.baseLayer || this.getUpperLayer().id === this.activeLayer.id ||\r\n        this.isUpperBaselayer(this.activeLayer)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabled(): boolean {\r\n    if (!this.orderable || this.activeLayer.baseLayer || this.getLowerLayer().id === this.activeLayer.id ||\r\n        this.isLowerBaselayer(this.activeLayer)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get raiseDisabledSelection(): boolean {\r\n    if (this.layersChecked.length === 0 || !this.orderable || !this.raisableLayers(this.layersChecked) || this.selectAllCheck === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get lowerDisabledSelection(): boolean {\r\n    if (this.layersChecked.length === 0 || !this.orderable || !this.lowerableLayers(this.layersChecked) || this.selectAllCheck === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get checkOpacity() {\r\n    return this.layersCheckedOpacity() * 100;\r\n  }\r\n  set checkOpacity(opacity: number) {\r\n    for (const layer of this.layersChecked) {\r\n      layer.opacity = opacity / 100;\r\n    }\r\n  }\r\n\r\n  public toggleOpacity = false;\r\n\r\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\r\n  selectAllCheck$$: Subscription;\r\n  public selectAllCheck;\r\n\r\n  constructor(\r\n    private elRef: ElementRef,\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.change$$ = this.change$\r\n      .pipe(\r\n        debounce(() => {\r\n          return this.layers.length === 0 ? EMPTY : timer(50);\r\n        })\r\n      )\r\n      .subscribe(() => {\r\n        this.showToolbar$.next(this.computeShowToolbar());\r\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\r\n        this.appliedFilterAndSort.emit({\r\n          keyword: this.keyword,\r\n          sortAlpha: this.sortAlpha,\r\n          onlyVisible: this.onlyVisible\r\n        });\r\n      });\r\n\r\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\r\n      this.selectAllCheck = value;\r\n    });\r\n\r\n    this.layers$.subscribe(() => {\r\n      if (this.layers) {\r\n        let checks = 0;\r\n        for (const layer of this.layers) {\r\n          if (layer.options.active) {\r\n            this.activeLayer = layer;\r\n            this.layerTool = true;\r\n          }\r\n          if (layer.options.check) {\r\n            checks += 1;\r\n          }\r\n        }\r\n        if (this.excludeBaseLayers) {\r\n          this.selectAllCheck = checks === this.layers.filter(lay => lay.baseLayer !== true && lay.showInLayerList).length ? true : false;\r\n        } else {\r\n          this.selectAllCheck = checks === this.layers.filter(lay => lay.showInLayerList).length ? true : false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.change$$.unsubscribe();\r\n  }\r\n\r\n  clearKeyword() {\r\n    this.keyword = undefined;\r\n  }\r\n\r\n  getLowerLayer() {\r\n    return this.layers\r\n      .filter(l => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex < current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isLowerBaselayer(layer) {\r\n    const index = this.layers.findIndex(lay =>Â layer.id === lay.id);\r\n    if (this.layers && this.layers[index + 1] && this.layers[index + 1].baseLayer === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getUpperLayer() {\r\n    return this.layers\r\n      .filter(l => !l.baseLayer)\r\n      .reduce(\r\n        (prev, current) => {\r\n          return prev.zIndex > current.zIndex ? prev : current;\r\n        },\r\n        { zIndex: undefined, id: undefined }\r\n      );\r\n  }\r\n\r\n  isUpperBaselayer(layer) {\r\n    const index = this.layers.findIndex(lay =>Â layer.id === lay.id);\r\n    if (this.layers && this.layers[index - 1] && this.layers[index - 1].baseLayer === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  raisableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex(lay =>Â layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const previousLayer = this.layers[mapIndex - 1];\r\n      if (previousLayer && previousLayer.baseLayer !== true && !layers.find(lay => previousLayer.id === lay.id) &&\r\n            currentLayer.baseLayer !== true) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if ((this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) || base === this.layersChecked.length) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  raisableLayer(index: number) {\r\n    if (index < 1) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index - 1].options.check) {\r\n      return this.raisableLayer(index - 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  raiseLayers(layers: Layer[]) {\r\n    const layersToRaise = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex(lay => lay.id === layer.id);\r\n      if (this.raisableLayer(index)) {\r\n        layersToRaise.push(layer);\r\n      }\r\n    }\r\n    this.map.raiseLayers(layersToRaise);\r\n    setTimeout(() => {\r\n      const elements = this.computeElementRef();\r\n      if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\r\n        elements[0].scrollTop = elements[1].offsetParent.offsetTop;\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  /*\r\n   * For selection mode disabled attribute\r\n   */\r\n  lowerableLayers(layers: Layer[]) {\r\n    let response = false;\r\n    let base = 0;\r\n    for (const layer of layers) {\r\n      const mapIndex = this.layers.findIndex(lay =>Â layer.id === lay.id);\r\n      const currentLayer = this.layers[mapIndex];\r\n      if (currentLayer.baseLayer) {\r\n        base += 1;\r\n      }\r\n\r\n      const nextLayer = this.layers[mapIndex + 1];\r\n      if (nextLayer && nextLayer.baseLayer !== true && !layers.find(lay => nextLayer.id === lay.id)) {\r\n        response = true;\r\n      }\r\n    }\r\n\r\n    if ((this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) || base === this.layersChecked.length) {\r\n      response = false;\r\n    }\r\n    return response;\r\n  }\r\n\r\n  /*\r\n   * When multiple layers is selected but some may be allow to move\r\n   */\r\n  lowerableLayer(index: number) {\r\n    if (index > this.layers.filter(lay => lay.baseLayer !== true).length - 2) {\r\n      return false;\r\n    }\r\n\r\n    if (this.layers[index + 1].options.check) {\r\n      return this.lowerableLayer(index + 1);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  lowerLayers(layers: Layer[]) {\r\n    const layersToLower = [];\r\n    for (const layer of layers) {\r\n      const index = this.layers.findIndex(lay => lay.id === layer.id);\r\n      if (this.lowerableLayer(index)) {\r\n        layersToLower.push(layer);\r\n      }\r\n    }\r\n    this.map.lowerLayers(layersToLower);\r\n    setTimeout(() => {\r\n      const elements = this.computeElementRef('lower');\r\n      if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\r\n        elements[0].scrollTop = elements[1].offsetParent.offsetTop + elements[1].offsetParent.offsetHeight - elements[0].clientHeight;\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  private next() {\r\n    this.change$.next();\r\n  }\r\n\r\n  private computeLayers(layers: Layer[]): Layer[] {\r\n    let layersOut = this.filterLayers(layers);\r\n    if (this.sortAlpha) {\r\n      layersOut = this.sortLayersByTitle(layersOut);\r\n    } else {\r\n      layersOut = this.sortLayersByZindex(layersOut);\r\n    }\r\n    return layersOut;\r\n  }\r\n\r\n  onKeywordChange(term) {\r\n    this.keyword = term;\r\n  }\r\n\r\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\r\n    this.keyword = appliedFilter.keyword;\r\n    this.onlyVisible = appliedFilter.onlyVisible;\r\n    this.sortAlpha = appliedFilter.sortAlpha;\r\n  }\r\n\r\n  private filterLayers(layers: Layer[]): Layer[] {\r\n    if (\r\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\r\n    ) {\r\n      return layers;\r\n    }\r\n    if (!this.keyword && !this.onlyVisible) {\r\n      return layers;\r\n    }\r\n\r\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\r\n\r\n    layers.forEach((layer: Layer) => {\r\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\r\n      const dataSourceOptions = layer.dataSource.options || {};\r\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\r\n      const keywords = metadata.keywordList || [];\r\n      const layerKeywords = keywords.map((kw: string) => {\r\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      });\r\n\r\n      if (this.keyword && layer.title) {\r\n        const localKeyword = this.keyword\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const layerTitle = layer.title\r\n          .normalize('NFD')\r\n          .replace(/[\\u0300-\\u036f]/g, '');\r\n        const dataSourceType = dataSourceOptions.type || '';\r\n        const keywordRegex = new RegExp(localKeyword, 'gi');\r\n        const keywordInList =\r\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\r\n          undefined;\r\n        if (\r\n          !keywordRegex.test(layerTitle) &&\r\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\r\n          !keywordInList\r\n        ) {\r\n          const index = keepLayerIds.indexOf(layer.id);\r\n          if (index > -1) {\r\n            keepLayerIds.splice(index, 1);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (this.onlyVisible && layer.visible === false) {\r\n        const index = keepLayerIds.indexOf(layer.id);\r\n        if (index > -1) {\r\n          keepLayerIds.splice(index, 1);\r\n        }\r\n      }\r\n    });\r\n\r\n    return layers.filter(\r\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\r\n    );\r\n  }\r\n\r\n  private sortLayersByZindex(layers: Layer[]) {\r\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\r\n  }\r\n\r\n  private sortLayersByTitle(layers: Layer[]) {\r\n    return layers.sort((a, b) => {\r\n      if (this.normalize(a.title) < this.normalize(b.title)) {\r\n        return -1;\r\n      }\r\n      if (this.normalize(a.title) > this.normalize(b.title)) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  private normalize(str: string) {\r\n    return str.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').toLowerCase();\r\n  }\r\n\r\n  private computeShowToolbar(): boolean {\r\n    switch (this.layerFilterAndSortOptions.showToolbar) {\r\n      case LayerListControlsEnum.always:\r\n        return true;\r\n      case LayerListControlsEnum.never:\r\n        return false;\r\n      default:\r\n        if (\r\n          this.layers.length >= this.thresholdToFilterAndSort ||\r\n          this.keyword ||\r\n          this.onlyVisible\r\n        ) {\r\n          return true;\r\n        }\r\n        return false;\r\n    }\r\n  }\r\n\r\n  toggleLayerTool(layer) {\r\n    this.toggleOpacity = false;\r\n    if (this.layerTool && layer === this.activeLayer) {\r\n      this.layerTool = false;\r\n    } else {\r\n      this.layerTool = true;\r\n    }\r\n\r\n    for (const lay of this.layers) {\r\n      lay.options.active = false;\r\n    }\r\n    layer.options.active = true;\r\n    this.activeLayer = layer;\r\n    return;\r\n  }\r\n\r\n  removeLayers(layers?: Layer[]) {\r\n    if (layers && layers.length > 0) {\r\n      for (const layer of layers) {\r\n        layer.map.removeLayer(layer);\r\n      }\r\n      this.layersChecked = [];\r\n    } else if (!layers) {\r\n      this.activeLayer.map.removeLayer(this.activeLayer);\r\n      this.layerTool = false;\r\n    }\r\n    return;\r\n  }\r\n\r\n  layersCheck(event: {layer: Layer; check: boolean}) {\r\n    event.layer.options.check = event.check;\r\n    if (event.check === true) {\r\n      const eventMapIndex = this.layers.findIndex(layer =>Â event.layer.id === layer.id);\r\n      for (const layer of this.layersChecked) {\r\n        const mapIndex = this.layers.findIndex(lay =>Â layer.id === lay.id);\r\n        if (eventMapIndex < mapIndex) {\r\n          this.layersChecked.splice(this.layersChecked.findIndex(lay =>Â layer.id === lay.id), 0, event.layer);\r\n\r\n          if (this.excludeBaseLayers) {\r\n            if (this.layersChecked.length === this.layers.filter(lay => (lay.baseLayer !== true && lay.showInLayerList)).length) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          } else if (!this.excludeBaseLayers) {\r\n            if (this.layersChecked.length === this.layers.filter(lay => lay.showInLayerList).length) {\r\n              this.selectAllCheck = true;\r\n            } else {\r\n              this.selectAllCheck = false;\r\n            }\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      this.layersChecked.push(event.layer);\r\n    } else {\r\n      const index = this.layersChecked.findIndex(layer => event.layer.id === layer.id);\r\n      this.layersChecked.splice(index, 1);\r\n    }\r\n\r\n    if (this.excludeBaseLayers) {\r\n      if (this.layersChecked.length === this.layers.filter(lay => (lay.baseLayer !== true && lay.showInLayerList)).length) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    } else if (!this.excludeBaseLayers) {\r\n      if (this.layersChecked.length === this.layers.filter(lay => lay.showInLayerList).length) {\r\n        this.selectAllCheck = true;\r\n      } else {\r\n        this.selectAllCheck = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  toggleSelectionMode(value: boolean) {\r\n    this.selection = value;\r\n    this.activeLayer = undefined;\r\n    if (value === true) {\r\n      this.layerTool = false;\r\n      for (const layer of this.layers) {\r\n        if (layer.options.check) {\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  layersCheckedOpacity(): any {\r\n    if (this.layersChecked.length > 1) {\r\n      return 1;\r\n    } else {\r\n      const opacity = [];\r\n      for (const layer of this.layersChecked) {\r\n        opacity.push(layer.opacity);\r\n      }\r\n      return opacity;\r\n    }\r\n  }\r\n\r\n  selectAll() {\r\n    if (!this.selectAllCheck) {\r\n      for (const layer of this.layers) {\r\n        if (this.excludeBaseLayers && layer.baseLayer !== true && layer.showInLayerList) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\r\n          layer.options.check = true;\r\n          this.layersChecked.push(layer);\r\n        }\r\n      }\r\n      this.selectAllCheck$.next(true);\r\n    } else {\r\n      for (const layer of this.layers) {\r\n        layer.options.check = false;\r\n      }\r\n      this.layersChecked = [];\r\n      this.selectAllCheck$.next(false);\r\n    }\r\n  }\r\n\r\n  isScrolledIntoView(elemSource, elem) {\r\n    const docViewTop = elemSource.scrollTop;\r\n    const docViewBottom = docViewTop + elemSource.clientHeight;\r\n\r\n    const elemTop = elem.offsetTop;\r\n    const elemBottom = elemTop + elem.clientHeight;\r\n    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\r\n  }\r\n\r\n  computeElementRef(type?: string) {\r\n    const checkItems = this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked');\r\n    const checkItem = type === 'lower' ? this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked')[checkItems.length - 1] :\r\n      this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked')[0];\r\n    const igoList = this.elRef.nativeElement.getElementsByTagName('igo-list')[0];\r\n\r\n    return [igoList, checkItem];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { IgoMap } from './map';\r\n\r\n/**\r\n * MapService\r\n *\r\n * This service tracks the IgoMap instance, if any.\r\n * Currently, only one map instance is supported\r\n * but support for multiple maps may be added in the future.\r\n * This will impact other services such as the OverlayService\r\n * because these maps won't be sharing overlayed features.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapService {\r\n  private map: IgoMap;\r\n\r\n  constructor() {}\r\n\r\n  getMap(): IgoMap {\r\n    return this.map;\r\n  }\r\n\r\n  setMap(map: IgoMap) {\r\n    this.map = map;\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { RouteService } from '@igo2/core';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { LayerListComponent } from './layer-list.component';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { map, debounceTime } from 'rxjs/operators';\r\n\r\n@Directive({\r\n  selector: '[igoLayerListBinding]'\r\n})\r\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerListComponent,\r\n    private mapService: MapService,\r\n    @Optional() private route: RouteService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    // this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$]\r\n    ).pipe(\r\n      debounceTime(10)\r\n    ).subscribe((bunch: [Layer[], number]) => {\r\n      const shownLayers = bunch[0].filter((layer: Layer) => {\r\n        return layer.showInLayerList === true;\r\n      });\r\n      this.component.layers = shownLayers;\r\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\r\n    });\r\n  }\r\n\r\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n    this.layersVisibility$$ = combineLatest(layers\r\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\r\n      .map((layer: Layer) => layer.visible$))\r\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\r\n      .subscribe((allLayersAreVisible: boolean) =>\r\n        this.component.layersAreAllVisible = allLayersAreVisible);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  EventEmitter,\r\n  Output,\r\n  OnDestroy\r\n} from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material';\r\n\r\nimport {\r\n  BehaviorSubject,\r\n  Subscription,\r\n} from 'rxjs';\r\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\r\n\r\n@Component({\r\n  selector: 'igo-layer-list-tool',\r\n  templateUrl: './layer-list-tool.component.html',\r\n  styleUrls: ['./layer-list-tool.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class LayerListToolComponent implements OnInit, OnDestroy {\r\n\r\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n  onlyVisible$$: Subscription;\r\n  sortAlpha$$: Subscription;\r\n  term$$: Subscription;\r\n\r\n  @Input() layersAreAllVisible: boolean = true;\r\n\r\n  @Input() floatLabel: FloatLabelType = 'auto';\r\n\r\n  @Input()\r\n  set onlyVisible(value: boolean) {\r\n    this.onlyVisible$.next(value);\r\n  }\r\n  get onlyVisible(): boolean {\r\n    return this.onlyVisible$.value;\r\n  }\r\n\r\n  @Input()\r\n  set sortAlpha(value: boolean) {\r\n    this.sortAlpha$.next(value);\r\n  }\r\n  get sortAlpha(): boolean {\r\n    return this.sortAlpha$.value;\r\n  }\r\n\r\n  @Input()\r\n  set term(value: string) {\r\n    this.term$.next(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n\r\n  public selectionMode = false;\r\n\r\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\r\n  @Output() selection = new EventEmitter<boolean>();\r\n\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe(keyword => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha: this.sortAlpha});\r\n    });\r\n\r\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible,\r\n        sortAlpha: this.sortAlpha});\r\n    });\r\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\r\n      this.appliedFilterAndSort.emit({\r\n        keyword: this.term,\r\n        onlyVisible: this.onlyVisible,\r\n        sortAlpha});\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.onlyVisible$$.unsubscribe();\r\n    this.sortAlpha$$.unsubscribe();\r\n    this.term$$.unsubscribe();\r\n  }\r\n\r\n  clearTerm() {\r\n    this.term = undefined;\r\n  }\r\n  toggleSortAlpha() {\r\n    this.sortAlpha = !this.sortAlpha;\r\n  }\r\n\r\n  toggleOnlyVisible() {\r\n    this.onlyVisible = !this.onlyVisible;\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    this.selectionMode = !this.selectionMode;\r\n    this.selection.emit(this.selectionMode);\r\n  }\r\n}\r\n","export enum LayerListToolControlsEnum {\r\n  always = 'always',\r\n  never = 'never',\r\n  default = 'default'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerListToolService {\r\n  public keyword: string;\r\n  public sortAlpha = false;\r\n  public onlyVisible = false;\r\n  public onlyInRange = false;\r\n  public keywordInitialized = false;\r\n  public sortedAlphaInitialized = false;\r\n  public onlyVisibleInitialized = false;\r\n  public onlyInRangeInitialized = false;\r\n\r\n  constructor() {}\r\n\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\r\n\r\nimport { Layer, VectorLayer } from '../shared/layers';\r\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\r\n\r\n@Component({\r\n  selector: 'igo-track-feature-button',\r\n  templateUrl: './track-feature-button.component.html',\r\n  styleUrls: ['./track-feature-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TrackFeatureButtonComponent implements OnInit {\r\n\r\n  @Input() layer: VectorLayer;\r\n\r\n  @Input() trackFeature = false;\r\n\r\n  get options(): VectorLayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.options;\r\n  }\r\n\r\n  public color: string = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.color = this.trackFeature ? 'primary' : 'basic';\r\n  }\r\n\r\n  toggleTrackFeature() {\r\n    if (this.trackFeature) {\r\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'basic';\r\n    } else {\r\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\r\n      this.color = 'primary';\r\n    }\r\n    this.trackFeature = !this.trackFeature;\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureMotion } from '../feature.enums';\r\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\n\r\n/**\r\n * This strategy loads a store's features into it's layer counterpart.\r\n * The store -> layer binding is a one-way binding. That means any entity\r\n * added to the store will be added to the layer but the opposite is false.\r\n *\r\n * Important: This strategy observes filtered entities, not raw entities. This\r\n * is not configurable yet.\r\n */\r\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Subscription to the store's features\r\n   */\r\n  private stores$$ = new Map<FeatureStore, Subscription>();\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for entities changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on load\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for entities changes in a store.\r\n   * Important: Never observe a store's sorted entities. It makes no sense\r\n   * to display sorted entities (instead of unsorted) on a layer and it\r\n   * would potentially result in a lot of useless computation.\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    const subscription = store.view.all$()\r\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\r\n    this.stores$$.set(store, subscription);\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in a store.\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const subscription = this.stores$$.get(store);\r\n    if (subscription !== undefined) {\r\n      subscription.unsubscribe();\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for entities changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\r\n      entries[1].unsubscribe();\r\n    });\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features into a layer or clear the layer if the array of features is empty.\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\r\n    if (features.length === 0) {\r\n      store.clearLayer();\r\n    } else {\r\n      store.setLayerFeatures(\r\n        features,\r\n        this.selectMotion(store),\r\n        this.options.viewScale,\r\n        this.options.areaRatio,\r\n        this.options.getFeatureId\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Selects the best motion\r\n   * @param store A FeatureStore to apply the motion\r\n   * @returns The motion selected\r\n   */\r\n  private selectMotion(store: FeatureStore) {\r\n    if (this.motion !== undefined) { return this.motion; }\r\n\r\n    if (store.pristine === true) {\r\n      // If features have just been loaded into the store, move/zoom on them\r\n      return FeatureMotion.Default;\r\n    } else if (store.count > store.view.count) {\r\n      // If features have been filtered, move/zoom on the remaining ones\r\n      return FeatureMotion.Default;\r\n    } else {\r\n      // On insert, update or delete, do nothing\r\n      return FeatureMotion.None;\r\n    }\r\n  }\r\n}\r\n","import { unByKey } from 'ol/Observable';\r\nimport { OlEvent } from 'ol/events/Event';\r\n\r\nimport { EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\r\n\r\n/**\r\n * This strategy loads a layer's features into it's store counterpart.\r\n * The layer -> store binding is a one-way binding. That means any OL feature\r\n * added to the layer will be added to the store but the opposite is false.\r\n *\r\n * Important: In it's current state, this strategy is to meant to be combined\r\n * with a standard Loading strategy and it would probably cause recursion issues.\r\n */\r\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Subscription to the store's OL source changes\r\n   */\r\n  private stores$$ = new Map<FeatureStore, string>();\r\n\r\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\r\n    super(options);\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and start watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      this.watchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and stop watching for Ol source changes\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      this.unwatchStore(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start watching all stores already bound to that strategy at once.\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\r\n  }\r\n\r\n  /**\r\n   * Stop watching all stores bound to that strategy\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Watch for a store's  OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private watchStore(store: FeatureStore) {\r\n    if (this.stores$$.has(store)) {\r\n      return;\r\n    }\r\n\r\n    this.onSourceChanges(store);\r\n    const olSource = store.layer.ol.getSource();\r\n    olSource.on('change', (event: OlEvent) => {\r\n      this.onSourceChanges(store);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop watching for a store's OL source changes\r\n   * @param store Feature store\r\n   */\r\n  private unwatchStore(store: FeatureStore) {\r\n    const key = this.stores$$.get(store);\r\n    if (key !== undefined) {\r\n      unByKey(key);\r\n      this.stores$$.delete(store);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop watching for OL source changes in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\r\n      unByKey(entries[1]);\r\n    });\r\n    this.stores$$.clear();\r\n  }\r\n\r\n  /**\r\n   * Load features from an OL source into a  store or clear the store if the source is empty\r\n   * @param features Store filtered features\r\n   * @param store Feature store\r\n   */\r\n  private onSourceChanges(store: FeatureStore) {\r\n    const olFeatures = store.layer.ol.getSource().getFeatures();\r\n    if (olFeatures.length === 0) {\r\n      store.clear();\r\n    } else {\r\n      store.setStoreOlFeatures(olFeatures);\r\n    }\r\n  }\r\n}\r\n","import OlFeature from 'ol/Feature';\r\n\r\nimport {\r\n  getEntityId,\r\n  EntityKey,\r\n  EntityStore\r\n} from '@igo2/common';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { FeatureMotion } from './feature.enums';\r\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\r\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures } from './feature.utils';\r\n\r\n/**\r\n * The class is a specialized version of an EntityStore that stores\r\n * features and the map layer to display them on. Synchronization\r\n * between the store and the layer is handled by strategies.\r\n */\r\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\r\n\r\n  /**\r\n   * Vector layer to display the features on\r\n   */\r\n  layer: VectorLayer;\r\n\r\n  /**\r\n   * The map the layer is bound to\r\n   */\r\n  readonly map: IgoMap;\r\n\r\n  /**\r\n   * The layer's data source\r\n   */\r\n  get source(): FeatureDataSource {\r\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\r\n  }\r\n\r\n  constructor(entities: T[], options: FeatureStoreOptions) {\r\n    super(entities, options);\r\n    this.map = options.map;\r\n  }\r\n\r\n  /**\r\n   * Bind this store to a vector layer\r\n   * @param layer Vector layer\r\n   * @returns Feature store\r\n   */\r\n  bindLayer(layer: VectorLayer): FeatureStore {\r\n    this.layer = layer;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible. Strategies\r\n   * make extensive use of that method.\r\n   * @param features Features\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  setLayerFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number,\r\n    getId?: (Feature) => EntityKey\r\n  ) {\r\n    getId = getId ? getId : getEntityId;\r\n    this.checkLayer();\r\n\r\n    const olFeatures = features\r\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\r\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\r\n  }\r\n\r\n  /**\r\n   * Set the store's features from an array of OL features.\r\n   * @param olFeatures Ol features\r\n   */\r\n  setStoreOlFeatures(olFeatures: OlFeature[]) {\r\n    this.checkLayer();\r\n\r\n    const features = olFeatures.map((olFeature: OlFeature) => {\r\n      olFeature.set('_featureStore', this, true);\r\n      return featureFromOl(olFeature, this.layer.map.projection);\r\n    });\r\n    this.load(features as T[]);\r\n  }\r\n\r\n  /**\r\n   * Remove all features from the layer\r\n   */\r\n  clearLayer() {\r\n    this.checkLayer();\r\n    this.source.ol.clear();\r\n  }\r\n\r\n  /**\r\n   * Check wether a layer is bound or not and throw an error if not.\r\n   */\r\n  private checkLayer() {\r\n    if (this.layer === undefined) {\r\n      throw new Error('This FeatureStore is not bound to a layer.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the layer's features and perform a motion to make them visible.\r\n   * @param features Openlayers feature objects\r\n   * @param motion Optional: The type of motion to perform\r\n   */\r\n  private setLayerOlFeatures(\r\n    olFeatures: OlFeature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    viewScale?: [number, number, number, number],\r\n    areaRatio?: number\r\n  ) {\r\n    const olSource = this.layer.ol.getSource();\r\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\r\n    if (diff.remove.length > 0) {\r\n      this.removeOlFeaturesFromLayer(diff.remove);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      this.addOlFeaturesToLayer(diff.add);\r\n    }\r\n\r\n    if (diff.add.length > 0) {\r\n      // If features are added, do a motion toward the newly added features\r\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\r\n    } else if (diff.remove.length > 0) {\r\n      // Else, do a motion toward all the features\r\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add features to the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private addOlFeaturesToLayer(olFeatures: OlFeature[]) {\r\n    olFeatures.forEach((olFeature: OlFeature) => {\r\n      olFeature.set('_featureStore', this, true);\r\n    });\r\n    this.source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the the layer\r\n   * @param features Openlayers feature objects\r\n   */\r\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature[]) {\r\n    olFeatures.forEach((olFeature: OlFeature) => {\r\n      this.source.ol.removeFeature(olFeature);\r\n    });\r\n  }\r\n\r\n}\r\n","import OlFeature from 'ol/Feature';\r\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\r\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\r\nimport { ListenerFunction } from 'ol/events';\r\nimport { MapBrowserPointerEvent as OlMapBrowserPointerEvent } from 'ol/MapBrowserEvent';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { Subscription, combineLatest } from 'rxjs';\r\nimport { map, debounceTime, skip } from 'rxjs/operators';\r\n\r\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\r\n\r\nimport { FeatureDataSource } from '../../../datasource';\r\nimport { VectorLayer } from '../../../layer';\r\nimport { IgoMap, ctrlKeyDown } from '../../../map';\r\n\r\nimport { Feature, FeatureStoreSelectionStrategyOptions } from '../feature.interfaces';\r\nimport { FeatureStore } from '../store';\r\nimport { FeatureMotion } from '../feature.enums';\r\n\r\nclass OlDragSelectInteraction extends OlDragBoxInteraction {\r\n  constructor(options) {\r\n    super(options);\r\n  }\r\n}\r\n\r\n/**\r\n * This strategy synchronizes a store and a layer selected entities.\r\n * The store <-> layer binding is a two-way binding.\r\n *\r\n * In many cases, a single strategy bound to multiple stores\r\n * will yield better results that multiple strategies with each their\r\n * own store. In the latter scenario, a click on overlapping features\r\n * would trigger the strategy of each layer and they would cancel\r\n * each other as well as move the map view around needlessly.\r\n */\r\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\r\n\r\n  /**\r\n   * Listener to the map click event that allows selecting a feature\r\n   * by clicking on the map\r\n   */\r\n  private mapClickListener: ListenerFunction;\r\n\r\n  private olDragSelectInteraction: OlDragSelectInteraction;\r\n\r\n  private olDragSelectInteractionEndKey: string;\r\n\r\n  /**\r\n   * Subscription to all stores selected entities\r\n   */\r\n  private stores$$: Subscription;\r\n\r\n  private motion: FeatureMotion;\r\n\r\n  /**\r\n   * The map the layers belong to\r\n   */\r\n  get map(): IgoMap { return this.options.map; }\r\n\r\n  /**\r\n   * A feature store that'll contain the selected features. It has it's own\r\n   * layer, shared by all the stores this staretgy is bound to.\r\n   */\r\n  get overlayStore(): FeatureStore { return this._overlayStore; }\r\n  private _overlayStore: FeatureStore;\r\n\r\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\r\n    super(options);\r\n    this.setMotion(options.motion);\r\n    this._overlayStore = this.createOverlayStore();\r\n  }\r\n\r\n  /**\r\n   * Bind this strategy to a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  bindStore(store: FeatureStore) {\r\n    super.bindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unbind this strategy from a store and force this strategy's\r\n   * reactivation to properly setup watchers.\r\n   * @param store Feature store\r\n   */\r\n  unbindStore(store: FeatureStore) {\r\n    super.unbindStore(store);\r\n    if (this.active === true) {\r\n      // Force reactivation\r\n      this.activate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define the motion to apply on select\r\n   * @param motion Feature motion\r\n   */\r\n  setMotion(motion: FeatureMotion) {\r\n    this.motion = motion;\r\n  }\r\n\r\n  /**\r\n   * Unselect all entities, from all stores\r\n   */\r\n  unselectAll() {\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      store.state.updateAll({selected: false});\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.overlayStore.clear();\r\n  }\r\n\r\n  /**\r\n   * Deactivate the selection without removing the selection\r\n   * overlay.\r\n   */\r\n  deactivateSelection() {\r\n    this.unlistenToMapClick();\r\n    this.removeDragBoxInteraction();\r\n    this.unwatchAll();\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer, setup the map click lsitener and\r\n   * start watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doActivate() {\r\n    this.addOverlayLayer();\r\n    this.listenToMapClick();\r\n    if (this.options.dragBox === true) {\r\n      this.addDragBoxInteraction();\r\n    }\r\n    this.watchAll();\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer, remove the map click lsitener and\r\n   * stop watching for stores selection\r\n   * @internal\r\n   */\r\n  protected doDeactivate() {\r\n    this.deactivateSelection();\r\n    this.removeOverlayLayer();\r\n  }\r\n\r\n  /**\r\n   * Create a single observable of all the stores. With a single observable,\r\n   * features can be added all at once to the overlay layer and a single\r\n   * motion can be performed. Multiple observable would have\r\n   * a cancelling effect on each other.\r\n   */\r\n  private watchAll() {\r\n    this.unwatchAll();\r\n\r\n    const stores$ = this.stores.map((store: FeatureStore) => {\r\n      return store.stateView.manyBy$((record: EntityRecord<Feature>) => {\r\n        return record.state.selected === true;\r\n      }).pipe(\r\n        map((records: EntityRecord<Feature>[]) => records.map(record => record.entity))\r\n      );\r\n    });\r\n    this.stores$$ = combineLatest(stores$)\r\n      .pipe(\r\n        debounceTime(5),\r\n        skip(1), // Skip intial selection\r\n        map((features: Array<Feature[]>) => features.reduce((a, b) => a.concat(b)))\r\n      ).subscribe((features: Feature[]) => this.onSelectFromStore(features));\r\n  }\r\n\r\n  /**\r\n   * Stop watching for selection in all stores.\r\n   */\r\n  private unwatchAll() {\r\n    if (this.stores$$ !== undefined) {\r\n      this.stores$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a 'singleclick' listener to the map that'll allow selecting\r\n   * features by clicking on the map. The selection will be performed\r\n   * only on the layers bound to this strategy.\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on('singleclick', (event: OlMapBrowserPointerEvent) => {\r\n      this.onMapClick(event);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove the map click listener\r\n   */\r\n  private unlistenToMapClick() {\r\n    if (this.mapClickListener !== undefined) {\r\n      this.map.ol.un(\r\n        this.mapClickListener.type,\r\n        this.mapClickListener.listener\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On map click, select feature at pixel\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onMapClick(event: OlMapBrowserPointerEvent) {\r\n    const exclusive = !ctrlKeyDown(event);\r\n    const reverse = !exclusive;\r\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\r\n      hitTolerance: this.options.hitTolerance || 0,\r\n      layerFilter: (olLayer) => {\r\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\r\n          return store.layer.ol === olLayer;\r\n        });\r\n        return storeOlLayer !== undefined;\r\n      }\r\n    });\r\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\r\n  }\r\n\r\n  /**\r\n   * Add a drag box interaction and, on drag box end, select features\r\n   */\r\n  private addDragBoxInteraction() {\r\n    let olDragSelectInteraction;\r\n    const olInteractions = this.map.ol.getInteractions().getArray();\r\n\r\n    // There can only be one dragbox interaction, so find the current one, if any\r\n    // Don't keep a reference to the current dragbox because we don't want\r\n    // to remove it when this startegy is deactivated\r\n    for (const olInteraction of olInteractions) {\r\n      if (olInteraction instanceof OlDragSelectInteraction) {\r\n        olDragSelectInteraction = olInteraction;\r\n        break;\r\n      }\r\n    }\r\n    // If no drag box interaction is found, create a new one and add it to the map\r\n    if (olDragSelectInteraction === undefined) {\r\n      olDragSelectInteraction = new OlDragSelectInteraction({\r\n        condition: ctrlKeyDown\r\n      });\r\n      this.map.ol.addInteraction(olDragSelectInteraction);\r\n      this.olDragSelectInteraction = olDragSelectInteraction;\r\n    }\r\n\r\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\r\n      'boxend',\r\n      (event: OlMapBrowserPointerEvent) => this.onDragBoxEnd(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove drag box interaction\r\n   */\r\n  private removeDragBoxInteraction() {\r\n    if (this.olDragSelectInteractionEndKey !== undefined) {\r\n      unByKey(this.olDragSelectInteractionEndKey);\r\n    }\r\n    if (this.olDragSelectInteraction !== undefined) {\r\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\r\n    }\r\n    this.olDragSelectInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * On dragbox end, select features in drag box\r\n   * @param event OL MapBrowserPointerEvent\r\n   */\r\n  private onDragBoxEnd(event: OlDragBoxEvent) {\r\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\r\n    const extent = event.target.getGeometry().getExtent();\r\n    const olFeatures = this.stores.reduce((acc: OlFeature[], store: FeatureStore) => {\r\n      const olSource = store.layer.ol.getSource();\r\n      acc.push(...olSource.getFeaturesInExtent(extent));\r\n      return acc;\r\n    }, []);\r\n    this.onSelectFromMap(olFeatures, exclusive, false);\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the store, add\r\n   * them to this startegy's overlay layer (select on map)\r\n   * @param features Store features\r\n   */\r\n  private onSelectFromStore(features: Feature[]) {\r\n    const motion = this.motion;\r\n    const olOverlayFeatures = this.overlayStore.layer.ol.getSource().getFeatures();\r\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature) => olFeature.getId());\r\n    const featuresKeys = features.map(this.overlayStore.getKey);\r\n\r\n    let doMotion;\r\n    if (features.length === 0) {\r\n      doMotion = false;\r\n    } else {\r\n      doMotion = overlayFeaturesKeys.length !== featuresKeys.length ||\r\n        !overlayFeaturesKeys.every((key: EntityKey) => featuresKeys.indexOf(key) >= 0);\r\n    }\r\n\r\n    this.overlayStore.setLayerFeatures(\r\n      features,\r\n      doMotion ? motion : FeatureMotion.None,\r\n      this.options.viewScale,\r\n      this.options.areaRatio,\r\n      this.options.getFeatureId\r\n    );\r\n  }\r\n\r\n  /**\r\n   * When features are selected from the map, also select them\r\n   * in their store.\r\n   * @param olFeatures OL feature objects\r\n   */\r\n  private onSelectFromMap(olFeatures: OlFeature[], exclusive: boolean, reverse: boolean) {\r\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\r\n\r\n    this.stores.forEach((store: FeatureStore) => {\r\n      const features = groupedFeatures.get(store);\r\n      if (features === undefined && exclusive === true) {\r\n        this.unselectAllFeaturesFromStore(store);\r\n      } else if (features === undefined && exclusive === false) {\r\n        // Do nothing\r\n      } else {\r\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Select features in store\r\n   * @param store: Feature store\r\n   * @param features Features\r\n   */\r\n  private selectFeaturesFromStore(store: FeatureStore, features: Feature[], exclusive: boolean, reverse: boolean) {\r\n    if (reverse === true) {\r\n      store.state.reverseMany(features, ['selected']);\r\n    } else {\r\n      store.state.updateMany(features, {selected: true}, exclusive);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unselect all features from store\r\n   * @param store: Feature store\r\n   */\r\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\r\n    store.state.updateAll({selected: false});\r\n  }\r\n\r\n  /**\r\n   * This method returns a store -> features mapping from a list\r\n   * of OL selected features. OL features keep a reference to the store\r\n   * they are from.\r\n   * @param olFeatures: OL feature objects\r\n   * @returns Store -> features mapping\r\n   */\r\n  private groupFeaturesByStore(olFeatures: OlFeature[]): Map<FeatureStore, Feature[]> {\r\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\r\n    if (olFeatures === null || olFeatures === undefined) {\r\n      return groupedFeatures;\r\n    }\r\n\r\n    olFeatures.forEach((olFeature: OlFeature) => {\r\n      const store = olFeature.get('_featureStore');\r\n      if (store === undefined) { return; }\r\n\r\n      let features = groupedFeatures.get(store);\r\n      if (features === undefined) {\r\n        features = [];\r\n        groupedFeatures.set(store, features);\r\n      }\r\n\r\n      const feature = store.get(olFeature.getId());\r\n      if (feature !== undefined) {\r\n        features.push(feature);\r\n      }\r\n    });\r\n\r\n    return groupedFeatures;\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay store\r\n   */\r\n  private createOverlayStore(): FeatureStore {\r\n    const overlayLayer = this.options.layer\r\n      ? this.options.layer\r\n      : this.createOverlayLayer();\r\n    return new FeatureStore([], {map: this.map}).bindLayer(overlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay store that'll contain the selected features.\r\n   * @returns Overlay layer\r\n   */\r\n  private createOverlayLayer(): VectorLayer {\r\n    return new VectorLayer({\r\n      zIndex: 300,\r\n      source: new FeatureDataSource(),\r\n      style: undefined,\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay store's layer to the map to display the selected\r\n   * features.\r\n   */\r\n  private addOverlayLayer() {\r\n    if (this.overlayStore.layer.map === undefined) {\r\n      this.map.addLayer(this.overlayStore.layer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the overlay layer from the map\r\n   */\r\n  private removeOverlayLayer() {\r\n    this.overlayStore.source.ol.clear();\r\n    this.map.removeLayer(this.overlayStore.layer);\r\n  }\r\n}\r\n","import * as olextent from 'ol/extent';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlGeometryLayout from 'ol/geom/GeometryLayout';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport OlLayer from 'ol/layer/Layer';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport {\r\n  EntityKey,\r\n  getEntityId,\r\n  getEntityTitle,\r\n  getEntityRevision,\r\n  getEntityIcon,\r\n  getEntityProperty\r\n} from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map';\r\nimport { VectorLayer } from '../../layer';\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { FEATURE, FeatureMotion } from './feature.enums';\r\nimport { Feature } from './feature.interfaces';\r\nimport { FeatureStore } from './store';\r\nimport {\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy\r\n} from './strategies';\r\n\r\n/**\r\n * Create an Openlayers feature object out of a feature definition.\r\n * The output object has a reference to the feature id.\r\n * @param feature Feature definition\r\n * @param projectionOut Feature object projection\r\n * @returns OpenLayers feature object\r\n */\r\nexport function featureToOl(\r\n  feature: Feature,\r\n  projectionOut: string,\r\n  getId?: (Feature) => EntityKey\r\n): OlFeature {\r\n  getId = getId ? getId : getEntityId;\r\n\r\n  const olFormat = new OlFormatGeoJSON();\r\n  const olFeature = olFormat.readFeature(feature, {\r\n    dataProjection: feature.projection,\r\n    featureProjection: projectionOut\r\n  });\r\n\r\n  olFeature.setId(getId(feature));\r\n\r\n  const title = getEntityTitle(feature);\r\n  if (title !== undefined) {\r\n    olFeature.set('_title', title, true);\r\n  }\r\n\r\n  if (feature.extent !== undefined) {\r\n    olFeature.set('_extent', feature.extent, true);\r\n  }\r\n\r\n  if (feature.projection !== undefined) {\r\n    olFeature.set('_projection', feature.projection, true);\r\n  }\r\n\r\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\r\n  if (mapTitle !== undefined) {\r\n    olFeature.set('_mapTitle', mapTitle, true);\r\n  }\r\n\r\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\r\n\r\n  const icon = getEntityIcon(feature);\r\n  if (icon !== undefined) {\r\n    olFeature.set('_icon', icon, true);\r\n  }\r\n\r\n  if (feature.meta && feature.meta.style) {\r\n    olFeature.set('_style', feature.meta.style, true);\r\n  }\r\n\r\n  if (feature.sourceId) {\r\n    olFeature.set('_sourceId', feature.sourceId, true);\r\n  }\r\n\r\n  return olFeature;\r\n}\r\n\r\nexport function renderFeatureFromOl(\r\n  olRenderFeature: OlRenderFeature,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer,\r\n  projectionOut = 'EPSG:4326'\r\n  ): Feature {\r\n    let geom;\r\n    let title;\r\n    let exclude;\r\n    let excludeOffline;\r\n\r\n    if (olLayer) {\r\n      title = olLayer.get('title');\r\n      if (olLayer.get('sourceOptions')) {\r\n        exclude = olLayer.get('sourceOptions').excludeAttribute;\r\n        excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\r\n      }\r\n    } else {\r\n      title = olRenderFeature.get('_title');\r\n    }\r\n\r\n    const olFormat = new OlFormatGeoJSON();\r\n    const properties = olRenderFeature.getProperties();\r\n    const geometryType = olRenderFeature.getType();\r\n\r\n    if (geometryType === 'Polygon') {\r\n      const ends = olRenderFeature.ends_;\r\n      geom = new OlPolygon(olRenderFeature.flatCoordinates_, OlGeometryLayout.XY, ends);\r\n    } else if (geometryType === 'Point') {\r\n      geom = new OlPoint(olRenderFeature.flatCoordinates_, OlGeometryLayout.XY);\r\n    } else if (geometryType === 'LineString') {\r\n      geom = new OlLineString(olRenderFeature.flatCoordinates_, OlGeometryLayout.XY);\r\n    }\r\n\r\n    const geometry = olFormat.writeGeometryObject(geom, {\r\n      dataProjection: projectionOut,\r\n      featureProjection: projectionIn\r\n    });\r\n\r\n    const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\r\n    const mapTitle = olRenderFeature.get('_mapTitle');\r\n\r\n    return {\r\n      type: FEATURE,\r\n      projection: projectionOut,\r\n      extent: olRenderFeature.getExtent(),\r\n      meta: {\r\n        id,\r\n        title: title ? title : mapTitle ? mapTitle : id,\r\n        mapTitle,\r\n        excludeAttribute: exclude,\r\n        excludeAttributeOffline: excludeOffline\r\n      },\r\n      properties,\r\n      geometry,\r\n      ol: olRenderFeature\r\n    };\r\n  }\r\n/**\r\n * Create a feature object out of an OL feature\r\n * The output object has a reference to the feature id.\r\n * @param olFeature OL Feature\r\n * @param projectionIn OL feature projection\r\n * @param olLayer OL Layer\r\n * @param projectionOut Feature projection\r\n * @returns Feature\r\n */\r\nexport function featureFromOl(\r\n  olFeature: OlFeature,\r\n  projectionIn: string,\r\n  olLayer?: OlLayer,\r\n  projectionOut = 'EPSG:4326'\r\n): Feature {\r\n  let title;\r\n  let exclude;\r\n  let excludeOffline;\r\n  const olFormat = new OlFormatGeoJSON();\r\n\r\n  const keys = olFeature.getKeys().filter((key: string) => {\r\n    return !key.startsWith('_') && key !== 'geometry';\r\n  });\r\n  const properties = keys.reduce((acc: object, key: string) => {\r\n    acc[key] = olFeature.get(key);\r\n    return acc;\r\n  }, {});\r\n\r\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\r\n    dataProjection: projectionOut,\r\n    featureProjection: projectionIn\r\n  });\r\n\r\n  if (olLayer) {\r\n    title = olLayer.get('title');\r\n    if (olLayer.get('sourceOptions')) {\r\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\r\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\r\n    }\r\n  } else {\r\n    title = olFeature.get('_title');\r\n  }\r\n  const mapTitle = olFeature.get('_mapTitle');\r\n  const id = olFeature.getId() ? olFeature.getId() : uuid();\r\n\r\n  return {\r\n    type: FEATURE,\r\n    projection: projectionOut,\r\n    extent: olFeature.get('_extent'),\r\n    meta: {\r\n      id,\r\n      title: title ? title : mapTitle ? mapTitle : id,\r\n      mapTitle,\r\n      revision: olFeature.getRevision(),\r\n      style: olFeature.get('_style'),\r\n      excludeAttribute: exclude,\r\n      excludeAttributeOffline: excludeOffline\r\n    },\r\n    properties,\r\n    geometry,\r\n    ol: olFeature\r\n  };\r\n}\r\n\r\n/**\r\n * Compute an OL feature extent in it's map projection\r\n * @param map Map\r\n * @param olFeature OL feature\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeatureExtent(\r\n  map: IgoMap,\r\n  olFeature: OlFeature\r\n): [number, number, number, number] {\r\n  let olExtent = olextent.createEmpty();\r\n\r\n  const olFeatureExtent = olFeature.get('_extent');\r\n  const olFeatureProjection = olFeature.get('_projection');\r\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\r\n    olExtent = olproj.transformExtent(\r\n      olFeatureExtent,\r\n      olFeatureProjection,\r\n      map.projection\r\n    );\r\n  } else {\r\n    const olGeometry = olFeature.getGeometry();\r\n    if (olGeometry !== null) {\r\n      olExtent = olGeometry.getExtent();\r\n    }\r\n  }\r\n\r\n  return olExtent;\r\n}\r\n\r\n/**\r\n * Compute a multiple OL features extent in their map projection\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @returns Extent in the map projection\r\n */\r\nexport function computeOlFeaturesExtent(\r\n  map: IgoMap,\r\n  olFeatures: OlFeature[]\r\n): [number, number, number, number] {\r\n  const extent = olextent.createEmpty();\r\n\r\n  olFeatures.forEach((olFeature: OlFeature) => {\r\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\r\n    olextent.extend(extent, featureExtent);\r\n  });\r\n\r\n  return extent;\r\n}\r\n\r\n/**\r\n * Scale an extent.\r\n * @param extent Extent\r\n * @param Scaling factors for top, right, bottom and left directions, in that order\r\n * @returns Scaled extent\r\n */\r\nexport function scaleExtent(\r\n  extent: [number, number, number, number],\r\n  scale: [number, number, number, number]\r\n): [number, number, number, number] {\r\n  const [width, height] = olextent.getSize(extent);\r\n  return [\r\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\r\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\r\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\r\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\r\n  ];\r\n}\r\n\r\n/**\r\n * Return true if features are out of view.\r\n * If features are too close to the edge, they are considered out of view.\r\n * We define the edge as 5% of the extent size.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @returns Return true if features are out of view\r\n */\r\nexport function featuresAreOutOfView(\r\n  map: IgoMap,\r\n  featuresExtent: [number, number, number, number]\r\n) {\r\n  const mapExtent = map.viewController.getExtent();\r\n  const edgeRatio = 0.05;\r\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\r\n  const viewExtent = scaleExtent(mapExtent, scale as [\r\n    number,\r\n    number,\r\n    number,\r\n    number\r\n  ]);\r\n\r\n  return !olextent.containsExtent(viewExtent, featuresExtent);\r\n}\r\n\r\n/**\r\n * Return true if features are too deep into the view. This results\r\n * in features being too small.\r\n * Features are considered too small if their extent occupies less than\r\n * 1% of the map extent.\r\n * @param map Map\r\n * @param featuresExtent The features's extent\r\n * @param areaRatio The features extent to view extent acceptable ratio\r\n * @returns Return true if features are too deep in the view\r\n */\r\nexport function featuresAreTooDeepInView(\r\n  map: IgoMap,\r\n  featuresExtent: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  // An area ratio of 0.004 means that the feature extent's width and height\r\n  // should be about 1/16 of the map extent's width and height\r\n  areaRatio = areaRatio ? areaRatio : 0.004;\r\n  const mapExtent = map.viewController.getExtent();\r\n  const mapExtentArea = olextent.getArea(mapExtent);\r\n  const featuresExtentArea = olextent.getArea(featuresExtent);\r\n\r\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) { // In case it's a point\r\n      return false;\r\n  }\r\n\r\n  return featuresExtentArea / mapExtentArea < areaRatio;\r\n}\r\n\r\n/**\r\n * Fit view to include the features extent.\r\n * By default, this method will let the features occupy about 50% of the viewport.\r\n * @param map Map\r\n * @param olFeatures OL features\r\n * @param motion To motion to the new map view\r\n * @param scale If this is defined, the original view will be scaled\r\n *  by that factor before any logic is applied.\r\n */\r\nexport function moveToOlFeatures(\r\n  map: IgoMap,\r\n  olFeatures: OlFeature[],\r\n  motion: FeatureMotion = FeatureMotion.Default,\r\n  scale?: [number, number, number, number],\r\n  areaRatio?: number\r\n) {\r\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\r\n  let viewExtent = featuresExtent;\r\n  if (scale !== undefined) {\r\n    viewExtent = scaleExtent(viewExtent, scale);\r\n  }\r\n\r\n  if (motion === FeatureMotion.Zoom) {\r\n    map.viewController.zoomToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Move) {\r\n    map.viewController.moveToExtent(viewExtent);\r\n  } else if (motion === FeatureMotion.Default) {\r\n    if (\r\n      featuresAreOutOfView(map, featuresExtent) ||\r\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\r\n    ) {\r\n      map.viewController.zoomToExtent(viewExtent);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Hide an OL feature\r\n * @param olFeature OL feature\r\n */\r\nexport function hideOlFeature(olFeature: OlFeature) {\r\n  olFeature.setStyle(new olstyle.Style({}));\r\n}\r\n\r\n/**\r\n * Try to bind a layer to a store if none is bound already.\r\n * The layer will also be added to the store's map.\r\n * If no layer is given to that function, a basic one will be created.\r\n * @param store The store to bind the layer\r\n * @param layer An optional VectorLayer\r\n */\r\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\r\n  if (store.layer !== undefined) {\r\n    if (store.layer.map === undefined) {\r\n      store.map.addLayer(store.layer);\r\n    }\r\n    return;\r\n  }\r\n\r\n  layer = layer\r\n    ? layer\r\n    : new VectorLayer({\r\n        source: new FeatureDataSource()\r\n      });\r\n  store.bindLayer(layer);\r\n  if (store.layer.map === undefined) {\r\n    store.map.addLayer(store.layer);\r\n  }\r\n}\r\n\r\n/**\r\n * Try to add a loading strategy to a store and activate it.\r\n * If no strategy is given to that function, a basic one will be created.\r\n * @param store The store to bind the loading strategy\r\n * @param strategy An optional loading strategy\r\n */\r\nexport function tryAddLoadingStrategy(\r\n  store: FeatureStore,\r\n  strategy?: FeatureStoreLoadingStrategy\r\n) {\r\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\r\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    return;\r\n  }\r\n\r\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\r\n  store.addStrategy(strategy);\r\n  strategy.activate();\r\n}\r\n\r\n/**\r\n * Try to add a selection strategy to a store and activate it.\r\n * If no strategy is given to that function, a basic one will be created.\r\n * @param store The store to bind the selection strategy\r\n * @param [strategy] An optional selection strategy\r\n */\r\nexport function tryAddSelectionStrategy(\r\n  store: FeatureStore,\r\n  strategy?: FeatureStoreSelectionStrategy\r\n) {\r\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\r\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n    return;\r\n  }\r\n  strategy = strategy\r\n    ? strategy\r\n    : new FeatureStoreSelectionStrategy({\r\n        map: store.map\r\n      });\r\n  store.addStrategy(strategy);\r\n  strategy.activate();\r\n}\r\n\r\n/**\r\n * Compute a diff between a source array of Ol features and a target array\r\n * @param source Source array of OL features\r\n * @param starget Target array of OL features\r\n * @returns Features to add and remove\r\n */\r\nexport function computeOlFeaturesDiff(\r\n  source: OlFeature[],\r\n  target: OlFeature[]\r\n): {\r\n  add: OlFeature[];\r\n  remove: OlFeature;\r\n} {\r\n  const olFeaturesMap = new Map();\r\n  target.forEach((olFeature: OlFeature) => {\r\n    olFeaturesMap.set(olFeature.getId(), olFeature);\r\n  });\r\n\r\n  const olFeaturesToRemove = [];\r\n  source.forEach((olFeature: OlFeature) => {\r\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\r\n    if (newOlFeature === undefined) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else if (\r\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\r\n    ) {\r\n      olFeaturesToRemove.push(olFeature);\r\n    } else {\r\n      olFeaturesMap.delete(newOlFeature.getId());\r\n    }\r\n  });\r\n\r\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\r\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature) => {\r\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\r\n  });\r\n\r\n  return {\r\n    add: olFeaturesToAdd,\r\n    remove: olFeaturesToRemove\r\n  };\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ViewChild\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { Form, FormComponent, getEntityRevision } from '@igo2/common';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { FEATURE } from '../shared/feature.enums';\r\nimport { Feature, FeatureMeta } from '../shared/feature.interfaces';\r\n\r\n/**\r\n * A configurable form, optionnally bound to a feature.\r\n * This component creates an entity form and, on submit,\r\n * returns a feature made out of the submitted data. It also\r\n * does things like managing the feature visibility while it's being updated\r\n * as well as disabling the selection of another feature.\r\n */\r\n@Component({\r\n  selector: 'igo-feature-form',\r\n  templateUrl: './feature-form.component.html',\r\n  styleUrls: ['./feature-form.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FeatureFormComponent {\r\n\r\n  /**\r\n   * Form\r\n   */\r\n  @Input() form: Form;\r\n\r\n  /**\r\n   * Feature to update\r\n   */\r\n  @Input()\r\n  set feature(value: Feature | undefined) { this.feature$.next(value); }\r\n  get feature(): Feature | undefined { return this.feature$.value; }\r\n  readonly feature$: BehaviorSubject<Feature> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Event emitted when the form is submitted\r\n   */\r\n  @Output() submitForm = new EventEmitter<Feature>();\r\n\r\n  @ViewChild('igoForm') igoForm: FormComponent;\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Transform the form data to a feature and emit an event\r\n   * @param event Form submit event\r\n   * @internal\r\n   */\r\n  onSubmit(data: { [key: string]: any }) {\r\n    const feature = this.formDataToFeature(data);\r\n    this.submitForm.emit(feature);\r\n  }\r\n\r\n  getData(): Feature {\r\n    return this.formDataToFeature(this.igoForm.getData());\r\n  }\r\n\r\n  /**\r\n   * Transform the form data to a feature\r\n   * @param data Form data\r\n   * @returns A feature\r\n   */\r\n  private formDataToFeature(data: { [key: string]: any }): Feature {\r\n    const properties = {};\r\n    const meta = {};\r\n    if (this.feature === undefined) {\r\n      (meta as any).id = uuid();\r\n    } else {\r\n      Object.assign(properties, this.feature.properties);\r\n      Object.assign(meta, this.feature.meta, {\r\n        revision: getEntityRevision(this.feature) + 1\r\n      });\r\n    }\r\n\r\n    const propertyPrefix = 'properties.';\r\n    Object.entries(data).forEach((entry: [string, any]) => {\r\n      const [key, value] = entry;\r\n      if (key.startsWith(propertyPrefix)) {\r\n        const property = key.substr(propertyPrefix.length);\r\n        properties[property] = value;\r\n      }\r\n    });\r\n\r\n    let geometry = data.geometry;\r\n    if (geometry === undefined && this.feature !== undefined) {\r\n      geometry = this.feature.geometry;\r\n    }\r\n\r\n    return {\r\n      meta: meta as FeatureMeta,\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: 'EPSG:4326',\r\n      properties\r\n    };\r\n  }\r\n}\r\n","import { SearchSource } from './../../search/shared/sources/source';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nimport {\r\n  Feature,\r\n  FeatureMotion,\r\n  featureToOl,\r\n  moveToOlFeatures\r\n} from '../../feature';\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { createOverlayLayer } from './overlay.utils';\r\n\r\n/**\r\n * This class is simply a shortcut for adding features to a map.\r\n * It does nothing more than a standard layer but it's shipped with\r\n * a defautl style based on the geometry type of the features it contains.\r\n * @todo Enhance that by using a FeatureStore and strategies.\r\n */\r\nexport class Overlay {\r\n  /**\r\n   * The map to add the layer to\r\n   */\r\n  private map: IgoMap;\r\n\r\n  /**\r\n   * Overlay layer\r\n   */\r\n  private layer: VectorLayer;\r\n\r\n  /**\r\n   * Overlay layer's data source\r\n   */\r\n  get dataSource(): FeatureDataSource {\r\n    return this.layer.dataSource as FeatureDataSource;\r\n  }\r\n\r\n  constructor(map?: IgoMap) {\r\n    this.layer = createOverlayLayer();\r\n    this.setMap(map);\r\n  }\r\n\r\n  /**\r\n   * Bind this to a map and add the overlay layer to that map\r\n   * @param map Map\r\n   */\r\n  setMap(map: IgoMap) {\r\n    if (map === undefined) {\r\n      if (this.map !== undefined) {\r\n        this.map.ol.removeLayer(this.layer.ol);\r\n      }\r\n    } else {\r\n      map.ol.addLayer(this.layer.ol);\r\n    }\r\n    this.map = map;\r\n  }\r\n\r\n  /**\r\n   * Set the overlay features and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\r\n   */\r\n  setFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default,\r\n    sourceId?: string\r\n  ) {\r\n    if (sourceId) {\r\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\r\n        if (olFeature.get('_sourceId') === sourceId) {\r\n          this.removeOlFeature(olFeature);\r\n        }\r\n      }\r\n    } else {\r\n      this.clear();\r\n    }\r\n    this.addFeatures(features, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the  overlay and, optionally, move to it\r\n   * @param feature Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\r\n    this.addFeatures([feature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add features to the  overlay and, optionally, move to them\r\n   * @param features Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addFeatures(\r\n    features: Feature[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    const olFeatures = [];\r\n    features.forEach((feature: Feature) => {\r\n      const olFeature = featureToOl(feature, this.map.projection);\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry === null) {\r\n        return;\r\n      }\r\n      olFeatures.push(olFeature);\r\n    });\r\n\r\n    this.addOlFeatures(olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\r\n   * @param olFeature OpenLayers Feature\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeature(\r\n    olFeature: OlFeature,\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.addOlFeatures([olFeature], motion);\r\n  }\r\n\r\n  /**\r\n   * Add OpenLayers features to the overlay and, optionally, move to them\r\n   * @param olFeatures OpenLayers Features\r\n   * @param motion Optional: Apply this motion to the map view\r\n   */\r\n  addOlFeatures(\r\n    olFeatures: OlFeature[],\r\n    motion: FeatureMotion = FeatureMotion.Default\r\n  ) {\r\n    this.dataSource.ol.addFeatures(olFeatures);\r\n    moveToOlFeatures(this.map, olFeatures, motion);\r\n  }\r\n\r\n  /**\r\n   * Remove a feature from the overlay\r\n   * @param feature Feature\r\n   */\r\n  removeFeature(feature: Feature) {\r\n    this.removeFeatures([feature]);\r\n  }\r\n\r\n  /**\r\n   * Remove features from the overlay\r\n   * @param features Features\r\n   */\r\n  removeFeatures(features: Feature[]) {\r\n    features.forEach((feature: Feature) => {\r\n      if (feature.meta) {\r\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\r\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove an OpenLayers feature from the overlay\r\n   * @param olFeature OpenLayers Feature\r\n   */\r\n  removeOlFeature(olFeature: OlFeature) {\r\n    this.dataSource.ol.removeFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay\r\n   */\r\n  clear() {\r\n    this.dataSource.ol.clear();\r\n  }\r\n}\r\n","import { Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { Watcher, SubjectStatus } from '@igo2/utils';\r\nimport { Layer } from '../../layer/shared/layers';\r\n\r\nexport class LayerWatcher extends Watcher {\r\n  private loaded = 0;\r\n  private loading = 0;\r\n  private layers: Layer[] = [];\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  watch() {}\r\n\r\n  unwatch() {\r\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\r\n  }\r\n\r\n  watchLayer(layer: Layer) {\r\n    if (layer.status$ === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.layers.push(layer);\r\n\r\n    const layer$$ = layer.status$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe(status => {\r\n        if (status === SubjectStatus.Working) {\r\n          this.loading += 1;\r\n        } else if (status === SubjectStatus.Done) {\r\n          this.loaded += 1;\r\n        }\r\n\r\n        if (this.loaded >= this.loading) {\r\n          this.loading = this.loaded = 0;\r\n          this.status = SubjectStatus.Done;\r\n        } else if (this.loading > 0) {\r\n          this.status = SubjectStatus.Working;\r\n        }\r\n      });\r\n\r\n    this.subscriptions.push(layer$$);\r\n  }\r\n\r\n  unwatchLayer(layer: Layer) {\r\n    layer.status$.next(SubjectStatus.Done);\r\n    const index = this.layers.indexOf(layer);\r\n    if (index >= 0) {\r\n      const status = (layer as any).watcher.status;\r\n      if (\r\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\r\n      ) {\r\n        this.loaded += 1;\r\n      }\r\n      this.subscriptions[index].unsubscribe();\r\n      this.subscriptions.splice(index, 1);\r\n      this.layers.splice(index, 1);\r\n      (layer as any).watcher.unwatch();\r\n    }\r\n  }\r\n}\r\n","export enum MapViewAction {\r\n  Move,\r\n  Zoom\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\n/**\r\n * Base map controller\r\n */\r\nexport class MapController {\r\n\r\n  /**\r\n   * OL Map\r\n   */\r\n  protected olMap: OlMap;\r\n\r\n  /**\r\n   * Array of observer keys\r\n   */\r\n  protected observerKeys: string[] = [];\r\n\r\n  /**\r\n   * Return the OL map this controller is bound to\r\n   * @returns OL Map\r\n   */\r\n  getOlMap(): OlMap {\r\n    return this.olMap;\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\r\n      throw new Error('This controller is already bound to a map.');\r\n    }\r\n\r\n    if (olMap === undefined) {\r\n      this.teardownObservers();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    this.observerKeys.forEach((key: string) => unByKey(key));\r\n    this.observerKeys = [];\r\n  }\r\n\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlMapEvent from 'ol/MapEvent';\r\n\r\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport * as oleasing from 'ol/easing';\r\nimport * as olproj from 'ol/proj';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport OlView from 'ol/View';\r\n\r\nimport { MapViewAction } from '../map.enums';\r\nimport { MapExtent, MapViewState } from '../map.interface';\r\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\r\nimport { MapController } from './controller';\r\n\r\nexport interface MapViewControllerOptions {\r\n  stateHistory: boolean;\r\n}\r\n\r\n/**\r\n * Controller to handle map view interactions\r\n */\r\nexport class MapViewController extends MapController {\r\n  /**\r\n   * Observable of the current resolution\r\n   */\r\n  resolution$ = new BehaviorSubject<number>(undefined);\r\n\r\n  /**\r\n   * Observable of the current state\r\n   */\r\n  state$ = new BehaviorSubject<MapViewState>(undefined);\r\n\r\n  /**\r\n   * View Padding\r\n   */\r\n  padding = [0, 0, 0, 0];\r\n\r\n  /**\r\n   * Max zoom after set extent\r\n   */\r\n  maxZoomOnExtent = 19;\r\n\r\n  /**\r\n   * Extent stream\r\n   */\r\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\r\n\r\n  /**\r\n   * Subscription to the movement stream\r\n   */\r\n  private extent$$: Subscription;\r\n\r\n  /**\r\n   * History of states\r\n   */\r\n  private states: MapViewState[] = [];\r\n\r\n  /**\r\n   * Current state index\r\n   */\r\n  private stateIndex: number = 0;\r\n\r\n  /**\r\n   * Whether the view controller should keep the view's state history\r\n   */\r\n  get stateHistory(): boolean {\r\n    return this.options ? this.options.stateHistory === true : false;\r\n  }\r\n\r\n  /**\r\n   * OL View\r\n   */\r\n  get olView(): OlView {\r\n    return this.olMap.getView();\r\n  }\r\n\r\n  constructor(private options?: MapViewControllerOptions) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Add or remove this controller to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    super.setOlMap(olMap);\r\n    this.setupObservers();\r\n  }\r\n\r\n  /**\r\n   * Observe move moveend and subscribe to the extent stream\r\n   */\r\n  setupObservers() {\r\n    if (this.stateHistory === true) {\r\n      this.observerKeys.push(\r\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event))\r\n      );\r\n    }\r\n\r\n    this.extent$$ = this.extent$\r\n      .pipe(debounceTime(25))\r\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\r\n        this.setExtent(value.extent, value.action);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Teardown any observers\r\n   */\r\n  teardownObservers() {\r\n    super.teardownObservers();\r\n    if (this.extent$$ !== undefined) {\r\n      this.extent$$.unsubscribe();\r\n      this.extent$$ = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the view's OL projection\r\n   * @returns OL projection\r\n   */\r\n  getOlProjection(): OlProjection {\r\n    return this.olView.getProjection();\r\n  }\r\n\r\n  /**\r\n   * Get the current map view center\r\n   * @param projection Output projection\r\n   * @returns Center\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    let center = this.olView.getCenter();\r\n    if (projection && center) {\r\n      center = olproj.transform(center, this.getOlProjection(), projection);\r\n    }\r\n    return center;\r\n  }\r\n\r\n  /**\r\n   * Get the current view extent\r\n   * @param projection Output projection\r\n   * @returns Extent\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\r\n    if (projection && extent) {\r\n      extent = olproj.transformExtent(\r\n        extent,\r\n        this.getOlProjection(),\r\n        projection\r\n      );\r\n    }\r\n    return extent;\r\n  }\r\n\r\n  /**\r\n   * Get the current scale\r\n   * @param dpi Dot per inches\r\n   * @returns View scale\r\n   */\r\n  getScale(dpi = 96) {\r\n    return getScaleFromResolution(\r\n      this.getResolution(),\r\n      this.getOlProjection().getUnits(),\r\n      dpi\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the current resolution\r\n   * @returns Projection denominator\r\n   */\r\n  getResolution(): number {\r\n    return this.olView.getResolution();\r\n  }\r\n\r\n  /**\r\n   * Get the current zoom level\r\n   * @returns Zoom level\r\n   */\r\n  getZoom(): number {\r\n    return Math.round(this.olView.getZoom());\r\n  }\r\n\r\n  /**\r\n   * Zoom in\r\n   */\r\n  zoomIn() {\r\n    this.zoomTo(this.olView.getZoom() + 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom out\r\n   */\r\n  zoomOut() {\r\n    this.zoomTo(this.olView.getZoom() - 1);\r\n  }\r\n\r\n  /**\r\n   * Zoom to specific zoom level\r\n   * @param zoom Zoom level\r\n   */\r\n  zoomTo(zoom: number) {\r\n    this.olView.cancelAnimations();\r\n    this.olView.animate({\r\n      zoom,\r\n      duration: 250,\r\n      easing: oleasing.easeOut\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Move to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to move to\r\n   */\r\n  moveToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Move });\r\n  }\r\n\r\n  /**\r\n   * Zoom to extent after a short delay (100ms) unless\r\n   * a new movement gets registered in the meantime.\r\n   * @param extent Extent to zoom to\r\n   */\r\n  zoomToExtent(extent: [number, number, number, number]) {\r\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\r\n  }\r\n\r\n  /**\r\n   * Return the current view rotation\r\n   * @returns Rotation angle in degrees\r\n   */\r\n  getRotation(): number {\r\n    return this.olView.getRotation();\r\n  }\r\n\r\n  /**\r\n   * Reset the view rotation to 0\r\n   */\r\n  resetRotation() {\r\n    this.olView.animate({ rotation: 0 });\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a previous state\r\n   * @returns True if the view has a previous state\r\n   */\r\n  hasPreviousState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex > 0;\r\n  }\r\n\r\n  /**\r\n   * Whether the view has a next state\r\n   * @returns True if the view has a next state\r\n   */\r\n  hasNextState(): boolean {\r\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\r\n  }\r\n\r\n  /**\r\n   * Restore the previous view state\r\n   */\r\n  previousState() {\r\n    if (this.hasPreviousState()) {\r\n      this.setStateIndex(this.stateIndex - 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restore the next view state\r\n   */\r\n  nextState() {\r\n    if (this.hasNextState()) {\r\n      this.setStateIndex(this.stateIndex + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the state history\r\n   */\r\n  clearStateHistory() {\r\n    this.states = [];\r\n    this.stateIndex = 0;\r\n  }\r\n\r\n  /**\r\n   * Update the the view to it's intial state\r\n   */\r\n  setInitialState() {\r\n    if (this.states.length > 0) {\r\n      this.setStateIndex(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move to the extent retrieved from the stream\r\n   * @param extent Extent\r\n   * @param action Either zoom or move\r\n   * @param animation With or without animation to the target extent.\r\n   */\r\n  private setExtent(\r\n    extent: MapExtent,\r\n    action: MapViewAction,\r\n    animation: boolean = true\r\n  ) {\r\n    const olView = this.olView;\r\n    olView.cancelAnimations();\r\n    const duration = animation ? 500 : 0;\r\n    const zoom = olView.getZoom();\r\n\r\n    const fromCenter = olView.getCenter();\r\n    const toCenter = [\r\n      extent[0] + (extent[2] - extent[0]) / 2,\r\n      extent[1] + (extent[3] - extent[1]) / 2\r\n    ];\r\n    const distCenter = Math.sqrt(\r\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\r\n        Math.pow(fromCenter[1] - toCenter[1], 2)\r\n    );\r\n    const fromExtent = olView.calculateExtent();\r\n    const fromSize = Math.sqrt(\r\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\r\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\r\n    );\r\n    const toSize = Math.sqrt(\r\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\r\n    );\r\n    const moySize = (toSize + fromSize) / 2;\r\n    const xSize = distCenter / moySize;\r\n\r\n    const maxZoom =\r\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\r\n        ? zoom\r\n        : this.maxZoomOnExtent;\r\n\r\n    olView.fit(extent, {\r\n      maxZoom,\r\n      padding: this.padding,\r\n      duration: xSize > 4 ? 0 : duration\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set the view state index\r\n   * @param index State index\r\n   */\r\n  private setStateIndex(index: number) {\r\n    this.stateIndex = index;\r\n    this.setState(this.states[index]);\r\n  }\r\n\r\n  /**\r\n   * Set the view state\r\n   * @param state View state\r\n   */\r\n  private setState(state: MapViewState) {\r\n    this.olView.animate({\r\n      resolution: state.resolution,\r\n      center: state.center,\r\n      duration: 0\r\n    });\r\n  }\r\n\r\n  /**\r\n   * On move end, get the view state and record it.\r\n   * @param event Map event\r\n   */\r\n  private onMoveEnd(event: OlMapEvent) {\r\n    const resolution = this.getResolution();\r\n    if (this.resolution$.value !== resolution) {\r\n      this.resolution$.next(resolution);\r\n    }\r\n\r\n    const state = {\r\n      resolution,\r\n      center: this.getCenter(),\r\n      zoom: this.getZoom()\r\n    };\r\n\r\n    if (this.stateHistory === true) {\r\n      const stateIndex = this.stateIndex;\r\n      const stateAtIndex =\r\n        this.states.length === 0 ? undefined : this.states[stateIndex];\r\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\r\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\r\n        this.stateIndex = this.states.length - 1;\r\n      }\r\n    }\r\n\r\n    this.state$.next(state);\r\n  }\r\n}\r\n","import olMap from 'ol/Map';\r\nimport olView from 'ol/View';\r\nimport olFeature from 'ol/Feature';\r\nimport olGeolocation from 'ol/Geolocation';\r\nimport olControlAttribution from 'ol/control/Attribution';\r\nimport olControlScaleLine from 'ol/control/ScaleLine';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport * as olinteraction from 'ol/interaction';\r\nimport olCircle from 'ol/geom/Circle';\r\n\r\nimport proj4 from 'proj4';\r\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\n\r\nimport { Layer } from '../../layer/shared/layers';\r\nimport { Overlay } from '../../overlay/shared/overlay';\r\n\r\nimport { LayerWatcher } from '../utils/layer-watcher';\r\nimport {\r\n  MapViewOptions,\r\n  MapOptions,\r\n  MapAttributionOptions,\r\n  MapScaleLineOptions,\r\n  MapExtent\r\n} from './map.interface';\r\nimport { MapViewController } from './controllers/view';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\r\n\r\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\r\n// Move some stuff into controllers.\r\nexport class IgoMap {\r\n  public ol: olMap;\r\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\r\n  public layers$ = new BehaviorSubject<Layer[]>([]);\r\n  public status$: Subject<SubjectStatus>;\r\n  public alwaysTracking: boolean;\r\n  public positionFollower: boolean = true;\r\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\r\n  public geolocationFeature: olFeature;\r\n  public bufferGeom: olCircle;\r\n  public bufferFeature: olFeature;\r\n  public buffer: Overlay;\r\n  public overlay: Overlay;\r\n  public viewController: MapViewController;\r\n\r\n  public bufferDataSource: FeatureDataSource;\r\n\r\n  private layerWatcher: LayerWatcher;\r\n  private geolocation: olGeolocation;\r\n  private geolocation$$: Subscription;\r\n\r\n  private options: MapOptions;\r\n  private defaultOptions: Partial<MapOptions> = {\r\n    controls: { attribution: false }\r\n  };\r\n\r\n  get layers(): Layer[] {\r\n    return this.layers$.value;\r\n  }\r\n\r\n  get projection(): string {\r\n    return this.viewController.getOlProjection().getCode();\r\n  }\r\n\r\n  constructor(options?: MapOptions) {\r\n    this.options = Object.assign({}, this.defaultOptions, options);\r\n    this.layerWatcher = new LayerWatcher();\r\n    this.status$ = this.layerWatcher.status$;\r\n    olproj4.register(proj4);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    const controls = [];\r\n    if (this.options.controls) {\r\n      if (this.options.controls.attribution) {\r\n        const attributionOpt = (this.options.controls.attribution === true\r\n          ? {}\r\n          : this.options.controls.attribution) as MapAttributionOptions;\r\n        controls.push(new olControlAttribution(attributionOpt));\r\n      }\r\n      if (this.options.controls.scaleLine) {\r\n        const scaleLineOpt = (this.options.controls.scaleLine === true\r\n          ? {}\r\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\r\n        controls.push(new olControlScaleLine(scaleLineOpt));\r\n      }\r\n    }\r\n    let interactions = {};\r\n    if (this.options.interactions === false) {\r\n      interactions = {\r\n        altShiftDragRotate: false,\r\n        doubleClickZoom: false,\r\n        keyboard: false,\r\n        mouseWheelZoom: false,\r\n        shiftDragZoom: false,\r\n        dragPan: false,\r\n        pinchRotate: false,\r\n        pinchZoom: false\r\n      };\r\n    }\r\n\r\n    this.ol = new olMap({\r\n      interactions: olinteraction.defaults(interactions),\r\n      controls\r\n    });\r\n\r\n    this.setView(this.options.view || {});\r\n    this.viewController = new MapViewController({\r\n      stateHistory: true\r\n    });\r\n    this.viewController.setOlMap(this.ol);\r\n    this.overlay = new Overlay(this);\r\n    this.buffer = new Overlay(this);\r\n  }\r\n\r\n  setTarget(id: string) {\r\n    this.ol.setTarget(id);\r\n    if (id !== undefined) {\r\n      this.layerWatcher.subscribe(() => {}, null);\r\n    } else {\r\n      this.layerWatcher.unsubscribe();\r\n    }\r\n  }\r\n\r\n  updateView(options: MapViewOptions) {\r\n    const currentView = this.ol.getView();\r\n    const viewOptions = Object.assign(\r\n      {\r\n        zoom: currentView.getZoom()\r\n      },\r\n      currentView.getProperties()\r\n    );\r\n\r\n    this.setView(Object.assign(viewOptions, options));\r\n    if (options.maxZoomOnExtent) {\r\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the map view\r\n   * @param options Map view options\r\n   */\r\n  setView(options: MapViewOptions) {\r\n    if (this.viewController !== undefined) {\r\n      this.viewController.clearStateHistory();\r\n    }\r\n\r\n    const view = new olView(options);\r\n    this.ol.setView(view);\r\n\r\n    this.unsubscribeGeolocate();\r\n    if (options) {\r\n      if (options.center) {\r\n        const projection = view.getProjection().getCode();\r\n        const center = olproj.fromLonLat(options.center, projection);\r\n        view.setCenter(center);\r\n      }\r\n\r\n      if (options.geolocate) {\r\n        this.geolocate(true);\r\n      }\r\n\r\n      if (options.alwaysTracking) {\r\n        this.alwaysTracking = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getCenter(projection?: string | OlProjection): [number, number] {\r\n    return this.viewController.getCenter(projection);\r\n  }\r\n\r\n  /**\r\n   * Deprecated\r\n   * TODO: Move to ViewController and update every place it's used\r\n   */\r\n  getExtent(projection?: string | OlProjection): MapExtent {\r\n    return this.viewController.getExtent(projection);\r\n  }\r\n\r\n  // TODO: Move to ViewController and update every place it's used\r\n  getZoom(): number {\r\n    return this.viewController.getZoom();\r\n  }\r\n\r\n  changeBaseLayer(baseLayer: Layer) {\r\n    if (!baseLayer) {\r\n      return;\r\n    }\r\n\r\n    for (const bl of this.getBaseLayers()) {\r\n      bl.visible = false;\r\n    }\r\n\r\n    baseLayer.visible = true;\r\n\r\n    this.viewController.olView.setMinZoom(\r\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\r\n    );\r\n    this.viewController.olView.setMaxZoom(\r\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\r\n    );\r\n  }\r\n\r\n  getBaseLayers(): Layer[] {\r\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\r\n  }\r\n\r\n  getLayerById(id: string): Layer {\r\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\r\n  }\r\n\r\n  getLayerByAlias(alias: string): Layer {\r\n    return this.layers.find(\r\n      (layer: Layer) => layer.alias && layer.alias === alias\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Add a single layer\r\n   * @param layer Layer to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayer(layer: Layer, push = true) {\r\n    this.addLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add many layers\r\n   * @param layers Layers to add\r\n   * @param push DEPRECATED\r\n   */\r\n  addLayers(layers: Layer[], push = true) {\r\n    let offsetZIndex = 0;\r\n    let offsetBaseLayerZIndex = 0;\r\n    const addedLayers = layers\r\n      .map((layer: Layer) => {\r\n        const offset = layer.zIndex\r\n          ? 0\r\n          : layer.baseLayer\r\n          ? offsetBaseLayerZIndex++\r\n          : offsetZIndex++;\r\n        return this.doAddLayer(layer, offset);\r\n      })\r\n      .filter((layer: Layer | undefined) => layer !== undefined);\r\n    this.setLayers([].concat(this.layers, addedLayers));\r\n  }\r\n\r\n  /**\r\n   * Remove a single layer\r\n   * @param layer Layer to remove\r\n   */\r\n  removeLayer(layer: Layer) {\r\n    this.removeLayers([layer]);\r\n  }\r\n\r\n  /**\r\n   * Remove many layers\r\n   * @param layers Layers to remove\r\n   */\r\n  removeLayers(layers: Layer[]) {\r\n    const newLayers = this.layers$.value.slice(0);\r\n    const layersToRemove = [];\r\n    layers.forEach((layer: Layer) => {\r\n      const index = newLayers.indexOf(layer);\r\n      if (index >= 0) {\r\n        layersToRemove.push(layer);\r\n        newLayers.splice(index, 1);\r\n      }\r\n    });\r\n\r\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.setLayers(newLayers);\r\n  }\r\n\r\n  /**\r\n   * Remove all layers\r\n   */\r\n  removeAllLayers() {\r\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\r\n    this.layers$.next([]);\r\n  }\r\n\r\n  raiseLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index > 1) {\r\n      this.moveLayer(layer, index, index - 1);\r\n    }\r\n  }\r\n\r\n  raiseLayers(layers: Layer[]) {\r\n    for (const layer of layers) {\r\n      this.raiseLayer(layer);\r\n    }\r\n  }\r\n\r\n  lowerLayer(layer: Layer) {\r\n    const index = this.getLayerIndex(layer);\r\n    if (index < this.layers.length - 1) {\r\n      this.moveLayer(layer, index, index + 1);\r\n    }\r\n  }\r\n\r\n  lowerLayers(layers: Layer[]) {\r\n    const reverseLayers = layers.reverse();\r\n    for (const layer of reverseLayers) {\r\n      this.lowerLayer(layer);\r\n    }\r\n  }\r\n\r\n  moveLayer(layer: Layer, from: number, to: number) {\r\n    const layerTo = this.layers[to];\r\n    const zIndexTo = layerTo.zIndex;\r\n    const zIndexFrom = layer.zIndex;\r\n\r\n    if (layerTo.baseLayer || layer.baseLayer) {\r\n      return;\r\n    }\r\n\r\n    layer.zIndex = zIndexTo;\r\n    layerTo.zIndex = zIndexFrom;\r\n\r\n    this.layers[to] = layer;\r\n    this.layers[from] = layerTo;\r\n    this.layers$.next(this.layers.slice(0));\r\n  }\r\n\r\n  /**\r\n   * Add a layer to the OL map and start watching. If the layer is already\r\n   * added to this map, make it visible but don't add it one again.\r\n   * @param layer Layer\r\n   * @returns The layer added, if any\r\n   */\r\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\r\n    if (layer.baseLayer && layer.visible) {\r\n      this.changeBaseLayer(layer);\r\n    }\r\n\r\n    const existingLayer = this.getLayerById(layer.id);\r\n    if (existingLayer !== undefined) {\r\n      existingLayer.visible = true;\r\n      return;\r\n    }\r\n\r\n    if (!layer.baseLayer && layer.zIndex) {\r\n      layer.zIndex += 10;\r\n    }\r\n\r\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\r\n      const maxZIndex = Math.max(\r\n        layer.baseLayer ? 0 : 10,\r\n        ...this.layers\r\n          .filter(\r\n            l => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\r\n          )\r\n          .map(l => l.zIndex)\r\n      );\r\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\r\n    }\r\n\r\n    if (layer.baseLayer && layer.zIndex > 9) {\r\n      layer.zIndex = 10; // baselayer must have zIndex < 10\r\n    }\r\n\r\n    layer.setMap(this);\r\n    this.layerWatcher.watchLayer(layer);\r\n    this.ol.addLayer(layer.ol);\r\n\r\n    return layer;\r\n  }\r\n\r\n  /**\r\n   * Remove a layer from the OL map and stop watching\r\n   * @param layer Layer\r\n   */\r\n  private doRemoveLayer(layer: Layer) {\r\n    this.layerWatcher.unwatchLayer(layer);\r\n    this.ol.removeLayer(layer.ol);\r\n    layer.setMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Update the layers observable\r\n   * @param layers Layers\r\n   */\r\n  private setLayers(layers: Layer[]) {\r\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\r\n  }\r\n\r\n  /**\r\n   * Sort layers by descending zIndex\r\n   * @param layers Array of layers\r\n   * @returns The original array, sorted by zIndex\r\n   */\r\n  private sortLayersByZIndex(layers: Layer[]) {\r\n    // Sort by descending zIndex\r\n    return layers.sort(\r\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get layer index in the map's inenr array of layers\r\n   * @param layer Layer\r\n   * @returns The layer index\r\n   */\r\n  private getLayerIndex(layer: Layer) {\r\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\r\n  }\r\n\r\n  // TODO: Create a GeolocationController with everything below\r\n  geolocate(track = false) {\r\n    let first = true;\r\n    if (this.geolocation$$) {\r\n      track = this.geolocation.getTracking();\r\n      this.unsubscribeGeolocate();\r\n    }\r\n    this.startGeolocation();\r\n\r\n    this.geolocation$$ = this.geolocation$.subscribe(geolocation => {\r\n      if (!geolocation) {\r\n        return;\r\n      }\r\n      const accuracy = geolocation.getAccuracy();\r\n      if (accuracy < 10000) {\r\n        const geometry = geolocation.getAccuracyGeometry();\r\n        const extent = geometry.getExtent();\r\n        if (\r\n          this.geolocationFeature &&\r\n          this.overlay.dataSource.ol.getFeatureById(\r\n            this.geolocationFeature.getId()\r\n          )\r\n        ) {\r\n          this.overlay.dataSource.ol.removeFeature(this.geolocationFeature);\r\n        }\r\n\r\n        if (this.bufferFeature) {\r\n          this.buffer.dataSource.ol.removeFeature(this.bufferFeature);\r\n        }\r\n\r\n        this.geolocationFeature = new olFeature({ geometry });\r\n        this.geolocationFeature.setId('geolocationFeature');\r\n        if (!this.positionFollower && this.alwaysTracking) {\r\n          this.overlay.addOlFeature(this.geolocationFeature, FeatureMotion.None);\r\n        } else if (this.positionFollower && this.alwaysTracking) {\r\n          this.overlay.addOlFeature(this.geolocationFeature, FeatureMotion.Move);\r\n        } else {\r\n          this.overlay.addOlFeature(this.geolocationFeature);\r\n        }\r\n\r\n        if (this.ol.getView().options_.buffer) {\r\n          const bufferRadius = this.ol.getView().options_.buffer.bufferRadius;\r\n          const coordinates = geolocation.getPosition();\r\n          this.bufferGeom = new olCircle(coordinates, bufferRadius);\r\n          const bufferStroke = this.ol.getView().options_.buffer.bufferStroke;\r\n          const bufferFill = this.ol.getView().options_.buffer.bufferFill;\r\n\r\n          let bufferText;\r\n          if (this.ol.getView().options_.buffer.showBufferRadius) {\r\n            bufferText = bufferRadius.toString() + 'm';\r\n          } else {\r\n            bufferText = '';\r\n          }\r\n\r\n          this.bufferFeature = new olFeature(this.bufferGeom);\r\n          this.bufferFeature.setId('bufferFeature');\r\n          this.bufferFeature.set('bufferStroke', bufferStroke);\r\n          this.bufferFeature.set('bufferFill', bufferFill);\r\n          this.bufferFeature.set('bufferText', bufferText);\r\n          this.buffer.addOlFeature(this.bufferFeature, FeatureMotion.None);\r\n        }\r\n        if (first) {\r\n          this.viewController.zoomToExtent(extent);\r\n          this.positionFollower = !this.positionFollower;\r\n        }\r\n      } else if (first) {\r\n        const view = this.ol.getView();\r\n        const coordinates = geolocation.getPosition();\r\n        view.setCenter(coordinates);\r\n        view.setZoom(14);\r\n      }\r\n      if (track && !this.alwaysTracking) {\r\n        this.unsubscribeGeolocate();\r\n      }\r\n      first = false;\r\n    });\r\n  }\r\n\r\n  unsubscribeGeolocate() {\r\n    this.stopGeolocation();\r\n    if (this.geolocation$$) {\r\n      this.geolocation$$.unsubscribe();\r\n      this.geolocation$$ = undefined;\r\n    }\r\n  }\r\n\r\n  private startGeolocation() {\r\n    if (!this.geolocation) {\r\n      this.geolocation = new olGeolocation({\r\n        trackingOptions: {\r\n          enableHighAccuracy: true\r\n        },\r\n        projection: this.projection,\r\n        tracking: true\r\n      });\r\n\r\n      this.geolocation.on('change', evt => {\r\n        this.geolocation$.next(this.geolocation);\r\n      });\r\n    } else {\r\n      this.geolocation.setTracking(true);\r\n    }\r\n  }\r\n\r\n  private stopGeolocation() {\r\n    if (this.geolocation) {\r\n      this.geolocation.setTracking(false);\r\n    }\r\n  }\r\n\r\n  onOfflineToggle(offline: boolean) {\r\n    this.offlineButtonToggle$.next(offline);\r\n  }\r\n}\r\n","import { Directive, AfterViewInit } from '@angular/core';\r\nimport { NetworkService, ConnectionState, MessageService, LanguageService } from '@igo2/core';\r\n\r\nimport { IgoMap } from './map';\r\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\r\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { XYZDataSourceOptions } from '../../datasource/shared/datasources/xyz-datasource.interface';\r\nimport { MVTDataSourceOptions } from '../../datasource/shared/datasources/mvt-datasource.interface';\r\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { MVTDataSource } from '../../datasource/shared/datasources/mvt-datasource';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { XYZDataSource } from '../../datasource/shared/datasources/xyz-datasource';\r\n\r\n@Directive({\r\n    selector: '[igoMapOffline]'\r\n  })\r\nexport class MapOfflineDirective implements AfterViewInit {\r\n\r\n  private component: MapBrowserComponent;\r\n  private offlineButtonStatus: boolean = false;\r\n  private networkState: ConnectionState = {\r\n    connection: true\r\n  };\r\n  private offlineButtonState: ConnectionState = {\r\n    connection: true\r\n  };\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    component: MapBrowserComponent,\r\n    private networkService: NetworkService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n    ) {\r\n      this.component = component;\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n      this.map.offlineButtonToggle$.subscribe((offlineButtonToggle: boolean) => {\r\n        this.offlineButtonStatus = offlineButtonToggle;\r\n        const translate = this.languageService.translate;\r\n        if (this.offlineButtonStatus && this.networkState.connection) {\r\n          const message = translate.instant('igo.geo.network.offline.message');\r\n          const title = translate.instant('igo.geo.network.offline.title');\r\n          this.messageService.info(message, title);\r\n          this.offlineButtonState.connection = false;\r\n          this.changeLayer();\r\n        } else if (!this.offlineButtonStatus && !this.networkState.connection) {\r\n          const message = translate.instant('igo.geo.network.offline.message');\r\n          const title = translate.instant('igo.geo.network.offline.title');\r\n          this.messageService.info(message, title);\r\n          this.offlineButtonState.connection = false;\r\n          this.changeLayer();\r\n        } else if (!this.offlineButtonStatus && this.networkState.connection) {\r\n          let message;\r\n          let title;\r\n          const messageObs = translate.get('igo.geo.network.online.message');\r\n          const titleObs = translate.get('igo.geo.network.online.title');\r\n          messageObs.subscribe((message1: string) => {\r\n            message = message1;\r\n          });\r\n          titleObs.subscribe((title1: string) => {\r\n            title = title1;\r\n          });\r\n          this.messageService.info(message, title);\r\n          this.offlineButtonState.connection = true;\r\n          this.changeLayer();\r\n        }\r\n      });\r\n\r\n      this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n        this.networkState = state;\r\n        if (!this.offlineButtonStatus) {\r\n          this.changeLayer();\r\n        }\r\n      });\r\n\r\n      this.map.layers$.subscribe((layers: Layer[]) => {\r\n        this.changeLayer();\r\n      });\r\n    }\r\n\r\n  private changeLayer() {\r\n    let sourceOptions;\r\n    const layerList = this.map.layers$.value;\r\n    layerList.forEach(layer => {\r\n      if (layer.options.source instanceof MVTDataSource) {\r\n        sourceOptions = (layer.options.sourceOptions as MVTDataSourceOptions);\r\n        layer.ol.getSource().clear();\r\n      } else if (layer.options.source instanceof XYZDataSource) {\r\n        sourceOptions = (layer.options.sourceOptions as XYZDataSourceOptions);\r\n      } else if (layer.options.source instanceof ClusterDataSource) {\r\n        sourceOptions = (layer.options.sourceOptions as ClusterDataSourceOptions);\r\n      } else if (layer.options.source instanceof FeatureDataSource) {\r\n        sourceOptions = (layer.options.sourceOptions as FeatureDataSourceOptions);\r\n      } else {\r\n        if (this.networkState.connection === false || this.offlineButtonState.connection === false) {\r\n          layer.ol.setMaxResolution(0);\r\n          return;\r\n        } else if (this.networkState.connection === true || this.offlineButtonState.connection === true) {\r\n          layer.ol.setMaxResolution(Infinity);\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (sourceOptions) {\r\n        if (sourceOptions.pathOffline && this.networkState.connection === false ||\r\n          sourceOptions.pathOffline && this.offlineButtonState.connection === false) {\r\n            if (sourceOptions.type === 'vector' || sourceOptions.type === 'cluster') {\r\n              return;\r\n            }\r\n            layer.ol.getSource().setUrl(sourceOptions.pathOffline);\r\n        } else if (sourceOptions.pathOffline && this.networkState.connection === false ||\r\n          sourceOptions.pathOffline && this.offlineButtonState.connection === true) {\r\n            if (sourceOptions.type === 'vector' || sourceOptions.type === 'cluster') {\r\n              return;\r\n            }\r\n            layer.ol.getSource().setUrl(sourceOptions.url);\r\n        } else {\r\n          if (this.networkState.connection === false || this.offlineButtonState.connection === false) {\r\n            layer.ol.setMaxResolution(0);\r\n          } else if (this.networkState.connection === true || this.offlineButtonState.connection === true) {\r\n            layer.ol.setMaxResolution(Infinity);\r\n          }\r\n        }\r\n      } else {\r\n        if (this.networkState.connection === false || this.offlineButtonState.connection === false) {\r\n          layer.ol.setMaxResolution(0);\r\n        } else if (this.networkState.connection === true || this.offlineButtonState.connection === true) {\r\n          layer.ol.setMaxResolution(Infinity);\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { MapBrowserPointerEvent as OlMapBrowserPointerEvent } from 'ol/MapBrowserEvent';\r\nimport { ListenerFunction } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\n\r\nimport { transform } from 'ol/proj';\r\nimport { MediaService } from '@igo2/core';\r\n/**\r\n * This directive return the pointer coordinate (on click or pointermove)\r\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\r\n * to avoid too many emitted values.\r\n */\r\n@Directive({\r\n  selector: '[igoPointerPosition]'\r\n})\r\nexport class PointerPositionDirective implements OnInit, OnDestroy {\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener: ListenerFunction;\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener: ListenerFunction;\r\n\r\n  /**\r\n   * Delay before emitting an event\r\n   */\r\n  @Input() pointerPositionDelay: number = 1000;\r\n\r\n  /**\r\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\r\n   */\r\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService\r\n  ) { }\r\n\r\n  /**\r\n   * Start listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.listenToMapPointerMove();\r\n    this.listenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unlistenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: OlMapBrowserPointerEvent) => this.onPointerEvent(event, this.pointerPositionDelay)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map click\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: OlMapBrowserPointerEvent) => this.onPointerEvent(event, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    this.map.ol.un(this.pointerMoveListener.type, this.pointerMoveListener.listener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    this.map.ol.un(this.mapClickListener.type, this.mapClickListener.listener);\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onPointerEvent(event: OlMapBrowserPointerEvent, delay: number) {\r\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326');\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.pointerPositionCoord.emit(lonlat);\r\n    }, delay);\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { MapBrowserPointerEvent as OlMapBrowserPointerEvent } from 'ol/MapBrowserEvent';\r\nimport { ListenerFunction } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\n\r\nimport { transform } from 'ol/proj';\r\nimport { Subscription, BehaviorSubject, fromEvent } from 'rxjs';\r\nimport { MediaService } from '@igo2/core';\r\n/**\r\n * This directive return the pointer coordinate (on click or pointermove)\r\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\r\n * to avoid too many emitted values.\r\n * User needs to hold the key defined by pointerByKeyEventKeyCode to emit a coord.\r\n */\r\n@Directive({\r\n  selector: '[igoPointerPositionByKey]'\r\n})\r\nexport class PointerPositionByKeyDirective implements OnInit, OnDestroy {\r\n\r\n  private keyDown$$: Subscription;\r\n  private keyUp$$: Subscription;\r\n  private definedKeyIsDown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener: ListenerFunction;\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener: ListenerFunction;\r\n\r\n  /**\r\n   * Delay before emitting an event\r\n   */\r\n  @Input() pointerPositionByKeyDelay: number = 1000;\r\n\r\n  /**\r\n   * The key pressed (must be hold) to trigger the output\r\n   */\r\n  @Input() pointerPositionByKeyCode: number = 17;\r\n\r\n  /**\r\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\r\n   */\r\n  @Output() pointerPositionByKeyCoord = new EventEmitter<[number, number]>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private mediaService: MediaService\r\n  ) { }\r\n\r\n  /**\r\n   * Start listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.listenToMapPointerMove();\r\n    this.listenToMapClick();\r\n    this.subscribeToKeyDown();\r\n    this.subscribeToKeyUp();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to pointermove\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unlistenToMapClick();\r\n    this.unsubscribeToKeyDown();\r\n    this.unsubscribeToKeyUp();\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: OlMapBrowserPointerEvent) => this.onPointerEvent(event, this.pointerPositionByKeyDelay)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * On map click\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: OlMapBrowserPointerEvent) => this.onPointerEvent(event, 0)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to user defined key keyDown, hold down to activate the emit\r\n   */\r\n  private subscribeToKeyDown() {\r\n    this.unsubscribeToKeyDown();\r\n    this.keyDown$$ = fromEvent(document, 'keydown')\r\n    .subscribe((event: KeyboardEvent) => {\r\n      // On user defined key is down,\r\n      if (event.keyCode === this.pointerPositionByKeyCode) {\r\n        this.definedKeyIsDown$.next(true);\r\n        return;\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * Subscribe to user defined key keyUp, release to desactivate the emit\r\n   */\r\n  private subscribeToKeyUp() {\r\n    this.unsubscribeToKeyUp();\r\n    this.keyUp$$ = fromEvent(document, 'keyup')\r\n    .subscribe((event: KeyboardEvent) => {\r\n      // When user defined key is released,\r\n      if (event.keyCode === this.pointerPositionByKeyCode) {\r\n        this.definedKeyIsDown$.next(false);\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    this.map.ol.un(this.pointerMoveListener.type, this.pointerMoveListener.listener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    this.map.ol.un(this.mapClickListener.type, this.mapClickListener.listener);\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeToKeyDown() {\r\n    if (this.keyDown$$ !== undefined) {\r\n      this.keyDown$$.unsubscribe();\r\n      this.keyDown$$ = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key up\r\n   */\r\n  private unsubscribeToKeyUp() {\r\n    if (this.keyUp$$ !== undefined) {\r\n      this.keyUp$$.unsubscribe();\r\n      this.keyUp$$ = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\r\n   * User must hold the defined key to allow the emit.\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onPointerEvent(event: OlMapBrowserPointerEvent, delay: number) {\r\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    if (this.definedKeyIsDown$.value) {\r\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326');\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.pointerPositionByKeyCoord.emit(lonlat);\r\n    }, delay);\r\n  }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport proj4 from 'proj4';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olproj4 from 'ol/proj/proj4';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Projection } from './projection.interfaces';\r\n\r\n/**\r\n * When injected, this service automatically registers and\r\n * projection defined in the application config. A custom projection\r\n * needs to be registered to be usable by OL.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProjectionService {\r\n\r\n  constructor(private config: ConfigService) {\r\n    const projections = this.config.getConfig('projections') || [];\r\n    projections.forEach((projection: Projection) => {\r\n      projection.alias = projection.alias ? projection.alias : projection.code;\r\n      this.registerProjection(projection);\r\n    });\r\n\r\n    // register all utm zones\r\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\r\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\r\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\r\n      const proj: Projection = { code, def, extent : undefined};\r\n      this.registerProjection(proj);\r\n    }\r\n\r\n    // register all mtm zones\r\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\r\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\r\n      let lon0;\r\n      if (Number(mtmZone) <= 2) {\r\n        lon0 = -50 - Number(mtmZone) * 3;\r\n      } else if (Number(mtmZone) >= 12) {\r\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\r\n      } else {\r\n        lon0 = -49.5 - Number(mtmZone) * 3;\r\n      }\r\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\r\n      const proj: Projection = { code, def, extent : undefined};\r\n      this.registerProjection(proj);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Define a proj4 projection and register it in OL\r\n   * @param projection Projection\r\n   */\r\n  registerProjection(projection: Projection) {\r\n    proj4.defs(projection.code, projection.def);\r\n    olproj4.register(proj4);\r\n    if (projection.extent) {\r\n      olproj.get(projection.code).setExtent(projection.extent);\r\n    }\r\n  }\r\n\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-zoom-button',\r\n  templateUrl: './zoom-button.component.html',\r\n  styleUrls: ['./zoom-button.component.scss']\r\n})\r\nexport class ZoomButtonComponent {\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string;\r\n\r\n  get zoom(): number { return this.map.viewController.getZoom(); }\r\n\r\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\r\n\r\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\r\n\r\n  constructor() {}\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-geolocate-button',\r\n  templateUrl: './geolocate-button.component.html',\r\n  styleUrls: ['./geolocate-button.component.scss']\r\n})\r\nexport class GeolocateButtonComponent {\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  constructor() {}\r\n}\r\n","import { Component, Input, EventEmitter, Output, AfterViewInit } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { Observable, BehaviorSubject, Subscription, fromEvent } from 'rxjs';\r\nimport { debounceTime, startWith } from 'rxjs/operators';\r\nimport { ConfigService } from '@igo2/core';\r\n\r\n@Component({\r\n  selector: 'igo-offline-button',\r\n  templateUrl: './offline-button.component.html',\r\n  styleUrls: ['./offline-button.component.scss']\r\n})\r\n\r\nexport class OfflineButtonComponent {\r\n\r\n  btnStyle: string = 'baseStyle';\r\n  colorOff: string = 'rgb(255,255,255)';\r\n\r\n  @Output() change = new EventEmitter<boolean>();\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  @Input() public check: boolean = false;\r\n\r\n  get checked(): boolean {\r\n    return this.check;\r\n  }\r\n\r\n  public visible = false;\r\n\r\n  constructor(\r\n    private config: ConfigService\r\n    ) {\r\n    this.visible = this.config.getConfig('offlineButton') ? true : false;\r\n  }\r\n\r\n  onToggle() {\r\n    this.check = !this.check;\r\n    if (this.check) {\r\n      this.btnStyle = 'toggleStyle';\r\n    } else {\r\n      this.btnStyle = 'baseStyle';\r\n    }\r\n  }\r\n}\r\n","import {\r\n  trigger,\r\n  state,\r\n  style,\r\n  transition,\r\n  animate,\r\n  AnimationTriggerMetadata\r\n} from '@angular/animations';\r\n\r\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\r\n  return trigger('baseLayerSwitcherState', [\r\n    state(\r\n      'collapseIcon',\r\n      style({\r\n        height: '40px',\r\n        width: '40px',\r\n        overflow: 'hidden'\r\n      })\r\n    ),\r\n    state(\r\n      'collapseMap',\r\n      style({\r\n        height: '85px',\r\n        overflow: 'hidden'\r\n      })\r\n    ),\r\n    state(\r\n      'expand',\r\n      style({\r\n        overflow: 'hidden'\r\n      })\r\n    ),\r\n    transition('collapse => expand', animate('200ms')),\r\n    transition('expand => collapse', animate('200ms'))\r\n  ]);\r\n}\r\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MediaService, Media } from '@igo2/core';\r\nimport { Layer } from '../../layer';\r\nimport { IgoMap } from '../shared';\r\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\r\n\r\n@Component({\r\n  selector: 'igo-baselayers-switcher',\r\n  templateUrl: './baselayers-switcher.component.html',\r\n  styleUrls: ['./baselayers-switcher.component.scss'],\r\n  animations: [baseLayersSwitcherSlideInOut()]\r\n})\r\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get useStaticIcon(): boolean {\r\n    return this._useStaticIcon;\r\n  }\r\n  set useStaticIcon(value: boolean) {\r\n    this._useStaticIcon = value;\r\n  }\r\n  private _useStaticIcon: boolean;\r\n\r\n  public _baseLayers: Layer[] = [];\r\n  public expand = false;\r\n  public showButton = true;\r\n\r\n  private layers$$: Subscription;\r\n\r\n  constructor(private mediaService: MediaService) {\r\n    const media = this.mediaService.media$.value;\r\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\r\n      this.useStaticIcon = true;\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\r\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  collapseOrExpand() {\r\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\r\n      this.expand = !this.expand;\r\n    } else {\r\n      this.expand = false;\r\n    }\r\n  }\r\n\r\n  get baseLayers(): Layer[] {\r\n    const mapResolution = this.map.viewController.getResolution();\r\n    const mapZoom = this.map.viewController.getZoom();\r\n\r\n    const bl = this._baseLayers.filter(l => {\r\n      return (\r\n        (!l.options.maxResolution ||\r\n          mapResolution <= l.options.maxResolution) &&\r\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\r\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\r\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\r\n      );\r\n    });\r\n\r\n    const blHidden = bl.filter(l => !l.visible);\r\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  AfterViewInit,\r\n  OnDestroy,\r\n  ApplicationRef\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { IgoMap } from '../shared';\r\n\r\n@Component({\r\n  selector: 'igo-mini-basemap',\r\n  templateUrl: './mini-basemap.component.html',\r\n  styleUrls: ['./mini-basemap.component.scss']\r\n})\r\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n    this.handleMoveEnd();\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get baseLayer(): Layer {\r\n    return this._baseLayer;\r\n  }\r\n  set baseLayer(value: Layer) {\r\n    this._baseLayer = value;\r\n    this.handleBaseLayerChanged(value);\r\n  }\r\n  private _baseLayer: Layer;\r\n\r\n  @Input()\r\n  get disabled(): boolean {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    this._disabled = value;\r\n  }\r\n  private _disabled: boolean;\r\n\r\n  @Input()\r\n  get display(): boolean {\r\n    return this._display;\r\n  }\r\n  set display(value: boolean) {\r\n    this._display = value;\r\n  }\r\n  private _display: boolean;\r\n\r\n  public basemap = new IgoMap({\r\n    controls: {},\r\n    interactions: false\r\n  });\r\n\r\n  @Input() title: string;\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private appRef: ApplicationRef\r\n  ) {}\r\n\r\n  ngAfterViewInit() {\r\n    this.map.ol.on('moveend', () => this.handleMoveEnd());\r\n    this.handleMoveEnd();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.map.ol.un('moveend', () => this.handleMoveEnd());\r\n  }\r\n\r\n  changeBaseLayer(baseLayer: Layer) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n    this.map.changeBaseLayer(baseLayer);\r\n    this.appRef.tick();\r\n  }\r\n\r\n  private handleMoveEnd() {\r\n    this.basemap.ol.setView(this.map.ol.getView());\r\n  }\r\n\r\n  private handleBaseLayerChanged(baselayer: Layer) {\r\n    this.basemap.removeAllLayers();\r\n\r\n    const options: any = Object.assign(\r\n      Object.create(baselayer.options),\r\n      baselayer.options,\r\n      {\r\n        visible: true,\r\n        baseLayer: false\r\n      }\r\n    );\r\n\r\n    const layer = this.layerService.createLayer(options);\r\n    this.basemap.addLayer(layer);\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-rotation-button',\r\n  templateUrl: './rotation-button.component.html',\r\n  styleUrls: ['./rotation-button.component.scss']\r\n})\r\nexport class RotationButtonComponent {\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get showIfNoRotation(): boolean {\r\n    return this._showIfNoRotation;\r\n  }\r\n  set showIfNoRotation(value: boolean) {\r\n    this._showIfNoRotation = value;\r\n  }\r\n  private _showIfNoRotation: boolean;\r\n\r\n  @Input()\r\n  get color(): string {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color: string;\r\n\r\n  get rotated(): boolean {\r\n    return this.map.viewController.getRotation() !== 0;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  rotationStyle(radians): {} {\r\n    const rotation = 'rotate(' + radians + 'rad)';\r\n    return {\r\n      transform: rotation\r\n    };\r\n  }\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\n\r\nexport class EsriStyleGenerator {\r\n  public _converters: any;\r\n  public _renderers: any;\r\n\r\n  constructor() {\r\n    this._converters = {};\r\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\r\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\r\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\r\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\r\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\r\n    this._renderers = {};\r\n    this._renderers.uniqueValue = this._renderUniqueValue;\r\n    this._renderers.simple = this._renderSimple;\r\n    this._renderers.classBreaks = this._renderClassBreaks;\r\n  }\r\n  static _convertPointToPixel(point) {\r\n    return point / 0.75;\r\n  }\r\n  static _transformColor(color): [number, number, number, number] {\r\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\r\n    return [color[0], color[1], color[2], color[3] / 255];\r\n  }\r\n\r\n  static _getResolutionForScale(scale, units) {\r\n    const dpi = 96;\r\n    const mpu = olproj.METERS_PER_UNIT[units];\r\n    const inchesPerMeter = 39.3701;\r\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\r\n  }\r\n\r\n  /* convert an Esri Text Symbol */\r\n  static _convertEsriTS(symbol) {\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    const text = symbol.text !== undefined ? symbol.text : undefined;\r\n    return new olstyle.Style({\r\n      text: new olstyle.Text({\r\n        fill: new olstyle.Fill({\r\n          color: EsriStyleGenerator._transformColor(symbol.color)\r\n        }),\r\n        font:\r\n          symbol.font.style +\r\n          ' ' +\r\n          symbol.font.weight +\r\n          ' ' +\r\n          symbol.font.size +\r\n          ' px ' +\r\n          symbol.font.family,\r\n        textBaseline: symbol.verticalAlignment,\r\n        textAlign: symbol.horizontalAlignment,\r\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\r\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\r\n        rotation,\r\n        text\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Picture Marker Symbol */\r\n  static _convertEsriPMS(symbol) {\r\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n\r\n    return new olstyle.Style({\r\n      image: new olstyle.Icon({\r\n        src,\r\n        rotation\r\n      })\r\n    });\r\n  }\r\n  /* convert an Esri Simple Fill Symbol */\r\n  static _convertEsriSFS(symbol) {\r\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    return new olstyle.Style({\r\n      fill,\r\n      stroke\r\n    });\r\n  }\r\n  static _convertOutline(outline) {\r\n    let lineDash;\r\n    const color = EsriStyleGenerator._transformColor(outline.color);\r\n    if (outline.style === 'esriSLSDash') {\r\n      lineDash = [5];\r\n    } else if (outline.style === 'esriSLSDashDot') {\r\n      lineDash = [5, 5, 1, 2];\r\n    } else if (outline.style === 'esriSLSDashDotDot') {\r\n      lineDash = [5, 5, 1, 2, 1, 2];\r\n    } else if (outline.style === 'esriSLSDot') {\r\n      lineDash = [1, 2];\r\n    } else if (outline.style === 'esriSLSNull') {\r\n      // line not visible, make color fully transparent\r\n      color[3] = 0;\r\n    }\r\n    return new olstyle.Stroke({\r\n      color,\r\n      lineDash,\r\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\r\n    });\r\n  }\r\n  /* convert an Esri Simple Line Symbol */\r\n  static _convertEsriSLS(symbol) {\r\n    return new olstyle.Style({\r\n      stroke: EsriStyleGenerator._convertOutline(symbol)\r\n    });\r\n  }\r\n  static _transformAngle(angle) {\r\n    if (angle === 0 || angle === undefined) {\r\n      return undefined;\r\n    }\r\n    const normalRad = (angle * Math.PI) / 180;\r\n    const ol3Rad = -normalRad + Math.PI / 2;\r\n    if (ol3Rad < 0) {\r\n      return 2 * Math.PI + ol3Rad;\r\n    } else {\r\n      return ol3Rad;\r\n    }\r\n  }\r\n  /* convert an Esri Simple Marker Symbol */\r\n  static _convertEsriSMS(symbol) {\r\n    const fill = new olstyle.Fill({\r\n      color: EsriStyleGenerator._transformColor(symbol.color)\r\n    });\r\n    const stroke = symbol.outline\r\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\r\n      : undefined;\r\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\r\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\r\n    if (symbol.style === 'esriSMSCircle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.Circle({\r\n          radius,\r\n          fill,\r\n          stroke\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSCross') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSDiamond') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSSquare') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSX') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 4,\r\n          radius,\r\n          radius2: 0,\r\n          angle: Math.PI / 4,\r\n          rotation\r\n        })\r\n      });\r\n    } else if (symbol.style === 'esriSMSTriangle') {\r\n      return new olstyle.Style({\r\n        image: new olstyle.RegularShape({\r\n          fill,\r\n          stroke,\r\n          points: 3,\r\n          radius,\r\n          angle: 0,\r\n          rotation\r\n        })\r\n      });\r\n    }\r\n  }\r\n\r\n  _convertLabelingInfo(labelingInfo, mapUnits) {\r\n    const styles = [];\r\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\r\n      const labelExpression = labelingInfo[i].labelExpression;\r\n      // only limited support for label expressions\r\n      const field = labelExpression.substr(\r\n        labelExpression.indexOf('[') + 1,\r\n        labelExpression.indexOf(']') - 1\r\n      );\r\n      const symbol = labelingInfo[i].symbol;\r\n      const maxScale = labelingInfo[i].maxScale;\r\n      const minScale = labelingInfo[i].minScale;\r\n      let minResolution = null;\r\n      if (maxScale !== 0) {\r\n        minResolution = EsriStyleGenerator._getResolutionForScale(\r\n          maxScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      let maxResolution = null;\r\n      if (minScale !== 0) {\r\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\r\n          minScale,\r\n          mapUnits\r\n        );\r\n      }\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      styles.push(\r\n        (() => {\r\n          return function(feature, resolution) {\r\n            let visible = true;\r\n            if (this.minResolution !== null && this.maxResolution !== null) {\r\n              visible =\r\n                resolution < this.maxResolution &&\r\n                resolution >= this.minResolution;\r\n            } else if (this.minResolution !== null) {\r\n              visible = resolution >= this.minResolution;\r\n            } else if (this.maxResolution !== null) {\r\n              visible = resolution < this.maxResolution;\r\n            }\r\n            if (visible) {\r\n              const value = feature.get(this.field);\r\n              this.style.getText().setText(value);\r\n              return [this.style];\r\n            }\r\n          };\r\n        })().bind({\r\n          minResolution,\r\n          maxResolution,\r\n          field,\r\n          style\r\n        })\r\n      );\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  _renderSimple(renderer) {\r\n    const style = this._converters[renderer.symbol.type].call(\r\n      this,\r\n      renderer.symbol\r\n    );\r\n    return (() => {\r\n      return () => {\r\n        return [style];\r\n      };\r\n    })();\r\n  }\r\n  _renderClassBreaks(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    const defaultStyle = this._converters[defaultSymbol.type].call(\r\n      this,\r\n      defaultSymbol\r\n    );\r\n    const field = renderer.field;\r\n    const classes = [];\r\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\r\n      const classBreakInfo = renderer.classBreakInfos[i];\r\n      let min;\r\n      if (\r\n        classBreakInfo.classMinValue === null ||\r\n        classBreakInfo.classMinValue === undefined\r\n      ) {\r\n        if (i === 0) {\r\n          min = renderer.minValue;\r\n        } else {\r\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\r\n        }\r\n      } else {\r\n        min = classBreakInfo.classMinValue;\r\n      }\r\n      const max = classBreakInfo.classMaxValue;\r\n      const symbol = classBreakInfo.symbol;\r\n      const style = this._converters[symbol.type].call(this, symbol);\r\n      classes.push({ min, max, style });\r\n    }\r\n    return (() => {\r\n      return (feature) => {\r\n        const value = feature.get(field);\r\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\r\n          let condition;\r\n          if (i === 0) {\r\n            condition = value >= classes[i].min && value <= classes[i].max;\r\n          } else {\r\n            condition = value > classes[i].min && value <= classes[i].max;\r\n          }\r\n          if (condition) {\r\n            return [classes[i].style];\r\n          }\r\n        }\r\n        return [defaultStyle];\r\n      };\r\n    })();\r\n  }\r\n  _renderUniqueValue(renderer) {\r\n    const defaultSymbol = renderer.defaultSymbol;\r\n    let defaultStyle = [];\r\n    if (defaultSymbol) {\r\n      defaultStyle = [\r\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\r\n      ];\r\n    }\r\n    const field = renderer.field1;\r\n    const infos = renderer.uniqueValueInfos;\r\n    const me = this;\r\n    return (() => {\r\n      const hash = {};\r\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\r\n        const info = infos[i];\r\n        const symbol = info.symbol;\r\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\r\n      }\r\n\r\n      return (feature) => {\r\n        const style = hash[feature.get(field)];\r\n        return style ? style : defaultStyle;\r\n      };\r\n    })();\r\n  }\r\n  generateStyle(layerInfo, mapUnits) {\r\n    const drawingInfo = layerInfo.drawingInfo;\r\n    let styleFunctions = [];\r\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\r\n      this,\r\n      drawingInfo.renderer\r\n    );\r\n    if (drawingInfoStyle !== undefined) {\r\n      styleFunctions.push(drawingInfoStyle);\r\n    }\r\n    if (layerInfo.labelingInfo) {\r\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\r\n        layerInfo.labelingInfo,\r\n        mapUnits\r\n      );\r\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\r\n    }\r\n    if (styleFunctions.length === 1) {\r\n      return styleFunctions[0];\r\n    } else {\r\n      return (() => {\r\n        return (feature, resolution) => {\r\n          let styles = [];\r\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\r\n            const result = styleFunctions[i].call(null, feature, resolution);\r\n            if (result) {\r\n              styles = styles.concat(result);\r\n            }\r\n          }\r\n          return styles;\r\n        };\r\n      })();\r\n    }\r\n  }\r\n}\r\n","export enum TimeFilterType {\r\n    DATE = 'date',\r\n    TIME = 'time',\r\n    DATETIME = 'datetime',\r\n    YEAR = 'year',\r\n}\r\n\r\nexport enum TimeFilterStyle {\r\n    CALENDAR = 'calendar',\r\n    SLIDER = 'slider',\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, forkJoin, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { Cacheable } from 'ngx-cacheable';\r\n\r\nimport { WMSCapabilities, WMTSCapabilities } from 'ol/format';\r\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\r\nimport olAttribution from 'ol/control/Attribution';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { getResolutionFromScale } from '../../map';\r\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType\r\n} from '../../query/shared/query.enums';\r\n\r\nimport {\r\n  WMTSDataSourceOptions,\r\n  WMSDataSourceOptions,\r\n  CartoDataSourceOptions,\r\n  ArcGISRestDataSourceOptions,\r\n  TileArcGISRestDataSourceOptions\r\n} from './datasources';\r\nimport {\r\n  LegendOptions,\r\n  ItemStyleOptions\r\n} from '../../layer/shared/layers/layer.interface';\r\nimport {\r\n  TimeFilterType,\r\n  TimeFilterStyle\r\n} from '../../filter/shared/time-filter.enum';\r\n\r\nexport enum TypeCapabilities {\r\n  wms = 'wms',\r\n  wmts = 'wmts'\r\n}\r\n\r\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CapabilitiesService {\r\n  private parsers = {\r\n    wms: new WMSCapabilities(),\r\n    wmts: new WMTSCapabilities()\r\n  };\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  getWMSOptions(\r\n    baseOptions: WMSDataSourceOptions\r\n  ): Observable<WMSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = (baseOptions.params as any).VERSION;\r\n\r\n    return this.getCapabilities('wms', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n  }\r\n\r\n  getWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSourceOptions> {\r\n    const url = baseOptions.url;\r\n    const version = baseOptions.version;\r\n\r\n    const options = this.getCapabilities('wmts', url, version).pipe(\r\n      map((capabilities: any) => {\r\n        return capabilities\r\n          ? this.parseWMTSOptions(baseOptions, capabilities)\r\n          : undefined;\r\n      })\r\n    );\r\n\r\n    return options;\r\n  }\r\n\r\n  getCartoOptions(\r\n    baseOptions: CartoDataSourceOptions\r\n  ): Observable<CartoDataSourceOptions> {\r\n    const baseUrl =\r\n      'https://' +\r\n      baseOptions.account +\r\n      '.carto.com/api/v2/viz/' +\r\n      baseOptions.mapId +\r\n      '/viz.json';\r\n\r\n    return this.http\r\n      .jsonp(baseUrl, 'callback')\r\n      .pipe(\r\n        map((cartoOptions: any) =>\r\n          this.parseCartoOptions(baseOptions, cartoOptions)\r\n        )\r\n      );\r\n  }\r\n\r\n  getArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\r\n    const legendUrl = modifiedUrl + '/legend?f=json';\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legend = this.http.get(legendUrl).pipe(\r\n      map((res: any) => res),\r\n      catchError(err => {\r\n        console.log('No legend associated with this Feature Service');\r\n        return of(err);\r\n      })\r\n    );\r\n    return forkJoin([arcgisOptions, legend]).pipe(\r\n      map((res: any) => {\r\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\r\n      })\r\n    );\r\n  }\r\n\r\n  getTileArcgisOptions(\r\n    baseOptions: TileArcGISRestDataSourceOptions\r\n  ): Observable<TileArcGISRestDataSourceOptions> {\r\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\r\n    const legendUrl = baseOptions.url + '/legend?f=json';\r\n    const arcgisOptions = this.http.get(baseUrl);\r\n    const legendInfo = this.http.get(legendUrl);\r\n\r\n    return forkJoin([arcgisOptions, legendInfo]).pipe(\r\n      map((res: any) =>\r\n        this.parseTileArcgisOptions(baseOptions, res[0], res[1])\r\n      )\r\n    );\r\n  }\r\n\r\n  @Cacheable({\r\n    maxCacheCount: 20\r\n  })\r\n  getCapabilities(\r\n    service: TypeCapabilitiesStrings,\r\n    baseUrl: string,\r\n    version?: string\r\n  ): Observable<any> {\r\n    const params = new HttpParams({\r\n      fromObject: {\r\n        request: 'GetCapabilities',\r\n        service: service.toUpperCase(),\r\n        version: version || '1.3.0',\r\n        _i: 'true'\r\n      }\r\n    });\r\n\r\n    const request = this.http.get(baseUrl, {\r\n      params,\r\n      responseType: 'text'\r\n    });\r\n\r\n    return request.pipe(\r\n      map(res => {\r\n        try {\r\n          return this.parsers[service].read(res);\r\n        } catch (e) {\r\n          return undefined;\r\n        }\r\n      }),\r\n      catchError(e => {\r\n        e.error.caught = true;\r\n        throw e;\r\n      })\r\n    );\r\n  }\r\n\r\n  private parseWMSOptions(\r\n    baseOptions: WMSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMSDataSourceOptions {\r\n    const layers = (baseOptions.params as any).LAYERS;\r\n    const layer = this.findDataSourceInCapabilities(\r\n      capabilities.Capability.Layer,\r\n      layers\r\n    );\r\n\r\n    if (!layer) {\r\n      throw {\r\n        error: {\r\n          message: 'Layer not found'\r\n        }\r\n      };\r\n    }\r\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\r\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\r\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\r\n    let queryable = layer.queryable;\r\n    const timeFilter = this.getTimeFilter(layer);\r\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\r\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\r\n\r\n    let queryFormat: QueryFormat;\r\n    const queryFormatMimeTypePriority = [\r\n      QueryFormatMimeType.GEOJSON,\r\n      QueryFormatMimeType.GEOJSON2,\r\n      QueryFormatMimeType.GML3,\r\n      QueryFormatMimeType.GML2,\r\n      QueryFormatMimeType.JSON,\r\n      QueryFormatMimeType.HTML\r\n    ];\r\n\r\n    for (const mimeType of queryFormatMimeTypePriority) {\r\n      if (\r\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\r\n          mimeType\r\n        ) !== -1\r\n      ) {\r\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\r\n          key => QueryFormatMimeType[key] === mimeType\r\n        );\r\n        queryFormat = QueryFormat[keyEnum];\r\n        break;\r\n      }\r\n    }\r\n    if (!queryFormat) {\r\n      queryable = false;\r\n    }\r\n\r\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title,\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        metadata: {\r\n          url: metadata ? metadata.OnlineResource : undefined,\r\n          extern: metadata ? true : undefined,\r\n          abstract,\r\n          keywordList\r\n        },\r\n        legendOptions\r\n      },\r\n      queryable,\r\n      queryFormat,\r\n      timeFilter: timeFilterable ? timeFilter : undefined,\r\n      timeFilterable: timeFilterable ? true : undefined\r\n    });\r\n\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseWMTSOptions(\r\n    baseOptions: WMTSDataSourceOptions,\r\n    capabilities: any\r\n  ): WMTSDataSourceOptions {\r\n\r\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\r\n    const layer = capabilities.Contents.Layer.find(el => el.Identifier === baseOptions.layer);\r\n\r\n    const options = optionsFromCapabilities(capabilities, baseOptions);\r\n\r\n    const ouputOptions = Object.assign(options, baseOptions);\r\n    const sourceOptions = ObjectUtils.removeUndefined({\r\n      _layerOptionsFromSource: {\r\n        title: layer.Title}});\r\n\r\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\r\n  }\r\n\r\n  private parseCartoOptions(\r\n    baseOptions: CartoDataSourceOptions,\r\n    cartoOptions: any\r\n  ): CartoDataSourceOptions {\r\n    const layers = [];\r\n    const params = cartoOptions.layers[1].options.layer_definition;\r\n    params.layers.forEach(element => {\r\n      layers.push({\r\n        type: element.type.toLowerCase(),\r\n        options: element.options,\r\n        legend: element.legend\r\n      });\r\n    });\r\n    const options = ObjectUtils.removeUndefined({\r\n      config: {\r\n        version: params.version,\r\n        layers\r\n      }\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseArcgisOptions(\r\n    baseOptions: ArcGISRestDataSourceOptions,\r\n    arcgisOptions: any,\r\n    legend?: any\r\n  ): ArcGISRestDataSourceOptions {\r\n    const legendInfo = legend.layers ? legend : undefined;\r\n    const styleGenerator = new EsriStyleGenerator();\r\n    const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\r\n    const style = styleGenerator.generateStyle(arcgisOptions, units);\r\n    const attributions = new olAttribution({\r\n      html: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        legendInfo,\r\n        style,\r\n        timeFilter,\r\n        timeExtent,\r\n        attributions\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private parseTileArcgisOptions(\r\n    baseOptions: TileArcGISRestDataSourceOptions,\r\n    arcgisOptions: any,\r\n    legend: any\r\n  ): TileArcGISRestDataSourceOptions {\r\n    const legendInfo = legend.layers ? legend : undefined;\r\n    const attributions = new olAttribution({\r\n      html: arcgisOptions.copyrightText\r\n    });\r\n    let timeExtent;\r\n    let timeFilter;\r\n    if (arcgisOptions.timeInfo) {\r\n      const time = arcgisOptions.timeInfo.timeExtent;\r\n      timeExtent = time[0] + ',' + time[1];\r\n      const min = new Date();\r\n      min.setTime(time[0]);\r\n      const max = new Date();\r\n      max.setTime(time[1]);\r\n      timeFilter = {\r\n        min: min.toUTCString(),\r\n        max: max.toUTCString(),\r\n        range: true,\r\n        type: TimeFilterType.DATETIME,\r\n        style: TimeFilterStyle.CALENDAR\r\n      };\r\n    }\r\n    const params = Object.assign(\r\n      {},\r\n      {\r\n        layers: 'show:' + baseOptions.layer,\r\n        time: timeExtent\r\n      }\r\n    );\r\n    const options = ObjectUtils.removeUndefined({\r\n      params,\r\n      legendInfo,\r\n      timeFilter,\r\n      attributions\r\n    });\r\n    return ObjectUtils.mergeDeep(options, baseOptions);\r\n  }\r\n\r\n  private findDataSourceInCapabilities(layerArray, name): any {\r\n    if (Array.isArray(layerArray)) {\r\n      let layer;\r\n      layerArray.find(value => {\r\n        layer = this.findDataSourceInCapabilities(value, name);\r\n        return layer !== undefined;\r\n      }, this);\r\n\r\n      return layer;\r\n    } else if (layerArray.Layer) {\r\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\r\n    } else {\r\n      if (layerArray.Name && layerArray.Name === name) {\r\n        return layerArray;\r\n      }\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  getTimeFilter(layer) {\r\n    let dimension;\r\n\r\n    if (layer.Dimension) {\r\n      const timeFilter: any = {};\r\n      dimension = layer.Dimension[0];\r\n\r\n      if (dimension.values) {\r\n        const minMaxDim = dimension.values.split('/');\r\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\r\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\r\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\r\n      }\r\n\r\n      if (dimension.default) {\r\n        timeFilter.value = dimension.default;\r\n      }\r\n      return timeFilter;\r\n    }\r\n  }\r\n\r\n  getStyle(Style): LegendOptions {\r\n    const styleOptions: ItemStyleOptions[] = Style.map(style => {\r\n      return {\r\n        name: style.Name,\r\n        title: style.Title\r\n      };\r\n    })\r\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\r\n      .filter(\r\n        (item, index, self) =>\r\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\r\n          index\r\n      );\r\n\r\n    const legendOptions: LegendOptions = {\r\n      stylesAvailable: styleOptions\r\n    } as LegendOptions;\r\n\r\n    return legendOptions;\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { WMSDataSourceOptions } from '../datasources';\r\n\r\nexport abstract class OptionsService {\r\n  abstract getWMSOptions(\r\n    _baseOptions: WMSDataSourceOptions\r\n  ): Observable<WMSDataSourceOptions>;\r\n}\r\n","import { Injectable, Optional } from '@angular/core';\r\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { CapabilitiesService } from './capabilities.service';\r\nimport { OptionsService } from './options/options.service';\r\nimport { WFSService } from './datasources/wfs.service';\r\nimport {\r\n  DataSource,\r\n  OSMDataSource,\r\n  OSMDataSourceOptions,\r\n  FeatureDataSource,\r\n  FeatureDataSourceOptions,\r\n  XYZDataSource,\r\n  XYZDataSourceOptions,\r\n  WFSDataSource,\r\n  WFSDataSourceOptions,\r\n  WMTSDataSource,\r\n  WMTSDataSourceOptions,\r\n  WMSDataSource,\r\n  WMSDataSourceOptions,\r\n  CartoDataSource,\r\n  CartoDataSourceOptions,\r\n  ArcGISRestDataSource,\r\n  ArcGISRestDataSourceOptions,\r\n  TileArcGISRestDataSource,\r\n  TileArcGISRestDataSourceOptions,\r\n  WebSocketDataSource,\r\n  AnyDataSourceOptions,\r\n  MVTDataSource,\r\n  MVTDataSourceOptions,\r\n  ClusterDataSource,\r\n  ClusterDataSourceOptions\r\n} from './datasources';\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { LanguageService, MessageService } from '@igo2/core';\r\nimport { ProjectionService } from '../../map/shared/projection.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DataSourceService {\r\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\r\n\r\n  constructor(\r\n    private capabilitiesService: CapabilitiesService,\r\n    @Optional() private optionsService: OptionsService,\r\n    private wfsDataSourceService: WFSService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private projectionService: ProjectionService\r\n  ) {}\r\n\r\n  createAsyncDataSource(context: AnyDataSourceOptions): Observable<DataSource> {\r\n    if (!context.type) {\r\n      console.error(context);\r\n      throw new Error('Datasource needs a type');\r\n    }\r\n    let dataSource;\r\n    switch (context.type.toLowerCase()) {\r\n      case 'osm':\r\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\r\n        break;\r\n      case 'vector':\r\n        dataSource = this.createFeatureDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'wfs':\r\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\r\n        break;\r\n      case 'wms':\r\n        const wmsContext = context as WMSDataSourceOptions;\r\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\r\n        dataSource = this.createWMSDataSource(wmsContext);\r\n        break;\r\n      case 'wmts':\r\n        dataSource = this.createWMTSDataSource(\r\n          context as WMTSDataSourceOptions\r\n        );\r\n        break;\r\n      case 'xyz':\r\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\r\n        break;\r\n      case 'carto':\r\n        dataSource = this.createCartoDataSource(\r\n          context as CartoDataSourceOptions\r\n        );\r\n        break;\r\n      case 'arcgisrest':\r\n        dataSource = this.createArcGISRestDataSource(\r\n          context as ArcGISRestDataSourceOptions\r\n        );\r\n        break;\r\n      case 'websocket':\r\n        dataSource = this.createWebSocketDataSource(\r\n          context as FeatureDataSourceOptions\r\n        );\r\n        break;\r\n      case 'mvt':\r\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\r\n        break;\r\n      case 'tilearcgisrest':\r\n        dataSource = this.createTileArcGISRestDataSource(\r\n          context as TileArcGISRestDataSourceOptions\r\n        );\r\n        break;\r\n      case 'cluster':\r\n        dataSource = this.createClusterDataSource(\r\n          context as ClusterDataSourceOptions\r\n        );\r\n        break;\r\n      default:\r\n        console.error(context);\r\n        throw new Error('Invalid datasource type');\r\n    }\r\n\r\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\r\n\r\n    return dataSource;\r\n  }\r\n\r\n  private createOSMDataSource(\r\n    context: OSMDataSourceOptions\r\n  ): Observable<OSMDataSource> {\r\n    return new Observable(d => d.next(new OSMDataSource(context)));\r\n  }\r\n\r\n  private createFeatureDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<FeatureDataSource> {\r\n    return new Observable(d => d.next(new FeatureDataSource(context)));\r\n  }\r\n\r\n  private createWebSocketDataSource(\r\n    context: FeatureDataSourceOptions\r\n  ): Observable<WebSocketDataSource> {\r\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\r\n  }\r\n\r\n  private createWFSDataSource(\r\n    context: WFSDataSourceOptions\r\n  ): Observable<WFSDataSource> {\r\n    return new Observable(d =>\r\n      d.next(new WFSDataSource(context, this.wfsDataSourceService))\r\n    );\r\n  }\r\n\r\n  private createWMSDataSource(context: WMSDataSourceOptions): Observable<any> {\r\n    const observables = [];\r\n    if (context.optionsFromCapabilities) {\r\n      observables.push(\r\n        this.capabilitiesService.getWMSOptions(context).pipe(\r\n          catchError(e => {\r\n            const title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            const message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailable',\r\n              { value: context.params.LAYERS }\r\n            );\r\n\r\n            this.messageService.error(message, title);\r\n            throw e;\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    if (this.optionsService && context.optionsFromApi === true) {\r\n      observables.push(\r\n        this.optionsService.getWMSOptions(context).pipe(\r\n          catchError(e => {\r\n            e.error.toDisplay = true;\r\n            e.error.title = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.unavailableTitle'\r\n            );\r\n            e.error.message = this.languageService.translate.instant(\r\n              'igo.geo.dataSource.optionsApiUnavailable'\r\n            );\r\n            return of({});\r\n          })\r\n        )\r\n      );\r\n    }\r\n\r\n    observables.push(of(context));\r\n\r\n    return forkJoin(observables).pipe(\r\n      map((options: WMSDataSourceOptions[]) => {\r\n        const optionsMerged = options.reduce((a, b) =>\r\n          ObjectUtils.mergeDeep(a, b)\r\n        );\r\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\r\n      }),\r\n      catchError(() => {\r\n        return of(undefined);\r\n      })\r\n    );\r\n  }\r\n\r\n  private createWMTSDataSource(\r\n    context: WMTSDataSourceOptions\r\n  ): Observable<WMTSDataSource> {\r\n    if (context.optionsFromCapabilities) {\r\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\r\n        map((options: WMTSDataSourceOptions) => {\r\n          return options ? new WMTSDataSource(options) : undefined;\r\n        }),\r\n        catchError(() => {\r\n          const title = this.languageService.translate.instant(\r\n            'igo.geo.dataSource.unavailableTitle'\r\n          );\r\n          const message = this.languageService.translate.instant(\r\n            'igo.geo.dataSource.unavailable',\r\n            { value: context.layer }\r\n          );\r\n\r\n          this.messageService.error(message, title);\r\n          return of(undefined);\r\n        })\r\n      );\r\n    }\r\n\r\n    return new Observable(d => d.next(new WMTSDataSource(context)));\r\n  }\r\n\r\n  private createXYZDataSource(\r\n    context: XYZDataSourceOptions\r\n  ): Observable<XYZDataSource> {\r\n    return new Observable(d => d.next(new XYZDataSource(context)));\r\n  }\r\n\r\n  private createCartoDataSource(\r\n    context: CartoDataSourceOptions\r\n  ): Observable<CartoDataSource> {\r\n    if (context.mapId) {\r\n      return this.capabilitiesService\r\n        .getCartoOptions(context)\r\n        .pipe(\r\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\r\n        );\r\n    }\r\n    return new Observable(d => d.next(new CartoDataSource(context)));\r\n  }\r\n\r\n  private createArcGISRestDataSource(\r\n    context: ArcGISRestDataSourceOptions\r\n  ): Observable<ArcGISRestDataSource> {\r\n    return this.capabilitiesService\r\n      .getArcgisOptions(context)\r\n      .pipe(\r\n        map(\r\n          (options: ArcGISRestDataSourceOptions) =>\r\n            new ArcGISRestDataSource(options)\r\n        )\r\n      );\r\n  }\r\n\r\n  private createTileArcGISRestDataSource(\r\n    context: TileArcGISRestDataSourceOptions\r\n  ): Observable<TileArcGISRestDataSource> {\r\n    return this.capabilitiesService\r\n      .getTileArcgisOptions(context)\r\n      .pipe(\r\n        map(\r\n          (options: TileArcGISRestDataSourceOptions) =>\r\n            new TileArcGISRestDataSource(options)\r\n        )\r\n      );\r\n  }\r\n\r\n  private createMVTDataSource(\r\n    context: MVTDataSourceOptions\r\n  ): Observable<MVTDataSource> {\r\n    return new Observable(d => d.next(new MVTDataSource(context)));\r\n  }\r\n\r\n  private createClusterDataSource(\r\n    context: ClusterDataSourceOptions\r\n  ): Observable<ClusterDataSource> {\r\n    return new Observable(d => d.next(new ClusterDataSource(context)));\r\n  }\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { WMSDataSourceOptions } from '../datasources';\r\nimport { OptionsService } from './options.service';\r\nimport { OptionsApiOptions } from './options-api.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class OptionsApiService extends OptionsService {\r\n  private urlApi: string;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: OptionsApiOptions = {}\r\n  ) {\r\n    super();\r\n    this.urlApi = options.url || this.urlApi;\r\n  }\r\n\r\n  getWMSOptions(\r\n    baseOptions: WMSDataSourceOptions\r\n  ): Observable<WMSDataSourceOptions> {\r\n    if (!this.urlApi) {\r\n      return of({} as WMSDataSourceOptions);\r\n    }\r\n    const params = new HttpParams({\r\n      fromObject: {\r\n        type: baseOptions.type,\r\n        url: baseOptions.url,\r\n        layers: baseOptions.params.LAYERS\r\n      }\r\n    });\r\n\r\n    const request = this.http.get(this.urlApi, {\r\n      params\r\n    });\r\n\r\n    return request.pipe(\r\n      map(\r\n        (res: {\r\n          sourceOptions: WMSDataSourceOptions;\r\n          layerOptions: { [keys: string]: string };\r\n        }) => {\r\n          if (!res || !res.sourceOptions) {\r\n            return {} as WMSDataSourceOptions;\r\n          }\r\n          res.sourceOptions._layerOptionsFromSource = res.layerOptions;\r\n          return res.sourceOptions;\r\n        }\r\n      )\r\n    );\r\n  }\r\n}\r\n","import { Injectable, Injector, Optional } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport stylefunction from 'ol-mapbox-style/stylefunction';\r\nimport { AuthInterceptor } from '@igo2/auth';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport {\r\n  OSMDataSource,\r\n  FeatureDataSource,\r\n  XYZDataSource,\r\n  WFSDataSource,\r\n  WMTSDataSource,\r\n  WMSDataSource,\r\n  CartoDataSource,\r\n  ArcGISRestDataSource,\r\n  TileArcGISRestDataSource,\r\n  WebSocketDataSource,\r\n  MVTDataSource,\r\n  ClusterDataSource\r\n} from '../../datasource';\r\n\r\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\r\n\r\nimport {\r\n  Layer,\r\n  ImageLayer,\r\n  ImageLayerOptions,\r\n  TileLayer,\r\n  TileLayerOptions,\r\n  VectorLayer,\r\n  VectorLayerOptions,\r\n  AnyLayerOptions,\r\n  VectorTileLayer,\r\n  VectorTileLayerOptions\r\n} from './layers';\r\n\r\nimport { StyleService } from './style.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LayerService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private styleService: StyleService,\r\n    private dataSourceService: DataSourceService,\r\n    @Optional() private authInterceptor: AuthInterceptor\r\n  ) {}\r\n\r\n  createLayer(layerOptions: AnyLayerOptions): Layer {\r\n    if (!layerOptions.source) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      layerOptions.source.options &&\r\n      layerOptions.source.options._layerOptionsFromSource\r\n    ) {\r\n      layerOptions = ObjectUtils.mergeDeep(\r\n        layerOptions.source.options._layerOptionsFromSource,\r\n        layerOptions || {}\r\n      );\r\n    }\r\n\r\n    let layer;\r\n    switch (layerOptions.source.constructor) {\r\n      case OSMDataSource:\r\n      case WMTSDataSource:\r\n      case XYZDataSource:\r\n      case CartoDataSource:\r\n      case TileArcGISRestDataSource:\r\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\r\n        break;\r\n      case FeatureDataSource:\r\n      case WFSDataSource:\r\n      case ArcGISRestDataSource:\r\n      case WebSocketDataSource:\r\n      case ClusterDataSource:\r\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\r\n        break;\r\n      case WMSDataSource:\r\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\r\n        break;\r\n      case MVTDataSource:\r\n        layer = this.createVectorTileLayer(\r\n          layerOptions as VectorTileLayerOptions\r\n        );\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return layer;\r\n  }\r\n\r\n  createAsyncLayer(layerOptions: AnyLayerOptions): Observable<Layer> {\r\n    if (layerOptions.source) {\r\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\r\n    }\r\n\r\n    return this.dataSourceService\r\n      .createAsyncDataSource(layerOptions.sourceOptions)\r\n      .pipe(\r\n        map(source => {\r\n          if (source === undefined) {\r\n            return undefined;\r\n          }\r\n          return this.createLayer(Object.assign(layerOptions, { source }));\r\n        })\r\n      );\r\n  }\r\n\r\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\r\n    return new ImageLayer(layerOptions, this.authInterceptor);\r\n  }\r\n\r\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\r\n    return new TileLayer(layerOptions);\r\n  }\r\n\r\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\r\n    let style;\r\n    let olLayer;\r\n    if (layerOptions.style !== undefined) {\r\n      style = this.styleService.createStyle(layerOptions.style);\r\n    }\r\n\r\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\r\n      const source = layerOptions.source as ArcGISRestDataSource;\r\n      style = source.options.params.style;\r\n    } else if (layerOptions.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = feature => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.styleByAttribute\r\n        );\r\n      };\r\n      olLayer = new VectorLayer(layerOptions);\r\n    }\r\n\r\n    if (layerOptions.source instanceof ClusterDataSource) {\r\n      const serviceStyle = this.styleService;\r\n      const baseStyle = layerOptions.clusterBaseStyle;\r\n      layerOptions.style = feature => {\r\n        return serviceStyle.createClusterStyle(\r\n          feature,\r\n          layerOptions.clusterParam,\r\n          baseStyle\r\n        );\r\n      };\r\n      olLayer = new VectorLayer(layerOptions);\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!olLayer) {\r\n      olLayer = new VectorLayer(layerOptionsOl);\r\n    }\r\n\r\n    this.applyMapboxStyle(olLayer, layerOptionsOl);\r\n\r\n    return olLayer;\r\n  }\r\n\r\n  private createVectorTileLayer(\r\n    layerOptions: VectorTileLayerOptions\r\n  ): VectorTileLayer {\r\n    let style;\r\n    let olLayer;\r\n\r\n    if (layerOptions.style !== undefined) {\r\n      style = this.styleService.createStyle(layerOptions.style);\r\n    }\r\n\r\n    if (layerOptions.styleByAttribute) {\r\n      const serviceStyle = this.styleService;\r\n      layerOptions.style = feature => {\r\n        return serviceStyle.createStyleByAttribute(\r\n          feature,\r\n          layerOptions.styleByAttribute\r\n        );\r\n      };\r\n      olLayer = new VectorTileLayer(layerOptions);\r\n    }\r\n\r\n    const layerOptionsOl = Object.assign({}, layerOptions, {\r\n      style\r\n    });\r\n\r\n    if (!olLayer) {\r\n      olLayer = new VectorTileLayer(layerOptionsOl);\r\n    }\r\n\r\n    this.applyMapboxStyle(olLayer, layerOptionsOl);\r\n    return olLayer;\r\n  }\r\n\r\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\r\n    if (layerOptions.mapboxStyle) {\r\n      this.getMapboxGlStyle(layerOptions.mapboxStyle.url).subscribe(res => {\r\n        stylefunction(layer.ol, res, layerOptions.mapboxStyle.source);\r\n      });\r\n    }\r\n  }\r\n\r\n  public getMapboxGlStyle(url: string) {\r\n    return this.http.get(url).pipe(\r\n      map((res: any) => res),\r\n      catchError(err => {\r\n        console.log('No style was found');\r\n        return of(err);\r\n      })\r\n    );\r\n  }\r\n}\r\n","export enum CatalogItemType {\r\n  Layer = 'layer',\r\n  Group = 'group'\r\n}\r\n\r\nexport enum TypeCatalog {\r\n  wms, wmts, baselayers, composite\r\n}\r\n\r\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { TooltipType } from '../../layer';\r\nimport { TimeFilterOptions } from '../../filter';\r\nimport { QueryFormat, QueryHtmlTarget  } from '../../query';\r\n\r\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\r\nimport { CatalogService } from './catalog.service';\r\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\r\n\r\nexport abstract class Catalog implements ICatalog {\r\n\r\n    // ICatalog -----------------------------\r\n    id: string;\r\n    title: string;\r\n    url: string;\r\n    items?: CatalogItem[];\r\n    type?: TypeCatalogStrings;\r\n    version?: string;\r\n    matrixSet?: string;\r\n    requestEncoding?: string;\r\n    regFilters?: string[];\r\n    groupImpose?: CatalogItemGroup;\r\n    timeFilter?: TimeFilterOptions;\r\n    queryFormat?: QueryFormat;\r\n    queryHtmlTarget?: QueryHtmlTarget;\r\n    queryParams?: { [key: string]: string; };\r\n    sourceOptions?: { [key: string]: any; };\r\n    count?: number;\r\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\r\n    sortDirection?: 'asc' | 'desc';\r\n    setCrossOriginAnonymous?: boolean;\r\n    showLegend?: boolean;\r\n    // ICatalog -----------------------------\r\n\r\n    protected catalogService: CatalogService;\r\n\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        Object.assign(this, options);\r\n        this.catalogService = service;\r\n    }\r\n\r\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\r\n}\r\n\r\nclass WMSCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.wms];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItem[]> {\r\n        return this.catalogService.loadCatalogWMSLayerItems(this);\r\n    }\r\n}\r\n\r\nclass WMTSCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItem[]> {\r\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\r\n    }\r\n}\r\n\r\nclass BaselayersCatalog extends Catalog {\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\r\n        this.type =  TypeCatalog[sType];\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\r\n        return this.catalogService.loadCatalogBaseLayerItems(this);\r\n    }\r\n}\r\n\r\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\r\n    composite: ICatalog[];\r\n\r\n    constructor(options: Catalog, service: CatalogService) {\r\n        super(options, service);\r\n        const sType: string = TypeCatalog[TypeCatalog.composite];\r\n        this.type =  TypeCatalog[sType];\r\n        this.url = null;\r\n    }\r\n\r\n    public collectCatalogItems(): Observable<CatalogItem[]> {\r\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\r\n    }\r\n}\r\n\r\nexport class CatalogFactory {\r\n\r\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\r\n\r\n        let catalog: Catalog;\r\n        if (options.hasOwnProperty('composite')) {\r\n            catalog = new CompositeCatalog(options, service);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\r\n            catalog = new BaselayersCatalog(options, service);\r\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\r\n            catalog = new WMTSCatalog(options, service);\r\n        } else {\r\n            catalog = new WMSCatalog(options, service);\r\n        }\r\n\r\n        return catalog;\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, mergeMap } from 'rxjs/operators';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport * as olextent from 'ol/extent';\r\nimport olFormatGML2 from 'ol/format/GML2';\r\nimport olFormatGML3 from 'ol/format/GML3';\r\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\r\nimport olFeature from 'ol/Feature';\r\nimport * as olgeom from 'ol/geom';\r\n\r\nimport { uuid } from '@igo2/utils';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport {\r\n  WMSDataSource,\r\n  CartoDataSource,\r\n  TileArcGISRestDataSource,\r\n  WMSDataSourceOptions\r\n} from '../../datasource';\r\n\r\nimport {\r\n  QueryFormat,\r\n  QueryFormatMimeType,\r\n  QueryHtmlTarget\r\n} from './query.enums';\r\nimport {\r\n  QueryOptions,\r\n  QueryableDataSource,\r\n  QueryableDataSourceOptions\r\n} from './query.interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class QueryService {\r\n  public queryEnabled = true;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\r\n    return layers\r\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\r\n      .map((layer: Layer) => this.queryLayer(layer, options));\r\n  }\r\n\r\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> {\r\n    const url = this.getQueryUrl(layer.dataSource, options);\r\n    if (!url) {\r\n      return of([]);\r\n    }\r\n\r\n    if (\r\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\r\n      QueryFormat.HTMLGML2\r\n    ) {\r\n      const urlGml = this.getQueryUrl(layer.dataSource, options, true);\r\n      return this.http.get(urlGml, { responseType: 'text' }).pipe(\r\n        mergeMap(gmlRes => {\r\n          const imposedGeom = this.mergeGML(gmlRes, url);\r\n          return this.http\r\n            .get(url, { responseType: 'text' })\r\n            .pipe(\r\n              map(res =>\r\n                this.extractData(res, layer, options, url, imposedGeom)\r\n              )\r\n            );\r\n        })\r\n      );\r\n    }\r\n\r\n    const request = this.http.get(url, { responseType: 'text' });\r\n    return request.pipe(map(res => this.extractData(res, layer, options, url)));\r\n  }\r\n\r\n  private mergeGML(gmlRes, url) {\r\n    let parser = new olFormatGML2();\r\n    let features = parser.readFeatures(gmlRes);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      parser = new olformat.WMSGetFeatureInfo();\r\n      features = parser.readFeatures(gmlRes);\r\n    }\r\n    const olmline = new olgeom.MultiLineString([]);\r\n    let pts;\r\n    const ptsArray = [];\r\n    let olmpoly = new olgeom.MultiPolygon([]);\r\n    let firstFeatureType;\r\n    const nbFeatures = features.length;\r\n\r\n    // Check if geometry intersect bbox\r\n    // for geoserver getfeatureinfo response in data projection, not call projection\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const bbox = bboxRaw.split(',');\r\n    const bboxExtent = olextent.createEmpty();\r\n    olextent.extend(bboxExtent, bbox);\r\n    const outBboxExtent = false;\r\n    features.map(feature => {\r\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\r\n        outBboxExtent = true;\r\n        // TODO: Check to project the geometry?\r\n      }*/\r\n      const featureGeometryCoordinates = feature.getGeometry().getCoordinates();\r\n      const featureGeometryType = feature.getGeometry().getType();\r\n\r\n      if (!firstFeatureType && !outBboxExtent) {\r\n        firstFeatureType = featureGeometryType;\r\n      }\r\n      if (!outBboxExtent) {\r\n        switch (featureGeometryType) {\r\n          case 'Point':\r\n            if (nbFeatures === 1) {\r\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\r\n            } else {\r\n              ptsArray.push(featureGeometryCoordinates);\r\n            }\r\n            break;\r\n          case 'LineString':\r\n            olmline.appendLineString(\r\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'Polygon':\r\n            olmpoly.appendPolygon(\r\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\r\n            );\r\n            break;\r\n          case 'MultiPolygon':\r\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\r\n            break;\r\n          default:\r\n            return;\r\n        }\r\n      }\r\n    });\r\n\r\n    let olmpts;\r\n    if (ptsArray.length === 0 && pts) {\r\n      olmpts = {\r\n        type: pts.getType(),\r\n        coordinates: pts.getCoordinates()\r\n      };\r\n    } else {\r\n      olmpts = {\r\n        type: 'Polygon',\r\n        coordinates: [this.convexHull(ptsArray)]\r\n      };\r\n    }\r\n\r\n    switch (firstFeatureType) {\r\n      case 'LineString':\r\n        return {\r\n          type: olmline.getType(),\r\n          coordinates: olmline.getCoordinates()\r\n        };\r\n      case 'Point':\r\n        return olmpts;\r\n      case 'Polygon':\r\n        return {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n      case 'MultiPolygon':\r\n        return {\r\n          type: olmpoly.getType(),\r\n          coordinates: olmpoly.getCoordinates()\r\n        };\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  cross(a, b, o) {\r\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\r\n  }\r\n\r\n  /**\r\n   * @param points An array of [X, Y] coordinates\r\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\r\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\r\n   */\r\n  convexHull(points) {\r\n    points.sort((a, b) => {\r\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\r\n    });\r\n\r\n    const lower = [];\r\n    for (const point of points) {\r\n      while (\r\n        lower.length >= 2 &&\r\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\r\n      ) {\r\n        lower.pop();\r\n      }\r\n      lower.push(point);\r\n    }\r\n\r\n    const upper = [];\r\n    for (let i = points.length - 1; i >= 0; i--) {\r\n      while (\r\n        upper.length >= 2 &&\r\n        this.cross(\r\n          upper[upper.length - 2],\r\n          upper[upper.length - 1],\r\n          points[i]\r\n        ) <= 0\r\n      ) {\r\n        upper.pop();\r\n      }\r\n      upper.push(points[i]);\r\n    }\r\n\r\n    upper.pop();\r\n    lower.pop();\r\n    return lower.concat(upper);\r\n  }\r\n\r\n  private extractData(\r\n    res,\r\n    layer: Layer,\r\n    options: QueryOptions,\r\n    url: string,\r\n    imposedGeometry?\r\n  ): Feature[] {\r\n    const queryDataSource = layer.dataSource as QueryableDataSource;\r\n\r\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\r\n    let features = [];\r\n    switch (queryDataSource.options.queryFormat) {\r\n      case QueryFormat.GML3:\r\n        features = this.extractGML3Data(\r\n          res,\r\n          layer.zIndex,\r\n          allowedFieldsAndAlias\r\n        );\r\n        break;\r\n      case QueryFormat.JSON:\r\n      case QueryFormat.GEOJSON:\r\n      case QueryFormat.GEOJSON2:\r\n        features = this.extractGeoJSONData(res);\r\n        break;\r\n      case QueryFormat.ESRIJSON:\r\n        features = this.extractEsriJSONData(res, layer.zIndex);\r\n        break;\r\n      case QueryFormat.TEXT:\r\n        features = this.extractTextData(res);\r\n        break;\r\n      case QueryFormat.HTML:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url\r\n        );\r\n        break;\r\n      case QueryFormat.HTMLGML2:\r\n        features = this.extractHtmlData(\r\n          res,\r\n          queryDataSource.queryHtmlTarget,\r\n          url,\r\n          imposedGeometry\r\n        );\r\n        break;\r\n      case QueryFormat.GML2:\r\n      default:\r\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\r\n        break;\r\n    }\r\n\r\n    if (features.length > 0 && features[0].geometry == null) {\r\n      const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n      for (const feature of features) {\r\n        feature.geometry = geomToAdd;\r\n      }\r\n    }\r\n\r\n    return features.map((feature: Feature, index: number) => {\r\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\r\n\r\n      let exclude;\r\n      if (layer.options.sourceOptions.type === 'wms') {\r\n        const sourceOptions = layer.options\r\n          .sourceOptions as WMSDataSourceOptions;\r\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\r\n      }\r\n\r\n      let title = this.getQueryTitle(feature, layer);\r\n      if (!title && features.length > 1) {\r\n        title = `${layer.title} (${index + 1})`;\r\n      } else if (!title) {\r\n        title = layer.title;\r\n      }\r\n\r\n      const meta = Object.assign({}, feature.meta || {}, {\r\n        id: uuid(),\r\n        title,\r\n        mapTitle: mapLabel,\r\n        sourceTitle: layer.title,\r\n        order: 1000 - layer.zIndex,\r\n        excludeAttribute: exclude\r\n      });\r\n\r\n      return Object.assign(feature, {\r\n        meta,\r\n        projection:\r\n          queryDataSource.options.type === 'carto'\r\n            ? 'EPSG:4326'\r\n            : options.projection\r\n      });\r\n    });\r\n  }\r\n\r\n  private createGeometryFromUrlClick(url) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const bboxRaw = searchParams.bbox;\r\n    const width = parseInt(searchParams.width, 10);\r\n    const height = parseInt(searchParams.height, 10);\r\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\r\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\r\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\r\n\r\n    const bbox = bboxRaw.split(',');\r\n    let threshold =\r\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\r\n\r\n    // for context in degree (EPSG:4326,4269...)\r\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\r\n      threshold = 0.045;\r\n    }\r\n    const clickx =\r\n      parseFloat(bbox[0]) +\r\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\r\n        width -\r\n      threshold;\r\n    const clicky =\r\n      parseFloat(bbox[1]) +\r\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\r\n        height -\r\n      threshold;\r\n    const clickx1 = clickx + threshold * 2;\r\n    const clicky1 = clicky + threshold * 2;\r\n\r\n    const wktPoly =\r\n      'POLYGON((' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky1 +\r\n      ', ' +\r\n      clickx1 +\r\n      ' ' +\r\n      clicky +\r\n      ', ' +\r\n      clickx +\r\n      ' ' +\r\n      clicky +\r\n      '))';\r\n\r\n    const format = new olformat.WKT();\r\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\r\n    const f = tenPercentWidthGeom.getGeometry() as any;\r\n\r\n    const newGeom = {\r\n      type: f.getType(),\r\n      coordinates: f.getCoordinates()\r\n    };\r\n\r\n    return newGeom;\r\n  }\r\n\r\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    let parser = new olFormatGML2();\r\n    let features = parser.readFeatures(res);\r\n    // Handle non standard GML output (MapServer)\r\n    if (features.length === 0) {\r\n      parser = new olformat.WMSGetFeatureInfo();\r\n      try {\r\n        features = parser.readFeatures(res);\r\n      } catch (e) {\r\n        console.warn(\r\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\r\n        );\r\n      }\r\n    }\r\n\r\n    return features.map(feature =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\r\n    const parser = new olFormatGML3();\r\n    let features = [];\r\n    try {\r\n      features = parser.readFeatures(res);\r\n    } catch (e) {\r\n      console.warn('query.service: GML3 is not well supported');\r\n    }\r\n    return features.map(feature =>\r\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\r\n    );\r\n  }\r\n\r\n  private extractGeoJSONData(res) {\r\n    let features = [];\r\n    try {\r\n      features = JSON.parse(res).features;\r\n    } catch (e) {\r\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\r\n    }\r\n    return features;\r\n  }\r\n\r\n  private extractEsriJSONData(res, zIndex) {\r\n    const parser = new olFormatEsriJSON();\r\n    const features = parser.readFeatures(res);\r\n\r\n    return features.map(feature => this.featureToResult(feature, zIndex));\r\n  }\r\n\r\n  private extractTextData(res) {\r\n    // TODO\r\n    return [];\r\n  }\r\n\r\n  private extractHtmlData(\r\n    res,\r\n    htmlTarget: QueryHtmlTarget,\r\n    url,\r\n    imposedGeometry?\r\n  ) {\r\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\r\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\r\n    const geomToAdd = this.createGeometryFromUrlClick(url);\r\n\r\n    if (\r\n      htmlTarget !== QueryHtmlTarget.BLANK &&\r\n      htmlTarget !== QueryHtmlTarget.IFRAME\r\n    ) {\r\n      htmlTarget = QueryHtmlTarget.IFRAME;\r\n    }\r\n\r\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\r\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\r\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty.\r\n    const body = res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, '');\r\n    if (body === '<body></body>' || res === '') {\r\n      return [];\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: FEATURE,\r\n        projection,\r\n        properties: { target: htmlTarget, body: res, url },\r\n        geometry: imposedGeometry || geomToAdd\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getQueryParams(url) {\r\n    const queryString = url.split('?');\r\n    if (!queryString[1]) {\r\n      return;\r\n    }\r\n    const pairs = queryString[1].split('&');\r\n\r\n    const result = {};\r\n    pairs.forEach(pair => {\r\n      pair = pair.split('=');\r\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\r\n    });\r\n    return result;\r\n  }\r\n\r\n  public featureToResult(\r\n    featureOL: olFeature,\r\n    zIndex: number,\r\n    allowedFieldsAndAlias?\r\n  ): Feature {\r\n    const featureGeometry = featureOL.getGeometry() as any;\r\n    const properties: any = Object.assign({}, featureOL.getProperties());\r\n    delete properties.geometry;\r\n    delete properties.boundedBy;\r\n    delete properties.shape;\r\n    delete properties.SHAPE;\r\n    delete properties.the_geom;\r\n\r\n    let geometry;\r\n    if (featureGeometry !== undefined) {\r\n      geometry = {\r\n        type: featureGeometry.getType(),\r\n        coordinates: featureGeometry.getCoordinates()\r\n      };\r\n    }\r\n\r\n    return {\r\n      type: FEATURE,\r\n      projection: undefined,\r\n      properties,\r\n      geometry,\r\n      meta: {\r\n        id: uuid(),\r\n        order: 1000 - zIndex,\r\n        alias: allowedFieldsAndAlias\r\n      }\r\n    };\r\n  }\r\n\r\n  private getQueryUrl(\r\n    datasource: QueryableDataSource,\r\n    options: QueryOptions,\r\n    forceGML2 = false\r\n  ): string {\r\n    let url;\r\n    switch (datasource.constructor) {\r\n      case WMSDataSource:\r\n        const wmsDatasource = datasource as WMSDataSource;\r\n\r\n        const WMSGetFeatureInfoOptions = {\r\n          INFO_FORMAT:\r\n            wmsDatasource.params.INFO_FORMAT ||\r\n            this.getMimeInfoFormat(datasource.options.queryFormat),\r\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\r\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || '5'\r\n        };\r\n\r\n        if (forceGML2) {\r\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\r\n            QueryFormat.GML2\r\n          );\r\n        }\r\n\r\n        url = wmsDatasource.ol.getGetFeatureInfoUrl(\r\n          options.coordinates,\r\n          options.resolution,\r\n          options.projection,\r\n          WMSGetFeatureInfoOptions\r\n        );\r\n        // const wmsVersion =\r\n        //   wmsDatasource.params.VERSION ||\r\n        //   wmsDatasource.params.version ||\r\n        //   '1.3.0';\r\n        // if (wmsVersion !== '1.3.0') {\r\n        //   url = url.replace('&I=', '&X=');\r\n        //   url = url.replace('&J=', '&Y=');\r\n        // }\r\n        break;\r\n      case CartoDataSource:\r\n        const cartoDatasource = datasource as CartoDataSource;\r\n        const baseUrl =\r\n          'https://' +\r\n          cartoDatasource.options.account +\r\n          '.carto.com/api/v2/sql?';\r\n        const format = 'format=GeoJSON';\r\n        const sql =\r\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\r\n        const clause =\r\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\r\n        const meters = cartoDatasource.options.queryPrecision\r\n          ? cartoDatasource.options.queryPrecision\r\n          : '1000';\r\n        const coordinates =\r\n          options.coordinates[0] +\r\n          ',' +\r\n          options.coordinates[1] +\r\n          '),3857),' +\r\n          meters +\r\n          '))';\r\n\r\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\r\n        break;\r\n      case TileArcGISRestDataSource:\r\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\r\n        let extent = olextent.boundingExtent([options.coordinates]);\r\n        if (tileArcGISRestDatasource.options.queryPrecision) {\r\n          extent = olextent.buffer(\r\n            extent,\r\n            tileArcGISRestDatasource.options.queryPrecision\r\n          );\r\n        }\r\n        const serviceUrl =\r\n          tileArcGISRestDatasource.options.url +\r\n          '/' +\r\n          tileArcGISRestDatasource.options.layer +\r\n          '/query/';\r\n        const geometry = encodeURIComponent(\r\n          '{\"xmin\":' +\r\n            extent[0] +\r\n            ',\"ymin\":' +\r\n            extent[1] +\r\n            ',\"xmax\":' +\r\n            extent[2] +\r\n            ',\"ymax\":' +\r\n            extent[3] +\r\n            ',\"spatialReference\":{\"wkid\":102100}}'\r\n        );\r\n        const params = [\r\n          'f=json',\r\n          `geometry=${geometry}`,\r\n          'geometryType=esriGeometryEnvelope',\r\n          'inSR=102100',\r\n          'spatialRel=esriSpatialRelIntersects',\r\n          'outFields=*',\r\n          'returnGeometry=true',\r\n          'outSR=102100'\r\n        ];\r\n        url = `${serviceUrl}?${params.join('&')}`;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  private getMimeInfoFormat(queryFormat: string) {\r\n    let mime = 'application/vnd.ogc.gml';\r\n    const keyEnum = Object.keys(QueryFormat).find(\r\n      key => QueryFormat[key] === queryFormat\r\n    );\r\n    if (keyEnum) {\r\n      mime = QueryFormatMimeType[keyEnum];\r\n    }\r\n\r\n    return mime;\r\n  }\r\n\r\n  getAllowedFieldsAndAlias(layer: any) {\r\n    let allowedFieldsAndAlias;\r\n    if (\r\n      layer.options &&\r\n      layer.options.source &&\r\n      layer.options.source.options &&\r\n      layer.options.source.options.sourceFields &&\r\n      layer.options.source.options.sourceFields.length >= 1\r\n    ) {\r\n      allowedFieldsAndAlias = {};\r\n      layer.options.source.options.sourceFields.forEach(sourceField => {\r\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\r\n        allowedFieldsAndAlias[sourceField.name] = alias;\r\n      });\r\n    }\r\n    return allowedFieldsAndAlias;\r\n  }\r\n\r\n  getQueryTitle(feature: Feature, layer: Layer): string {\r\n    let title;\r\n    if (layer.options && layer.options.source && layer.options.source.options) {\r\n      const dataSourceOptions = layer.options.source\r\n        .options as QueryableDataSourceOptions;\r\n      if (dataSourceOptions.queryTitle) {\r\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\r\n      }\r\n    }\r\n\r\n    return title;\r\n  }\r\n\r\n  getLabelMatch(feature: Feature, labelMatch): string {\r\n    let label = labelMatch;\r\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\r\n\r\n    labelToGet.forEach(v => {\r\n      label = label.replace(v[0], feature.properties[v[1]]);\r\n    });\r\n\r\n    // Nothing done? check feature's attribute\r\n    if (labelToGet.length === 0 && label === labelMatch) {\r\n      label = feature.properties[labelMatch] || labelMatch;\r\n    }\r\n\r\n    return label;\r\n  }\r\n}\r\n","import { getEntityTitle } from '@igo2/common';\r\nimport {\r\n  Directive,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  AfterViewInit,\r\n  Self\r\n} from '@angular/core';\r\n\r\nimport { Subscription, Observable, of, zip } from 'rxjs';\r\n\r\nimport OlFeature from 'ol/Feature';\r\nimport OlRenderFeature from 'ol/render/Feature';\r\nimport OlLayer from 'ol/layer/Layer';\r\n\r\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\r\nimport { MapBrowserPointerEvent as OlMapBrowserPointerEvent } from 'ol/MapBrowserEvent';\r\nimport { ListenerFunction } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\r\nimport { featureFromOl } from '../../feature/shared/feature.utils';\r\nimport { QueryService } from './query.service';\r\nimport { layerIsQueryable, olLayerIsQueryable } from './query.utils';\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\n\r\n/**\r\n * This directive makes a map queryable with a click of with a drag box.\r\n * By default, all layers are queryable but this can ben controlled at\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoQuery]'\r\n})\r\nexport class QueryDirective implements AfterViewInit, OnDestroy {\r\n  /**\r\n   * Subscriptions to ongoing queries\r\n   */\r\n  private queries$$: Subscription[] = [];\r\n\r\n  /**\r\n   * Listener to the map click event\r\n   */\r\n  private mapClickListener: ListenerFunction;\r\n\r\n  /**\r\n   * OL drag box interaction\r\n   */\r\n  private olDragBoxInteraction: OlDragBoxInteraction;\r\n\r\n  /**\r\n   * Ol drag box \"end\" event key\r\n   */\r\n  private olDragBoxInteractionEndKey: string;\r\n\r\n  /**\r\n   * Whter to query features or not\r\n   */\r\n  @Input() queryFeatures: boolean = false;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesHitTolerance: number = 0;\r\n\r\n  /**\r\n   * Feature query hit tolerance\r\n   */\r\n  @Input() queryFeaturesCondition: (olLayer: OlLayer) => boolean;\r\n\r\n  /**\r\n   * Whether all query should complete before emitting an event\r\n   */\r\n  @Input() waitForAllQueries: boolean = true;\r\n\r\n  /**\r\n   * Event emitted when a query (or all queries) complete\r\n   */\r\n  @Output() query = new EventEmitter<{\r\n    features: Feature[] | Feature[][];\r\n    event: OlMapBrowserPointerEvent;\r\n  }>();\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return (this.component.map as any) as IgoMap;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private queryService: QueryService\r\n  ) {}\r\n\r\n  /**\r\n   * Start listening to click and drag box events\r\n   * @internal\r\n   */\r\n  ngAfterViewInit() {\r\n    this.listenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * Stop listening to click and drag box events and cancel ongoind requests\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.cancelOngoingQueries();\r\n    this.unlistenToMapClick();\r\n  }\r\n\r\n  /**\r\n   * On map click, issue queries\r\n   */\r\n  private listenToMapClick() {\r\n    this.mapClickListener = this.map.ol.on(\r\n      'singleclick',\r\n      (event: OlMapBrowserPointerEvent) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map clicks\r\n   */\r\n  private unlistenToMapClick() {\r\n    this.map.ol.un(this.mapClickListener.type, this.mapClickListener.listener);\r\n    this.mapClickListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Issue queries from a map event and emit events with the results\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: OlMapBrowserPointerEvent) {\r\n    this.cancelOngoingQueries();\r\n    if (!this.queryService.queryEnabled) {\r\n      return;\r\n    }\r\n\r\n    const queries$ = [];\r\n    if (this.queryFeatures) {\r\n      queries$.push(this.doQueryFeatures(event));\r\n    }\r\n\r\n    const resolution = this.map.ol.getView().getResolution();\r\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\r\n    queries$.push(\r\n      ...this.queryService.query(queryLayers, {\r\n        coordinates: event.coordinate,\r\n        projection: this.map.projection,\r\n        resolution\r\n      })\r\n    );\r\n\r\n    if (queries$.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (this.waitForAllQueries) {\r\n      this.queries$$.push(\r\n        zip(...queries$).subscribe((results: Feature[][]) => {\r\n          const features = [].concat(...results);\r\n          this.query.emit({ features, event });\r\n        })\r\n      );\r\n    } else {\r\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\r\n        return query$.subscribe((features: Feature[]) => {\r\n          this.query.emit({ features, event });\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Query features already present on the map\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private doQueryFeatures(\r\n    event: OlMapBrowserPointerEvent\r\n  ): Observable<Feature[]> {\r\n    const clickedFeatures = [];\r\n\r\n    this.map.ol.forEachFeatureAtPixel(\r\n      event.pixel,\r\n      (featureOL: OlFeature, layerOL: OlLayer) => {\r\n        if (featureOL) {\r\n          if (featureOL.get('features')) {\r\n            for (const feature of featureOL.get('features')) {\r\n              const newFeature = featureFromOl(feature, this.map.projection);\r\n              newFeature.meta = {\r\n                title: feature.values_.nom,\r\n                id: feature.id_,\r\n                icon: feature.values_._icon,\r\n                sourceTitle: layerOL.values_.title\r\n              };\r\n              clickedFeatures.push(newFeature);\r\n            }\r\n          } else if (featureOL instanceof OlRenderFeature) {\r\n            const featureFromRender: OlFeature = featureOL;\r\n            const feature = renderFeatureFromOl(\r\n              featureOL,\r\n              this.map.projection,\r\n              layerOL\r\n            );\r\n            clickedFeatures.push(feature);\r\n          } else {\r\n            const feature = featureFromOl(\r\n              featureOL,\r\n              this.map.projection,\r\n              layerOL\r\n            );\r\n            clickedFeatures.push(feature);\r\n          }\r\n        }\r\n      },\r\n      {\r\n        hitTolerance: this.queryFeaturesHitTolerance || 0,\r\n        layerFilter: this.queryFeaturesCondition\r\n          ? this.queryFeaturesCondition\r\n          : olLayerIsQueryable\r\n      }\r\n    );\r\n\r\n    const queryableLayers = this.map.layers.filter(layerIsQueryable);\r\n    clickedFeatures.forEach((feature: Feature) => {\r\n      queryableLayers.forEach((layer: AnyLayer) => {\r\n        if (typeof layer.ol.getSource().hasFeature !== 'undefined') {\r\n          if (layer.ol.getSource().hasFeature(feature.ol)) {\r\n            feature.meta.alias = this.queryService.getAllowedFieldsAndAlias(layer);\r\n            feature.meta.title = feature.meta.title || this.queryService.getQueryTitle(feature, layer);\r\n            feature.meta.sourceTitle = layer.title;\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    return of(clickedFeatures);\r\n  }\r\n\r\n  /**\r\n   * Cancel ongoing requests, if any\r\n   */\r\n  private cancelOngoingQueries() {\r\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.queries$$ = [];\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions,\r\n  SearchSourceSettings\r\n} from './source.interfaces';\r\n\r\n/**\r\n * Base search source class\r\n */\r\nexport class SearchSource {\r\n  /**\r\n   * Search source ID\r\n   * @internal\r\n   */\r\n  static id = '';\r\n\r\n  /**\r\n   * Search source type\r\n   * @internal\r\n   */\r\n  static type = '';\r\n\r\n  /**\r\n   * Search source options\r\n   * @internal\r\n   */\r\n  protected options: SearchSourceOptions;\r\n\r\n  /**\r\n   * Get search source's id\r\n   * @returns Search source's id\r\n   */\r\n  getId(): string {\r\n    throw new Error('You have to implement the method \"getId\".');\r\n  }\r\n  /**\r\n   * Get search source's type\r\n   * @returns Search source's type\r\n   */\r\n  getType(): string {\r\n    throw new Error('You have to implement the method \"getType\".');\r\n  }\r\n\r\n  /**\r\n   * Get search source's default options\r\n   * @returns Search source default options\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\r\n  }\r\n\r\n  /**\r\n   * Search source's title\r\n   */\r\n  get title(): string {\r\n    return this.options.title;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is available\r\n   */\r\n  get available(): boolean {\r\n    return this.options.available !== false;\r\n  }\r\n\r\n  /**\r\n   * Whether the search source is enabled\r\n   */\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  get enabled(): boolean {\r\n    return this.available && this.options.enabled !== false;\r\n  }\r\n\r\n  get showInPointerSummary(): boolean {\r\n    const showInPointerSummary = this.options.showInPointerSummary;\r\n    return showInPointerSummary ? showInPointerSummary : false;\r\n  }\r\n\r\n  get showInSettings(): boolean {\r\n    const showInSettings = this.options.showInSettings;\r\n    return showInSettings === undefined ? true : showInSettings;\r\n  }\r\n\r\n  /**\r\n   * Search url\r\n   */\r\n  get searchUrl(): string {\r\n    return this.options.searchUrl;\r\n  }\r\n\r\n  /**\r\n   * Search query params\r\n   */\r\n  get params(): { [key: string]: string } {\r\n    return this.options.params === undefined ? {} : this.options.params;\r\n  }\r\n\r\n  /**\r\n   * Search settings\r\n   */\r\n  get settings(): SearchSourceSettings[] {\r\n    return this.options.settings === undefined ? [] : this.options.settings;\r\n  }\r\n\r\n  /**\r\n   * Set params from selected settings\r\n   */\r\n  setParamFromSetting(setting: SearchSourceSettings) {\r\n    switch (setting.type) {\r\n      case 'radiobutton':\r\n        setting.values.forEach(conf => {\r\n          if (conf.enabled) {\r\n            this.options.params = Object.assign(this.options.params || {}, {\r\n              [setting.name]: conf.value\r\n            });\r\n          }\r\n        });\r\n        break;\r\n      case 'checkbox':\r\n        let confValue = '';\r\n        setting.values\r\n          .filter(s => s.available !== false)\r\n          .forEach(conf => {\r\n            if (conf.enabled) {\r\n              confValue += conf.value + ',';\r\n            }\r\n          });\r\n        confValue = confValue.slice(0, -1);\r\n        this.options.params = Object.assign(this.options.params || {}, {\r\n          [setting.name]: confValue\r\n        });\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search results display order\r\n   */\r\n  get displayOrder(): number {\r\n    return this.options.order === undefined ? 99 : this.options.order;\r\n  }\r\n\r\n  constructor(options: SearchSourceOptions) {\r\n    this.options = options;\r\n    this.options = Object.assign({}, this.getDefaultOptions(), options);\r\n\r\n    // Set Default Params from Settings\r\n    this.settings.forEach(setting => {\r\n      this.setParamFromSetting(setting);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get hashtags valid\r\n   * @param hashtag hashtag from query\r\n   */\r\n  getHashtagsValid(term: string, settingsName: string): string[] {\r\n    const hashtags = term.match(/(#[^\\s]+)/g);\r\n    if (!hashtags) {\r\n      return undefined;\r\n    }\r\n\r\n    const searchSourceSetting = this.getSettingsValues(settingsName);\r\n    const hashtagsValid = [];\r\n    hashtags.forEach(hashtag => {\r\n      searchSourceSetting.values.forEach(conf => {\r\n        const hashtagKey = hashtag.substring(1);\r\n        if (typeof conf.value === 'string') {\r\n          const types = conf.value\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n            .split(',');\r\n          const index = types.indexOf(\r\n            hashtagKey\r\n              .toLowerCase()\r\n              .normalize('NFD')\r\n              .replace(/[\\u0300-\\u036f]/g, '')\r\n          );\r\n          if (index !== -1) {\r\n            hashtagsValid.push(types[index]);\r\n          }\r\n        }\r\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey) !== -1) {\r\n          hashtagsValid.push(conf.value);\r\n        }\r\n      });\r\n    });\r\n\r\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\r\n  }\r\n\r\n  getSettingsValues(search: string): SearchSourceSettings {\r\n    return this.getDefaultOptions().settings.find(\r\n      (value: SearchSourceSettings) => {\r\n        return value.name === search;\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Search sources that allow searching by text implement this class\r\n */\r\nexport interface TextSearch {\r\n  /**\r\n   * Search by text\r\n   * @param term Text\r\n   * @param options Optional: TextSearchOptions\r\n   * @returns Observable or search results\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult[]>;\r\n}\r\n\r\n/**\r\n * Search sources that allow searching by coordinates implement this class\r\n */\r\nexport interface ReverseSearch {\r\n  /**\r\n   * Search by text\r\n   * @param lonLat Coordinates\r\n   * @param options Optional: ReverseSearchOptions\r\n   * @returns Observable or search results\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult[]>;\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\n\r\nimport { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\r\n/**\r\n * Map search source. For now it has no search capability. All it does\r\n * is act as a placeholder for the map query results' \"search source\".\r\n */\r\n@Injectable()\r\nexport class QuerySearchSource extends SearchSource {\r\n  static id = 'map';\r\n  static type = FEATURE;\r\n\r\n  constructor(@Inject('options') options: SearchSourceOptions) {\r\n    super(options);\r\n  }\r\n\r\n  getId(): string {\r\n    return QuerySearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return QuerySearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Carte'\r\n    };\r\n  }\r\n}\r\n","export class GoogleLinks {\r\n  static getGoogleMapsCoordLink(lon, lat) {\r\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\r\n  }\r\n\r\n  static getGoogleStreetViewLink(lon, lat) {\r\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\r\n  }\r\n\r\n  static getGoogleMapsNameLink(name) {\r\n    const encodedName = encodeURI(name);\r\n    return 'https://www.google.com/maps?q=' + encodedName;\r\n  }\r\n}\r\n","export class OsmLinks {\r\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\r\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\r\n    return  `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\r\n  }\r\n\r\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\r\n    return  `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { EMPTY, Observable, of, zip } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { uuid, ObjectUtils } from '@igo2/utils';\r\nimport { LanguageService, ConfigService } from '@igo2/core';\r\nimport {\r\n  CapabilitiesService,\r\n  TypeCapabilities,\r\n  WMSDataSourceOptions,\r\n  WMSDataSourceOptionsParams,\r\n  WMTSDataSourceOptions\r\n} from '../../datasource';\r\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\r\nimport { getResolutionFromScale } from '../../map';\r\n\r\nimport {\r\n  CatalogItem,\r\n  CatalogItemLayer,\r\n  CatalogItemGroup\r\n} from './catalog.interface';\r\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\r\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\r\nimport { QueryFormat } from '../../query';\r\nimport { generateIdFromSourceOptions } from '../../utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CatalogService {\r\n  constructor(\r\n    private http: HttpClient,\r\n    private config: ConfigService,\r\n    private languageService: LanguageService,\r\n    private capabilitiesService: CapabilitiesService\r\n  ) {}\r\n\r\n  loadCatalogs(): Observable<Catalog[]> {\r\n    const contextConfig = this.config.getConfig('context') || {};\r\n    const catalogConfig = this.config.getConfig('catalog') || {};\r\n    const apiUrl = catalogConfig.url || contextConfig.url;\r\n    const catalogsFromConfig = catalogConfig.sources || [];\r\n\r\n    const observables$ = [];\r\n\r\n    if (apiUrl) {\r\n      // Base layers catalog\r\n      if (catalogConfig.baseLayers) {\r\n        const translate = this.languageService.translate;\r\n        const title = translate.instant('igo.geo.catalog.baseLayers');\r\n        const baseLayersCatalog = [\r\n          {\r\n            id: 'catalog.baselayers',\r\n            title,\r\n            url: `${apiUrl}/baselayers`,\r\n            type: 'baselayers'\r\n          }\r\n        ];\r\n        observables$.push(of(baseLayersCatalog));\r\n      }\r\n\r\n      // Catalogs from API\r\n      const catalogsFromApi$ = this.http\r\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\r\n        .pipe(\r\n          map(catalogs =>\r\n            catalogs.map((c: any) => Object.assign(c, c.options))\r\n          ),\r\n          catchError((_response: HttpErrorResponse) => EMPTY)\r\n        );\r\n      observables$.push(catalogsFromApi$);\r\n    }\r\n\r\n    // Catalogs from config\r\n    if (catalogsFromConfig.length > 0) {\r\n      observables$.push(\r\n        of(catalogsFromConfig).pipe(\r\n          map((catalogs: Catalog[]) =>\r\n            catalogs.map(c => {\r\n              if (!c.id) {\r\n                c.id = uuid();\r\n              }\r\n              return c;\r\n            })\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    return zip(...observables$).pipe(\r\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\r\n    ) as Observable<Catalog[]>;\r\n  }\r\n\r\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    let newCatalog: Catalog;\r\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\r\n    return newCatalog.collectCatalogItems();\r\n  }\r\n\r\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\r\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\r\n      map((layersOptions: LayerOptions[]) => {\r\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\r\n          return {\r\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\r\n            title: layerOptions.title,\r\n            type: CatalogItemType.Layer,\r\n            options: layerOptions\r\n          } as CatalogItemLayer;\r\n        });\r\n        return [\r\n          {\r\n            id: 'catalog.group.baselayers',\r\n            type: CatalogItemType.Group,\r\n            title: catalog.title,\r\n            items\r\n          }\r\n        ];\r\n      })\r\n    );\r\n  }\r\n\r\n  private getCatalogBaseLayersOptions(\r\n    catalog: Catalog\r\n  ): Observable<LayerOptions[]> {\r\n    return this.http.get<LayerOptions[]>(catalog.url);\r\n  }\r\n\r\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => {\r\n        const items = [];\r\n        this.includeRecursiveItems(\r\n          catalog,\r\n          capabilities.Capability.Layer,\r\n          items\r\n        );\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    return this.getCatalogCapabilities(catalog).pipe(\r\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\r\n    );\r\n  }\r\n\r\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\r\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\r\n\r\n    const catalogsFromInstance = [] as Catalog[];\r\n    compositeCatalog.map((component: Catalog) =>\r\n      catalogsFromInstance.push(\r\n        CatalogFactory.createInstanceCatalog(component, this)\r\n      )\r\n    );\r\n\r\n    // get CatalogItems for each original Catalog-----------------------------------------------------\r\n    const request1$ = [];\r\n    catalogsFromInstance.map((component: Catalog) =>\r\n      request1$.push(component.collectCatalogItems())\r\n    );\r\n\r\n    // integrate imposed group -----------------------------------------------------\r\n    let request2$ = [];\r\n\r\n    function flatDeepLayer(arr) {\r\n      return arr.reduce(\r\n        (acc, val) =>\r\n          acc.concat(\r\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\r\n          ),\r\n        []\r\n      );\r\n    }\r\n\r\n    if (\r\n      Object.keys(compositeCatalog).find(k => compositeCatalog[k].groupImpose)\r\n    ) {\r\n      const pushImposeGroup = (item, index) => {\r\n        const c = catalogsFromInstance[index];\r\n        const outGroupImpose = Object.assign({}, c.groupImpose);\r\n        outGroupImpose.address = c.id;\r\n        outGroupImpose.type = CatalogItemType.Group;\r\n        outGroupImpose.items = [];\r\n\r\n        const flatLayer = flatDeepLayer(item);\r\n        flatLayer.map(\r\n          v => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\r\n        );\r\n        outGroupImpose.items = flatLayer;\r\n\r\n        return outGroupImpose;\r\n      };\r\n\r\n      request2$ = request1$.map((obs, idx) =>\r\n        obs.pipe(\r\n          map(items =>\r\n            compositeCatalog[idx].groupImpose\r\n              ? pushImposeGroup(items, idx)\r\n              : items\r\n          )\r\n        )\r\n      );\r\n    } else {\r\n      request2$ = request1$;\r\n    }\r\n\r\n    // concat Group -----------------------------------------------------\r\n    const request3$ = zip(...request2$).pipe(\r\n      map(\r\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\r\n      )\r\n    );\r\n\r\n    // merge Group (first level only) -----------------------------------------------------\r\n    const groupByGroupId = (data, keyFn) =>\r\n      data.reduce((acc, group) => {\r\n        const groupId = keyFn(group);\r\n        const ind = acc.find(x => x.id === groupId);\r\n\r\n        if (!ind) {\r\n          acc[acc.length] = group;\r\n        } else {\r\n          const ix = acc.indexOf(ind);\r\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\r\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\r\n          }\r\n          acc[ix].items.push(...group.items);\r\n        }\r\n        return acc;\r\n      }, []);\r\n\r\n    // merge Layer for each Level (catalog, group(recursive))\r\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\r\n      items.reduce((acc, item, idx, arr) => {\r\n        const layerTitle = keyFn(item);\r\n        const outItem = Object.assign({}, item);\r\n\r\n        if (item.type === CatalogItemType.Layer) {\r\n          // same title, same address => result: only one item is keep\r\n\r\n          // same title, address diff\r\n          const indicesMatchTitle = [];\r\n          const diffAddress = arr.filter((x, i) => {\r\n            let bInd = false;\r\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\r\n              if (i !== idx && x.address !== item.address) {\r\n                bInd = true;\r\n              }\r\n              indicesMatchTitle.push(i);\r\n            }\r\n            return bInd;\r\n          }); // $& i !== idx\r\n\r\n          if (diffAddress.length > 0) {\r\n            const nPosition = indicesMatchTitle.findIndex(x => x === idx) + 1;\r\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\r\n          }\r\n\r\n          const exist = acc.find(\r\n            x => x.title === outItem.title && x.type === CatalogItemType.Layer\r\n          );\r\n          if (!exist) {\r\n            acc[acc.length] = outItem;\r\n          }\r\n        } else if (item.type === CatalogItemType.Group) {\r\n          outItem.items = recursiveGroupByLayerAddress(\r\n            item.items,\r\n            layer => layer.title\r\n          );\r\n          acc[acc.length] = outItem;\r\n        }\r\n\r\n        return acc;\r\n      }, []);\r\n\r\n    const request4$ = request3$.pipe(\r\n      map(output => groupByGroupId(output, group => group.id)),\r\n      map(output => [].concat(...output)),\r\n      map(data => recursiveGroupByLayerAddress(data, layer => layer.title))\r\n    );\r\n\r\n    return request4$;\r\n  }\r\n\r\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\r\n    const sType: string = TypeCatalog[catalog.type as string];\r\n    return this.capabilitiesService.getCapabilities(\r\n      TypeCapabilities[sType],\r\n      catalog.url,\r\n      catalog.version\r\n    );\r\n  }\r\n\r\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\r\n    const configuredQueryFormat = this.retriveLayerInfoFormat(\r\n      layer.Name,\r\n      layersQueryFormat\r\n    );\r\n\r\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\r\n    const legendOptions =\r\n      catalog.showLegend && layer.Style\r\n        ? this.capabilitiesService.getStyle(layer.Style)\r\n        : undefined;\r\n\r\n    const params = Object.assign({}, catalog.queryParams, {\r\n      LAYERS: layer.Name,\r\n      VERSION: catalog.version\r\n    } as WMSDataSourceOptionsParams);\r\n\r\n    const baseSourceOptions = {\r\n      type: 'wms',\r\n      url: catalog.url,\r\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\r\n      queryFormat: configuredQueryFormat,\r\n      queryHtmlTarget:\r\n        configuredQueryFormat === QueryFormat.HTML ||\r\n        configuredQueryFormat === QueryFormat.HTMLGML2\r\n          ? 'iframe'\r\n          : undefined,\r\n      optionsFromCapabilities: true\r\n    };\r\n\r\n    const sourceOptions = Object.assign(\r\n      {},\r\n      baseSourceOptions,\r\n      catalog.sourceOptions,\r\n      { params }\r\n    ) as WMSDataSourceOptions;\r\n\r\n    const layerPrepare = {\r\n      id: generateIdFromSourceOptions(sourceOptions),\r\n      type: CatalogItemType.Layer,\r\n      title: layer.Title,\r\n      address: idParent,\r\n      options: {\r\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\r\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\r\n        metadata: {\r\n          url: metadata ? metadata.OnlineResource : undefined,\r\n          extern: metadata ? true : undefined\r\n        },\r\n        legendOptions,\r\n        tooltip: { type: catalog.tooltipType },\r\n        sourceOptions\r\n      }\r\n    };\r\n\r\n    return ObjectUtils.removeUndefined(layerPrepare);\r\n  }\r\n\r\n  private prepareCatalogItemGroup(\r\n    itemListIn,\r\n    regexes,\r\n    idGroup,\r\n    layersQueryFormat,\r\n    catalog\r\n  ) {\r\n    const groupPrepare = {\r\n      id: idGroup,\r\n      type: CatalogItemType.Group,\r\n      title: itemListIn.Title,\r\n      address: catalog.id,\r\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\r\n        if (layer.Layer !== undefined) {\r\n          // recursive, check next level\r\n          const idGroupItemNextLevel =\r\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\r\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\r\n            layer,\r\n            regexes,\r\n            idGroupItemNextLevel,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n\r\n          items.push(groupItem);\r\n        } else {\r\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\r\n            return items;\r\n          }\r\n\r\n          const layerItem: CatalogItemLayer<\r\n            ImageLayerOptions\r\n          > = this.prepareCatalogItemLayer(\r\n            layer,\r\n            idGroup,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n\r\n          items.push(layerItem);\r\n        }\r\n        return items;\r\n      }, [])\r\n    };\r\n    return groupPrepare;\r\n  }\r\n\r\n  private includeRecursiveItems(\r\n    catalog: Catalog,\r\n    itemListIn: any,\r\n    itemsPrepare: CatalogItem[],\r\n    loopLevel: number = 0\r\n  ) {\r\n    // Dig all levels until last level (layer object are not defined on last level)\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n    if (!itemListIn.Layer) {\r\n      return;\r\n    }\r\n\r\n    for (const item of itemListIn.Layer) {\r\n      if (item.Layer !== undefined) {\r\n        // recursive, check next level\r\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\r\n        continue;\r\n      }\r\n\r\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\r\n\r\n      // group(with layers) and layer(without group) level 1\r\n      if (loopLevel !== 0) {\r\n        // TODO: Slice that into multiple methods\r\n        // Define object of group layer\r\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\r\n        const groupItem = this.prepareCatalogItemGroup(\r\n          itemListIn,\r\n          regexes,\r\n          idGroupItem,\r\n          layersQueryFormat,\r\n          catalog\r\n        );\r\n\r\n        if (groupItem.items.length !== 0) {\r\n          itemsPrepare.push(groupItem);\r\n        }\r\n\r\n        // Break the group (don't add a group of layer for each of their layer!)\r\n        break;\r\n      } else {\r\n        // layer without group\r\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\r\n          const layerItem = this.prepareCatalogItemLayer(\r\n            item,\r\n            catalog.id,\r\n            layersQueryFormat,\r\n            catalog\r\n          );\r\n          itemsPrepare.push(layerItem);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private getWMTSItems(\r\n    catalog: Catalog,\r\n    capabilities: { [key: string]: any }\r\n  ): CatalogItemLayer[] {\r\n    const layers = capabilities.Contents.Layer;\r\n    const regexes = (catalog.regFilters || []).map(\r\n      (pattern: string) => new RegExp(pattern)\r\n    );\r\n\r\n    return layers\r\n      .map((layer: any) => {\r\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\r\n          return undefined;\r\n        }\r\n        const params = Object.assign({}, catalog.queryParams, {\r\n          version: '1.0.0'\r\n        });\r\n        const baseSourceOptions = {\r\n          type: 'wmts',\r\n          url: catalog.url,\r\n          crossOrigin: catalog.setCrossOriginAnonymous\r\n            ? 'anonymous'\r\n            : undefined,\r\n          layer: layer.Identifier,\r\n          matrixSet: catalog.matrixSet,\r\n          optionsFromCapabilities: true,\r\n          requestEncoding: catalog.requestEncoding || 'KVP',\r\n          style: 'default'\r\n        } as WMTSDataSourceOptions;\r\n        const sourceOptions = Object.assign(\r\n          {},\r\n          baseSourceOptions,\r\n          catalog.sourceOptions,\r\n          { params }\r\n        ) as WMTSDataSourceOptions;\r\n\r\n        return ObjectUtils.removeUndefined({\r\n          id: generateIdFromSourceOptions(sourceOptions),\r\n          type: CatalogItemType.Layer,\r\n          title: layer.Title,\r\n          address: catalog.id,\r\n          options: {\r\n            sourceOptions\r\n          }\r\n        });\r\n      })\r\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\r\n  }\r\n\r\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\r\n    if (regexes.length === 0) {\r\n      return true;\r\n    }\r\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\r\n  }\r\n\r\n  private retriveLayerInfoFormat(\r\n    layerNameFromCatalog: string,\r\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\r\n  ): QueryFormat {\r\n    const currentLayerInfoFormat = layersQueryFormat.find(\r\n      f => f.layer === layerNameFromCatalog\r\n    );\r\n    const baseInfoFormat = layersQueryFormat.find(f => f.layer === '*');\r\n    let queryFormat: QueryFormat;\r\n    if (currentLayerInfoFormat) {\r\n      queryFormat = currentLayerInfoFormat.queryFormat;\r\n    } else if (baseInfoFormat) {\r\n      queryFormat = baseInfoFormat.queryFormat;\r\n    }\r\n    return queryFormat;\r\n  }\r\n\r\n  private findCatalogInfoFormat(\r\n    catalog: Catalog\r\n  ): { layer: string; queryFormat: QueryFormat }[] {\r\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\r\n    if (!catalog.queryFormat) {\r\n      return layersQueryFormat;\r\n    }\r\n    Object.keys(catalog.queryFormat).forEach(configuredInfoFormat => {\r\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\r\n        catalog.queryFormat[configuredInfoFormat].forEach(layerName => {\r\n          if (\r\n            !layersQueryFormat.find(specific => specific.layer === layerName)\r\n          ) {\r\n            layersQueryFormat.push({\r\n              layer: layerName,\r\n              queryFormat: configuredInfoFormat as QueryFormat\r\n            });\r\n          }\r\n        });\r\n      } else {\r\n        if (\r\n          !layersQueryFormat.find(\r\n            specific =>\r\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\r\n          )\r\n        ) {\r\n          layersQueryFormat.push({\r\n            layer: catalog.queryFormat[configuredInfoFormat],\r\n            queryFormat: configuredInfoFormat as QueryFormat\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return layersQueryFormat;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { zip, BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemLayer,\r\n  CatalogItemGroup,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\n\r\n/**\r\n * Component to browse a catalog's groups and layers and display them on a map.\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser',\r\n  templateUrl: './catalog-browser.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Catalog items store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<CatalogItem>;\r\n\r\n // private resolution$$: Subscription;\r\n\r\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Store holding the catalog's items\r\n   */\r\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Whether a group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsedGroup: boolean = true;\r\n\r\n  constructor(\r\n    private layerService: LayerService,\r\n    private cdRef: ChangeDetectorRef\r\n  ) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    const currentItems = this.map.layers.map((layer: Layer) => {\r\n      return {\r\n        id: layer.options.source.id,\r\n        title: layer.title,\r\n        type: CatalogItemType.Layer\r\n      };\r\n    });\r\n    this.store.state.updateMany(currentItems, { added: true }, true);\r\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.catalog.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n\r\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\r\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\r\n\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Layer added event\r\n   */\r\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\r\n    const layer = event.layer;\r\n    this.store.state.update(layer, { added: event.added }, false);\r\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\r\n  }\r\n\r\n  /**\r\n   * When a froup is added or removed, add or remove it from the map\r\n   * @internal\r\n   * @param event Group added event\r\n   */\r\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\r\n    const group = event.group;\r\n    this.store.state.update(group, { added: event.added }, false);\r\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\r\n  }\r\n\r\n  /**\r\n   * Add layer to map\r\n   * @param layer Catalog layer\r\n   */\r\n  private addLayerToMap(layer: CatalogItemLayer) {\r\n    this.addLayersToMap([layer]);\r\n  }\r\n\r\n  /**\r\n   * Remove layer from map\r\n   * @param layer Catalog layer\r\n   */\r\n  private removeLayerFromMap(layer: CatalogItemLayer) {\r\n    this.removeLayersFromMap([layer]);\r\n  }\r\n\r\n  /**\r\n   * Add multiple layers to map\r\n   * @param layers Catalog layers\r\n   */\r\n  private addLayersToMap(layers: CatalogItemLayer[]) {\r\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\r\n      if (layer.options.sourceOptions.optionsFromApi === undefined) {\r\n        layer.options.sourceOptions.optionsFromApi = true;\r\n      }\r\n      return this.layerService.createAsyncLayer(layer.options);\r\n    });\r\n\r\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\r\n      this.store.state.updateMany(layers, { added: true });\r\n      this.map.addLayers(oLayers);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove multiple layers from map\r\n   * @param layers Catalog layers\r\n   */\r\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\r\n    layers.forEach((layer: CatalogItemLayer) => {\r\n      this.store.state.update(layer, { added: false });\r\n      if (layer.options.baseLayer === true) {\r\n        const oLayer = this.map.getLayerById(layer.options.id);\r\n        if (oLayer !== undefined) {\r\n          this.map.removeLayer(oLayer);\r\n        }\r\n      } else {\r\n        const oLayer = this.map.getLayerById(layer.id);\r\n        if (oLayer !== undefined) {\r\n          this.map.removeLayer(oLayer);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sort the layers by title. asc or desc.\r\n   * @internal\r\n   */\r\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\r\n    const returnItem = items.sort((a, b) => {\r\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n\r\n      if (titleA < titleB) {\r\n        return -1;\r\n      }\r\n      if (titleA > titleB) {\r\n        return 1;\r\n      }\r\n      return 0;\r\n    });\r\n    switch (direction) {\r\n      case 'asc':\r\n        return returnItem;\r\n      case 'desc':\r\n        return returnItem.reverse();\r\n      default:\r\n        return items;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add all the layers of a group to map\r\n   * @param group Catalog group\r\n   */\r\n  private addGroupToMap(group: CatalogItemGroup) {\r\n    let layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === false;\r\n    });\r\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\r\n      layers = this.sortCatalogItemsByTitle(layers, this.catalog.sortDirection);\r\n  }\r\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\r\n  }\r\n\r\n  /**\r\n   * Remove all the layers of a group from map\r\n   * @param group Catalog group\r\n   */\r\n  private removeGroupFromMap(group: CatalogItemGroup) {\r\n    const layers = group.items.filter((item: CatalogItem) => {\r\n      const added = this.store.state.get(item).added || false;\r\n      return this.isLayer(item) && added === true;\r\n    });\r\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\r\n\r\nimport { CatalogItemLayer } from '../shared';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { first } from 'rxjs/operators';\r\nimport { Layer } from '../../layer/shared/layers';\r\n\r\n/**\r\n * Catalog browser layer item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-layer',\r\n  templateUrl: './catalog-browser-layer.component.html',\r\n  styleUrls: ['./catalog-browser-layer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserLayerComponent implements OnInit {\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Catalog layer\r\n   */\r\n  @Input() layer: CatalogItemLayer;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added = false;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<{\r\n    added: boolean;\r\n    layer: CatalogItemLayer;\r\n  }>();\r\n\r\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.layer);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.layer) || 'layers';\r\n  }\r\n\r\n  constructor(private layerService: LayerService ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.isInResolutionsRange();\r\n    this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  askForLegend(event) {\r\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\r\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\r\n    .subscribe(layer => this.igoLayer$.next(layer));\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove();\r\n          } else {\r\n            this.add();\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add();\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove();\r\n          this.isPreview$.next(false);\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add() {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addedChange.emit({ added: true, layer: this.layer });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private remove() {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.addedChange.emit({ added: false, layer: this.layer });\r\n    }\r\n  }\r\n\r\n  haveGroup(): boolean {\r\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\r\n  }\r\n\r\n  isInResolutionsRange(): boolean {\r\n    const minResolution = this.layer.options.minResolution || 0;\r\n    const maxResolution = this.layer.options.maxResolution || Infinity;\r\n    this.inRange$.next(\r\n      this.resolution >= minResolution && this.resolution <= maxResolution\r\n    );\r\n    return this.inRange$.value;\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      return this.isPreview$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.removeFromMap'\r\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { EntityStateManager, EntityStore } from '@igo2/common';\r\n\r\nimport {\r\n  Catalog,\r\n  CatalogItem,\r\n  CatalogItemGroup,\r\n  CatalogItemLayer,\r\n  CatalogItemState,\r\n  CatalogItemType\r\n} from '../shared';\r\n\r\n/**\r\n * Catalog browser group item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-browser-group',\r\n  templateUrl: './catalog-browser-group.component.html',\r\n  styleUrls: ['./catalog-browser-group.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\r\n\r\n  /**\r\n   * Group's items store\r\n   * @internal\r\n   */\r\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\r\n\r\n  /**\r\n   * Whether all the layers of the group are added\r\n   * @internal\r\n   */\r\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  /**\r\n   * Whether the toggle button is disabled\r\n   * @internal\r\n   */\r\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Catalog group\r\n   */\r\n  @Input() group: CatalogItemGroup;\r\n\r\n  /**\r\n   * Whether the group is collapsed\r\n   */\r\n  @Input() collapsed: boolean = true;\r\n\r\n  @Input() resolution: number;\r\n\r\n  @Input() catalogAllowLegend = false;\r\n\r\n  /**\r\n   * Whether the group can be toggled when it's collapsed\r\n   */\r\n  @Input() toggleCollapsed: boolean = true;\r\n\r\n  /**\r\n   * Parent catalog's items store state. Groups share a unique\r\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\r\n   * Sharing a unique state would also allow us to expand this component to allow\r\n   * the selection of a layer while unselecting any layer already selected in another group.\r\n   * This could be useful to display some layer info before adding it, for example.\r\n   */\r\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of the group is clicked\r\n   */\r\n  @Output() addedChange = new EventEmitter<{\r\n    added: boolean;\r\n    group: CatalogItemGroup;\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the add/remove button of a layer is clicked\r\n   */\r\n  @Output() layerAddedChange = new EventEmitter<{\r\n    added: boolean;\r\n    layer: CatalogItemLayer;\r\n  }>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return this.group.title;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.load(this.group.items);\r\n    this.evaluateAdded();\r\n    this.evaluateDisabled(this.collapsed);\r\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\r\n      this.store.view.sort({\r\n        direction: this.catalog.sortDirection,\r\n        valueAccessor: (item: CatalogItem) => item.title\r\n      });\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.store.destroy();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isGroup(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Group;\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  isLayer(item: CatalogItem): boolean {\r\n    return item.type === CatalogItemType.Layer;\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick() {\r\n    this.added$.value ? this.remove() : this.add();\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleCollapsed(collapsed: boolean) {\r\n    this.evaluateDisabled(collapsed);\r\n  }\r\n\r\n  /**\r\n   * When a layer is added or removed, evaluate if all the layers of the group\r\n   * are now added or removed. If so, consider that the group itself is added\r\n   * or removed.\r\n   * @internal\r\n   * @param event Layer added change event\r\n   */\r\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\r\n    this.layerAddedChange.emit(event);\r\n    this.tryToggleGroup(event);\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private add() {\r\n    this.added$.next(true);\r\n    this.addedChange.emit({\r\n      added: true,\r\n      group: this.group\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private remove() {\r\n    this.added$.next(false);\r\n    this.addedChange.emit({\r\n      added: false,\r\n      group: this.group\r\n    });\r\n  }\r\n\r\n  onLayerPreview(event) {\r\n    this.preview$.next(event);\r\n  }\r\n\r\n  /**\r\n   * If all the layers of the group added or removed, add or remove the group itself.\r\n   * @param event The last layer added change event to occur\r\n   */\r\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\r\n    const added = event.added;\r\n    const layer = event.layer;\r\n\r\n    const layersAdded = this.store.view\r\n      .all()\r\n      .filter((item: CatalogItem) => item.id !== layer.id)\r\n      .map((item: CatalogItem) => this.state.get(item).added || false);\r\n\r\n    if (layersAdded.every(value => value === added)) {\r\n      added ? this.add() : this.remove();\r\n    } else if (this.added$.value === true) {\r\n      this.added$.next(false);\r\n    }\r\n  }\r\n\r\n  private evaluateAdded() {\r\n    const added = this.store.all().every((item: CatalogItem) => {\r\n      return (this.state.get(item).added || false) === true;\r\n    });\r\n    this.added$.next(added);\r\n  }\r\n\r\n  private evaluateDisabled(collapsed: boolean) {\r\n    let disabled = false;\r\n    if (this.toggleCollapsed === false) {\r\n      disabled = collapsed;\r\n    }\r\n    this.disabled$.next(disabled);\r\n  }\r\n\r\n  onTitleClick() {\r\n    this.collapsed = !this.collapsed;\r\n  }\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\r\nimport { Subscription, combineLatest } from 'rxjs';\r\n\r\nimport { RouteService } from '@igo2/core';\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { Layer } from '../shared/layers/layer';\r\nimport { debounceTime } from 'rxjs/operators';\r\nimport { LayerLegendListComponent } from './layer-legend-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoLayerLegendListBinding]'\r\n})\r\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\r\n  private component: LayerLegendListComponent;\r\n  private layersOrResolutionChange$$: Subscription;\r\n  layersVisibility$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: LayerLegendListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n    this.layersOrResolutionChange$$ = combineLatest([\r\n      this.mapService.getMap().layers$,\r\n      this.mapService.getMap().viewController.resolution$]\r\n    ).pipe(\r\n      debounceTime(10)\r\n    ).subscribe((bunch: [Layer[], number]) => {\r\n      const shownLayers = bunch[0].filter((layer: Layer) => {\r\n        return layer.showInLayerList === true;\r\n      });\r\n      this.component.layers = shownLayers;\r\n\r\n      this.layersVisibility$$ = combineLatest(shownLayers\r\n        .map((layer: Layer) => layer.visible$))\r\n        .subscribe((r) => {\r\n          this.component.change$.next();\r\n        }\r\n        );\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layersOrResolutionChange$$.unsubscribe();\r\n    if (this.layersVisibility$$ !== undefined) {\r\n      this.layersVisibility$$.unsubscribe();\r\n      this.layersVisibility$$ = undefined;\r\n    }\r\n  }\r\n\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport {\r\n  MatInputModule,\r\n  MatFormFieldModule,\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatTooltipModule,\r\n  MatListModule,\r\n  MatSliderModule,\r\n  MatBadgeModule,\r\n  MatSelectModule,\r\n  MatSlideToggleModule,\r\n  MatDividerModule,\r\n  MatMenuModule,\r\n  MatCheckboxModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoListModule,\r\n  IgoCollapsibleModule,\r\n  IgoImageModule,\r\n  IgoPanelModule\r\n} from '@igo2/common';\r\n\r\nimport { LayerService } from './shared/layer.service';\r\nimport { StyleService } from './shared/style.service';\r\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\r\nimport { LayerItemComponent } from './layer-item/layer-item.component';\r\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\r\nimport { LayerListComponent } from './layer-list/layer-list.component';\r\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\r\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\r\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\r\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\r\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\r\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatInputModule,\r\n    MatFormFieldModule,\r\n    CommonModule,\r\n    FormsModule,\r\n    MatDividerModule,\r\n    MatMenuModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSlideToggleModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatListModule,\r\n    MatSliderModule,\r\n    MatBadgeModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoImageModule,\r\n    IgoPanelModule\r\n  ],\r\n  exports: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ],\r\n  declarations: [\r\n    LayerItemComponent,\r\n    LayerLegendItemComponent,\r\n    LayerLegendComponent,\r\n    LayerListComponent,\r\n    LayerListToolComponent,\r\n    LayerLegendListComponent,\r\n    LayerListBindingDirective,\r\n    LayerLegendListBindingDirective,\r\n    TrackFeatureButtonComponent\r\n  ]\r\n})\r\nexport class IgoLayerModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoLayerModule,\r\n      providers: [LayerService, StyleService, LayerListToolService]\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatTooltipModule,\r\n  MatBadgeModule,\r\n  MatButtonModule,\r\n  MatIconModule,\r\n  MatListModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoMatBadgeIconModule,\r\n  IgoCollapsibleModule,\r\n  IgoListModule\r\n} from '@igo2/common';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { CatalogBrowserComponent } from './catalog-browser.component';\r\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\r\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\r\nimport { IgoLayerModule } from '../../layer/layer.module';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoLanguageModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule,\r\n    IgoMetadataModule,\r\n    IgoLayerModule\r\n  ],\r\n  exports: [\r\n    CatalogBrowserComponent\r\n  ],\r\n  declarations: [\r\n    CatalogBrowserComponent,\r\n    CatalogBrowserGroupComponent,\r\n    CatalogBrowserLayerComponent\r\n  ]\r\n})\r\nexport class IgoCatalogBrowserModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport { EntityStore } from '@igo2/common';\r\nimport { IgoMap } from '../../map';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n/**\r\n * Component to browse a list of available catalogs\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library',\r\n  templateUrl: './catalog-library.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryComponent implements OnInit {\r\n\r\n  /**\r\n   * Store holding the catalogs\r\n   */\r\n  @Input() store: EntityStore<Catalog>;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Event emitted a catalog is selected or unselected\r\n   */\r\n  @Output() catalogSelectChange = new EventEmitter<{\r\n    selected: boolean;\r\n    catalog: Catalog;\r\n  }>();\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.store.state.clear();\r\n  }\r\n\r\n  /**\r\n   * When a catalog is selected, update it's state in the store\r\n   * and emit the catalog select change event\r\n   * @internal\r\n   */\r\n  onCatalogSelect(catalog: Catalog) {\r\n    this.store.state.update(catalog, {\r\n      selected: true,\r\n      focused: true\r\n    }, true);\r\n    this.catalogSelectChange.emit({selected: true, catalog});\r\n  }\r\n\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { getEntityTitle } from '@igo2/common';\r\nimport { IgoMap } from '../../map';\r\nimport { Catalog } from '../shared/catalog.abstract';\r\n\r\n/**\r\n * Catalog library item\r\n */\r\n@Component({\r\n  selector: 'igo-catalog-library-item',\r\n  templateUrl: './catalog-library-item.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogLibaryItemComponent {\r\n\r\n  /**\r\n   * Catalog\r\n   */\r\n  @Input() catalog: Catalog;\r\n\r\n  /**\r\n   * Map to add the catalog items to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string { return getEntityTitle(this.catalog); }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatTooltipModule,\r\n  MatIconModule,\r\n  MatListModule\r\n} from '@angular/material';\r\n\r\nimport { IgoListModule } from '@igo2/common';\r\n\r\nimport { CatalogLibaryComponent, } from './catalog-library.component';\r\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoListModule\r\n  ],\r\n  exports: [\r\n    CatalogLibaryComponent\r\n  ],\r\n  declarations: [\r\n    CatalogLibaryComponent,\r\n    CatalogLibaryItemComponent\r\n  ]\r\n})\r\nexport class IgoCatalogLibraryModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport {\r\n  MatIconModule,\r\n  MatListModule,\r\n  MatTooltipModule,\r\n  MatBadgeModule\r\n} from '@angular/material';\r\n\r\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\r\n\r\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\r\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoListModule,\r\n    IgoCollapsibleModule\r\n  ],\r\n  exports: [\r\n    IgoCatalogBrowserModule,\r\n    IgoCatalogLibraryModule\r\n  ],\r\n  declarations: []\r\n})\r\nexport class IgoCatalogModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  exports: [],\r\n  declarations: []\r\n})\r\nexport class IgoDataSourceModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoDataSourceModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\r\n\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\nimport { TimeFilterableDataSource } from './time-filter.interface';\r\n\r\n@Pipe({\r\n  name: 'filterableDataSource'\r\n})\r\nexport class FilterableDataSourcePipe implements PipeTransform {\r\n  transform(value: Layer[], arg: string): Layer[] {\r\n    let layers;\r\n\r\n    if (arg === 'time') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as TimeFilterableDataSource;\r\n        return (\r\n          this.isTimeFilterable(datasource) &&\r\n          datasource.options.timeFilter !== undefined &&\r\n          Object.keys(datasource.options.timeFilter).length\r\n        );\r\n      });\r\n    }\r\n    if (arg === 'ogc') {\r\n      layers = value.filter((layer: Layer) => {\r\n        const datasource = layer.dataSource as OgcFilterableDataSource;\r\n        return this.isOgcFilterable(datasource);\r\n      });\r\n    }\r\n    return layers;\r\n  }\r\n\r\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\r\n    if (dataSource.options.type !== 'wms') {\r\n      return false;\r\n    }\r\n    return dataSource.options.timeFilterable;\r\n  }\r\n\r\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\r\n    let isOgcFilterable = false;\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      dataSource.options.ogcFilters.editable\r\n    ) {\r\n      isOgcFilterable = true;\r\n    }\r\n    if (\r\n      dataSource.options.ogcFilters &&\r\n      dataSource.options.ogcFilters.enabled &&\r\n      dataSource.options.ogcFilters.pushButtons) {\r\n        isOgcFilterable = true;\r\n    }\r\n    return isOgcFilterable;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\r\n\r\n@Injectable()\r\nexport class TimeFilterService {\r\n  constructor() {}\r\n\r\n  filterByDate(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    date: Date | [Date, Date]\r\n  ) {\r\n    let time;\r\n    let newdateform;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(date)) {\r\n      const dates = [];\r\n      if (date[0]) {\r\n        newdateformStart = this.reformatDateTime(date[0]);\r\n        dates.push(date[0]);\r\n      }\r\n      if (date[1]) {\r\n        newdateformEnd = this.reformatDateTime(date[1]);\r\n        dates.push(date[1]);\r\n      }\r\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else if (date) {\r\n      newdateform = this.reformatDateTime(date);\r\n      time = newdateform;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n  }\r\n\r\n  filterByYear(\r\n    datasource: WMSDataSource | TileArcGISRestDataSource,\r\n    year: string | [string, string]\r\n  ) {\r\n    let time;\r\n    let newdateformStart;\r\n    let newdateformEnd;\r\n\r\n    if (Array.isArray(year)) {\r\n      const years = [];\r\n      if (year[0]) {\r\n        newdateformStart = year[0];\r\n        years.push(year[0]);\r\n      }\r\n      if (year[1]) {\r\n        newdateformEnd = year[1];\r\n        years.push(year[1]);\r\n      }\r\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\r\n        if (datasource instanceof TileArcGISRestDataSource) {\r\n          time = newdateformStart + ',' + newdateformEnd;\r\n        } else {\r\n          time = newdateformStart + '/' + newdateformEnd;\r\n        }\r\n      }\r\n      if (newdateformStart === newdateformEnd) {\r\n        time = newdateformStart;\r\n      }\r\n    } else {  // to reset filter.\r\n      time = year;\r\n    }\r\n\r\n    const params = { TIME: time };\r\n    datasource.ol.updateParams(params);\r\n  }\r\n\r\n  private reformatDateTime(value) {\r\n    const year = value.getFullYear();\r\n    let month = value.getMonth() + 1;\r\n    let day = value.getUTCDate();\r\n    let hour = value.getUTCHours();\r\n    let minute = value.getUTCMinutes();\r\n\r\n    if (Number(month) < 10) {\r\n      month = '0' + month;\r\n    }\r\n\r\n    if (Number(day) < 10) {\r\n      day = '0' + day;\r\n    }\r\n\r\n    if (Number(hour) < 10) {\r\n      hour = '0' + hour;\r\n    }\r\n\r\n    if (Number(minute) < 10) {\r\n      minute = '0' + minute;\r\n    }\r\n\r\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\r\n  }\r\n}\r\n","export enum OgcFilterOperatorType {\r\n    BasicNumericOperator = 'BasicNumericOperator',\r\n    Basic = 'Basic',\r\n    BasicAndSpatial = 'BasicAndSpatial',\r\n    Spatial = 'Spatial',\r\n    All = 'All',\r\n    Time = 'time'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { OgcFilterWriter } from './ogc-filter';\r\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\r\n\r\n@Injectable()\r\nexport class OGCFilterService {\r\n  constructor() {}\r\n\r\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\r\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\r\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\r\n  }\r\n\r\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\r\n    const options: any = wfsDatasource.options;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\r\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\r\n        options.ogcFilters.filters,\r\n        options.paramsWFS.fieldNameGeometry,\r\n        new olProjection({ code: options.paramsWFS.srsName }),\r\n        true\r\n      );\r\n      if (!options.ogcFilters.interfaceOgcFilters) {\r\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\r\n          options.ogcFilters.filters,\r\n          options.paramsWFS.fieldNameGeometry\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\r\n    const options: any = wmsDatasource.options;\r\n    const ogcFilterWriter = new OgcFilterWriter();\r\n\r\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\r\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\r\n        options.ogcFilters.filters,\r\n        options.fieldNameGeometry,\r\n        undefined,\r\n        true\r\n      );\r\n      if (!options.ogcFilters.interfaceOgcFilters) {\r\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\r\n          // With some wms server, this param must be set to make spatials call.\r\n          options.ogcFilters.filters,\r\n          options.fieldNameGeometry\r\n        );\r\n      }\r\n      this.filterByOgc(\r\n        wmsDatasource as WMSDataSource,\r\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters)\r\n      );\r\n      options.filtered = true;\r\n    } else {\r\n      options.ogcFilters.filters = undefined;\r\n      options.ogcFilters.interfaceOgcFilters = [];\r\n      options.filtered = false;\r\n    }\r\n  }\r\n}\r\n","export enum SpatialFilterQueryType {\r\n    AdmRegion = 'AdmRegion',\r\n    Mun = 'Mun',\r\n    Arrond = 'Arrond',\r\n    CircFed = 'CircFed',\r\n    CircProv = 'CircProv',\r\n    DirReg = 'DirReg',\r\n    MRC = 'MRC',\r\n    RegTour = 'RegTour'\r\n}\r\n\r\nexport enum SpatialFilterType {\r\n    Predefined = 'Predefined',\r\n    Polygon = 'Polygon',\r\n    Point = 'Point'\r\n}\r\n\r\nexport enum SpatialFilterItemType {\r\n    Address = 'Address',\r\n    Thematics = 'Thematics'\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\nimport { map } from 'rxjs/operators';\r\nimport { Observable } from 'rxjs';\r\nimport { Feature } from '../../feature/shared';\r\nimport {\r\n  SpatialFilterQueryType,\r\n  SpatialFilterItemType\r\n} from './spatial-filter.enum';\r\nimport { SpatialFilterThematic } from './spatial-filter.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SpatialFilterService {\r\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\r\n\r\n  /*\r\n   * Type association with URL\r\n   */\r\n  public urlFilterList = {\r\n    AdmRegion: 'regadmin',\r\n    Arrond: 'arrondissements',\r\n    CircFed: 'circ-fed',\r\n    CircProv: 'circ-prov',\r\n    DirReg: 'dir-reg',\r\n    MRC: 'mrc',\r\n    Mun: 'municipalites',\r\n    RegTour: 'tourisme',\r\n    bornes: 'bornes-sumi',\r\n    hydro: 'hydro',\r\n    routes: 'routes'\r\n  };\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    private configService: ConfigService\r\n  ) {\r\n    this.baseUrl =\r\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\r\n  }\r\n\r\n  getKeyByValue(object, value) {\r\n    return Object.keys(object).find(key => object[key] === value);\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter list component (NO GEOMETRY)\r\n   */\r\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\r\n    const urlPath = type as string;\r\n    if (urlPath) {\r\n      return this.http\r\n        .get<{ features: Feature[] }>(\r\n          this.baseUrl + this.urlFilterList[urlPath]\r\n        )\r\n        .pipe(\r\n          map(featureCollection =>\r\n            featureCollection.features.map(f => {\r\n              f.meta = {\r\n                id: f.properties.code\r\n              };\r\n              return f;\r\n            })\r\n          )\r\n        );\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Loading item list (STRING)\r\n   */\r\n  loadThematicsList() {\r\n    const url = 'types';\r\n    const items: SpatialFilterThematic[] = [];\r\n    return this.http.get(this.baseUrl + url).pipe(\r\n      map((types: string[]) => {\r\n        types.forEach(type => {\r\n          if (type.startsWith('lieux')) {\r\n            const item: SpatialFilterThematic = {\r\n              name: undefined,\r\n              source: type\r\n            };\r\n            let substr = type.substring(6, type.length);\r\n            let name = substr;\r\n            if (substr.includes('.')) {\r\n              const index = substr.indexOf('.');\r\n              name = substr.substring(index + 1, substr.length);\r\n              substr = substr.substring(0, index);\r\n            }\r\n            try {\r\n              item.name = this.languageService.translate.instant(\r\n                'igo.geo.terrapi.' + name\r\n              );\r\n            } catch (e) {\r\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\r\n            }\r\n\r\n            try {\r\n              item.group = this.languageService.translate.instant(\r\n                'igo.geo.spatialFilter.group.' + substr\r\n              );\r\n            } catch (e) {\r\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\r\n            }\r\n\r\n            items.push(item);\r\n          } else {\r\n            if (this.getKeyByValue(this.urlFilterList, type)) {\r\n              const item: SpatialFilterThematic = {\r\n                name: undefined,\r\n                source: type\r\n              };\r\n              const name = this.getKeyByValue(this.urlFilterList, type);\r\n              try {\r\n                item.name = this.languageService.translate.instant(\r\n                  'igo.geo.terrapi.' + name\r\n                );\r\n              } catch (e) {\r\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\r\n              }\r\n              item.source = type;\r\n\r\n              items.push(item);\r\n            }\r\n          }\r\n        });\r\n        return items;\r\n      })\r\n    );\r\n  }\r\n\r\n  /*\r\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\r\n   */\r\n  loadFilterItem(\r\n    feature,\r\n    itemType: SpatialFilterItemType,\r\n    type?: SpatialFilterQueryType,\r\n    thematic?: SpatialFilterThematic,\r\n    buffer?: number\r\n  ) {\r\n    if (type) {\r\n      // Predefined type\r\n      const urlType = type as string;\r\n      const url = this.baseUrl + this.urlFilterList[urlType];\r\n      let urlItem = '';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        urlItem = 'adresses';\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        urlItem = thematic.source;\r\n        return this.http\r\n          .get<{ features: Feature[] }>(\r\n            url + '/' + feature.properties.code + '/' + urlItem,\r\n            {\r\n              params: {\r\n                geometry: 'true',\r\n                icon: 'true'\r\n              }\r\n            }\r\n          )\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    } else {\r\n      // Draw type\r\n      const url = this.baseUrl + 'locate';\r\n      if (itemType === SpatialFilterItemType.Address) {\r\n        const urlItem = '?type=adresses';\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            buffer,\r\n            loc: JSON.stringify(feature)\r\n          })\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: this.languageService.translate.instant(\r\n                    'igo.geo.spatialFilter.Address'\r\n                  ),\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      } else {\r\n        // If thematics search\r\n        const urlItem = '?type=' + thematic.source;\r\n        return this.http\r\n          .post<{ features: Feature[] }>(url + urlItem, {\r\n            geometry: 'true',\r\n            icon: 'true',\r\n            buffer,\r\n            loc: JSON.stringify(feature)\r\n          })\r\n          .pipe(\r\n            map(featureCollection =>\r\n              featureCollection.features.map(f => {\r\n                f.meta = {\r\n                  id: f.properties.code,\r\n                  title: thematic.name,\r\n                  icon: (f as any).icon\r\n                };\r\n                return f;\r\n              })\r\n            )\r\n          );\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Get one territory by id (WITH GEOMETRY)\r\n   */\r\n  loadItemById(\r\n    feature: Feature,\r\n    type: SpatialFilterQueryType\r\n  ): Observable<Feature> {\r\n    const featureType = this.urlFilterList[type];\r\n    const featureCode = '/' + feature.properties.code;\r\n    if (featureType && featureCode) {\r\n      return this.http\r\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\r\n          params: {\r\n            geometry: 'true'\r\n          }\r\n        })\r\n        .pipe(\r\n          map(f => {\r\n            f.meta = {\r\n              id: f.properties.code,\r\n              alias: f.properties.nom,\r\n              title: f.properties.nom\r\n            };\r\n            return f;\r\n          })\r\n        );\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport olProjection from 'ol/proj/Projection';\r\n\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\n\r\nimport { Layer } from '../../layer/shared';\r\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\r\n\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DownloadService {\r\n\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  open(layer: Layer) {\r\n    const translate = this.languageService.translate;\r\n    const title = translate.instant('igo.geo.download.title');\r\n    this.messageService.success(\r\n      translate.instant('igo.geo.download.start'),\r\n      title\r\n    );\r\n\r\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\r\n    if (Object.keys(DSOptions.download).length > 0) {\r\n      if (\r\n        DSOptions.download.dynamicUrl &&\r\n        DSOptions.download.url === undefined\r\n      ) {\r\n        let wfsOptions;\r\n        if (\r\n          (layer.dataSource.options as any).paramsWFS &&\r\n          Object.keys((layer.dataSource.options as any).paramsWFS).length > 0\r\n        ) {\r\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\r\n        } else {\r\n          wfsOptions = (layer.dataSource.options as any).params;\r\n        }\r\n\r\n        const outputFormatDownload =\r\n          wfsOptions.outputFormatDownload === undefined\r\n            ? 'outputformat=' + wfsOptions.outputFormat\r\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\r\n\r\n        const baseurl = DSOptions.download.dynamicUrl\r\n          .replace(/&?outputformat=[^&]*/gi, '')\r\n          .replace(/&?filter=[^&]*/gi, '')\r\n          .replace(/&?bbox=[^&]*/gi, '');\r\n\r\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\r\n\r\n        let filterQueryString;\r\n        filterQueryString = new OgcFilterWriter()\r\n        .handleOgcFiltersAppliedValue(\r\n          layer.dataSource.options,\r\n          ogcFilters.geometryName,\r\n          layer.map.viewController.getExtent(),\r\n          new olProjection({ code: layer.map.projection }));\r\n        if (!filterQueryString) {\r\n          // Prevent getting all the features for empty filter\r\n            filterQueryString = new OgcFilterWriter().buildFilter(\r\n            undefined,\r\n            layer.map.viewController.getExtent(),\r\n            new olProjection({ code: layer.map.projection }),\r\n            ogcFilters.geometryName\r\n          );\r\n        } else {\r\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\r\n        }\r\n        window.open(\r\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\r\n          '_blank'\r\n        );\r\n      } else if (DSOptions.download) {\r\n        window.open(DSOptions.download.url, '_blank');\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\r\nimport { DownloadService } from '../shared/download.service';\r\n\r\n@Component({\r\n  selector: 'igo-download-button',\r\n  templateUrl: './download-button.component.html',\r\n  styleUrls: ['./download-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class DownloadButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(private downloadService: DownloadService) {}\r\n\r\n  openDownload(layer: Layer) {\r\n    this.downloadService.open(layer);\r\n  }\r\n\r\n  get options(): DownloadDataSourceOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.dataSource.options;\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatTooltipModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DownloadButtonComponent } from './download-button/download-button.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [DownloadButtonComponent],\r\n  declarations: [DownloadButtonComponent]\r\n})\r\nexport class IgoDownloadModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoDownloadModule\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\nimport { NetworkService, ConnectionState } from '@igo2/core';\r\n\r\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\r\n\r\nimport { Feature } from '../shared';\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\nimport { IgoMap } from '../../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-feature-details',\r\n  templateUrl: './feature-details.component.html',\r\n  styleUrls: ['./feature-details.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\n\r\nexport class FeatureDetailsComponent {\r\n  private state: ConnectionState;\r\n\r\n  @Input()\r\n  get source(): SearchSource {\r\n    return this._source;\r\n  }\r\n  set source(value: SearchSource ) {\r\n    this._source = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get feature(): Feature {\r\n    return this._feature;\r\n  }\r\n  set feature(value: Feature) {\r\n    this._feature = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  private _feature: Feature;\r\n  private _source: SearchSource;\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string {\r\n    return getEntityTitle(this.feature);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.feature) || 'link';\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private sanitizer: DomSanitizer,\r\n    private networkService: NetworkService\r\n  ) {\r\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\r\n      this.state = state;\r\n    });\r\n  }\r\n\r\n  htmlSanitizer(value): SafeResourceUrl {\r\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\r\n  }\r\n\r\n  isObject(value) {\r\n    return typeof value === 'object';\r\n  }\r\n\r\n  isUrl(value) {\r\n    if (typeof value === 'string') {\r\n      return (\r\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  filterFeatureProperties(feature) {\r\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\r\n    const properties = {};\r\n    let offlineButtonState;\r\n\r\n    if (this.map) {\r\n      this.map.offlineButtonToggle$.subscribe(state => {\r\n        offlineButtonState = state;\r\n      });\r\n    }\r\n\r\n    if (allowedFieldsAndAlias) {\r\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\r\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\r\n      });\r\n      return properties;\r\n    } else if (offlineButtonState !== undefined) {\r\n      if (!offlineButtonState) {\r\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\r\n          const excludeAttribute = feature.meta.excludeAttribute;\r\n          excludeAttribute.forEach(attribute => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach(attribute => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      } else {\r\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\r\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n          excludeAttributeOffline.forEach(attribute => {\r\n            delete feature.properties[attribute];\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\r\n        const excludeAttribute = feature.meta.excludeAttribute;\r\n        excludeAttribute.forEach(attribute => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\r\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\r\n        excludeAttributeOffline.forEach(attribute => {\r\n          delete feature.properties[attribute];\r\n        });\r\n      }\r\n    }\r\n\r\n    return feature.properties;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatIconModule } from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule } from '@igo2/common';\r\n\r\nimport { FeatureDetailsComponent } from './feature-details.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule\r\n  ],\r\n  exports: [FeatureDetailsComponent],\r\n  declarations: [FeatureDetailsComponent]\r\n})\r\nexport class IgoFeatureDetailsModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFormModule } from '@igo2/common';\r\n\r\nimport { FeatureFormComponent } from './feature-form.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoFormModule\r\n  ],\r\n  exports: [\r\n    IgoFormModule,\r\n    FeatureFormComponent\r\n  ],\r\n  declarations: [\r\n    FeatureFormComponent\r\n  ]\r\n})\r\nexport class IgoFeatureFormModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\r\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n    IgoFeatureDetailsModule,\r\n    IgoFeatureFormModule\r\n  ],\r\n  declarations: [],\r\n  providers: []\r\n})\r\nexport class IgoFeatureModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { FormControl } from '@angular/forms';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport OlGeometryType from 'ol/geom/GeometryType';\r\nimport { Style as OlStyle } from 'ol/style';\r\n\r\nimport { FormFieldComponent } from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map.\r\n */\r\n@FormFieldComponent('geometry')\r\n@Component({\r\n  selector: 'igo-geometry-form-field',\r\n  templateUrl: './geometry-form-field.component.html',\r\n  styleUrls: ['./geometry-form-field.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\r\n\r\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\r\n\r\n  private value$$: Subscription;\r\n\r\n  public drawControlIsActive = true;\r\n  public freehandDrawIsActive = false;\r\n\r\n  /**\r\n   * The field's form control\r\n   */\r\n  @Input() formControl: FormControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  set geometryType(value: OlGeometryType) { this.geometryType$.next(value); }\r\n  get geometryType(): OlGeometryType { return this.geometryType$.value; }\r\n  readonly geometryType$: BehaviorSubject<OlGeometryType> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Whether a geometry type toggle should be displayed\r\n   */\r\n  @Input() geometryTypeField: boolean = false;\r\n\r\n  /**\r\n   * Available geometry types\r\n   */\r\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\r\n\r\n  /**\r\n   * Whether a draw guide field should be displayed\r\n   */\r\n  @Input() drawGuideField: boolean = false;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input()\r\n  set drawGuide(value: number) { this.drawGuide$.next(value); }\r\n  get drawGuide(): number { return this.drawGuide$.value; }\r\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\r\n\r\n  /**\r\n   * Draw guide placeholder\r\n   */\r\n  @Input() drawGuidePlaceholder: string = '';\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: {[key: string]: any} = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input() drawStyle: OlStyle;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input() overlayStyle: OlStyle;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Set up a value stream\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\r\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\r\n      this.value$.next(value ? value : undefined);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n  }\r\n}\r\n","\r\nexport const MEASURE_UNIT_AUTO = 'auto';\r\n\r\nexport enum MeasureType {\r\n  Length = 'length',\r\n  Area = 'area'\r\n}\r\n\r\nexport enum MeasureLengthUnit {\r\n  Meters = 'meters',\r\n  Kilometers = 'kilometers',\r\n  Miles = 'miles',\r\n  Feet = 'feet'\r\n}\r\n\r\nexport const MeasureLengthUnitAbbreviation = {\r\n  [MeasureLengthUnit.Meters]: 'm',\r\n  [MeasureLengthUnit.Kilometers]: 'km',\r\n  [MeasureLengthUnit.Miles]: 'mi',\r\n  [MeasureLengthUnit.Feet]: 'ft'\r\n};\r\n\r\nexport enum MeasureAreaUnit {\r\n  SquareMeters = 'squareMeters',\r\n  SquareKilometers = 'squareKilometers',\r\n  SquareMiles = 'squareMiles',\r\n  SquareFeet = 'squareFeet',\r\n  Hectares = 'hectares',\r\n  Acres = 'acres'\r\n}\r\n\r\nexport const MeasureAreaUnitAbbreviation = {\r\n  [MeasureAreaUnit.SquareMeters]: 'mÂ²',\r\n  [MeasureAreaUnit.SquareKilometers]: 'kmÂ²',\r\n  [MeasureAreaUnit.SquareMiles]: 'miÂ²',\r\n  [MeasureAreaUnit.SquareFeet]: 'ftÂ²',\r\n  [MeasureAreaUnit.Hectares]: 'ha',\r\n  [MeasureAreaUnit.Acres]: 'ac'\r\n};\r\n","import { LanguageService } from '@igo2/core';\r\nimport * as olstyle from 'ol/style';\r\nimport OlGeometry from 'ol/geom/Geometry';\r\nimport OlPoint from 'ol/geom/Point';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { getCenter as olGetCenter } from 'ol/extent';\r\nimport {\r\n  getLength as olGetLength,\r\n  getArea as olGetArea\r\n} from 'ol/sphere';\r\n\r\nimport { Measure } from './measure.interfaces';\r\nimport {\r\n  MeasureAreaUnit,\r\n  MeasureAreaUnitAbbreviation,\r\n  MeasureLengthUnit,\r\n  MeasureLengthUnitAbbreviation\r\n} from './measure.enum';\r\n\r\n/**\r\n * Convert value from meters to kilometers\r\n * @param value Value in meters\r\n * @returns Value in kilometers\r\n */\r\nexport function metersToKilometers(value: number): number {\r\n  return value * 0.001;\r\n}\r\n\r\n/**\r\n * Convert value from meters to feet\r\n * @param value Value in meters\r\n * @returns Value in feet\r\n */\r\nexport function metersToFeet(value: number): number {\r\n  return value * 3.2808;\r\n}\r\n\r\n/**\r\n * Convert value from meters to miles\r\n * @param value Value in meters\r\n * @returns Value in miles\r\n */\r\nexport function metersToMiles(value: number): number {\r\n  return value * 0.000621;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square kilometers\r\n * @param value Value in square meters\r\n * @returns Value in square kilometers\r\n */\r\nexport function squareMetersToSquareKilometers(value: number): number {\r\n  return value * 0.000001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square miles\r\n * @param value Value in square meters\r\n * @returns Value in square miles\r\n */\r\nexport function squareMetersToSquareMiles(value: number): number {\r\n  return value * 0.0000003861;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to square feet\r\n * @param value Value in square meters\r\n * @returns Value in square feet\r\n */\r\nexport function squareMetersToSquareFeet(value: number): number {\r\n  return value * 10.764;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to hectares\r\n * @param value Value in square meters\r\n * @returns Value in hectares\r\n */\r\nexport function squareMetersToHectares(value: number): number {\r\n  return value * 0.0001;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to acres\r\n * @param value Value in square meters\r\n * @returns Value in acres\r\n */\r\nexport function squareMetersToAcres(value: number): number {\r\n  return value * 0.00024711;\r\n}\r\n\r\n/**\r\n * Convert value from meters to the specified length unit\r\n * @param value Value in meters\r\n * @param unit Length unit\r\n * @returns Value in unit\r\n */\r\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureLengthUnit.Meters, (val: number) => val],\r\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\r\n    [MeasureLengthUnit.Miles, metersToMiles],\r\n    [MeasureLengthUnit.Feet, metersToFeet],\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * Convert value from square meters to the specified area unit\r\n * @param value Value in meters\r\n * @param unit Area unit\r\n * @returns Value in unit\r\n */\r\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\r\n  const conversionMapper = new Map([\r\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\r\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\r\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\r\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\r\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\r\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\r\n  ]);\r\n  const conversion = conversionMapper.get(unit);\r\n\r\n  return conversion ? conversion(value) : undefined;\r\n}\r\n\r\n/**\r\n * This method format a measure to a readable format\r\n * @param measure Measure\r\n * @param options Formatting options\r\n * @returns Formatted measure\r\n */\r\nexport function formatMeasure(\r\n  measure: number,\r\n  options?: {\r\n    decimal?: number;\r\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\r\n    unitAbbr?: boolean;\r\n    locale?: string;\r\n  },\r\n  languageService?: LanguageService) {\r\n  let decimal = options.decimal;\r\n  if (decimal === undefined || decimal < 0) {\r\n    decimal = 1;\r\n  }\r\n\r\n  const parts = [];\r\n  if (options.locale !== undefined) {\r\n    parts.push(measure.toLocaleString(options.locale, {\r\n      minimumFractionDigits: decimal,\r\n      maximumFractionDigits: decimal\r\n    }));\r\n  } else {\r\n    parts.push(measure.toFixed(decimal).toString());\r\n  }\r\n\r\n  if (options.unit !== undefined && options.unitAbbr === true) {\r\n    if (languageService) {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit] ?\r\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\r\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\r\n      );\r\n    } else {\r\n      parts.push(\r\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\r\n      );\r\n    }\r\n  }\r\n\r\n  return parts.filter(p => p !== undefined).join(' ');\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\r\n  let unit = MeasureLengthUnit.Meters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\r\n  while (converted > 1000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = metersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Compute best length measure unit for a given measure in square meters\r\n * @param value Value in meters\r\n * @returns Measure unit\r\n */\r\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\r\n  let unit = MeasureAreaUnit.SquareMeters;\r\n  let converted = value;\r\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\r\n  while (converted > 1000000 && possibleUnits.length > 0) {\r\n    unit = possibleUnits.pop();\r\n    converted = squareMetersToUnit(value, unit);\r\n  }\r\n  return unit;\r\n}\r\n\r\n/**\r\n * Create a default style for a measure interaction\r\n * @returns OL style\r\n */\r\nexport function createMeasureInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      lineDash: [10, 10],\r\n      width: 2\r\n    }),\r\n    fill:  new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    }),\r\n    image: new olstyle.Circle({\r\n      radius: 5,\r\n      stroke: new olstyle.Stroke({\r\n        color: '#ffcc33',\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: 'rgba(255, 255, 255, 0.2)'\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for a measure layer\r\n * @returns OL style\r\n */\r\nexport function createMeasureLayerStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: '#ffcc33',\r\n      width: 2\r\n    }),\r\n    fill:  new olstyle.Fill({\r\n      color: 'rgba(255, 255, 255, 0.2)'\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Compute the length in meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Length in meters\r\n */\r\nexport function measureOlGeometryLength(olGeometry: OlGeometry, projection: string): number | undefined {\r\n  if (olGeometry instanceof OlPoint) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetLength(olGeometry, {projection});\r\n}\r\n\r\n/**\r\n * Compute the area in square meters of an OL geometry with a given projection\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Area in square meters\r\n */\r\nexport function measureOlGeometryArea(olGeometry: OlGeometry, projection: string): number | undefined {\r\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\r\n    return undefined;\r\n  }\r\n  if (olGeometry.getFlatCoordinates().length === 0) {\r\n    return undefined;\r\n  }\r\n  return olGetArea(olGeometry, {projection});\r\n}\r\n\r\n/**\r\n * Compute the area (square meters), length (meters) and last length (meters)\r\n * of an OL geometry with a given projection.\r\n * @param olGeometry Ol geometry\r\n * @param projection olGeometry's projection\r\n * @returns Computed measure\r\n */\r\nexport function measureOlGeometry(olGeometry: OlGeometry, projection: string): Measure {\r\n  const length = measureOlGeometryLength(olGeometry, projection);\r\n  const area = measureOlGeometryArea(olGeometry, projection);\r\n\r\n  const lengths = [];\r\n  const coordinates = olGeometry.flatCoordinates;\r\n  const coordinatesLength = coordinates.length;\r\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\r\n    const olSegment = new OlLineString([\r\n      [coordinates[i], coordinates[i + 1]],\r\n      [coordinates[i + 2], coordinates[i + 3]]\r\n    ]);\r\n\r\n    lengths.push(measureOlGeometryLength(olSegment, projection));\r\n  }\r\n\r\n  return {\r\n    area,\r\n    length,\r\n    lengths\r\n  };\r\n}\r\n\r\n/**\r\n * Update an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nexport function updateOlGeometryMidpoints(olGeometry: OlLineString | OlPolygon): OlPoint[] {\r\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n\r\n  // TODO: handle multi geometries\r\n  const coordinates = olGeometry.flatCoordinates;\r\n  const midpointsLength = olMidpoints.length;\r\n  for (let i = 0; i < midpointsLength; i++) {\r\n    const j = i * 2;\r\n    const olSegment = new OlLineString([\r\n      [coordinates[j], coordinates[j + 1]],\r\n      [coordinates[j + 2], coordinates[j + 3]]\r\n    ]);\r\n\r\n    const midpointCoordinate = olSegment.getCoordinateAt(0.5);\r\n    const olMidpoint = olMidpoints[i];\r\n    if (olMidpoint !== undefined) {\r\n      olMidpoint.setCoordinates(midpointCoordinate);\r\n    } else {\r\n      olMidpoints[i] = new OlPoint(midpointCoordinate);\r\n    }\r\n  }\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Clear an OL geometry midpoints and return an array of those points\r\n * @param olGeometry OL Geometry\r\n */\r\nexport function clearOlGeometryMidpoints(olGeometry: OlLineString | OlPolygon) {\r\n  const olMidpoints = olGeometry.get('_midpoints') || [];\r\n  const midpointsLength = olMidpoints.length;\r\n  for (let i = 0; i < midpointsLength; i++) {\r\n    const olMidpoint = olMidpoints[i];\r\n    if (olMidpoint !== undefined) {\r\n      if (olMidpoint !== undefined) {\r\n        clearOlMidpointTooltip(olMidpoint);\r\n      }\r\n    }\r\n  }\r\n\r\n  olGeometry.set('_midpoints', undefined, true);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Return an array of  OL geometry midpoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL points\r\n */\r\nfunction getOlGeometryMidpoints(olGeometry: OlLineString | OlPolygon): OlPoint[] {\r\n  const expectedNumber = Math.max((olGeometry.flatCoordinates.length / 2) - 1, 0);\r\n\r\n  // TODO: This works but it's quite messy. If time permits,\r\n  // clean this. Maybe a Tooltip class could handle that\r\n  let olMidpoints = olGeometry.get('_midpoints');\r\n  if (olMidpoints === undefined) {\r\n    olMidpoints = new Array(expectedNumber);\r\n    olGeometry.set('_midpoints', olMidpoints, true);\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber === olMidpoints.length) {\r\n    return olMidpoints;\r\n  }\r\n\r\n  if (expectedNumber > olMidpoints.length) {\r\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\r\n    return olMidpoints;\r\n  }\r\n\r\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\r\n    const olMidpoint = olMidpoints[expectedNumber];\r\n    if (olMidpoint !== undefined) {\r\n      clearOlMidpointTooltip(olMidpoint);\r\n    }\r\n  }\r\n  olMidpoints.splice(expectedNumber);\r\n\r\n  return olMidpoints;\r\n}\r\n\r\n/**\r\n * Remove an OL midpoint's tooltip from the map\r\n * @param olMidpoint OL Point\r\n */\r\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\r\n  const olTooltip = olMidpoint.get('_tooltip');\r\n  if (olTooltip !== undefined) {\r\n    const olMap = olTooltip.getMap();\r\n    if (olMap !== undefined) {\r\n      olMap.removeOverlay(olTooltip);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add an OL overlay at each midpoint and return an array of those overlays\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlLineString | OlPolygon): OlOverlay[] {\r\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\r\n    let olTooltip = olMidpoint.get('_tooltip');\r\n    if (olTooltip === undefined) {\r\n      olTooltip = createOlTooltipAtPoint(olMidpoint);\r\n    } else {\r\n      olTooltip.setPosition(olMidpoint.flatCoordinates);\r\n    }\r\n    return olTooltip;\r\n  });\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipsAtMidpoints(olGeometry: OlLineString | OlPolygon): OlOverlay[] {\r\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\r\n  return olMidpoints.map((olMidpoint: OlPoint) => {\r\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\r\n  });\r\n}\r\n\r\n/**\r\n * Update an OL geometry center and return it\r\n * @param olGeometry OL Geometry\r\n * @returns OL point\r\n */\r\nexport function updateOlGeometryCenter(olGeometry: OlLineString | OlPolygon): OlPoint {\r\n  let olCenter = olGeometry.get('_center');\r\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\r\n  if (olCenter !== undefined) {\r\n    olCenter.setCoordinates(centerCoordinate);\r\n  } else {\r\n    olCenter = new OlPoint(centerCoordinate);\r\n    olGeometry.set('_center', olCenter);\r\n  }\r\n\r\n  return olCenter;\r\n}\r\n\r\n/**\r\n * Add an OL overlay at the center of a geometry and return that overlay\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlay\r\n */\r\nexport function updateOlTooltipAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\r\n  const olCenter = updateOlGeometryCenter(olGeometry);\r\n  let olTooltip = olCenter.get('_tooltip');\r\n  if (olTooltip === undefined) {\r\n    olTooltip = createOlTooltipAtPoint(olCenter);\r\n  } else {\r\n    olTooltip.setPosition(olCenter.flatCoordinates);\r\n  }\r\n  return olTooltip;\r\n}\r\n\r\n/**\r\n * Return an array of OL overlay at midspoints, if any\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getOlTooltipAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\r\n  const olCenter = olGeometry.get('_center');\r\n  return olCenter ? olCenter.get('_tooltip') : undefined;\r\n}\r\n\r\n/**\r\n * Get all the tooltips of an OL geometry\r\n * @param olGeometry OL Geometry\r\n * @returns OL overlays\r\n */\r\nexport function getTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon): OlOverlay[] {\r\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\r\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\r\n  if (olCenterTooltip !== undefined) {\r\n    olTooltips.push(olCenterTooltip);\r\n  }\r\n  return olTooltips;\r\n}\r\n\r\n/**\r\n * Create an OL overlay at a point and bind the overlay to the point\r\n * @param olPoint OL Point\r\n * @returns OL overlay\r\n */\r\nexport function createOlTooltipAtPoint(olPoint: OlPoint): OlOverlay {\r\n  const olTooltip = new OlOverlay({\r\n    element: document.createElement('div'),\r\n    offset: [-30, -10],\r\n    className: [\r\n      'igo-map-tooltip',\r\n      'igo-map-tooltip-measure'\r\n    ].join(' '),\r\n    stopEvent: false\r\n  });\r\n  olTooltip.setPosition(olPoint.flatCoordinates);\r\n  olPoint.set('_tooltip', olTooltip);\r\n\r\n  return olTooltip;\r\n}\r\n","/* tslint:disable */\r\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\r\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n// for an explanation as to why the prototype is set manually\r\n/* tslint:enable */\r\n\r\nexport class GeometrySliceError extends Error {}\r\n\r\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\r\n  constructor() {\r\n    super('Can\\'t slice a MultiPolygon.');\r\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\r\n  }\r\n}\r\n\r\nexport class GeometrySliceLineStringError extends GeometrySliceError {\r\n  constructor() {\r\n    super('Can\\'t slice with a line that has more than 2 points.');\r\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\r\n  }\r\n}\r\n\r\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\r\n  constructor() {\r\n    super('More than 2 intersections found between the target polygon and the slicing line.');\r\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\r\n  }\r\n}\r\n","import * as olstyle from 'ol/style';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport { GeometryEvent as OlGeometryEvent } from 'ol/geom/Geometry';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport lineIntersect from '@turf/line-intersect';\r\nimport { lineString } from '@turf/helpers';\r\n\r\nimport {\r\n  GeometrySliceMultiPolygonError,\r\n  GeometrySliceLineStringError,\r\n  GeometrySliceTooManyIntersectionError\r\n } from './geometry.errors';\r\n\r\n/**\r\n * Create a default style for draw and modify interactions\r\n * @param color Style color (R, G, B)\r\n * @returns OL style\r\n */\r\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Style {\r\n  color = color || [0, 153, 255];\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color: color.concat([1]),\r\n      width: 2\r\n    }),\r\n    fill:  new olstyle.Fill({\r\n      color: color.concat([0.2])\r\n    }),\r\n    image: new olstyle.Circle({\r\n      radius: 8,\r\n      stroke: new olstyle.Stroke({\r\n        color: color.concat([1])\r\n      }),\r\n      fill: new olstyle.Fill({\r\n        color: color.concat([0.2])\r\n      })\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Create a default style for drawing a hole\r\n * @returns OL style\r\n */\r\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\r\n  return new olstyle.Style({\r\n    stroke: new olstyle.Stroke({\r\n      color:  [0, 153, 255, 1],\r\n      width: 2\r\n    })\r\n  });\r\n}\r\n\r\n/**\r\n * Slice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function sliceOlGeometry(\r\n  olGeometry: OlLineString | OlPolygon,\r\n  olSlicer: OlLineString\r\n): Array<OlLineString | OlPolygon> {\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return sliceOlPolygon(olGeometry, olSlicer);\r\n  } else if (olGeometry instanceof OlLineString) {\r\n    return sliceOlLineString(olGeometry, olSlicer);\r\n  }\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL LineString into one or more lines\r\n * @param olLineString OL line string\r\n * @param olSlicer Slicing line\r\n * @returns New OL line strings\r\n */\r\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\r\n  return [];\r\n}\r\n\r\n/**\r\n * Slice OL Polygon into one or more polygons\r\n * @param olPolygon OL polygon\r\n * @param olSlicer Slicing line\r\n * @returns New OL polygons\r\n */\r\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\r\n  if (olPolygon.getLinearRingCount() > 1) {\r\n    throw new GeometrySliceMultiPolygonError();\r\n  }\r\n\r\n  if (olSlicer.getCoordinates().length > 2) {\r\n    throw new GeometrySliceLineStringError();\r\n  }\r\n\r\n  const olGeoJSON = new OlGeoJSON();\r\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer);\r\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\r\n\r\n  const parts = [[], []];\r\n  let totalIntersectionCount = 0;\r\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\r\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\r\n    const segment = lineString(segmentCoordinates);\r\n    const intersections = lineIntersect(segment, slicer).features;\r\n\r\n    const intersectionCount = intersections.length;\r\n    totalIntersectionCount += intersectionCount;\r\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\r\n      throw new GeometrySliceTooManyIntersectionError();\r\n    }\r\n\r\n    parts[0].push(segmentCoordinates[0]);\r\n    if (intersectionCount === 1) {\r\n      const intersection = intersections[0].geometry.coordinates;\r\n      parts[0].push(intersection);\r\n      parts[1].push(intersection);\r\n      parts.reverse();\r\n    }\r\n  }\r\n\r\n  if (totalIntersectionCount <= 1) {\r\n    return [];\r\n  }\r\n\r\n  parts[0].push(parts[0][0]);\r\n  parts[1].push(parts[1][0]);\r\n\r\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\r\n}\r\n\r\n/**\r\n * Splice geometry into two parts\r\n * @param olGeometry OL geometry\r\n * @param olSlicer Slicing line\r\n * @returns New OL geometries\r\n */\r\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ): OlPolygon {\r\n  // TODO: make some validation and support updating an existing linear ring\r\n  olPolygon.appendLinearRing(olLinearRing);\r\n}\r\n\r\nexport function getMousePositionFromOlGeometryEvent(\r\n  olEvent: OlGeometryEvent\r\n): [number, number] {\r\n  const olGeometry = olEvent.target;\r\n  if (olGeometry instanceof OlPolygon) {\r\n    return olGeometry.flatCoordinates.slice(-4, -2);\r\n  }\r\n  return olGeometry.flatCoordinates.slice(-2);\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlStyle from 'ol/style';\r\nimport OlGeometryType from 'ol/geom/GeometryType';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport {\r\n  Geometry as OlGeometry,\r\n  GeometryEvent as OlGeometryEvent\r\n} from 'ol/geom/Geometry';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\r\n\r\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\r\n\r\nexport interface DrawControlOptions {\r\n  geometryType: OlGeometryType;\r\n  source?: OlVectorSource;\r\n  layer?: OlVectorLayer;\r\n  layerStyle?: OlStyle | ((olfeature: OlFeature) => OlStyle);\r\n  drawStyle?: OlStyle | ((olfeature: OlFeature) => OlStyle);\r\n  maxPoints?: number;\r\n}\r\n\r\n/**\r\n * Control to draw geometries\r\n */\r\nexport class DrawControl {\r\n\r\n  /**\r\n   * Draw start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Draw end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Geometry changes observable\r\n   */\r\n  public changes$: Subject<OlGeometry> = new Subject();\r\n\r\n  private olMap: OlMap;\r\n  private olOverlayLayer: OlVectorLayer;\r\n  private olDrawInteraction: OlDraw;\r\n  private onDrawStartKey: string;\r\n  private onDrawEndKey: string;\r\n  private onDrawKey: string;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  private keyDown$$: Subscription;\r\n\r\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * Geometry type\r\n   * @internal\r\n   */\r\n  get geometryType(): OlGeometryType {\r\n    return this.options.geometryType;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  constructor(private options: DrawControlOptions) {\r\n    if (options.layer !== undefined) {\r\n      this.olOverlayLayer = options.layer;\r\n    } else {\r\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap === undefined) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlDrawInteraction();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n    this.addOlDrawInteraction();\r\n  }\r\n\r\n  /**\r\n   * Return the overlay source\r\n   */\r\n  getSource(): OlVectorSource {\r\n    return this.olOverlaySource;\r\n  }\r\n\r\n  /**\r\n   * Create an overlay source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer {\r\n    return new OlVectorLayer({\r\n      source: this.options.source ? this.options.source : new OlVectorSource(),\r\n      style: this.options.layerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined && this.olMap !== undefined) {\r\n      this.olMap.removeLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer(): OlVectorLayer {\r\n    if (this.options.layer === undefined) {\r\n      this.olMap.addLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (this.options.layer === undefined && this.options.source === undefined) {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a draw interaction to the map an set up some listeners\r\n   */\r\n  addOlDrawInteraction() {\r\n    let olDrawInteraction;\r\n    if (this.freehand$.getValue() === false) {\r\n      olDrawInteraction = new OlDraw({\r\n        type: this.geometryType,\r\n        source: this.getSource(),\r\n        stopClick: true,\r\n        style: this.options.drawStyle,\r\n        maxPoints: this.options.maxPoints,\r\n        freehand: false,\r\n        freehandCondition: () => false\r\n      });\r\n    } else {\r\n      if (this.geometryType === 'Point') {\r\n        olDrawInteraction = new OlDraw({\r\n          type: 'Circle',\r\n          source: this.getSource(),\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      } else {\r\n        olDrawInteraction = new OlDraw({\r\n          type: this.geometryType,\r\n          source: this.getSource(),\r\n          maxPoints: this.options.maxPoints,\r\n          freehand: true\r\n        });\r\n      }\r\n    }\r\n\r\n    this.onDrawStartKey = olDrawInteraction\r\n      .on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\r\n    this.onDrawEndKey = olDrawInteraction\r\n      .on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\r\n    this.olMap.addInteraction(olDrawInteraction);\r\n    this.olDrawInteraction = olDrawInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the draw interaction\r\n   */\r\n  private removeOlDrawInteraction() {\r\n    if (this.olDrawInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.unsubscribeToKeyDown();\r\n    unByKey([\r\n      this.onDrawStartKey,\r\n      this.onDrawEndKey,\r\n      this.onDrawKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n    }\r\n    this.olDrawInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * When drawing starts, clear the overlay and start watching from changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.start$.next(olGeometry);\r\n    this.clearOlInnerOverlaySource();\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: OlGeometryEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      this.changes$.next(olGeometryEvent.target);\r\n    });\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, update the geometry observable and start watching from changes\r\n   * @param event Draw end event\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    this.unsubscribeToKeyDown();\r\n    unByKey(this.onDrawKey);\r\n    this.end$.next(event.feature.getGeometry());\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key down to activate the draw control\r\n   */\r\n  private subscribeToKeyDown() {\r\n    this.unsubscribeToKeyDown();\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\r\n      // On ESC key down, remove the last vertex\r\n      if (event.keyCode === 27) {\r\n        this.olDrawInteraction.removeLastPoint();\r\n        return;\r\n      }\r\n\r\n      // On space bar, pan to the current mouse position\r\n      if (event.keyCode === 32) {\r\n        this.olMap.getView().animate({\r\n          center: this.mousePosition,\r\n          duration: 0\r\n        });\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeToKeyDown() {\r\n    if (this.keyDown$$ !== undefined) {\r\n      this.keyDown$$.unsubscribe();\r\n      this.keyDown$$ = undefined;\r\n    }\r\n  }\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlStyle from 'ol/style';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlModify from 'ol/interaction/Modify';\r\nimport OlTranslate from 'ol/interaction/Translate';\r\nimport OlDraw from 'ol/interaction/Draw';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlLinearRing from 'ol/geom/LinearRing';\r\nimport OlInteraction from 'ol/interaction/Interaction';\r\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\r\nimport { MapBrowserEvent as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\r\nimport {\r\n  Geometry as OlGeometry,\r\n  GeometryEvent as OlGeometryEvent\r\n} from 'ol/geom/Geometry';\r\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\r\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\r\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { Subject, Subscription, fromEvent } from 'rxjs';\r\n\r\nimport {\r\n  addLinearRingToOlPolygon,\r\n  createDrawHoleInteractionStyle,\r\n  getMousePositionFromOlGeometryEvent\r\n} from '../geometry.utils';\r\n\r\nexport interface ModifyControlOptions {\r\n  source?: OlVectorSource;\r\n  layer?: OlVectorLayer;\r\n  layerStyle?: OlStyle | ((olfeature: OlFeature) => OlStyle);\r\n  drawStyle?: OlStyle | ((olfeature: OlFeature) => OlStyle);\r\n  modify?: boolean;\r\n  translate?: boolean;\r\n}\r\n\r\n/**\r\n * Control to modify geometries\r\n */\r\nexport class ModifyControl {\r\n\r\n  /**\r\n   * Modify start observable\r\n   */\r\n  public start$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Modify end observable\r\n   */\r\n  public end$: Subject<OlGeometry> = new Subject();\r\n\r\n  /**\r\n   * Geometry changes observable\r\n   */\r\n  public changes$: Subject<OlGeometry> = new Subject();\r\n\r\n  private olMap: OlMap;\r\n  private olOverlayLayer: OlVectorLayer;\r\n  public olModifyInteraction: OlModify;\r\n  private onModifyStartKey: string;\r\n  private onModifyEndKey: string;\r\n  private onModifyKey: string;\r\n  private olModifyInteractionIsActive: boolean = false;\r\n  private olTranslateInteraction: OlTranslate;\r\n  private onTranslateStartKey: string;\r\n  private onTranslateEndKey: string;\r\n  private onTranslateKey: string;\r\n  private olTranslateInteractionIsActive: boolean = false;\r\n  private olDrawInteraction: OlTranslate;\r\n  private onDrawStartKey: string;\r\n  private onDrawEndKey: string;\r\n  private onDrawKey: string;\r\n  private olDrawInteractionIsActive: boolean = false;\r\n\r\n  private mousePosition: [number, number];\r\n\r\n  private keyDown$$: Subscription;\r\n  private drawKeyUp$$: Subscription;\r\n  private drawKeyDown$$: Subscription;\r\n\r\n  private removedOlInteractions: OlInteraction[] = [];\r\n  private olLinearRingsLayer: OlVectorLayer;\r\n\r\n  // This is the geometry to test against when drawing holes\r\n  private olOuterGeometry: OlGeometry;\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * OL linear rings source\r\n   * @internal\r\n   */\r\n  get olLinearRingsSource(): OlVectorSource {\r\n    return this.olLinearRingsLayer.getSource();\r\n  }\r\n\r\n  /**\r\n   * Whether a modify control should be available\r\n   */\r\n  private modify: boolean = true;\r\n\r\n  /**\r\n   * Whether a translate control should be available\r\n   */\r\n  private translate: boolean = true;\r\n\r\n  constructor(private options: ModifyControlOptions) {\r\n    if (options.modify !== undefined) {\r\n      this.modify = options.modify;\r\n    }\r\n    if (options.translate !== undefined) {\r\n      this.translate = options.translate;\r\n    }\r\n\r\n    if (options.layer !== undefined) {\r\n      this.olOverlayLayer = options.layer;\r\n    } else {\r\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\r\n    }\r\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap === undefined) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeOlModifyInteraction();\r\n      this.removeOlTranslateInteraction();\r\n      this.removeOlDrawInteraction();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n\r\n    // The order in which these interactions\r\n    // are added is important\r\n    if (this.modify === true) {\r\n      this.addOlDrawInteraction();\r\n    }\r\n\r\n    if (this.translate === true) {\r\n      this.addOlTranslateInteraction();\r\n      this.activateTranslateInteraction();\r\n    }\r\n\r\n    if (this.modify === true) {\r\n      this.addOlModifyInteraction();\r\n      this.activateModifyInteraction();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the overlay source\r\n   */\r\n  getSource(): OlVectorSource {\r\n    return this.olOverlaySource;\r\n  }\r\n\r\n  /**\r\n   * Add an OL geometry to the overlay and start modifying it\r\n   * @param olGeometry Ol Geometry\r\n   */\r\n  setOlGeometry(olGeometry: OlGeometry) {\r\n    const olFeature = new OlFeature({geometry: olGeometry});\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer {\r\n    return new OlVectorLayer({\r\n      source: this.options.source ? this.options.source : new OlVectorSource(),\r\n      style: this.options.layerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer(): OlVectorLayer {\r\n    if (this.options.layer === undefined) {\r\n      this.olMap.addLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined && this.olMap !== undefined) {\r\n      this.olMap.removeLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (this.options.layer === undefined && this.options.source === undefined) {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n  }\r\n\r\n  private createOlLinearRingsLayer(): OlVectorLayer {\r\n    return new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      style: createDrawHoleInteractionStyle(),\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add the linear rings layer\r\n   */\r\n  private addOlLinearRingsLayer() {\r\n    this.olMap.addLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings layer\r\n   */\r\n  private removeOlLinearRingsLayer() {\r\n    this.olMap.removeLayer(this.olLinearRingsLayer);\r\n  }\r\n\r\n  /**\r\n   * Clear the linear rings source\r\n   */\r\n  private clearOlLinearRingsSource() {\r\n    this.olLinearRingsSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Add a modify interaction to the map an set up some listeners\r\n   */\r\n  private addOlModifyInteraction() {\r\n    const olModifyInteraction = new OlModify({\r\n      source: this.olOverlaySource,\r\n      style: this.options.drawStyle\r\n    });\r\n    this.olModifyInteraction = olModifyInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the modify interaction\r\n   */\r\n  private removeOlModifyInteraction() {\r\n    if (this.olModifyInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateModifyInteraction();\r\n    this.olModifyInteraction = undefined;\r\n  }\r\n\r\n  private activateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = true;\r\n    this.onModifyStartKey = this.olModifyInteraction\r\n      .on('modifystart', (event: OlModifyEvent) => this.onModifyStart(event));\r\n    this.onModifyEndKey = this.olModifyInteraction\r\n      .on('modifyend', (event: OlModifyEvent) => this.onModifyEnd(event));\r\n    this.olMap.addInteraction(this.olModifyInteraction);\r\n  }\r\n\r\n  private deactivateModifyInteraction() {\r\n    if (this.olModifyInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olModifyInteractionIsActive = false;\r\n\r\n    unByKey([\r\n      this.onModifyStartKey,\r\n      this.onModifyEndKey,\r\n      this.onModifyKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olModifyInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When modifying starts, clear the overlay and start watching for changes\r\n   * @param event Modify start event\r\n   */\r\n  private onModifyStart(event: OlModifyEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry();\r\n    this.start$.next(olGeometry);\r\n    this.onModifyKey = olGeometry.on('change', (olGeometryEvent: OlGeometryEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      this.changes$.next(olGeometryEvent.target);\r\n    });\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When modifying ends, update the geometry observable and stop watching for changes\r\n   * @param event Modify end event\r\n   */\r\n  private onModifyEnd(event: OlModifyEvent) {\r\n    unByKey(this.onModifyKey);\r\n    this.end$.next(event.features.item(0).getGeometry());\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to space key down to pan the map\r\n   */\r\n  private subscribeToKeyDown() {\r\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\r\n      if (event.keyCode === 32) {\r\n        // On space bar, pan to the current mouse position\r\n        this.olMap.getView().animate({\r\n          center: this.mousePosition,\r\n          duration: 0\r\n        });\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key down\r\n   */\r\n  private unsubscribeToKeyDown() {\r\n    if (this.keyDown$$ !== undefined) {\r\n      this.keyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a translate interaction to the map an set up some listeners\r\n   */\r\n  private addOlTranslateInteraction() {\r\n    const olTranslateInteraction = new OlTranslate({\r\n      layers: [this.olOverlayLayer]\r\n    });\r\n    this.olTranslateInteraction = olTranslateInteraction;\r\n  }\r\n\r\n  /**\r\n   * Remove the translate interaction\r\n   */\r\n  private removeOlTranslateInteraction() {\r\n    if (this.olTranslateInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateTranslateInteraction();\r\n    this.olTranslateInteraction = undefined;\r\n  }\r\n\r\n  private activateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = true;\r\n    this.onTranslateStartKey = this.olTranslateInteraction\r\n      .on('translatestart', (event: OlTranslateEvent) => this.onTranslateStart(event));\r\n    this.onTranslateEndKey = this.olTranslateInteraction\r\n      .on('translateend', (event: OlTranslateEvent) => this.onTranslateEnd(event));\r\n    this.olMap.addInteraction(this.olTranslateInteraction);\r\n  }\r\n\r\n  private deactivateTranslateInteraction() {\r\n    if (this.olTranslateInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.olTranslateInteractionIsActive = false;\r\n    unByKey([\r\n      this.onTranslateStartKey,\r\n      this.onTranslateEndKey,\r\n      this.onTranslateKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olTranslateInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When translation starts, clear the overlay and start watching for changes\r\n   * @param event Translate start event\r\n   */\r\n  private onTranslateStart(event: OlTranslateEvent) {\r\n    const olGeometry = event.features.item(0).getGeometry();\r\n    this.start$.next(olGeometry);\r\n    this.onTranslateKey = olGeometry.on('change', (olGeometryEvent: OlGeometryEvent) => {\r\n      this.changes$.next(olGeometryEvent.target);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Translate end event\r\n   */\r\n  private onTranslateEnd(event: OlTranslateEvent) {\r\n    unByKey(this.onTranslateKey);\r\n    this.end$.next(event.features.item(0).getGeometry());\r\n  }\r\n\r\n  /**\r\n   * Add a draw interaction to the map an set up some listeners\r\n   */\r\n  private addOlDrawInteraction() {\r\n    const olDrawInteraction = new OlDraw({\r\n      type: 'Polygon',\r\n      source: this.olLinearRingsSource,\r\n      stopClick: true,\r\n      style: createDrawHoleInteractionStyle(),\r\n      condition: (event: OlMapBrowserEvent) => {\r\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\r\n        const intersects = olOuterGeometry.intersectsCoordinate(event.coordinate);\r\n        return intersects;\r\n      }\r\n    });\r\n\r\n    this.olDrawInteraction = olDrawInteraction;\r\n    this.subscribeToDrawKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key down to activate the draw control\r\n   */\r\n  private subscribeToDrawKeyDown() {\r\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\r\n      if (event.keyCode !== 17) { return; }\r\n\r\n      this.unsubscribeToDrawKeyDown();\r\n\r\n      const olGeometry = this.getOlGeometry();\r\n      if (!olGeometry || !(olGeometry instanceof OlPolygon)) { return; }\r\n\r\n      this.subscribeToDrawKeyUp();\r\n\r\n      this.deactivateModifyInteraction();\r\n      this.deactivateTranslateInteraction();\r\n      this.activateDrawInteraction();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Subscribe to CTRL key up to deactivate the draw control\r\n   */\r\n  private subscribeToDrawKeyUp() {\r\n    this.drawKeyUp$$ = fromEvent(document, 'keyup')\r\n      .subscribe((event: KeyboardEvent) => {\r\n        if (event.keyCode !== 17) {\r\n          return;\r\n        }\r\n\r\n        this.unsubscribeToDrawKeyUp();\r\n        this.unsubscribeToKeyDown();\r\n        this.deactivateDrawInteraction();\r\n\r\n        this.activateModifyInteraction();\r\n        if (this.translate === true) {\r\n          this.activateTranslateInteraction();\r\n        }\r\n        this.subscribeToDrawKeyDown();\r\n\r\n        this.olOuterGeometry = undefined;\r\n        this.clearOlLinearRingsSource();\r\n        this.end$.next(this.getOlGeometry());\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to draw key down\r\n   */\r\n  private unsubscribeToDrawKeyDown() {\r\n    if (this.drawKeyDown$$ !== undefined) {\r\n      this.drawKeyDown$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to key up\r\n   */\r\n  private unsubscribeToDrawKeyUp() {\r\n    if (this.drawKeyUp$$ !== undefined) {\r\n      this.drawKeyUp$$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the draw interaction\r\n   */\r\n  private removeOlDrawInteraction() {\r\n    if (this.olDrawInteraction === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.unsubscribeToKeyDown();\r\n    this.unsubscribeToDrawKeyUp();\r\n    this.unsubscribeToDrawKeyDown();\r\n    this.deactivateDrawInteraction();\r\n    this.clearOlLinearRingsSource();\r\n    this.olDrawInteraction = undefined;\r\n  }\r\n\r\n  /**\r\n   * Activate the draw interaction\r\n   */\r\n  private activateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === true) {\r\n      return;\r\n    }\r\n\r\n    this.clearOlLinearRingsSource();\r\n    this.addOlLinearRingsLayer();\r\n\r\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\r\n      if (olInteraction instanceof OlDragBoxInteraction) {\r\n        this.olMap.removeInteraction(olInteraction);\r\n        this.removedOlInteractions.push(olInteraction);\r\n      }\r\n    });\r\n\r\n    this.olDrawInteractionIsActive = true;\r\n    this.onDrawStartKey = this.olDrawInteraction\r\n      .on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\r\n    this.onDrawEndKey = this.olDrawInteraction\r\n      .on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\r\n    this.olMap.addInteraction(this.olDrawInteraction);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the draw interaction\r\n   */\r\n  private deactivateDrawInteraction() {\r\n    if (this.olDrawInteractionIsActive === false) {\r\n      return;\r\n    }\r\n\r\n    this.removeOlLinearRingsLayer();\r\n\r\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\r\n      this.olMap.addInteraction(olInteraction);\r\n    });\r\n    this.removedOlInteractions = [];\r\n\r\n    this.olDrawInteractionIsActive = false;\r\n    unByKey([\r\n      this.onDrawStartKey,\r\n      this.onDrawEndKey,\r\n      this.onDrawKey\r\n    ]);\r\n    if (this.olMap !== undefined) {\r\n      this.olMap.removeInteraction(this.olDrawInteraction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\r\n   * @param event Draw start event\r\n   */\r\n  private onDrawStart(event: OlDrawEvent) {\r\n    const olGeometry = event.feature.getGeometry();\r\n    this.olOuterGeometry = this.getOlGeometry().clone();\r\n\r\n    const linearRingCoordinates = olGeometry.getLinearRing().getCoordinates();\r\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\r\n    this.start$.next(this.getOlGeometry());\r\n\r\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: OlGeometryEvent) => {\r\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\r\n      const _linearRingCoordinates = olGeometryEvent.target.getLinearRing().getCoordinates();\r\n      this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\r\n      this.changes$.next(this.getOlGeometry());\r\n    });\r\n    this.subscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * When translation ends, update the geometry observable and stop watchign for changes\r\n   * @param event Draw end event\r\n   */\r\n  private onDrawEnd(event: OlDrawEvent) {\r\n    unByKey(this.onDrawKey);\r\n    this.olOuterGeometry = undefined;\r\n\r\n    const linearRingCoordinates = event.feature.getGeometry().getLinearRing().getCoordinates();\r\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\r\n    this.clearOlLinearRingsSource();\r\n    this.end$.next(this.getOlGeometry());\r\n    this.unsubscribeToKeyDown();\r\n  }\r\n\r\n  /**\r\n   * Add a linear ring to the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private addLinearRingToOlGeometry(coordinates: number[]) {\r\n    const olGeometry = this.getOlGeometry();\r\n    const olLinearRing = new OlLinearRing(coordinates);\r\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\r\n  }\r\n\r\n  /**\r\n   * Update the last linear ring of the geometry being modified\r\n   * @param coordinates Linear ring coordinates\r\n   */\r\n  private updateLinearRingOfOlGeometry(coordinates: number[]) {\r\n    const olGeometry = this.getOlGeometry();\r\n    // Remove the last linear ring (the one we are updating)\r\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\r\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\r\n      return olLinearRing.getCoordinates();\r\n    });\r\n    newCoordinates.push(coordinates);\r\n    olGeometry.setCoordinates(newCoordinates);\r\n  }\r\n\r\n  /**\r\n   * Get the geometry being modified\r\n   * @returns OL Geometry\r\n   */\r\n  private getOlGeometry(): OlGeometry {\r\n    const olFeatures = this.olOverlaySource.getFeatures();\r\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\r\n  }\r\n\r\n}\r\n","import OlMap from 'ol/Map';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlStyle from 'ol/style';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlGeometry from 'ol/geom/Geometry';\r\nimport OlLineString from 'ol/geom/LineString';\r\n\r\nimport { Subject, Subscription } from 'rxjs';\r\n\r\nimport { GeometrySliceError } from '../geometry.errors';\r\nimport { sliceOlGeometry } from '../geometry.utils';\r\nimport { DrawControl } from './draw';\r\n\r\nexport interface SliceControlOptions {\r\n  source?: OlVectorSource;\r\n  layer?: OlVectorLayer;\r\n  layerStyle?: OlStyle | ((olfeature: OlFeature) => OlStyle);\r\n  drawStyle?: OlStyle | ((olfeature: OlFeature) => OlStyle);\r\n}\r\n\r\n/**\r\n * Control to modify geometries\r\n */\r\nexport class SliceControl {\r\n\r\n  /**\r\n   * Slice end observable\r\n   */\r\n  public end$: Subject<OlGeometry[]> = new Subject();\r\n\r\n  /**\r\n   * Slice error, if any\r\n   */\r\n  public error$: Subject<GeometrySliceError> = new Subject();\r\n\r\n  private olMap: OlMap;\r\n  private olOverlayLayer: OlVectorLayer;\r\n\r\n  /**\r\n   * Draw line control\r\n   */\r\n  private drawLineControl: DrawControl;\r\n\r\n  /**\r\n   * Subscription to draw start\r\n   */\r\n  private drawLineStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to draw end\r\n   */\r\n  private drawLineEnd$$: Subscription;\r\n\r\n  /**\r\n   * Wheter the control is active\r\n   */\r\n  get active(): boolean {\r\n    return this.olMap !== undefined;\r\n  }\r\n\r\n  /**\r\n   * OL overlay source\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  constructor(private options: SliceControlOptions) {\r\n    if (options.layer !== undefined) {\r\n      this.olOverlayLayer = options.layer;\r\n    } else {\r\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add or remove this control to/from a map.\r\n   * @param map OL Map\r\n   */\r\n  setOlMap(olMap: OlMap | undefined) {\r\n    if (olMap === undefined) {\r\n      this.clearOlInnerOverlaySource();\r\n      this.removeOlInnerOverlayLayer();\r\n      this.removeDrawLineControl();\r\n      this.olMap = olMap;\r\n      return;\r\n    }\r\n\r\n    this.olMap = olMap;\r\n    this.addOlInnerOverlayLayer();\r\n    this.addDrawLineControl();\r\n  }\r\n\r\n  /**\r\n   * Return the overlay source\r\n   */\r\n  getSource(): OlVectorSource {\r\n    return this.olOverlaySource;\r\n  }\r\n\r\n  /**\r\n   * Add an OL geometry to the overlay for slicing\r\n   * @param olGeometry Ol Geometry\r\n   */\r\n  setOlGeometry(olGeometry: OlGeometry) {\r\n    const olFeature = new OlFeature({geometry: olGeometry});\r\n    this.olOverlaySource.clear(true);\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create an overlay source if none is defined in the options\r\n   */\r\n  private createOlInnerOverlayLayer(): OlVectorLayer {\r\n    return new OlVectorLayer({\r\n      source: this.options.source ? this.options.source : new OlVectorSource(),\r\n      style: this.options.layerStyle,\r\n      zIndex: 500\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer if it wasn't defined in the options\r\n   */\r\n  private removeOlInnerOverlayLayer() {\r\n    if (this.options.layer === undefined && this.olMap !== undefined) {\r\n      this.olMap.removeLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add the overlay layer if it wasn't defined in the options\r\n   */\r\n  private addOlInnerOverlayLayer(): OlVectorLayer {\r\n    if (this.options.layer === undefined) {\r\n      this.olMap.addLayer(this.olOverlayLayer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay source if it wasn't defined in the options\r\n   */\r\n  private clearOlInnerOverlaySource() {\r\n    if (this.options.layer === undefined && this.options.source === undefined) {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a draw line control and add it to the map\r\n   */\r\n  private addDrawLineControl() {\r\n    this.drawLineControl = new DrawControl({\r\n      geometryType: 'LineString',\r\n      drawStyle: this.options.drawStyle,\r\n      maxPoints: 2\r\n    });\r\n    this.drawLineStart$$ = this.drawLineControl.start$\r\n      .subscribe((olLine: OlLineString) => this.onDrawLineStart(olLine));\r\n    this.drawLineEnd$$ = this.drawLineControl.end$\r\n      .subscribe((olLine: OlLineString) => this.onDrawLineEnd(olLine));\r\n    this.drawLineControl.setOlMap(this.olMap);\r\n  }\r\n\r\n  /**\r\n   * Remove draw line control\r\n   */\r\n  private removeDrawLineControl() {\r\n    if (this.drawLineControl === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.drawLineStart$$.unsubscribe();\r\n    this.drawLineEnd$$.unsubscribe();\r\n    this.drawLineControl.getSource().clear(true);\r\n    this.drawLineControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olLine Ol linestring or polygon\r\n   */\r\n  private onDrawLineStart(olLine: OlLineString) {\r\n    this.drawLineControl.getSource().clear(true);\r\n  }\r\n\r\n  /**\r\n   * Slice the first geometry encountered with the drawn line\r\n   * @param olLine Ol linestring\r\n   */\r\n  private onDrawLineEnd(olLine: OlLineString) {\r\n    const olSlicedGeometries = [];\r\n    const lineExtent = olLine.getExtent();\r\n\r\n    const olFeaturesToRemove = [];\r\n    try {\r\n      this.olOverlaySource.forEachFeatureInExtent(lineExtent, (olFeature: OlFeature) => {\r\n        const olGeometry = olFeature.getGeometry();\r\n        const olParts = sliceOlGeometry(olGeometry, olLine);\r\n        if (olParts.length > 0) {\r\n          olSlicedGeometries.push(...olParts);\r\n          olFeaturesToRemove.push(olFeature);\r\n        }\r\n      });\r\n    } catch (e) {\r\n      if (e instanceof GeometrySliceError) {\r\n        this.error$.next(e);\r\n        return;\r\n      } else {\r\n        throw e;\r\n      }\r\n    }\r\n\r\n    this.drawLineControl.getSource().clear(true);\r\n\r\n    this.olOverlaySource.addFeatures(\r\n      olSlicedGeometries.map((olGeometry: OlGeometry) => new OlFeature(olGeometry))\r\n    );\r\n    olFeaturesToRemove.forEach((olFeature: OlFeature) => {\r\n      this.olOverlaySource.removeFeature(olFeature);\r\n    });\r\n\r\n    this.error$.next(undefined);\r\n    this.end$.next(olSlicedGeometries);\r\n  }\r\n}\r\n","import { Component, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material';\r\n\r\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\r\n\r\n@Component({\r\n  selector: 'igo-measurer-dialog',\r\n  templateUrl: 'measurer-dialog.component.html',\r\n  styleUrls: ['./measurer-dialog.component.scss']\r\n})\r\nexport class MeasurerDialogComponent {\r\n\r\n  measureAreaUnit = MeasureAreaUnit;\r\n\r\n  measureLengthUnit = MeasureLengthUnit;\r\n\r\n  constructor(\r\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\r\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\r\n  ) {}\r\n\r\n  onNoClick(): void {\r\n    this.dialogRef.close();\r\n  }\r\n\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatDialog } from '@angular/material';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { skip } from 'rxjs/operators';\r\n\r\nimport OlProjection from 'ol/proj/Projection';\r\nimport OlStyle from 'ol/style/Style';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\r\nimport OlLineString from 'ol/geom/LineString';\r\nimport OlPolygon from 'ol/geom/Polygon';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityRecord, EntityTableTemplate, EntityTableComponent } from '@igo2/common';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { FeatureDataSource } from '../../datasource';\r\nimport {\r\n  FEATURE,\r\n  FeatureStore,\r\n  FeatureStoreLoadingStrategy,\r\n  FeatureStoreSelectionStrategy,\r\n  tryBindStoreLayer,\r\n  tryAddLoadingStrategy,\r\n  tryAddSelectionStrategy\r\n} from '../../feature';\r\nimport { DrawControl, ModifyControl } from '../../geometry';\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\r\nimport {\r\n  MeasureType,\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit,\r\n} from '../shared/measure.enum';\r\nimport {\r\n  measureOlGeometry,\r\n  createMeasureInteractionStyle,\r\n  createMeasureLayerStyle,\r\n  updateOlTooltipsAtMidpoints,\r\n  updateOlTooltipAtCenter,\r\n  getTooltipsOfOlGeometry,\r\n  squareMetersToUnit,\r\n  metersToUnit,\r\n  formatMeasure\r\n} from '../shared/measure.utils';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\n\r\n/**\r\n * Tool to measure lengths and areas\r\n */\r\n@Component({\r\n  selector: 'igo-measurer',\r\n  templateUrl: './measurer.component.html',\r\n  styleUrls: ['./measurer.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerComponent implements OnInit, OnDestroy {\r\n\r\n  /**\r\n   * Table template\r\n   * @internal\r\n   */\r\n  public tableTemplate: EntityTableTemplate = {\r\n    selection: true,\r\n    selectMany: true,\r\n    selectionCheckbox: true,\r\n    sort: true,\r\n    columns: [\r\n      {\r\n        name: 'length',\r\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\r\n        valueAccessor: (feature: FeatureWithMeasure) => {\r\n          const unit = this.activeLengthUnit;\r\n          const measure = metersToUnit(feature.properties.measure.length, unit);\r\n          return formatMeasure(measure, {\r\n            decimal: 1,\r\n            unit,\r\n            unitAbbr: false,\r\n            locale: 'fr'\r\n          });\r\n        }\r\n      },\r\n      {\r\n        name: 'area',\r\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\r\n        valueAccessor: (feature: FeatureWithMeasure) => {\r\n          const unit = this.activeAreaUnit;\r\n          const measure = squareMetersToUnit(feature.properties.measure.area, unit);\r\n          return measure ? formatMeasure(measure, {\r\n            decimal: 1,\r\n            unit,\r\n            unitAbbr: false,\r\n            locale: 'fr'\r\n          }) : '';\r\n        }\r\n      }\r\n    ]\r\n  };\r\n\r\n  /**\r\n   * Reference to the MeasureType enum\r\n   * @internal\r\n   */\r\n  public measureType = MeasureType;\r\n\r\n  /**\r\n   * Reference to the AreaMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureAreaUnit = MeasureAreaUnit;\r\n\r\n  /**\r\n   * Reference to the LengthMeasureUnit enum\r\n   * @internal\r\n   */\r\n  public measureLengthUnit = MeasureLengthUnit;\r\n\r\n  /**\r\n   * Whether measure units should be automatically determined\r\n   * @internal\r\n   */\r\n  public measureUnitsAuto: boolean = false;\r\n\r\n  /**\r\n   * Observable of area\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\r\n\r\n  /**\r\n   * Observable of selected features\r\n   * @internal\r\n   */\r\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\r\n\r\n  /**\r\n   * OL draw source\r\n   * @internal\r\n   */\r\n  public showTooltips: boolean = true;\r\n\r\n  /**\r\n   * Draw line control\r\n   */\r\n  private drawLineControl: DrawControl;\r\n\r\n  /**\r\n   * Draw polygon control\r\n   */\r\n  private drawPolygonControl: DrawControl;\r\n\r\n  /**\r\n   * Modify control\r\n   */\r\n  private modifyControl: ModifyControl;\r\n\r\n  /**\r\n   * Active OL geometry\r\n   */\r\n  private activeOlGeometry: OlLineString | OlPolygon;\r\n\r\n  /**\r\n   * Active mlength unit\r\n   */\r\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  /**\r\n   * Active area unit\r\n   */\r\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\r\n\r\n  /**\r\n   * Feature added listener key\r\n   */\r\n  private onFeatureAddedKey: string;\r\n\r\n  /**\r\n   * Feature removed listener key\r\n   */\r\n  private onFeatureRemovedKey: string;\r\n\r\n  /**\r\n   * Active draw control\r\n   * @internal\r\n   */\r\n  private activeDrawControl: DrawControl;\r\n\r\n  /**\r\n   * Subscription to draw start\r\n   */\r\n  private drawStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to draw end\r\n   */\r\n  private drawEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private drawChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify start\r\n   */\r\n  private modifyStart$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to modify end\r\n   */\r\n  private modifyEnd$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to controls changes\r\n   */\r\n  private modifyChanges$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to measures selection\r\n   */\r\n  private selectedFeatures$$: Subscription;\r\n\r\n  /**\r\n   * OL draw source\r\n   */\r\n  private olDrawSource = new OlVectorSource();\r\n\r\n  /**\r\n   * The map to measure on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The measures store\r\n   */\r\n  @Input() store: FeatureStore<FeatureWithMeasure>;\r\n\r\n  /**\r\n   * Measure type\r\n   * @internal\r\n   */\r\n  @Input()\r\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\r\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\r\n  private _activeMeasureType: MeasureType = MeasureType.Length;\r\n\r\n  /**\r\n   * The minimum length a segment must have to display a tooltip.\r\n   * It also applies to area tooltips.\r\n   */\r\n  @Input() minSegmentLength: number = 10;\r\n\r\n  @ViewChild('table') table: EntityTableComponent;\r\n\r\n  /**\r\n   * Wheter one of the draw control is active\r\n   * @internal\r\n   */\r\n  get drawControlIsActive(): boolean {\r\n    return this.activeDrawControl !== undefined;\r\n  }\r\n\r\n  get projection(): OlProjection {\r\n    return this.map.ol.getView().getProjection();\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private dialog: MatDialog\r\n  ) {}\r\n\r\n  /**\r\n   * Add draw controls and activate one\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.initStore();\r\n    this.createDrawLineControl();\r\n    this.createDrawPolygonControl();\r\n    this.createModifyControl();\r\n    this.toggleDrawControl();\r\n    this.onToggleTooltips(this.showTooltips);\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.setActiveMeasureType(undefined);\r\n    this.deactivateModifyControl();\r\n    this.freezeStore();\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onMeasureTypeChange(measureType: MeasureType) {\r\n    this.activeMeasureType = measureType;\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleDrawControl(toggle: boolean) {\r\n    if (toggle === true) {\r\n      this.toggleDrawControl();\r\n    } else {\r\n      this.deactivateDrawControl();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleTooltips(toggle: boolean) {\r\n    this.showTooltips = toggle;\r\n    if (toggle === true) {\r\n      this.showTooltipsOfOlSource(this.store.source.ol);\r\n    } else {\r\n      this.clearTooltipsOfOlSource(this.store.source.ol);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate or deactivate the current draw control\r\n   * @internal\r\n   */\r\n  onToggleMeasureUnitsAuto(toggle: boolean) {\r\n    this.measureUnitsAuto = toggle;\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onLengthUnitChange(unit: MeasureLengthUnit) {\r\n    this.activeLengthUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the measure type\r\n   * @internal\r\n   */\r\n  onAreaUnitChange(unit: MeasureAreaUnit) {\r\n    this.activeAreaUnit = unit;\r\n    this.table.refresh();\r\n    this.updateTooltipsOfOlSource(this.store.source.ol);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n  }\r\n\r\n  onCalculateClick() {\r\n    const features = this.selectedFeatures$.value;\r\n    const area = features.reduce((sum: number, feature: FeatureWithMeasure) => {\r\n      return sum + feature.properties.measure.area || 0;\r\n    }, 0);\r\n    const length = features.reduce((sum: number, feature: FeatureWithMeasure) => {\r\n      if (feature.geometry.type === 'Polygon') {\r\n        return sum;\r\n      }\r\n      return sum + feature.properties.measure.length || 0;\r\n    }, 0);\r\n    const perimeter = features.reduce((sum: number, feature: FeatureWithMeasure) => {\r\n      if (feature.geometry.type === 'LineString') {\r\n        return sum;\r\n      }\r\n      return sum + feature.properties.measure.length || 0;\r\n    }, 0);\r\n\r\n    this.openDialog({\r\n      area,\r\n      length,\r\n      perimeter\r\n    });\r\n  }\r\n\r\n  onDeleteClick() {\r\n    this.store.deleteMany(this.selectedFeatures$.value);\r\n  }\r\n\r\n  onModifyClick() {\r\n    if (this.selectedFeatures$.value.length !== 1) { return; }\r\n\r\n    if (this.modifyControl.active === true) {\r\n      this.deactivateModifyControl();\r\n      this.toggleDrawControl();\r\n    } else {\r\n      const feature = this.selectedFeatures$.value[0];\r\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\r\n      const olFeature = olFeatures.find((_olFeature: OlFeature) => {\r\n        return _olFeature.get('id') === feature.properties.id;\r\n      });\r\n\r\n      if (olFeature !== undefined) {\r\n        this.deactivateDrawControl();\r\n        this.activateModifyControl();\r\n\r\n        const olGeometry = olFeature.getGeometry();\r\n        this.clearTooltipsOfOlGeometry(olGeometry);\r\n        this.modifyControl.setOlGeometry(olGeometry);\r\n      }\r\n    }\r\n  }\r\n\r\n  private openDialog(data: MeasurerDialogData): void {\r\n    this.dialog.open(MeasurerDialogComponent, {data});\r\n  }\r\n\r\n  /**\r\n   * Initialize the measure store and set up some listeners\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      title: 'Measures',\r\n      zIndex: 200,\r\n      source: new FeatureDataSource(),\r\n      style: createMeasureLayerStyle(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n\r\n    tryAddLoadingStrategy(store);\r\n\r\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\r\n      map: this.map,\r\n      many: true\r\n    }));\r\n\r\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent) => {\r\n      const feature = event.feature;\r\n      const olGeometry = feature.getGeometry();\r\n      this.updateMeasureOfOlGeometry(olGeometry, feature.get('measure'));\r\n    });\r\n\r\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent) => {\r\n      const olGeometry = event.feature.getGeometry();\r\n      this.clearTooltipsOfOlGeometry(olGeometry);\r\n    });\r\n\r\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\r\n      return record.state.selected === true;\r\n    }).pipe(\r\n      skip(1)  // Skip initial emission\r\n    )\r\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\r\n      if (this.modifyControl.active === true) {\r\n        this.deactivateModifyControl();\r\n      }\r\n      this.selectedFeatures$.next(records.map(record => record.entity));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\r\n   * and some listener removed\r\n   * @internal\r\n   */\r\n  private freezeStore() {\r\n    const store = this.store;\r\n    this.selectedFeatures$$.unsubscribe();\r\n    unByKey(this.onFeatureAddedKey);\r\n    unByKey(this.onFeatureRemovedKey);\r\n    this.clearTooltipsOfOlSource(store.source.ol);\r\n    this.map.removeLayer(store.layer);\r\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\r\n  }\r\n\r\n  /**\r\n   * Create a draw line control\r\n   */\r\n  private createDrawLineControl() {\r\n    this.drawLineControl = new DrawControl({\r\n      geometryType: 'LineString',\r\n      source: this.olDrawSource,\r\n      drawStyle: createMeasureInteractionStyle(),\r\n      layerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createDrawPolygonControl() {\r\n    this.drawPolygonControl = new DrawControl({\r\n      geometryType: 'Polygon',\r\n      source: this.olDrawSource,\r\n      drawStyle: createMeasureInteractionStyle(),\r\n      layerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a draw polygon control\r\n   */\r\n  private createModifyControl() {\r\n    this.modifyControl = new ModifyControl({\r\n      source: this.olDrawSource,\r\n      drawStyle: createMeasureInteractionStyle(),\r\n      layerStyle: new OlStyle({})\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Activate the right control\r\n   */\r\n  private toggleDrawControl() {\r\n    this.deactivateDrawControl();\r\n    // this.deactivateModifyControl();\r\n    if (this.activeMeasureType === MeasureType.Length) {\r\n      this.activateDrawControl(this.drawLineControl);\r\n    } else if (this.activeMeasureType === MeasureType.Area) {\r\n      this.activateDrawControl(this.drawPolygonControl);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param drawControl Draw control\r\n   */\r\n  private activateDrawControl(drawControl: DrawControl) {\r\n    this.activeDrawControl = drawControl;\r\n    this.drawStart$$ = drawControl.start$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\r\n    this.drawEnd$$ = drawControl.end$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\r\n    this.drawChanges$$ = drawControl.changes$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\r\n\r\n    drawControl.setOlMap(this.map.ol);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active draw control\r\n   */\r\n  private deactivateDrawControl() {\r\n    if (this.activeDrawControl === undefined) {\r\n      return;\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\r\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\r\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\r\n\r\n    this.clearTooltipsOfOlSource(this.olDrawSource);\r\n    if (this.activeOlGeometry !== undefined) {\r\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n    this.activeDrawControl.setOlMap(undefined);\r\n    this.activeDrawControl = undefined;\r\n    this.activeOlGeometry = undefined;\r\n  }\r\n\r\n  private setActiveMeasureType(measureType: MeasureType) {\r\n    this._activeMeasureType = measureType;\r\n    this.clearMeasures();\r\n    this.toggleDrawControl();\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.activeOlGeometry = undefined;\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n    this.addFeatureToStore(olGeometry);\r\n    this.clearTooltipsOfOlGeometry(olGeometry);\r\n    this.olDrawSource.clear(true);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = measureOlGeometry(olGeometry, this.projection);\r\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\r\n      area: undefined  // We don't want to display an area tooltip while drawing.\r\n    }));\r\n    this.measure$.next(measure);\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param modifyControl Modify control\r\n   */\r\n  private activateModifyControl() {\r\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\r\n    selection.deactivate();\r\n    selection.clear();\r\n\r\n    this.modifyStart$$ = this.modifyControl.start$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\r\n    this.modifyEnd$$ = this.modifyControl.end$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\r\n    this.modifyChanges$$ = this.modifyControl.changes$\r\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\r\n    this.modifyControl.setOlMap(this.map.ol);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active modify control\r\n   */\r\n  private deactivateModifyControl() {\r\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\r\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\r\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\r\n\r\n    if (this.activeOlGeometry !== undefined) {\r\n      if (this.selectedFeatures$.value.length === 1) {\r\n        const feature = this.selectedFeatures$.value[0];\r\n        this.addFeatureToStore(this.activeOlGeometry, feature);\r\n      }\r\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\r\n    }\r\n\r\n    this.olDrawSource.clear();\r\n\r\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\r\n\r\n    this.activeOlGeometry = undefined;\r\n    this.modifyControl.setOlMap(undefined);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being drawn\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawStart(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\r\n    this.onDrawChanges(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the draw source and track the geometry being draw\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\r\n    this.finalizeMeasureOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    let measure = measureOlGeometry(olGeometry, this.projection);\r\n    if (olGeometry instanceof OlPolygon) {\r\n      measure = Object.assign({}, measure, {\r\n        lengths: []  // We don't want to display an area tooltip while drawing.\r\n      });\r\n    }\r\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables\r\n   * @param olGeometry Ol linestring or polygon\r\n   * @param measure Measure\r\n   */\r\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\r\n    olGeometry.setProperties({_measure: measure}, true);\r\n    this.updateTooltipsOfOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Clear the measures observables\r\n   */\r\n  private clearMeasures() {\r\n    this.measure$.next({});\r\n  }\r\n\r\n  /**\r\n   * Add a feature with measures to the store. The loading stragegy of the store\r\n   * will trigger and add the feature to the map.\r\n   * @internal\r\n   */\r\n  private addFeatureToStore(olGeometry: OlLineString | OlPolygon, feature?: FeatureWithMeasure) {\r\n    const featureId = feature ? feature.properties.id : uuid();\r\n    const projection = this.map.ol.getView().getProjection();\r\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\r\n      featureProjection: projection,\r\n      dataProjection: projection\r\n    });\r\n    this.store.update({\r\n      type: FEATURE,\r\n      geometry,\r\n      projection: projection.getCode(),\r\n      properties: {\r\n        id: featureId,\r\n        measure: olGeometry.get('_measure')\r\n      },\r\n      meta: {\r\n        id: featureId\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update all the tooltips of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   * @param lengths Lengths of the OL geometry's segments\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    const measure = olGeometry.get('_measure');\r\n    const lengths = measure.lengths;\r\n    const area = measure.area;\r\n\r\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\r\n    if (lengths.length === olMidpointsTooltips.length) {\r\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\r\n        const length = lengths[i];\r\n        if (length !== undefined) {\r\n          this.updateOlTooltip(\r\n            olMidpointsTooltips[i],\r\n            metersToUnit(length, this.activeLengthUnit),\r\n            this.activeLengthUnit,\r\n            MeasureType.Length\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (area !== undefined) {\r\n      this.updateOlTooltip(\r\n        updateOlTooltipAtCenter(olGeometry),\r\n        squareMetersToUnit(area,  this.activeAreaUnit),\r\n        this.activeAreaUnit,\r\n        MeasureType.Area\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of a geoemtry\r\n   */\r\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\r\n      if (this.shouldShowTooltip(olTooltip)) {\r\n        this.map.ol.addOverlay(olTooltip);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the tooltips of an OL geometrys\r\n   * @param olGeometry OL geometry with tooltips\r\n   */\r\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\r\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\r\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\r\n        this.map.ol.removeOverlay(olTooltip);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private updateTooltipsOfOlSource(olSource: OlVectorSource) {\r\n    olSource.forEachFeature((olFeature: OlFeature) => {\r\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry());\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show the map tooltips of all the geometries of a source\r\n   */\r\n  private showTooltipsOfOlSource(olSource: OlVectorSource) {\r\n    olSource.forEachFeature((olFeature: OlFeature) => {\r\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry());\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the map tooltips\r\n   * @param olDrawSource OL vector source\r\n   */\r\n  private clearTooltipsOfOlSource(olSource: OlVectorSource) {\r\n    olSource.forEachFeature((olFeature: OlFeature) => {\r\n      const olGeometry = olFeature.getGeometry();\r\n      if (olGeometry !== undefined) {\r\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry());\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\r\n   * @param olTooltip OL tooltip\r\n   * @param measure The measure valeu ti display\r\n   * @param measureUnit Display tooltip measure in those units\r\n   */\r\n  private updateOlTooltip(\r\n    olTooltip: OlOverlay,\r\n    measure: number,\r\n    unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    type: MeasureType\r\n  ) {\r\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\r\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\r\n    if (this.shouldShowTooltip(olTooltip)) {\r\n      this.map.ol.addOverlay(olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Compute a tooltip's content\r\n   * @param olTooltip OL overlay\r\n   * @returns Inner HTML\r\n   */\r\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\r\n    const properties = olTooltip.getProperties() as any;\r\n    return formatMeasure(properties._measure, {\r\n      decimal: 1,\r\n      unit: properties._unit,\r\n      unitAbbr: true,\r\n      locale: 'fr'\r\n    }, this.languageService);\r\n  }\r\n\r\n  /**\r\n   * Whether a tooltip should be showned based on the length\r\n   * of the segment it is bound to.\r\n   * @param olTooltip OL overlay\r\n   * @returns True if the tooltip should be shown\r\n   */\r\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\r\n    if (this.showTooltips === false) {\r\n      return false;\r\n    }\r\n\r\n    const properties = olTooltip.getProperties() as any;\r\n    const measure = properties._measure;\r\n    if (measure === undefined) {\r\n      return false;\r\n    }\r\n\r\n    if (properties._unit === MeasureType.Length) {\r\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\r\n      return measure > Math.max(minSegmentLength, 0);\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\n\r\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\r\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\r\n\r\n/**\r\n * This pipe returns a measure converted from meters (or square meters)\r\n * to the specified unit. It also keeps a certain number of decimals.\r\n */\r\n@Pipe({\r\n  name: 'measureFormat'\r\n})\r\nexport class MeasureFormatPipe implements PipeTransform {\r\n\r\n  /**\r\n   * @ignore\r\n   */\r\n  transform(\r\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\r\n    unitAbbr: boolean = false,\r\n    decimal: number = 1\r\n  ): number {\r\n    let out;\r\n    if (Object.values(MeasureAreaUnit).indexOf(unit) >= 0) {\r\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\r\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit) >= 0) {\r\n      out = metersToUnit(value, unit as MeasureLengthUnit);\r\n    }\r\n\r\n    return out ? formatMeasure(out, {\r\n      decimal: 1,\r\n      unit,\r\n      unitAbbr,\r\n      locale: 'fr'\r\n    }) : out;\r\n  }\r\n}\r\n","import { OlModify } from 'ol/interaction/Modify';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  Optional,\r\n  Self,\r\n  ChangeDetectorRef,\r\n  ChangeDetectionStrategy,\r\n  EventEmitter,\r\n  Output\r\n} from '@angular/core';\r\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport * as OlStyle from 'ol/style';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport OlGeometry from 'ol/geom/Geometry';\r\nimport OlGeometryType from 'ol/geom/GeometryType';\r\nimport OlFeature from 'ol/Feature';\r\nimport OlVectorSource from 'ol/source/Vector';\r\nimport OlVectorLayer from 'ol/layer/Vector';\r\nimport OlOverlay from 'ol/Overlay';\r\nimport * as poly from 'ol/geom/Polygon';\r\nimport * as olproj from 'ol/proj';\r\nimport Point from 'ol/geom/Point';\r\n\r\nimport { IgoMap } from '../../map';\r\nimport {\r\n  MeasureLengthUnit,\r\n  updateOlGeometryMidpoints,\r\n  formatMeasure,\r\n  measureOlGeometry\r\n} from '../../measure';\r\nimport { DrawControl, ModifyControl } from '../shared/controls';\r\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\r\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\r\n\r\n/**\r\n * This input allows a user to draw a new geometry or to edit\r\n * an existing one on a map. A text input is also displayed in the\r\n * form with some instructions.\r\n * This is still WIP.\r\n */\r\n@Component({\r\n  selector: 'igo-geometry-form-field-input',\r\n  templateUrl: './geometry-form-field-input.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\r\n\r\n  private olOverlayLayer: OlVectorLayer;\r\n  private olGeoJSON = new OlGeoJSON();\r\n  private ready = false;\r\n\r\n  private drawControl: DrawControl;\r\n  private modifyControl: ModifyControl;\r\n  private defaultDrawStyleRadius: number;\r\n  private olGeometryEnds$$: Subscription;\r\n  private olGeometryChanges$$: Subscription;\r\n  private olTooltip = OlOverlay;\r\n\r\n  /**\r\n   * Active control\r\n   * @internal\r\n   */\r\n  public activeControl: DrawControl | ModifyControl;\r\n\r\n  /**\r\n   * The map to draw the geometry on\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The geometry type\r\n   */\r\n  @Input()\r\n  set geometryType(value: OlGeometryType) {\r\n    this._geometryType = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get geometryType(): OlGeometryType { return this._geometryType; }\r\n  private _geometryType: OlGeometryType;\r\n\r\n  /**\r\n   * The drawGuide around the mouse pointer to help drawing\r\n   */\r\n  @Input() drawGuide: number = null;\r\n\r\n  /**\r\n   * Whether a measure tooltip should be displayed\r\n   */\r\n  @Input() measure: boolean = false;\r\n\r\n  /**\r\n   * Whether draw control should be active or not\r\n   */\r\n  @Input()\r\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\r\n  set drawControlIsActive(value: boolean) {\r\n    this._drawControlIsActive = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    this.deactivateControl();\r\n    if (!this._drawControlIsActive) {\r\n      return;\r\n    } else {\r\n      this.toggleControl();\r\n    }\r\n  }\r\n  private _drawControlIsActive: boolean = true;\r\n\r\n  /**\r\n   * Whether freehand draw control should be active or not\r\n   */\r\n  @Input()\r\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\r\n  set freehandDrawIsActive(value: boolean) {\r\n    this._freehandDrawIsActive = value;\r\n    this.deactivateControl();\r\n\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.drawControlIsActive) {\r\n      return;\r\n    }\r\n    this.toggleControl();\r\n  }\r\n  private _freehandDrawIsActive: boolean;\r\n\r\n  /**\r\n   * Control options\r\n   */\r\n  @Input() controlOptions: {[key: string]: any} = {};\r\n\r\n  /**\r\n   * Style for the draw control (applies while the geometry is being drawn)\r\n   */\r\n  @Input()\r\n  set drawStyle(value: OlStyle) {\r\n    if (value === undefined) {\r\n      value = createDrawInteractionStyle();\r\n    }\r\n    this._drawStyle = value;\r\n\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value);\r\n    if (olGuideStyle !== undefined) {\r\n      this.defaultDrawStyleRadius = olGuideStyle.getImage().getRadius();\r\n    } else {\r\n      this.defaultDrawStyleRadius = null;\r\n    }\r\n    this.deactivateControl();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\r\n    this.toggleControl();\r\n  }\r\n  get drawStyle(): OlStyle { return this._drawStyle; }\r\n  private _drawStyle: OlStyle;\r\n\r\n  /**\r\n   * Style for the overlay layer (applies once the geometry is added to the map)\r\n   * If not specified, drawStyle applies\r\n   */\r\n  @Input()\r\n  set overlayStyle(value: OlStyle) { this._overlayStyle = value; }\r\n  get overlayStyle(): OlStyle { return this._overlayStyle; }\r\n  private _overlayStyle: OlStyle;\r\n\r\n  /**\r\n   * The geometry value (GeoJSON)\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  @Input()\r\n  set value(value: GeoJSONGeometry) {\r\n    this._value = value;\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n\r\n    if (value) {\r\n      this.addGeoJSONToOverlay(value);\r\n    } else {\r\n      this.olOverlaySource.clear(true);\r\n    }\r\n    this.onChange(value);\r\n    this.toggleControl();\r\n    this.cdRef.detectChanges();\r\n  }\r\n  get value(): GeoJSONGeometry { return this._value; }\r\n  private _value: GeoJSONGeometry;\r\n\r\n  /**\r\n   * The vector source to add the geometry to\r\n   * @internal\r\n   */\r\n  get olOverlaySource(): OlVectorSource {\r\n    return this.olOverlayLayer.getSource();\r\n  }\r\n\r\n  @Input()\r\n  set radius(value: any) {\r\n    if (this.ready === false) {\r\n      return;\r\n    }\r\n    if (this.modifyControl.getSource()) {\r\n      this.modifyControl.getSource().refresh();\r\n    }\r\n    if (this.freehandDrawIsActive) {\r\n      let olModify;\r\n      setTimeout(() => {\r\n        olModify = this.modifyControl.olModifyInteraction;\r\n        if (olModify) {\r\n          if (olModify.features_) {\r\n            olModify.features_.clear();\r\n          }\r\n        }\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    @Optional() @Self() public ngControl: NgControl\r\n  ) {\r\n    if (this.ngControl !== undefined) {\r\n      // Setting the value accessor directly (instead of using\r\n      // the providers) to avoid running into a circular import.\r\n      this.ngControl.valueAccessor = this;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an overlay layer, add the initial geometry to it (if any)\r\n   * and toggle the right interaction.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    if (this.drawStyle === undefined) {\r\n      this.drawStyle = createDrawInteractionStyle();\r\n    }\r\n\r\n    if (this.overlayStyle === undefined) {\r\n      this.overlayStyle = this.drawStyle;\r\n    }\r\n\r\n    this.addOlOverlayLayer();\r\n    this.createMeasureTooltip();\r\n    this.createDrawControl();\r\n    this.createModifyControl();\r\n\r\n    if (this.value) {\r\n      this.addGeoJSONToOverlay(this.value);\r\n    }\r\n    this.toggleControl();\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  /**\r\n   * Clear the overlay layer and any interaction added by this component.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    // This is mandatory when the form control is reused after\r\n    // this component has been destroyed. It seems like the control\r\n    // keeps a reference to this component even after it's destroyed\r\n    // and it attempts to set it's value\r\n    this.ready = false;\r\n\r\n    this.deactivateControl();\r\n    this.olOverlaySource.clear();\r\n    this.map.ol.removeLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  // tslint:disable-next-line:ban-types\r\n  registerOnChange(fn: Function) {\r\n    this.onChange = fn;\r\n  }\r\n  private onChange: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  // tslint:disable-next-line:ban-types\r\n  registerOnTouched(fn: Function) {\r\n    this.onTouched = fn;\r\n  }\r\n  private onTouched: any = () => {};\r\n\r\n  /**\r\n   * Implemented as part of ControlValueAccessor.\r\n   */\r\n  writeValue(value: GeoJSONGeometry) {\r\n    this.value = value;\r\n  }\r\n\r\n  /**\r\n   * Add an overlay layer to the map\r\n   */\r\n  private addOlOverlayLayer(): OlVectorLayer {\r\n    this.olOverlayLayer = new OlVectorLayer({\r\n      source: new OlVectorSource(),\r\n      zIndex: 500,\r\n      style: null\r\n    });\r\n    this.map.ol.addLayer(this.olOverlayLayer);\r\n  }\r\n\r\n  /**\r\n   * Create a draw control and subscribe to it's geometry\r\n   */\r\n  private createDrawControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      geometryType: this.geometryType || 'Point',\r\n      layer: this.olOverlayLayer,\r\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature, resolution: number) => {\r\n        const style = this.drawStyle;\r\n        this.updateDrawStyleWithDrawGuide(style, resolution);\r\n        return style;\r\n      }\r\n    });\r\n    this.drawControl = new DrawControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Create a modify control and subscribe to it's geometry\r\n   */\r\n  private createModifyControl() {\r\n    const controlOptions = Object.assign({}, this.controlOptions, {\r\n      layer: this.olOverlayLayer,\r\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature, resolution: number) => {\r\n        const style = this.drawStyle;\r\n        this.updateDrawStyleWithDrawGuide(style, resolution);\r\n        return style;\r\n      }\r\n    });\r\n    this.modifyControl = new ModifyControl(controlOptions);\r\n  }\r\n\r\n  /**\r\n   * Toggle the proper control (draw or modify)\r\n   */\r\n  private toggleControl() {\r\n    let activate;\r\n    if (!this.value && this.geometryType) {\r\n      activate = this.drawControl;\r\n    } else {\r\n      activate = this.modifyControl;\r\n    }\r\n\r\n    // If the control that should be activated\r\n    // is not the same as the current active control,\r\n    // deactivate the current control and activate the new one\r\n    // Otherwise, do nothing and keep the current control active\r\n    if (activate !== this.activeControl) {\r\n      this.deactivateControl();\r\n      this.activateControl(activate);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Activate a given control\r\n   * @param control Control\r\n   */\r\n  private activateControl(control: DrawControl | ModifyControl) {\r\n    this.activeControl = control;\r\n    this.olGeometryEnds$$ = control.end$\r\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\r\n    if (this.measure === true && control === this.drawControl) {\r\n      this.olGeometryChanges$$ = control.changes$\r\n        .subscribe((olGeometry: OlGeometry) => this.onOlGeometryChanges(olGeometry));\r\n    }\r\n    control.setOlMap(this.map.ol);\r\n  }\r\n\r\n  /**\r\n   * Deactivate the active control\r\n   */\r\n  private deactivateControl() {\r\n    this.removeMeasureTooltip();\r\n    if (this.activeControl !== undefined) {\r\n      this.activeControl.setOlMap(undefined);\r\n    }\r\n    if (this.olGeometryEnds$$ !== undefined) {\r\n      this.olGeometryEnds$$.unsubscribe();\r\n    }\r\n    if (this.olGeometryChanges$$ !== undefined) {\r\n      this.olGeometryChanges$$.unsubscribe();\r\n    }\r\n    this.activeControl = undefined;\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\r\n    this.removeMeasureTooltip();\r\n    this.setOlGeometry(olGeometry);\r\n  }\r\n\r\n  /**\r\n   * Update measures observables and map tooltips\r\n   * @param olGeometry Ol linestring or polygon\r\n   */\r\n  private onOlGeometryChanges(olGeometry: OlGeometry) {\r\n    if (olGeometry.getType() !== 'Point') {\r\n      this.updateMeasureTooltip(olGeometry);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * When drawing ends, convert the output value to GeoJSON and keep it.\r\n   * Restore the double click interaction.\r\n   * @param olGeometry OL geometry\r\n   */\r\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\r\n    let value;\r\n    if (olGeometry === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\r\n      olGeometry = this.circleToPoint(olGeometry);\r\n    }\r\n\r\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: 'EPSG:4326'\r\n    });\r\n    if (olGeometry.get('radius')) {\r\n      value.radius = olGeometry.get('radius');\r\n      olGeometry._radius = value.radius;\r\n    }\r\n    this.writeValue(value);\r\n  }\r\n\r\n  private circleToPoint(olGeometry) {\r\n    const center = olGeometry.getCenter();\r\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\r\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\r\n\r\n    // Convert it to a point object\r\n    olGeometry = new Point(center);\r\n    olGeometry.set('radius', radius, true);\r\n    return olGeometry;\r\n  }\r\n\r\n  /**\r\n   * Add a GeoJSON geometry to the overlay\r\n   * @param geometry GeoJSON geometry\r\n   */\r\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\r\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: this.map.projection\r\n    });\r\n    const olFeature = new OlFeature({\r\n      geometry: olGeometry\r\n    });\r\n    olFeature.setStyle(this.overlayStyle);\r\n    this.olOverlaySource.clear();\r\n    this.olOverlaySource.addFeature(olFeature);\r\n  }\r\n\r\n  /**\r\n   * Create the measure tooltip\r\n   */\r\n  private createMeasureTooltip(): OlOverlay {\r\n    this.olTooltip = new OlOverlay({\r\n      element: document.createElement('div'),\r\n      offset: [-30, -10],\r\n      className: [\r\n        'igo-map-tooltip',\r\n        'igo-map-tooltip-measure'\r\n      ].join(' '),\r\n      stopEvent: false\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update the measure tooltip of an OL geometry\r\n   * @param olGeometry OL Geometry\r\n   */\r\n  private updateMeasureTooltip(olGeometry: OlGeometry) {\r\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\r\n    const lengths = measure.lengths;\r\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\r\n    const lastLength = lengths[lastIndex];\r\n\r\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\r\n    const olLastMidpoint = olMidpoints[lastIndex];\r\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\r\n      this.removeMeasureTooltip();\r\n      return;\r\n    }\r\n\r\n    this.olTooltip.setPosition(olLastMidpoint.flatCoordinates);\r\n\r\n    const innerHtml = formatMeasure(lastLength, {\r\n      decimal: 1,\r\n      unit: MeasureLengthUnit.Meters,\r\n      unitAbbr: true,\r\n      locale: 'fr'\r\n    });\r\n    this.olTooltip.getElement().innerHTML = innerHtml;\r\n    if (this.olTooltip.getMap() === undefined) {\r\n      this.map.ol.addOverlay(this.olTooltip);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the measure tooltip from the map\r\n   */\r\n  private removeMeasureTooltip() {\r\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\r\n      this.map.ol.removeOverlay(this.olTooltip);\r\n      this.olTooltip.setMap(undefined);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adjust the draw style with the specified draw guide distance, if possible\r\n   * @param olStyle Draw style to update\r\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\r\n   */\r\n  private updateDrawStyleWithDrawGuide(olStyle: OlStyle, resolution: number) {\r\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle);\r\n    if (olGuideStyle === undefined) {\r\n      return;\r\n    }\r\n\r\n    const drawGuide = this.drawGuide;\r\n    let radius;\r\n    if (!drawGuide || drawGuide < 0) {\r\n      radius = this.defaultDrawStyleRadius;\r\n    } else {\r\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\r\n    }\r\n    olGuideStyle.getImage().setRadius(radius);\r\n  }\r\n\r\n  /**\r\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\r\n   * @param olStyle The style on which to perform the check\r\n   */\r\n  private isStyleWithRadius(olStyle: OlStyle): boolean {\r\n    return typeof olStyle !== 'function' && olStyle.getImage && olStyle.getImage().setRadius;\r\n  }\r\n\r\n  /**\r\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\r\n   * @param olStyle The style on which to perform the check\r\n   */\r\n  private getGuideStyleFromDrawStyle(olStyle: OlStyle |  OlStyle[]): OlStyle {\r\n    if (Array.isArray(olStyle)) {\r\n      olStyle = olStyle[0];\r\n    }\r\n    if (this.isStyleWithRadius(olStyle)) {\r\n      return olStyle;\r\n    }\r\n    return undefined;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport {\r\n  MatIconModule,\r\n  MatFormFieldModule,\r\n  MatInputModule,\r\n  MatButtonModule,\r\n  MatButtonToggleModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\r\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [\r\n    GeometryFormFieldComponent,\r\n    GeometryFormFieldInputComponent\r\n  ],\r\n  declarations: [\r\n    GeometryFormFieldComponent,\r\n    GeometryFormFieldInputComponent\r\n  ]\r\n})\r\nexport class IgoGeometryFormFieldModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\r\nimport { GeometryFormFieldComponent } from './geometry-form-field/geometry-form-field.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoGeometryFormFieldModule\r\n  ],\r\n  exports: [\r\n    IgoGeometryFormFieldModule\r\n  ],\r\n  declarations: [],\r\n  providers: [],\r\n  entryComponents: [\r\n    GeometryFormFieldComponent\r\n  ]\r\n})\r\nexport class IgoGeometryModule {}\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map';\r\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\r\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-button',\r\n  templateUrl: './time-filter-button.component.html',\r\n  styleUrls: ['./time-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterButtonComponent implements OnInit {\r\n\r\n  public options: TimeFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.timeFilter as any;\r\n    if (filter && filter.enabled) {\r\n      return 1;\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  public timeFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild\r\n} from '@angular/core';\r\nimport { MatSlider, DateAdapter } from '@angular/material';\r\nimport * as moment from 'moment';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\r\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-form',\r\n  templateUrl: './time-filter-form.component.html',\r\n  styleUrls: ['./time-filter-form.component.scss']\r\n})\r\nexport class TimeFilterFormComponent implements OnInit {\r\n  @Input() layer: Layer;\r\n\r\n  @Input() options: TimeFilterOptions;\r\n\r\n  public color = 'primary';\r\n  public date: Date;\r\n  public startDate: Date;\r\n  public endDate: Date;\r\n  public year: any;\r\n  public startYear: any;\r\n  public endYear: any;\r\n  public initStartYear: any;\r\n  public initEndYear: any;\r\n  public listYears: Array<string> = [];\r\n  public startListYears: Array<string> = [];\r\n  public endListYears: Array<string> = [];\r\n\r\n  @Input()\r\n  set currentValue(value: string) {\r\n    if (value) {\r\n      if (this.type !== TimeFilterType.YEAR) {\r\n        const valueArray = value.split('/');\r\n        if (valueArray.length > 0) {\r\n          const startDate = new Date(valueArray[0]);\r\n          const endDate = new Date(valueArray[1]);\r\n          if (!isNaN(startDate.valueOf())) {\r\n            this.startDate = startDate;\r\n          }\r\n          if (!isNaN(endDate.valueOf())) {\r\n            this.endDate = endDate;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public interval: any;\r\n  public playIcon = 'play-circle';\r\n  public resetIcon = 'replay';\r\n\r\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\r\n  @Output()\r\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\r\n  @ViewChild(MatSlider) mySlider;\r\n\r\n  get type(): TimeFilterType {\r\n    return this.options.type === undefined\r\n      ? TimeFilterType.DATE\r\n      : this.options.type;\r\n  }\r\n\r\n  get isRange(): boolean {\r\n    return this.options.range === undefined ||\r\n      this.options.style === TimeFilterStyle.SLIDER\r\n      ? false\r\n      : this.options.range;\r\n  }\r\n\r\n  get style(): TimeFilterStyle {\r\n    return this.options.style === undefined\r\n      ? TimeFilterStyle.SLIDER\r\n      : this.options.style;\r\n  }\r\n\r\n  get step(): number {\r\n    let step = 10800000;\r\n    if (this.options.step === undefined) {\r\n      switch (this.type) {\r\n        case TimeFilterType.DATE:\r\n        case TimeFilterType.DATETIME:\r\n          step = 10800000;\r\n          break;\r\n        case TimeFilterType.TIME:\r\n          step = 3600000;\r\n          break;\r\n        case TimeFilterType.YEAR:\r\n          step = 31536000000;\r\n          break;\r\n        default:\r\n          step = 10800000;\r\n      }\r\n    } else {\r\n      step = this.getStepDefinition(this.options.step);\r\n    }\r\n\r\n    return step;\r\n  }\r\n\r\n  get timeInterval(): number {\r\n    return this.options.timeInterval === undefined\r\n      ? 2000\r\n      : this.options.timeInterval;\r\n  }\r\n\r\n  get min(): Date {\r\n    if (this.options.min) {\r\n      const min = new Date(this.options.min);\r\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get max(): Date {\r\n    if (this.options.max) {\r\n      const max = new Date(this.options.max);\r\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  get is(): boolean {\r\n    return this.options.range === undefined ? false : this.options.range;\r\n  }\r\n\r\n  constructor(private dateAdapter: DateAdapter<Date>) {\r\n    this.dateAdapter.setLocale('fr');\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.startDate === undefined) {\r\n      this.startDate = new Date(this.min);\r\n    }\r\n    if (this.endDate === undefined) {\r\n      this.endDate = new Date(this.max);\r\n    }\r\n    if (this.startYear === undefined) {\r\n      this.startYear = new Date(this.startDate).getFullYear();\r\n      this.initStartYear = this.startYear;\r\n    }\r\n    if (this.endYear === undefined) {\r\n      this.endYear = new Date(this.endDate).getFullYear();\r\n      this.initEndYear = this.endYear;\r\n    }\r\n\r\n    if (!this.isRange) {\r\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\r\n        this.listYears.push(i);\r\n      }\r\n    } else {\r\n      for (let i = this.startYear; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n    }\r\n    this.options.enabled =\r\n      this.options.enabled === undefined ? true : this.options.enabled;\r\n    this.checkFilterValue();\r\n    if (this.options.enabled) {\r\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.storeCurrentFilterValue();\r\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  storeCurrentFilterValue() {\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.options.value = this.year.toString();\r\n    }\r\n  }\r\n\r\n  checkFilterValue() {\r\n    const timeFromWms = this.layer.dataSource.ol.getParams().TIME;\r\n    if (\r\n      !this.isRange &&\r\n      this.style === TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\r\n      } else if (this.options.value) {\r\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\r\n      } else {\r\n        this.year = new Date(this.min).getFullYear() + 1;\r\n      }\r\n    } else if (\r\n      this.isRange &&\r\n      this.style === TimeFilterStyle.CALENDAR &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      if (timeFromWms) {\r\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\r\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\r\n        const newStartListYears: any[] = [];\r\n        const newEndListYears: any[] = [];\r\n        for (let i = this.initStartYear; i < this.endYear; i++) {\r\n          newStartListYears.push(i);\r\n        }\r\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n          newEndListYears.push(i);\r\n        }\r\n        this.startListYears = newStartListYears;\r\n        this.endListYears = newEndListYears;\r\n      }\r\n    }\r\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n  }\r\n\r\n  handleDateChange(event: any) {\r\n    this.setupDateOutput();\r\n    this.applyTypeChange();\r\n\r\n    // Only if is range, use 2 dates to make the range\r\n    if (this.isRange) {\r\n      this.change.emit([this.startDate, this.endDate]);\r\n    } else {\r\n      this.change.emit(this.startDate);\r\n    }\r\n  }\r\n\r\n  handleYearChange(event: any) {\r\n    if (this.isRange) {\r\n      this.endListYears = [];\r\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\r\n        this.endListYears.push(i);\r\n      }\r\n      this.startListYears = [];\r\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\r\n        this.startListYears.push(i);\r\n      }\r\n      this.yearChange.emit([this.startYear, this.endYear]);\r\n    } else {\r\n      this.yearChange.emit(this.year);\r\n    }\r\n  }\r\n\r\n  handleListYearChange(event: any) {\r\n    this.handleYearChange([this.startYear, this.endYear]);\r\n  }\r\n\r\n  handleListYearStartChange(event: any) {\r\n    this.change.emit([this.startDate, this.endDate]);\r\n  }\r\n\r\n  dateToNumber(date: Date): number {\r\n    let newDate;\r\n    if (date) {\r\n      newDate = new Date(date);\r\n    } else {\r\n      newDate = new Date(this.min);\r\n    }\r\n\r\n    return newDate.getTime();\r\n  }\r\n\r\n  setSliderThumbLabel(label: string) {\r\n    const thumbLabel = this.findThumbLabel(\r\n      this.mySlider._elementRef.nativeElement.childNodes\r\n    );\r\n    if (thumbLabel) {\r\n      thumbLabel.textContent = label;\r\n    }\r\n  }\r\n\r\n  findThumbLabel(test: any[]): any {\r\n    let thumbLabel;\r\n\r\n    test.forEach(value => {\r\n      if (value.className === 'mat-slider-thumb-label-text') {\r\n        thumbLabel = value;\r\n      }\r\n\r\n      if (value.children.length > 0 && !thumbLabel) {\r\n        thumbLabel = this.findThumbLabel(value.childNodes);\r\n      }\r\n    }, this);\r\n    return thumbLabel;\r\n  }\r\n\r\n  toggleFilterState() {\r\n    this.options.enabled = !this.options.enabled;\r\n\r\n    if (this.options.enabled) {\r\n      if (\r\n        !this.isRange &&\r\n        TimeFilterStyle.SLIDER &&\r\n        this.type === TimeFilterType.YEAR\r\n      ) {\r\n        this.yearChange.emit(this.year);\r\n      }\r\n    } else {\r\n      this.stopFilter();\r\n      this.storeCurrentFilterValue();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  resetFilter(event: any) {\r\n    this.date = new Date(this.min);\r\n    this.year = this.date.getFullYear() + 1;\r\n    if (\r\n      !this.isRange &&\r\n      TimeFilterStyle.SLIDER &&\r\n      this.type === TimeFilterType.YEAR\r\n    ) {\r\n      this.yearChange.emit(this.year);\r\n    } else {\r\n      this.setupDateOutput();\r\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\r\n    }\r\n  }\r\n\r\n  playFilter(event: any) {\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        that => {\r\n          let newMinDateNumber;\r\n          const maxDateNumber = new Date(that.max);\r\n\r\n          newMinDateNumber =\r\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\r\n          newMinDateNumber += that.mySlider.step;\r\n          that.date = new Date(newMinDateNumber);\r\n\r\n          if (newMinDateNumber > maxDateNumber.getTime()) {\r\n            that.stopFilter();\r\n          }\r\n\r\n          that.handleDateChange({ value: that.date, date: that.date });\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  playYear(event: any) {\r\n    if (\r\n      this.year + this.mySlider.step >\r\n      this.max.getFullYear() + this.mySlider.step\r\n    ) {\r\n      this.stopFilter();\r\n      this.resetFilter(event);\r\n    }\r\n    if (this.interval) {\r\n      this.stopFilter();\r\n    } else {\r\n      this.playIcon = 'pause-circle';\r\n      this.interval = setInterval(\r\n        // tslint:disable-next-line:only-arrow-functions\r\n        function(that) {\r\n          that.year = that.year + that.mySlider.step;\r\n          if (that.year > that.max.getFullYear()) {\r\n            that.stopFilter();\r\n          }\r\n          that.yearChange.emit(that.year);\r\n        },\r\n        this.timeInterval,\r\n        this\r\n      );\r\n    }\r\n  }\r\n\r\n  stopFilter() {\r\n    if (this.interval) {\r\n      clearInterval(this.interval);\r\n    }\r\n    this.interval = undefined;\r\n    this.playIcon = 'play-circle';\r\n  }\r\n\r\n  handleSliderDateChange(event: any) {\r\n    this.date = new Date(event.value);\r\n    this.setSliderThumbLabel(this.handleSliderTooltip());\r\n    this.handleDateChange(event);\r\n  }\r\n\r\n  handleSliderYearChange(event: any) {\r\n    this.year = event.value;\r\n    this.yearChange.emit(this.year);\r\n  }\r\n\r\n  handleSliderValue(): number {\r\n    if (this.options.current === true || !this.min) {\r\n      const currentDate = new Date();\r\n      this.date = this.getRoundedDate(currentDate);\r\n    }\r\n    if (this.type === TimeFilterType.YEAR) {\r\n      return this.year;\r\n    } else {\r\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\r\n    }\r\n  }\r\n\r\n  handleSliderTooltip() {\r\n    let label: string;\r\n\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toDateString()\r\n            : this.date.toDateString();\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toTimeString()\r\n            : this.date.toTimeString();\r\n        break;\r\n      // datetime\r\n      default:\r\n        label =\r\n          this.date === undefined\r\n            ? this.min.toUTCString()\r\n            : this.date.toUTCString();\r\n        break;\r\n    }\r\n\r\n    return label;\r\n  }\r\n\r\n  setupDateOutput() {\r\n    if (this.style === TimeFilterStyle.SLIDER) {\r\n      this.startDate = new Date(this.date);\r\n      this.startDate.setSeconds(-(this.step / 1000));\r\n      this.endDate = new Date(this.startDate);\r\n      this.endDate.setSeconds(this.step / 1000);\r\n    } else if (!this.isRange && !!this.date) {\r\n      this.endDate = new Date(this.date);\r\n      this.startDate = new Date(this.date);\r\n    } else if (this.isRange && (!!this.date || !this.date)) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    } else if (!this.date) {\r\n      this.startDate =\r\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\r\n      this.endDate =\r\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\r\n    }\r\n  }\r\n\r\n  applyTypeChange() {\r\n    switch (this.type) {\r\n      case TimeFilterType.DATE:\r\n        if (this.startDate !== undefined || this.endDate !== undefined) {\r\n          this.startDate.setHours(0);\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setHours(23);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      case TimeFilterType.TIME:\r\n        if (this.style === TimeFilterStyle.CALENDAR) {\r\n          if (this.startDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.startDate.getHours();\r\n            const selectedMinute = this.startDate.getMinutes();\r\n            this.startDate = this.min;\r\n            this.startDate.setHours(selectedHour);\r\n            this.startDate.setMinutes(selectedMinute);\r\n          }\r\n\r\n          if (this.endDate.getDay() !== this.min.getDay()) {\r\n            const selectedHour = this.endDate.getHours();\r\n            const selectedMinute = this.endDate.getMinutes();\r\n            this.endDate = this.min;\r\n            this.endDate.setHours(selectedHour);\r\n            this.endDate.setMinutes(selectedMinute);\r\n          }\r\n        }\r\n\r\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\r\n          this.startDate.setMinutes(0);\r\n          this.startDate.setSeconds(0);\r\n          this.endDate.setMinutes(59);\r\n          this.endDate.setSeconds(59);\r\n        }\r\n        break;\r\n      // datetime\r\n      default:\r\n      // do nothing\r\n    }\r\n  }\r\n\r\n  getRangeMinDate(): Date {\r\n    return this.startDate === undefined ? this.min : this.startDate;\r\n  }\r\n\r\n  getRangeMaxDate(): Date {\r\n    return this.endDate === undefined ? this.max : this.endDate;\r\n  }\r\n\r\n  /**\r\n   * Round date at a certain time, 10 minutes by Default\r\n   * @param date - Date to Round\r\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\r\n   * @return the rounded date\r\n   */\r\n  getRoundedDate(date, atMinute = 10) {\r\n    const coeff = 1000 * 60 * atMinute;\r\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\r\n  }\r\n\r\n  /**\r\n   * Get the step (period) definition from the layer dimension tag\r\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\r\n   * @return the duration in milliseconds\r\n   */\r\n  getStepDefinition(step) {\r\n    return moment.duration(step).asMilliseconds();\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\r\nimport { TimeFilterService } from '../shared/time-filter.service';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-item',\r\n  templateUrl: './time-filter-item.component.html',\r\n  styleUrls: ['./time-filter-item.component.scss']\r\n})\r\nexport class TimeFilterItemComponent {\r\n  public color = 'primary';\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  filtersCollapsed: boolean = false;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  get datasource(): TimeFilterableDataSource {\r\n    return this.layer.dataSource as TimeFilterableDataSource;\r\n  }\r\n  constructor(private timeFilterService: TimeFilterService) {}\r\n\r\n  handleYearChange(year: string | [string, string]) {\r\n    this.timeFilterService.filterByYear(this.datasource, year);\r\n  }\r\n\r\n  handleDateChange(date: Date | [Date, Date]) {\r\n    this.timeFilterService.filterByDate(this.datasource, date);\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\n@Component({\r\n  selector: 'igo-time-filter-list',\r\n  templateUrl: './time-filter-list.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class TimeFilterListComponent {\r\n  @Input()\r\n  get layers(): Layer[] {\r\n    return this._layers;\r\n  }\r\n  set layers(value: Layer[]) {\r\n    this._layers = value;\r\n    this.cdRef.detectChanges();\r\n  }\r\n  private _layers: Layer[] = [];\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { TimeFilterListComponent } from './time-filter-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoTimeFilterListBinding]'\r\n})\r\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\r\n  private component: TimeFilterListComponent;\r\n  private layers$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: TimeFilterListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n\r\n    this.layers$$ = this.mapService.getMap().layers$.subscribe(layers => {\r\n      this.component.layers = layers;\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport * as olproj from 'ol/proj';\r\nimport olWKT from 'ol/format/WKT';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WktService {\r\n  constructor() {}\r\n\r\n  public wktToFeature(wkt, wktProj, featureProj) {\r\n    return new olWKT().readFeature(wkt, {\r\n      dataProjection: wktProj,\r\n      featureProjection: featureProj\r\n    });\r\n  }\r\n  public extentToWkt(epsgTO, extent, extentProj) {\r\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\r\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\r\n    const wktPoly = `POLYGON((\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]}))`;\r\n    const wktLine = `LINESTRING(\r\n      ${extent[0]} ${extent[1]},\r\n      ${extent[0]} ${extent[3]},\r\n      ${extent[2]} ${extent[3]},\r\n      ${extent[2]} ${extent[1]},\r\n      ${extent[0]} ${extent[1]})`;\r\n    const wktMultiPoints = `MULTIPOINT(\r\n        ${extent[0]} ${extent[1]},\r\n        ${extent[0]} ${extent[3]},\r\n        ${extent[2]} ${extent[3]},\r\n        ${extent[2]} ${extent[1]})`;\r\n    return {\r\n      wktPoly,\r\n      wktLine,\r\n      wktMultiPoints\r\n    };\r\n  }\r\n\r\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\r\n    const lproj = olproj.get(projection);\r\n    const units = lproj.getUnits();\r\n    const olUnits = ['ft', 'm', 'us-ft'];\r\n    if (olUnits.indexOf(units) !== -1) {\r\n      coordinateArray = this.roundArray(coordinateArray, decimal);\r\n    }\r\n    return coordinateArray;\r\n  }\r\n\r\n  private roundArray(array, decimal = 0) {\r\n    let x = 0;\r\n    while (x < array.length) {\r\n      array[x] = array[x].toFixed(decimal);\r\n      x++;\r\n    }\r\n    return array;\r\n  }\r\n\r\n  public snrcToWkt(snrc, epsgTO) {\r\n    snrc = snrc.toLowerCase();\r\n    let wktPoly;\r\n    const ew = {\r\n      1: { from: -56, to: -64 },\r\n      2: { from: -64, to: -72 },\r\n      3: { from: -72, to: -80 },\r\n      4: { from: -80, to: -88 },\r\n      5: { from: -88, to: -96 },\r\n      6: { from: -96, to: -104 },\r\n      7: { from: -104, to: -112 },\r\n      8: { from: -112, to: -120 },\r\n      9: { from: -120, to: -128 },\r\n      10: { from: -128, to: -136 }\r\n    };\r\n    const sn = {\r\n      1: { from: 44, to: 48 },\r\n      2: { from: 48, to: 52 },\r\n      3: { from: 52, to: 56 },\r\n      4: { from: 56, to: 60 },\r\n      5: { from: 60, to: 64 },\r\n      6: { from: 64, to: 68 },\r\n      7: { from: 68, to: 72 },\r\n      8: { from: 72, to: 76 },\r\n      9: { from: 76, to: -128 }\r\n    };\r\n    const snrc250kIndex = [\r\n      ['m', 'n', 'o', 'p'],\r\n      ['l', 'k', 'j', 'i'],\r\n      ['e', 'f', 'g', 'h'],\r\n      ['d', 'c', 'b', 'a']\r\n    ];\r\n\r\n    const snrc50kIndex = [\r\n      ['13', '14', '15', '16'],\r\n      ['12', '11', '10', '09'],\r\n      ['05', '06', '07', '08'],\r\n      ['04', '03', '02', '01']\r\n    ];\r\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\r\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\r\n    const checkSNRC1m = /\\d{2,3}/gi;\r\n\r\n    let snrc1m = false;\r\n    let snrc250k = false;\r\n    let snrc50k = false;\r\n\r\n    if (checkSNRC50k.test(snrc)) {\r\n      snrc50k = true;\r\n    } else {\r\n      if (checkSNRC250k.test(snrc)) {\r\n        snrc250k = true;\r\n      } else {\r\n        if (checkSNRC1m.test(snrc)) {\r\n          snrc1m = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (snrc1m) {\r\n      snrc += 'a01';\r\n    } else if (snrc250k) {\r\n      snrc += '01';\r\n    }\r\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\r\n      const regex1m = /(?=[a-p])/gi;\r\n      const ar1m = snrc.split(regex1m);\r\n      const part1m = ar1m[0];\r\n      const part250k = ar1m[1][0];\r\n      const part50k = ar1m[1].split(part250k)[1];\r\n      let separator = 1;\r\n      if (part1m.length === 3) {\r\n        separator = 2;\r\n      }\r\n      const partEW = part1m.substring(0, separator);\r\n      const partSN = part1m.substring(separator);\r\n      const unit1mEW = 8;\r\n      const unit1mSN = 4;\r\n      const unit250kEW = 2;\r\n      const unit250kSN = 1;\r\n      const unit50kEW = 0.5;\r\n      const unit50kSN = 0.25;\r\n      let index250kEW = 0;\r\n      let index250kSN = 0;\r\n      let index50kEW = 0;\r\n      let index50kSN = 0;\r\n      snrc250kIndex.forEach(element => {\r\n        if (element.indexOf(part250k) !== -1) {\r\n          index250kSN = snrc250kIndex.indexOf(element);\r\n          index250kEW = element.indexOf(part250k);\r\n        }\r\n      });\r\n      snrc50kIndex.forEach(element => {\r\n        if (element.indexOf(part50k) !== -1) {\r\n          index50kSN = snrc50kIndex.indexOf(element);\r\n          index50kEW = element.indexOf(part50k);\r\n        }\r\n      });\r\n\r\n      let increment250kEW = 0;\r\n      let increment250kSN = 0;\r\n      let increment50kEW = 0;\r\n      let increment50kSN = 0;\r\n      let unitPerTypeEW = unit1mEW;\r\n      let unitPerTypeSN = unit1mSN;\r\n      if (snrc250k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = 0;\r\n        increment50kSN = 0;\r\n        unitPerTypeEW = unit250kEW;\r\n        unitPerTypeSN = unit250kSN;\r\n      } else if (snrc50k) {\r\n        increment250kEW = index250kEW * unit250kEW;\r\n        increment250kSN = index250kSN * unit250kSN;\r\n        increment50kEW = index50kEW * unit50kEW;\r\n        increment50kSN = index50kSN * unit50kSN;\r\n        unitPerTypeEW = unit50kEW;\r\n        unitPerTypeSN = unit50kSN;\r\n      }\r\n\r\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\r\n        ul: [\r\n          ew[partEW].to + increment250kEW + increment50kEW,\r\n          sn[partSN].to - increment250kSN - increment50kSN\r\n        ]\r\n      };\r\n\r\n      coord.lr = [\r\n        coord.ul[0] + unitPerTypeEW,\r\n        coord.ul[1] - unitPerTypeSN\r\n      ];\r\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\r\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\r\n\r\n      coord.ul = olproj.transform(\r\n        [coord.ul[0], coord.ul[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.lr = olproj.transform(\r\n        [coord.lr[0], coord.lr[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ur = olproj.transform(\r\n        [coord.ur[0], coord.ur[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n      coord.ll = olproj.transform(\r\n        [coord.ll[0], coord.ll[1]],\r\n        'EPSG:4326',\r\n        epsgTO\r\n      );\r\n\r\n      // Rounded coordinate to shorten url in get\r\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\r\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\r\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\r\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\r\n\r\n      wktPoly =\r\n        'POLYGON((' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        '))';\r\n      const wktLine =\r\n        'LINESTRING(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' '),\r\n          coord.ul.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n\r\n      const wktMultiPoints =\r\n        'MULTIPOINT(' +\r\n        [\r\n          coord.ul.join(' '),\r\n          coord.ur.join(' '),\r\n          coord.lr.join(' '),\r\n          coord.ll.join(' ')\r\n        ].join(',') +\r\n        ')';\r\n      return {\r\n        wktPoly,\r\n        wktLine,\r\n        wktMultiPoints\r\n      };\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport {\r\n  OgcInterfaceFilterOptions,\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { WktService } from '../../wkt/shared/wkt.service';\r\nimport { IgoMap } from '../../map';\r\nimport { FloatLabelType } from '@angular/material';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-form',\r\n  templateUrl: './ogc-filter-form.component.html',\r\n  styleUrls: ['./ogc-filter-form.component.scss']\r\n})\r\nexport class OgcFilterFormComponent implements OnInit {\r\n  public allOgcFilterOperators;\r\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(undefined);\r\n  public igoSpatialSelectors;\r\n  public value = '';\r\n  public inputOperator;\r\n  // public fields: any[];\r\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\r\n  public values: any[];\r\n  public color = 'primary';\r\n  public snrc = '';\r\n  public disabled;\r\n  public baseOverlayName = 'ogcFilterOverlay_';\r\n  public currentFilter$ = new BehaviorSubject<any>(undefined);\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  set currentFilter(currentFilter: any) {\r\n    this.currentFilter$.next(currentFilter);\r\n  }\r\n  get currentFilter(): any {\r\n    return this.currentFilter$.value;\r\n  }\r\n\r\n  @Input() floatLabel: FloatLabelType = 'never';\r\n\r\n  get activeFilters() {\r\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\r\n      f => f.active === true\r\n    );\r\n  }\r\n\r\n  constructor(\r\n    private wktService: WktService\r\n  ) {\r\n    // TODO: Filter permitted operator based on wfscapabilities\r\n    // Need to work on regex on XML capabilities because\r\n    // comaparison operator's name varies between WFS servers...\r\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\r\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\r\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\r\n    this.igoSpatialSelectors = [\r\n      {\r\n        type: 'fixedExtent'\r\n      },\r\n      {\r\n        type: 'snrc'\r\n      }\r\n    ];\r\n    // TODO: selectFeature & drawFeature\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.updateField();\r\n  }\r\n\r\n  updateField() {\r\n    if (!this.datasource.options.sourceFields) {\r\n      return;\r\n    }\r\n    const fields = this.datasource.options.sourceFields\r\n      .filter(sf => (sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters));\r\n    fields.filter(f => f.name === this.currentFilter.propertyName)\r\n      .forEach(element => {\r\n        this.values = element.values !== undefined ? element.values.sort() : [];\r\n      });\r\n\r\n    this.fields$.next(fields);\r\n    const allowedOperators = new OgcFilterWriter().computeAllowedOperators(\r\n      fields,\r\n      this.currentFilter.propertyName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType);\r\n    this.ogcFilterOperators$.next(allowedOperators);\r\n    if (Object.keys(allowedOperators).indexOf(this.currentFilter$.value.operator) === -1) {\r\n      this.currentFilter$.value.operator = Object.keys(allowedOperators)[0];\r\n    }\r\n    this.refreshFilters();\r\n  }\r\n\r\n  toggleFilterState(event, filter: OgcInterfaceFilterOptions, property) {\r\n    this.updateField();\r\n    if (event.checked) {\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters\r\n        .filter(f => f.filterid === filter.filterid)\r\n        .forEach(element => {\r\n          element[property] = true;\r\n        });\r\n    } else {\r\n      this.removeOverlayByID(filter.filterid);\r\n      this.datasource.options.ogcFilters.interfaceOgcFilters\r\n        .filter(f => f.filterid === filter.filterid)\r\n        .forEach(element => {\r\n          element[property] = false;\r\n        });\r\n    }\r\n    this.refreshFilters();\r\n  }\r\n\r\n  deleteFilter(filter: OgcInterfaceFilterOptions) {\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\r\n      f => f.filterid !== filter.filterid\r\n    );\r\n    this.removeOverlayByID(filter.filterid);\r\n\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeNumericProperty(filter: OgcInterfaceFilterOptions, property, value) {\r\n    this.changeProperty(filter, property, parseFloat(value));\r\n    this.refreshFilters();\r\n  }\r\n\r\n  private removeOverlayByID(id) {\r\n    const overlayId = this.baseOverlayName + id;\r\n    if (this.map.overlay.dataSource.ol.getFeatureById(overlayId)) {\r\n      this.map.overlay.dataSource.ol.removeFeature(\r\n        this.map.overlay.dataSource.ol.getFeatureById(overlayId)\r\n      );\r\n    }\r\n  }\r\n\r\n  changeOperator(filter) {\r\n    if (this.ogcFilterOperators$.value[filter.operator].spatial === false) {\r\n      this.removeOverlayByID(filter.filterid);\r\n    }\r\n    this.refreshFilters();\r\n  }\r\n\r\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\r\n  // Due to this issue, the checkbox is hide.\r\n  changeCaseSensitive(matchCase) {\r\n    this.currentFilter.matchCase = matchCase.checked;\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeProperty(filter: OgcInterfaceFilterOptions, property, value) {\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters\r\n      .filter(f => f.filterid === filter.filterid)\r\n      .forEach(element => {\r\n        element[property] = value;\r\n      });\r\n    this.refreshFilters();\r\n  }\r\n\r\n  changeGeometry(filter, value?) {\r\n    const checkSNRC50k = /\\d{2,3}[a-l][0,1][0-9]/gi;\r\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\r\n    const checkSNRC1m = /\\d{2,3}/gi;\r\n    const mapProjection = this.map.projection;\r\n    this.removeOverlayByID(filter.filterid);\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters\r\n      .filter(f => f.filterid === filter.filterid)\r\n      .forEach(element => {\r\n        let wktPoly;\r\n        if (filter.igoSpatialSelector === 'snrc') {\r\n          if (value === '' && this.snrc !== '') {\r\n            wktPoly = this.wktService.snrcToWkt(this.snrc, this.map.projection).wktPoly;\r\n            element.wkt_geometry = wktPoly;\r\n          } else if (\r\n            value !== '' &&\r\n            (checkSNRC1m.test(value) ||\r\n              checkSNRC250k.test(value) ||\r\n              checkSNRC50k.test(value))\r\n          ) {\r\n            wktPoly = this.wktService.snrcToWkt(value, this.map.projection).wktPoly;\r\n            element.wkt_geometry = wktPoly;\r\n          }\r\n        } else if (filter.igoSpatialSelector === 'fixedExtent') {\r\n          wktPoly = this.wktService.extentToWkt(\r\n            mapProjection,\r\n            this.map.viewController.getExtent(),\r\n            mapProjection\r\n          ).wktPoly;\r\n          element.wkt_geometry = wktPoly;\r\n        }\r\n      });\r\n    this.refreshFilters();\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\r\nimport { IgoMap } from '../../map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-form',\r\n  templateUrl: './ogc-filterable-form.component.html'\r\n})\r\nexport class OgcFilterableFormComponent {\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters;\r\n  }\r\n\r\n  get advancedOgcFilters(): boolean {\r\n    if (this.datasource.options.ogcFilters) {\r\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n    }\r\n    return;\r\n  }\r\n\r\n  public color = 'primary';\r\n\r\n  constructor() {}\r\n}\r\n","import { Component, Input, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { DownloadService } from '../../download/shared/download.service';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  OgcFiltersOptions,\r\n  OgcInterfaceFilterOptions\r\n} from '../shared/ogc-filter.interface';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\nimport { IgoMap } from '../../map';\r\nimport { OgcFilterWriter } from '../shared/ogc-filter';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-item',\r\n  templateUrl: './ogc-filterable-item.component.html',\r\n  styleUrls: ['./ogc-filterable-item.component.scss']\r\n})\r\nexport class OgcFilterableItemComponent implements OnInit {\r\n  public color = 'primary';\r\n  private lastRunOgcFilter;\r\n  private defaultLogicalParent = 'And';\r\n  public hasActiveSpatialFilter = false;\r\n  public filtersAreEditable = true;\r\n  public filtersCollapsed = true;\r\n  public hasPushButton: boolean = false;\r\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private ogcFilterWriter;\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() header: boolean = true;\r\n\r\n  get refreshFunc() {\r\n    return this.refreshFilters.bind(this);\r\n  }\r\n\r\n  get datasource(): OgcFilterableDataSource {\r\n    return this.layer.dataSource as OgcFilterableDataSource;\r\n  }\r\n\r\n  get downloadable() {\r\n    return (this.datasource.options as any).download;\r\n  }\r\n\r\n  constructor(\r\n    private ogcFilterService: OGCFilterService,\r\n    private downloadService: DownloadService\r\n  ) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n  }\r\n\r\n  ngOnInit() {\r\n    const ogcFilters = this.datasource.options.ogcFilters;\r\n    if (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) {\r\n      if (ogcFilters.advancedOgcFilters === undefined) {\r\n        ogcFilters.advancedOgcFilters = false;\r\n      }\r\n      this.hasPushButton = true;\r\n    }\r\n\r\n    switch (this.datasource.options.type) {\r\n      case 'wms':\r\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\r\n        break;\r\n      case 'wfs':\r\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (ogcFilters) {\r\n      if (ogcFilters.interfaceOgcFilters) {\r\n        this.lastRunOgcFilter = JSON.parse(\r\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\r\n        );\r\n        if (\r\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\r\n        ) {\r\n          this.hasActiveSpatialFilter = true;\r\n        }\r\n      }\r\n\r\n      this.filtersAreEditable = ogcFilters.editable\r\n        ? ogcFilters.editable\r\n        : false;\r\n    }\r\n  }\r\n\r\n  addFilterToSequence() {\r\n    this.filtersCollapsed = false;\r\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\r\n      .options.ogcFilters.interfaceOgcFilters;\r\n    const arr = interfaceOgcFilters || [];\r\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\r\n    let firstFieldName = '';\r\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\r\n    if (includedFields.length > 0) {\r\n      firstFieldName =\r\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\r\n    }\r\n    let fieldNameGeometry;\r\n    const datasourceOptions = this.datasource\r\n      .options as WFSDataSourceOptionsParams;\r\n    if (datasourceOptions.fieldNameGeometry) {\r\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\r\n    } else if (\r\n      (this.datasource.options as any).paramsWFS &&\r\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\r\n    ) {\r\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\r\n        .fieldNameGeometry;\r\n    }\r\n    const status = arr.length === 0 ? true : false;\r\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\r\n      this.datasource.options.sourceFields,\r\n      firstFieldName,\r\n      this.datasource.options.ogcFilters.allowedOperatorsType);\r\n    const firstOperatorName = Object.keys(allowedOperators)[0];\r\n\r\n    arr.push(\r\n      this.ogcFilterWriter.addInterfaceFilter(\r\n        {\r\n          propertyName: firstFieldName,\r\n          operator: firstOperatorName,\r\n          active: status,\r\n          igoSpatialSelector: 'fixedExtent',\r\n          srsName: this.map.projection,\r\n        } as OgcInterfaceFilterOptions,\r\n        fieldNameGeometry,\r\n        lastLevel,\r\n        this.defaultLogicalParent\r\n      )\r\n    );\r\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\r\n  }\r\n\r\n  openDownload() {\r\n    this.downloadService.open(this.layer);\r\n  }\r\n\r\n  refreshFilters(force?: boolean) {\r\n    if (force === true) {\r\n      this.lastRunOgcFilter = undefined;\r\n    }\r\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\r\n    const activeFilters = ogcFilters.interfaceOgcFilters.filter(\r\n      f => f.active === true\r\n    );\r\n    if (activeFilters.length === 0) {\r\n      ogcFilters.filters = undefined;\r\n      ogcFilters.filtered = false;\r\n    }\r\n    if (activeFilters.length > 1) {\r\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\r\n    }\r\n    if (\r\n      activeFilters.filter(\r\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\r\n      ).length === 0\r\n    ) {\r\n      this.hasActiveSpatialFilter = false;\r\n    } else {\r\n      this.hasActiveSpatialFilter = true;\r\n    }\r\n\r\n    if (\r\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\r\n    ) {\r\n      if (this.layer.dataSource.options.type === 'wfs') {\r\n        const ogcDataSource: any = this.layer.dataSource;\r\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n          activeFilters\r\n        );\r\n        this.layer.dataSource.ol.clear();\r\n      } else if (\r\n        this.layer.dataSource.options.type === 'wms' &&\r\n        ogcFilters.enabled\r\n      ) {\r\n        let rebuildFilter = '';\r\n        if (activeFilters.length >= 1) {\r\n          const ogcDataSource: any = this.layer.dataSource;\r\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\r\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\r\n            activeFilters\r\n          );\r\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\r\n            ogcLayer.filters,\r\n            undefined,\r\n            undefined,\r\n            (this.layer.dataSource.options as any).fieldNameGeometry\r\n          );\r\n        }\r\n        this.ogcFilterService.filterByOgc(\r\n          this.datasource as WMSDataSource,\r\n          rebuildFilter\r\n        );\r\n        this.datasource.options.ogcFilters.filtered =\r\n          activeFilters.length === 0 ? false : true;\r\n      }\r\n\r\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\r\n    } else {\r\n      // identical filter. Nothing triggered\r\n    }\r\n  }\r\n\r\n  public setVisible() {\r\n    this.layer.visible = true;\r\n  }\r\n\r\n  public isAdvancedOgcFilters(): boolean {\r\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\r\n  }\r\n\r\n  public addFilterDisabled(): boolean {\r\n    return (\r\n      !this.datasource.options.sourceFields ||\r\n      this.datasource.options.sourceFields.length === 0\r\n    );\r\n  }\r\n\r\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\r\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\r\n  }\r\n\r\n  changeOgcFilterType(isAdvancedOgcFilters) {\r\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\r\n    if (isAdvancedOgcFilters.checked) {\r\n      this.refreshFilters(true);\r\n    }\r\n  }\r\n\r\n  private toggleLegend(collapsed: boolean) {\r\n    this.layer.legendCollapsed = collapsed;\r\n    this.showLegend$.next(!collapsed);\r\n  }\r\n\r\n  toggleLegendOnClick() {\r\n    if (!this.filtersCollapsed) {\r\n      this.toggleLegend(this.showLegend$.value);\r\n    }\r\n  }\r\n\r\n  toggleFiltersCollapsed() {\r\n    this.filtersCollapsed = !this.filtersCollapsed;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filterable-list',\r\n  templateUrl: './ogc-filterable-list.component.html',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterableListComponent {\r\n\r\n  @Input() layers: Layer[];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  constructor() {}\r\n}\r\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapService } from '../../map/shared/map.service';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\r\n\r\n@Directive({\r\n  selector: '[igoOgcFilterableListBinding]'\r\n})\r\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\r\n  private component: OgcFilterableListComponent;\r\n  private layers$$: Subscription;\r\n\r\n  constructor(\r\n    @Self() component: OgcFilterableListComponent,\r\n    private mapService: MapService\r\n  ) {\r\n    this.component = component;\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Override input layers\r\n    this.component.layers = [];\r\n\r\n    this.layers$$ = this.mapService.getMap().layers$.subscribe(layers => {\r\n      this.component.layers = layers;\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../map';\r\nimport { OgcFilterableDataSourceOptions, IgoPushButton, OgcFiltersOptions } from '../shared/ogc-filter.interface';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-button',\r\n  templateUrl: './ogc-filter-button.component.html',\r\n  styleUrls: ['./ogc-filter-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterButtonComponent implements OnInit {\r\n\r\n  public options: OgcFilterableDataSourceOptions;\r\n\r\n  get badge() {\r\n    const filter = this.options.ogcFilters as any;\r\n    if (filter && !filter.advancedOgcFilters) {\r\n      if (filter.pushButtons) {\r\n        const pushButtons = filter.pushButtons as IgoPushButton;\r\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\r\n        let cntPushButtons = 0;\r\n        if (currentPushButtonGroup) {\r\n          currentPushButtonGroup.computedButtons.map(cb => cntPushButtons += cb.buttons.filter(button => button.enabled).length);\r\n        }\r\n        return cntPushButtons > 0 ? cntPushButtons : undefined;\r\n      } else {\r\n        return;\r\n      }\r\n    } else if (filter && filter.filters && !filter.filters.filters) {\r\n      return 1;\r\n    } else if (filter && filter.filters && filter.filters.filters) {\r\n      return filter.filters.filters.length;\r\n    }\r\n  }\r\n\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n    if (value) {\r\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\r\n    }\r\n  }\r\n  private _layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() color: string = 'primary';\r\n\r\n  @Input() header: boolean;\r\n\r\n  public ogcFilterCollapse = false;\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit\r\n} from '@angular/core';\r\n\r\nimport {\r\n  OgcFilterableDataSource,\r\n  IgoOgcFilterObject,\r\n  OgcPushButton,\r\n  OgcPushButtonBundle,\r\n  PushButtonGroup\r\n\r\n} from '../../filter/shared/ogc-filter.interface';\r\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\r\nimport { IgoMap } from '../../map';\r\nimport { OGCFilterService } from '../shared/ogc-filter.service';\r\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter-toggle-button',\r\n  templateUrl: './ogc-filter-toggle-button.component.html',\r\n  styleUrls: ['./ogc-filter-toggle-button.component.scss']\r\n})\r\nexport class OgcFilterToggleButtonComponent implements OnInit {\r\n\r\n  @Input() refreshFilters: () => void;\r\n\r\n  @Input() datasource: OgcFilterableDataSource;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  private ogcFilterWriter: OgcFilterWriter;\r\n  public color = 'primary';\r\n  public currentPushButtonGroup;\r\n\r\n  constructor(\r\n    private ogcFilterService: OGCFilterService\r\n  ) {\r\n    this.ogcFilterWriter = new OgcFilterWriter();\r\n  }\r\n\r\n  getPushButtonsGroups(): PushButtonGroup[] {\r\n    return this.datasource.options.ogcFilters.pushButtons.groups;\r\n  }\r\n\r\n  ngOnInit() {\r\n    if (this.datasource.options.ogcFilters &&\r\n      this.datasource.options.ogcFilters.pushButtons) {\r\n      this.currentPushButtonGroup =\r\n        this.datasource.options.ogcFilters.pushButtons.groups.find(g => g.enabled) ||\r\n        this.datasource.options.ogcFilters.pushButtons.groups[0];\r\n    }\r\n    this.applyFilters();\r\n  }\r\n\r\n  getToolTip(pb: OgcPushButton): string  {\r\n    let tt;\r\n    if (pb.tooltip) {\r\n      if (Array.isArray(pb.tooltip)) {\r\n        tt = pb.tooltip.join('\\n');\r\n      } else {\r\n        tt = pb.tooltip;\r\n      }\r\n    }\r\n    return tt || '';\r\n  }\r\n\r\n  getButtonColor(pb: OgcPushButton): {} {\r\n\r\n    let styles;\r\n    if (pb.color) {\r\n      styles = {\r\n        'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`,\r\n\r\n      };\r\n    }\r\n    return styles;\r\n  }\r\n\r\n  bundleIsVertical(bundle: OgcPushButtonBundle): boolean {\r\n    return bundle.vertical ? bundle.vertical : false;\r\n  }\r\n\r\n  onChangeGroup() {\r\n\r\n    this.getPushButtonsGroups().map(g => g.enabled = false);\r\n    this.getPushButtonsGroups().find(g => g === this.currentPushButtonGroup).enabled = true;\r\n    this.applyFilters();\r\n  }\r\n\r\n  applyFilters(currentOgcPushButton?: OgcPushButton) {\r\n    if (currentOgcPushButton) {\r\n      currentOgcPushButton.enabled = !currentOgcPushButton.enabled;\r\n    }\r\n    let filterQueryString = '';\r\n    const conditions = [];\r\n    this.currentPushButtonGroup.computedButtons.map(buttonBundle => {\r\n      const bundleCondition = [];\r\n      buttonBundle.buttons\r\n      .filter(ogcpb => ogcpb.enabled === true)\r\n      .forEach(enabledPb => bundleCondition.push(enabledPb.filters));\r\n      if (bundleCondition.length >= 1 ) {\r\n        if (bundleCondition.length === 1) {\r\n          conditions.push(bundleCondition[0]);\r\n        } else {\r\n          conditions.push({logical: buttonBundle.logical, filters: bundleCondition});\r\n        }\r\n      }\r\n    });\r\n    if (conditions.length >= 1) {\r\n      filterQueryString = this.ogcFilterWriter\r\n        .buildFilter(conditions.length === 1 ?\r\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\r\n    }\r\n    if (this.datasource.options.type === 'wms') {\r\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\r\n    }\r\n    if (this.datasource.options.type === 'wfs') {\r\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\r\n      this.datasource.ol.clear();\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\r\nimport { FormControl } from '@angular/forms';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Feature } from '../../../feature';\r\n\r\n/**\r\n * Spatial Filter Type\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-type',\r\n  templateUrl: './spatial-filter-type.component.html',\r\n  styleUrls: ['./spatial-filter-type.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterTypeComponent implements OnInit {\r\n\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\r\n  public selectedTypeIndex = new FormControl(0);\r\n\r\n  /**\r\n   * Reference to the SpatialFIlterType enum\r\n   * @internal\r\n   */\r\n  public spatialType = SpatialFilterType;\r\n\r\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\r\n\r\n  @Input() selectedQueryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  public type: SpatialFilterType;\r\n\r\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\r\n\r\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n\r\n  constructor() {}\r\n\r\n  ngOnInit() {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = this.spatialType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onTypeChange(event) {\r\n    if (this.selectedTypeIndex.value === 0) {\r\n      this.type = SpatialFilterType.Predefined;\r\n    }\r\n    if (this.selectedTypeIndex.value === 1) {\r\n      this.type = this.activeDrawType;\r\n    }\r\n    this.eventType.emit(this.type);\r\n  }\r\n\r\n  onQueryTypeChange(event) {\r\n    this.eventQueryType.emit(this.selectedQueryType);\r\n  }\r\n\r\n  onZoneChange(feature) {\r\n    this.zoneChange.emit(feature);\r\n  }\r\n\r\n  onDrawTypeChange(spatialType: SpatialFilterType) {\r\n    this.activeDrawType = spatialType;\r\n    this.eventType.emit(this.activeDrawType);\r\n  }\r\n}\r\n","import { EntityStore } from '@igo2/common';\r\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\r\nimport { SpatialFilterQueryType } from './../../shared/spatial-filter.enum';\r\nimport {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { FormControl } from '@angular/forms';\r\nimport { Feature } from '../../../feature';\r\n\r\n@Component({\r\n  selector: 'igo-spatial-filter-list',\r\n  templateUrl: './spatial-filter-list.component.html',\r\n  styleUrls: ['./spatial-filter-list.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\r\n\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  @Input()\r\n  get queryType(): SpatialFilterQueryType {\r\n    return this._queryType;\r\n  }\r\n  set queryType(queryType: SpatialFilterQueryType) {\r\n    this.formControl.setValue('');\r\n    this._queryType = queryType;\r\n  }\r\n  private _queryType: SpatialFilterQueryType;\r\n\r\n  @Input() selectedZone: Feature;\r\n\r\n  public formControl = new FormControl();\r\n\r\n  @Output() zoneChange = new EventEmitter<Feature>();\r\n\r\n  formValueChanges$$: Subscription;\r\n\r\n  ngOnInit() {\r\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\r\n      if (value.length) {\r\n        this.store.view.filter((feature) => {\r\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n          return featureNameNormalized.includes(filterNormalized);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.formValueChanges$$.unsubscribe();\r\n  }\r\n\r\n  displayFn(feature?: Feature): string | undefined {\r\n    return feature ? feature.properties.nom : undefined;\r\n  }\r\n\r\n  constructor(private spatialFilterService: SpatialFilterService) {}\r\n\r\n  onZoneChange(feature) {\r\n    if (feature && this.queryType) {\r\n      this.spatialFilterService.loadItemById(feature, this.queryType)\r\n      .subscribe((featureGeom: Feature) => {\r\n        this.selectedZone = featureGeom;\r\n        this.zoneChange.emit(featureGeom);\r\n      });\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  OnInit\r\n} from '@angular/core';\r\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\r\nimport { SelectionModel } from '@angular/cdk/collections';\r\nimport { IgoMap } from '../../../map';\r\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\r\nimport { Feature } from './../../../feature/shared/feature.interfaces';\r\nimport { FormControl } from '@angular/forms';\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport OlGeometryType from 'ol/geom/GeometryType';\r\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\r\nimport { Style as OlStyle } from 'ol/style';\r\nimport * as olstyle from 'ol/style';\r\nimport * as olproj from 'ol/proj';\r\nimport { olFeature } from 'ol/Feature';\r\nimport { MatTreeNestedDataSource } from '@angular/material';\r\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\r\nimport { MeasureLengthUnit } from '../../../measure';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { Layer } from '../../../layer/shared';\r\nimport { NestedTreeControl } from '@angular/cdk/tree';\r\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\n\r\n/**\r\n * Spatial-Filter-Item (search parameters)\r\n */\r\n@Component({\r\n  selector: 'igo-spatial-filter-item',\r\n  templateUrl: './spatial-filter-item.component.html',\r\n  styleUrls: ['./spatial-filter-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get type(): SpatialFilterType {\r\n    return this._type;\r\n  }\r\n  set type(type: SpatialFilterType) {\r\n    this._type = type;\r\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\r\n    this.geometryType = this.geometryTypes[index];\r\n    this.formControl.reset();\r\n    this.radius = undefined;\r\n    this.drawGuide$.next(null);\r\n    this.drawStyle$.next(undefined);\r\n\r\n    // Necessary to keep reference to the geometry form field input\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      const geojson: GeoJSONGeometry = {\r\n        type: 'Point',\r\n        coordinates: ''\r\n      };\r\n      this.formControl.setValue(geojson);\r\n    }\r\n\r\n    // Necessary to apply the right style when geometry type is Point\r\n    if (this.type === SpatialFilterType.Point) {\r\n      this.radius = 1000; // Base radius\r\n      this.radiusFormControl.setValue(this.radius);\r\n      this.PointStyle = (feature: olFeature, resolution: number) => {\r\n        const coordinates = olproj.transform(feature.getGeometry().getCoordinates(), this.map.projection, 'EPSG:4326');\r\n        return new olstyle.Style ({\r\n          image: new olstyle.Circle ({\r\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\r\n            stroke: new olstyle.Stroke({\r\n              width: 2,\r\n              color: 'rgba(0, 153, 255)'\r\n            }),\r\n            fill: new olstyle.Fill({\r\n              color: 'rgba(0, 153, 255, 0.2)'\r\n            })\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PointStyle;\r\n      this.drawStyle$.next(this.overlayStyle);\r\n    } else {\r\n      // If geometry types is Polygon\r\n      this.radius = undefined;\r\n      this.PolyStyle = (feature, resolution) => {\r\n        return new olstyle.Style ({\r\n          stroke: new olstyle.Stroke({\r\n            width: 2,\r\n            color: 'rgba(0, 153, 255)'\r\n          }),\r\n          fill: new olstyle.Fill({\r\n            color: 'rgba(0, 153, 255, 0.2)'\r\n          })\r\n        });\r\n      };\r\n      this.overlayStyle = this.PolyStyle;\r\n    }\r\n    this.overlayStyle$.next(this.overlayStyle);\r\n  }\r\n  private _type: SpatialFilterType;\r\n\r\n  @Input() queryType: SpatialFilterQueryType;\r\n\r\n  @Input() zone: Feature;\r\n\r\n  @Input() loading;\r\n\r\n  @Input()\r\n  get store(): EntityStore<Feature> {\r\n    return this._store;\r\n  }\r\n  set store(store: EntityStore<Feature>) {\r\n    this._store = store;\r\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\r\n  }\r\n  private _store: EntityStore<Feature>;\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    return [MeasureLengthUnit.Meters];\r\n  }\r\n\r\n  @Input() layers: Layer[] = [];\r\n\r\n  @Output() toggleSearch = new EventEmitter();\r\n\r\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\r\n\r\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\r\n\r\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\r\n\r\n  @Output() radiusEvent = new EventEmitter<number>();\r\n  @Output() freehandControl = new EventEmitter<boolean>();\r\n\r\n  @Output() clearButtonEvent = new EventEmitter<Layer[]>();\r\n\r\n  @Output() clearSearchEvent = new EventEmitter();\r\n\r\n  @Output() export = new EventEmitter();\r\n\r\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\r\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\r\n  public selectedSourceAddress;\r\n\r\n  treeControl = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\r\n\r\n  // For thematics and results tables\r\n  public displayedColumns: string[] = ['name', 'select'];\r\n  public childrens: SpatialFilterThematic[] = [];\r\n  public groups: string[] = [];\r\n  public thematics: SpatialFilterThematic[] = [];\r\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\r\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\r\n  public displayedColumnsResults: string[] = ['typeResults', 'nameResults'];\r\n\r\n  // For geometry form field input\r\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\r\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\r\n  overlayStyle$: BehaviorSubject<OlStyle> = new BehaviorSubject(undefined);\r\n  drawStyle$: BehaviorSubject<OlStyle> = new BehaviorSubject(undefined);\r\n\r\n  private value$$: Subscription;\r\n  private radiusChanges$$: Subscription;\r\n\r\n  public formControl = new FormControl();\r\n  public geometryType: OlGeometryType;\r\n  public geometryTypeField = false;\r\n  public geometryTypes: string[] = ['Point', 'Polygon'];\r\n  public drawGuideField = false;\r\n  public drawGuide: number = null;\r\n  public drawGuidePlaceholder = '';\r\n  public measure = false;\r\n  public drawControlIsActive = true;\r\n  public freehandDrawIsActive = false;\r\n  public drawStyle: OlStyle;\r\n  public drawZone: Feature;\r\n  public overlayStyle: OlStyle;\r\n  public PointStyle: OlStyle;\r\n  public PolyStyle: OlStyle;\r\n\r\n  public radius: number;\r\n  public radiusFormControl = new FormControl();\r\n\r\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\r\n\r\n  constructor(\r\n    private cdRef: ChangeDetectorRef,\r\n    private spatialFilterService: SpatialFilterService,\r\n    private messageService: MessageService,\r\n    private languageService: LanguageService) {}\r\n\r\n  ngOnInit() {\r\n    this.spatialFilterService.loadThematicsList()\r\n    .subscribe((items: SpatialFilterThematic[]) => {\r\n      for (const item of items) {\r\n        this.childrens.push(item);\r\n        this.childrens.sort((a, b) => {\r\n          return a.name.localeCompare(b.name);\r\n        });\r\n      }\r\n      this.childrens.forEach(child => {\r\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\r\n          this.groups.push(child.group);\r\n          const thematic: SpatialFilterThematic = {\r\n            name: child.group,\r\n            children: []\r\n          };\r\n          this.thematics.push(thematic);\r\n        }\r\n        if (!child.group) {\r\n          const thematic: SpatialFilterThematic = {\r\n            name: child.name,\r\n            children: [],\r\n            source: child.source\r\n          };\r\n          this.thematics.push(thematic);\r\n        }\r\n        this.thematics.sort((a, b) => {\r\n          return a.name.localeCompare(b.name);\r\n        });\r\n      });\r\n      this.thematics.forEach(thematic => {\r\n        for (const child of this.childrens) {\r\n          if (child.group === thematic.name) {\r\n            thematic.children.push(child);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    this.dataSource.data = this.thematics;\r\n\r\n    this.drawGuide$.next(null);\r\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\r\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\r\n      this.value$.next(value ? value : undefined);\r\n    });\r\n\r\n    this.value$.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n\r\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\r\n      this.getRadius();\r\n      this.cdRef.detectChanges();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the value stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.value$$.unsubscribe();\r\n    this.cdRef.detach();\r\n  }\r\n\r\n  onItemTypeChange(event) {\r\n    this.selectedItemType = event.value;\r\n    this.itemTypeChange.emit(this.selectedItemType);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\r\n    this.measureUnit = unit;\r\n  }\r\n\r\n  isPredefined() {\r\n    return this.type === SpatialFilterType.Predefined;\r\n  }\r\n\r\n  isPolygon() {\r\n    return this.type === SpatialFilterType.Polygon;\r\n  }\r\n\r\n  isPoint() {\r\n    return this.type === SpatialFilterType.Point;\r\n  }\r\n\r\n  hasChild(_: number, node: SpatialFilterThematic) {\r\n    if (node.children) {\r\n      return node.children.length;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  onToggleClick(node: SpatialFilterThematic) {\r\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\r\n  }\r\n\r\n  isAllSelected(node?: SpatialFilterThematic) {\r\n    let numSelected;\r\n    let numNodes = 0;\r\n    if (!node) {\r\n      numSelected = this.selectedThematics.selected.length;\r\n      this.thematics.forEach(thematic => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          numNodes++;\r\n        }\r\n      });\r\n      this.childrens.forEach(children => {\r\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    } else {\r\n      numSelected = node.children.length;\r\n      node.children.forEach(children => {\r\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\r\n          numNodes++;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (numNodes >= 1) {\r\n      return numSelected === numNodes;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  hasChildrenSelected(node: SpatialFilterThematic) {\r\n    let bool = false;\r\n    node.children.forEach(child => {\r\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\r\n        bool = true;\r\n      }\r\n    });\r\n    return bool;\r\n  }\r\n\r\n  /**\r\n   * Apply header checkbox\r\n   */\r\n  masterToggle() {\r\n    this.isAllSelected() ?\r\n      this.selectedThematics.clear() :\r\n      this.selectAll();\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n\r\n    if (this.isAllSelected()) {\r\n      this.thematics.forEach(thematic => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.expand(thematic);\r\n        }\r\n      });\r\n    } else {\r\n      this.thematics.forEach(thematic => {\r\n        if (this.hasChild(0, thematic)) {\r\n          this.treeControl.collapse(thematic);\r\n        }\r\n      });\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  selectAll(node?: SpatialFilterThematic) {\r\n    if (!node) {\r\n      this.thematics.forEach(thematic => {\r\n        if (this.groups.indexOf(thematic.name) === -1) {\r\n          this.selectedThematics.select(thematic);\r\n        }\r\n      });\r\n      this.childrens.forEach(children => {\r\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\r\n          this.selectedThematics.select(children);\r\n        }\r\n      });\r\n    } else {\r\n      if (this.hasChild(0, node)) {\r\n        node.children.forEach(children => this.selectedThematics.select(children));\r\n      }\r\n    }\r\n  }\r\n\r\n  childrensToggle(node: SpatialFilterThematic) {\r\n    this.isAllSelected(node) ?\r\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\r\n    this.selectAll(node);\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.treeControl.expand(node);\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  /**\r\n   * Apply changes to the thematics selected tree and emit event\r\n   */\r\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\r\n    let selected = false;\r\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\r\n      selected = true;\r\n    }\r\n\r\n    this.childrens.forEach(children => {\r\n      if (children === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(children);\r\n      }\r\n      if (children === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(children);\r\n      }\r\n    });\r\n    this.thematics.forEach(thematic => {\r\n      if (thematic === nodeSelected && selected === false) {\r\n        this.selectedThematics.select(thematic);\r\n      }\r\n      if (thematic === nodeSelected && selected === true) {\r\n        this.selectedThematics.deselect(thematic);\r\n      }\r\n    });\r\n\r\n    const selectedThematicsName: SpatialFilterThematic[] = [];\r\n    for (const thematic of this.selectedThematics.selected) {\r\n      selectedThematicsName.push(thematic);\r\n    }\r\n    this.thematicChange.emit(selectedThematicsName);\r\n  }\r\n\r\n  onDrawControlChange() {\r\n    this.drawControlIsActive = !this.drawControlIsActive;\r\n  }\r\n\r\n  onfreehandControlChange() {\r\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\r\n    this.freehandControl.emit(this.freehandDrawIsActive);\r\n  }\r\n\r\n  /**\r\n   * Launch search button\r\n   */\r\n  toggleSearchButton() {\r\n    if (this.isPolygon() || this.isPoint()) {\r\n      this.drawZone = this.formControl.value as Feature;\r\n      this.drawZone.meta = {\r\n        id: undefined,\r\n        title: 'Zone'\r\n      };\r\n      this.drawZone.properties = {\r\n        nom: 'Zone'\r\n      };\r\n      this.drawZoneEvent.emit(this.drawZone);\r\n    }\r\n    this.radiusEvent.emit(this.radius);\r\n    this.toggleSearch.emit();\r\n  }\r\n\r\n  /**\r\n   * Launch clear button (clear store and map layers)\r\n   */\r\n  clearButton() {\r\n    this.loading = true;\r\n    this.map.removeLayers(this.layers);\r\n    this.loading = false;\r\n    if (this.store) {\r\n      this.store.clear();\r\n    }\r\n    this.clearButtonEvent.emit([]);\r\n  }\r\n\r\n  /**\r\n   * Launch clear search (clear field if type is predefined)\r\n   */\r\n  clearSearch() {\r\n    this.selectedThematics.clear();\r\n    this.thematicChange.emit([]);\r\n    this.clearSearchEvent.emit();\r\n  }\r\n\r\n  /**\r\n   * Verify conditions of incomplete fields or busy service\r\n   */\r\n  disableSearchButton(): boolean {\r\n    if (this.type === SpatialFilterType.Predefined) {\r\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\r\n        if (this.queryType !== undefined && this.zone !== undefined) {\r\n          return this.loading;\r\n        }\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\r\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\r\n        return this.loading;\r\n      }\r\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\r\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\r\n          return this.loading;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Manage radius value at user change\r\n   */\r\n  getRadius() {\r\n    let formValue;\r\n    this.formControl.value !== null ? formValue = this.formControl.value.radius : formValue = undefined;\r\n    if (this.type === SpatialFilterType.Point) {\r\n      if (!this.freehandDrawIsActive) {\r\n        if (this.radiusFormControl.value >= 10000 || this.radiusFormControl.value < 0) {\r\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\r\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n          this.radius = 1000;\r\n          this.radiusFormControl.setValue(this.radius);\r\n          this.drawGuide$.next(this.radius);\r\n          return;\r\n        }\r\n      } else {\r\n        if (this.radiusFormControl.value >= 10000 || this.radiusFormControl.value < 0) {\r\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\r\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n          this.radius = 1000;\r\n          this.radiusFormControl.setValue(this.radius);\r\n          this.drawGuide$.next(this.radius);\r\n          return;\r\n        }\r\n        if (formValue >= 10000) {\r\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\r\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\r\n          this.formControl.reset();\r\n          return;\r\n        }\r\n        if (formValue) {\r\n          if (formValue !== this.radiusFormControl.value) {\r\n            this.radiusFormControl.setValue(formValue);\r\n          }\r\n          this.formControl.value.radius = undefined;\r\n        }\r\n      }\r\n      this.radius = this.radiusFormControl.value;\r\n      this.drawGuide$.next(this.radius);\r\n      this.overlayStyle$.next(this.PointStyle);\r\n      this.drawStyle$.next(this.PointStyle);\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport {\r\n  MatAutocompleteModule,\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatButtonToggleModule,\r\n  MatSliderModule,\r\n  MatSlideToggleModule,\r\n  MatFormFieldModule,\r\n  MatTableModule,\r\n  MatTreeModule,\r\n  MatInputModule,\r\n  MatOptionModule,\r\n  MatSelectModule,\r\n  MatListModule,\r\n  MatTooltipModule,\r\n  MatDatepickerModule,\r\n  MatNativeDateModule,\r\n  MAT_DATE_LOCALE,\r\n  MatCheckboxModule,\r\n  MatTabsModule,\r\n  MatRadioModule,\r\n  MatMenuModule,\r\n  MatBadgeModule\r\n} from '@angular/material';\r\n\r\nimport {\r\n  MatDatetimepickerModule,\r\n  MatNativeDatetimeModule\r\n} from '@mat-datetimepicker/core';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoKeyValueModule\r\n} from '@igo2/common';\r\nimport { IgoGeometryModule } from './../geometry/geometry.module';\r\n\r\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\r\nimport { IgoLayerModule } from '../layer/layer.module';\r\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\r\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\r\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\r\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\r\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\r\nimport { TimeFilterService } from './shared/time-filter.service';\r\n\r\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\r\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\r\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\r\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\r\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\r\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\r\nimport { OGCFilterService } from './shared/ogc-filter.service';\r\nimport { OgcFilterToggleButtonComponent } from './ogc-filter-toggle-button/ogc-filter-toggle-button.component';\r\n\r\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\r\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\r\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\r\nimport { SpatialFilterService } from './shared/spatial-filter.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatAutocompleteModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTabsModule,\r\n    MatRadioModule,\r\n    MatMenuModule,\r\n    MatTableModule,\r\n    MatTreeModule,\r\n    MatButtonToggleModule,\r\n    MatCheckboxModule,\r\n    MatSliderModule,\r\n    MatSlideToggleModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatListModule,\r\n    MatTooltipModule,\r\n    MatDatepickerModule,\r\n    MatNativeDateModule,\r\n    MatDatetimepickerModule,\r\n    MatNativeDatetimeModule,\r\n    IgoLanguageModule,\r\n    IgoLayerModule,\r\n    IgoCollapsibleModule,\r\n    IgoListModule,\r\n    IgoKeyValueModule,\r\n    IgoGeometryModule,\r\n    MatBadgeModule\r\n  ],\r\n  exports: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterToggleButtonComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent\r\n  ],\r\n  declarations: [\r\n    FilterableDataSourcePipe,\r\n    TimeFilterButtonComponent,\r\n    TimeFilterFormComponent,\r\n    TimeFilterItemComponent,\r\n    TimeFilterListComponent,\r\n    TimeFilterListBindingDirective,\r\n    OgcFilterFormComponent,\r\n    OgcFilterButtonComponent,\r\n    OgcFilterToggleButtonComponent,\r\n    OgcFilterableFormComponent,\r\n    OgcFilterableItemComponent,\r\n    OgcFilterableListComponent,\r\n    OgcFilterableListBindingDirective,\r\n    SpatialFilterTypeComponent,\r\n    SpatialFilterListComponent,\r\n    SpatialFilterItemComponent\r\n  ],\r\n  providers: [TimeFilterService, OGCFilterService, SpatialFilterService]\r\n})\r\nexport class IgoFilterModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoFilterModule,\r\n      providers: [\r\n        {\r\n          provide: MAT_DATE_LOCALE,\r\n          useValue: 'fr-FR'\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\r\n\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\n\r\nimport { LayerOptions, VectorLayer } from '../../layer';\r\n\r\n@Component({\r\n  selector: 'igo-export-button',\r\n  templateUrl: './export-button.component.html',\r\n  styleUrls: ['./export-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ExportButtonComponent {\r\n  @Input()\r\n  get layer(): Layer {\r\n    return this._layer;\r\n  }\r\n  set layer(value: Layer) {\r\n    this._layer = value;\r\n  }\r\n  private _layer: Layer;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor() {}\r\n\r\n  get options(): LayerOptions {\r\n    if (!this.layer) {\r\n      return;\r\n    }\r\n    return this.layer.dataSource.options;\r\n  }\r\n\r\n  layerIsExportable(): boolean {\r\n    if ((this.layer instanceof VectorLayer && this.layer.exportable === true) ||\r\n      (this.layer.dataSource.options.download && this.layer.dataSource.options.download.url)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","export class ExportError extends Error {}\r\n\r\nexport class ExportInvalidFileError extends ExportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ExportNothingToExportError extends ExportError {\r\n  constructor() {\r\n    super('Nothing to export');\r\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\r\n  }\r\n}\r\n","import {\r\n  getEntityProperty,\r\n  EntityTableColumn,\r\n  EntityTableColumnRenderer\r\n} from '@igo2/common';\r\nimport { MessageService, LanguageService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { ExportNothingToExportError } from './export.errors';\r\n\r\nexport function handleFileExportError(\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  if (error instanceof ExportNothingToExportError) {\r\n    handleNothingToExportError(messageService, languageService);\r\n    return;\r\n  }\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.export.failed.title');\r\n  const message = translate.instant('igo.geo.export.failed.text');\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleFileExportSuccess(\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.export.success.title');\r\n  const message = translate.instant('igo.geo.export.success.text');\r\n  messageService.success(message, title);\r\n}\r\n\r\nexport function handleNothingToExportError(\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.export.nothing.title');\r\n  const message = translate.instant('igo.geo.export.nothing.text');\r\n  messageService.error(message, title);\r\n}\r\n\r\n/**\r\n * Export array to CSV\r\n *\r\n * @param rows Array of arrays to export as CSV\r\n * @param separator Cell separator\r\n */\r\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\r\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\r\n  const csvContent = lines.join('\\n');\r\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\r\n}\r\n\r\n/**\r\n * Return an array of values from an array of entities.\r\n *\r\n * @param entities Array of entities\r\n * @param scolumns Columns definition of the output data\r\n */\r\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\r\n  return entities.map((entity: object) => {\r\n    return columns.map((column: EntityTableColumn) => {\r\n      let valueAccessor;\r\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\r\n        valueAccessor = column.valueAccessor;\r\n      }\r\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\r\n      return valueAccessor(entity, column.name);\r\n    });\r\n  });\r\n}\r\n","import { strEnum } from '@igo2/utils';\r\n\r\nexport const ExportFormat = strEnum(['GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon', 'URL']);\r\nexport type ExportFormat = keyof typeof ExportFormat;\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { downloadContent } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nimport { ExportFormat } from './export.type';\r\nimport {\r\n  ExportInvalidFileError,\r\n  ExportNothingToExportError\r\n} from './export.errors';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExportService {\r\n  static ogreFormats = {\r\n    GML: 'gml',\r\n    GPX: 'gpx',\r\n    KML: 'kml',\r\n    Shapefile: 'ESRI Shapefile',\r\n    CSVcomma: 'CSVcomma',\r\n    CSVsemicolon: 'CSVsemicolon'\r\n  };\r\n\r\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\r\n\r\n  private ogreUrl: string;\r\n  private aggregateInComment: boolean = true;\r\n\r\n  constructor(private config: ConfigService) {\r\n    this.ogreUrl = this.config.getConfig('importExport.url');\r\n    const gpxAggregateInComment = this.config.getConfig(\r\n      'importExport.gpxAggregateInComment'\r\n    );\r\n    if (gpxAggregateInComment !== undefined) {\r\n      this.aggregateInComment = gpxAggregateInComment;\r\n    }\r\n  }\r\n\r\n  export(\r\n    olFeatures: OlFeature[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<void> {\r\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\r\n\r\n    return this.exportAsync(\r\n      exportOlFeatures,\r\n      format,\r\n      title,\r\n      projectionIn,\r\n      projectionOut\r\n    );\r\n  }\r\n\r\n  private generateFeature(\r\n    olFeatures: OlFeature[],\r\n    format: ExportFormat\r\n  ): OlFeature[] {\r\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\r\n      return this.generateAggratedFeature(olFeatures);\r\n    }\r\n\r\n    return olFeatures.map((olFeature: OlFeature) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith('_'));\r\n      const properties = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        { geometry: olFeature.getGeometry() }\r\n      );\r\n      return new OlFeature(properties);\r\n    });\r\n  }\r\n\r\n  private generateAggratedFeature(olFeatures: OlFeature[]): OlFeature[] {\r\n    return olFeatures.map((olFeature: OlFeature) => {\r\n      const keys = olFeature\r\n        .getKeys()\r\n        .filter((key: string) => !key.startsWith('_'));\r\n      let comment: string = '';\r\n      const properties: any[] = keys.reduce(\r\n        (acc: object, key: string) => {\r\n          if (key !== undefined && key !== 'geometry') {\r\n            comment += key + ':' + olFeature.get(key) + '   \\r\\n';\r\n          }\r\n          acc[key] = olFeature.get(key);\r\n          return acc;\r\n        },\r\n        { geometry: olFeature.getGeometry() }\r\n      );\r\n      const newFeature = new OlFeature(properties);\r\n      newFeature.set('name', olFeature.getId());\r\n      newFeature.set('cmt', comment);\r\n\r\n      return newFeature;\r\n    });\r\n  }\r\n\r\n  private exportAsync(\r\n    olFeatures: OlFeature[],\r\n    format: ExportFormat,\r\n    title: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<void> {\r\n    const doExport = (observer: Observer<void>) => {\r\n      const nothingToExport = this.nothingToExport(olFeatures, format);\r\n      if (nothingToExport === true) {\r\n        observer.error(new ExportNothingToExportError());\r\n        return;\r\n      }\r\n\r\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\r\n      if (ogreFormats.indexOf(format) >= 0) {\r\n        if (this.ogreUrl === undefined) {\r\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\r\n            this.exportToFile(\r\n              olFeatures,\r\n              observer,\r\n              format,\r\n              title,\r\n              projectionIn,\r\n              projectionOut\r\n            );\r\n          } else {\r\n            observer.error(new ExportInvalidFileError());\r\n          }\r\n          return;\r\n        }\r\n        this.exportWithOgre(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      } else {\r\n        this.exportToFile(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      }\r\n    };\r\n\r\n    return new Observable(doExport);\r\n  }\r\n\r\n  protected exportToFile(\r\n    olFeatures: OlFeature[],\r\n    observer: Observer<void>,\r\n    format: ExportFormat,\r\n    title: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const olFormat = new olformat[format]();\r\n    const featuresText = olFormat.writeFeatures(olFeatures, {\r\n      dataProjection: projectionOut,\r\n      featureProjection: projectionIn,\r\n      featureType: 'feature',\r\n      featureNS: 'http://example.com/feature'\r\n    });\r\n\r\n    const fileName = `${title}.${format.toLowerCase()}`;\r\n\r\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\r\n    observer.complete();\r\n  }\r\n\r\n  private exportWithOgre(\r\n    olFeatures: OlFeature[],\r\n    observer: Observer<void>,\r\n    format: string,\r\n    title: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const featuresText: string = new olformat.GeoJSON().writeFeatures(\r\n      olFeatures,\r\n      {\r\n        dataProjection: projectionOut,\r\n        featureProjection: projectionIn,\r\n        featureType: 'feature',\r\n        featureNS: 'http://example.com/feature'\r\n      }\r\n    );\r\n\r\n    const url = `${this.ogreUrl}/convertJson`;\r\n    const form = document.createElement('form');\r\n    form.style.display = 'none';\r\n    document.body.appendChild(form);\r\n    form.setAttribute('method', 'post');\r\n    form.setAttribute('target', '_blank');\r\n    form.setAttribute('action', url);\r\n\r\n    form.acceptCharset = 'UTF-8';\r\n    form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\r\n\r\n    if (format === 'CSVsemicolon') {\r\n      const options = document.createElement('input');\r\n      options.setAttribute('type', 'hidden');\r\n      options.setAttribute('name', 'lco');\r\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\r\n      form.appendChild(options);\r\n    }\r\n\r\n    const geojsonField = document.createElement('input');\r\n    geojsonField.setAttribute('type', 'hidden');\r\n    geojsonField.setAttribute('name', 'json');\r\n    geojsonField.setAttribute('value', featuresText);\r\n    form.appendChild(geojsonField);\r\n\r\n    const outputNameField = document.createElement('input');\r\n    let outputName =\r\n      format === 'Shapefile'\r\n        ? `${title}.zip`\r\n        : `${title}.${format.toLowerCase()}`;\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      outputName = `${title}.csv`;\r\n    }\r\n    outputName = outputName.replace(' ', '_');\r\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n    outputNameField.setAttribute('type', 'hidden');\r\n    outputNameField.setAttribute('name', 'outputName');\r\n    outputNameField.setAttribute('value', outputName);\r\n    form.appendChild(outputNameField);\r\n\r\n    let ogreFormat = ExportService.ogreFormats[format];\r\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\r\n      ogreFormat = 'CSV';\r\n    }\r\n    const outputFormatField = document.createElement('input');\r\n    outputFormatField.setAttribute('type', 'hidden');\r\n    outputFormatField.setAttribute('name', 'format');\r\n    outputFormatField.setAttribute('value', ogreFormat);\r\n    form.appendChild(outputFormatField);\r\n\r\n    form.submit();\r\n    document.body.removeChild(form);\r\n\r\n    observer.complete();\r\n  }\r\n\r\n  private nothingToExport(olFeatures: OlFeature[], format: string): boolean {\r\n    if (olFeatures.length === 0) {\r\n      return true;\r\n    }\r\n    if (format === 'GPX') {\r\n      const pointOrLine = olFeatures.find(olFeature => {\r\n        return (\r\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >=\r\n          0\r\n        );\r\n      });\r\n      return pointOrLine === undefined;\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","export class ImportError extends Error {}\r\n\r\nexport class ImportInvalidFileError extends ImportError {\r\n  constructor() {\r\n    super('Invalid file');\r\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportUnreadableFileError extends ImportError {\r\n  constructor() {\r\n      super('Failed to read file');\r\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportNothingToImportError extends ImportError {\r\n  constructor() {\r\n      super('Nothing to import');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSizeError extends ImportError {\r\n  constructor() {\r\n      super('File is too large');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n\r\nexport class ImportSRSError extends ImportError {\r\n  constructor() {\r\n      super('Invalid SRS definition');\r\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\r\n  }\r\n}\r\n","import * as olStyle from 'ol/style';\r\n\r\nimport { MessageService, LanguageService, ConfigService } from '@igo2/core';\r\n\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { featureToOl, moveToOlFeatures } from '../../feature/shared/feature.utils';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\r\nimport { StyleListService } from '../style-list/style-list.service';\r\nimport { ClusterParam } from '../../layer/shared/clusterParam';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\r\n\r\nexport function addLayerAndFeaturesToMap(features: Feature[], map: IgoMap, layerTitle: string): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) => featureToOl(feature, map.projection));\r\n\r\n  const r = Math.floor(Math.random() * 255);\r\n  const g = Math.floor(Math.random() * 255);\r\n  const b = Math.floor(Math.random() * 255);\r\n  const stroke = new olStyle.Stroke({\r\n    color: [r, g, b, 1],\r\n    width: 2\r\n  });\r\n\r\n  const fill = new olStyle.Fill({\r\n    color: [r, g, b, 0.4]\r\n  });\r\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n    type: 'vector',\r\n    queryable: true\r\n  };\r\n  const source = new FeatureDataSource(sourceOptions);\r\n  source.ol.addFeatures(olFeatures);\r\n  const layer = new VectorLayer({\r\n    title: layerTitle,\r\n    source,\r\n    style: new olStyle.Style({\r\n      stroke,\r\n      fill,\r\n      image: new olStyle.Circle({\r\n        radius: 5,\r\n        stroke,\r\n        fill\r\n      })\r\n    })\r\n  });\r\n  map.addLayer(layer);\r\n  moveToOlFeatures(map, olFeatures);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function addLayerAndFeaturesStyledToMap(features: Feature[], map: IgoMap, layerTitle: string,\r\n                                               styleListService: StyleListService, styleService: StyleService): VectorLayer {\r\n  const olFeatures = features.map((feature: Feature) => featureToOl(feature, map.projection));\r\n  let style;\r\n  let distance: number;\r\n\r\n  if (styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')) {\r\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute');\r\n\r\n    style = feature => {\r\n      return styleService.createStyleByAttribute(\r\n        feature,\r\n        styleByAttribute\r\n      );\r\n    };\r\n\r\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\r\n    const clusterParam: ClusterParam = styleListService.getStyleList(layerTitle.toString() + '.clusterParam');\r\n    distance = styleListService.getStyleList(layerTitle.toString() + '.distance');\r\n\r\n    const baseStyle = styleService.createStyle(styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'));\r\n\r\n    style = feature => {\r\n      return styleService.createClusterStyle(\r\n        feature,\r\n        clusterParam,\r\n        baseStyle\r\n      );\r\n    };\r\n\r\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\r\n\r\n    style = styleService.createStyle(styleListService.getStyleList(layerTitle.toString() + '.style'));\r\n\r\n  } else if (styleListService.getStyleList('default.clusterStyle') && features[0].geometry.type === 'Point') {\r\n      const clusterParam: ClusterParam = styleListService.getStyleList('default.clusterParam');\r\n      distance = styleListService.getStyleList('default.distance');\r\n\r\n      const baseStyle = styleService.createStyle(styleListService.getStyleList('default.clusterStyle'));\r\n\r\n      style = feature => {\r\n        return styleService.createClusterStyle(\r\n          feature,\r\n          clusterParam,\r\n          baseStyle\r\n        );\r\n      };\r\n  } else {\r\n    style = styleService.createStyle(styleListService.getStyleList('default.style'));\r\n  }\r\n\r\n  let source;\r\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions = {\r\n      distance,\r\n      type: 'cluster',\r\n      queryable: true\r\n    };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n      type: 'vector',\r\n      queryable: true\r\n    };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  } else if (styleListService.getStyleList('default.clusterStyle') && features[0].geometry.type === 'Point') {\r\n    const sourceOptions: ClusterDataSourceOptions & QueryableDataSourceOptions = {\r\n      distance,\r\n      type: 'cluster',\r\n      queryable: true\r\n    };\r\n    source = new ClusterDataSource(sourceOptions);\r\n    source.ol.source.addFeatures(olFeatures);\r\n  } else {\r\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\r\n      type: 'vector',\r\n      queryable: true\r\n    };\r\n    source = new FeatureDataSource(sourceOptions);\r\n    source.ol.addFeatures(olFeatures);\r\n  }\r\n\r\n  const layer = new VectorLayer({\r\n    title: layerTitle,\r\n    source,\r\n    style\r\n  });\r\n  map.addLayer(layer);\r\n  moveToOlFeatures(map, olFeatures);\r\n\r\n  return layer;\r\n}\r\n\r\nexport function handleFileImportSuccess(\r\n  file: File,\r\n  features: Feature[],\r\n  map: IgoMap,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  styleListService?: StyleListService,\r\n  styleService?: StyleService\r\n) {\r\n  if (features.length === 0) {\r\n    handleNothingToImportError(file, messageService, languageService);\r\n    return;\r\n  }\r\n\r\n  const layerTitle = computeLayerTitleFromFile(file);\r\n\r\n  if (!styleListService) {\r\n    addLayerAndFeaturesToMap(features, map, layerTitle);\r\n  } else {\r\n    addLayerAndFeaturesStyledToMap(features, map, layerTitle, styleListService, styleService);\r\n  }\r\n\r\n  const translate = languageService.translate;\r\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\r\n      value: layerTitle\r\n  });\r\n  messageService.success(message, messageTitle);\r\n}\r\n\r\nexport function handleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  sizeMb?: number\r\n) {\r\n  sizeMb = sizeMb ? sizeMb : 30;\r\n  const errMapping = {\r\n    'Invalid file': handleInvalidFileImportError,\r\n    'File is too large': handleSizeFileImportError,\r\n    'Failed to read file': handleUnreadbleFileImportError,\r\n    'Invalid SRS definition': handleSRSImportError\r\n  };\r\n  errMapping[error.message](file, error, messageService, languageService, sizeMb);\r\n}\r\n\r\nexport function handleInvalidFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\r\n      value: file.name,\r\n      mimeType: file.type\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleUnreadbleFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\r\n      value: file.name\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleSizeFileImportError(\r\n  file: File,\r\n  error: Error,\r\n  messageService: MessageService,\r\n  languageService: LanguageService,\r\n  sizeMb: number\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\r\n      value: file.name,\r\n      size: sizeMb\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleNothingToImportError(\r\n  file: File,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\r\n      value: file.name,\r\n      mimeType: file.type\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function handleSRSImportError(\r\n  file: File,\r\n  messageService: MessageService,\r\n  languageService: LanguageService\r\n) {\r\n  const translate = languageService.translate;\r\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\r\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\r\n      value: file.name,\r\n      mimeType: file.type\r\n  });\r\n  messageService.error(message, title);\r\n}\r\n\r\nexport function getFileExtension(file: File): string {\r\n  return file.name.split('.').pop().toLowerCase();\r\n}\r\n\r\nexport function computeLayerTitleFromFile(file: File): string {\r\n  return file.name.substr(0, file.name.lastIndexOf('.'));\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\nimport { uuid } from '@igo2/utils';\r\n\r\nimport { Observable, Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport {\r\n  ImportInvalidFileError,\r\n  ImportUnreadableFileError,\r\n  ImportSizeError,\r\n  ImportSRSError\r\n} from './import.errors';\r\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ImportService {\r\n  static allowedMimeTypes = [\r\n    'application/gml+xml',\r\n    'application/vnd.google-earth.kml+xml',\r\n    'application/gpx+xml',\r\n    'application/json'\r\n  ];\r\n\r\n  static allowedZipMimeTypes = [\r\n    'application/zip',\r\n    'application/x-zip-compressed',\r\n    'application/x-zip'\r\n  ];\r\n\r\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml'];\r\n\r\n  private ogreUrl: string;\r\n  private clientSideFileSizeMax: number;\r\n\r\n  constructor(private http: HttpClient, private config: ConfigService) {\r\n    this.ogreUrl = this.config.getConfig('importExport.url');\r\n    const configFileSizeMb = this.config.getConfig('importExport.clientSideFileSizeMaxMb');\r\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) *  Math.pow(1024, 2);\r\n  }\r\n\r\n  import(\r\n    file: File,\r\n    projectionIn = 'EPSG:4326',\r\n    projectionOut = 'EPSG:4326'\r\n  ): Observable<Feature[]> {\r\n    return this.importAsync(file, projectionIn, projectionOut);\r\n  }\r\n\r\n  private getFileImporter(\r\n    file: File\r\n  ): (\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) => void {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n    const allowedMimeTypes = [\r\n      ...ImportService.allowedMimeTypes,\r\n      ...ImportService.allowedZipMimeTypes\r\n    ];\r\n    const allowedExtensions = ImportService.allowedExtensions;\r\n\r\n    if (\r\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\r\n      allowedExtensions.indexOf(extension) < 0\r\n    ) {\r\n      return undefined;\r\n    } else if (\r\n      mimeType === 'application/json' ||\r\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\r\n    ) {\r\n      return this.importFile;\r\n    } else if (this.ogreUrl !== undefined) {\r\n      return this.importFileWithOgre;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  private importAsync(\r\n    file: File,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Observable<Feature[]> {\r\n    const doImport = (observer: Observer<Feature[]>) => {\r\n      if (file.size >= this.clientSideFileSizeMax) {\r\n        observer.error(new ImportSizeError());\r\n        return;\r\n      }\r\n      const importer = this.getFileImporter(file);\r\n      if (importer === undefined) {\r\n        observer.error(new ImportInvalidFileError());\r\n        return;\r\n      }\r\n\r\n      importer.call(this, file, observer, projectionIn, projectionOut);\r\n    };\r\n\r\n    return new Observable(doImport);\r\n  }\r\n\r\n  private importFile(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (event: any) => {\r\n      try {\r\n        const features = this.parseFeaturesFromFile(\r\n          file,\r\n          event.target.result,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n        observer.next(features);\r\n      } catch (e) {\r\n        observer.error(new ImportUnreadableFileError());\r\n      }\r\n\r\n      observer.complete();\r\n    };\r\n\r\n    reader.onerror = evt => {\r\n      observer.error(new ImportUnreadableFileError());\r\n    };\r\n\r\n    reader.readAsText(file, 'UTF-8');\r\n  }\r\n\r\n  private importFileWithOgre(\r\n    file: File,\r\n    observer: Observer<Feature[]>,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ) {\r\n    const url = `${this.ogreUrl}/convert`;\r\n    const formData = new FormData();\r\n    formData.append('upload', file);\r\n    formData.append('sourceSrs', projectionIn);\r\n    formData.append('targetSrs', projectionOut);\r\n    formData.append('formatOutput', 'GEOJSON');\r\n    formData.append('skipFailures', '');\r\n\r\n    this.http.post(url, formData, { headers: new HttpHeaders() }).subscribe(\r\n      (response: { errors?: string[] } | object | null) => {\r\n        if (response === null) {\r\n          observer.error(new ImportUnreadableFileError());\r\n          return;\r\n        }\r\n\r\n        const errors = (response as any).errors || [];\r\n        if (errors.length > 0) {\r\n          observer.error(new ImportUnreadableFileError());\r\n        } else {\r\n          const features = this.parseFeaturesFromGeoJSON(\r\n            file,\r\n            response,\r\n            projectionOut\r\n          );\r\n          observer.next(features);\r\n          observer.complete();\r\n        }\r\n      },\r\n      (error: any) => {\r\n        error.error.caught = true;\r\n        const errMsg = error.error.msg || '';\r\n        if (errMsg === 'No valid files found') {\r\n          observer.error(new ImportInvalidFileError());\r\n        } else if (\r\n          errMsg.startWith('ERROR 1: Failed to process SRS definition')\r\n        ) {\r\n          observer.error(new ImportSRSError());\r\n        } else {\r\n          observer.error(new ImportUnreadableFileError());\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  private parseFeaturesFromFile(\r\n    file: File,\r\n    data: string,\r\n    projectionIn: string,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const extension = getFileExtension(file);\r\n    const mimeType = file.type;\r\n\r\n    const GeoJSON = new olformat.GeoJSON();\r\n\r\n    let format;\r\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\r\n      format = new olformat.KML();\r\n    } else if (mimeType === 'application/gml+xml') {\r\n      format = new olformat.GML();\r\n    } else if (mimeType === 'application/gpx+xml') {\r\n      format = new olformat.GPX();\r\n    } else {\r\n      switch (extension) {\r\n        case 'kml':\r\n          format = new olformat.KML();\r\n          break;\r\n        case 'gpx':\r\n          format = new olformat.GPX();\r\n          break;\r\n        case 'gml':\r\n          format = new olformat.GML();\r\n          break;\r\n        default:\r\n          format = GeoJSON;\r\n          break;\r\n      }\r\n    }\r\n\r\n    const olFeatures = format.readFeatures(data, {\r\n      dataProjection: projectionIn,\r\n      featureProjection: projectionOut\r\n    });\r\n    const features = olFeatures.map((olFeature: OlFeature) => {\r\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features;\r\n  }\r\n\r\n  private parseFeaturesFromGeoJSON(\r\n    file: File,\r\n    data: object,\r\n    projectionOut: string\r\n  ): Feature[] {\r\n    const olFormat = new olformat.GeoJSON();\r\n    const olFeatures = olFormat.readFeatures(data);\r\n    const features = olFeatures.map((olFeature: OlFeature) => {\r\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\r\n        projection: projectionOut,\r\n        meta: {\r\n          id: uuid(),\r\n          title: computeLayerTitleFromFile(file)\r\n        }\r\n      });\r\n    });\r\n\r\n    return features;\r\n  }\r\n}\r\n","import { Injectable, Injector } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StyleListService {\r\n  private styleList: object = {};\r\n\r\n  constructor(private injector: Injector) {}\r\n\r\n  /**\r\n   * Use to get the data found in styleList file\r\n   */\r\n  public getStyleList(key: string): any {\r\n    return ObjectUtils.resolve(this.styleList, key);\r\n  }\r\n\r\n  /**\r\n   * This method loads \"[path]\" to get all styleList's variables\r\n   */\r\n  public load(options: StyleListOptions) {\r\n    const baseStyleList = options.default || {};\r\n    if (!options.path) {\r\n      this.styleList = baseStyleList;\r\n      return true;\r\n    }\r\n\r\n    const http = this.injector.get(HttpClient);\r\n\r\n    return new Promise((resolve, _reject) => {\r\n      http\r\n        .get(options.path)\r\n        .pipe(\r\n          catchError((error: any): any => {\r\n            console.log(`StyleList file ${options.path} could not be read`);\r\n            resolve(true);\r\n            return throwError(error.error || 'Server error');\r\n          })\r\n        )\r\n        .subscribe(styleListResponse => {\r\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\r\n          resolve(true);\r\n        });\r\n    });\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  OnDestroy,\r\n  OnInit,\r\n  Output,\r\n  EventEmitter\r\n} from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\nimport { MessageService, LanguageService, ConfigService } from '@igo2/core';\r\nimport { strEnum } from '@igo2/utils';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\r\nimport { Layer } from '../../layer/shared/layers/layer';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\r\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\r\n\r\nimport {\r\n  handleFileExportError,\r\n  handleFileExportSuccess\r\n} from '../shared/export.utils';\r\nimport { ExportOptions } from '../shared/export.interface';\r\nimport { ExportFormat } from '../shared/export.type';\r\nimport { ExportService } from '../shared/export.service';\r\nimport { ImportService } from '../shared/import.service';\r\nimport {\r\n  handleFileImportSuccess,\r\n  handleFileImportError\r\n} from '../shared/import.utils';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { StyleListService } from '../style-list/style-list.service';\r\nimport { MatTabChangeEvent } from '@angular/material';\r\nimport { skipWhile } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'igo-import-export',\r\n  templateUrl: './import-export.component.html',\r\n  styleUrls: ['./import-export.component.scss']\r\n})\r\nexport class ImportExportComponent implements OnDestroy, OnInit {\r\n  public form: FormGroup;\r\n  public formats$ = new BehaviorSubject(undefined);\r\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\r\n    []\r\n  );\r\n  public inputProj: string = 'EPSG:4326';\r\n  public loading$ = new BehaviorSubject(false);\r\n  public forceNaming = false;\r\n\r\n  private layers$$: Subscription;\r\n  private exportableLayers$$: Subscription;\r\n  private formats$$: Subscription;\r\n  private formLayer$$: Subscription;\r\n  private exportOptions$$: Subscription;\r\n\r\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\r\n  private clientSideFileSizeMax: number;\r\n  public activeImportExport: string = 'import';\r\n  public fileSizeMb: number;\r\n\r\n  private previousLayerSpecs$: BehaviorSubject<\r\n    {\r\n      id: string;\r\n      visible: boolean;\r\n      opacity: number;\r\n      queryable: boolean;\r\n    }[]\r\n  > = new BehaviorSubject(undefined);\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  @Input() selectedIndex: number = 0;\r\n\r\n  @Output() selectedTabIndex = new EventEmitter<number>();\r\n\r\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\r\n\r\n  constructor(\r\n    private importService: ImportService,\r\n    private exportService: ExportService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    private formBuilder: FormBuilder,\r\n    private config: ConfigService\r\n  ) {\r\n    this.loadConfig();\r\n    this.buildForm();\r\n    console.log(this);\r\n    console.log(this.form);\r\n    console.log(this.form);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      this.exportableLayers$.next(\r\n        layers.filter((layer: Layer) => {\r\n          return (\r\n            (layer instanceof VectorLayer && layer.exportable === true) ||\r\n            (layer.dataSource.options.download &&\r\n              layer.dataSource.options.download.url)\r\n          );\r\n        }) as AnyLayer[]\r\n      );\r\n    });\r\n    const configFileSizeMb = this.config.getConfig(\r\n      'importExport.clientSideFileSizeMaxMb'\r\n    );\r\n    this.clientSideFileSizeMax =\r\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\r\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\r\n\r\n    this.exportOptions$$ = this.exportOptions$\r\n      .pipe(skipWhile((exportOptions) => !exportOptions))\r\n      .subscribe((exportOptions) => {\r\n        this.form.patchValue(exportOptions, { emitEvent: true });\r\n        if (exportOptions.layer) {\r\n          this.computeFormats(\r\n            exportOptions.layer.map((l) => this.map.getLayerById(l))\r\n          );\r\n        }\r\n      });\r\n\r\n    this.formLayer$$ = this.form\r\n      .get('layer')\r\n      .valueChanges.subscribe((layerId) => {\r\n        this.handlePreviousLayerSpecs();\r\n        const layers = layerId.map((l) => this.map.getLayerById(l));\r\n        this.computeFormats(layers);\r\n\r\n        if (\r\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\r\n          -1\r\n        ) {\r\n          this.form.patchValue({ format: undefined });\r\n        }\r\n\r\n        this.loading$.next(true);\r\n        const previousSpecs: {\r\n          id: string;\r\n          visible: boolean;\r\n          opacity: number;\r\n          queryable: boolean;\r\n        }[] = [];\r\n        layers.forEach((layer) => {\r\n          if (\r\n            layer instanceof VectorLayer &&\r\n            layer.dataSource.ol.getFeatures().length === 0\r\n          ) {\r\n            previousSpecs.push({\r\n              id: layer.id,\r\n              visible: layer.visible,\r\n              opacity: layer.opacity,\r\n              queryable: (layer as any).queryable\r\n            });\r\n            layer.opacity = 0;\r\n            layer.visible = true;\r\n          }\r\n        });\r\n\r\n        this.previousLayerSpecs$.next(previousSpecs);\r\n        setTimeout(() => {\r\n          this.loading$.next(false);\r\n        }, 500);\r\n      });\r\n\r\n    this.formats$$ = this.formats$\r\n      .pipe(skipWhile((formats) => !formats))\r\n      .subscribe((formats) => {\r\n        if (Object.keys(formats).length === 1) {\r\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\r\n        }\r\n      });\r\n\r\n    this.exportableLayers$$ = this.exportableLayers$\r\n      .pipe(skipWhile((layers) => !layers))\r\n      .subscribe((layers) => {\r\n        if (layers.length === 1) {\r\n          this.form.patchValue({ layer: layers[0].id });\r\n        }\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n    this.exportableLayers$$.unsubscribe();\r\n    this.formats$$.unsubscribe();\r\n    this.formLayer$$.unsubscribe();\r\n    if (this.exportOptions$$) {\r\n      this.exportOptions$$.unsubscribe();\r\n    }\r\n    this.exportOptionsChange.emit(this.form.value);\r\n    this.handlePreviousLayerSpecs();\r\n  }\r\n\r\n  private handlePreviousLayerSpecs() {\r\n    const previousSpecs = this.previousLayerSpecs$.value;\r\n    if (previousSpecs && previousSpecs.length) {\r\n      previousSpecs.forEach((specs) => {\r\n        const previousLayer = this.map.getLayerById(specs.id);\r\n        previousLayer.visible = specs.visible;\r\n        previousLayer.opacity = specs.opacity;\r\n        (previousLayer as any).queryable = specs.queryable;\r\n      });\r\n    }\r\n    this.previousLayerSpecs$.next(undefined);\r\n  }\r\n\r\n  importFiles(files: File[]) {\r\n    let inputProj = this.inputProj;\r\n    if (this.espgCodeRegex.test(inputProj)) {\r\n      inputProj = `EPSG:${inputProj}`;\r\n    }\r\n\r\n    this.loading$.next(true);\r\n    for (const file of files) {\r\n      this.importService.import(file, inputProj).subscribe(\r\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\r\n        (error: Error) => this.onFileImportError(file, error),\r\n        () => {\r\n          this.loading$.next(false);\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  handleExportFormSubmit(data: ExportOptions) {\r\n    this.loading$.next(true);\r\n    data.layer.forEach((layer) => {\r\n      const lay = this.map.getLayerById(layer);\r\n      let filename = lay.title;\r\n      if (data.name !== undefined) {\r\n        filename = data.name;\r\n      }\r\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\r\n      if (\r\n        data.format === ExportFormat.URL &&\r\n        dSOptions.download &&\r\n        dSOptions.download.url\r\n      ) {\r\n        setTimeout(() => {\r\n          // better look an feel\r\n          window.open(dSOptions.download.url, '_blank');\r\n          this.loading$.next(false);\r\n        }, 500);\r\n        return;\r\n      }\r\n\r\n      let olFeatures;\r\n      if (data.featureInMapExtent) {\r\n        olFeatures = lay.dataSource.ol.getFeaturesInExtent(\r\n          lay.map.viewController.getExtent()\r\n        );\r\n      } else {\r\n        olFeatures = lay.dataSource.ol.getFeatures();\r\n      }\r\n      if (lay.dataSource instanceof ClusterDataSource) {\r\n        olFeatures = olFeatures.flatMap((cluster: any) =>\r\n          cluster.get('features')\r\n        );\r\n      }\r\n\r\n      this.exportService\r\n        .export(olFeatures, data.format, filename, this.map.projection)\r\n        .subscribe(\r\n          () => {},\r\n          (error: Error) => this.onFileExportError(error),\r\n          () => {\r\n            this.onFileExportSuccess();\r\n            this.loading$.next(false);\r\n          }\r\n        );\r\n    });\r\n  }\r\n\r\n  private buildForm() {\r\n    if (this.forceNaming) {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layer: ['', [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]],\r\n        name: ['', [Validators.required]]\r\n      });\r\n    } else {\r\n      this.form = this.formBuilder.group({\r\n        format: ['', [Validators.required]],\r\n        layer: ['', [Validators.required]],\r\n        featureInMapExtent: [false, [Validators.required]]\r\n      });\r\n    }\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, features: Feature[]) {\r\n    if (!this.config.getConfig('importWithStyle')) {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.messageService,\r\n        this.languageService\r\n      );\r\n    } else {\r\n      handleFileImportSuccess(\r\n        file,\r\n        features,\r\n        this.map,\r\n        this.messageService,\r\n        this.languageService,\r\n        this.styleListService,\r\n        this.styleService\r\n      );\r\n    }\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileImportError(\r\n      file,\r\n      error,\r\n      this.messageService,\r\n      this.languageService,\r\n      this.fileSizeMb\r\n    );\r\n  }\r\n\r\n  private onFileExportError(error: Error) {\r\n    this.loading$.next(false);\r\n    handleFileExportError(error, this.messageService, this.languageService);\r\n  }\r\n\r\n  private loadConfig() {\r\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\r\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\r\n    }\r\n    this.computeFormats();\r\n  }\r\n\r\n  private computeFormats(layers?: AnyLayer[]) {\r\n    if (layers && layers.length) {\r\n      const formatsType = {\r\n        onlyUrl: false,\r\n        onlyVector: false,\r\n        vectorAndUrl: false\r\n      };\r\n      layers.forEach((layer) => {\r\n        if (!layer) {\r\n          return;\r\n        }\r\n        if (\r\n          !(layer instanceof VectorLayer) &&\r\n          layer.dataSource.options.download &&\r\n          layer.dataSource.options.download.url\r\n        ) {\r\n          formatsType.onlyUrl = true;\r\n        } else if (\r\n          layer.dataSource.options.download &&\r\n          layer.dataSource.options.download.url\r\n        ) {\r\n          formatsType.vectorAndUrl = true;\r\n        } else if (layer instanceof VectorLayer) {\r\n          formatsType.onlyVector = true;\r\n        }\r\n      });\r\n\r\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\r\n        this.formats$.next(strEnum(['URL']));\r\n      } else if (\r\n        formatsType.onlyVector === true &&\r\n        formatsType.onlyUrl === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (ExportFormat.URL in this.formats$.value) {\r\n          const keys = Object.keys(this.formats$.value).filter(\r\n            (key) => key !== 'URL'\r\n          );\r\n          this.formats$.next(strEnum(keys));\r\n        }\r\n      } else if (\r\n        formatsType.vectorAndUrl === true &&\r\n        formatsType.onlyUrl === false &&\r\n        formatsType.onlyVector === false\r\n      ) {\r\n        this.computeFormats(); // reset\r\n        if (!(ExportFormat.URL in this.formats$.value)) {\r\n          const keys = Object.keys(this.formats$.value);\r\n          keys.push('URL');\r\n          this.formats$.next(strEnum(keys));\r\n        }\r\n      } else {\r\n        this.formats$.next([]);\r\n        this.messageService.alert(\r\n          this.languageService.translate.instant(\r\n            'igo.geo.export.noFormat.text'\r\n          ),\r\n          this.languageService.translate.instant(\r\n            'igo.geo.export.noFormat.title'\r\n          )\r\n        );\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.config.getConfig('importExport.formats') !== undefined) {\r\n      const validatedListFormat = this.validateListFormat(\r\n        this.config.getConfig('importExport.formats')\r\n      );\r\n      this.formats$.next(strEnum(validatedListFormat));\r\n    } else {\r\n      this.formats$.next(ExportFormat);\r\n    }\r\n  }\r\n\r\n  private validateListFormat(formats: string[]): string[] {\r\n    return formats\r\n      .filter((format) => {\r\n        if (\r\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\r\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\r\n        ) {\r\n          return format;\r\n        }\r\n      })\r\n      .map((format) => {\r\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\r\n          format = ExportFormat.CSVcomma;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\r\n          format = ExportFormat.CSVsemicolon;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\r\n          format = ExportFormat.GML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\r\n          format = ExportFormat.GPX;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\r\n          format = ExportFormat.GeoJSON;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\r\n          format = ExportFormat.KML;\r\n          return format;\r\n        }\r\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\r\n          format = ExportFormat.Shapefile;\r\n          return format;\r\n        }\r\n\r\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\r\n          format = ExportFormat.URL;\r\n          return format;\r\n        }\r\n      });\r\n  }\r\n\r\n  public tabChanged(tab: MatTabChangeEvent) {\r\n    this.selectedTabIndex.emit(tab.index);\r\n  }\r\n\r\n  private onFileExportSuccess() {\r\n    handleFileExportSuccess(this.messageService, this.languageService);\r\n  }\r\n\r\n  onImportExportChange(event) {\r\n    this.activeImportExport = event.value;\r\n  }\r\n}\r\n","import { Directive, HostListener, EventEmitter, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MessageService, LanguageService, ConfigService } from '@igo2/core';\r\nimport { DragAndDropDirective } from '@igo2/common';\r\n\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { ImportService } from './import.service';\r\nimport { handleFileImportSuccess, handleFileImportError } from '../shared/import.utils';\r\nimport { StyleService } from '../../layer/shared/style.service';\r\nimport { StyleListService } from '../style-list/style-list.service';\r\n\r\n@Directive({\r\n  selector: '[igoDropGeoFile]'\r\n})\r\nexport class DropGeoFileDirective extends DragAndDropDirective implements OnInit, OnDestroy {\r\n\r\n  protected filesDropped: EventEmitter<File[]> = new EventEmitter();\r\n  protected filesInvalid: EventEmitter<File[]> = new EventEmitter();\r\n\r\n  private filesDropped$$: Subscription;\r\n\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  constructor(\r\n    private component: MapBrowserComponent,\r\n    private importService: ImportService,\r\n    private languageService: LanguageService,\r\n    private styleListService: StyleListService,\r\n    private styleService: StyleService,\r\n    private config: ConfigService,\r\n    private messageService: MessageService\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.filesDropped$$ = this.filesDropped.subscribe((files: File[]) => {\r\n      this.onFilesDropped(files);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.filesDropped$$.unsubscribe();\r\n  }\r\n\r\n  @HostListener('dragover', ['$event'])\r\n  public onDragOver(evt) {\r\n    super.onDragOver(evt);\r\n  }\r\n\r\n  @HostListener('dragleave', ['$event'])\r\n  public onDragLeave(evt) {\r\n    super.onDragLeave(evt);\r\n  }\r\n\r\n  @HostListener('drop', ['$event'])\r\n  public onDrop(evt) {\r\n    super.onDrop(evt);\r\n  }\r\n\r\n  private onFilesDropped(files: File[]) {\r\n    for (const file of files) {\r\n      this.importService\r\n        .import(file)\r\n        .subscribe(\r\n          (features: Feature[]) => this.onFileImportSuccess(file, features),\r\n          (error: Error) => this.onFileImportError(file, error)\r\n        );\r\n    }\r\n  }\r\n\r\n  private onFileImportSuccess(file: File, features: Feature[]) {\r\n    if (!this.config.getConfig('importWithStyle')) {\r\n      handleFileImportSuccess(file, features, this.map, this.messageService, this.languageService);\r\n    } else {\r\n      handleFileImportSuccess(file, features, this.map, this.messageService, this.languageService,\r\n                               this.styleListService, this.styleService);\r\n    }\r\n  }\r\n\r\n  private onFileImportError(file: File, error: Error) {\r\n    handleFileImportError(file, error, this.messageService, this.languageService, this.config.getConfig('importExport.clientSideFileSizeMaxMb'));\r\n  }\r\n}\r\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\r\n\r\nimport { StyleListService } from './style-list.service';\r\nimport { StyleListOptions } from './style-list.interface';\r\n\r\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\r\n\r\nexport function provideStyleListOptions(options: StyleListOptions) {\r\n  return {\r\n    provide: STYLELIST_OPTIONS,\r\n    useValue: options\r\n  };\r\n}\r\n\r\nexport function styleListFactory(\r\n  styleListService: StyleListService,\r\n  options: StyleListOptions\r\n) {\r\n  return () => styleListService.load(options);\r\n}\r\n\r\nexport function provideStyleListLoader() {\r\n  return {\r\n    provide: APP_INITIALIZER,\r\n    useFactory: styleListFactory,\r\n    multi: true,\r\n    deps: [StyleListService, STYLELIST_OPTIONS]\r\n  };\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class IgoStyleListModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoStyleListModule,\r\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { CommonModule } from '@angular/common';\r\nimport {\r\n  MatButtonModule,\r\n  MatTabsModule,\r\n  MatSelectModule,\r\n  MatOptionModule,\r\n  MatFormFieldModule,\r\n  MatInputModule,\r\n  MatSlideToggleModule,\r\n  MatIconModule,\r\n  MatTooltipModule,\r\n  MatButtonToggleModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule } from '@igo2/common';\r\n\r\nimport { ExportButtonComponent } from './export-button/export-button.component';\r\nimport { ImportExportComponent } from './import-export/import-export.component';\r\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\r\nimport { IgoStyleListModule } from './style-list/style-list.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatTabsModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoSpinnerModule,\r\n    IgoKeyValueModule,\r\n    IgoDrapDropModule,\r\n    IgoStyleListModule.forRoot()\r\n  ],\r\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\r\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\r\n})\r\nexport class IgoImportExportModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoImportExportModule\r\n    };\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatTooltipModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoConfirmDialogModule } from '@igo2/common';\r\n\r\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\r\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\r\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\r\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\r\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\r\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\r\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\r\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\r\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\r\nimport { PointerPositionByKeyDirective } from './shared/map-pointer-position-by-key.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoLanguageModule,\r\n    IgoConfirmDialogModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule\r\n  ],\r\n  exports: [\r\n    MapBrowserComponent,\r\n    ZoomButtonComponent,\r\n    GeolocateButtonComponent,\r\n    RotationButtonComponent,\r\n    BaseLayersSwitcherComponent,\r\n    MiniBaseMapComponent,\r\n    MapOfflineDirective,\r\n    OfflineButtonComponent,\r\n    PointerPositionDirective,\r\n    PointerPositionByKeyDirective\r\n  ],\r\n  declarations: [\r\n    MapBrowserComponent,\r\n    ZoomButtonComponent,\r\n    GeolocateButtonComponent,\r\n    RotationButtonComponent,\r\n    BaseLayersSwitcherComponent,\r\n    MiniBaseMapComponent,\r\n    MapOfflineDirective,\r\n    OfflineButtonComponent,\r\n    PointerPositionDirective,\r\n    PointerPositionByKeyDirective\r\n  ]\r\n})\r\nexport class IgoMapModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\n\r\nimport {\r\n  MeasureType,\r\n  MeasureAreaUnit,\r\n  MeasureLengthUnit\r\n} from '../shared/measure.enum';\r\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\r\n\r\n/**\r\n * Measurer item\r\n */\r\n@Component({\r\n  selector: 'igo-measurer-item',\r\n  templateUrl: './measurer-item.component.html',\r\n  styleUrls: ['./measurer-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class MeasurerItemComponent implements OnDestroy {\r\n\r\n  /**\r\n   * Measure observable\r\n   * @internal\r\n   */\r\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the measure observable when the auto mode is on\r\n   * @internal\r\n   */\r\n  public measure$$: Subscription;\r\n\r\n  /**\r\n   * Measure type\r\n   */\r\n  @Input() measureType: MeasureType;\r\n\r\n  /**\r\n   * Measure unit\r\n   */\r\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\r\n\r\n  /**\r\n   * Measure\r\n   */\r\n  @Input()\r\n  set measure(value: number) {\r\n    this.measure$.next(value);\r\n  }\r\n  get measure(): number { return this.measure$.value; }\r\n\r\n  /**\r\n   * Whther measure units should be automatically determined\r\n   */\r\n  @Input()\r\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\r\n  get auto(): boolean { return this._auto; }\r\n  private _auto: boolean = false;\r\n\r\n  /**\r\n   * Placeholder\r\n   */\r\n  @Input() placeholder: string;\r\n\r\n  /**\r\n   * Event emitted when the measure unit changes\r\n   */\r\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\r\n\r\n  /**\r\n   * Available measure units for the measure type given\r\n   * @internal\r\n   */\r\n  get measureUnits(): string[] {\r\n    if (this.measureType === MeasureType.Area) {\r\n      return Object.values(MeasureAreaUnit);\r\n    }\r\n    return Object.values(MeasureLengthUnit);\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Toggle the auto unit off\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.toggleAutoUnit(false);\r\n  }\r\n\r\n  /**\r\n   * Set the measure unit\r\n   * @internal\r\n   */\r\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\r\n    this.measureUnit = unit;\r\n    this.measureUnitChange.emit(unit);\r\n  }\r\n\r\n  private toggleAutoUnit(toggle: boolean) {\r\n    if (this.measure$$ !== undefined) {\r\n      this.measure$$.unsubscribe();\r\n    }\r\n    if (toggle === true) {\r\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\r\n        this.computeBestMeasureUnit(measure);\r\n      });\r\n    }\r\n    this._auto = toggle;\r\n  }\r\n\r\n  private computeBestMeasureUnit(measure: number) {\r\n    let measureUnit = this.measureUnit;\r\n    if (this.measureType === MeasureType.Area) {\r\n      measureUnit = computeBestAreaUnit(measure);\r\n    } else if (this.measureType === MeasureType.Length) {\r\n      measureUnit = computeBestLengthUnit(measure);\r\n    }\r\n    if (measureUnit !== this.measureUnit) {\r\n      this.onMeasureUnitChange(measureUnit);\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatButtonModule,\r\n  MatButtonToggleModule,\r\n  MatIconModule,\r\n  MatTooltipModule,\r\n  MatFormFieldModule,\r\n  MatInputModule,\r\n  MatSelectModule,\r\n  MatSlideToggleModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoEntityTableModule } from '@igo2/common';\r\n\r\nimport { MeasureFormatPipe } from './measure-format.pipe';\r\nimport { MeasurerItemComponent } from './measurer-item.component';\r\nimport { MeasurerComponent } from './measurer.component';\r\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    MatButtonToggleModule,\r\n    MatIconModule,\r\n    MatTooltipModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSelectModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoEntityTableModule\r\n  ],\r\n  declarations: [\r\n    MeasureFormatPipe,\r\n    MeasurerItemComponent,\r\n    MeasurerComponent,\r\n    MeasurerDialogComponent\r\n  ],\r\n  exports: [\r\n    MeasureFormatPipe,\r\n    MeasurerComponent\r\n  ],\r\n  entryComponents: [\r\n    MeasurerDialogComponent\r\n  ]\r\n})\r\nexport class IgoMeasurerModule {}\r\n","import { NgModule } from '@angular/core';\r\n\r\nimport { IgoMeasurerModule } from './measurer/measurer.module';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [\r\n    IgoMeasurerModule\r\n  ]\r\n})\r\nexport class IgoMeasureModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\n\r\nimport { OverlayDirective } from './shared/overlay.directive';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  exports: [OverlayDirective],\r\n  declarations: [OverlayDirective]\r\n})\r\nexport class IgoOverlayModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoOverlayModule\r\n    };\r\n  }\r\n}\r\n","import { strEnum } from '@igo2/utils';\r\n\r\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\r\n\r\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\r\n\r\nexport const PrintPaperFormat = strEnum([\r\n  'A0',\r\n  'A1',\r\n  'A2',\r\n  'A3',\r\n  'A4',\r\n  'A5',\r\n  'Letter',\r\n  'Legal'\r\n]);\r\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\r\n\r\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\r\nexport type PrintOrientation = keyof typeof PrintOrientation;\r\n\r\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\r\nexport type PrintResolution = keyof typeof PrintResolution;\r\n\r\nexport const PrintSaveImageFormat = strEnum([\r\n  'Bmp',\r\n  'Gif',\r\n  'Jpeg',\r\n  'Png',\r\n  'Tiff'\r\n]);\r\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\r\n","import { Injectable } from '@angular/core';\r\nimport { Subject } from 'rxjs';\r\nimport { saveAs } from 'file-saver';\r\nimport * as jsPDF from 'jspdf';\r\nimport * as _html2canvas from 'html2canvas';\r\nimport * as JSZip from 'jszip';\r\n\r\nimport { SubjectStatus } from '@igo2/utils';\r\nimport { MessageService, ActivityService, LanguageService } from '@igo2/core';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { formatScale } from '../../map/shared/map.utils';\r\nimport { OutputLayerLegend } from '../../layer/shared/layers/layer.interface';\r\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\r\n\r\nimport { PrintOptions } from './print.interface';\r\n\r\nconst html2canvas = _html2canvas;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PrintService {\r\n  zipFile: JSZip;\r\n  nbFileToProcess: number;\r\n  activityId: string;\r\n  constructor(\r\n    private messageService: MessageService,\r\n    private activityService: ActivityService,\r\n    private languageService: LanguageService\r\n  ) {}\r\n\r\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\r\n    const status$ = new Subject();\r\n\r\n    const paperFormat: string = options.paperFormat;\r\n    const resolution = +options.resolution; // Default is 96\r\n    const orientation = options.orientation;\r\n\r\n    this.activityId = this.activityService.register();\r\n    const doc = new jsPDF({\r\n      orientation,\r\n      format: paperFormat.toLowerCase()\r\n    });\r\n\r\n    const dimensions = [\r\n      doc.internal.pageSize.width,\r\n      doc.internal.pageSize.height\r\n    ];\r\n\r\n    const margins = [20, 10, 20, 10];\r\n    const width = dimensions[0] - margins[3] - margins[1];\r\n    const height = dimensions[1] - margins[0] - margins[2];\r\n    const size = [width, height];\r\n\r\n    if (options.title !== undefined) {\r\n      this.addTitle(doc, options.title, dimensions[0]);\r\n    }\r\n\r\n    if (options.showProjection === true || options.showScale === true) {\r\n      this.addProjScale(\r\n        doc,\r\n        map,\r\n        resolution,\r\n        options.showProjection,\r\n        options.showScale\r\n      );\r\n    }\r\n    if (options.comment !== '') {\r\n      this.addComment(doc, options.comment);\r\n    }\r\n\r\n    this.addMap(doc, map, resolution, size, margins).subscribe(\r\n      (status: SubjectStatus) => {\r\n        if (status === SubjectStatus.Done) {\r\n          if (options.showLegend === true) {\r\n            this.addLegend(doc, map, margins, resolution);\r\n          } else {\r\n            this.saveDoc(doc);\r\n          }\r\n        }\r\n\r\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\r\n          this.activityService.unregister(this.activityId);\r\n          status$.next(SubjectStatus.Done);\r\n        }\r\n      }\r\n    );\r\n\r\n    return status$;\r\n  }\r\n\r\n  /**\r\n   * Get html code for all layers legend\r\n   * @param  map IgoMap\r\n   * @param  width The width that the legend need to be\r\n   * @return Html code for the legend\r\n   */\r\n  getLayersLegendHtml(map: IgoMap, width: number, resolution: number): string {\r\n    let html = '';\r\n    const legends = getLayersLegends(\r\n      map.layers,\r\n      map.viewController.getScale(resolution)\r\n    );\r\n    if (legends.length === 0) {\r\n      return html;\r\n    }\r\n\r\n    // Define important style to be sure that all container is convert\r\n    // to image not just visible part\r\n    html += '<style media=\"screen\" type=\"text/css\">';\r\n    html += '.html2canvas-container { width: ' + width;\r\n    html += 'mm !important; height: 2000px !important; }';\r\n    html += '</style>';\r\n    html += '<font size=\"2\" face=\"Courier New\" >';\r\n    html += '<div style=\"display:inline-block;max-width:' + width + 'mm\">';\r\n    // For each legend, define an html table cell\r\n    legends.forEach((legend: OutputLayerLegend) => {\r\n      html +=\r\n        '<table border=1 style=\"display:inline-block;vertical-align:top\">';\r\n      html += '<tr><th width=\"170px\">' + legend.title + '</th>';\r\n      html += '<td><img class=\"printImageLegend\" src=\"' + legend.url + '\">';\r\n      html += '</td></tr></table>';\r\n    });\r\n    html += '</div>';\r\n\r\n    return html;\r\n  }\r\n\r\n  /**\r\n   * Get all the legend in a single image\r\n   * * @param  format - Image format. default value to \"png\"\r\n   * @return The image of the legend\r\n   */\r\n  getLayersLegendImage(\r\n    map,\r\n    format: string = 'png',\r\n    doZipFile: boolean,\r\n    resolution: number\r\n  ) {\r\n    const status$ = new Subject();\r\n    // Get html code for the legend\r\n    const width = 200; // milimeters unit, originally define for document pdf\r\n    let html = this.getLayersLegendHtml(map, width, resolution);\r\n    const that = this;\r\n    format = format.toLowerCase();\r\n\r\n    // If no legend show No LEGEND in an image\r\n    if (html.length === 0) {\r\n      html = '<font size=\"12\" face=\"Courier New\" >';\r\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\r\n    }\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n    // Define event to execute after all images are loaded to create the canvas\r\n    setTimeout(() => {\r\n      html2canvas(div, { useCORS: true })\r\n        .then(canvas => {\r\n          let status = SubjectStatus.Done;\r\n          try {\r\n            if (!doZipFile) {\r\n              // Save the canvas as file\r\n              that.saveCanvasImageAsFile(canvas, 'legendImage', format);\r\n            } else {\r\n              // Add the canvas to zip\r\n              that.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\r\n            }\r\n            div.parentNode.removeChild(div); // remove temp div (IE)\r\n          } catch (err) {\r\n            status = SubjectStatus.Error;\r\n          }\r\n          status$.next(status);\r\n        })\r\n        .catch(e => {\r\n          console.log(e);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  private addTitle(doc: jsPDF, title: string, pageWidth: number) {\r\n    const pdfResolution = 96;\r\n    const titleSize = 32;\r\n    const titleWidth = ((titleSize * 25.4) / pdfResolution) * title.length;\r\n\r\n    let titleMarginLeft;\r\n    if (titleWidth > pageWidth) {\r\n      titleMarginLeft = 0;\r\n    } else {\r\n      titleMarginLeft = (pageWidth - titleWidth) / 2;\r\n    }\r\n\r\n    doc.setFont('courier');\r\n    doc.setFontSize(32);\r\n    doc.text(title, titleMarginLeft, 15);\r\n  }\r\n\r\n  /**\r\n   * Add comment to the document\r\n   * * @param  doc - pdf document\r\n   * * @param  comment - Comment to add in the document\r\n   * * @param  size - Size of the document\r\n   */\r\n  private addComment(doc: jsPDF, comment: string) {\r\n    const commentSize = 16;\r\n    const commentMarginLeft = 20;\r\n    const marginBottom = 5;\r\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\r\n\r\n    doc.setFont('courier');\r\n    doc.setFontSize(commentSize);\r\n    doc.text(comment, commentMarginLeft, heightPixels);\r\n  }\r\n  /**\r\n   * Add projection and/or scale to the document\r\n   * @param  doc - pdf document\r\n   * @param  map - Map of the app\r\n   * @param  dpi - DPI resolution of the document\r\n   * @param  projection - Bool to indicate if projection need to be added\r\n   * @param  scale - Bool to indicate if scale need to be added\r\n   */\r\n  private addProjScale(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    dpi: number,\r\n    projection: boolean,\r\n    scale: boolean\r\n  ) {\r\n    const translate = this.languageService.translate;\r\n    const projScaleSize = 16;\r\n    const projScaleMarginLeft = 20;\r\n    const marginBottom = 15;\r\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\r\n\r\n    let textProjScale: string = '';\r\n    if (projection === true) {\r\n      const projText = translate.instant('igo.geo.printForm.projection');\r\n      textProjScale += projText + ': ' + map.projection;\r\n    }\r\n    if (scale === true) {\r\n      if (projection === true) {\r\n        textProjScale += '   ';\r\n      }\r\n      const scaleText = translate.instant('igo.geo.printForm.scale');\r\n      const mapScale = map.viewController.getScale(dpi);\r\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\r\n    }\r\n    doc.setFont('courier');\r\n    doc.setFontSize(projScaleSize);\r\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\r\n  }\r\n\r\n  /**\r\n   * Add the legend to the document\r\n   * @param  doc - Pdf document where legend will be added\r\n   * @param  map - Map of the app\r\n   * @param  margins - Page margins\r\n   */\r\n  private addLegend(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    margins: Array<number>,\r\n    resolution: number\r\n  ) {\r\n    const that = this;\r\n    // Get html code for the legend\r\n    const width = doc.internal.pageSize.width;\r\n    const html = this.getLayersLegendHtml(map, width, resolution);\r\n    // If no legend, save the map directly\r\n    if (html === '') {\r\n      this.saveDoc(doc);\r\n      return true;\r\n    }\r\n\r\n    // Create div to contain html code for legend\r\n    const div = window.document.createElement('div');\r\n    html2canvas(div, { useCORS: true })\r\n      .then(canvas => {\r\n        let imgData;\r\n        const position = 10;\r\n\r\n        imgData = canvas.toDataURL('image/png');\r\n        doc.addPage();\r\n        const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\r\n        doc.addImage(imgData, 'PNG', 10, position, imageSize[0], imageSize[1]);\r\n        that.saveDoc(doc);\r\n        div.parentNode.removeChild(div); // remove temp div (IE style)\r\n      })\r\n      .catch(e => {\r\n        console.log(e);\r\n      });\r\n\r\n    // Add html code to convert in the new window\r\n    window.document.body.appendChild(div);\r\n    div.innerHTML = html;\r\n  }\r\n\r\n  private addCanvas(\r\n    doc: jsPDF,\r\n    canvas: HTMLCanvasElement,\r\n    margins: Array<number>\r\n  ) {\r\n    let image;\r\n\r\n    image = canvas.toDataURL('image/jpeg');\r\n\r\n    if (image !== undefined) {\r\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\r\n      doc.addImage(\r\n        image,\r\n        'JPEG',\r\n        margins[3],\r\n        margins[0],\r\n        imageSize[0],\r\n        imageSize[1]\r\n      );\r\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\r\n    }\r\n  }\r\n\r\n  // TODO fix printing with image resolution\r\n  private addMap(\r\n    doc: jsPDF,\r\n    map: IgoMap,\r\n    resolution: number,\r\n    size: Array<number>,\r\n    margins: Array<number>\r\n  ) {\r\n    const status$ = new Subject();\r\n\r\n    const mapSize = map.ol.getSize();\r\n    const extent = map.ol.getView().calculateExtent(mapSize);\r\n\r\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\r\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\r\n\r\n    let timeout;\r\n\r\n    map.ol.once('postcompose', (event: any) => {\r\n      const canvas = event.context.canvas;\r\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\r\n        clearTimeout(timeout);\r\n\r\n        if (mapStatus !== SubjectStatus.Done) {\r\n          return;\r\n        }\r\n\r\n        mapStatus$$.unsubscribe();\r\n\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          this.addCanvas(doc, canvas, margins);\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageBody'\r\n            ),\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageHeader'\r\n            ),\r\n            'print'\r\n          );\r\n        }\r\n\r\n        this.renderMap(map, mapSize, extent);\r\n        status$.next(status);\r\n      });\r\n\r\n      // If no loading as started after 200ms, then probably no loading\r\n      // is required.\r\n      timeout = window.setTimeout(() => {\r\n        mapStatus$$.unsubscribe();\r\n\r\n        let status = SubjectStatus.Done;\r\n        try {\r\n          this.addCanvas(doc, canvas, margins);\r\n        } catch (err) {\r\n          status = SubjectStatus.Error;\r\n          this.messageService.error(\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageBody'\r\n            ),\r\n            this.languageService.translate.instant(\r\n              'igo.geo.printForm.corsErrorMessageHeader'\r\n            ),\r\n            'print'\r\n          );\r\n        }\r\n\r\n        this.renderMap(map, mapSize, extent);\r\n        status$.next(status);\r\n      }, 200);\r\n    });\r\n\r\n    this.renderMap(map, [widthPixels, heightPixels], extent);\r\n\r\n    return status$;\r\n  }\r\n\r\n  defineNbFileToProcess(nbFileToProcess) {\r\n    this.nbFileToProcess = nbFileToProcess;\r\n  }\r\n\r\n  /**\r\n   * Download an image of the map with addition of informations\r\n   * @param  map - Map of the app\r\n   * @param  format - Image format. default value to \"png\"\r\n   * @param  projection - Indicate if projection need to be add. Default to false\r\n   * @param  scale - Indicate if scale need to be add. Default to false\r\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\r\n   * @param  title - Title to add for the map - Default to blank\r\n   * @param  comment - Comment to add for the map - Default to blank\r\n   * @param  doZipFile - Indicate if we do a zip with the file\r\n   * @return Image file of the map with extension format given as parameter\r\n   */\r\n  downloadMapImage(\r\n    map: IgoMap,\r\n    resolution: number,\r\n    format = 'png',\r\n    projection = false,\r\n    scale = false,\r\n    legend = false,\r\n    title = '',\r\n    comment = '',\r\n    doZipFile = true\r\n  ) {\r\n    const status$ = new Subject();\r\n    // const resolution = map.ol.getView().getResolution();\r\n    this.activityId = this.activityService.register();\r\n    const translate = this.languageService.translate;\r\n    map.ol.once('postcompose', (event: any) => {\r\n      format = format.toLowerCase();\r\n      const context = event.context;\r\n      const newCanvas = document.createElement('canvas');\r\n      const newContext = newCanvas.getContext('2d');\r\n      // Postion in height to set the canvas in new canvas\r\n      let positionHCanvas = 0;\r\n      // Position in width to set the Proj/Scale in new canvas\r\n      let positionWProjScale = 10;\r\n      // Get height/width of map canvas\r\n      const width = context.canvas.width;\r\n      let height = context.canvas.height;\r\n      // Set Font to calculate comment width\r\n      newContext.font = '20px Calibri';\r\n      const commentWidth = newContext.measureText(comment).width;\r\n      // Add height for title if defined\r\n      height = title !== '' ? height + 30 : height;\r\n      // Add height for projection or scale (same line) if defined\r\n      height = projection !== false || scale !== false ? height + 30 : height;\r\n      const positionHProjScale = height - 10;\r\n      // Define number of line depending of the comment length\r\n      const commentNbLine = Math.ceil(commentWidth / width);\r\n      // Add height for multiline comment if defined\r\n      height = comment !== '' ? height + commentNbLine * 30 : height;\r\n      let positionHComment = height - commentNbLine * 20 + 5;\r\n      // Set the new canvas with the new calculated size\r\n      newCanvas.width = width;\r\n      newCanvas.height = height;\r\n      // Patch Jpeg default black background to white\r\n      if (format === 'jpeg') {\r\n        newContext.fillStyle = '#ffffff';\r\n        newContext.fillRect(0, 0, width, height);\r\n        newContext.fillStyle = '#000000';\r\n      }\r\n      // If a title need to be added to canvas\r\n      if (title !== '') {\r\n        // Set font for title\r\n        newContext.font = '26px Calibri';\r\n        positionHCanvas = 30;\r\n        newContext.textAlign = 'center';\r\n        newContext.fillText(title, width / 2, 20);\r\n      }\r\n      // Set font for next section\r\n      newContext.font = '20px Calibri';\r\n      // If projection need to be added to canvas\r\n      if (projection !== false) {\r\n        const projText = translate.instant('igo.geo.printForm.projection');\r\n        newContext.textAlign = 'start';\r\n        newContext.fillText(\r\n          projText + ': ' + map.projection,\r\n          positionWProjScale,\r\n          positionHProjScale\r\n        );\r\n        positionWProjScale += 200; // Width position change for scale position\r\n      }\r\n      // If scale need to be added to canvas\r\n      if (scale !== false) {\r\n        const scaleText = translate.instant('igo.geo.printForm.scale');\r\n        const mapScale = map.viewController.getScale(resolution);\r\n        newContext.textAlign = 'start';\r\n        newContext.fillText(\r\n          scaleText + ': ~ 1 / ' + formatScale(mapScale),\r\n          positionWProjScale,\r\n          positionHProjScale\r\n        );\r\n      }\r\n      // If a comment need to be added to canvas\r\n      if (comment !== '') {\r\n        newContext.textAlign = 'center';\r\n        // If only one line, no need to multiline the comment\r\n        if (commentNbLine === 1) {\r\n          newContext.fillText(comment, width / 2, positionHComment);\r\n        } else {\r\n          // Separate the setenses to be approx. the same length\r\n          const nbCommentChar = comment.length;\r\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\r\n          let commentCurrentLine = '';\r\n          let positionFirstCutChar = 0;\r\n          let positionLastBlank;\r\n          // Loop for the number of line calculated\r\n          for (let i = 0; i < commentNbLine; i++) {\r\n            // For all line except last\r\n            if (commentNbLine - 1 > i) {\r\n              // Get comment current line to find the right place tu cut comment\r\n              commentCurrentLine = comment.substr(\r\n                positionFirstCutChar,\r\n                CommentLengthToCut\r\n              );\r\n              // Cut the setence at blank\r\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\r\n              newContext.fillText(\r\n                commentCurrentLine.substr(0, positionLastBlank),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n              positionFirstCutChar += positionLastBlank;\r\n              // Go to next line for insertion\r\n              positionHComment += 20;\r\n            } else {\r\n              // Don't cut last part\r\n              newContext.fillText(\r\n                comment.substr(positionFirstCutChar),\r\n                width / 2,\r\n                positionHComment\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // Add map to new canvas\r\n      newContext.drawImage(context.canvas, 0, positionHCanvas);\r\n\r\n      let status = SubjectStatus.Done;\r\n      try {\r\n        // Save the canvas as file\r\n        if (!doZipFile) {\r\n          this.saveCanvasImageAsFile(newCanvas, 'map', format);\r\n        } else if (format.toLowerCase() === 'tiff') {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(\r\n            newCanvas,\r\n            'map' + map.projection.replace(':', '_') + '.' + format\r\n          );\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.generateCanvaFileToZip(newCanvas, 'map' + '.' + format);\r\n        }\r\n      } catch (err) {\r\n        status = SubjectStatus.Error;\r\n      }\r\n\r\n      status$.next(status);\r\n\r\n      if (format.toLowerCase() === 'tiff') {\r\n        const tiwContent = this.getWorldFileInformation(map);\r\n        const blob = new Blob([tiwContent], {\r\n          type: 'text/plain;charset=utf-8'\r\n        });\r\n        if (!doZipFile) {\r\n          // saveAs automaticly replace ':' for '_'\r\n          saveAs(blob, 'map' + map.projection + '.tfw');\r\n          this.saveFileProcessing();\r\n        } else {\r\n          // Add the canvas to zip\r\n          this.addFileToZip(\r\n            'map' + map.projection.replace(':', '_') + '.tfw',\r\n            blob\r\n          );\r\n        }\r\n      }\r\n    });\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  private renderMap(map, size, extent) {\r\n    map.ol.renderSync();\r\n  }\r\n\r\n  /**\r\n   * Save document\r\n   * @param  doc - Document to save\r\n   */\r\n  protected saveDoc(doc: jsPDF) {\r\n    doc.save('map.pdf');\r\n  }\r\n\r\n  /**\r\n   * Calculate the best Image size to fit in pdf\r\n   * @param doc - Pdf Document\r\n   * @param canvas - Canvas of image\r\n   * @param margins - Page margins\r\n   */\r\n  private getImageSizeToFitPdf(doc, canvas, margins) {\r\n    // Define variable to calculate best size to fit in one page\r\n    const pageHeight =\r\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\r\n    const pageWidth =\r\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\r\n    const canHeight = canvas.height;\r\n    const canWidth = canvas.width;\r\n    const heightRatio = canHeight / pageHeight;\r\n    const widthRatio = canWidth / pageWidth;\r\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\r\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\r\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\r\n\r\n    return [imgWidth, imgHeigh];\r\n  }\r\n\r\n  /**\r\n   * Get a world file information for tiff\r\n   * @param  map - Map of the app\r\n   */\r\n  private getWorldFileInformation(map) {\r\n    const currentResolution = map.viewController.getResolution();\r\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\r\n    return [\r\n      currentResolution,\r\n      0,\r\n      0,\r\n      -currentResolution,\r\n      currentExtent[0] + currentResolution / 0.5,\r\n      currentExtent[3] - currentResolution / 0.5\r\n    ].join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Save canvas image as file\r\n   * @param canvas - Canvas to save\r\n   * @param name - Name of the file\r\n   * @param format - file format\r\n   */\r\n  private saveCanvasImageAsFile(canvas, name, format) {\r\n    const blobFormat = 'image/' + format;\r\n    const that = this;\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      // If navigator is Internet Explorer\r\n      if (navigator.msSaveBlob) {\r\n        navigator.msSaveBlob(canvas.msToBlob(), name + '.' + format);\r\n        this.saveFileProcessing();\r\n      } else {\r\n        canvas.toBlob(blob => {\r\n          // download image\r\n          saveAs(blob, name + '.' + format);\r\n          that.saveFileProcessing();\r\n        }, blobFormat);\r\n      }\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageBody'\r\n        ),\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageHeader'\r\n        ),\r\n        'print'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to a zip\r\n   * @param canvas - File to add to the zip\r\n   * @param  name -Name of the fileoverview\r\n   */\r\n  private generateCanvaFileToZip(canvas, name) {\r\n    const blobFormat = 'image/' + 'jpeg';\r\n    const that = this;\r\n    if (\r\n      !this.hasOwnProperty('zipFile') ||\r\n      typeof this.zipFile === 'undefined'\r\n    ) {\r\n      this.zipFile = new JSZip();\r\n    }\r\n\r\n    try {\r\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\r\n      if (navigator.msSaveBlob) {\r\n        this.addFileToZip(name, canvas.msToBlob());\r\n      } else {\r\n        canvas.toBlob(blob => {\r\n          that.addFileToZip(name, blob);\r\n        }, blobFormat);\r\n      }\r\n    } catch (err) {\r\n      this.messageService.error(\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageBody'\r\n        ),\r\n        this.languageService.translate.instant(\r\n          'igo.geo.printForm.corsErrorMessageHeader'\r\n        ),\r\n        'print'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add file to zip, if all file are zipped, download\r\n   * @param name - Name of the files\r\n   * @param blob - Contain of file\r\n   */\r\n  private addFileToZip(name, blob) {\r\n    // add file to zip\r\n    this.zipFile.file(name, blob);\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Download zip file\r\n      this.getZipFile();\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  private saveFileProcessing() {\r\n    this.nbFileToProcess--;\r\n\r\n    // If all files are proccessed\r\n    if (this.nbFileToProcess === 0) {\r\n      // Stop loading\r\n      this.activityService.unregister(this.activityId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the zipped file\r\n   * @return Retun a zip file\r\n   */\r\n  private getZipFile() {\r\n    const that = this;\r\n    this.zipFile.generateAsync({ type: 'blob' }).then(blob => {\r\n      // 1) generate the zip file\r\n      saveAs(blob, 'map.zip');\r\n      delete that.zipFile;\r\n    });\r\n  }\r\n}\r\n","import { Component, Input } from '@angular/core';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { PrintOptions } from '../shared/print.interface';\r\n\r\nimport {\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintOrientation,\r\n  PrintResolution,\r\n  PrintSaveImageFormat\r\n} from '../shared/print.type';\r\n\r\nimport { PrintService } from '../shared/print.service';\r\n\r\n@Component({\r\n  selector: 'igo-print',\r\n  templateUrl: './print.component.html'\r\n})\r\nexport class PrintComponent {\r\n  public disabled = false;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this._outputFormat;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this._outputFormat = value;\r\n  }\r\n  private _outputFormat: PrintOutputFormat;\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this._paperFormat;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this._paperFormat = value;\r\n  }\r\n  private _paperFormat: PrintPaperFormat;\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this._orientation;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this._orientation = value;\r\n  }\r\n  private _orientation: PrintOrientation;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this._imageFormat;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this._imageFormat = value;\r\n  }\r\n  private _imageFormat: PrintSaveImageFormat;\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this._resolution;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this._resolution = value;\r\n  }\r\n  private _resolution: PrintResolution;\r\n\r\n  constructor(private printService: PrintService) {}\r\n\r\n  handleFormSubmit(data: PrintOptions) {\r\n    this.disabled = true;\r\n\r\n    if (data.isPrintService === true) {\r\n      this.printService\r\n        .print(this.map, data)\r\n        .subscribe();\r\n    } else {\r\n      let nbFileToProcess = 1;\r\n\r\n      if (data.showLegend) {\r\n        nbFileToProcess++;\r\n      }\r\n      if (data.imageFormat.toLowerCase() === 'tiff') {\r\n        nbFileToProcess++;\r\n      }\r\n\r\n      this.printService.defineNbFileToProcess(nbFileToProcess);\r\n\r\n      const resolution = +data.resolution;\r\n      this.printService.downloadMapImage(\r\n        this.map,\r\n        resolution,\r\n        data.imageFormat,\r\n        data.showProjection,\r\n        data.showScale,\r\n        data.showLegend,\r\n        data.title,\r\n        data.comment,\r\n        data.doZipFile\r\n      );\r\n      if (data.showLegend) {\r\n        this.printService.getLayersLegendImage(\r\n          this.map,\r\n          data.imageFormat,\r\n          data.doZipFile,\r\n          +resolution\r\n        );\r\n      }\r\n    }\r\n    this.disabled = false;\r\n  }\r\n}\r\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\r\nimport {\r\n  FormGroup,\r\n  FormBuilder,\r\n  FormControl,\r\n  Validators\r\n} from '@angular/forms';\r\n\r\nimport { PrintOptions } from '../shared/print.interface';\r\n\r\nimport {\r\n  PrintOutputFormat,\r\n  PrintPaperFormat,\r\n  PrintOrientation,\r\n  PrintResolution,\r\n  PrintSaveImageFormat\r\n} from '../shared/print.type';\r\n\r\n@Component({\r\n  selector: 'igo-print-form',\r\n  templateUrl: './print-form.component.html',\r\n  styleUrls: ['./print-form.component.scss']\r\n})\r\nexport class PrintFormComponent implements OnInit {\r\n  public form: FormGroup;\r\n  public submitted: boolean;\r\n\r\n  public outputFormats = PrintOutputFormat;\r\n  public paperFormats = PrintPaperFormat;\r\n  public orientations = PrintOrientation;\r\n  public resolutions = PrintResolution;\r\n  public imageFormats = PrintSaveImageFormat;\r\n  public isPrintService = true;\r\n\r\n  @Input()\r\n  get disabled(): boolean {\r\n    return this._disabled;\r\n  }\r\n  set disabled(value: boolean) {\r\n    this._disabled = value;\r\n  }\r\n  private _disabled = false;\r\n\r\n  @Input()\r\n  get imageFormat(): PrintSaveImageFormat {\r\n    return this.imageFormatField.value;\r\n  }\r\n  set imageFormat(value: PrintSaveImageFormat) {\r\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get outputFormat(): PrintOutputFormat {\r\n    return this.outputFormatField.value;\r\n  }\r\n  set outputFormat(value: PrintOutputFormat) {\r\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get paperFormat(): PrintPaperFormat {\r\n    return this.paperFormatField.value;\r\n  }\r\n  set paperFormat(value: PrintPaperFormat) {\r\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get orientation(): PrintOrientation {\r\n    return this.orientationField.value;\r\n  }\r\n  set orientation(value: PrintOrientation) {\r\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get resolution(): PrintResolution {\r\n    return this.resolutionField.value;\r\n  }\r\n  set resolution(value: PrintResolution) {\r\n    this.resolutionField.setValue(value || PrintResolution['96'], {\r\n      onlySelf: true\r\n    });\r\n  }\r\n\r\n  @Input()\r\n  get title(): string {\r\n    return this.titleField.value;\r\n  }\r\n  set title(value: string) {\r\n    this.titleField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  @Input()\r\n  get comment(): string {\r\n    return this.commentField.value;\r\n  }\r\n  set comment(value: string) {\r\n    this.commentField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showProjection(): boolean {\r\n    return this.showProjectionField.value;\r\n  }\r\n  set showProjection(value: boolean) {\r\n    this.showProjectionField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showScale(): boolean {\r\n    return this.showScaleField.value;\r\n  }\r\n  set showScale(value: boolean) {\r\n    this.showScaleField.setValue(value, { onlySelf: true });\r\n  }\r\n  @Input()\r\n  get showLegend(): boolean {\r\n    return this.showLegendField.value;\r\n  }\r\n  set showLegend(value: boolean) {\r\n    this.showLegendField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  @Input()\r\n  get doZipFile(): boolean {\r\n    return this.doZipFileField.value;\r\n  }\r\n  set doZipFile(value: boolean) {\r\n    this.doZipFileField.setValue(value, { onlySelf: true });\r\n  }\r\n\r\n  get outputFormatField() {\r\n    return (this.form.controls as any).outputFormat as FormControl;\r\n  }\r\n\r\n  get paperFormatField() {\r\n    return (this.form.controls as any).paperFormat as FormControl;\r\n  }\r\n\r\n  get imageFormatField() {\r\n    return (this.form.controls as any).imageFormat as FormControl;\r\n  }\r\n\r\n  get orientationField() {\r\n    return (this.form.controls as any).orientation as FormControl;\r\n  }\r\n\r\n  get resolutionField() {\r\n    return (this.form.controls as any).resolution as FormControl;\r\n  }\r\n\r\n  get commentField() {\r\n    return (this.form.controls as any).comment as FormControl;\r\n  }\r\n\r\n  get showProjectionField() {\r\n    return (this.form.controls as any).showProjection as FormControl;\r\n  }\r\n\r\n  get showScaleField() {\r\n    return (this.form.controls as any).showScale as FormControl;\r\n  }\r\n\r\n  get showLegendField() {\r\n    return (this.form.controls as any).showLegend as FormControl;\r\n  }\r\n\r\n  get doZipFileField() {\r\n    return (this.form.controls as any).doZipFile as FormControl;\r\n  }\r\n\r\n  get titleField() {\r\n    return (this.form.controls as any).title as FormControl;\r\n  }\r\n\r\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\r\n\r\n  constructor(private formBuilder: FormBuilder) {\r\n    this.form = this.formBuilder.group({\r\n      title: ['', []],\r\n      comment: ['', []],\r\n      outputFormat: ['', [Validators.required]],\r\n      paperFormat: ['', [Validators.required]],\r\n      imageFormat: [ '', [Validators.required]],\r\n      resolution: ['', [Validators.required]],\r\n      orientation: ['', [Validators.required]],\r\n      showProjection: false,\r\n      showScale: false,\r\n      showLegend: false,\r\n      doZipFile: [{hidden: this.isPrintService }]\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.doZipFileField.setValue(false);\r\n  }\r\n\r\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\r\n    this.submitted = true;\r\n    data.isPrintService = this.isPrintService;\r\n    if (isValid) {\r\n      this.submit.emit(data);\r\n    }\r\n  }\r\n\r\n  toggleImageSaveProp() {\r\n    if (this.outputFormatField.value === 'Image') {\r\n      this.isPrintService = false;\r\n    } else {\r\n      this.isPrintService = true;\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport {\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatSelectModule,\r\n  MatOptionModule,\r\n  MatInputModule,\r\n  MatFormFieldModule,\r\n  MatSlideToggleModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\nimport { IgoKeyValueModule } from '@igo2/common';\r\n\r\nimport { PrintComponent } from './print/print.component';\r\nimport { PrintFormComponent } from './print-form/print-form.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatSelectModule,\r\n    MatOptionModule,\r\n    MatInputModule,\r\n    MatFormFieldModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule,\r\n    IgoKeyValueModule\r\n  ],\r\n  exports: [PrintComponent, PrintFormComponent],\r\n  declarations: [PrintComponent, PrintFormComponent]\r\n})\r\nexport class IgoPrintModule {}\r\n","import { ConfigService } from '@igo2/core';\r\n\r\nimport { SearchSource } from '../../search/shared/sources/source';\r\n\r\nimport { QuerySearchSource } from './query-search-source';\r\n\r\n/**\r\n * Map search source factory\r\n * @ignore\r\n */\r\nexport function querySearchSourceFactory(config: ConfigService) {\r\n  return new QuerySearchSource(\r\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the map search source\r\n */\r\nexport function provideQuerySearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: querySearchSourceFactory,\r\n    multi: true,\r\n    deps: [ConfigService]\r\n  };\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { QueryDirective } from './shared/query.directive';\r\nimport { QueryService } from './shared/query.service';\r\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  exports: [QueryDirective],\r\n  declarations: [QueryDirective],\r\n  providers: [QueryService]\r\n})\r\nexport class IgoQueryModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoQueryModule,\r\n      providers: [provideQuerySearchSource()]\r\n    };\r\n  }\r\n}\r\n","import { SearchSource } from './sources/source';\r\nimport { SearchSourceSettings } from './sources/source.interfaces';\r\n\r\n/**\r\n * Service where all available search sources are registered.\r\n */\r\nexport class SearchSourceService {\r\n\r\n  constructor(private sources: SearchSource[]) {}\r\n\r\n  /**\r\n   * Return available search sources\r\n   * @returns Search sources\r\n   */\r\n  getSources(): SearchSource[] {\r\n    return this.sources;\r\n  }\r\n\r\n  /**\r\n   * Return enabled search sources\r\n   * @returns Search sources\r\n   */\r\n  getEnabledSources(): SearchSource[] {\r\n    return this.getSources().filter(\r\n      (source: SearchSource) => source.enabled === true\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Enable search sources of given type\r\n   * @param type Search type\r\n   * @todo It would be better to track the enabled search sources\r\n   *  without updating their 'enabled' property.\r\n   */\r\n  enableSourcesByType(type: string) {\r\n    this.getSources().forEach((source: SearchSource) => {\r\n      if ((source.constructor as typeof SearchSource).type === type) {\r\n        source.enabled = true;\r\n      } else {\r\n        source.enabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set Param from the selected settings\r\n   * @param source search-source\r\n   * @param setting settings\r\n   */\r\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\r\n    source.setParamFromSetting(setting);\r\n  }\r\n}\r\n","import { FEATURE } from '../../feature/shared/feature.enums';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchSource } from './sources/source';\r\nimport { SearchResult } from './search.interfaces';\r\n\r\n/**\r\n * Function that checks whether a search source implements TextSearch\r\n * @param source Search source\r\n * @returns True if the search source implements TextSearch\r\n */\r\nexport function sourceCanSearch(source: SearchSource): boolean {\r\n  return (source as any).search !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch\r\n */\r\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\r\n  return (source as any).reverseSearch !== undefined;\r\n}\r\n\r\n/**\r\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\r\n * @param source Search source\r\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\r\n */\r\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\r\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\r\n}\r\n\r\n/**\r\n * Return a search result out of an Feature. This is used to adapt\r\n * the IGO query module to the new Feature/SearchResult interfaces\r\n * @param feature feature\r\n * @param source Search source\r\n * @returns SearchResult\r\n */\r\nexport function featureToSearchResult(\r\n  feature: Feature,\r\n  source: SearchSource\r\n): SearchResult<Feature> {\r\n  feature.sourceId = source.getId();\r\n  return {\r\n    source,\r\n    data: feature,\r\n    meta: {\r\n      dataType: FEATURE,\r\n      id: feature.meta.id as string,\r\n      title: feature.meta.title,\r\n      icon: feature.meta.icon || 'map-marker'\r\n    }\r\n  };\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { stringToLonLat } from '../../map';\r\nimport { MapService } from '../../map/shared/map.service';\r\n\r\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\r\nimport {\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './sources/source.interfaces';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { Research } from './search.interfaces';\r\nimport {\r\n  sourceCanSearch,\r\n  sourceCanReverseSearch,\r\n  sourceCanReverseSearchAsSummary\r\n} from './search.utils';\r\n\r\n/**\r\n * This service perform researches in all the search sources enabled.\r\n * It returns Research objects who's 'request' property needs to be\r\n * subscribed to in order to trigger the research. This services has\r\n * keeps internal state of the researches it performed\r\n * and the results they yielded.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SearchService {\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mapService: MapService\r\n  ) {}\r\n\r\n  /**\r\n   * Perform a research by text\r\n   * @param term Any text\r\n   * @returns Researches\r\n   */\r\n  search(term: string, options: TextSearchOptions = {}): Research[] {\r\n    if (!this.termIsValid(term)) {\r\n      return [];\r\n    }\r\n\r\n    const response = stringToLonLat(term, this.mapService.getMap().projection, {\r\n      forceNA: options.forceNA\r\n    });\r\n    if (response.lonLat) {\r\n      return this.reverseSearch(response.lonLat, { distance: response.radius });\r\n    } else if (response.message) {\r\n      console.log(response.message);\r\n    }\r\n\r\n    options.extent = this.mapService\r\n      .getMap()\r\n      .viewController.getExtent('EPSG:4326');\r\n\r\n    let sources;\r\n\r\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\r\n      sources = this.searchSourceService.getEnabledSources();\r\n    } else {\r\n      sources = this.searchSourceService.getSources();\r\n    }\r\n\r\n    if (options.sourceId) {\r\n      sources = sources.filter(source => source.getId() === options.sourceId);\r\n    } else if (options.searchType) {\r\n      sources = sources.filter(\r\n        source => source.getType() === options.searchType\r\n      );\r\n    }\r\n\r\n    sources = sources.filter(sourceCanSearch);\r\n    return this.searchSources(sources, term, options);\r\n  }\r\n\r\n  /**\r\n   * Perform a research by lon/lat\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Researches\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions,\r\n    asPointerSummary: boolean = false\r\n  ) {\r\n    const reverseSourceFonction = asPointerSummary\r\n      ? sourceCanReverseSearchAsSummary\r\n      : sourceCanReverseSearch;\r\n    const sources = this.searchSourceService\r\n      .getEnabledSources()\r\n      .filter(reverseSourceFonction);\r\n    return this.reverseSearchSources(sources, lonLat, options || {});\r\n  }\r\n\r\n  /**\r\n   * Create a text research out of all given search sources\r\n   * @param sources Search sources that implement TextSearch\r\n   * @param term Search term\r\n   * @returns Observable of Researches\r\n   */\r\n  private searchSources(\r\n    sources: SearchSource[],\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: ((source as any) as TextSearch).search(term, options),\r\n        reverse: false,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create a reverse research out of all given search sources\r\n   * @param sources Search sources that implement ReverseSearch\r\n   * @param lonLat Any lon/lat coordinates\r\n   * @returns Observable of Researches\r\n   */\r\n  private reverseSearchSources(\r\n    sources: SearchSource[],\r\n    lonLat: [number, number],\r\n    options: ReverseSearchOptions\r\n  ): Research[] {\r\n    return sources.map((source: SearchSource) => {\r\n      return {\r\n        request: ((source as any) as ReverseSearch).reverseSearch(\r\n          lonLat,\r\n          options\r\n        ),\r\n        reverse: true,\r\n        source\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validate that a search term is valid\r\n   * @param term Search term\r\n   * @returns True if the search term is valid\r\n   */\r\n  private termIsValid(term: string): boolean {\r\n    return typeof term === 'string' && term !== '';\r\n  }\r\n}\r\n","import { Observable } from 'rxjs';\r\n\r\nimport { Message } from '@igo2/core';\r\n\r\nimport { Directions, DirectionsOptions } from '../shared/directions.interface';\r\n\r\nexport abstract class DirectionsSource {\r\n  abstract enabled: boolean;\r\n  abstract getName(): string;\r\n  abstract route(coordinates: [number, number][], directionsOptions: DirectionsOptions): Observable<Directions[]>;\r\n}\r\n","import { DirectionsSource } from '../directions-sources/directions-source';\r\n\r\nexport class DirectionsSourceService {\r\n  constructor(public sources: DirectionsSource[]) {}\r\n}\r\n\r\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\r\n  return new DirectionsSourceService(sources);\r\n}\r\n\r\nexport function provideDirectionsSourceService() {\r\n  return {\r\n    provide: DirectionsSourceService,\r\n    useFactory: directionsSourceServiceFactory,\r\n    deps: [DirectionsSource]\r\n  };\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { Message } from '@igo2/core';\r\n\r\nimport { Directions, DirectionsOptions } from '../shared/directions.interface';\r\nimport { DirectionsSource } from '../directions-sources/directions-source';\r\nimport { DirectionsSourceService } from './directions-source.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DirectionsService {\r\n  constructor(private directionsSourceService: DirectionsSourceService) {}\r\n\r\n  route(coordinates: [number, number][], directionsOptions: DirectionsOptions = {}): Observable<Directions[]>[] {\r\n    if (coordinates.length === 0) {\r\n      return;\r\n    }\r\n    return this.directionsSourceService.sources\r\n      .filter((source: DirectionsSource) => source.enabled)\r\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\r\n  }\r\n\r\n  routeSource(\r\n    source: DirectionsSource,\r\n    coordinates: [number, number][],\r\n    directionsOptions: DirectionsOptions = {}\r\n  ): Observable<Directions[]> {\r\n    const request = source.route(coordinates, directionsOptions );\r\n    return request;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Stop } from '../shared/directions.interface';\r\n\r\n@Injectable()\r\nexport class DirectionsFormService {\r\n  private stops: Stop[];\r\n\r\n  constructor() {}\r\n\r\n  getStopsCoordinates(): [number, number][] {\r\n    const stopsCoordinates = [];\r\n    if (this.stops) {\r\n      this.stops.forEach(stop => {\r\n        stopsCoordinates.push(stop.stopCoordinates);\r\n      });\r\n    }\r\n    return stopsCoordinates;\r\n  }\r\n\r\n  setStops(stops: Stop[]) {\r\n    this.stops = stops;\r\n  }\r\n\r\n  getStops() {\r\n    return this.stops;\r\n  }\r\n\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy,\r\n  Optional,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators, FormArray } from '@angular/forms';\r\nimport { Subscription, Subject } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged, map, take, skipWhile } from 'rxjs/operators';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\nimport * as olgeom from 'ol/geom';\r\nimport * as olproj from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport * as olcondition from 'ol/events/condition';\r\nimport * as olinteraction from 'ol/interaction';\r\nimport * as olobservable from 'ol/Observable';\r\n\r\nimport { Clipboard } from '@igo2/utils';\r\nimport {\r\n  Message,\r\n  LanguageService,\r\n  MessageService,\r\n  RouteService\r\n} from '@igo2/core';\r\nimport { getEntityTitle } from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { SearchService } from '../../search/shared/search.service';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\r\nimport { moveToOlFeatures, tryBindStoreLayer, tryAddLoadingStrategy } from '../../feature/shared/feature.utils';\r\n\r\nimport { Directions, DirectionsOptions } from '../shared/directions.interface';\r\nimport { DirectionsService } from '../shared/directions.service';\r\nimport { DirectionsFormService } from './directions-form.service';\r\n\r\nimport { QueryService } from '../../query/shared/query.service';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\r\nimport { roundCoordTo } from '../../map/shared/map.utils';\r\n\r\n@Component({\r\n  selector: 'igo-directions-form',\r\n  templateUrl: './directions-form.component.html',\r\n  styleUrls: ['./directions-form.component.scss']\r\n})\r\nexport class DirectionsFormComponent implements OnInit, OnDestroy {\r\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\r\n\r\n  public stopsForm: FormGroup;\r\n  public projection = 'EPSG:4326';\r\n  public currentStopIndex: number;\r\n  private routesQueries$$: Subscription[] = [];\r\n  private search$$: Subscription;\r\n\r\n  private stream$ = new Subject<string>();\r\n\r\n  public routesResults: Directions[] | Message[];\r\n  public activeRoute: Directions;\r\n  private lastTimeoutRequest;\r\n\r\n  private focusOnStop = false;\r\n  private focusKey = [];\r\n  public initialStopsCoords;\r\n  private browserLanguage;\r\n\r\n  @Input() term: string;\r\n\r\n  @Input() debounce: number = 200;\r\n\r\n  @Input() length: number = 2;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * The stops store\r\n   */\r\n  @Input() stopsStore: FeatureStore;\r\n\r\n  /**\r\n   * The route and vertex store\r\n   */\r\n  @Input() routeStore: FeatureStore;\r\n\r\n  @Output() submit: EventEmitter<any> = new EventEmitter();\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private directionsService: DirectionsService,\r\n    private languageService: LanguageService,\r\n    private messageService: MessageService,\r\n    private searchService: SearchService,\r\n    private queryService: QueryService,\r\n    private directionsFormService: DirectionsFormService,\r\n    private changeDetectorRefs: ChangeDetectorRef,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  changeRoute() {\r\n    this.showRouteGeometry();\r\n  }\r\n\r\n  prevent(event) {\r\n    event.preventDefault();\r\n   }\r\n\r\n  ngOnInit() {\r\n\r\n    this.queryService.queryEnabled = false;\r\n    this.focusOnStop = false;\r\n    this.browserLanguage = this.languageService.getLanguage();\r\n    this.stopsForm = this.formBuilder.group({\r\n      directionsType: 'car',\r\n      directionsMode: 'driving', // loop\r\n      stopOrderPriority: true,\r\n      directionsFixedStartEnd: false,\r\n      stops: this.formBuilder.array([\r\n        this.createStop('start'),\r\n        this.createStop('end')\r\n      ])\r\n    });\r\n\r\n    setTimeout(() => {\r\n      this.initStores();\r\n      this.initOlInteraction();\r\n    }, 1);\r\n\r\n    this.subscribeToFormChange();\r\n    this.routesQueries$$.push(\r\n      this.stream$\r\n        .pipe(\r\n          debounceTime(this.debounce),\r\n          distinctUntilChanged()\r\n        )\r\n        .subscribe((term: string) => this.handleTermChanged(term))\r\n    );\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.unsubscribeRoutesQueries();\r\n    this.unlistenSingleClick();\r\n    this.queryService.queryEnabled = true;\r\n    this.freezeStores();\r\n    this.writeStopsToFormService();\r\n\r\n  }\r\n\r\n  private initStores() {\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingStrategy({motion: FeatureMotion.None});\r\n\r\n    // STOP STORE\r\n    const stopsStore = this.stopsStore;\r\n    const stopsLayer = new VectorLayer({\r\n      title: 'Directions - stops',\r\n      zIndex: 911,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: stopMarker\r\n    });\r\n    tryBindStoreLayer(stopsStore, stopsLayer);\r\n    tryAddLoadingStrategy(stopsStore, loadingStrategy);\r\n\r\n    // ROUTE AND VERTEX STORE\r\n    const routeStore = this.routeStore;\r\n    const routeLayer = new VectorLayer({\r\n      title: 'Directions - route and vertex',\r\n      zIndex: 910,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: stopMarker\r\n    });\r\n    tryBindStoreLayer(routeStore, routeLayer);\r\n    tryAddLoadingStrategy(routeStore, loadingStrategy);\r\n\r\n  }\r\n\r\n  private initOlInteraction() {\r\n    let selectedStopFeature;\r\n    const selectStop = new olinteraction.Select({\r\n      layers: [this.stopsStore.layer.ol],\r\n      condition: olcondition.pointerMove,\r\n      hitTolerance: 7,\r\n      filter: (feature) => {\r\n        return feature.get('type') === 'stop';\r\n      }\r\n    });\r\n\r\n    selectStop.on('select', evt => {\r\n      selectedStopFeature = evt.target.getFeatures()[0];\r\n    });\r\n\r\n    const translateStop = new olinteraction.Translate({\r\n      layers: [this.stopsStore.layer.ol],\r\n      features: selectedStopFeature\r\n      // TODO In Openlayers >= 6.x, filter is now allowed.\r\n    });\r\n\r\n    translateStop.on('translating', evt => {\r\n      const features = evt.features;\r\n      if (features.getLength() === 0) { return; }\r\n      this.executeTranslation(features, false, 50, true);\r\n    });\r\n\r\n    translateStop.on('translateend', evt => {\r\n      const features = evt.features;\r\n      if (features.getLength() === 0) { return; }\r\n      this.executeTranslation(features, true, 0, false);\r\n    });\r\n\r\n    const selectedRoute = new olinteraction.Select({\r\n      layers: [this.routeStore.layer.ol],\r\n      condition: olcondition.click,\r\n      hitTolerance: 7,\r\n      filter: (feature) => {\r\n        return feature.getId() === 'route';\r\n      }\r\n    });\r\n    selectedRoute.on('select', evt => {\r\n      if (this.focusOnStop === false) {\r\n        const selectCoordinates = olproj.transform(\r\n          (evt as any).mapBrowserEvent.coordinate,\r\n          this.map.projection,\r\n          this.projection\r\n        );\r\n        this.addStop();\r\n        const pos = this.stops.length - 2;\r\n        this.stops.at(pos).patchValue({ stopCoordinates: selectCoordinates });\r\n        this.handleLocationProposals(selectCoordinates, pos);\r\n        this.addStopOverlay(selectCoordinates, pos);\r\n        selectedRoute.getFeatures().clear();\r\n      }\r\n      selectedRoute.getFeatures().clear();\r\n    });\r\n\r\n    this.map.ol.addInteraction(selectStop);\r\n    this.map.ol.addInteraction(translateStop);\r\n    this.map.ol.addInteraction(selectedRoute);\r\n\r\n  }\r\n\r\n  private subscribeToFormChange() {\r\n    this.routesQueries$$.push(\r\n      this.stopsForm.valueChanges\r\n        .pipe(debounceTime(this.debounce))\r\n        .subscribe(val => {\r\n          this.writeStopsToFormService();\r\n        })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\r\n   * and some listener removed\r\n   * @internal\r\n   */\r\n  private freezeStores() {\r\n    const stopsStore = this.stopsStore;\r\n    const routeStore = this.routeStore;\r\n\r\n    this.map.removeLayer(stopsStore.layer);\r\n    this.map.removeLayer(routeStore.layer);\r\n    stopsStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n    routeStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\r\n\r\n  }\r\n\r\n  private executeTranslation(\r\n    features,\r\n    reverseSearchProposal = false,\r\n    delay: number = 0,\r\n    overview: boolean = false) {\r\n    this.routeStore.clear();\r\n    const firstFeature = features.getArray()[0];\r\n    const translatedID = firstFeature.getId();\r\n    const translatedPos = translatedID.split('_');\r\n    let p;\r\n    switch (translatedPos[1]) {\r\n      case 'start':\r\n        p = 0;\r\n        break;\r\n      case 'end':\r\n        p = this.stops.length - 1;\r\n        break;\r\n      default:\r\n        p = Number(translatedPos[1]);\r\n        break;\r\n    }\r\n    const translationCoordinates = olproj.transform(\r\n      firstFeature.getGeometry().getCoordinates(),\r\n      this.map.projection,\r\n      this.projection\r\n    );\r\n    this.stops\r\n      .at(p)\r\n      .patchValue({ stopCoordinates: translationCoordinates, stopProposals: [] });\r\n    if (reverseSearchProposal) {\r\n      this.handleLocationProposals(translationCoordinates, p);\r\n    }\r\n\r\n    const directionsOptions = {\r\n      steps: true,\r\n      overview: false,\r\n      alternatives: true\r\n    } as DirectionsOptions;\r\n\r\n    if (overview) {\r\n      directionsOptions.overview = true;\r\n      directionsOptions.steps = false;\r\n      directionsOptions.alternatives = false;\r\n    }\r\n\r\n    if (delay > 0) {\r\n      if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n        clearTimeout(this.lastTimeoutRequest);\r\n      }\r\n      this.lastTimeoutRequest = setTimeout(() => {\r\n        this.getRoutes(undefined, directionsOptions);\r\n      }, delay);\r\n\r\n    } else {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n      this.getRoutes(undefined, directionsOptions);\r\n    }\r\n\r\n  }\r\n\r\n  handleLocationProposals(coordinates: [number, number], stopIndex: number) {\r\n    const groupedLocations = [];\r\n    const roundedCoordinates = [coordinates[0].toFixed(5), coordinates[1].toFixed(5)];\r\n    this.stops.at(stopIndex).patchValue({ stopPoint: roundedCoordinates.join(',') });\r\n    this.searchService\r\n      .reverseSearch(coordinates, { zoom: this.map.viewController.getZoom() })\r\n      .map(res =>\r\n        this.routesQueries$$.push(\r\n          res.request.pipe(map(f => f)).subscribe(results => {\r\n            results.forEach(result => {\r\n              if (\r\n                groupedLocations.filter(f => f.source === result.source)\r\n                  .length === 0\r\n              ) {\r\n                groupedLocations.push({\r\n                  source: result.source,\r\n                  results: results.map(r => r.data)\r\n                });\r\n              }\r\n            });\r\n            this.stops\r\n              .at(stopIndex)\r\n              .patchValue({ stopProposals: groupedLocations });\r\n            // TODO: Prefer another source?\r\n            if (results[0]) {\r\n              if (results[0].source.getId() === 'icherchereverse') {\r\n                // prefer address type.\r\n                let resultPos = 0;\r\n                for (let i = 0; i < results.length; i++) {\r\n                  const feature: any = results[i].data;\r\n                  if (feature.properties.type === 'adresses') {\r\n                    resultPos = i;\r\n                    break;\r\n                  }\r\n                }\r\n                this.stops.at(stopIndex).patchValue({\r\n                  stopPoint: getEntityTitle(results[resultPos])\r\n                });\r\n                if (results[resultPos].data.geometry.type === 'Point') {\r\n                  this.stops.at(stopIndex).patchValue({\r\n                    stopCoordinates:\r\n                      results[resultPos].data.geometry.coordinates\r\n                  });\r\n                } else {\r\n                  // Not moving the translated point Only to suggest value into the UI.\r\n                }\r\n              } else if (results[0].source.getId() === 'coordinatesreverse') {\r\n                this.stops.at(stopIndex).patchValue({\r\n                  stopPoint: [\r\n                    results[0].data.geometry.coordinates[0].toFixed(5),\r\n                    results[0].data.geometry.coordinates[1].toFixed(5)\r\n                  ].join(',')\r\n                });\r\n                if (results[0].data.geometry.type === 'Point') {\r\n                  this.stops.at(stopIndex).patchValue({\r\n                    stopCoordinates:\r\n                      results[0].data.geometry.coordinates\r\n                  });\r\n                } else {\r\n                  // Not moving the translated point Only to suggest value into the UI.\r\n                }\r\n              }\r\n            } else {\r\n              this.stops.at(stopIndex).patchValue({ stopPoint: roundedCoordinates.join(','), stopProposals: [] });\r\n            }\r\n            this.changeDetectorRefs.detectChanges();\r\n          })\r\n        )\r\n      );\r\n  }\r\n\r\n  directionsText(index: number, stopsCounts = this.stops.length): string {\r\n    if (index === 0) {\r\n      return 'start';\r\n    } else if (index === stopsCounts - 1 || stopsCounts === 1) {\r\n      return 'end';\r\n    } else {\r\n      return 'intermediate';\r\n    }\r\n  }\r\n\r\n  raiseStop(index: number) {\r\n    if (index > 0) {\r\n      this.moveStop(index, -1);\r\n    }\r\n  }\r\n\r\n  lowerStop(index: number) {\r\n    if (index < this.stops.length - 1) {\r\n      this.moveStop(index, 1);\r\n    }\r\n  }\r\n\r\n  private moveStop(index, diff) {\r\n    const fromValue = this.stops.at(index);\r\n    this.removeStop(index);\r\n    this.stops.insert(index + diff, fromValue);\r\n    this.stops.at(index).patchValue({ directionsText: this.directionsText(index) });\r\n    this.stops\r\n      .at(index + diff)\r\n      .patchValue({ directionsText: this.directionsText(index + diff) });\r\n    if (this.stops.at(index).value.stopCoordinates) {\r\n      this.addStopOverlay(this.stops.at(index).value.stopCoordinates, index);\r\n    }\r\n    if (this.stops.at(index + diff).value.stopCoordinates) {\r\n      this.addStopOverlay(\r\n        this.stops.at(index + diff).value.stopCoordinates,\r\n        index + diff\r\n      );\r\n    }\r\n  }\r\n\r\n  get stops(): FormArray {\r\n    return this.stopsForm.get('stops') as FormArray;\r\n  }\r\n\r\n  public writeStopsToFormService() {\r\n    const stops = [];\r\n    this.stops.value.forEach(stop => {\r\n      if (stop.stopCoordinates instanceof Array) {\r\n        stops.push(stop);\r\n      }\r\n    });\r\n    this.directionsFormService.setStops(stops);\r\n  }\r\n\r\n  addStop(): void {\r\n    const insertIndex = this.stops.length - 1;\r\n    this.stops.insert(insertIndex, this.createStop());\r\n  }\r\n\r\n  createStop(directionsPos = 'intermediate'): FormGroup {\r\n    return this.formBuilder.group({\r\n      stopPoint: [''],\r\n      stopProposals: [[]],\r\n      directionsText: directionsPos,\r\n      stopCoordinates: ['', [Validators.required]]\r\n    });\r\n  }\r\n\r\n  removeStop(index: number): void {\r\n    const id = this.getStopOverlayID(index);\r\n    this.deleteStoreFeatureByID(this.stopsStore, id);\r\n    this.stops.removeAt(index);\r\n    let cnt = 0;\r\n    this.stops.value.forEach(stop => {\r\n      this.stops.at(cnt).patchValue({ directionsText: this.directionsText(cnt) });\r\n      this.addStopOverlay(this.stops.at(cnt).value.stopCoordinates, cnt);\r\n      cnt++;\r\n    });\r\n  }\r\n\r\n  resetForm() {\r\n    this.routesResults = undefined;\r\n    const nbStops = this.stops.length;\r\n    for (let i = 0; i < nbStops; i++) {\r\n      this.stops.removeAt(0);\r\n    }\r\n    this.stops.insert(0, this.createStop('start'));\r\n    this.stops.insert(1, this.createStop('end'));\r\n\r\n    this.stopsStore.clear();\r\n    this.routeStore.clear();\r\n  }\r\n\r\n  formatStep(step, cnt) {\r\n    return this.formatInstruction(\r\n      step.maneuver.type,\r\n      step.maneuver.modifier,\r\n      step.name,\r\n      step.maneuver.bearing_after,\r\n      cnt,\r\n      step.maneuver.exit,\r\n      cnt === this.activeRoute.steps.length - 1\r\n    );\r\n  }\r\n\r\n  formatInstruction(\r\n    type,\r\n    modifier,\r\n    route,\r\n    direction,\r\n    stepPosition,\r\n    exit,\r\n    lastStep = false\r\n  ) {\r\n    let directiveFr;\r\n    let directiveEn;\r\n    let image = 'forward';\r\n    let cssClass = 'rotate-270';\r\n    const translatedDirection = this.translateBearing(direction);\r\n    const translatedModifier = this.translateModifier(modifier);\r\n    const enPrefix = modifier === 'straight' ? '' : 'on the ';\r\n    const frPrefix = modifier === 'straight' ? '' : 'Ã  ';\r\n\r\n    let frAggregatedDirection = frPrefix + translatedModifier;\r\n    let enAggregatedDirection = enPrefix + translatedModifier;\r\n\r\n    if (modifier && modifier.search('slight') >= 0) {\r\n      enAggregatedDirection = translatedModifier;\r\n    }\r\n\r\n    if (modifier === 'uturn') {\r\n      image = 'forward';\r\n      cssClass = 'rotate-90';\r\n    } else if (modifier === 'sharp right') {\r\n      image = 'subdirectory-arrow-right';\r\n      cssClass = 'icon-flipped';\r\n    } else if (modifier === 'right') {\r\n      image = 'subdirectory-arrow-right';\r\n      cssClass = 'icon-flipped';\r\n    } else if (modifier === 'slight right') {\r\n      image = 'forward';\r\n      cssClass = 'rotate-290';\r\n    } else if (modifier === 'straight') {\r\n      image = 'forward';\r\n    } else if (modifier === 'slight left') {\r\n      image = 'forward';\r\n      cssClass = 'rotate-250';\r\n    } else if (modifier === 'left') {\r\n      image = 'subdirectory-arrow-left';\r\n      cssClass = 'icon-flipped';\r\n    } else if (modifier === 'sharp left') {\r\n      image = 'subdirectory-arrow-left';\r\n      cssClass = 'icon-flipped';\r\n    }\r\n\r\n    if (type === 'turn') {\r\n      if (modifier === 'straight') {\r\n        directiveFr = 'Continuer sur ' + route;\r\n        directiveEn = 'Continue on ' + route;\r\n      } else if (modifier === 'uturn') {\r\n        directiveFr = 'Faire demi-tour sur ' + route;\r\n        directiveEn = 'Make u-turn on ' + route;\r\n      } else {\r\n        directiveFr = 'Tourner ' + frAggregatedDirection + ' sur ' + route;\r\n        directiveEn = 'Turn ' + translatedModifier + ' onto ' + route;\r\n      }\r\n    } else if (type === 'new name') {\r\n      directiveFr =\r\n        'Continuer en direction ' + translatedDirection + ' sur ' + route;\r\n      directiveEn = 'Head ' + translatedDirection + ' on ' + route;\r\n      image = 'compass';\r\n      cssClass = '';\r\n    } else if (type === 'depart') {\r\n      directiveFr =\r\n        'Aller en direction ' + translatedDirection + ' sur ' + route;\r\n      directiveEn = 'Head ' + translatedDirection + ' on ' + route;\r\n      image = 'compass';\r\n      cssClass = '';\r\n    } else if (type === 'arrive') {\r\n      if (lastStep) {\r\n        let coma = ', ';\r\n        if (!translatedModifier) {\r\n          frAggregatedDirection = '';\r\n          enAggregatedDirection = '';\r\n          coma = '';\r\n        }\r\n        directiveFr = 'Vous Ãªtes arrivÃ©' + coma + frAggregatedDirection;\r\n        directiveEn =\r\n          'You have reached your destination' + coma + enAggregatedDirection;\r\n      } else {\r\n        directiveFr = 'Vous atteignez le point intermÃ©diare sur ' + route;\r\n        directiveEn = 'You have reached the intermediate stop onto ' + route;\r\n        image = 'map-marker';\r\n        cssClass = '';\r\n      }\r\n    } else if (type === 'merge') {\r\n      directiveFr = 'Continuer sur ' + route;\r\n      directiveEn = 'Continue on ' + route;\r\n      image = 'forward';\r\n      cssClass = 'rotate-270';\r\n    } else if (type === 'on ramp') {\r\n      directiveFr = \"Prendre l'entrÃ©e d'autoroute \" + frAggregatedDirection;\r\n      directiveEn = 'Take the ramp ' + enAggregatedDirection;\r\n    } else if (type === 'off ramp') {\r\n      directiveFr = \"Prendre la sortie d'autoroute \" + frAggregatedDirection;\r\n      directiveEn = 'Take exit ' + enAggregatedDirection;\r\n    } else if (type === 'fork') {\r\n      if (modifier.search('left') >= 0) {\r\n        directiveFr = 'Garder la gauche sur ' + route;\r\n        directiveEn = 'Merge left onto ' + route;\r\n      } else if (modifier.search('right') >= 0) {\r\n        directiveFr = 'Garder la droite sur ' + route;\r\n        directiveEn = 'Merge right onto ' + route;\r\n      } else {\r\n        directiveFr = 'Continuer sur ' + route;\r\n        directiveEn = 'Continue on ' + route;\r\n      }\r\n    } else if (type === 'end of road') {\r\n      directiveFr =\r\n        'Ã la fin de la route, tourner ' + translatedModifier + ' sur ' + route;\r\n      directiveEn =\r\n        'At the end of the road, turn ' + translatedModifier + ' onto ' + route;\r\n    } else if (type === 'use lane') {\r\n      directiveFr = 'Prendre la voie de ... ';\r\n      directiveEn = 'Take the lane ...';\r\n    } else if (type === 'continue' && modifier !== 'uturn') {\r\n      directiveFr = 'Continuer sur ' + route;\r\n      directiveEn = 'Continue on ' + route;\r\n      image = 'forward';\r\n      cssClass = 'rotate-270';\r\n    } else if (type === 'roundabout') {\r\n      directiveFr = 'Au rond-point, prendre la ' + exit;\r\n      directiveFr += exit === 1 ? 're' : 'e';\r\n      directiveFr += ' sortie vers ' + route;\r\n      directiveEn = 'At the roundabout, take the ' + exit;\r\n      directiveEn += exit === 1 ? 'st' : 'rd';\r\n      directiveEn += ' exit towards ' + route;\r\n      image = 'chart-donut';\r\n      cssClass = '';\r\n    } else if (type === 'rotary') {\r\n      directiveFr = 'Rond-point rotary....';\r\n      directiveEn = 'Roundabout rotary....';\r\n      image = 'chart-donut';\r\n      cssClass = '';\r\n    } else if (type === 'roundabout turn') {\r\n      directiveFr = 'Rond-point, prendre la ...';\r\n      directiveEn = 'Roundabout, take the ...';\r\n      image = 'chart-donut';\r\n      cssClass = '';\r\n    } else if (type === 'exit roundabout') {\r\n      directiveFr = 'Poursuivre vers ' + route;\r\n      directiveEn = 'Continue to ' + route;\r\n      image = 'forward';\r\n      cssClass = 'rotate-270';\r\n    } else if (type === 'notification') {\r\n      directiveFr = 'notification ....';\r\n      directiveEn = 'notification ....';\r\n    } else if (modifier === 'uturn') {\r\n      directiveFr =\r\n        'Faire demi-tour et continuer en direction ' +\r\n        translatedDirection +\r\n        ' sur ' +\r\n        route;\r\n      directiveEn =\r\n        'Make u-turn and head ' + translatedDirection + ' on ' + route;\r\n    } else {\r\n      directiveFr = '???';\r\n      directiveEn = '???';\r\n    }\r\n\r\n    if (lastStep) {\r\n      image = 'flag-variant';\r\n      cssClass = '';\r\n    }\r\n    if (stepPosition === 0) {\r\n      image = 'compass';\r\n      cssClass = '';\r\n    }\r\n\r\n    let directive;\r\n    if (this.browserLanguage === 'fr') {\r\n      directive = directiveFr;\r\n    } else if (this.browserLanguage === 'en') {\r\n      directive = directiveEn;\r\n    }\r\n\r\n    return { instruction: directive, image, cssClass };\r\n  }\r\n\r\n  translateModifier(modifier) {\r\n    if (modifier === 'uturn') {\r\n      return this.languageService.translate.instant('igo.geo.directions.uturn');\r\n    } else if (modifier === 'sharp right') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.sharp right'\r\n      );\r\n    } else if (modifier === 'right') {\r\n      return this.languageService.translate.instant('igo.geo.directions.right');\r\n    } else if (modifier === 'slight right') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.slight right'\r\n      );\r\n    } else if (modifier === 'sharp left') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.sharp left'\r\n      );\r\n    } else if (modifier === 'left') {\r\n      return this.languageService.translate.instant('igo.geo.directions.left');\r\n    } else if (modifier === 'slight left') {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.directions.slight left'\r\n      );\r\n    } else if (modifier === 'straight') {\r\n      return this.languageService.translate.instant('igo.geo.directions.straight');\r\n    } else {\r\n      return modifier;\r\n    }\r\n  }\r\n\r\n  translateBearing(bearing) {\r\n    if (bearing >= 337 || bearing < 23) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.n');\r\n    } else if (bearing < 67) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.ne'\r\n      );\r\n    } else if (bearing < 113) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.e');\r\n    } else if (bearing < 157) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.se'\r\n      );\r\n    } else if (bearing < 203) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.s');\r\n    } else if (bearing < 247) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.sw'\r\n      );\r\n    } else if (bearing < 293) {\r\n      return this.languageService.translate.instant('igo.geo.cardinalPoints.w');\r\n    } else if (bearing < 337) {\r\n      return this.languageService.translate.instant(\r\n        'igo.geo.cardinalPoints.nw'\r\n      );\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  formatDistance(distance) {\r\n    if (distance === 0) {\r\n      return;\r\n    }\r\n    if (distance >= 100000) {\r\n      return Math.round(distance / 1000) + ' km';\r\n    }\r\n    if (distance >= 10000) {\r\n      return Math.round(distance / 100) / 10 + ' km';\r\n    }\r\n    if (distance >= 100) {\r\n      return Math.round(distance / 100) / 10 + ' km';\r\n    }\r\n    return distance + ' m';\r\n  }\r\n\r\n  formatDuration(duration: number, summary = false) {\r\n    if (duration >= 3600) {\r\n      const hour = Math.floor(duration / 3600);\r\n      const minute = Math.round((duration / 3600 - hour) * 60);\r\n      if (minute === 60) {\r\n        return hour + 1 + ' h';\r\n      }\r\n      return hour + ' h ' + minute + ' min';\r\n    }\r\n\r\n    if (duration >= 60) {\r\n      return Math.round(duration / 60) + ' min';\r\n    }\r\n    return duration + ' s';\r\n  }\r\n\r\n  showSegment(step, zoomToExtent = false) {\r\n    this.showRouteSegmentGeometry(step.geometry.coordinates, zoomToExtent);\r\n  }\r\n\r\n  showRouteSegmentGeometry(coordinates, zoomToExtent = false) {\r\n    const vertexId = 'vertex';\r\n    const geometry4326 = new olgeom.LineString(coordinates);\r\n    const geometryMapProjection = geometry4326.transform('EPSG:4326', this.map.projection);\r\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\r\n    const lastPoint = routeSegmentCoordinates[0];\r\n\r\n    const geometry = new olgeom.Point(lastPoint);\r\n    const feature = new olFeature({ geometry });\r\n\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: this.map.projection\r\n    });\r\n\r\n    const previousVertex = this.routeStore.get(vertexId);\r\n    const previousVertexRevision = previousVertex ? previousVertex.meta.revision : 0;\r\n\r\n    const vertexFeature: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.map.projection,\r\n      properties: {\r\n        id: vertexId,\r\n        type: 'vertex'\r\n      },\r\n      meta: {\r\n        id: vertexId,\r\n        revision: previousVertexRevision + 1\r\n      },\r\n      ol: feature\r\n    };\r\n    this.routeStore.update(vertexFeature);\r\n    if (zoomToExtent) {\r\n      this.map.viewController.zoomToExtent(feature.getGeometry().getExtent());\r\n    }\r\n  }\r\n\r\n  zoomRoute(extent?) {\r\n\r\n    if (extent) {\r\n      this.map.viewController.zoomToExtent(extent);\r\n    } else {\r\n      const routeFeature = this.routeStore.layer.ol.getSource().getFeatures().find(f => f.getId() === 'route');\r\n      if (routeFeature) {\r\n        const routeExtent = routeFeature.getGeometry().getExtent();\r\n        this.map.viewController.zoomToExtent(routeExtent);\r\n      }\r\n    }\r\n  }\r\n\r\n  private showRouteGeometry(moveToExtent = false) {\r\n    const geom = this.activeRoute.geometry.coordinates;\r\n    const geometry4326 = new olgeom.LineString(geom);\r\n    const geometryMapProjection = geometry4326.transform('EPSG:4326', this.map.projection);\r\n    if (moveToExtent) {\r\n      this.zoomRoute(geometryMapProjection.getExtent());\r\n    }\r\n\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometryMapProjection, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: this.map.projection\r\n    });\r\n\r\n    const previousRoute = this.routeStore.get('route');\r\n    const previousRouteRevision = previousRoute ? previousRoute.meta.revision : 0;\r\n\r\n    const routeFeature: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.map.projection,\r\n      properties: {\r\n        id: 'route',\r\n        type: 'route'\r\n      },\r\n      meta: {\r\n        id: 'route',\r\n        revision: previousRouteRevision + 1\r\n      },\r\n      ol: new olFeature({ geometry: geometryMapProjection })\r\n    };\r\n    this.routeStore.update(routeFeature);\r\n\r\n  }\r\n\r\n  getRoutes(moveToExtent: boolean = false, directionsOptions: DirectionsOptions = {}) {\r\n    this.deleteStoreFeatureByID(this.routeStore, 'vertex');\r\n    this.writeStopsToFormService();\r\n    const coords = this.directionsFormService.getStopsCoordinates();\r\n    if (coords.length < 2) {\r\n      return;\r\n    }\r\n    const routeResponse = this.directionsService.route(coords, directionsOptions);\r\n    if (routeResponse) {\r\n      routeResponse.map(res =>\r\n        this.routesQueries$$.push(\r\n          res.subscribe(route => {\r\n            this.routesResults = route;\r\n            this.activeRoute = this.routesResults[0] as Directions;\r\n            this.showRouteGeometry(moveToExtent);\r\n            this.changeDetectorRefs.detectChanges();\r\n          })\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  private unlistenSingleClick() {\r\n    if (this.focusKey.length !== 0) {\r\n      this.focusKey.forEach(key => {\r\n        olobservable.unByKey(key);\r\n      });\r\n    }\r\n  }\r\n\r\n  private unsubscribeRoutesQueries() {\r\n    this.routesQueries$$.forEach((sub: Subscription) => sub.unsubscribe());\r\n    this.routesQueries$$ = [];\r\n  }\r\n\r\n  copyLinkToClipboard() {\r\n    const successful = Clipboard.copy(this.getUrl());\r\n    if (successful) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant('igo.geo.directionsForm.dialog.copyTitle');\r\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsgLink');\r\n      this.messageService.success(msg, title);\r\n    }\r\n  }\r\n\r\n  copyDirectionsToClipboard() {\r\n    const indent = '\\t';\r\n    let activeRouteDirective =\r\n      this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.instructions'\r\n      ) + ':\\n';\r\n    let wayPointList = '';\r\n    const summary =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\r\n      ': \\n' +\r\n      indent +\r\n      this.activeRoute.title +\r\n      '\\n' +\r\n      indent +\r\n      this.formatDistance(this.activeRoute.distance) +\r\n      '\\n' +\r\n      indent +\r\n      this.formatDuration(this.activeRoute.duration) +\r\n      '\\n\\n' +\r\n      this.languageService.translate.instant('igo.geo.directionsForm.stopsList') +\r\n      ':\\n';\r\n\r\n    const url =\r\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\r\n      ':\\n' +\r\n      indent +\r\n      this.getUrl();\r\n\r\n    let wayPointsCnt = 1;\r\n    this.stops.value.forEach(stop => {\r\n      let coord = '';\r\n      let stopPoint = '';\r\n      if (stop.stopPoint !== stop.stopCoordinates) {\r\n        stopPoint = stop.stopPoint;\r\n        coord =\r\n          ' (' +\r\n          [stop.stopCoordinates[1], stop.stopCoordinates[0]].join(',') +\r\n          ')';\r\n      } else {\r\n        stopPoint = [stop.stopCoordinates[1], stop.stopCoordinates[0]].join(\r\n          ','\r\n        );\r\n      }\r\n\r\n      wayPointList =\r\n        wayPointList +\r\n        indent +\r\n        wayPointsCnt.toLocaleString() +\r\n        '. ' +\r\n        stopPoint +\r\n        coord +\r\n        '\\n';\r\n      wayPointsCnt++;\r\n    });\r\n\r\n    // Directions\r\n    let localCnt = 0;\r\n    this.activeRoute.steps.forEach(step => {\r\n      const instruction = this.formatStep(step, localCnt).instruction;\r\n      const distance =\r\n        this.formatDistance(step.distance) === undefined\r\n          ? ''\r\n          : ' (' + this.formatDistance(step.distance) + ')';\r\n      activeRouteDirective =\r\n        activeRouteDirective +\r\n        indent +\r\n        (localCnt + 1).toLocaleString() +\r\n        '. ' +\r\n        instruction +\r\n        distance +\r\n        '\\n';\r\n      localCnt++;\r\n    });\r\n\r\n    const directionsBody =\r\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\r\n\r\n    const successful = Clipboard.copy(directionsBody);\r\n    if (successful) {\r\n      const translate = this.languageService.translate;\r\n      const title = translate.instant('igo.geo.directionsForm.dialog.copyTitle');\r\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\r\n      this.messageService.success(msg, title);\r\n    }\r\n  }\r\n\r\n  private handleTermChanged(term: string) {\r\n    if (term !== undefined || term.length !== 0) {\r\n      const searchProposals = [];\r\n      if (this.search$$) {\r\n        this.search$$.unsubscribe();\r\n      }\r\n      const researches = this.searchService.search(term, {searchType: 'Feature'});\r\n      researches.map(res =>\r\n        this.search$$ =\r\n        res.request.subscribe(results => {\r\n          results\r\n            .filter(r => r.data.geometry)\r\n            .forEach(element => {\r\n              if (\r\n                searchProposals.filter(r => r.source === element.source)\r\n                  .length === 0\r\n              ) {\r\n                searchProposals.push({\r\n                  source: element.source,\r\n                  meta: element.meta,\r\n                  results: results.map(r => r.data)\r\n                });\r\n              }\r\n            });\r\n          this.stops\r\n            .at(this.currentStopIndex)\r\n            .patchValue({ stopProposals: searchProposals });\r\n          this.changeDetectorRefs.detectChanges();\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  setTerm(term: string) {\r\n    this.term = term;\r\n    if (\r\n      this.keyIsValid(term) &&\r\n      (term.length >= this.length || term.length === 0)\r\n    ) {\r\n      this.stream$.next(term);\r\n    }\r\n  }\r\n\r\n  private keyIsValid(key: string) {\r\n    return this.invalidKeys.find(value => value === key) === undefined;\r\n  }\r\n\r\n  keyup(i, event: KeyboardEvent) {\r\n    const term = (event.target as HTMLInputElement).value;\r\n    this.setTerm(term);\r\n    this.map.ol.un('singleclick', evt => {\r\n      this.handleMapClick(evt, i);\r\n    });\r\n  }\r\n\r\n  clearStop(stopIndex) {\r\n    // this.deleteDirectionsOverlaybyID(this.getStopOverlayID(stopIndex));\r\n    const id = this.getStopOverlayID(stopIndex);\r\n    this.deleteStoreFeatureByID(this.stopsStore, id);\r\n    this.routeStore.clear();\r\n    const stopsCounts = this.stops.length;\r\n    this.stops.removeAt(stopIndex);\r\n    this.stops.insert(stopIndex, this.createStop(this.directionsText(stopIndex, stopsCounts)));\r\n    this.routesResults = undefined;\r\n    this.getRoutes();\r\n  }\r\n\r\n  chooseProposal(proposal, i) {\r\n    if (proposal !== undefined) {\r\n      let geomCoord;\r\n      const geom = (proposal as any).geometry;\r\n      if (geom.type === 'Point') {\r\n        geomCoord = geom.coordinates;\r\n      } else if (geom.type.search('Line') >= 0) {\r\n        const line = (new OlGeoJSON()).readFeatures(geom);\r\n        geomCoord = line[0].getGeometry().getFirstCoordinate();\r\n        geomCoord = [geomCoord[0], geomCoord[1]];\r\n      } else if (geom.type.search('Polygon') >= 0) {\r\n        const poly = (new OlGeoJSON()).readFeatures(geom);\r\n        geomCoord = poly[0].getGeometry().getInteriorPoints().getFirstCoordinate();\r\n        geomCoord = [geomCoord[0], geomCoord[1]];\r\n      }\r\n\r\n      if (geomCoord !== undefined) {\r\n        this.stops.at(i).patchValue({ stopCoordinates: geomCoord });\r\n        this.addStopOverlay(geomCoord, i);\r\n      /*  const proposalExtent = this.directionsStopsOverlayDataSource.ol\r\n          .getFeatureById(this.getStopOverlayID(i))\r\n          .getGeometry()\r\n          .getExtent();*/\r\n\r\n       /* if (!olextent.intersects(proposalExtent, this.map.viewController.getExtent())) {\r\n          this.map.viewController.moveToExtent(proposalExtent);\r\n        }*/\r\n      }\r\n    }\r\n  }\r\n\r\n  focus(i) {\r\n    this.unlistenSingleClick();\r\n    this.currentStopIndex = i;\r\n    this.focusOnStop = true;\r\n    this.focusKey.push(\r\n      this.map.ol.once('singleclick', evt => {\r\n        this.handleMapClick(evt, i);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleMapClick(event: olcondition, indexPos?) {\r\n    if (this.currentStopIndex === undefined) {\r\n      this.addStop();\r\n      indexPos = this.stops.length - 2;\r\n      this.stops.at(indexPos).value.stopProposals = [];\r\n    } else {\r\n      indexPos = this.currentStopIndex;\r\n    }\r\n    const clickCoordinates = olproj.transform(\r\n      event.coordinate,\r\n      this.map.projection,\r\n      this.projection\r\n    );\r\n    this.stops.at(indexPos).patchValue({ stopProposals: [], stopCoordinates: clickCoordinates });\r\n\r\n    this.handleLocationProposals(clickCoordinates, indexPos);\r\n    this.addStopOverlay(clickCoordinates, indexPos);\r\n    setTimeout(() => {\r\n      this.focusOnStop = false; // prevent to trigger map click and Select on routes at same time.\r\n    }, 500);\r\n  }\r\n\r\n  geolocateStop(index: number) {\r\n    moveToOlFeatures(this.map, [this.map.geolocationFeature], FeatureMotion.Move);\r\n    const geolocateCoordinates = this.map.viewController.getCenter(this.projection);\r\n    this.stops.at(index).patchValue({ stopCoordinates: geolocateCoordinates });\r\n    this.addStopOverlay(geolocateCoordinates, index);\r\n    this.handleLocationProposals(geolocateCoordinates, index);\r\n  }\r\n\r\n  public addStopOverlay(coordinates: [number, number], index: number) {\r\n    const directionsText = this.directionsText(index);\r\n    let stopColor;\r\n    let stopText;\r\n    if (directionsText === 'start') {\r\n      stopColor = 'green';\r\n      stopText = this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.start'\r\n      );\r\n    } else if (directionsText === 'end') {\r\n      stopColor = 'red';\r\n      stopText = this.languageService.translate.instant(\r\n        'igo.geo.directionsForm.end'\r\n      );\r\n    } else {\r\n      stopColor = 'yellow';\r\n      stopText =\r\n        this.languageService.translate.instant(\r\n          'igo.geo.directionsForm.intermediate'\r\n        ) +\r\n        ' #' +\r\n        index;\r\n    }\r\n\r\n    const geometry = new olgeom.Point(\r\n      olproj.transform(coordinates, this.projection, this.map.projection)\r\n    );\r\n\r\n    const stopID = this.getStopOverlayID(index);\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.map.projection,\r\n      dataProjection: this.map.projection\r\n    });\r\n\r\n    const previousStop = this.stopsStore.get(stopID);\r\n    const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\r\n\r\n    const stopFeature: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.map.projection,\r\n      properties: {\r\n        id: stopID,\r\n        type: 'stop',\r\n        stopText,\r\n        stopColor,\r\n        stopOpacity: 1\r\n      },\r\n      meta: {\r\n        id: stopID,\r\n        revision: previousStopRevision + 1\r\n      },\r\n      ol: new olFeature({ geometry })\r\n    };\r\n\r\n    this.stopsStore.update(stopFeature);\r\n    this.getRoutes();\r\n\r\n  }\r\n\r\n  public getStopOverlayID(index: number): string {\r\n    let txt;\r\n    if (index === 0) {\r\n      txt = 'start';\r\n    } else if (index === this.stops.length - 1) {\r\n      txt = 'end';\r\n    } else {\r\n      txt = index;\r\n    }\r\n    return 'directionsStop_' + txt;\r\n  }\r\n\r\n  private deleteStoreFeatureByID(store, id) {\r\n    const entity = store.get(id);\r\n    if (entity) {\r\n      store.delete(entity);\r\n    }\r\n  }\r\n\r\n  private getUrl() {\r\n    if (!this.route) {\r\n      return;\r\n    }\r\n\r\n    const directionsKey = this.route.options.directionsCoordKey;\r\n    const stopsCoordinates = [];\r\n    if (\r\n      this.directionsFormService &&\r\n      this.directionsFormService.getStopsCoordinates() &&\r\n      this.directionsFormService.getStopsCoordinates().length !== 0\r\n    ) {\r\n      this.directionsFormService.getStopsCoordinates().forEach(coord => {\r\n        stopsCoordinates.push(roundCoordTo(coord, 6));\r\n      });\r\n    }\r\n    let directionsUrl = '';\r\n    if (stopsCoordinates.length >= 2) {\r\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\r\n    }\r\n\r\n    return `${location.origin}${\r\n      location.pathname\r\n    }?tool=directions&${directionsUrl}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a style for the directions stops and routes\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function stopMarker(feature: olFeature, resolution: number): olstyle.Style {\r\n\r\n  const vertexStyle = [\r\n    new olstyle.Style({\r\n      geometry: feature.getGeometry(),\r\n      image: new olstyle.Circle({\r\n        radius: 7,\r\n        stroke: new olstyle.Stroke({ color: '#FF0000', width: 3 })\r\n      })\r\n    })\r\n  ];\r\n\r\n  const stopStyle = new olstyle.Style({\r\n    image: new olstyle.Icon({\r\n      src: './assets/igo2/geo/icons/place_' + feature.get('stopColor') + '_36px.svg',\r\n      opacity : feature.get('stopOpacity'),\r\n      imgSize: [36, 36], // for ie\r\n      anchor: [0.5, 0.92]\r\n    }),\r\n\r\n    text: new olstyle.Text({\r\n      text: feature.get('stopText'),\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true\r\n    })\r\n  });\r\n\r\n  const routeStyle = [\r\n    new olstyle.Style({\r\n      stroke: new olstyle.Stroke({ color: '#6a7982', width: 10, opacity: 0.75 })\r\n    }),\r\n    new olstyle.Style({\r\n      stroke: new olstyle.Stroke({ color: '#4fa9dd', width: 6, opacity: 0.75 })\r\n    })\r\n  ];\r\n\r\n  if (feature.get('type') === 'stop') {\r\n    return stopStyle;\r\n  }\r\n  if (feature.get('type') === 'vertex') {\r\n    return vertexStyle;\r\n  }\r\n  if (feature.get('type') === 'route') {\r\n    return routeStyle;\r\n  }\r\n\r\n}\r\n","import {\r\n  Directive,\r\n  Self,\r\n  AfterViewInit,\r\n  Optional\r\n} from '@angular/core';\r\n\r\nimport { RouteService } from '@igo2/core';\r\n\r\nimport { DirectionsFormComponent } from './directions-form.component';\r\nimport { DirectionsFormService } from './directions-form.service';\r\n\r\n@Directive({\r\n  selector: '[igoDirectionsFormBinding]'\r\n})\r\nexport class DirectionsFormBindingDirective implements AfterViewInit {\r\n\r\n  constructor(\r\n    @Self() private component: DirectionsFormComponent,\r\n    private directionsFormService: DirectionsFormService,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  ngAfterViewInit(): void {\r\n    const storedStops = this.directionsFormService.getStops();\r\n    if (\r\n      !storedStops && this.route &&\r\n      this.route.options.directionsCoordKey\r\n    ) {\r\n      this.route.queryParams.subscribe(params => {\r\n        const directionsParams =\r\n          params[this.route.options.directionsCoordKey as string];\r\n        const stopsCoordinatesFromURL = [];\r\n        if (directionsParams) {\r\n          const directionsCoordUrl = directionsParams.split(';');\r\n          if (directionsCoordUrl.length >= 2) {\r\n            let cnt = 0;\r\n            directionsCoordUrl.forEach(coord => {\r\n              if (cnt !== 0 && cnt !== directionsCoordUrl.length - 1) {\r\n                this.component.stops.insert(cnt, this.component.createStop());\r\n              }\r\n\r\n              const stopCoordinatesFromURL = JSON.parse('[' + coord + ']');\r\n              this.component.stops\r\n                .at(cnt)\r\n                .patchValue({ stopCoordinates: stopCoordinatesFromURL });\r\n              this.component.stops\r\n                .at(cnt)\r\n                .patchValue({ stopPoint: stopCoordinatesFromURL });\r\n              this.component.handleLocationProposals(\r\n                stopCoordinatesFromURL,\r\n                cnt\r\n              );\r\n\r\n              stopsCoordinatesFromURL.push(stopCoordinatesFromURL);\r\n              this.component.addStopOverlay(stopCoordinatesFromURL, cnt);\r\n              cnt++;\r\n            });\r\n            this.component.getRoutes(true);\r\n          }\r\n        }\r\n      });\r\n    } else if (storedStops) {\r\n      for (let i = 0; i < storedStops.length; i++) {\r\n        if (i !== 0 && i !== storedStops.length - 1) {\r\n          this.component.stops.insert(i, this.component.createStop());\r\n        }\r\n        if (storedStops[i].stopCoordinates instanceof Array) {\r\n          this.component.addStopOverlay(storedStops[i].stopCoordinates, i);\r\n          this.component.stops.at(i).patchValue(storedStops[i] );\r\n        }\r\n      }\r\n      this.component.getRoutes();\r\n    }\r\n    this.component.writeStopsToFormService();\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport {\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatListModule,\r\n  MatDividerModule,\r\n  MatFormFieldModule,\r\n  MatInputModule,\r\n  MatOptionModule,\r\n  MatSelectModule,\r\n  MatTooltipModule,\r\n  MatAutocompleteModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { DirectionsFormComponent } from './directions-form/directions-form.component';\r\nimport { DirectionsFormBindingDirective } from './directions-form/directions-form-binding.directive';\r\nimport { DirectionsFormService } from './directions-form/directions-form.service';\r\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatListModule,\r\n    MatDividerModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatOptionModule,\r\n    MatSelectModule,\r\n    MatTooltipModule,\r\n    MatAutocompleteModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [DirectionsFormComponent, DirectionsFormBindingDirective],\r\n  declarations: [DirectionsFormComponent, DirectionsFormBindingDirective],\r\n  providers: [DirectionsFormService, provideDirectionsSourceService()]\r\n})\r\nexport class IgoDirectionsModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoDirectionsModule\r\n    };\r\n  }\r\n}\r\n","import { SearchSource } from './sources/source';\r\nimport { SearchSourceService } from './search-source.service';\r\n\r\n/**\r\n * Search source factory\r\n * @ignore\r\n */\r\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\r\n  return new SearchSourceService(sources);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the SearchSource service\r\n */\r\nexport function provideSearchSourceService() {\r\n  return {\r\n    provide: SearchSourceService,\r\n    useFactory: searchSourceServiceFactory,\r\n    deps: [SearchSource]\r\n  };\r\n}\r\n","import { Injectable, Inject, Injector } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\nimport { AuthService } from '@igo2/auth';\r\nimport { LanguageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport pointOnFeature from '@turf/point-on-feature';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\nimport { GoogleLinks } from './../../../utils/googleLinks';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './source.interfaces';\r\nimport {\r\n  IChercheData,\r\n  IChercheResponse,\r\n  IChercheReverseData,\r\n  IChercheReverseResponse\r\n} from './icherche.interfaces';\r\n\r\n@Injectable()\r\nexport class IChercheSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * ICherche search source\r\n */\r\n@Injectable()\r\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'icherche';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  private hashtagsLieuxToKeep = [];\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    @Inject(IChercheSearchResultFormatter)\r\n    private formatter: IChercheSearchResultFormatter,\r\n    injector: Injector\r\n  ) {\r\n    super(options);\r\n\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe(title => this.title$.next(title));\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    const ecmax =\r\n      this.options.params && this.options.params.ecmax\r\n        ? Number(this.options.params.ecmax)\r\n        : undefined;\r\n    const types =\r\n      this.options.params && this.options.params.type\r\n        ? this.options.params.type\r\n            .replace(/\\s/g, '')\r\n            .toLowerCase()\r\n            .split(',')\r\n        : [\r\n            'adresses',\r\n            'codes-postaux',\r\n            'routes',\r\n            'municipalites',\r\n            'mrc',\r\n            'regadmin',\r\n            'lieux'\r\n          ];\r\n    return {\r\n      title: 'igo.geo.search.icherche.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1,\r\n              hashtags: ['adresse']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldAddress',\r\n              value: 'anciennes-adresses',\r\n              enabled: types.indexOf('anciennes-adresses') !== -1,\r\n              hashtags: ['anciennes-adresses']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.postalCode',\r\n              value: 'codes-postaux',\r\n              enabled: types.indexOf('codes-postaux') !== -1,\r\n              hashtags: ['code-postal']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              hashtags: ['route']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1,\r\n              hashtags: ['municipalitÃ©', 'mun']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.oldCity',\r\n              value: 'anciennes-municipalites',\r\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\r\n              hashtags: ['anciennes-municipalites']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1,\r\n              hashtags: ['mrc']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1,\r\n              hashtags: ['rÃ©gion-administrative', 'regadmin']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.entreprise',\r\n              value: 'entreprises',\r\n              enabled: types.indexOf('entreprises') !== -1,\r\n              available: false,\r\n              hashtags: ['entreprise']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.place',\r\n              value: 'lieux',\r\n              enabled: types.indexOf('lieux') !== -1,\r\n              hashtags: ['lieu']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.sumi',\r\n              value: 'bornes-sumi',\r\n              enabled: types.indexOf('bornes-sumi') !== -1,\r\n              hashtags: ['borne', 'bornes', 'sumi']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.km',\r\n              value: 'bornes-km',\r\n              enabled: false,\r\n              hashtags: ['borne', 'bornes', 'repÃ¨re', 'km']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'ecmax',\r\n          name: 'ecmax',\r\n          values: [\r\n            {\r\n              title: '10 %',\r\n              value: 10,\r\n              enabled: ecmax === 10\r\n            },\r\n            {\r\n              title: '30 %',\r\n              value: 30,\r\n              enabled: ecmax === 30 || !ecmax\r\n            },\r\n            {\r\n              title: '50 %',\r\n              value: 50,\r\n              enabled: ecmax === 50\r\n            },\r\n            {\r\n              title: '75 %',\r\n              value: 75,\r\n              enabled: ecmax === 75\r\n            },\r\n            {\r\n              title: '100 %',\r\n              value: 100,\r\n              enabled: ecmax === 100\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'loc',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.map',\r\n              value: 'true',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\r\n              value: 'false',\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(term, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n\r\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\r\n      map((response: IChercheResponse) => this.extractResults(response)),\r\n      catchError(err => {\r\n        err.error.toDisplay = true;\r\n        err.error.title = this.languageService.translate.instant(\r\n          this.getDefaultOptions().title\r\n        );\r\n        throw err;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find(s => s.name === 'type');\r\n        typeSetting.values.forEach(v => {\r\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\r\n          const typesMatched = types.filter(value => regex.test(value));\r\n          v.available = typesMatched.length > 0;\r\n          if (v.value === 'lieux') {\r\n            this.hashtagsLieuxToKeep = [\r\n              ...(new Set(\r\n                typesMatched\r\n                  .map(t => t.split('.'))\r\n                  .reduce((a, b) => a.concat(b))\r\n                  .filter(t => t !== 'lieux')\r\n              ) as any)\r\n            ];\r\n          }\r\n        });\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    const queryParams: any = Object.assign(\r\n      {\r\n        geometry: true,\r\n        bbox: true,\r\n        icon: true,\r\n        type:\r\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\r\n      },\r\n      this.params,\r\n      this.computeOptionsParam(term, options || {}).params,\r\n      {\r\n        q: this.computeTerm(term),\r\n        page: options.page\r\n      }\r\n    );\r\n\r\n    if (queryParams.loc === 'true') {\r\n      const [xMin, yMin, xMax, yMax] = options.extent;\r\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\r\n    } else if (queryParams.loc === 'false') {\r\n      delete queryParams.loc;\r\n    }\r\n\r\n    if (queryParams.q.indexOf('#') !== -1) {\r\n      queryParams.type = 'lieux';\r\n    }\r\n\r\n    return new HttpParams({ fromObject: ObjectUtils.removeUndefined(queryParams) });\r\n  }\r\n\r\n  private extractResults(response: IChercheResponse): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheData) => {\r\n      return this.formatter.formatResult(this.dataToResult(data, response));\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: IChercheData, response?: IChercheResponse): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.highlight.title || data.properties.nom;\r\n    const subtitleHtml = data.highlight.title2\r\n      ? ' <small> ' + data.highlight.title2 + '</small>'\r\n      : '';\r\n    const subtitleHtml2 = data.highlight.title3\r\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\r\n        icon: data.icon || 'map-marker',\r\n        nextPage: response.features.length % +this.options.params.limit === 0 && +this.options.params.page < 10\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheSearchSource.propertiesBlacklist\r\n    );\r\n\r\n    if (data.geometry === undefined) {\r\n      return Object.assign({ type: data.index }, properties);\r\n    }\r\n\r\n    const googleLinksProperties: {\r\n      GoogleMaps: string;\r\n      GoogleStreetView?: string;\r\n    } = {\r\n      GoogleMaps: ''\r\n    };\r\n\r\n    let googleMaps;\r\n    if (data.geometry.type === 'Point') {\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\r\n        data.geometry.coordinates[0],\r\n        data.geometry.coordinates[1]\r\n      );\r\n    } else {\r\n      const point = pointOnFeature(data.geometry);\r\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(point.geometry.coordinates[0], point.geometry.coordinates[1]);\r\n    }\r\n\r\n    let googleMapsNom;\r\n    if (data.index === 'routes') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(data.properties.nom + ', ' + data.properties.municipalite);\r\n    } else if (data.index === 'municipalites') {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(data.properties.nom + ', ' + data.properties.regAdmin);\r\n    } else {\r\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(data.properties.nom || data.highlight.title);\r\n    }\r\n\r\n    googleLinksProperties.GoogleMaps = '<a href=' + googleMaps + ' target=\"_blank\">' +\r\n      this.languageService.translate.instant('igo.geo.searchByCoord') + '</a> <br /> <a href=' + googleMapsNom +\r\n        ' target=\"_blank\">' + this.languageService.translate.instant('igo.geo.searchByName') + '</a>';\r\n\r\n    if (data.geometry.type === 'Point') {\r\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\r\n        data.geometry.coordinates[0],\r\n        data.geometry.coordinates[1]\r\n      );\r\n    }\r\n\r\n    return Object.assign(\r\n      { type: data.index },\r\n      properties,\r\n      googleLinksProperties\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    // Keep hashtags for \"lieux\"\r\n    const hashtags = term.match(/(#[^\\s]+)/g) || [];\r\n    let keep = false;\r\n    keep = hashtags.some(hashtag => {\r\n      const hashtagKey = hashtag.substring(1);\r\n      return this.hashtagsLieuxToKeep.some(\r\n        h =>\r\n          h\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '') ===\r\n          hashtagKey\r\n            .toLowerCase()\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n      );\r\n    });\r\n\r\n    if (!keep) {\r\n      term = term.replace(/(#[^\\s]*)/g, '');\r\n    }\r\n\r\n    return term.replace(/[^\\wÃ-Ã¿ !\\-\\(\\),'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n}\r\n\r\n/**\r\n * IChercheReverse search source\r\n */\r\n@Injectable()\r\nexport class IChercheReverseSearchSource extends SearchSource\r\n  implements ReverseSearch {\r\n  static id = 'icherchereverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    @Inject('options') options: SearchSourceOptions,\r\n    injector: Injector\r\n  ) {\r\n    super(options);\r\n\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe(title => this.title$.next(title));\r\n\r\n    const authService = injector.get(AuthService);\r\n    if (this.settings.length) {\r\n      if (!authService) {\r\n        this.getAllowedTypes();\r\n      } else {\r\n        authService.authenticate$.subscribe(() => {\r\n          this.getAllowedTypes();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return IChercheReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return IChercheReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    const types =\r\n      this.options.params && this.options.params.type\r\n        ? this.options.params.type\r\n            .replace(/\\s/g, '')\r\n            .toLowerCase()\r\n            .split(',')\r\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\r\n\r\n    return {\r\n      title: 'igo.geo.search.ichercheReverse.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.icherche.type.address',\r\n              value: 'adresses',\r\n              enabled: types.indexOf('adresses') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.road',\r\n              value: 'routes',\r\n              enabled: types.indexOf('routes') !== -1,\r\n              available: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.district',\r\n              value: 'arrondissements',\r\n              enabled: types.indexOf('arrondissements') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.city',\r\n              value: 'municipalites',\r\n              enabled: types.indexOf('municipalites') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.mrc',\r\n              value: 'mrc',\r\n              enabled: types.indexOf('mrc') !== -1\r\n            },\r\n            {\r\n              title: 'igo.geo.search.icherche.type.regadmin',\r\n              value: 'regadmin',\r\n              enabled: types.indexOf('regadmin') !== -1\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'radius',\r\n          name: 'buffer',\r\n          values: [\r\n            {\r\n              title: '100 m',\r\n              value: 100,\r\n              enabled: !this.options.distance || this.options.distance === 100\r\n            },\r\n            {\r\n              title: '500 m',\r\n              value: 500,\r\n              enabled: this.options.distance === 500\r\n            },\r\n            {\r\n              title: '1 km',\r\n              value: 1000,\r\n              enabled: this.options.distance === 1000\r\n            },\r\n            {\r\n              title: '2 km',\r\n              value: 2000,\r\n              enabled: this.options.distance === 2000\r\n            },\r\n            {\r\n              title: '5 km',\r\n              value: 5000,\r\n              enabled: this.options.distance === 5000\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n    if (!params.get('type').length) {\r\n      return of([]);\r\n    }\r\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\r\n      map((response: IChercheReverseResponse) => {\r\n        return this.extractResults(response);\r\n      })\r\n    );\r\n  }\r\n\r\n  private getAllowedTypes() {\r\n    return this.http\r\n      .get(`${this.searchUrl}/types`)\r\n      .subscribe((types: string[]) => {\r\n        const typeSetting = this.settings.find(s => s.name === 'type');\r\n        typeSetting.values.forEach(v => {\r\n          v.available = types.indexOf(v.value as string) > -1;\r\n        });\r\n      });\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    if (options.distance || this.options.distance) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        buffer: options.distance || this.options.distance\r\n      });\r\n    }\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          loc: lonLat.join(','),\r\n          sort: 'distance',\r\n          geometry: true,\r\n          icon: true\r\n        },\r\n        options.params || {},\r\n        this.params\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: IChercheReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: IChercheReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private getSubtitle(data: IChercheReverseData) {\r\n    if (!this.settings.length) {\r\n      return '';\r\n    }\r\n    let subtitle = '';\r\n    switch (data.properties.type) {\r\n      case 'arrondissements':\r\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\r\n        break;\r\n      default:\r\n        const typeSetting = this.settings.find(s => s.name === 'type');\r\n        const type = typeSetting.values.find(\r\n          t => t.value === data.properties.type\r\n        );\r\n        if (type) {\r\n          subtitle = this.languageService.translate.instant(type.title);\r\n        }\r\n    }\r\n    return subtitle;\r\n  }\r\n\r\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), properties.type, properties.code].join('.');\r\n\r\n    const titleHtml = data.properties.nom;\r\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties.nom\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.nom,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.icon || 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      IChercheReverseSearchSource.propertiesBlacklist\r\n    );\r\n    return properties;\r\n  }\r\n\r\n  private computeExtent(\r\n    data: IChercheReverseData\r\n  ): [number, number, number, number] | undefined {\r\n    return data.bbox\r\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\r\n      : undefined;\r\n  }\r\n}\r\n","import { Injector } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  IChercheSearchSource,\r\n  IChercheSearchResultFormatter,\r\n  IChercheReverseSearchSource\r\n} from './icherche';\r\n\r\n/**\r\n * ICherche search result formatter factory\r\n * @ignore\r\n */\r\nexport function defaultIChercheSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new IChercheSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search result formatter\r\n */\r\nexport function provideDefaultIChercheSearchResultFormatter() {\r\n  return {\r\n    provide: IChercheSearchResultFormatter,\r\n    useFactory: defaultIChercheSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ICherche search source factory\r\n * @ignore\r\n */\r\nexport function ichercheSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  config: ConfigService,\r\n  formatter: IChercheSearchResultFormatter,\r\n  injector: Injector\r\n) {\r\n  return new IChercheSearchSource(\r\n    http,\r\n    languageService,\r\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\r\n    formatter,\r\n    injector\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search source\r\n */\r\nexport function provideIChercheSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ichercheSearchSourceFactory,\r\n    multi: true,\r\n    deps: [\r\n      HttpClient,\r\n      LanguageService,\r\n      ConfigService,\r\n      IChercheSearchResultFormatter,\r\n      Injector\r\n    ]\r\n  };\r\n}\r\n\r\n/**\r\n * IChercheReverse search source factory\r\n * @ignore\r\n */\r\nexport function ichercheReverseSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  config: ConfigService,\r\n  injector: Injector\r\n) {\r\n  return new IChercheReverseSearchSource(\r\n    http,\r\n    languageService,\r\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\r\n    injector\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the IChercheReverse search source\r\n */\r\nexport function provideIChercheReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ichercheReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, ConfigService, Injector]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\n\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\n\r\nimport { FEATURE, Feature } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, ReverseSearch } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { GoogleLinks } from '../../../utils/googleLinks';\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport { lonLatConversion, roundCoordTo } from '../../../map/shared/map.utils';\r\nimport { OsmLinks } from '../../../utils';\r\n\r\n@Injectable()\r\nexport class CoordinatesSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\r\n    return result;\r\n  }\r\n}\r\n/**\r\n * CoordinatesReverse search source\r\n */\r\n@Injectable()\r\nexport class CoordinatesReverseSearchSource extends SearchSource\r\n  implements ReverseSearch {\r\n  static id = 'coordinatesreverse';\r\n  static type = FEATURE;\r\n\r\n  private projections;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    @Inject('options') options: SearchSourceOptions,\r\n    private languageService: LanguageService,\r\n    @Inject('projections') projections: Projection[],\r\n  ) {\r\n    super(options);\r\n    this.projections = projections;\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe(title => this.title$.next(title));\r\n  }\r\n\r\n  getId(): string {\r\n    return CoordinatesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CoordinatesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'igo.geo.search.coordinates.name',\r\n      order: 1,\r\n      showInSettings: false\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    return of([this.dataToResult(lonLat)]);\r\n  }\r\n\r\n  private dataToResult(data: [number, number]): SearchResult<Feature> {\r\n    const convertedCoord = lonLatConversion(data, this.projections);\r\n    const coords = convertedCoord.reduce((obj, item) => (\r\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\r\n\r\n    const roundedCoordString = roundCoordTo(data, 6).join(', ');\r\n\r\n    const coordKey =  this.languageService.translate.instant('igo.geo.search.coordinates.coord');\r\n    const coordLonLat = {};\r\n    coordLonLat[coordKey] = roundedCoordString;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [data[0], data[1]]\r\n        },\r\n        extent: undefined,\r\n        properties: Object.assign({},\r\n          coordLonLat,\r\n          coords,\r\n          {\r\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\r\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\r\n              data[0],\r\n              data[1]\r\n            ),\r\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14)\r\n          }),\r\n        meta: {\r\n          id: data[0].toString() + ',' + data[1].toString(),\r\n          title: roundedCoordString\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id: data[0].toString() + ',' + data[1].toString(),\r\n        title: roundedCoordString,\r\n        icon: 'map-marker'\r\n      }\r\n    };\r\n  }\r\n}\r\n","import { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  CoordinatesReverseSearchSource,\r\n  CoordinatesSearchResultFormatter\r\n} from './coordinates';\r\nimport { Projection } from '../../../map/shared/projection.interfaces';\r\nimport { ProjectionService } from '../../../map/shared/projection.service';\r\n\r\n/**\r\n * ICherche search result formatter factory\r\n * @ignore\r\n */\r\nexport function defaultCoordinatesSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new CoordinatesSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ICherche search result formatter\r\n */\r\nexport function provideDefaultCoordinatesSearchResultFormatter() {\r\n  return {\r\n    provide: CoordinatesSearchResultFormatter,\r\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * CoordinatesReverse search source factory\r\n * @ignore\r\n */\r\nexport function CoordinatesReverseSearchSourceFactory(\r\n  config: ConfigService,\r\n  languageService: LanguageService,\r\n  _projectionService: ProjectionService\r\n) {\r\n  return new CoordinatesReverseSearchSource(\r\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\r\n    languageService,\r\n    (config.getConfig('projections') as Projection[]) || []\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the IChercheReverse search source\r\n */\r\nexport function provideCoordinatesReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: CoordinatesReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [ConfigService, LanguageService, ProjectionService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, BehaviorSubject, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { ObjectUtils } from '@igo2/utils';\r\n\r\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\r\nimport { LAYER } from '../../../layer';\r\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\r\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch } from './source';\r\nimport { TextSearchOptions } from './source.interfaces';\r\nimport {\r\n  ILayerSearchSourceOptions,\r\n  ILayerData,\r\n  ILayerItemResponse,\r\n  ILayerServiceResponse,\r\n  ILayerDataSource\r\n} from './ilayer.interfaces';\r\n\r\n@Injectable()\r\nexport class ILayerSearchResultFormatter {\r\n  constructor(private languageService: LanguageService) {}\r\n\r\n  formatResult(data: ILayerData): ILayerData {\r\n    const allowedKey = [\r\n      'title',\r\n      'abstract',\r\n      'groupTitle',\r\n      'metadataUrl',\r\n      'downloadUrl',\r\n      'urlInfo',\r\n      'name'\r\n    ];\r\n\r\n    const property = Object.entries(data.properties)\r\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\r\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\r\n        const [key, value] = entries;\r\n        let newKey;\r\n        try {\r\n          newKey = this.languageService.translate.instant(\r\n            'igo.geo.search.ilayer.properties.' + key\r\n          );\r\n        } catch (e) {\r\n          newKey = key;\r\n        }\r\n        out[newKey] = value ? value : '';\r\n        return out;\r\n      }, {});\r\n\r\n    const dataR = Object.assign({}, data);\r\n    dataR.properties = property as ILayerDataSource;\r\n\r\n    return dataR;\r\n  }\r\n}\r\n\r\n/**\r\n * ILayer search source\r\n */\r\n@Injectable()\r\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'ilayer';\r\n  static type = LAYER;\r\n\r\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\r\n\r\n  get title(): string {\r\n    return this.title$.getValue();\r\n  }\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private languageService: LanguageService,\r\n    @Inject('options') options: ILayerSearchSourceOptions,\r\n    @Inject(ILayerSearchResultFormatter)\r\n    private formatter: ILayerSearchResultFormatter\r\n  ) {\r\n    super(options);\r\n    this.languageService.translate\r\n      .get(this.options.title)\r\n      .subscribe(title => this.title$.next(title));\r\n  }\r\n\r\n  getId(): string {\r\n    return ILayerSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return ILayerSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\r\n    const limit =\r\n      this.options.params && this.options.params.limit\r\n        ? Number(this.options.params.limit)\r\n        : undefined;\r\n    return {\r\n      title: 'igo.geo.search.ilayer.name',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'type',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.layer',\r\n              value: 'layer',\r\n              enabled: true,\r\n              hashtags: ['layer', 'layers', 'couche', 'couches']\r\n            },\r\n            {\r\n              title: 'igo.geo.search.ilayer.type.groupLayer',\r\n              value: 'group',\r\n              enabled: false,\r\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '1',\r\n              value: 1,\r\n              enabled: limit === 1\r\n            },\r\n            {\r\n              title: '5',\r\n              value: 5,\r\n              enabled: limit === 5 || !limit\r\n            },\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: limit === 10\r\n            },\r\n            {\r\n              title: '25',\r\n              value: 25,\r\n              enabled: limit === 25\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: limit === 50\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a layer by name or keyword\r\n   * @param term Layer name or keyword\r\n   * @returns Observable of <SearchResult<LayerOptions>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q') || !params.get('type')) {\r\n      return of([]);\r\n    }\r\n    this.options.params.page = params.get('page') || '1';\r\n\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(\r\n        map((response: ILayerServiceResponse) => this.extractResults(response))\r\n      );\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: ObjectUtils.removeUndefined(\r\n        Object.assign(\r\n          {\r\n            q: this.computeTerm(term)\r\n          },\r\n          this.params,\r\n          this.computeOptionsParam(term, options || {}).params,\r\n          {\r\n            page: options.page\r\n          }\r\n        )\r\n      )\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove hashtag from query\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTerm(term: string): string {\r\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÃ-Ã¿ !\\-\\(\\),'#]+/g, '');\r\n  }\r\n\r\n  /**\r\n   * Add hashtag to param if valid\r\n   * @param term Query with hashtag\r\n   * @param options TextSearchOptions\r\n   */\r\n  private computeOptionsParam(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): TextSearchOptions {\r\n    const hashtags = super.getHashtagsValid(term, 'type');\r\n    if (hashtags) {\r\n      options.params = Object.assign(options.params || {}, {\r\n        type: hashtags.join(',')\r\n      });\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  private extractResults(\r\n    response: ILayerServiceResponse\r\n  ): SearchResult<ILayerItemResponse>[] {\r\n    return response.items.map((data: ILayerData) =>\r\n      this.dataToResult(data, response)\r\n    );\r\n  }\r\n\r\n  private dataToResult(\r\n    data: ILayerData,\r\n    response?: ILayerServiceResponse\r\n  ): SearchResult<ILayerItemResponse> {\r\n    const layerOptions = this.computeLayerOptions(data);\r\n\r\n    const titleHtml = data.highlight.title || data.properties.title;\r\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\r\n    const subtitleHtml = groupTitle\r\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\r\n      : '';\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: LAYER,\r\n        id: [this.getId(), data.properties.id].join('.'),\r\n        title: data.properties.title,\r\n        titleHtml: titleHtml + subtitleHtml,\r\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\r\n        nextPage:\r\n          response.items.length % +this.options.params.limit === 0 &&\r\n          +this.options.params.page < 10\r\n      },\r\n      data: layerOptions\r\n    };\r\n  }\r\n\r\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\r\n    const url = data.properties.url;\r\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\r\n      url\r\n    );\r\n    return ObjectUtils.removeUndefined({\r\n      sourceOptions: {\r\n        id: data.properties.id,\r\n        type: data.properties.format,\r\n        url,\r\n        queryFormat: queryParams.queryFormat,\r\n        queryHtmlTarget: queryParams.queryHtmlTarget,\r\n        params: {\r\n          LAYERS: data.properties.name\r\n        },\r\n        optionsFromCapabilities: true,\r\n        crossOrigin: 'anonymous'\r\n      },\r\n      title: data.properties.title,\r\n      maxResolution: getResolutionFromScale(\r\n        Number(data.properties.maxScaleDenom)\r\n      ),\r\n      minResolution: getResolutionFromScale(\r\n        Number(data.properties.minScaleDenom)\r\n      ),\r\n      metadata: {\r\n        url: data.properties.metadataUrl,\r\n        extern: true\r\n      },\r\n      properties: this.formatter.formatResult(data).properties\r\n    });\r\n  }\r\n\r\n  private extractQueryParamsFromSourceUrl(\r\n    url: string\r\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\r\n    let queryFormat;\r\n    let queryHtmlTarget;\r\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\r\n    if (formatOpt) {\r\n      for (const key of Object.keys(formatOpt)) {\r\n        const value = formatOpt[key];\r\n        if (value === '*') {\r\n          queryFormat = QueryFormat[key.toUpperCase()];\r\n          break;\r\n        }\r\n\r\n        const urls = ((value as any) as { urls: string[] }).urls;\r\n        if (Array.isArray(urls)) {\r\n          urls.forEach(urlOpt => {\r\n            if (url.indexOf(urlOpt) !== -1) {\r\n              queryFormat = QueryFormat[key.toUpperCase()];\r\n            }\r\n          });\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (\r\n        queryFormat === QueryFormat.HTML ||\r\n        queryFormat === QueryFormat.HTMLGML2\r\n      ) {\r\n        queryHtmlTarget = 'iframe';\r\n      }\r\n    }\r\n\r\n    return {\r\n      queryFormat,\r\n      queryHtmlTarget\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService, LanguageService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\r\n\r\n/**\r\n * ILayer search result formatter factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchResultFormatterFactory(\r\n  languageService: LanguageService\r\n) {\r\n  return new ILayerSearchResultFormatter(languageService);\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search result formatter\r\n */\r\nexport function provideILayerSearchResultFormatter() {\r\n  return {\r\n    provide: ILayerSearchResultFormatter,\r\n    useFactory: ilayerSearchResultFormatterFactory,\r\n    deps: [LanguageService]\r\n  };\r\n}\r\n\r\n/**\r\n * ILayer search source factory\r\n * @ignore\r\n */\r\nexport function ilayerSearchSourceFactory(\r\n  http: HttpClient,\r\n  languageService: LanguageService,\r\n  config: ConfigService,\r\n  formatter: ILayerSearchResultFormatter\r\n) {\r\n  return new ILayerSearchSource(\r\n    http,\r\n    languageService,\r\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\r\n    formatter\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the ILayer search source\r\n */\r\nexport function provideILayerSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: ilayerSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, LanguageService, ConfigService, ILayerSearchResultFormatter]\r\n  };\r\n}\r\n","import { FEATURE } from '../../feature';\r\nimport { LAYER } from '../../layer';\r\n\r\nexport const SEARCH_TYPES = [FEATURE, LAYER];\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { BehaviorSubject, Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-selector',\r\n  templateUrl: './search-selector.component.html',\r\n  styleUrls: ['./search-selector.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\r\n\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  /**\r\n   * The search type enabled\r\n   */\r\n  @Input()\r\n  set searchType(value: string) { this.setSearchType(value); }\r\n  get searchType(): string { return this.searchType$.value; }\r\n\r\n  /**\r\n   * Event emitted when the enabled search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  constructor(private searchSourceService: SearchSourceService) {}\r\n\r\n  ngOnInit() {\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Enable the selected search type\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Get a search type's title. The title\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Search type\r\n   * @internal\r\n   */\r\n  getSearchTypeTitle(searchType: string) {\r\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\r\n  }\r\n\r\n  /**\r\n   * Emit an event and enable the search sources of the given type.\r\n   * @param searchType Search type\r\n   */\r\n  private setSearchType(searchType: string | undefined) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchSourceService.enableSourcesByType(searchType);\r\n    this.searchTypeChange.emit(searchType);\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatTooltipModule,\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatMenuModule,\r\n  MatRadioModule,\r\n  MatTabsModule,\r\n  MatCheckboxModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { SearchSelectorComponent } from './search-selector.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatTabsModule,\r\n    MatCheckboxModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSelectorComponent],\r\n  declarations: [SearchSelectorComponent]\r\n})\r\nexport class IgoSearchSelectorModule {}\r\n","import { MatCheckboxChange, MatRadioChange } from '@angular/material';\r\n\r\nimport {\r\n  Component,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  HostListener,\r\n  Input\r\n} from '@angular/core';\r\n\r\nimport { SearchSourceService } from '../shared/search-source.service';\r\nimport { SearchSource } from '../shared/sources/source';\r\nimport {\r\n  SearchSourceSettings,\r\n  SettingOptions\r\n} from '../shared/sources/source.interfaces';\r\nimport { sourceCanReverseSearchAsSummary, sourceCanSearch, sourceCanReverseSearch } from '../shared/search.utils';\r\nimport { MediaService } from '@igo2/core';\r\n\r\n/**\r\n * This component allows a user to select a search type yo enable. In it's\r\n * current version, only one search type can be selected at once (radio). If\r\n * this component were to support more than one search source enabled (checkbox),\r\n * the searchbar component would require a small change to it's\r\n * placeholder getter. The search source service already supports having\r\n * more than one search source enabled.\r\n */\r\n@Component({\r\n  selector: 'igo-search-settings',\r\n  templateUrl: './search-settings.component.html',\r\n  styleUrls: ['./search-settings.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchSettingsComponent implements OnInit {\r\n\r\n  public hasPointerReverseSearchSource: boolean = false;\r\n  public searchSourcesAllEnabled: boolean = false;\r\n\r\n  public buffer = [];\r\n  public lastKeyTime = Date.now();\r\n\r\n  get isTouchScreen(): boolean {\r\n    return this.mediaService.isTouchScreen();\r\n  }\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n\r\n  /**\r\n   * Event emitted when the enabled search source changes\r\n   */\r\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  @HostListener('document:keydown', ['$event'])\r\n  handleKeyboardEvent(event: KeyboardEvent) {\r\n\r\n    if (event.keyCode === 113) {\r\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\r\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService\r\n    ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\r\n  }\r\n\r\n  /**\r\n   * Get all search sources\r\n   * @internal\r\n   */\r\n  getSearchSources(): SearchSource[] {\r\n    const textSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanSearch)\r\n      .filter(s => s.available && s.getId() !== 'map' && s.showInSettings);\r\n\r\n    const reverseSearchSources = this.searchSourceService\r\n      .getSources()\r\n      .filter(sourceCanReverseSearch)\r\n      .filter(s => s.available && s.getId() !== 'map' && s.showInSettings);\r\n    const sources = textSearchSources.concat(reverseSearchSources);\r\n    this.computeSourcesCheckAllBehavior(sources);\r\n    return sources;\r\n  }\r\n\r\n  /**\r\n   * Get all search sources usable for pointer summary\r\n   * @internal\r\n   */\r\n  hasReverseSearchSourcesForPointerSummary(): boolean {\r\n    if (this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (checkbox style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedCheckbox(\r\n    event: MatCheckboxChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    settingValue.enabled = event.checked;\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (settings)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\r\n    if (setting.allEnabled === undefined) {\r\n      if (setting.values.find(settingValue => settingValue.enabled)) {\r\n        setting.allEnabled = false;\r\n      } else {\r\n        setting.allEnabled = true;\r\n      }\r\n    } else {\r\n      setting.allEnabled = !setting.allEnabled;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Defining the action to do for check/uncheck checkboxes (sources)\r\n   * return true if all checkbox must be checked\r\n   * return false if all checkbox must be unchecked\r\n   * @internal\r\n   */\r\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\r\n    const enabledSourcesCnt = sources.filter(source => source.enabled).length;\r\n    const disabledSourcesCnt = sources.filter(source => !source.enabled).length;\r\n    this.searchSourcesAllEnabled =  enabledSourcesCnt >= disabledSourcesCnt ? false : true;\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\r\n    event.stopPropagation();\r\n    this.computeSettingCheckAllBehavior(setting);\r\n    setting.values.forEach(settingValue => {\r\n      settingValue.enabled = setting.allEnabled;\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  /**\r\n   * Triggered when the check all / uncheck all type is clicked,\r\n   * @internal\r\n   */\r\n  checkUncheckAllSources(event) {\r\n    event.stopPropagation();\r\n    this.getSearchSources().map(source => {\r\n      source.enabled = this.searchSourcesAllEnabled;\r\n      this.searchSourceChange.emit(source);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Triggered when a setting is checked (radiobutton style)\r\n   * @internal\r\n   */\r\n  settingsValueCheckedRadioButton(\r\n    event: MatRadioChange,\r\n    source: SearchSource,\r\n    setting: SearchSourceSettings,\r\n    settingValue: SettingOptions\r\n  ) {\r\n    setting.values.forEach(conf => {\r\n      if (conf.value !== settingValue.value) {\r\n        conf.enabled = !event.source.checked;\r\n      } else {\r\n        conf.enabled = event.source.checked;\r\n      }\r\n    });\r\n    source.setParamFromSetting(setting);\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\r\n    source.enabled = event.checked;\r\n    this.searchSourceChange.emit(source);\r\n  }\r\n\r\n  getAvailableValues(setting: SearchSourceSettings) {\r\n    return setting.values.filter(s => s.available !== false);\r\n  }\r\n\r\n  getAvailableHashtagsValues(setting: SettingOptions) {\r\n    if (setting.hashtags) {\r\n      const output: string[] = [];\r\n      for (let value of setting.hashtags) {\r\n        value = '#' + value;\r\n        output.push(value);\r\n      }\r\n      return output;\r\n    }\r\n    return;\r\n  }\r\n\r\n  stopPropagation(event) {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  changePointerReverseSearch(event, fromTitleButton?: boolean) {\r\n    if (fromTitleButton) {\r\n      event.stopPropagation();\r\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\r\n    } else {\r\n      this.pointerSummaryEnabled = event.checked;\r\n    }\r\n\r\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { SearchSettingsComponent } from './search-settings.component';\r\nimport {\r\n  MatTooltipModule,\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatMenuModule,\r\n  MatRadioModule,\r\n  MatCheckboxModule,\r\n  MatDividerModule,\r\n  MatSlideToggleModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  declarations: [SearchSettingsComponent],\r\n  imports: [\r\n    CommonModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatCheckboxModule,\r\n    MatDividerModule,\r\n    MatSlideToggleModule,\r\n    IgoLanguageModule\r\n  ],\r\n  exports: [SearchSettingsComponent]\r\n})\r\nexport class IgoSearchSettingsModule { }\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  ChangeDetectionStrategy,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ViewChild,\r\n  ElementRef\r\n} from '@angular/core';\r\nimport { FloatLabelType } from '@angular/material';\r\n\r\nimport { BehaviorSubject, Subscription, EMPTY, timer } from 'rxjs';\r\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\r\n\r\nimport { LanguageService } from '@igo2/core';\r\nimport { EntityStore } from '@igo2/common';\r\n\r\nimport { SEARCH_TYPES } from '../shared/search.enums';\r\nimport { SearchResult, Research } from '../shared/search.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\n\r\n/**\r\n * Searchbar that triggers a research in all search sources enabled.\r\n * If the store input is defined, the search results will be loaded\r\n * into that store. An event is always emitted when a research is completed.\r\n */\r\n@Component({\r\n  selector: 'igo-search-bar',\r\n  templateUrl: './search-bar.component.html',\r\n  styleUrls: ['./search-bar.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchBarComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Invalid keys\r\n   */\r\n  static invalidKeys = [\r\n    'Control',\r\n    'Shift',\r\n    'Alt',\r\n    'ArrowDown',\r\n    'ArrowUp',\r\n    'ArrowRight',\r\n    'ArrowLeft'\r\n  ];\r\n\r\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.search.placeholder'\r\n  );\r\n\r\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  /**\r\n   * Subscription to the ssearch bar term\r\n   */\r\n  private term$$: Subscription;\r\n\r\n  /**\r\n   * Search term stream\r\n   */\r\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Subscription to the search term stream\r\n   */\r\n  private stream$$: Subscription;\r\n\r\n  /**\r\n   * Subscription to the search type\r\n   */\r\n  private searchType$$: Subscription;\r\n\r\n  private researches$$: Subscription[];\r\n\r\n  /**\r\n   * List of available search types\r\n   */\r\n  @Input() searchTypes: string[] = SEARCH_TYPES;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set searchType(value: string) {\r\n    this.setSearchType(value);\r\n  }\r\n  get searchType(): string {\r\n    return this.searchType$.value;\r\n  }\r\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\r\n    undefined\r\n  );\r\n\r\n  /**\r\n   * Event emitted when the pointer summary is activated by the searchbar setting\r\n   */\r\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  set term(value: string) {\r\n    this.setTerm(value);\r\n  }\r\n  get term(): string {\r\n    return this.term$.value;\r\n  }\r\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\r\n\r\n  /**\r\n   * Whether this component is disabled\r\n   */\r\n  @Input()\r\n  set disabled(value: boolean) {\r\n    this.disabled$.next(value);\r\n  }\r\n  get disabled(): boolean {\r\n    return this.disabled$.value;\r\n  }\r\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  @Input() pointerSummaryEnabled: boolean = false;\r\n  /**\r\n   * Whether a float label should be displayed\r\n   */\r\n  @Input() floatLabel: FloatLabelType = 'never';\r\n\r\n  /**\r\n   * Icons color (search and clear)\r\n   */\r\n  @Input() color = 'primary';\r\n\r\n  /**\r\n   * Debounce time between each keystroke\r\n   */\r\n  @Input() debounce = 200;\r\n\r\n  /**\r\n   * Minimum term length required to trigger a research\r\n   */\r\n  @Input() minLength = 2;\r\n\r\n  /**\r\n   * Search icon\r\n   */\r\n  @Input() searchIcon: string;\r\n\r\n  /**\r\n   * Search Selector\r\n   */\r\n  @Input() searchSelector = false;\r\n\r\n  /**\r\n   * Search Settings\r\n   */\r\n  @Input() searchSettings = false;\r\n\r\n  /**\r\n   * Force coordinates in north america\r\n   */\r\n  @Input() forceNA = false;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * Event emitted when the search term changes\r\n   */\r\n  @Output() searchTermChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed\r\n   */\r\n  @Output() search = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() searchTypeChange = new EventEmitter<string>();\r\n\r\n  /**\r\n   * Event emitted when the search type changes\r\n   */\r\n  @Output() clearFeature = new EventEmitter();\r\n\r\n  /**\r\n   * Event emitted when the search settings changes\r\n   */\r\n  @Output() searchSettingsChange = new EventEmitter();\r\n\r\n  /**\r\n   * Input element\r\n   * @internal\r\n   */\r\n  @ViewChild('input') input: ElementRef;\r\n\r\n  /**\r\n   * Whether the search bar is empty\r\n   * @internal\r\n   */\r\n  get empty(): boolean {\r\n    return this.term.length === 0;\r\n  }\r\n\r\n  constructor(\r\n    private languageService: LanguageService,\r\n    private searchService: SearchService\r\n  ) {}\r\n\r\n  /**\r\n   * Subscribe to the search term stream and trigger researches\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    this.term$$ = this.term$.subscribe((term: string) => {\r\n      this.empty$.next(term === undefined || term.length === 0);\r\n    });\r\n\r\n    this.stream$$ = this.stream$\r\n      .pipe(\r\n        debounce((term: string) => (term === '' ? EMPTY : timer(this.debounce)))\r\n      )\r\n      .subscribe((term: string) => this.onSetTerm(term));\r\n\r\n    this.searchType$$ = this.searchType$\r\n      .pipe(distinctUntilChanged())\r\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to the search term stream\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.term$$.unsubscribe();\r\n    this.stream$$.unsubscribe();\r\n    this.searchType$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * When a user types, validates the key and send it into the\r\n   * stream if it's valid\r\n   * @param event Keyboard event\r\n   * @internal\r\n   */\r\n  onKeyup(event: KeyboardEvent) {\r\n    const key = event.key;\r\n    if (!this.keyIsValid(key)) {\r\n      return;\r\n    }\r\n    const term = (event.target as HTMLInputElement).value;\r\n    this.setTerm(term);\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   * @internal\r\n   */\r\n  onClearButtonClick() {\r\n    this.clear();\r\n    this.clearFeature.emit();\r\n  }\r\n\r\n  /**\r\n   * Update search type\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  onSearchTypeChange(searchType: string) {\r\n    this.setSearchType(searchType);\r\n  }\r\n\r\n  /**\r\n   * Update the placeholder with the enabled search type. The placeholder\r\n   * for all availables search typers needs to be defined in the locale\r\n   * files or an error will be thrown.\r\n   * @param searchType Enabled search type\r\n   * @internal\r\n   */\r\n  setSearchType(searchType: string) {\r\n    this.searchType$.next(searchType);\r\n  }\r\n\r\n  onSearchSettingsChange() {\r\n    this.doSearch(this.term);\r\n    this.searchSettingsChange.emit();\r\n  }\r\n\r\n  /**\r\n   * Send the term into the stream only if this component is not disabled\r\n   * @param term Search term\r\n   */\r\n  setTerm(term: string) {\r\n    if (this.disabled) {\r\n      return;\r\n    }\r\n\r\n    term = term || '';\r\n\r\n    if (term !== this.term) {\r\n      this.term$.next(term);\r\n    }\r\n\r\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\r\n    if (slug.length >= this.minLength || slug.length === 0) {\r\n      this.stream$.next(term);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear the stream and the input\r\n   */\r\n  private clear() {\r\n    this.term$.next('');\r\n    this.stream$.next('');\r\n    this.input.nativeElement.focus();\r\n  }\r\n\r\n  /**\r\n   * Validate if a given key stroke is a valid input\r\n   */\r\n  private keyIsValid(key: string) {\r\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\r\n  }\r\n\r\n  /**\r\n   * When the search term changes, emit an event and trigger a\r\n   * research in every enabled search sources.\r\n   * @param term Search term\r\n   */\r\n  private onSetTerm(term: string | undefined) {\r\n    this.searchTermChange.emit(term);\r\n    this.doSearch(term);\r\n  }\r\n\r\n  private onSetSearchType(searchType: string) {\r\n    if (searchType === undefined || searchType === null) {\r\n      return;\r\n    }\r\n\r\n    this.searchTypeChange.emit(searchType);\r\n\r\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\r\n    this.placeholder$.next(placeholder);\r\n\r\n    this.setTerm(this.term);\r\n  }\r\n\r\n  /**\r\n   * Execute the search\r\n   * @param term Search term\r\n   */\r\n  private doSearch(term: string | undefined) {\r\n    if (this.researches$$) {\r\n      this.researches$$.map(research => research.unsubscribe());\r\n      this.researches$$ = undefined;\r\n    }\r\n\r\n    const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\r\n    if (slug === '') {\r\n      if (this.store !== undefined) {\r\n        this.store.clear();\r\n      }\r\n      return;\r\n    }\r\n\r\n    const researches = this.searchService.search(term, {\r\n      forceNA: this.forceNA\r\n    });\r\n    this.researches$$ = researches.map(research => {\r\n      return research.request.subscribe((results: SearchResult[]) => {\r\n        this.onResearchCompleted(research, results);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * When a research  is completed, emit an event and update\r\n   * the store's items.\r\n   * @param research Research\r\n   * @param results Research results\r\n   */\r\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\r\n    this.search.emit({ research, results });\r\n\r\n    if (this.store !== undefined) {\r\n      const newResults = this.store\r\n        .all()\r\n        .filter(result => result.source !== research.source)\r\n        .concat(results);\r\n      this.store.load(newResults);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Directive,\r\n  Self,\r\n  OnInit,\r\n  Optional,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { RouteService } from '@igo2/core';\r\n\r\nimport { SearchBarComponent } from './search-bar.component';\r\n\r\n@Directive({\r\n  selector: '[igoSearchUrlParam]'\r\n})\r\nexport class SearchUrlParamDirective implements OnInit {\r\n  constructor(\r\n    @Self() private component: SearchBarComponent,\r\n    private ref: ChangeDetectorRef,\r\n    @Optional() private route: RouteService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    if (this.route && this.route.options.searchKey) {\r\n      this.route.queryParams.subscribe(params => {\r\n        const searchParams = params[this.route.options.searchKey as string];\r\n        if (searchParams) {\r\n          this.component.setTerm(searchParams);\r\n          this.ref.detectChanges();\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport {\r\n  MatTooltipModule,\r\n  MatIconModule,\r\n  MatButtonModule,\r\n  MatMenuModule,\r\n  MatRadioModule,\r\n  MatFormFieldModule,\r\n  MatInputModule\r\n} from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\r\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\r\nimport { SearchBarComponent } from './search-bar.component';\r\nimport { SearchUrlParamDirective } from './search-url-param.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatMenuModule,\r\n    MatRadioModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    IgoLanguageModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [\r\n    SearchBarComponent,\r\n  ],\r\n  declarations: [\r\n    SearchBarComponent,\r\n    SearchUrlParamDirective\r\n  ]\r\n})\r\nexport class IgoSearchBarModule {}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ContentChild,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  OnInit,\r\n  TemplateRef,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { Observable, EMPTY, timer, BehaviorSubject } from 'rxjs';\r\nimport { debounce, map } from 'rxjs/operators';\r\n\r\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\r\n\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\r\nimport { SearchService } from '../shared/search.service';\r\nimport { SearchResult, Research } from '../shared/search.interfaces';\r\nimport { SearchSource } from '../shared/sources/source';\r\n\r\nexport enum SearchResultMode {\r\n  Grouped = 'grouped',\r\n  Flat = 'flat'\r\n}\r\n\r\n/**\r\n * List of search results with focus and selection capabilities.\r\n * This component is dumb and only emits events.\r\n */\r\n@Component({\r\n  selector: 'igo-search-results',\r\n  templateUrl: './search-results.component.html',\r\n  styleUrls: ['./search-results.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsComponent implements OnInit, OnDestroy {\r\n  /**\r\n   * Reference to the SearchResultMode enum\r\n   * @internal\r\n   */\r\n  public searchResultMode = SearchResultMode;\r\n\r\n  /**\r\n   * Search results store watcher\r\n   */\r\n  private watcher: EntityStoreWatcher<SearchResult>;\r\n\r\n  public pageIterator: {sourceId: string}[] = [];\r\n\r\n  public collapsed: {sourceId: string}[] = [];\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search results store\r\n   */\r\n  @Input() store: EntityStore<SearchResult>;\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Search results display mode\r\n   */\r\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  /**\r\n   * Search term\r\n   */\r\n  @Input()\r\n  get term(): string {\r\n    return this._term;\r\n  }\r\n  set term(value: string) {\r\n    this._term = value;\r\n    this.pageIterator = [];\r\n  }\r\n  public _term: string;\r\n\r\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\r\n\r\n  /**\r\n   * Event emitted when a result is focused\r\n   */\r\n  @Output() resultFocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is unfocused\r\n   */\r\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a result is selected\r\n   */\r\n  @Output() resultSelect = new EventEmitter<SearchResult>();\r\n\r\n  /**\r\n   * Event emitted when a research is completed after displaying more results is clicked\r\n   */\r\n  @Output() moreResults = new EventEmitter<{\r\n    research: Research;\r\n    results: SearchResult[];\r\n  }>();\r\n\r\n  /**\r\n   * Events emitted when a result is focus or unfocus by mouse event\r\n   */\r\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\r\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\r\n\r\n  @ContentChild('igoSearchItemToolbar') templateSearchToolbar: TemplateRef<any>;\r\n\r\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\r\n    if (this._results$ === undefined) {\r\n      this._results$ = this.liftResults();\r\n    }\r\n    return this._results$;\r\n  }\r\n  private _results$: Observable<\r\n    {source: SearchSource; results: SearchResult[]}[]\r\n  >;\r\n\r\n  constructor(private cdRef: ChangeDetectorRef,\r\n              private searchService: SearchService) {}\r\n\r\n  /**\r\n   * Bind the search results store to the watcher\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\r\n\r\n    this.settingsChange$.subscribe(() => {\r\n      this.pageIterator = [];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unbind the search results store from the watcher\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.watcher.destroy();\r\n  }\r\n\r\n  /**\r\n   * Compute a group title\r\n   * @param group Search results group\r\n   * @returns Group title\r\n   * @internal\r\n   */\r\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\r\n    const parts = [group.source.title];\r\n    const count = group.results.length;\r\n    if (count > 1) {\r\n      parts.push(`(${count})`);\r\n    }\r\n    return parts.join(' ');\r\n  }\r\n\r\n  /**\r\n   * When a result is selected, update it's state in the store and emit\r\n   * an event. A selected result is also considered focused\r\n   * @param result Search result\r\n   * @internal\r\n   */\r\n  onResultSelect(result: SearchResult) {\r\n    if (this.store.state.get(result)) {\r\n      if (this.store.state.get(result).selected === true) {\r\n        return;\r\n      }\r\n    }\r\n    this.store.state.update(result, {focused: true, selected: true}, true);\r\n    this.resultSelect.emit(result);\r\n  }\r\n\r\n  /**\r\n   * Return an observable of the search results, grouped by search source\r\n   * @returns Observable of grouped search results\r\n   * @internal\r\n   */\r\n  private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\r\n    return this.store.view.all$().pipe(\r\n      debounce((results: SearchResult[]) => {\r\n        return results.length === 0 ? EMPTY : timer(200);\r\n      }),\r\n      map((results: SearchResult[]) => {\r\n        return this.groupResults(results.sort(this.sortByOrder));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Sort the results by display order.\r\n   * @param r1 First result\r\n   * @param r2 Second result\r\n   */\r\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\r\n    return r1.source.displayOrder - r2.source.displayOrder;\r\n  }\r\n\r\n  /**\r\n   * Group results by search source\r\n   * @param results Search results from all sources\r\n   * @returns Search results grouped by source\r\n   */\r\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\r\n    const grouped = new Map<SearchSource, SearchResult[]>();\r\n    results.forEach((result: SearchResult) => {\r\n      const source = result.source;\r\n      let sourceResults = grouped.get(source);\r\n      if (sourceResults === undefined) {\r\n        sourceResults = [];\r\n        grouped.set(source, sourceResults);\r\n      }\r\n      sourceResults.push(result);\r\n    });\r\n\r\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\r\n      if (this.pageIterator[source.getId()] === undefined) {\r\n        this.pageIterator[source.getId()] = 1;\r\n      }\r\n      return {source, results: grouped.get(source)};\r\n    });\r\n  }\r\n\r\n  isMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\r\n    return group.results && group.results[group.results.length - 1].meta.nextPage === true;\r\n  }\r\n\r\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\r\n    const options: TextSearchOptions = {\r\n      sourceId: group.source.getId(),\r\n      page: ++this.pageIterator[group.source.getId()]\r\n    };\r\n\r\n    const researches = this.searchService.search(this.term, options);\r\n    researches.map(research => {\r\n      research.request.subscribe((results: SearchResult[]) => {\r\n        const newResults = group.results.concat(results);\r\n        if (!results.length) {\r\n          newResults[newResults.length - 1].meta.nextPage = false;\r\n        }\r\n        this.moreResults.emit({research, results: newResults});\r\n      });\r\n    });\r\n    return;\r\n  }\r\n}\r\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport {\r\n  getEntityTitle,\r\n  getEntityTitleHtml,\r\n  getEntityIcon\r\n} from '@igo2/common';\r\n\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\r\nimport { IgoMap } from '../../map';\r\n\r\n/**\r\n * Search results list item\r\n */\r\n@Component({\r\n  selector: 'igo-search-results-item',\r\n  templateUrl: './search-results-item.component.html',\r\n  styleUrls: ['./search-results-item.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultsItemComponent {\r\n  /**\r\n   * Search result item\r\n   */\r\n  @Input() result: SearchResult;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Search result title\r\n   * @internal\r\n   */\r\n\r\n  /**\r\n   * to show hide results icons\r\n   */\r\n  @Input() showIcons: boolean;\r\n\r\n  /**\r\n   * Whether there should be a zoom button\r\n   */\r\n  @Input() withZoomButton = false;\r\n\r\n  @Output() zoomEvent = new EventEmitter<boolean>();\r\n\r\n  private format = new olFormatGeoJSON();\r\n\r\n  get title(): string {\r\n    return getEntityTitle(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result HTML title\r\n   * @internal\r\n   */\r\n  get titleHtml(): string {\r\n    return getEntityTitleHtml(this.result);\r\n  }\r\n\r\n  /**\r\n   * Search result tooltip\r\n   * @internal\r\n   */\r\n  get tooltipHtml(): string {\r\n    return this.titleHtml\r\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\r\n      .replace(/<\\/?[^>]+(>|$)/g, '');\r\n  }\r\n\r\n  /**\r\n   * Search result icon\r\n   * @internal\r\n   */\r\n  get icon(): string {\r\n    return getEntityIcon(this.result);\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  onZoomHandler() {\r\n    const olFeature = this.format.readFeature(this.result.data, {\r\n      dataProjection: this.result.data.projection,\r\n      featureProjection: this.map.projection\r\n    });\r\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  ChangeDetectionStrategy,\r\n  OnInit,\r\n  OnDestroy\r\n} from '@angular/core';\r\n\r\nimport { SearchResult } from '../shared/search.interfaces';\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\r\nimport { LayerService } from '../../layer/shared/layer.service';\r\nimport { LAYER } from '../../layer/shared/layer.enums';\r\nimport { Subscription, BehaviorSubject } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'igo-search-add-button',\r\n  templateUrl: './search-results-add-button.component.html',\r\n  styleUrls: ['./search-results-add-button.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\r\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\r\n    'igo.geo.catalog.layer.addToMap'\r\n  );\r\n\r\n  private resolution$$: Subscription;\r\n\r\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\r\n\r\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  private layersSubcriptions = [];\r\n\r\n  private lastTimeoutRequest;\r\n\r\n  @Input() layer: SearchResult;\r\n\r\n  /**\r\n   * Whether the layer is already added to the map\r\n   */\r\n  @Input() added: boolean;\r\n\r\n  /**\r\n   * The map to add the search result layer to\r\n   */\r\n  @Input() map: IgoMap;\r\n\r\n  @Input()\r\n  get color() {\r\n    return this._color;\r\n  }\r\n  set color(value: string) {\r\n    this._color = value;\r\n  }\r\n  private _color = 'primary';\r\n\r\n  constructor(private layerService: LayerService) {}\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  ngOnInit(): void {\r\n    if (this.layer.meta.dataType === 'Layer') {\r\n      this.added =\r\n        this.map.layers.findIndex(\r\n          lay => lay.id === this.layer.data.sourceOptions.id\r\n        ) !== -1;\r\n    }\r\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\r\n      this.isInResolutionsRange(value);\r\n      this.tooltip$.next(this.computeTooltip());\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.resolution$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * On mouse event, mouseenter /mouseleave\r\n   * @internal\r\n   */\r\n  onMouseEvent(event) {\r\n    this.onToggleClick(event);\r\n  }\r\n\r\n  /**\r\n   * On toggle button click, emit the added change event\r\n   * @internal\r\n   */\r\n  onToggleClick(event) {\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\r\n      clearTimeout(this.lastTimeoutRequest);\r\n    }\r\n\r\n    switch (event.type) {\r\n      case 'click':\r\n        if (!this.isPreview$.value) {\r\n          if (this.added) {\r\n            this.remove();\r\n          } else {\r\n            this.add();\r\n          }\r\n        }\r\n        this.isPreview$.next(false);\r\n        break;\r\n      case 'mouseenter':\r\n        if (!this.isPreview$.value && !this.added) {\r\n          this.lastTimeoutRequest = setTimeout(() => {\r\n            this.add();\r\n            this.isPreview$.next(true);\r\n          }, 500);\r\n        }\r\n        break;\r\n      case 'mouseleave':\r\n        if (this.isPreview$.value) {\r\n          this.remove();\r\n          this.isPreview$.next(false);\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  private add() {\r\n    if (!this.added) {\r\n      this.added = true;\r\n      this.addLayerToMap();\r\n    }\r\n  }\r\n\r\n  private remove() {\r\n    if (this.added) {\r\n      this.added = false;\r\n      this.removeLayerFromMap();\r\n      this.layersSubcriptions.map(s => s.unsubscribe());\r\n      this.layersSubcriptions = [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = true\r\n   */\r\n  private addLayerToMap() {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\r\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\r\n      layerOptions.sourceOptions.optionsFromApi = true;\r\n    }\r\n    this.layersSubcriptions.push(\r\n      this.layerService\r\n        .createAsyncLayer(layerOptions)\r\n        .subscribe(layer => this.map.addLayer(layer))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Emit added change event with added = false\r\n   */\r\n  private removeLayerFromMap() {\r\n    if (this.map === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.layer.meta.dataType !== LAYER) {\r\n      return undefined;\r\n    }\r\n\r\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\r\n    this.map.removeLayer(oLayer);\r\n  }\r\n\r\n  isInResolutionsRange(resolution: number) {\r\n    const minResolution = this.layer.data.minResolution || 0;\r\n    const maxResolution = this.layer.data.maxResolution || Infinity;\r\n    this.inRange$.next(\r\n      resolution >= minResolution && resolution <= maxResolution\r\n    );\r\n  }\r\n\r\n  computeTooltip(): string {\r\n    if (this.added) {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.removeFromMap'\r\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\r\n    } else {\r\n      return this.inRange$.value\r\n        ? 'igo.geo.catalog.layer.addToMap'\r\n        : 'igo.geo.catalog.layer.addToMapOutRange';\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport {\r\n  MatTooltipModule,\r\n  MatIconModule,\r\n  MatListModule,\r\n  MatButtonModule,\r\n  MatBadgeModule\r\n} from '@angular/material';\r\n\r\nimport {\r\n  IgoCollapsibleModule,\r\n  IgoListModule,\r\n  IgoMatBadgeIconModule,\r\n  IgoStopPropagationModule\r\n} from '@igo2/common';\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\r\nimport { SearchResultsComponent } from './search-results.component';\r\nimport { SearchResultsItemComponent } from './search-results-item.component';\r\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatBadgeModule,\r\n    MatTooltipModule,\r\n    MatIconModule,\r\n    MatListModule,\r\n    MatButtonModule,\r\n    IgoCollapsibleModule,\r\n    IgoListModule,\r\n    IgoStopPropagationModule,\r\n    IgoLanguageModule,\r\n    IgoMatBadgeIconModule,\r\n    IgoMetadataModule,\r\n  ],\r\n  exports: [\r\n    SearchResultsComponent,\r\n    SearchResultAddButtonComponent\r\n  ],\r\n  declarations: [\r\n    SearchResultsComponent,\r\n    SearchResultsItemComponent,\r\n    SearchResultAddButtonComponent\r\n  ]\r\n})\r\nexport class IgoSearchResultsModule {}\r\n","import {\r\n  Directive,\r\n  Input,\r\n  OnDestroy,\r\n  Self,\r\n  OnInit,\r\n  HostListener,\r\n  AfterContentChecked\r\n} from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\n\r\nimport { MapBrowserPointerEvent as OlMapBrowserPointerEvent } from 'ol/MapBrowserEvent';\r\nimport { ListenerFunction } from 'ol/events';\r\n\r\nimport { IgoMap } from '../../map/shared/map';\r\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\r\nimport { Feature } from '../../feature/shared/feature.interfaces';\r\nimport { SearchService } from './search.service';\r\n\r\nimport olFeature from 'ol/Feature';\r\nimport { transform } from 'ol/proj';\r\nimport * as olstyle from 'ol/style';\r\nimport * as olgeom from 'ol/geom';\r\nimport OlGeoJSON from 'ol/format/GeoJSON';\r\n\r\nimport { SearchResult, Research } from './search.interfaces';\r\nimport { EntityStore } from '@igo2/common';\r\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\r\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\r\nimport { take } from 'rxjs/operators';\r\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\r\nimport { FeatureStore } from '../../feature/shared/store';\r\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\r\nimport { SearchSourceService } from './search-source.service';\r\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\r\nimport { MediaService } from '@igo2/core';\r\n\r\n/**\r\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\r\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\r\n * By default, no search sources. Config in config file must be defined.\r\n * the layer level.\r\n */\r\n@Directive({\r\n  selector: '[igoSearchPointerSummary]'\r\n})\r\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\r\n\r\n  public store: FeatureStore<Feature>;\r\n  private lonLat: [number, number];\r\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\r\n  private lastTimeoutRequest;\r\n  private store$$: Subscription;\r\n  private layers$$: Subscription;\r\n  private reverseSearch$$: Subscription[] = [];\r\n  private hasPointerReverseSearchSource: boolean =  false;\r\n\r\n  /**\r\n   * Listener to the pointer move event\r\n   */\r\n  private pointerMoveListener: ListenerFunction;\r\n\r\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\r\n  /**\r\n   * The delay where the mouse must be motionless before trigger the reverse search\r\n   */\r\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\r\n\r\n  /**\r\n   * If the user has enabled or not the directive\r\n   */\r\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\r\n\r\n  @HostListener('mouseout')\r\n  mouseout() {\r\n    clearTimeout(this.lastTimeoutRequest);\r\n    this.clearLayer();\r\n  }\r\n\r\n  /**\r\n   * IGO map\r\n   * @internal\r\n   */\r\n  get map(): IgoMap {\r\n    return this.component.map;\r\n  }\r\n\r\n  get mapProjection(): string {\r\n    return (this.component.map as IgoMap).projection;\r\n  }\r\n\r\n  constructor(\r\n    @Self() private component: MapBrowserComponent,\r\n    private searchService: SearchService,\r\n    private searchSourceService: SearchSourceService,\r\n    private mediaService: MediaService\r\n  ) { }\r\n\r\n  /**\r\n   * Start listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnInit() {\r\n    this.listenToMapPointerMove();\r\n    this.subscribeToPointerStore();\r\n\r\n    this.map.status$.pipe(take(1)).subscribe(() => {\r\n      this.store = new FeatureStore<Feature>([], {map: this.map});\r\n      this.initStore();\r\n    });\r\n\r\n    // To handle context change without using the contextService.\r\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\r\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\r\n        this.initStore();\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Initialize the pointer position store\r\n   * @internal\r\n   */\r\n  private initStore() {\r\n    const store = this.store;\r\n\r\n    const layer = new VectorLayer({\r\n      id : 'searchPointerSummaryId',\r\n      title: 'searchPointerSummary',\r\n      zIndex: 900,\r\n      source: new FeatureDataSource(),\r\n      showInLayerList: false,\r\n      exportable: false,\r\n      browsable: false,\r\n      style: pointerPositionSummaryMarker\r\n    });\r\n    tryBindStoreLayer(store, layer);\r\n  }\r\n\r\n  ngAfterContentChecked(): void {\r\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\r\n        this.hasPointerReverseSearchSource = false;\r\n      } else {\r\n        this.hasPointerReverseSearchSource = true;\r\n      }\r\n    }\r\n\r\n  /**\r\n   * Stop listening to pointermove and reverse search results.\r\n   * @internal\r\n   */\r\n  ngOnDestroy() {\r\n    this.unlistenToMapPointerMove();\r\n    this.unsubscribeToPointerStore();\r\n    this.unsubscribeReverseSearch();\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to pointermove result store\r\n   * @internal\r\n   */\r\n  subscribeToPointerStore() {\r\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\r\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Build an object based on the closest feature by type (base on type and distance properties )\r\n   * @param results SearchResult[]\r\n   * @returns OL style function\r\n   */\r\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\r\n    const closestResultByType = {};\r\n\r\n    results.map(result => {\r\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\r\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\r\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\r\n          if (result.data.properties.distance < prevDistance) {\r\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title: result.meta.title };\r\n          }\r\n        } else {\r\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title: result.meta.title };\r\n        }\r\n      }\r\n    });\r\n\r\n    return closestResultByType;\r\n  }\r\n\r\n  /**\r\n   * convert store entities to a pointer position overlay with label summary on.\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\r\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\r\n    const summarizedClosestType = Object.keys(closestResultByType);\r\n    const processedSummarizedClosestType = [];\r\n    const summary = [];\r\n    resultsUnderPointerPosition.map(result => {\r\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\r\n      if (typeIndex !== -1) {\r\n        summary.push(closestResultByType[result.data.properties.type].title);\r\n        summarizedClosestType.splice(typeIndex, 1);\r\n        processedSummarizedClosestType.push(result.data.properties.type);\r\n      } else {\r\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\r\n          summary.push(result.meta.title);\r\n        }\r\n      }\r\n    });\r\n    if (summary.length) {\r\n      this.addPointerOverlay(summary.join('\\n'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On map pointermove\r\n   */\r\n  private listenToMapPointerMove() {\r\n    this.pointerMoveListener = this.map.ol.on(\r\n      'pointermove',\r\n      (event: OlMapBrowserPointerEvent) => this.onMapEvent(event)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe to pointer store.\r\n   * @internal\r\n   */\r\n  unsubscribeToPointerStore() {\r\n    this.store$$.unsubscribe();\r\n  }\r\n  /**\r\n   * Unsubscribe to reverse seatch store.\r\n   * @internal\r\n   */\r\n  unsubscribeReverseSearch() {\r\n    this.reverseSearch$$.map(s => s.unsubscribe());\r\n    this.reverseSearch$$ = [];\r\n  }\r\n\r\n  /**\r\n   * Stop listening for map pointermove\r\n   * @internal\r\n   */\r\n  private unlistenToMapPointerMove() {\r\n    this.map.ol.un(this.pointerMoveListener.type, this.pointerMoveListener.listener);\r\n    this.pointerMoveListener = undefined;\r\n  }\r\n\r\n  /**\r\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\r\n   * @param event OL map browser pointer event\r\n   */\r\n  private onMapEvent(event: OlMapBrowserPointerEvent) {\r\n    if (\r\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\r\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\r\n      this.clearLayer();\r\n      return;\r\n    }\r\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\r\n      clearTimeout(this.lastTimeoutRequest);\r\n      this.clearLayer();\r\n      this.unsubscribeReverseSearch();\r\n    }\r\n\r\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326');\r\n\r\n    this.lastTimeoutRequest = setTimeout(() => {\r\n      this.onSearchCoordinate();\r\n    }, this.igoSearchPointerSummaryDelay);\r\n  }\r\n\r\n  private onSearchCoordinate() {\r\n    this.pointerSearchStore.clear();\r\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\r\n\r\n    for (const i in results) {\r\n      if (results.length > 0) {\r\n        this.reverseSearch$$.push(\r\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\r\n            this.onSearch({ research: results[i], results: _results });\r\n          }));\r\n      }\r\n    }\r\n  }\r\n\r\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\r\n    const results = event.results;\r\n    const newResults = this.pointerSearchStore.all()\r\n      .filter((result: SearchResult) => result.source !== event.research.source)\r\n      .concat(results);\r\n    this.pointerSearchStore.load(newResults);\r\n  }\r\n\r\n  /**\r\n   * Add a feature to the pointer store\r\n   * @param text string\r\n   */\r\n  private addPointerOverlay(text: string) {\r\n    this.clearLayer();\r\n\r\n    const geometry = new olgeom.Point(\r\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\r\n    );\r\n    const feature = new olFeature({ geometry });\r\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\r\n      featureProjection: this.mapProjection,\r\n      dataProjection: this.mapProjection\r\n    });\r\n\r\n    const f: Feature = {\r\n      type: FEATURE,\r\n      geometry: geojsonGeom,\r\n      projection: this.mapProjection,\r\n      properties: {\r\n        id: this.searchPointerSummaryFeatureId,\r\n        pointerSummary: text\r\n      },\r\n      meta: {\r\n        id: this.searchPointerSummaryFeatureId\r\n      },\r\n      ol: feature\r\n    };\r\n    this.store.setLayerFeatures([f], FeatureMotion.None);\r\n  }\r\n\r\n/**\r\n * Clear the pointer store features\r\n */\r\nprivate clearLayer() {\r\n  if (this.store) {\r\n    this.store.clearLayer();\r\n  }\r\n}\r\n\r\n}\r\n\r\n/**\r\n * Create a default style for the pointer position and it's label summary.\r\n * @param feature OlFeature\r\n * @returns OL style function\r\n */\r\nexport function pointerPositionSummaryMarker(feature: olFeature, resolution: number): olstyle.Style {\r\n  return new olstyle.Style({\r\n    image: new olstyle.Icon({\r\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\r\n      imgSize: [18, 18], // for ie\r\n    }),\r\n\r\n    text: new olstyle.Text({\r\n      text: feature.get('pointerSummary'),\r\n      textAlign: 'left',\r\n      textBaseline: 'bottom',\r\n      font: '12px Calibri,sans-serif',\r\n      fill: new olstyle.Fill({ color: '#000' }),\r\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\r\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\r\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\r\n      overflow: true,\r\n      offsetX: 10,\r\n      offsetY: -10,\r\n      padding: [2.5, 2.5, 2.5, 2.5]\r\n    })\r\n  });\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\r\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\r\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\r\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\r\n\r\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\r\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\r\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\r\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\r\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoSearchBarModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchResultsModule,\r\n    IgoSearchSettingsModule\r\n  ],\r\n  exports: [\r\n    IgoSearchBarModule,\r\n    IgoSearchSelectorModule,\r\n    IgoSearchResultsModule,\r\n    IgoSearchSettingsModule,\r\n    SearchPointerSummaryDirective\r\n  ],\r\n  declarations: [SearchPointerSummaryDirective]\r\n})\r\nexport class IgoSearchModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoSearchModule,\r\n      providers: [\r\n        provideSearchSourceService(),\r\n        provideDefaultIChercheSearchResultFormatter(),\r\n        provideDefaultCoordinatesSearchResultFormatter(),\r\n        provideILayerSearchResultFormatter()\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\r\n\r\nimport { FlexibleState, getEntityTitle } from '@igo2/common';\r\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\r\nimport { Feature } from '../feature/shared/feature.interfaces';\r\nimport { FeatureMotion } from '../feature/shared/feature.enums';\r\nimport { moveToOlFeatures } from '../feature/shared/feature.utils';\r\nimport { IgoMap } from '../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-toast',\r\n  templateUrl: './toast.component.html',\r\n  styleUrls: ['./toast.component.scss']\r\n})\r\nexport class ToastComponent {\r\n  static SWIPE_ACTION = {\r\n    UP: 'swipeup',\r\n    DOWN: 'swipedown'\r\n  };\r\n  private format = new olFormatGeoJSON();\r\n\r\n  @Input()\r\n  get expanded(): boolean {\r\n    return this._expanded;\r\n  }\r\n  set expanded(value: boolean) {\r\n    this.state = value ? 'expanded' : 'collapsed';\r\n    this._expanded = value;\r\n  }\r\n  private _expanded: boolean;\r\n\r\n  @Input()\r\n  get map(): IgoMap {\r\n    return this._map;\r\n  }\r\n  set map(value: IgoMap) {\r\n    this._map = value;\r\n  }\r\n  private _map: IgoMap;\r\n\r\n  @Input()\r\n  get feature(): Feature {\r\n    return this._feature;\r\n  }\r\n  set feature(value: Feature) {\r\n    this._feature = value;\r\n  }\r\n  private _feature: Feature;\r\n\r\n  @Output() opened = new EventEmitter<boolean>();\r\n\r\n  public state: FlexibleState;\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  get title(): string { return getEntityTitle(this.feature); }\r\n\r\n  constructor() {}\r\n\r\n  toggle() {\r\n    this.expanded = !this.expanded;\r\n    this.opened.emit(this.expanded);\r\n  }\r\n\r\n  zoomToFeatureExtent() {\r\n    if (this.feature.geometry) {\r\n      const olFeature = this.format.readFeature(this.feature, {\r\n        dataProjection: this.feature.projection,\r\n        featureProjection: this.map.projection\r\n      });\r\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\r\n    }\r\n  }\r\n\r\n  swipe(action: string) {\r\n    if (action === ToastComponent.SWIPE_ACTION.UP) {\r\n      if (!this.expanded) {\r\n        this.toggle();\r\n      }\r\n    } else if (action === ToastComponent.SWIPE_ACTION.DOWN) {\r\n      if (this.expanded) {\r\n        this.toggle();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatIconModule, MatButtonModule } from '@angular/material';\r\n\r\nimport { IgoPanelModule, IgoFlexibleModule } from '@igo2/common';\r\n\r\nimport { IgoFeatureModule } from '../feature/feature.module';\r\nimport { ToastComponent } from './toast.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    IgoPanelModule,\r\n    IgoFlexibleModule,\r\n    IgoFeatureModule\r\n  ],\r\n  exports: [ToastComponent],\r\n  declarations: [ToastComponent]\r\n})\r\nexport class IgoToastModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoToastModule\r\n    };\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef\r\n} from '@angular/core';\r\n\r\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\r\n\r\nimport { Layer } from '../../../layer/shared/layers/layer';\r\nimport { IgoMap } from '../../../map/shared/map';\r\n\r\n@Component({\r\n  selector: 'igo-ogc-filter',\r\n  templateUrl: './ogc-filter.component.html',\r\n  styleUrls: ['./ogc-filter.component.scss'],\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\r\n\r\n  @Input() layer: Layer;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  /**\r\n   * Event emitted on complete\r\n   */\r\n  @Output() complete = new EventEmitter<void>();\r\n\r\n  /**\r\n   * Event emitted on cancel\r\n   */\r\n  @Output() cancel = new EventEmitter<void>();\r\n\r\n  constructor(private cdRef: ChangeDetectorRef) {}\r\n\r\n  /**\r\n   * Implemented as part of OnUpdateInputs\r\n   */\r\n  onUpdateInputs() {\r\n    this.cdRef.detectChanges();\r\n  }\r\n\r\n  /**\r\n   * On close, emit the cancel event\r\n   */\r\n  onClose() {\r\n    this.cancel.emit();\r\n  }\r\n\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\n\r\nimport { Widget, WidgetService } from '@igo2/common';\r\n\r\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\r\n\r\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\r\n\r\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\r\n  return widgetService.create(OgcFilterComponent);\r\n}\r\n\r\nexport function provideOgcFilterWidget() {\r\n  return {\r\n    provide: OgcFilterWidget,\r\n    useFactory: ogcFilterWidgetFactory,\r\n    deps: [WidgetService]\r\n  };\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material';\r\n\r\nimport { IgoLanguageModule } from '@igo2/core';\r\n\r\nimport { IgoFilterModule } from '../../../filter/filter.module';\r\nimport { OgcFilterComponent } from './ogc-filter.component';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    MatButtonModule,\r\n    IgoLanguageModule,\r\n    IgoFilterModule\r\n  ],\r\n  exports: [OgcFilterComponent],\r\n  declarations: [OgcFilterComponent],\r\n  entryComponents: [OgcFilterComponent]\r\n})\r\nexport class IgoOgcFilterModule {}\r\n","import {\r\n  Workspace,\r\n  WorkspaceOptions\r\n} from '@igo2/common';\r\n\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\r\n  layer: VectorLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class WfsWorkspace extends Workspace {\r\n\r\n  get layer(): VectorLayer { return this.options.layer; }\r\n\r\n  get map(): IgoMap { return this.options.map; }\r\n\r\n  constructor(protected options: WfsWorkspaceOptions) {\r\n    super(options);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport {\r\n  ActionStore,\r\n  EntityTableTemplate\r\n} from '@igo2/common';\r\n\r\nimport {\r\n  FeatureStore,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy\r\n} from '../../feature';\r\nimport { VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\nimport { SourceFieldsOptionsParams } from '../../datasource';\r\n\r\nimport { WfsWorkspace } from './wfs-workspace';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WfsWorkspaceService {\r\n\r\n  constructor() {}\r\n\r\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\r\n    return new WfsWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      entityStore: this.createFeatureStore(layer, map),\r\n      actionStore: new ActionStore([]),\r\n      meta: {\r\n        tableTemplate: this.createTableTemplate(layer)\r\n      }\r\n    });\r\n  }\r\n\r\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\r\n    const store = new FeatureStore([], {map});\r\n    store.bindLayer(layer);\r\n\r\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\r\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\r\n      map,\r\n      hitTolerance: 5\r\n    });\r\n    store.addStrategy(loadingStrategy, true);\r\n    store.addStrategy(selectionStrategy, true);\r\n\r\n    return store;\r\n  }\r\n\r\n  private createTableTemplate(layer: VectorLayer): EntityTableTemplate {\r\n    const fields = layer.dataSource.options.sourceFields || [];\r\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\r\n      return {\r\n        name: `properties.${field.name}`,\r\n        title: field.alias ? field.alias : field.name\r\n      };\r\n    });\r\n\r\n    return {\r\n      selection: true,\r\n      sort: true,\r\n      columns\r\n    };\r\n  }\r\n\r\n}\r\n","import {\r\n  Workspace,\r\n  WorkspaceOptions\r\n} from '@igo2/common';\r\n\r\nimport { ImageLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nexport interface WmsWorkspaceOptions extends WorkspaceOptions {\r\n  layer: ImageLayer;\r\n  map: IgoMap;\r\n}\r\n\r\nexport class WmsWorkspace extends Workspace {\r\n\r\n  get layer(): ImageLayer { return this.options.layer; }\r\n\r\n  get map(): IgoMap { return this.options.map; }\r\n\r\n  constructor(protected options: WmsWorkspaceOptions) {\r\n    super(options);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ActionStore } from '@igo2/common';\r\n\r\nimport {\r\n  FeatureStore,\r\n  FeatureStoreLoadingLayerStrategy,\r\n  FeatureStoreSelectionStrategy\r\n} from '../../feature';\r\nimport { ImageLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\n\r\nimport { WmsWorkspace } from './wms-workspace';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class WmsWorkspaceService {\r\n\r\n  constructor() {}\r\n\r\n  createWorkspace(layer: ImageLayer, map: IgoMap): WmsWorkspace {\r\n    return new WmsWorkspace({\r\n      id: layer.id,\r\n      title: layer.title,\r\n      layer,\r\n      map,\r\n      actionStore: new ActionStore([])\r\n    });\r\n  }\r\n\r\n}\r\n","import { Directive, Input, OnInit, OnDestroy } from '@angular/core';\r\n\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime } from 'rxjs/operators';\r\n\r\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\r\n\r\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\r\nimport { IgoMap } from '../../map';\r\nimport { WFSDataSource, WMSDataSource } from '../../datasource';\r\nimport { OgcFilterableDataSourceOptions } from '../../filter';\r\n\r\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\r\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\r\n\r\n@Directive({\r\n  selector: '[igoWorkspaceSelector]'\r\n})\r\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\r\n\r\n  private layers$$: Subscription;\r\n\r\n  @Input() map: IgoMap;\r\n\r\n  get workspaceStore(): WorkspaceStore {\r\n    return this.component.store;\r\n  }\r\n\r\n  constructor(\r\n    private component: WorkspaceSelectorComponent,\r\n    private wfsWorkspaceService: WfsWorkspaceService,\r\n    private wmsWorkspaceService: WmsWorkspaceService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.layers$$ = this.map.layers$\r\n      .pipe(debounceTime(50))\r\n      .subscribe((layers: Layer[]) =>\r\n        this.onLayersChange(layers)\r\n      );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.layers$$.unsubscribe();\r\n  }\r\n\r\n  private onLayersChange(layers: Layer[]) {\r\n    const editableLayers = layers.filter((layer: Layer) =>\r\n      this.layerIsEditable(layer)\r\n    );\r\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\r\n\r\n    const workspacesToAdd = editableLayers\r\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\r\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\r\n\r\n    const workspacesToRemove = this.workspaceStore.all()\r\n      .filter((workspace: Workspace) => {\r\n        return editableLayersIds.indexOf(workspace.id) < 0;\r\n      });\r\n\r\n    if (workspacesToRemove.length > 0) {\r\n      workspacesToRemove.forEach((workspace: Workspace) => {\r\n        workspace.deactivate();\r\n      });\r\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\r\n      this.workspaceStore.deleteMany(workspacesToRemove);\r\n    }\r\n\r\n    if (workspacesToAdd.length > 0) {\r\n      this.workspaceStore.insertMany(workspacesToAdd);\r\n    }\r\n  }\r\n\r\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\r\n    const workspace = this.workspaceStore.get(layer.id);\r\n    if (workspace !== undefined) {\r\n      return;\r\n    }\r\n    if (layer.dataSource instanceof WFSDataSource) {\r\n      return this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\r\n    } else if (layer.dataSource instanceof WMSDataSource) {\r\n      return this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  private layerIsEditable(layer: Layer): boolean {\r\n    const dataSource = layer.dataSource;\r\n    if (dataSource instanceof WFSDataSource) {\r\n      return true;\r\n    }\r\n\r\n    if (dataSource instanceof WMSDataSource) {\r\n      const dataSourceOptions = (dataSource.options ||\r\n        {}) as OgcFilterableDataSourceOptions;\r\n      return (\r\n        dataSourceOptions.ogcFilters && dataSourceOptions.ogcFilters.enabled\r\n      );\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\r\n\r\n/**\r\n * @ignore\r\n */\r\n@NgModule({\r\n  imports: [\r\n    CommonModule\r\n  ],\r\n  exports: [\r\n   WorkspaceSelectorDirective\r\n  ],\r\n  declarations: [\r\n    WorkspaceSelectorDirective\r\n  ]\r\n})\r\nexport class IgoWorkspaceSelectorModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IgoWidgetModule } from '@igo2/common';\r\n\r\nimport { provideOgcFilterWidget } from './widgets/widgets';\r\n\r\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\r\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    IgoWidgetModule,\r\n    IgoWorkspaceSelectorModule,\r\n    IgoOgcFilterModule\r\n  ],\r\n  exports: [\r\n    IgoWorkspaceSelectorModule,\r\n    IgoOgcFilterModule\r\n  ],\r\n  declarations: [],\r\n  providers: [\r\n    provideOgcFilterWidget()\r\n  ]\r\n})\r\nexport class IgoGeoWorkspaceModule {}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  exports: [],\r\n  declarations: []\r\n})\r\nexport class IgoWktModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoWktModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\n\r\nimport { IgoCatalogModule } from './catalog/catalog.module';\r\nimport { IgoDataSourceModule } from './datasource/datasource.module';\r\nimport { IgoDownloadModule } from './download/download.module';\r\nimport { IgoFeatureModule } from './feature/feature.module';\r\nimport { IgoFilterModule } from './filter/filter.module';\r\nimport { IgoGeometryModule } from './geometry/geometry.module';\r\nimport { IgoImportExportModule } from './import-export/import-export.module';\r\nimport { IgoLayerModule } from './layer/layer.module';\r\nimport { IgoMapModule } from './map/map.module';\r\nimport { IgoMeasureModule } from './measure/measure.module';\r\nimport { IgoMetadataModule } from './metadata/metadata.module';\r\nimport { IgoOverlayModule } from './overlay/overlay.module';\r\nimport { IgoPrintModule } from './print/print.module';\r\nimport { IgoQueryModule } from './query/query.module';\r\nimport { IgoDirectionsModule } from './directions/directions.module';\r\nimport { IgoSearchModule } from './search/search.module';\r\nimport { IgoToastModule } from './toast/toast.module';\r\nimport { IgoGeoWorkspaceModule } from './workspace/workspace.module';\r\nimport { IgoWktModule } from './wkt/wkt.module';\r\n\r\n@NgModule({\r\n  imports: [],\r\n  declarations: [],\r\n  exports: [\r\n    IgoCatalogModule,\r\n    IgoDataSourceModule,\r\n    IgoDownloadModule,\r\n    IgoFeatureModule,\r\n    IgoFilterModule,\r\n    IgoGeometryModule,\r\n    IgoImportExportModule,\r\n    IgoLayerModule,\r\n    IgoMapModule,\r\n    IgoMeasureModule,\r\n    IgoMetadataModule,\r\n    IgoOverlayModule,\r\n    IgoPrintModule,\r\n    IgoQueryModule,\r\n    IgoDirectionsModule,\r\n    IgoSearchModule,\r\n    IgoToastModule,\r\n    IgoGeoWorkspaceModule,\r\n    IgoWktModule\r\n  ]\r\n})\r\nexport class IgoGeoModule {\r\n  static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: IgoGeoModule,\r\n      providers: []\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { OptionsService } from './options.service';\r\nimport { OptionsApiService } from './options-api.service';\r\n\r\nexport function optionsApiFactory(\r\n  http: HttpClient,\r\n  configService: ConfigService\r\n) {\r\n  return new OptionsApiService(\r\n    http,\r\n    configService.getConfig('optionsApi'),\r\n  );\r\n}\r\n\r\nexport function provideOptionsApi() {\r\n  return {\r\n    provide: OptionsService,\r\n    useFactory: optionsApiFactory,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport olWKT from 'ol/format/WKT';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\n\r\n/**\r\n * Cadastre search source\r\n */\r\n@Injectable()\r\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'cadastre';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options);\r\n  }\r\n\r\n  getId(): string {\r\n    return CadastreSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return CadastreSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Cadastre (QuÃ©bec)',\r\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\r\n    term = term.startsWith(',') ? term.substr(1) : term;\r\n    term = term.replace(/ /g, '');\r\n\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\r\n      return of([]);\r\n    }\r\n    return this.http\r\n      .get(this.searchUrl, { params, responseType: 'text' })\r\n      .pipe(map((response: string) => this.extractResults(response)));\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          numero: term,\r\n          epsg: '4326'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(response: string): SearchResult<Feature>[] {\r\n    return response\r\n      .split('<br />')\r\n      .filter((lot: string) => lot.length > 0)\r\n      .map((lot: string) => this.dataToResult(lot));\r\n  }\r\n\r\n  private dataToResult(data: string): SearchResult<Feature> {\r\n    const lot = data.split(';');\r\n    const numero = lot[0];\r\n    const wkt = lot[7];\r\n    const geometry = this.computeGeometry(wkt);\r\n    const properties = { NoLot: numero };\r\n    const id = [this.getId(), 'cadastre', numero].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: numero,\r\n        icon: 'map-marker'\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: numero\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeGeometry(wkt: string): FeatureGeometry {\r\n    const feature = new olWKT().readFeature(wkt, {\r\n      dataProjection: 'EPSG:4326',\r\n      featureProjection: 'EPSG:4326'\r\n    });\r\n    return {\r\n      type: feature.getGeometry().getType(),\r\n      coordinates: feature.getGeometry().getCoordinates()\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { CadastreSearchSource } from './cadastre';\r\n\r\n/**\r\n * Cadastre search source factory\r\n * @ignore\r\n */\r\nexport function cadastreSearchSourceFactory(\r\n  http: HttpClient,\r\n  config: ConfigService\r\n) {\r\n  return new CadastreSearchSource(\r\n    http,\r\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Cadastre search source\r\n */\r\nexport function provideCadastreSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: cadastreSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch } from './source';\r\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\r\nimport { NominatimData } from './nominatim.interfaces';\r\n\r\n/**\r\n * Nominatim search source\r\n */\r\n@Injectable()\r\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\r\n  static id = 'nominatim';\r\n  static type = FEATURE;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options);\r\n  }\r\n\r\n  getId(): string {\r\n    return NominatimSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return NominatimSearchSource.type;\r\n  }\r\n\r\n  /*\r\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\r\n   */\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Nominatim (OSM)',\r\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\r\n      settings: [\r\n        {\r\n          type: 'checkbox',\r\n          title: 'results type',\r\n          name: 'amenity',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.food',\r\n              value:\r\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.health',\r\n              value:\r\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.entertainment',\r\n              value:\r\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\r\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.type.finance',\r\n              value: 'atm,bank,bureau_de_change',\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'results limit',\r\n          name: 'limit',\r\n          values: [\r\n            {\r\n              title: '10',\r\n              value: 10,\r\n              enabled: true\r\n            },\r\n            {\r\n              title: '20',\r\n              value: 20,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: '50',\r\n              value: 50,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'restrictExtent',\r\n          name: 'countrycodes',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.canada',\r\n              value: 'CA',\r\n              enabled: true\r\n            },\r\n            {\r\n              title: 'igo.geo.search.nominatim.country.all',\r\n              value: null,\r\n              enabled: false\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          type: 'radiobutton',\r\n          title: 'multiple object',\r\n          name: 'dedupe',\r\n          values: [\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.true',\r\n              value: 0,\r\n              enabled: false\r\n            },\r\n            {\r\n              title: 'igo.geo.search.searchSources.settings.false',\r\n              value: 1,\r\n              enabled: true\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a place by name\r\n   * @param term Place name\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string | undefined,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeSearchRequestParams(term, options || {});\r\n    if (!params.get('q')) {\r\n      return of([]);\r\n    }\r\n    return this.http\r\n      .get(this.searchUrl, { params })\r\n      .pipe(map((response: NominatimData[]) => this.extractResults(response)));\r\n  }\r\n\r\n  private computeSearchRequestParams(\r\n    term: string,\r\n    options: TextSearchOptions\r\n  ): HttpParams {\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          q: this.computeTerm(term),\r\n          format: 'json'\r\n        },\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(response: NominatimData[]): SearchResult<Feature>[] {\r\n    return response.map((data: NominatimData) => this.dataToResult(data));\r\n  }\r\n\r\n  private dataToResult(data: NominatimData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const geometry = this.computeGeometry(data);\r\n    const extent = this.computeExtent(data);\r\n    const id = [this.getId(), 'place', data.place_id].join('.');\r\n\r\n    return {\r\n      source: this,\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.display_name,\r\n        icon: 'map-marker'\r\n      },\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry,\r\n        extent,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.display_name\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: NominatimData): { [key: string]: any } {\r\n    return {\r\n      display_name: data.display_name,\r\n      place_id: data.place_id,\r\n      osm_type: data.osm_type,\r\n      class: data.class,\r\n      type: data.type\r\n    };\r\n  }\r\n\r\n  private computeGeometry(data: NominatimData): FeatureGeometry {\r\n    return {\r\n      type: 'Point',\r\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\r\n    };\r\n  }\r\n\r\n  private computeExtent(data: NominatimData): [number, number, number, number] {\r\n    return [\r\n      parseFloat(data.boundingbox[2]),\r\n      parseFloat(data.boundingbox[0]),\r\n      parseFloat(data.boundingbox[3]),\r\n      parseFloat(data.boundingbox[1])\r\n    ];\r\n  }\r\n\r\n  private computeTerm(term: string): string {\r\n    return this.computeTermTags(term);\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from query in Nominatim's format (+[])\r\n   * @param term Query with hashtag\r\n   */\r\n  private computeTermTags(term: string): string {\r\n    const hashtags = super.getHashtagsValid(term, 'amenity');\r\n    if (!hashtags) {\r\n      return this.computeTermSettings(term);\r\n    }\r\n\r\n    if (!hashtags.length) {\r\n      return null;\r\n    }\r\n\r\n    term = term.replace(/(#[^\\s]*)/g, '');\r\n    hashtags.forEach(tag => {\r\n      term += '+[' + tag + ']';\r\n    });\r\n\r\n    return term;\r\n  }\r\n\r\n  /**\r\n   * Add hashtag from settings in Nominatim's format (+[])\r\n   * @param term Query\r\n   */\r\n  private computeTermSettings(term: string): string {\r\n    this.options.settings.forEach(settings => {\r\n      if (settings.name === 'amenity') {\r\n        settings.values.forEach(conf => {\r\n          if (conf.enabled && typeof conf.value === 'string') {\r\n            const splitted = conf.value.split(',');\r\n            splitted.forEach(value => {\r\n              term += '+[' + value + ']';\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return term;\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport { NominatimSearchSource } from './nominatim';\r\n\r\n/**\r\n * Nominatim search source factory\r\n * @ignore\r\n */\r\nexport function nominatimSearchSourceFactory(\r\n  http: HttpClient,\r\n  config: ConfigService\r\n) {\r\n  return new NominatimSearchSource(\r\n    http,\r\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the Nominatim search source\r\n */\r\nexport function provideNominatimSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: nominatimSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","import { Injectable, Inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { ObjectUtils } from '@igo2/utils';\r\nimport { FEATURE, Feature } from '../../../feature';\r\n\r\nimport { SearchResult } from '../search.interfaces';\r\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\r\nimport {\r\n  SearchSourceOptions,\r\n  TextSearchOptions,\r\n  ReverseSearchOptions\r\n} from './source.interfaces';\r\nimport {\r\n  StoredQueriesData,\r\n  StoredQueriesResponse,\r\n  StoredQueriesReverseData,\r\n  StoredQueriesReverseResponse,\r\n  StoredQueriesSearchSourceOptions,\r\n  StoredQueriesFields,\r\n  StoredQueriesReverseSearchSourceOptions\r\n} from './storedqueries.interfaces';\r\n\r\nimport * as olformat from 'ol/format';\r\n\r\n/**\r\n * StoredQueries search source\r\n */\r\n@Injectable()\r\nexport class StoredQueriesSearchSource extends SearchSource\r\n  implements TextSearch {\r\n  static id = 'storedqueries';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [\r\n    'boundedBy',\r\n    'id',\r\n    'coord_x',\r\n    'coord_y'\r\n  ];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options);\r\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\r\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\r\n      return;\r\n    }\r\n\r\n    const defaultStoredqueryId = 'rtss';\r\n    const defaultFieldSplitter: StoredQueriesFields[] = [\r\n      { name: 'rtss', defaultValue: '-99' },\r\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\r\n    ];\r\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\r\n    const defaultSrsname = 'EPSG:4326';\r\n    const defaultResultTitle = 'title';\r\n\r\n    if (!this.storedQueriesOptions) {\r\n      console.log(\r\n        ' No configuration for this search source (storedqueries). You will use the default values'\r\n      );\r\n      this.storedQueriesOptions = {\r\n        storedquery_id: defaultStoredqueryId,\r\n        fields: defaultFieldSplitter,\r\n        outputformat: defaultOutputformat,\r\n        srsname: defaultSrsname,\r\n        resultTitle: defaultResultTitle\r\n      };\r\n      this.resultTitle = defaultResultTitle;\r\n      console.log('Default values', this.storedQueriesOptions);\r\n    }\r\n\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.fields) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n\r\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\r\n    if (\r\n      storedQueryId.includes('getfeaturebyid') &&\r\n      this.storedQueriesOptions.outputformat\r\n        .toLowerCase()\r\n        .includes('getfeaturebyid')\r\n    ) {\r\n      let err =\r\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\r\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\r\n      throw new Error(err);\r\n    }\r\n\r\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\r\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\r\n    }\r\n\r\n    this.multipleFieldsQuery =\r\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\r\n\r\n    this.storedQueriesOptions.fields.forEach((field, index) => {\r\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\r\n        );\r\n      }\r\n      if (!field.defaultValue) {\r\n        throw new Error(\r\n          'Stored Queries :You must set a field default value into your field definition'\r\n        );\r\n      }\r\n    });\r\n\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries',\r\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/ws/swtq'\r\n    };\r\n  }\r\n\r\n  // URL CALL EXAMPLES:\r\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\r\n  //  tslint:disable-next-line:max-line-length\r\n  //  https://geoegl.msp.gouv.qc.ca/apis/ws/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\r\n  //  Custom StoredQuery\r\n  //  tslint:disable-next-line:max-line-length\r\n  //  https://geoegl.msp.gouv.qc.ca/apis/ws/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\r\n\r\n  /**\r\n   * Search a location by name or keyword\r\n   * @param term Location name or keyword\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  search(\r\n    term: string,\r\n    options?: TextSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const storedqueriesParams = this.termSplitter(\r\n      term,\r\n      this.storedQueriesOptions.fields\r\n    );\r\n    const params = this.computeRequestParams(\r\n      options || {},\r\n      storedqueriesParams\r\n    );\r\n\r\n    if (\r\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\r\n    ) {\r\n      return this.http\r\n        .get(this.searchUrl, { params, responseType: 'text' })\r\n        .pipe(\r\n          map(response => {\r\n            return this.extractResults(this.extractWFSData(response));\r\n          })\r\n        );\r\n    } else {\r\n      return this.http.get(this.searchUrl, { params }).pipe(\r\n        map(response => {\r\n          return this.extractResults(this.extractWFSData(response));\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\r\n    const splittedTerm = {};\r\n    let remainingTerm = term;\r\n    let cnt = 0;\r\n\r\n    // Used to build the default values\r\n    fields.forEach(field => {\r\n      splittedTerm[field.name] = field.defaultValue;\r\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\r\n      if (splitterRegex.test(remainingTerm)) {\r\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\r\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\r\n      }\r\n    });\r\n    if (cnt === 0) {\r\n      splittedTerm[fields[0].name] = term;\r\n      return splittedTerm;\r\n    }\r\n    remainingTerm = term;\r\n    const localFields = [...fields].reverse();\r\n    localFields.forEach(field => {\r\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\r\n      if (remainingTerm || remainingTerm !== '') {\r\n        const values = remainingTerm.split(splitterRegex);\r\n        remainingTerm = values[0];\r\n        if (values[1]) {\r\n          splittedTerm[field.name] = values[1].trim();\r\n        }\r\n      }\r\n    });\r\n    return splittedTerm;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    options: TextSearchOptions,\r\n    queryParams\r\n  ): HttpParams {\r\n    const wfsversion = this.storedQueriesOptions.storedquery_id\r\n      .toLowerCase()\r\n      .includes('getfeaturebyid')\r\n      ? '2.0.0'\r\n      : '1.1.0';\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'wfs',\r\n          version: wfsversion,\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        queryParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: StoredQueriesData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        // extent: data.bbox,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties.title,\r\n        titleHtml: data.properties[title],\r\n        icon: 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      StoredQueriesSearchSource.propertiesBlacklist\r\n    );\r\n    return properties;\r\n  }\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source\r\n */\r\n\r\n// EXAMPLE CALLS\r\n// tslint:disable-next-line:max-line-length\r\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\r\n//\r\n\r\n@Injectable()\r\nexport class StoredQueriesReverseSearchSource extends SearchSource\r\n  implements ReverseSearch {\r\n  static id = 'storedqueriesreverse';\r\n  static type = FEATURE;\r\n  static propertiesBlacklist: string[] = [];\r\n  public resultTitle: 'title';\r\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\r\n  public multipleFieldsQuery: boolean;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    @Inject('options') options: SearchSourceOptions\r\n  ) {\r\n    super(options);\r\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\r\n    if (!this.storedQueriesOptions.storedquery_id) {\r\n      const err =\r\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\r\n      throw new Error(err);\r\n    }\r\n    if (!this.storedQueriesOptions.longField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\r\n      );\r\n    }\r\n    if (!this.storedQueriesOptions.latField) {\r\n      throw new Error(\r\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\r\n      );\r\n    }\r\n\r\n    this.storedQueriesOptions.outputformat =\r\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\r\n    this.storedQueriesOptions.srsname =\r\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\r\n    this.storedQueriesOptions.resultTitle =\r\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\r\n  }\r\n\r\n  getId(): string {\r\n    return StoredQueriesReverseSearchSource.id;\r\n  }\r\n\r\n  getType(): string {\r\n    return StoredQueriesReverseSearchSource.type;\r\n  }\r\n\r\n  protected getDefaultOptions(): SearchSourceOptions {\r\n    return {\r\n      title: 'Stored Queries (reverse)',\r\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Search a location by coordinates\r\n   * @param lonLat Location coordinates\r\n   * @param distance Search raidus around lonLat\r\n   * @returns Observable of <SearchResult<Feature>[]\r\n   */\r\n  reverseSearch(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): Observable<SearchResult<Feature>[]> {\r\n    const params = this.computeRequestParams(lonLat, options || {});\r\n\r\n    if (\r\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\r\n    ) {\r\n      return this.http\r\n        .get(this.searchUrl, { params, responseType: 'text' })\r\n        .pipe(\r\n          map(response => {\r\n            return this.extractResults(this.extractWFSData(response));\r\n          })\r\n        );\r\n    } else {\r\n      return this.http.get(this.searchUrl, { params }).pipe(\r\n        map(response => {\r\n          return this.extractResults(this.extractWFSData(response));\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  private getFormatFromOptions() {\r\n    let olFormatCls;\r\n\r\n    const outputFormat = this.storedQueriesOptions.outputformat;\r\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\r\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\r\n\r\n    if (patternGeojson.test(outputFormat)) {\r\n      olFormatCls = olformat.GeoJSON;\r\n    }\r\n    if (patternGml3.test(outputFormat)) {\r\n      olFormatCls = olformat.WFS;\r\n    }\r\n\r\n    return new olFormatCls();\r\n  }\r\n\r\n  private extractWFSData(res) {\r\n    const olFormat = this.getFormatFromOptions();\r\n    const geojson = olformat.GeoJSON;\r\n    const wfsfeatures = olFormat.readFeatures(res);\r\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\r\n    return features;\r\n  }\r\n\r\n  private computeRequestParams(\r\n    lonLat: [number, number],\r\n    options?: ReverseSearchOptions\r\n  ): HttpParams {\r\n    const longLatParams = {};\r\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\r\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\r\n\r\n    return new HttpParams({\r\n      fromObject: Object.assign(\r\n        {\r\n          service: 'WFS',\r\n          version: '1.1.0',\r\n          request: 'GetFeature',\r\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\r\n          srsname: this.storedQueriesOptions.srsname,\r\n          outputformat: this.storedQueriesOptions.outputformat\r\n        },\r\n        longLatParams,\r\n        this.params,\r\n        options.params || {}\r\n      )\r\n    });\r\n  }\r\n\r\n  private extractResults(\r\n    response: StoredQueriesReverseResponse\r\n  ): SearchResult<Feature>[] {\r\n    return response.features.map((data: StoredQueriesReverseData) => {\r\n      return this.dataToResult(data);\r\n    });\r\n  }\r\n\r\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\r\n    const properties = this.computeProperties(data);\r\n    const id = [this.getId(), properties.type, data.id].join('.');\r\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\r\n      ? this.storedQueriesOptions.resultTitle\r\n      : this.resultTitle;\r\n\r\n    return {\r\n      source: this,\r\n      data: {\r\n        type: FEATURE,\r\n        projection: 'EPSG:4326',\r\n        geometry: data.geometry,\r\n        properties,\r\n        meta: {\r\n          id,\r\n          title: data.properties[title]\r\n        }\r\n      },\r\n      meta: {\r\n        dataType: FEATURE,\r\n        id,\r\n        title: data.properties[title],\r\n        icon: 'map-marker'\r\n      }\r\n    };\r\n  }\r\n\r\n  private computeProperties(\r\n    data: StoredQueriesReverseData\r\n  ): { [key: string]: any } {\r\n    const properties = ObjectUtils.removeKeys(\r\n      data.properties,\r\n      StoredQueriesReverseSearchSource.propertiesBlacklist\r\n    );\r\n    return Object.assign(properties, { type: data.properties.doc_type });\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { SearchSource } from './source';\r\nimport {\r\n  StoredQueriesSearchSource,\r\n  StoredQueriesReverseSearchSource\r\n} from './storedqueries';\r\n\r\n/**\r\n * StoredQueries search source factory\r\n * @ignore\r\n */\r\nexport function storedqueriesSearchSourceFactory(\r\n  http: HttpClient,\r\n  config: ConfigService\r\n) {\r\n  return new StoredQueriesSearchSource(\r\n    http,\r\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the StoredQueries search source\r\n */\r\nexport function provideStoredQueriesSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: storedqueriesSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n\r\n/**\r\n * StoredQueriesReverse search source factory\r\n * @ignore\r\n */\r\n\r\nexport function storedqueriesReverseSearchSourceFactory(\r\n  http: HttpClient,\r\n  config: ConfigService\r\n) {\r\n  return new StoredQueriesReverseSearchSource(\r\n    http,\r\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\r\n  );\r\n}\r\n\r\n/**\r\n * Function that returns a provider for the StoredQueriesReverse search source\r\n */\r\nexport function provideStoredQueriesReverseSearchSource() {\r\n  return {\r\n    provide: SearchSource,\r\n    useFactory: storedqueriesReverseSearchSourceFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","export enum DirectionsFormat {\r\n  GeoJSON,\r\n  JSON\r\n}\r\nexport enum SourceDirectionsType {\r\n  Route = 'Route',\r\n  Trip = 'Trip'\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { uuid } from '@igo2/utils';\r\nimport { ConfigService, Message } from '@igo2/core';\r\n\r\nimport { Directions, DirectionsOptions } from '../shared/directions.interface';\r\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\r\n\r\nimport { DirectionsSource } from './directions-source';\r\nimport { DirectionsSourceOptions } from './directions-source.interface';\r\n\r\n@Injectable()\r\nexport class OsrmDirectionsSource extends DirectionsSource {\r\n  get enabled(): boolean {\r\n    return this.options.enabled !== false;\r\n  }\r\n  set enabled(value: boolean) {\r\n    this.options.enabled = value;\r\n  }\r\n  static _name = 'OSRM QuÃ©bec';\r\n  private directionsUrl =\r\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\r\n  private options: DirectionsSourceOptions;\r\n\r\n  constructor(private http: HttpClient, private config: ConfigService) {\r\n    super();\r\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\r\n    this.directionsUrl = this.options.url || this.directionsUrl;\r\n  }\r\n\r\n  getName(): string {\r\n    return OsrmDirectionsSource._name;\r\n  }\r\n\r\n  route(coordinates: [number, number][], directionsOptions: DirectionsOptions = {}): Observable<Directions[]> {\r\n    const directionsParams = this.getRouteParams(directionsOptions);\r\n    return this.http\r\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\r\n        params: directionsParams\r\n      })\r\n      .pipe(map(res => this.extractRoutesData(res)));\r\n  }\r\n\r\n  private extractRoutesData(response): Directions[] {\r\n    const routeResponse = [];\r\n    response.routes.forEach(route => {\r\n      routeResponse.push(this.formatRoute(route, response.waypoints));\r\n    });\r\n    return routeResponse;\r\n  }\r\n\r\n  private getRouteParams(directionsOptions: DirectionsOptions = {}): HttpParams {\r\n\r\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\r\n    directionsOptions.steps = directionsOptions.steps !== undefined  ? directionsOptions.steps : true;\r\n    directionsOptions.geometries = directionsOptions.geometries !== undefined  ? directionsOptions.geometries : 'geojson';\r\n    directionsOptions.overview = directionsOptions.overview !== undefined  ? directionsOptions.overview : false;\r\n\r\n    return new HttpParams({\r\n      fromObject: {\r\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\r\n        overview: directionsOptions.overview ? 'simplified' : 'full',\r\n        steps: directionsOptions.steps ? 'true' : 'false',\r\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\r\n      }\r\n    });\r\n  }\r\n\r\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Directions {\r\n    const stepsUI = [];\r\n    roadNetworkRoute.legs.forEach(leg => {\r\n      leg.steps.forEach(step => {\r\n        stepsUI.push(step);\r\n      });\r\n    });\r\n    return {\r\n      id: uuid(),\r\n      title: roadNetworkRoute.legs[0].summary,\r\n      source: OsrmDirectionsSource._name,\r\n      sourceType: SourceDirectionsType.Route,\r\n      order: 1,\r\n      format: DirectionsFormat.GeoJSON,\r\n      icon: 'directions',\r\n      projection: 'EPSG:4326',\r\n      waypoints,\r\n      distance: roadNetworkRoute.distance,\r\n      duration: roadNetworkRoute.duration,\r\n      geometry: roadNetworkRoute.geometry,\r\n      legs: roadNetworkRoute.legs,\r\n      steps: stepsUI,\r\n      weight: roadNetworkRoute.weight,\r\n      weight_name: roadNetworkRoute.weight_name\r\n    };\r\n  }\r\n}\r\n","import { HttpClient } from '@angular/common/http';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { DirectionsSource } from './directions-source';\r\nimport { OsrmDirectionsSource } from './osrm-directions-source';\r\n\r\nexport function osrmDirectionsSourcesFactory(\r\n  http: HttpClient,\r\n  config: ConfigService\r\n) {\r\n  return new OsrmDirectionsSource(http, config);\r\n}\r\n\r\nexport function provideOsrmDirectionsSource() {\r\n  return {\r\n    provide: DirectionsSource,\r\n    useFactory: osrmDirectionsSourcesFactory,\r\n    multi: true,\r\n    deps: [HttpClient, ConfigService]\r\n  };\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { ConfigService } from '@igo2/core';\r\n\r\nimport { Observer } from 'rxjs';\r\n\r\nimport * as olformat from 'ol/format';\r\nimport OlFeature from 'ol/Feature';\r\n\r\nimport { ExportFormat } from './export.type';\r\n\r\nimport { Platform } from '@ionic/angular';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { FileOpener } from '@ionic-native/file-opener/ngx';\r\nimport { ExportService } from './export.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExportIonicService extends ExportService {\r\n\r\n  constructor(\r\n      config: ConfigService,\r\n      private platform: Platform,\r\n      private fileOpener: FileOpener,\r\n      private file: File\r\n    ) {\r\n      super(config);\r\n    }\r\n\r\n    protected exportToFile(\r\n      olFeatures: OlFeature[],\r\n      observer: Observer<void>,\r\n      format: ExportFormat,\r\n      title: string,\r\n      projectionIn: string,\r\n      projectionOut: string\r\n    ) {\r\n      if (this.platform.is('cordova')) {\r\n        const olFormat = new olformat[format]();\r\n        const featuresText = olFormat.writeFeatures(olFeatures, {\r\n          dataProjection: projectionOut,\r\n          featureProjection: projectionIn,\r\n          featureType: 'feature',\r\n          featureNS: 'http://example.com/feature'\r\n        });\r\n\r\n        const fileName = `${title}.${format.toLowerCase()}`;\r\n        const directory = this.file.externalRootDirectory + 'Download';\r\n        console.log(directory);\r\n        this.file.writeFile(directory, fileName, featuresText, { replace: true }).then((success) =>\r\n        this.fileOpener.open(directory + '/' + fileName, 'text/plain'));\r\n        observer.complete();\r\n      } else {\r\n        super.exportToFile(\r\n          olFeatures,\r\n          observer,\r\n          format,\r\n          title,\r\n          projectionIn,\r\n          projectionOut\r\n        );\r\n      }\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport * as jsPDF from 'jspdf';\r\nimport { Platform } from '@ionic/angular';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { FileOpener } from '@ionic-native/file-opener/ngx';\r\n\r\nimport { MessageService, ActivityService, LanguageService } from '@igo2/core';\r\nimport { PrintService } from './print.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PrintIonicService extends PrintService {\r\n  date: Date;\r\n  day: string;\r\n  month: any;\r\n  hour: string;\r\n  minute: string;\r\n  year: string;\r\n\r\n  constructor(\r\n    messageService: MessageService,\r\n    activityService: ActivityService,\r\n    languageService: LanguageService,\r\n    private platform: Platform,\r\n    private fileOpener: FileOpener,\r\n    private file: File\r\n  ) {\r\n    super(messageService, activityService, languageService);\r\n  }\r\n\r\n  protected saveDoc(doc: jsPDF) {\r\n    if (this.platform.is('cordova')) {\r\n      const docOutput = doc.output();\r\n      const buffer = new ArrayBuffer(docOutput.length);\r\n      const array = new Uint8Array(buffer);\r\n      this.setDate();\r\n      for (let i = 0; i < docOutput.length; i++) {\r\n          array[i] = docOutput.charCodeAt(i);\r\n      }\r\n      const fileName = 'map' + this.year + '-' + this.month + '-' + this.day + '-' + this.hour + '-' + this.minute + '.pdf';\r\n      const directory = this.file.externalRootDirectory + 'Download';\r\n      this.file.writeFile(directory, fileName, buffer, { replace: true }).then((success) =>\r\n        this.fileOpener.open(directory + '/' + fileName, 'application/pdf'));\r\n    } else {\r\n        super.saveDoc(doc);\r\n    }\r\n  }\r\n  private setDate() {\r\n      this.date = new Date();\r\n      this.day = this.date.getDate().toString();\r\n      this.month = this.date.getMonth() + 1;\r\n      if (this.month < 10) {\r\n        this.month = '0' + this.month.toString();\r\n      } else {\r\n          this.month = this.month.toString();\r\n      }\r\n      this.year = this.date.getFullYear().toString();\r\n      this.hour = this.date.getHours().toString();\r\n      this.minute = this.date.getMinutes().toString();\r\n  }\r\n}\r\n"],"names":["olproj.transform","olproj.METERS_PER_UNIT","style","olSourceVector","olformat.GeoJSON","olfilter.bbox","olfilter.and","olFormatWKT","olfilter.between","olfilter.contains","olfilter.during","olfilter.equalTo","olfilter.greaterThan","olfilter.greaterThanOrEqualTo","olfilter.intersects","olfilter.isNull","olfilter.lessThan","olfilter.lessThanOrEqualTo","olfilter.like","olfilter.notEqualTo","olfilter.within","olfilter.or","olfilter.not","OlFormat.WFS","OlFormat","OlFormat.TopoJSON","OlFormat.GeoJSON","OlFormat.EsriJSON","OlFormat.GPX","OlFormat.WKT","OlFormat.KML","OlLoadingStrategy.bbox","olproj.get","extentGetWidth","extentGetTopLeft","olloadingstrategy.bbox","feature","map","olLayerVector","animate","ColorAsArray","olFormatGeoJSON","olstyle.Stroke","olstyle.Fill","olstyle.Style","olstyle.Circle","olstyle.Text","olstyle.Icon","olstyle.RegularShape","state","OlFormatGeoJSON","olextent.createEmpty","olproj.transformExtent","olextent.extend","olextent.getSize","olextent.containsExtent","olextent.getArea","olMap","oleasing.easeOut","olView","duration","olproj4.register","olControlAttribution","olinteraction.defaults","olproj.fromLonLat","first","olFeature","Style","tslib_1.__decorate","olformat.WMSGetFeatureInfo","olgeom.MultiLineString","olgeom.MultiPolygon","bbox","olgeom.Point","olgeom.LineString","olgeom.Polygon","olformat.WKT","olextent.boundingExtent","olextent.buffer","buffer","olGetLength","olGetArea","olGetCenter","intersects","Point","moment.duration","olStyle.Stroke","olStyle.Fill","olStyle.Style","olStyle.Circle","GeoJSON","olformat.KML","olformat.GML","olformat.GPX","olinteraction.Select","olcondition.pointerMove","olinteraction.Translate","olcondition.click","olobservable.unByKey","olformat.WFS"],"mappings":"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"}
